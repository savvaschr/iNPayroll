Public Class cBusinessDBTier
    Inherits cDataTier

#Region "FIN"
    Protected Function GetFiscalPeriodsOfYear(ByVal Year As String, ByVal OnlyOpen As Boolean, ByVal OnlyNormal As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""

        Str = " SELECT Prd_Code," & _
             " Prd_Year," & _
             " Prd_Number," & _
             " Prd_From," & _
             " Prd_To," & _
             " Prd_NoOfDays," & _
             " Prd_DescriptionL," & _
             " Prd_DescriptionS," & _
             " Prd_Type," & _
             " Prd_StatusFin," & _
             " Prd_StatusMain" & _
             " FROM AdMsPeriods" & _
             " WHERE (Prd_Year = " & enQuoteString(Year) & ")"

        If OnlyOpen Then
            Str2 = " AND Prd_StatusMain='O'"
        End If
        If OnlyNormal Then
            Str3 = " AND Prd_Type='N'"
        End If

        Str4 = " ORDER BY Prd_Number"

        Str = Str + Str2 + Str3 + Str4
        Return GetData(Str)
    End Function
    Protected Function SearchForJournalCode(ByVal JournalType As String, ByVal Code As String, ByVal Description As String, ByVal SearchCode As String, ByVal Nextorprevius As String, ByVal PreviusSearchCode As String, ByVal ActiveOnly As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""


        Code = Code & "%"
        Description = Description & "%"


        Str = "SELECT TOP(15)  JouCod_Code," & _
        " JouCod_Desc " & _
        " FROM FiMsJournalCode " & _
        " WHERE (JouTyp_Code=" & enQuoteString(JournalType) & ")" & _
        " AND (JouCod_Code like " & enQuoteString(Code) & ")" & _
        " AND (JouCod_Desc like " & enQuoteString(Description) & ")"

        If ActiveOnly Then
            Str2 = " AND JouCod_Status='A'"
        End If

        Str = Str & Str2

        If Nextorprevius = 1 Then
            Str3 = " AND JouCod_Code>" & enQuoteString(SearchCode) & _
            " ORDER BY JouCod_Code,JouCod_Desc"
        Else
            Str3 = " AND JouCod_Code>=" & enQuoteString(SearchCode) & _
            " AND JouCod_Code<=" & enQuoteString(PreviusSearchCode) & _
            " ORDER BY JouCod_Code,JouCod_Desc"
        End If
        Str = Str & Str3

        Return GetData(Str)

    End Function
    Protected Function GetAllJournalCodesByJournalType(ByVal JournalType As String, ByVal OnlyActive As Boolean) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = "Select JouCod_Code," & _
        " JouCod_Desc," & _
        " JouTyp_Code," & _
        " JouCod_JouNoStart," & _
        " JouCod_JouNoCurrent," & _
        " JouCod_Length," & _
        " JouCod_Status" & _
        " From FiMsJournalCode " & _
        " Where JouTyp_Code=" & enQuoteString(JournalType)

        If OnlyActive Then
            Str2 = " And JouCod_Status='A'"
        End If

        Str3 = " Order by JouCod_Code,JouCod_Desc Asc"

        Str = Str & Str2 & Str3

        Return MyBase.GetData(Str)

    End Function
    Protected Function GetAllJournalCodesForJournalEntry(ByVal OnlyActive As Boolean) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = "Select JouCod_Code," & _
        " JouCod_Desc," & _
        " JouTyp_Code," & _
        " JouCod_JouNoStart," & _
        " JouCod_JouNoCurrent," & _
        " JouCod_Length," & _
        " JouCod_Status" & _
        " From FiMsJournalCode " & _
        " Where JouTyp_Code='STD' OR" & _
        " JouTyp_Code='REV' "

        If OnlyActive Then
            Str2 = " And JouCod_Status='A'"
        End If

        Str3 = " Order by JouCod_Code,JouCod_Desc Asc"

        Str = Str & Str2 & Str3

        Return MyBase.GetData(Str)

    End Function

    Protected Function GetAllCurrencies() As DataSet
        Dim Str As String
        Str = "SELECT Cur_AlphaCode, " & _
            "Cur_NumericCode, " & _
            "Cur_Description, " & _
            "Cur_Symbol, " & _
            "Cur_IsActive " & _
            " FROM AdMsCurrency " & _
            " Order by Cur_AlphaCode,Cur_Description Asc"
        Return MyBase.GetData(Str)
    End Function

    Protected Function GetAllCurrenciesRatesByCode(ByVal code As String) As DataSet
        Dim str As String
        'str = "SELECT CurRte_id ," & _
        '      " Cur_AlphaCode ," & _
        '      " CurRte_Rate ," & _
        '      " CurRte_EffectiveDate ," & _
        '      " CurRte_CreatedBy ," & _
        '      " CurRte_CreationDate ," & _
        '      " CurRte_AmendBy ," & _
        '      " CurRte_AmendDate " & _
        '      " FROM AdMsCurrencyRates " & _
        '      " where Cur_AlphaCode = " & Utils.enQuoteString(code) & _
        '      " Order by Cur_AlphaCode Asc"
        str = " SELECT     AdMsCurrencyRates.CurRte_id, " & _
                " AdMsCurrencyRates.Cur_AlphaCode, " & _
                " AdMsCurrencyRates.CurRte_Rate, " & _
                " AdMsCurrencyRates.CurRte_EffectiveDate," & _
                " AdMsCurrencyRates.CurRte_CreatedBy," & _
                " AdMsCurrencyRates.CurRte_CreationDate," & _
                " AdMsCurrencyRates.CurRte_AmendBy, " & _
                " AdMsCurrencyRates.CurRte_AmendDate," & _
                " AaSsUsers_1.Usr_FullName as CreatedBy," & _
                " AaSsUsers.Usr_FullName AS AmendBy " & _
                " FROM AdMsCurrencyRates INNER JOIN " & _
                " AaSsUsers AS AaSsUsers_1 ON AdMsCurrencyRates.CurRte_CreatedBy = AaSsUsers_1.Usr_Id INNER JOIN " & _
                " AaSsUsers ON AdMsCurrencyRates.CurRte_AmendBy = AaSsUsers.Usr_Id " & _
                " WHERE     AdMsCurrencyRates.Cur_AlphaCode =" & Utils.enQuoteString(code) & _
                " ORDER BY AdMsCurrencyRates.Cur_AlphaCode "

        Return MyBase.GetData(str)
    End Function

    Protected Function GetAllVatRatesByCode(ByVal code As String) As DataSet
        Dim str As String
        ' str = "SELECT VatRte_id ," & _
        '" Vat_Code ," & _
        '" VatRte_Rate, " & _
        '" VatRte_EffectiveDate ," & _
        '" VatRte_CreatedBy ," & _
        '" VatRte_CreationDate ," & _
        '" VatRte_AmendBy, " & _
        '" VatRte_AmendDate ," & _
        '" VatRte_IsActive " & _
        '" FROM AdMsVatRates " & _
        '" where Vat_Code = " & Utils.enQuoteString(code) & _
        '" Order by Vat_Code Asc"
        str = " SELECT     AdMsVatRates.VatRte_id , " & _
        " AdMsVatRates.Vat_Code, " & _
        " AdMsVatRates.VatRte_Rate, " & _
        " AdMsVatRates.VatRte_EffectiveDate, " & _
        " AdMsVatRates.VatRte_CreatedBy, " & _
        " AdMsVatRates.VatRte_CreationDate, " & _
        " AdMsVatRates.VatRte_AmendBy, " & _
        " AdMsVatRates.VatRte_AmendDate, " & _
        " AdMsVatRates.VatRte_IsActive, " & _
        " AaSsUsers.Usr_UserName as AmendBy, " & _
        " AaSsUsers_1.Usr_UserName AS CreatedBy " & _
        " FROM  AdMsVatRates INNER JOIN " & _
        " AaSsUsers ON AdMsVatRates.VatRte_AmendBy = AaSsUsers.Usr_Id INNER JOIN " & _
        " AaSsUsers AS AaSsUsers_1 ON AdMsVatRates.VatRte_CreatedBy = AaSsUsers_1.Usr_Id " & _
        " where AdMsVatRates.Vat_Code= " & Utils.enQuoteString(code) & _
        " Order by Vat_Code Asc"

        Return MyBase.GetData(str)
    End Function

    Protected Function GetAllJournalCodeByCode(ByVal code As String) As DataSet
        Dim str As String
        str = "SELECT JouCod_Code ," & _
       " JouCod_Desc ," & _
       " JouTyp_Code, " & _
       " JouCod_JouNoStart ," & _
       " JouCod_JouNoCurrent ," & _
       " JouCod_Length," & _
       " JouCod_Status " & _
       " FROM FiMsJournalCode " & _
       " where JouTyp_Code =" & enQuoteString(code) & _
       " order by JouCod_code,JouCod_Desc desc"

        Return MyBase.GetData(str)
    End Function

    Protected Function DeleteCurrency(ByVal Code As String)
        Dim str As String
        str = "Delete From AdMsCurrency Where Cur_AlphaCode= " & Utils.enQuoteString(Code)
        If MyBase.ExecuteNonQuery(str) > 0 Then
            Return True
        Else
            Return False
        End If
    End Function

    Protected Function DeleteVat(ByVal Code As String)
        Dim str As String
        str = "Delete From AdMsVat Where Vat_Code= " & Utils.enQuoteString(Code)
        If MyBase.ExecuteNonQuery(str) > 0 Then
            Return True
        Else
            Return False
        End If
    End Function

    Protected Function DeleteCurrencyRates(ByVal Code As String)
        Dim str As String
        str = "Delete From AdMsCurrencyRates Where CurRte_id= " & Code
        If MyBase.ExecuteNonQuery(str) > 0 Then
            Return True
        Else
            Return False
        End If
    End Function

    Protected Function GetAllVats(ByVal OnlyActive As Boolean) As DataSet
        Dim str As String
        Dim Str2 As String = ""
        Dim str3 As String = ""

        str = " SELECT Vat_Code, " & _
              " Vat_Description, " & _
              " Vat_IsActive " & _
              " FROM AdMsVAT"

        If OnlyActive Then
            Str2 = " Where Vat_IsActive='A'"
        End If

        str3 = " Order By Vat_Code,Vat_Description Asc"

        str = str & Str2 & str3

        Return MyBase.GetData(str)
    End Function

    Protected Function GetAllJournalTypes() As DataSet
        Dim str As String
        str = " SELECT JouTyp_Code, " & _
              " JouTyp_Desc, " & _
              " JouTyp_Status " & _
              " FROM FiMsJournalType" & _
              " Order By JouTyp_Code,JouTyp_Desc Asc"
        Return MyBase.GetData(str)
    End Function


    Protected Function GetAllAnalysis(ByVal Prefix As String, ByVal TableName As String, ByVal PrefixForLevels As String) As DataSet
        Dim Str As String
        If PrefixForLevels = "" Then
            Str = "Select " & Prefix & "_Code," & _
            Prefix & "_DescriptionL," & _
            Prefix & "_DescriptionS," & _
            Prefix & "_CreationDate," & _
            Prefix & "_AmendDate, " & _
            Prefix & "_IsActive" & _
            " From " & TableName & _
            " Order by " & Prefix & "_code "
        Else
            Str = "select " & Prefix & "_code," & _
            PrefixForLevels & "_code," & _
            Prefix & "_DescriptionL," & _
            Prefix & "_DescriptionS," & _
            Prefix & "_CreationDate," & _
            Prefix & "_AmendDate, " & _
            Prefix & "_IsActive" & _
            " From " & TableName & _
            " Order by " & Prefix & "_code "
        End If
        Return MyBase.GetData(Str)
    End Function

    Protected Function GetAllAccountLinesAnalysisLevel1(ByVal Prefix As String, ByVal TableName As String, ByVal ActiveOnly As Boolean, Optional ByVal IsAnalysis1 As Boolean = False) As DataSet

        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        If Not IsAnalysis1 Then
            Str = "Select " & Prefix & "_Code," & _
                Prefix & "_DescriptionL," & _
                Prefix & "_DescriptionS," & _
                Prefix & "_CreationDate," & _
                Prefix & "_AmendDate, " & _
                Prefix & "_IsActive" & _
                " From " & TableName
        Else
            Str = "select " & Prefix & "_code," & _
               "AcLA21_code," & _
               Prefix & "_DescriptionL," & _
               Prefix & "_DescriptionS," & _
               Prefix & "_CreationDate," & _
               Prefix & "_AmendDate, " & _
               Prefix & "_IsActive" & _
               " From " & TableName
        End If

        If ActiveOnly Then
            Str2 = " Where " & Prefix & "_IsActive='A'"
        End If

        Str3 = " Order by " & Prefix & "_code "

        Str = Str & Str2 & Str3

        Return MyBase.GetData(Str)

    End Function

    Protected Function GetAllAccountAnalysisLevel1(ByVal Prefix As String, ByVal TableName As String, ByVal ActiveOnly As Boolean, Optional ByVal IsAnalysis1 As Boolean = False) As DataSet

        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        If Not IsAnalysis1 Then
            Str = "Select " & Prefix & "_Code," & _
                Prefix & "_DescriptionL," & _
                Prefix & "_DescriptionS," & _
                Prefix & "_CreationDate," & _
                Prefix & "_AmendDate, " & _
                Prefix & "_IsActive" & _
                " From " & TableName
        Else
            Str = "select " & Prefix & "_code," & _
               "AccA21_code," & _
               Prefix & "_DescriptionL," & _
               Prefix & "_DescriptionS," & _
               Prefix & "_CreationDate," & _
               Prefix & "_AmendDate, " & _
               Prefix & "_IsActive" & _
               " From " & TableName
        End If

        If ActiveOnly Then
            Str2 = " Where " & Prefix & "_IsActive='A'"
        End If

        Str3 = " Order by " & Prefix & "_code "

        Str = Str & Str2 & Str3

        Return MyBase.GetData(Str)

    End Function

    Protected Function GetAllAccountLinesAnalysisLevel2(ByVal Prefix As String, ByVal TableName As String, ByVal PrefixForLevels As String, ByVal ActiveOnly As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = "select " & Prefix & "_code," & _
          PrefixForLevels & "_code," & _
          Prefix & "_DescriptionL," & _
          Prefix & "_DescriptionS," & _
          Prefix & "_CreationDate," & _
          Prefix & "_AmendDate, " & _
          Prefix & "_IsActive" & _
          " From " & TableName

        If ActiveOnly Then
            Str2 = " Where " & Prefix & "_IsActive='A'"
        End If

        Str3 = " Order by " & Prefix & "_code "

        Str = Str & Str2 & Str3

        Return MyBase.GetData(Str)

    End Function

    Protected Function GetAllAccountAnalysisLevel2(ByVal Prefix As String, ByVal TableName As String, ByVal PrefixForLevels As String, ByVal ActiveOnly As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = "select " & Prefix & "_code," & _
          PrefixForLevels & "_code," & _
          Prefix & "_DescriptionL," & _
          Prefix & "_DescriptionS," & _
          Prefix & "_CreationDate," & _
          Prefix & "_AmendDate, " & _
          Prefix & "_IsActive" & _
          " From " & TableName

        If ActiveOnly Then
            Str2 = " Where " & Prefix & "_IsActive='A'"
        End If

        Str3 = " Order by " & Prefix & "_code "

        Str = Str & Str2 & Str3

        Return MyBase.GetData(Str)

    End Function

    Protected Function GetAllAccountLinesAnalysisLevel3(ByVal ActiveOnly As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = "select AcLA31_code," & _
          " AcLA31_DescriptionL," & _
          " AcLA31_DescriptionS," & _
          " AcLA31_CreationDate," & _
          " AcLA31_AmendDate, " & _
          " AcLA31_IsActive" & _
          " From FiAnAccountLineAnal1Level3"

        If ActiveOnly Then
            Str2 = " Where AcLA31_IsActive='A'"
        End If

        Str3 = " Order by AcLA31_code "

        Str = Str & Str2 & Str3

        Return MyBase.GetData(Str)

    End Function

    Protected Function GetAllAccountAnalysisLevel3(ByVal ActiveOnly As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = "select AccA31_code," & _
          " AccA31_DescriptionL," & _
          " AccA31_DescriptionS," & _
          " AccA31_CreationDate," & _
          " AccA31_AmendDate, " & _
          " AccA31_IsActive" & _
          " From FiAnAccountAnal1Level3"

        If ActiveOnly Then
            Str2 = " Where AccA31_IsActive='A'"
        End If

        Str3 = " Order by AccA31_code "

        Str = Str & Str2 & Str3

        Return MyBase.GetData(Str)

    End Function

    Protected Function GetLimitedAnalysis(ByVal Code As String, ByVal DescriptionS As String, ByVal choice As Integer, ByVal AnalysisCmbchoice As Integer)
        Dim Str As String
        Code = Code + "%"
        DescriptionS = DescriptionS + "%"

        If choice = 0 Then
            If AnalysisCmbchoice = 0 Then
                Str = "Select AccA21_Code," & _
                " AccA31_Code," & _
                " AccA21_DescriptionL," & _
                " AccA21_DescriptionS," & _
                " AccA21_CreationDate, " & _
                " AccA21_AmendDate, " & _
                " AccA21_IsActive " & _
                " From FiAnAccountAnal1Level2 " & _
                " Where Acca21_Code like" & Utils.enQuoteString(Code) & _
                " AND AccA21_DescriptionS like" & Utils.enQuoteString(DescriptionS)
            Else
                Str = "Select  AccA31_Code," & _
                " AccA31_DescriptionL," & _
                " AccA31_DescriptionS," & _
                " AccA31_CreationDate, " & _
                " AccA31_AmendDate, " & _
                " AccA31_IsActive " & _
                " From FiAnAccountAnal1Level3 " & _
                " Where Acca31_Code like" & Utils.enQuoteString(Code) & _
                " AND AccA31_DescriptionS like" & Utils.enQuoteString(DescriptionS)
            End If
        Else
            If AnalysisCmbchoice = 0 Then
                Str = "Select AcLA21_Code," & _
                " AcLA31_Code," & _
                " AcLA21_DescriptionL," & _
                " AcLA21_DescriptionS," & _
                " AcLA21_CreationDate, " & _
                " AcLA21_AmendDate, " & _
                " AcLA21_IsActive " & _
                " From FiAnAccountLineAnal1Level2 " & _
                " Where AcLA21_Code like" & Utils.enQuoteString(Code) & _
                " AND AcLA21_DescriptionS like" & Utils.enQuoteString(DescriptionS)
            Else
                Str = "Select AcLA31_Code," & _
                " AcLA31_DescriptionL," & _
                " AcLA31_DescriptionS," & _
                " AcLA31_CreationDate, " & _
                " AcLA31_AmendDate, " & _
                " AcLA31_IsActive " & _
                " From FiAnAccountLineAnal1Level3 " & _
                " Where AcLA31_Code like" & Utils.enQuoteString(Code) & _
                " AND AcLA31_DescriptionS like" & Utils.enQuoteString(DescriptionS)
            End If

        End If
        Return MyBase.GetData(Str)
    End Function

    Protected Function SearchForAccountFin(ByVal Code As String, ByVal Description As String, ByVal SearchCode As String, ByVal Nextorprevius As String, ByVal PreviusSearchCode As String, ByVal ActiveOnly As Boolean) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""


        Code = Code & "%"
        Description = Description & "%"



        Str = "SELECT   TOP(15)  Acc_Code," & _
        " Acc_DescriptionL " & _
        " FROM FiMsAccount " & _
        " WHERE (Acc_Code LIKE " & enQuoteString(Code) & ")" & _
        " AND ((Acc_DescriptionL LIKE " & enQuoteString(Description) & ")" & _
        " OR (Acc_DescriptionS LIKE " & enQuoteString(Description) & "))"

        If ActiveOnly Then
            Str2 = " AND (Acc_Status='A')"
        End If

        Str = Str & Str2

        If Nextorprevius = 1 Then
            Str3 = " AND Acc_Code>" & enQuoteString(SearchCode) & _
            " ORDER BY Acc_Code"
        Else
            Str3 = " AND Acc_Code>=" & enQuoteString(SearchCode) & _
            " AND Acc_Code<=" & enQuoteString(PreviusSearchCode) & _
        " ORDER BY Acc_Code"
        End If
        Str = Str & Str3

        Return GetData(Str)

    End Function

    Protected Function GetWhatAnalysisToUse(ByVal AccTAnGrpCode) As DataSet
        Dim Str As String
        Str = "Select TAnGrp_Code," & _
        " TAnGrp_Anal1IsUsed," & _
        " TAnGrp_Anal2IsUsed," & _
        " TAnGrp_Anal3IsUsed," & _
        " TAnGrp_Anal4IsUsed," & _
        " TAnGrp_Anal5IsUsed," & _
        " TAnGrp_Anal6IsUsed," & _
        " TAnGrp_Anal7IsUsed," & _
        " TAnGrp_Anal8IsUsed," & _
        " TAnGrp_Anal9IsUsed," & _
        " TAnGrp_Anal10IsUsed " & _
        " From FiMsTransactionAnalysisGroup " & _
        " Where TAnGrp_Code=" & enQuoteString(AccTAnGrpCode)

        Return MyBase.GetData(Str)

    End Function
    Protected Shadows Function GetJournalCodeNextReferenceNo(ByVal JournalCode As cJournalCode) As String

        Dim SpParams As New ArrayList
        Dim SpNames As New ArrayList
        Dim NextReference As String

        SpParams.Add(JournalCode.Code)       '0
        SpNames.Add("JournalCode")

        SpParams.Add(JournalCode.TypeCode)   '1
        SpNames.Add("JournalType")

        SpParams.Add(CInt(0))                '2
        SpNames.Add("ReferenceNo")

        If Me.StoredProcedure("FiMsJournalCode_GetNextReference", SpParams, spnames, 2) Then
            NextReference = DbNullToString(SpParams(2))
            NextReference = NextReference.PadLeft(JournalCode.length, "0")
        Else
            NextReference = ""
        End If
        Return NextReference
    End Function
    Protected Shadows Function GetFiTrxnCodeNextReferenceNo(ByVal TrxnCode As cFiTrxnCodes) As String

        Dim SpParams As New ArrayList
        Dim SpNames As New ArrayList
        Dim NextReference As String


        SpParams.Add(TrxnCode.RefSchId)       '0
        SpNames.Add("ReferenceId")
        SpParams.Add(CInt(0))                 '1
        SpNames.Add("ReferenceNo")

        If Me.StoredProcedure("Fi_GetNextReference", SpParams, SpNames, 1) Then
            NextReference = DbNullToString(SpParams(1))
        Else
            NextReference = ""
        End If
        Return NextReference
    End Function
    Protected Function GetAllFiTrxnCodesByTrxnTypeByInvType(ByVal TrxnType As String, ByVal InvoiceType As String) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Str = " SELECT FiAdTrxnCodes.TrxCod_Code," & _
                " FiAdTrxnCodes.TrxGrp_Code," & _
                " FiAdTrxnCodes.TrxCod_DescriptionL," & _
                " FiAdTrxnCodes.TrxCod_DescriptionS, " & _
                " FiAdTrxnCodes.TrxCod_IsActive," & _
                " FiAdTrxnCodes.RefSch_Id," & _
                " FiAdTrxnCodes.JouCod_Code," & _
                " FiAdTrxnCodes.TrxCod_DocTemplate," & _
                " FiAdTrxnCodes.TrxCod_AutoPrint," & _
                " FiAdTrxnCodes.Acc_CodeHdr," & _
                " FiAdTrxnCodes.Acc_CodeDisc," & _
                " FiAdTrxnCodes.Acc_CodeVAT," & _
                " FiAdTrxnCodes.TrxCod_AllowLneDisc," & _
                " FiAdTrxnCodes.TrxCod_AllowOverallDisc" & _
                " FROM  FiAdTrxnCodes INNER JOIN" & _
                " FiAdTrxnGroups ON " & _
                " FiAdTrxnCodes.TrxGrp_Code = FiAdTrxnGroups.TrxGrp_Code" & _
                " WHERE (FiAdTrxnGroups.TrxTyp_Code = " & enQuoteString(TrxnType) & ") AND" & _
                " (FiAdTrxnGroups.TrxGrp_IsActive = 'A') AND " & _
                " (FiAdTrxnCodes.TrxCod_IsActive = 'A') AND "

        If InvoiceType = "B" Then
            Str2 = " (FiAdTrxnGroups.TrxGrp_FiType = 'C' OR" & _
                " FiAdTrxnGroups.TrxGrp_FiType = 'H')"
        ElseIf InvoiceType = "C" Then
            Str2 = " (FiAdTrxnGroups.TrxGrp_FiType = 'C' )"
        ElseIf InvoiceType = "H" Then
            Str2 = " (FiAdTrxnGroups.TrxGrp_FiType = 'H')"
        ElseIf InvoiceType = "N" Then
            Str2 = " (FiAdTrxnGroups.TrxGrp_FiType = 'N')"
        End If

        Str = Str & Str2

        Return GetData(Str)
    End Function
    Protected Function GetCurruncyRate(ByVal Code As String, ByVal EffectiveDate As Date) As Double

        Dim Str As String
        Dim ds As DataSet
        Dim Rate As Double = 0
        Dim EffectDate As String = Format(EffectiveDate, "yyyy-MM-dd")
        EffectDate = Utils.ChangeDateFormatForSearch(EffectDate)

        Str = "Select CurRte_Rate " & _
            " From AdMsCurrencyRates " & _
            " Where Cur_AlphaCode =" & Utils.enQuoteString(Code) & _
            " AND CurRte_EffectiveDate <= " & Utils.enQuoteString(EffectDate) & _
            " order by CurRte_EffectiveDate desc"

        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Rate = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        Else
            Rate = 0
        End If

        Return Rate
    End Function
    Protected Function GetVATRate(ByVal Code As String, ByVal EffectiveDate As Date) As Double

        Dim Str As String
        Dim ds As DataSet
        Dim Rate As Double = 0
        Dim EffectDate As String = Format(EffectiveDate, "yyyy-MM-dd")
        EffectDate = Utils.ChangeDateFormatForSearch(EffectDate)

        Str = "Select VATRte_Rate " & _
            " From AdMsVATRates " & _
            " Where VAT_Code =" & Utils.enQuoteString(Code) & _
            " AND VATRte_EffectiveDate <= " & Utils.enQuoteString(EffectDate) & _
            " order by VATRte_EffectiveDate desc"

        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Rate = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        Else
            Rate = 0
        End If

        Return Rate
    End Function
    Protected Function GetJournalEntriesWithUnAllocBalance(ByVal BusPrtCode As String, ByVal DebitORCredit As String) As DataSet
        Dim Str As String

        Str = "SELECT AccLin_Id," & _
              " AccLin_JouNo," & _
              " AccLin_DocDate," & _
              " AccLin_UnAllocBalanceLC," & _
              " Cur_AlphaCode," & _
              " AccLin_UnAllocBalanceTC," & _
              " 0 AS Selected," & _
              " '0.00' AS Amount" & _
              " FROM  FiTxAccountLines" & _
              " WHERE (BusPrt_Code = " & enQuoteString(BusPrtCode) & ")" & _
              " AND AccLin_DrCr = " & enQuoteString(DebitORCredit) & _
              " AND AccLin_UnAllocBalanceTC <> 0 "

        Return GetData(Str)
    End Function
    Protected Function GetPeriodCode(ByVal PeriodDate As Date) As String
        Dim Str As String
        Dim PeriodCode As String
        Dim Date1 As String = Format(PeriodDate, "yyyy-MM-dd")
        Date1 = Utils.ChangeDateFormatForSearch(Date1)
        Str = "SELECT Prd_Code" & _
               " FROM   AdMsPeriods" & _
               " WHERE " & enQuoteString(Date1) & _
               " BETWEEN Prd_From AND Prd_To"
        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            PeriodCode = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        Else
            PeriodCode = ""
        End If
        Return PeriodCode
    End Function
    Protected Function SearchForBudget(ByVal Code As String, ByVal Description As String, ByVal SearchCode As String, ByVal Nextorprevius As String, ByVal PreviusSearchCode As String, ByVal ActiveOnly As Boolean) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""


        Code = Code & "%"
        Description = Description & "%"



        Str = "SELECT   TOP(15)  Bud_Code," & _
        " Bud_DescriptionL " & _
        " FROM FiMsBudget " & _
        " WHERE (Bud_Code LIKE " & enQuoteString(Code) & ")" & _
        " AND ((Bud_DescriptionL LIKE " & enQuoteString(Description) & ")" & _
        " OR (Bud_DescriptionS LIKE " & enQuoteString(Description) & "))"

        If ActiveOnly Then
            Str2 = " AND (Bud_IsActive='A')"
        End If

        Str = Str & Str2

        If Nextorprevius = 1 Then
            Str3 = " AND Bud_Code>" & enQuoteString(SearchCode) & _
            " ORDER BY Bud_Code"
        Else
            Str3 = " AND Bud_Code>=" & enQuoteString(SearchCode) & _
            " AND Bud_Code<=" & enQuoteString(PreviusSearchCode) & _
        " ORDER BY Bud_Code"
        End If
        Str = Str & Str3

        Return GetData(Str)

    End Function
    Protected Function GetAllFiTxAccountLinesFromId(ByVal IdFrom As Integer, ByVal IdTo As Integer) As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " AccLin_Id," & _
            " JouCod_Code," & _
            " AccLin_JouNo," & _
            " AccLin_JouLineNo," & _
            " AccLin_DocRef," & _
            " AccLin_AltRef," & _
            " AccLin_DocDate," & _
            " AccLin_PostDate," & _
            " AccLin_DueDate," & _
            " Prd_Code," & _
            " Acc_Code," & _
            " BusPrt_Code," & _
            " AccLin_DrCr," & _
            " AccLin_AmountLocCur," & _
            " Cur_AlphaCode," & _
            " AccLin_AmountTrxCur," & _
            " AccLin_CurRate," & _
            " AccLin_TrxCurDecimal," & _
            " AcLAn1_Code," & _
            " AcLAn2_Code," & _
            " AcLAn3_Code," & _
            " AcLAn4_Code," & _
            " AcLAn5_Code," & _
            " AcLAn6_Code," & _
            " AcLAn7_Code," & _
            " AcLAn8_Code," & _
            " AcLAn9_Code," & _
            " AcLAn10_Code," & _
            " AccLin_AllocStatus," & _
            " AccLin_AllocRef," & _
            " AccLin_UnAllocBalanceLC," & _
            " AccLin_UnAllocBalanceTC," & _
            " AccLin_AllocDate," & _
            " AccLin_AllocPeriod," & _
            " AccLin_Comment," & _
            " AccLin_ExternalRef," & _
            " AccLin_Module," & _
            " AccLin_ModRef," & _
            " AccLin_CreationDate," & _
            " AccLin_AmendDate," & _
            " AccLin_CreatedBy," & _
            " AccLin_AmendBy" & _
            " FROM FiTxAccountLines" & _
            " WHERE AccLin_Id >=" & IdFrom & _
            " And AccLin_Id <=" & IdTo
        Return GetData(Str)
    End Function
    Protected Function GetFiTxAccountLinesLastIdSend() As Long
        Dim Str As String
        Dim LastId As String = 0
        Dim Ds As DataSet
        Str = " SELECT TOP(1)" & _
            " Bat_ToId " & _
            " FROM AaSsInterfaceToNodal Order By Bat_Id DESC"
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            LastId = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If

        Return CLng(LastId)
    End Function
    Protected Function GetFiTxAccountLinesMaxId() As Long
        Dim Str As String
        Dim MaxId As String = 0
        Dim Ds As DataSet

        Str = "Select Max(AccLin_Id) " & _
            " FROM FiTxAccountLines"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            MaxId = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return CLng(MaxId)
    End Function
    Protected Function GetInterfaceToNodalHistory() As DataSet
        Dim Str As String
        Str = "SELECT AaSsInterfaceToNodal.Bat_Id," & _
             " AaSsInterfaceToNodal.Bat_FromID," & _
             " AaSsInterfaceToNodal.Bat_ToID," & _
             " AaSsInterfaceToNodal.Bat_CreationTimes," & _
             " AaSsInterfaceToNodal.Bat_CreationDate," & _
             " AaSsUsers_1.Usr_UserName AS CreatedBy," & _
             " AaSsInterfaceToNodal.Bat_UpdateDate," & _
             " AaSsUsers.Usr_UserName AS UpdatedBy" & _
             " FROM  AaSsInterfaceToNodal INNER JOIN AaSsUsers ON" & _
             " AaSsInterfaceToNodal.Bat_UpdatedBy = AaSsUsers.Usr_Id INNER JOIN" & _
             " AaSsUsers AS AaSsUsers_1 ON" & _
             " AaSsInterfaceToNodal.Bat_CreatedBy = AaSsUsers_1.Usr_Id" & _
             " ORDER BY AaSsInterfaceToNodal.Bat_Id DESC"
        Return MyBase.GetData(Str)
    End Function
    Protected Function SearchForCustomer(ByVal Code As String, ByVal Description As String, ByVal Address As String, ByVal Phone As String, ByVal SearchCode As String, ByVal Nextorprevius As String, ByVal PreviusSearchCode As String, ByVal CustomerOnly As Boolean, ByVal SuplierOnly As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String
        Dim Str3 As String = ""
        Dim Str4 As String = ""
        Dim Str5 As String = ""

        Code = Code & "%"
        Description = Description & "%"
        Address = Address & "%"
        Phone = Phone & "%"


        Str = "SELECT   TOP(20)  AdMsBusinessPartner.BusPrt_Code," & _
        " AdMsBusinessPartner.BusPrt_DescriptionL, " & _
        " AdMsBusinessPartner.BusPrt_DescriptionS, " & _
        " AdMsAddress.Adr_Line1, " & _
        " AdMsAddress.Adr_Line2, " & _
        " AdMsAddress.Adr_Line3, " & _
        " AdMsAddress.Adr_Line4, " & _
        " AdMsAddress.Adr_Telephone1, " & _
        " AdMsAddress.Adr_Telephone2, " & _
        " AdMsAddress.Adr_Id" & _
        " FROM AdMsAddress RIGHT OUTER JOIN" & _
        " AdMsBusinessPartner ON " & _
        " AdMsAddress.Adr_Id = AdMsBusinessPartner.Adr_Id1" & _
        " OR AdMsAddress.Adr_Id = AdMsBusinessPartner.Adr_Id2" & _
        " OR AdMsAddress.Adr_Id = AdMsBusinessPartner.Adr_Id3" & _
        " WHERE   (AdMsBusinessPartner.BusPrt_Code LIKE " & enQuoteString(Code) & ")" & _
        " AND ((AdMsBusinessPartner.BusPrt_DescriptionL LIKE " & enQuoteString(Description) & ")" & _
        " OR (AdMsBusinessPartner.BusPrt_DescriptionS LIKE " & enQuoteString(Description) & "))"

        If CustomerOnly Then
            Str5 = " AND (AdMsBusinessPartner.BPtTyp_Code='C' OR AdMsBusinessPartner.BPtTyp_Code='B')"
        End If
        If SuplierOnly Then
            Str5 = " AND (AdMsBusinessPartner.BPtTyp_Code='S' OR AdMsBusinessPartner.BPtTyp_Code='B')"
        End If


        If Address <> "%" Then
            Str3 = " AND ((AdMsAddress.Adr_Line1 LIKE " & enQuoteString(Address) & ")" & _
            " OR (AdMsAddress.Adr_Line2 LIKE " & enQuoteString(Address) & ")" & _
            " OR (AdMsAddress.Adr_Line3 LIKE " & enQuoteString(Address) & ")" & _
            " OR (AdMsAddress.Adr_Line4 LIKE " & enQuoteString(Address) & "))"
        End If
        If Phone <> "%" Then
            Str4 = " AND( (AdMsAddress.Adr_Telephone1 LIKE " & enQuoteString(Phone) & ")" & _
            " OR (AdMsAddress.Adr_Telephone2 LIKE " & enQuoteString(Phone) & "))"
        End If

        Str = Str & Str5 & Str3 & Str4
        If Nextorprevius = 1 Then
            Str2 = " AND AdMsBusinessPartner.BusPrt_Code>" & enQuoteString(SearchCode) & _
            " ORDER BY AdMsBusinessPartner.BusPrt_Code"
        Else
            Str2 = " AND AdMsBusinessPartner.BusPrt_Code>=" & enQuoteString(SearchCode) & _
            " AND AdMsBusinessPartner.BusPrt_Code<=" & enQuoteString(PreviusSearchCode) & _
        " ORDER BY AdMsBusinessPartner.BusPrt_Code"
        End If
        Str = Str & Str2

        Return GetData(Str)

    End Function



#End Region

#Region "Payroll"



    Protected Function GetAllPrMsTemplateGroup() As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " TemGrp_Code," & _
            " PayTyp_Code," & _
            " TemGrp_DescriptionL," & _
            " TemGrp_DescriptionS," & _
            " TemGrp_IsActive," & _
            " TemGrp_DayUnits, " & _
            " TemGrp_GLAnl1, " & _
            " TemGrp_GLAnl2, " & _
            " Com_Code" & _
            " FROM PrMsTemplateGroup" & _
            " Where TemGrp_IsActive='Y'"

        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsTemplateGroupOfUser(ByVal UserCode As String) As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " TemGrp_Code," & _
            " PayTyp_Code," & _
            " TemGrp_DescriptionL," & _
            " TemGrp_DescriptionS," & _
            " TemGrp_IsActive," & _
            " TemGrp_DayUnits, " & _
            " TemGrp_GLAnl1, " & _
            " TemGrp_GLAnl2, " & _
            " PrMsTemplateGroup.Com_Code" & _
            " FROM PrMsTemplateGroup" & _
            " PrMsTemplateGroup INNER JOIN" & _
            " PrSsCompanyUsers ON PrMsTemplateGroup.Com_Code = PrSsCompanyUsers.Com_Code " & _
            " WHERE     (PrMsTemplateGroup.TemGrp_IsActive = 'Y')" & _
            " AND (PrSsCompanyUsers.Usr_UserName = " & enQuoteString(UserCode) & ")"

        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsContributionCodes() As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " ConCod_Code," & _
            " ConTyp_Code," & _
            " ConCod_DescriptionL," & _
            " ConCod_DescriptionS," & _
            " ConCod_IsActive" & _
            " FROM PrMsContributionCodes" & _
            " Where ConCod_IsActive='Y'"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsDeductionCodes() As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " DedCod_Code," & _
            " DedTyp_Code," & _
            " DedCod_DescriptionL," & _
            " DedCod_DescriptionS," & _
            " DedCod_IsActive" & _
            " FROM PrMsDeductionCodes" & _
            " Where DedCod_IsActive='Y'"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsEarningCodes() As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " ErnCod_Code," & _
            " ErnTyp_Code," & _
            " ErnCod_DescriptionL," & _
            " ErnCod_DescriptionS," & _
            " ErnCod_IsActive" & _
            " FROM PrMsEarningCodes" & _
            " Where ErnCod_IsActive='Y'"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsTemplateContributions(ByVal TemplateGroupCode As String) As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " TemCon_id," & _
            " TemGrp_Code," & _
            " ConCod_Code," & _
            " TemCon_DisplayName," & _
            " TemCon_IsDispalyed," & _
            " TemCon_Sequence," & _
            " TemCon_TypeMode," & _
            " TemCon_FromMode," & _
            " TemCon_CreationDate," & _
            " TemCon_CalcFormula," & _
            " TemCon_CreatedBy," & _
            " TemCon_AmendDate," & _
            " TemCon_AmendBy," & _
            " TemCon_NavCreditAccount," & _
            " TemCon_NavDebitAccount, " & _
            " TemCon_ReportingSequence " & _
            " FROM PrMsTemplateContributions" & _
            " Where TemGrp_Code=" & enQuoteString(TemplateGroupCode) & _
            " Order by TemCon_Sequence Asc"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsTemplateDeductions(ByVal TemplateGroupCode As String) As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " TemDed_id," & _
            " TemGrp_Code," & _
            " DedCod_Code," & _
            " TemDed_DisplayName," & _
            " TemDed_IsDispalyed," & _
            " TemDed_Sequence," & _
            " TemDed_TypeMode," & _
            " TemDed_FromMode," & _
            " TemDed_CreationDate," & _
            " TemDed_CalcFormula," & _
            " TemDed_CreatedBy," & _
            " TemDed_AmendDate," & _
            " TemDed_AmendBy," & _
            " TemDed_NavCreditAccount," & _
            " TemDed_NavDebitAccount, " & _
            " TemDed_ReportingSequence " & _
            " FROM PrMsTemplateDeductions " & _
            " Where TemGrp_Code=" & enQuoteString(TemplateGroupCode) & _
            " Order by TemDed_Sequence Asc"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsTemplateEarnings(ByVal TemplateGroupCode As String) As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " TemErn_id," & _
            " TemGrp_Code," & _
            " ErnCod_Code," & _
            " TemErn_DisplayName," & _
            " TemErn_IsDispalyed," & _
            " TemErn_Sequence," & _
            " TemErn_TypeMode," & _
            " TemErn_FromMode," & _
            " TemErn_CalcFormula," & _
            " TemErn_CreationDate," & _
            " TemErn_CreatedBy," & _
            " TemErn_AmendDate," & _
            " TemErn_AmendBy," & _
            " TemErn_NavCreditAccount," & _
            " TemErn_NavDebitAccount, " & _
            " TemErn_ReportingSequence " & _
            " FROM PrMsTemplateEarnings" & _
            " Where TemGrp_Code=" & enQuoteString(TemplateGroupCode) & _
            " Order by TemErn_Sequence Asc"
        Return GetData(Str)
    End Function
    Protected Function DeleteEarnigsFromTemplateEarnings(ByVal GroupCode As String, ByVal EarnCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True
        Str = "Delete From PrMsTemplateEarnings Where " & _
        " TemGrp_Code=" & enQuoteString(GroupCode) & _
        " AND ErnCod_Code=" & enQuoteString(EarnCode)
        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function DeleteDeductionsFromTemplateDeductions(ByVal GroupCode As String, ByVal DeduCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True
        Str = "Delete From PrMsTemplateDeductions Where " & _
        " TemGrp_Code=" & enQuoteString(GroupCode) & _
        " AND DedCod_Code=" & enQuoteString(DeduCode)
        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function DeleteContributionsFromTemplateContributions(ByVal GroupCode As String, ByVal ContCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True
        Str = "Delete From PrMsTemplateContributions Where " & _
        " TemGrp_Code=" & enQuoteString(GroupCode) & _
        " AND ConCod_Code=" & enQuoteString(ContCode)
        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    ''
    Protected Function DeleteEarnigsFromEmployeeEarnings(ByVal GroupCode As String, ByVal EarnCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True
        Str = "Delete From PrMsEmployeeEarnings Where " & _
        " TemGrp_Code=" & enQuoteString(GroupCode) & _
        " AND ErnCod_Code=" & enQuoteString(EarnCode)
        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function DeleteDeductionsFromEmployeeDeductions(ByVal GroupCode As String, ByVal DeduCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True
        Str = "Delete From PrMsEmployeeDeductions Where " & _
        " TemGrp_Code=" & enQuoteString(GroupCode) & _
        " AND DedCod_Code=" & enQuoteString(DeduCode)
        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function DeleteContributionsFromEmployeeContributions(ByVal GroupCode As String, ByVal ContCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True
        Str = "Delete From PrMsEmployeeContributions Where " & _
        " TemGrp_Code=" & enQuoteString(GroupCode) & _
        " AND ConCod_Code=" & enQuoteString(ContCode)
        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    ''
    Protected Function DeleteEarnigsFromInterfaceEarnings(ByVal GroupCode As String, ByVal EarnCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True
        Str = "Delete From PrMsEarningsInterface Where " & _
        " TemGrp_Code=" & enQuoteString(GroupCode) & _
        " AND ErnCod_Code=" & enQuoteString(EarnCode)
        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function DeleteDeductionsFromInterfaceDeductions(ByVal GroupCode As String, ByVal DeduCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True
        Str = "Delete From PrMsDeductionsInterface Where " & _
        " TemGrp_Code=" & enQuoteString(GroupCode) & _
        " AND DedCod_Code=" & enQuoteString(DeduCode)
        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function DeleteContributionsFromInterfaceContributions(ByVal GroupCode As String, ByVal ContCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True
        Str = "Delete From PrMsContributionsInterface Where " & _
        " TemGrp_Code=" & enQuoteString(GroupCode) & _
        " AND ConCod_Code=" & enQuoteString(ContCode)
        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    ''
    Protected Function GetAllPrSsSocialInsPeriods() As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " SinPrd_Code," & _
            " SinPrd_DescriptionL," & _
            " SinPrd_DescriptionS" & _
            " FROM PrSsSocialInsPeriods" & _
            " Order by SinPrd_Code Asc"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrSsPaymentCategory() As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " PayCat_Code," & _
            " PayCat_DescriptionL," & _
            " PayCat_DescriptionS," & _
            " PayCat_IsActive," & _
            " PayCat_Sequence" & _
            " FROM PrSsPaymentCategory"
        Return GetData(Str)
    End Function

    Protected Function GetAllPrMsPeriodGroups() As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " PrdGrp_Code," & _
            " PrdGrp_Status," & _
            " PrdGpr_Year," & _
            " TemGrp_Code," & _
            " PrdGrp_DescriptionL" & _
            " FROM PrMsPeriodGroups " & _
            " Order By PrdGrp_Code Asc"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsPeriodGroupsOfUser(ByVal UserCode As String, ByVal ShowAllYears As Boolean, ByVal CurrentYear As String) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""
        Str = "SELECT PrMsPeriodGroups.PrdGrp_Code, " & _
        " PrMsPeriodGroups.PrdGrp_Status," & _
        " PrMsPeriodGroups.PrdGpr_Year," & _
        " PrMsPeriodGroups.TemGrp_Code, " & _
        " PrMsPeriodGroups.PrdGrp_DescriptionL" & _
        " FROM  PrMsPeriodGroups INNER JOIN" & _
        " PrMsTemplateGroup ON PrMsPeriodGroups.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN" & _
        " PrSsCompanyUsers ON PrMsTemplateGroup.Com_Code = PrSsCompanyUsers.Com_Code" & _
        " WHERE (PrSsCompanyUsers.Usr_UserName = " & enQuoteString(UserName) & ")" & _
        " AND PrMsTemplateGroup.TemGrp_IsActive ='Y'"
        If Not ShowAllYears Then
            Str2 = " AND PrdGpr_Year =" & enQuoteString(CurrentYear)
        End If
        Str = Str & Str2

        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsPeriodsByPeriodGroup(ByVal PeriodGroup As String) As DataSet
        Dim Str As String
        Str = "SELECT PrdCod_Code," & _
            " PrdGrp_Code," & _
            " PrdCod_Number," & _
            " PrdCod_Status," & _
            " PrdCod_DescriptionL," & _
            " PrdCod_DescriptionS," & _
            " PrdCod_Sequence," & _
            " SinPrd_Code," & _
            " PrdCod_DateFrom," & _
            " PrdCod_DateTo," & _
            " PrdCod_PeriodUnits, " & _
            " PayCat_Code," & _
            " PrdCod_PeriodUnits2 " & _
            " FROM PrMsPeriodCodes" & _
            " WHERE (PrdGrp_Code = " & enQuoteString(PeriodGroup) & ")" & _
            " ORDER BY PrdCod_Sequence"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsPeriodContributions(ByVal PeriodCode As String, ByVal PeriodGroupCode As String, ByVal OnlyActive As Boolean, ByVal OrderByEDCSequence As Boolean) As DataSet
        Dim Str As String
        If Not OrderByEDCSequence Then
            Dim Str2 As String = ""
            Str = " SELECT PrdCon_id," & _
            " PrdCod_Code," & _
            " Prdgrp_Code," & _
            " ConCod_Code," & _
            " PrdCon_IsActive" & _
            " FROM  PrMsPeriodContributions " & _
            " Where PrdCod_Code=" & enQuoteString(PeriodCode) & _
            " AND PrdGrp_Code=" & enQuoteString(PeriodGroupCode)
            If OnlyActive Then
                Str2 = " AND PrdCon_IsActive='Y'"
            End If
            Str = Str & Str2
        Else
            Str = "select Temcon_id,TemGrp_Code,Temcon_DisplayName ,ConCod_Code   from PrMsTemplateContributions " & _
            " where TemGrp_Code in " & _
            " (select TemGrp_Code from PrMsPeriodGroups where PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")" & _
            " and ConCod_Code in" & _
            " (select ConCod_Code from PrMsPeriodCodes where PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & " and PrdCod_Code = " & enQuoteString(PeriodCode) & ")" & _
            " order by Temcon_ReportingSequence asc"

        End If
        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsPeriodDeductions(ByVal PeriodCode As String, ByVal PeriodGroupCode As String, ByVal OnlyActive As Boolean, ByVal OrderByEDCSequence As Boolean) As DataSet
        Dim Str As String
        If Not OrderByEDCSequence Then

            Dim Str2 As String = ""
            Str = " SELECT PrdDed_id," & _
            " PrdCod_Code," & _
            " PrdGrp_Code," & _
            " DedCod_Code," & _
            " PrdDed_IsActive" & _
            " FROM  PrMsPeriodDeductions " & _
            " Where PrdCod_Code=" & enQuoteString(PeriodCode) & _
            " AND PrdGrp_Code=" & enQuoteString(PeriodGroupCode)
            If OnlyActive Then
                Str2 = " AND PrdDed_IsActive='Y'"
            End If
            Str = Str & Str2
        Else

            Str = "select TemDed_id,TemGrp_Code,TemDed_DisplayName ,DedCod_Code   from PrMsTemplateDeductions " & _
            " where TemGrp_Code in " & _
            " (select TemGrp_Code from PrMsPeriodGroups where PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")" & _
            " and DedCod_Code in" & _
            " (select DedCod_Code from PrMsPeriodCodes where PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & " and PrdCod_Code = " & enQuoteString(PeriodCode) & ")" & _
            " order by TemDed_ReportingSequence asc"

        End If
        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsPeriodEarnings(ByVal PeriodCode As String, ByVal PeriodGroupCode As String, ByVal OnlyActive As Boolean, ByVal OrderByEDCSequence As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        If Not OrderByEDCSequence Then

            Str = " SELECT PrdErn_id," & _
              " PrdCod_Code," & _
              " PrdGrp_Code," & _
              " ErnCod_Code," & _
              " PrdErn_IsActive" & _
              " FROM  PrMsPeriodEarnings" & _
              " Where PrdCod_Code=" & enQuoteString(PeriodCode) & _
              " AND PrdGrp_Code=" & enQuoteString(PeriodGroupCode)
            If OnlyActive Then
                Str2 = " AND PrdErn_IsActive='Y'"
            End If

            Str = Str & Str2

        Else
            Str = "select TemErn_id,TemGrp_Code,TemErn_DisplayName ,ErnCod_Code,TemErn_ReportingSequence   from PrMsTemplateEarnings " & _
            " where TemGrp_Code in " & _
            " (select TemGrp_Code from PrMsPeriodGroups where PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")" & _
            " and ErnCod_Code in" & _
            " (select ErnCod_Code from PrMsPeriodCodes where PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & " and PrdCod_Code = " & enQuoteString(PeriodCode) & ")" & _
            " order by TemErn_ReportingSequence asc"
        End If
        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsPeriodEarningsOrderBySeq(ByVal PeriodCode As String, ByVal PeriodGroupCode As String, ByVal OnlyActive As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Str = " SELECT PrMsPeriodEarnings.PrdErn_id," & _
          " PrMsPeriodEarnings.PrdCod_Code," & _
          " PrMsPeriodEarnings.PrdGrp_Code," & _
          " PrMsPeriodEarnings.ErnCod_Code," & _
          " PrMsPeriodEarnings.PrdErn_IsActive" & _
          " FROM  PrMsPeriodEarnings " & _
          " INNER Join " & _
          " PrMsPeriodGroups ON PrMsPeriodEarnings.PrdGrp_Code = PrMsPeriodGroups.PrdGrp_Code INNER JOIN " & _
          " PrMsTemplateGroup ON PrMsPeriodGroups.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN " & _
          " PrMsTemplateEarnings ON PrMsTemplateGroup.TemGrp_Code = PrMsTemplateEarnings.TemGrp_Code " & _
          " Where PrMsPeriodEarnings.PrdCod_Code=" & enQuoteString(PeriodCode) & _
          " AND PrMsPeriodEarnings.PrdGrp_Code=" & enQuoteString(PeriodGroupCode)
        If OnlyActive Then
            Str2 = " AND PrMsPeriodEarnings.PrdErn_IsActive='Y'"
        End If
        Str3 = " ORDER BY PrMsTemplateEarnings.TemErn_Sequence "

        Str = Str & Str2 & Str3
        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsPeriodDeductionsOrderBySeq(ByVal PeriodCode As String, ByVal PeriodGroupCode As String, ByVal OnlyActive As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Str = " SELECT PrMsPeriodDeductions.PrdDed_id," & _
        " PrMsPeriodDeductions.PrdCod_Code," & _
        " PrMsPeriodDeductions.PrdGrp_Code," & _
        " PrMsPeriodDeductions.DedCod_Code," & _
        " PrMsPeriodDeductions.PrdDed_IsActive" & _
        " FROM  PrMsPeriodDeductions " & _
        " INNER Join " & _
        " PrMsPeriodGroups ON PrMsPeriodDeductions.PrdGrp_Code = PrMsPeriodGroups.PrdGrp_Code INNER JOIN " & _
        " PrMsTemplateGroup ON PrMsPeriodGroups.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN " & _
        " PrMsTemplateDeductions ON PrMsTemplateGroup.TemGrp_Code = PrMsTemplateDeductions.TemGrp_Code " & _
        " Where PrMsPeriodDeductions.PrdCod_Code=" & enQuoteString(PeriodCode) & _
        " AND PrMsPeriodDeductions.PrdGrp_Code=" & enQuoteString(PeriodGroupCode)
        If OnlyActive Then
            Str2 = " AND PrMsPeriodDeductions.PrdDed_IsActive='Y'"
        End If
        Str3 = " ORDER BY PrMsTemplateDeductions.TemDed_Sequence "
        Str = Str & Str2 & str3

        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsPeriodContributionsOrderBySeq(ByVal PeriodCode As String, ByVal PeriodGroupCode As String, ByVal OnlyActive As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String
        Str = " SELECT PrMsPeriodContributions.PrdCon_id," & _
        " PrMsPeriodContributions.PrdCod_Code," & _
        " PrMsPeriodContributions.Prdgrp_Code," & _
        " PrMsPeriodContributions.ConCod_Code," & _
        " PrMsPeriodContributions.PrdCon_IsActive" & _
        " FROM  PrMsPeriodContributions " & _
         " INNER Join " & _
        " PrMsPeriodGroups ON PrMsPeriodContributions.PrdGrp_Code = PrMsPeriodGroups.PrdGrp_Code INNER JOIN " & _
        " PrMsTemplateGroup ON PrMsPeriodGroups.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN " & _
        " PrMsTemplateContributions ON PrMsTemplateGroup.TemGrp_Code = PrMsTemplateContributions.TemGrp_Code " & _
        " Where PrMsPeriodContributions.PrdCod_Code=" & enQuoteString(PeriodCode) & _
        " AND PrMsPeriodContributions.PrdGrp_Code=" & enQuoteString(PeriodGroupCode)
        If OnlyActive Then
            Str2 = " AND PrMsPeriodContributions.PrdCon_IsActive='Y'"
        End If
        Str3 = " ORDER BY PrMsTemplateContributions.TemCon_Sequence "
        Str = Str & Str2 & str3

        Return GetData(Str)
    End Function

    Protected Function GetAllPrMsTemplateEarningsByTemplateGroup(ByVal TempGroup As String) As DataSet
        Dim str As String
        str = "SELECT 0 Id," & _
            " PrMsTemplateEarnings.ErnCod_Code," & _
            " PrMsEarningCodes.ErnCod_DescriptionL," & _
            " '0' IsActive " & _
            " FROM  PrMsTemplateEarnings INNER JOIN" & _
            " PrMsEarningCodes ON " & _
            " PrMsTemplateEarnings.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            " WHERE (PrMsTemplateEarnings.TemGrp_Code = " & enQuoteString(TempGroup) & ")"
        Return GetData(str)
    End Function
    Protected Function GetAllPrMsTemplateDeductionsByTemplateGroup(ByVal TempGroup As String) As DataSet
        Dim str As String
        str = "SELECT 0 Id," & _
            " PrMsTemplateDeductions.DedCod_Code," & _
            " PrMsDeductionCodes.DedCod_DescriptionL," & _
            " '0' IsActive " & _
            " FROM  PrMsTemplateDeductions INNER JOIN" & _
            " PrMsDeductionCodes ON " & _
            " PrMsTemplateDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
            " WHERE (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TempGroup) & ")"
        Return GetData(str)
    End Function
    Protected Function GetAllPrMsTemplateContributionsByTemplateGroup(ByVal TempGroup As String) As DataSet
        Dim str As String
        str = "SELECT 0 Id," & _
            " PrMsTemplateContributions.ConCod_Code," & _
            " PrMsContributionCodes.ConCod_DescriptionL," & _
            " '0' IsActive " & _
            " FROM  PrMsTemplateContributions INNER JOIN" & _
            " PrMsContributionCodes ON " & _
            " PrMsTemplateContributions.ConCod_Code = PrMsContributionCodes.ConCod_Code" & _
            " WHERE (PrMsTemplateContributions.TemGrp_Code = " & enQuoteString(TempGroup) & ")"
        Return GetData(str)
    End Function
    Protected Function DeletePrmsPeriodEarnings(ByVal PeriodCode As String, ByVal GroupCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True

        Str = "Delete From PrMsPeriodEarnings " & _
        " Where PrdCod_Code=" & enQuoteString(PeriodCode) & _
        " AND PrdGrp_code=" & enQuoteString(GroupCode)



        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function DeletePrmsPeriodDeductions(ByVal PeriodCode As String, ByVal GroupCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True

        Str = "Delete From PrMsPeriodDeductions " & _
        " Where PrdCod_Code=" & enQuoteString(PeriodCode) & _
        " AND PrdGrp_code=" & enQuoteString(GroupCode)

        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function DeletePrmsPeriodContributions(ByVal PeriodCode As String, ByVal GroupCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True

        Str = "Delete From PrMsPeriodContributions " & _
        " Where PrdCod_Code=" & enQuoteString(PeriodCode) & _
        " AND PrdGrp_code=" & enQuoteString(GroupCode)

        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function DeletePrmsPeriodCode(ByVal PeriodCode As String, ByVal GroupCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True

        Str = "Delete From PrMsPeriodCodes " & _
        " Where PrdCod_Code=" & enQuoteString(PeriodCode) & _
        " AND PrdGrp_Code=" & enQuoteString(GroupCode)

        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function SearchForEmployee(ByVal Code As String, ByVal Description As String, ByVal SearchCode As String, ByVal Nextorprevius As String, ByVal PreviusSearchCode As String, ByVal ActiveOnly As Boolean, ByVal TempGroup As String) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""


        Code = Code & "%"
        Description = "%" & Description & "%"


        Str = "SELECT   TOP(15) Emp_Code," & _
        " Emp_FullName " & _
        " FROM PrMsEmployees " & _
        " WHERE (Emp_Code LIKE " & enQuoteString(Code) & ")" & _
        " AND ((Emp_FullName LIKE " & enQuoteString(Description) & "))"
        If TempGroup <> "" Then
            Str4 = " AND TemGrp_Code=" & enQuoteString(TempGroup)
        End If
        If ActiveOnly Then
            Str2 = " AND (Emp_Status='A')"
        End If

        Str = Str & Str2 & Str4

        If Nextorprevius = 1 Then
            Str3 = " AND Emp_Code>" & enQuoteString(SearchCode) & _
            " ORDER BY Emp_Code"
        Else
            Str3 = " AND Emp_Code>=" & enQuoteString(SearchCode) & _
            " AND Emp_Code<=" & enQuoteString(PreviusSearchCode) & _
        " ORDER BY Emp_Code"
        End If
        Str = Str & Str3

        Return GetData(Str)

    End Function
    Protected Function SearchForEmployeeByUser(ByVal Code As String, ByVal Description As String, ByVal SearchCode As String, ByVal Nextorprevius As String, ByVal PreviusSearchCode As String, ByVal ActiveOnly As Boolean, ByVal TempGroup As String, ByVal UserCode As String, ByVal OnlyNew As Boolean, ByVal SI As String, ByVal ID As String, ByVal TIC As String, ByVal ARC As String, ByVal SICat As String, ByVal NoSI As Boolean, ByVal Phone As String) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""


        Code = "%" & Code & "%"
        Description = "%" & Description & "%"


        Str = "SELECT   TOP(15) Emp_Code," & _
        " Emp_FullName," & _
        " PrMsTemplateGroup.TemGrp_DescriptionL, " & _
        " Emp_Status," & _
        " Emp_StartDate," & _
        " Emp_TerminateDate " & _
        " FROM PrMsEmployees " & _
        " INNER JOIN" & _
        " PrMsTemplateGroup ON PrMsEmployees.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN" & _
        " PrSsCompanyUsers ON PrMsTemplateGroup.Com_Code = PrSsCompanyUsers.Com_Code" & _
        " WHERE (Emp_Code LIKE " & enQuoteString(Code) & ")" & _
        " AND (PrSsCompanyUsers.Usr_UserName=" & enQuoteString(UserCode) & ")" & _
        " AND ((Emp_FullName LIKE N" & enQuoteString(Description) & "))"

        If TempGroup <> "" Then
            Str4 = " AND PrMsEmployees.TemGrp_Code=" & enQuoteString(TempGroup)

        End If
        If ActiveOnly Then
            Str2 = " AND (Emp_Status='A')"
        End If
        Dim str22 As String = ""
        If OnlyNew Then
            str22 = " AND (Emp_NewEmployee='1')"
        End If

        Dim StrN1 As String = ""
        Dim StrN2 As String = ""
        Dim StrN3 As String = ""
        Dim StrN4 As String = ""
        Dim StrN5 As String = ""
        Dim StrN6 As String = ""


        If SI <> "" Then
            SI = "%" & SI & "%"
            StrN1 = " And Emp_SocialInsNumber like " & enQuoteString(SI)
        End If
        If NoSI Then
            StrN1 = " And Emp_SocialInsNumber ='' "
        End If
        If ID <> "" Then
            ID = "%" & ID & "%"
            StrN2 = " And Emp_IdentificationCard like " & enQuoteString(ID)
        End If
        If TIC <> "" Then
            TIC = "%" & TIC & "%"
            StrN3 = " And Emp_TaxId like " & enQuoteString(TIC)
        End If
        If ARC <> "" Then
            ARC = "%" & ARC & "%"
            StrN4 = " And Emp_AlienNumber like " & enQuoteString(ARC)
        End If
        If SICat <> "" Then
            StrN5 = " And Sic_Code = " & enQuoteString(SICat)
        End If
        If Phone <> "" Then
            Phone = "%" & Phone & "%"
            StrN6 = " And (Emp_Telephone1 like " & enQuoteString(Phone) & " OR " & " Emp_Telephone2 like " & enQuoteString(Phone) & " )"
        End If


        Str = Str & Str2 & str22 & Str4 & StrN1 & StrN2 & StrN3 & StrN4 & StrN5 & StrN6


        If Nextorprevius = 1 Then
            Str3 = " AND Emp_Code>" & enQuoteString(SearchCode) & _
            " ORDER BY Emp_Code"
        Else
            Str3 = " AND Emp_Code>=" & enQuoteString(SearchCode) & _
            " AND Emp_Code<=" & enQuoteString(PreviusSearchCode) & _
        " ORDER BY Emp_Code"
        End If
        Str = Str & Str3

        Return GetData(Str)

    End Function
    Protected Function SearchForEmployeeByUser2(ByVal Code As String, ByVal Description As String, ByVal SearchCode As String, ByVal Nextorprevius As String, ByVal PreviusSearchCode As String, ByVal ActiveOnly As Boolean, ByVal TempGroup As String, ByVal UserCode As String) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""


        Code = Code & "%"
        Description = "%" & Description & "%"


        Str = "SELECT  1 as Selected, Emp_Code," & _
        " Emp_FullName," & _
        "PrMsTemplateGroup.TemGrp_DescriptionL " & _
        " FROM PrMsEmployees " & _
        " INNER JOIN" & _
        " PrMsTemplateGroup ON PrMsEmployees.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN" & _
        " PrSsCompanyUsers ON PrMsTemplateGroup.Com_Code = PrSsCompanyUsers.Com_Code" & _
        " WHERE (Emp_Code LIKE " & enQuoteString(Code) & ")" & _
        " AND (PrSsCompanyUsers.Usr_UserName=" & enQuoteString(UserCode) & ")" & _
        " AND ((Emp_FullName LIKE " & enQuoteString(Description) & "))"

        If TempGroup <> "" Then
            Str4 = " AND PrMsEmployees.TemGrp_Code=" & enQuoteString(TempGroup)

        End If
        If ActiveOnly Then
            Str2 = " AND (Emp_Status='A')"
        End If

        Str = Str & Str2 & Str4

        If Nextorprevius = 1 Then
            Str3 = " AND Emp_Code>" & enQuoteString(SearchCode) & _
            " ORDER BY Emp_Code"
        Else
            Str3 = " AND Emp_Code>=" & enQuoteString(SearchCode) & _
            " AND Emp_Code<=" & enQuoteString(PreviusSearchCode) & _
        " ORDER BY Emp_Code"
        End If
        Str = Str & Str3

        Return GetData(Str)

    End Function
    Protected Function SearchForEmployeesWithTermDateOfThisPeriod(ByVal TempGroup As String) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""


        Str = "SELECT  1 as Selected, Emp_Code," & _
        " Emp_FullName," & _
        "PrMsTemplateGroup.TemGrp_DescriptionL " & _
        " FROM PrMsEmployees " & _
        " INNER JOIN" & _
        " PrMsTemplateGroup ON PrMsEmployees.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN" & _
        " PrSsCompanyUsers ON PrMsTemplateGroup.Com_Code = PrSsCompanyUsers.Com_Code " & _
        " WHERE  PrMsEmployees.TemGrp_Code = " & enQuoteString(TempGroup) & _
        " AND (Emp_Status='A')" & _
        " AND (Emp_TerminateDate<>'')"

        Return GetData(Str)

    End Function
    Protected Function SearchForOnlyActiveEmployees(ByVal TempGroup As String) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""


        Str = "SELECT  1 as Selected, Emp_Code," & _
        " Emp_FullName," & _
        "PrMsTemplateGroup.TemGrp_DescriptionL " & _
        " FROM PrMsEmployees " & _
        " INNER JOIN" & _
        " PrMsTemplateGroup ON PrMsEmployees.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN" & _
        " PrSsCompanyUsers ON PrMsTemplateGroup.Com_Code = PrSsCompanyUsers.Com_Code " & _
        " WHERE  PrMsEmployees.TemGrp_Code = " & enQuoteString(TempGroup) & _
        " AND (Emp_Status='A')"


        Return GetData(Str)

    End Function




    Protected Function SearchForEmployee2(ByVal Code As String, ByVal Description As String, ByVal ActiveOnly As Boolean) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""


        Code = Code & "%"
        Description = Description & "%"


        Str = "SELECT   1 Selected, Emp_Code," & _
        " Emp_FullName " & _
        " FROM PrMsEmployees " & _
        " WHERE (Emp_Code LIKE " & enQuoteString(Code) & ")" & _
        " AND ((Emp_FullName LIKE " & enQuoteString(Description) & "))"

        If ActiveOnly Then
            Str2 = " AND (Emp_Status='A')"
        End If

        Str = Str & Str2


        Return GetData(Str)

    End Function
    Protected Function GetAllPrTxEmployeeSalaryByEmpCode(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " EmpSal_id," & _
            " Emp_Code," & _
            " EmpSal_Date," & _
            " EmpSal_Value," & _
            " EmpSal_Basic," & _
            " EmpSal_Cola," & _
            " EmpSal_IsCola," & _
            " EmpSal_EffPayDate," & _
            " Usr_Id," & _
            " EmpSal_EffArrearsDate," & _
            " EmpSal_Rate," & _
            " EmpSal_RateSalary " & _
            " FROM PrTxEmployeeSalary" & _
            " Where Emp_Code = " & enQuoteString(EmpCode) & _
            " Order By EmpSal_Date desc"
        Return GetData(Str)
    End Function

    Protected Function GetAllPrTxEmployeeSalaryByEmpCodeforCopy(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT" & _
                 " EmpSal_id," & _
                 " Emp_Code," & _
                 " EmpSal_Date," & _
                 " EmpSal_Value," & _
                 " EmpSal_Basic," & _
                 " EmpSal_EffPayDate," & _
                 " EmpSal_EffArrearsDate," & _
                 " EmpSal_Cola," & _
                 " Usr_Id," & _
                 " EmpSal_IsCola," & _
                 " EmpSal_Dif," & _
                 " EmpSal_Rate," & _
                 " EmpSal_RateSalary " & _
             "  FROM PrTxEmployeeSalary" & _
             " Where Emp_Code = " & enQuoteString(EmpCode) & _
             " Order By EmpSal_Date desc"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrTxEmployeeLeaveByEmpCode(ByVal EmpCode As String) As DataSet



        Dim Str As String
        Str = " SELECT EmpLea_Id," & _
             " EmpLea_Status," & _
             " Emp_Code," & _
             " EmpLea_Type," & _
             " EmpLea_ReqDate," & _
             " EmpLea_ProcDate," & _
             " EmpLea_ProcBy," & _
             " EmpLea_FromDate," & _
             " EmpLea_ToDate," & _
             " EmpLea_Units," & _
             " EmpLea_Action," & _
             " Hdr_Id, " & _
             " EmpLea_Comment," & _
             " EmpLea_ApprovedBy " & _
             " FROM  PrTxEmployeeLeave" & _
             " Where Emp_Code = " & enQuoteString(EmpCode) & _
            " Order By EmpLea_ReqDate desc"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrTxEmployeeLeaveByEmpCodeAndYear(ByVal EmpCode As String, ByVal Year As String) As DataSet
        Dim Str As String
        Dim sFrom As String = Year & "-01-01"
        Dim sTo As String = Year & "-12-31"

        sFrom = Utils.ChangeDateFormatForSearch(sFrom)
        sTo = Utils.ChangeDateFormatForSearch(sTo)



        Str = " SELECT EmpLea_Id," & _
             " EmpLea_Status," & _
             " Emp_Code," & _
             " EmpLea_Type," & _
             " EmpLea_ReqDate," & _
             " EmpLea_ProcDate," & _
             " EmpLea_ProcBy," & _
             " EmpLea_FromDate," & _
             " EmpLea_ToDate," & _
             " EmpLea_Units," & _
             " EmpLea_Action," & _
             " Hdr_Id, " & _
             " EmpLea_Comment," & _
             " EmpLea_ApprovedBy " & _
             " FROM  PrTxEmployeeLeave" & _
             " Where Emp_Code = " & enQuoteString(EmpCode) & _
             " And (EmpLea_FromDate >= " & enQuoteString(sFrom) & _
             " and EmpLea_ToDate <= " & enQuoteString(sTo) & ")" & _
            " Order By EmpLea_ReqDate desc"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrTxEmployeeLeaveByEmpCodeOfYEAR(ByVal EmpCode As String, ByVal YEAR As String, ByVal ALType As String) As DataSet
        Dim Str As String
        Dim FromDate As Date = CDate(YEAR & "-01-01")
        Dim ToDate As Date = CDate(YEAR & "-12-31")


        Dim Dfrom As String = Format(FromDate, "yyyy-MM-dd")
        Dfrom = Utils.ChangeDateFormatForSearch(Dfrom)
        Dim DTo As String = Format(ToDate, "yyyy-MM-dd")
        DTo = Utils.ChangeDateFormatForSearch(DTo)

        Str = " SELECT " & _
             " PrMsEmployees.Emp_FullName, " & _
             " PrMsEmployees.Emp_SocialInsNumber," & _
             " PrMsEmployees.Emp_IdentificationCard, " & _
             " EmpLea_Id, " & _
             " EmpLea_Status, " & _
             " PrTxEmployeeLeave.Emp_Code, " & _
             " EmpLea_Type, " & _
             " EmpLea_ReqDate, " & _
             " EmpLea_ProcDate, " & _
             " EmpLea_ProcBy, " & _
             " EmpLea_FromDate, " & _
             " EmpLea_ToDate, " & _
             " EmpLea_Units, " & _
             " EmpLea_Action, " & _
             " Hdr_Id, " & _
             " 0.00 as Days, " & _
             " 0.00 as TotalUnits, " & _
             " 0.00 as TotalDays, " & _
             " '' as Company, " & _
             " '' as FD, " & _
             " '' as TD, " & _
             " EmpLea_Comment, " & _
             " EmpLea_ApprovedBy " & _
             " FROM  PrTxEmployeeLeave" & _
             " INNER JOIN " & _
             " PrMsEmployees ON PrTxEmployeeLeave.Emp_Code = PrMsEmployees.Emp_Code " & _
             " Where PrTxEmployeeLeave.Emp_Code = " & enQuoteString(EmpCode) & _
             " AND (EmpLea_FromDate >= " & enQuoteString(Dfrom) & ")" & _
            " AND (EmpLea_ToDate <=  " & enQuoteString(DTo) & ")" & _
            " AND (EmpLea_Type= " & enQuoteString(ALType) & ")" & _
            " Order By EmpLea_ReqDate desc"

        Return GetData(Str)
    End Function
    Protected Function GetAllPrTxEmployeeLeaveByEmpCodeForCopy(ByVal EmpCode As String, ByVal FromDate As Date, ByVal ToDate As Date) As DataSet


        Dim Dfrom As String = Format(FromDate, "yyyy-MM-dd")
        Dfrom = Utils.ChangeDateFormatForSearch(Dfrom)
        Dim DTo As String = Format(ToDate, "yyyy-MM-dd")
        DTo = Utils.ChangeDateFormatForSearch(DTo)

        Dim Str As String
        Str = " SELECT EmpLea_Id," & _
             " EmpLea_Status," & _
             " Emp_Code," & _
             " EmpLea_Type," & _
             " EmpLea_ReqDate," & _
             " EmpLea_ProcDate," & _
             " EmpLea_ProcBy," & _
             " EmpLea_FromDate," & _
             " EmpLea_ToDate," & _
             " EmpLea_Units," & _
             " EmpLea_Action," & _
             " Hdr_Id, " & _
             " EmpLea_Comment," & _
             " EmpLea_ApprovedBy " & _
             " FROM  PrTxEmployeeLeave" & _
             " Where Emp_Code = " & enQuoteString(EmpCode) & _
              " AND (EmpLea_FromDate >= " & enQuoteString(Dfrom) & ")" & _
            " AND (EmpLea_ToDate <  " & enQuoteString(DTo) & ")" & _
            " Order By EmpLea_ReqDate desc"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrTxEmployeeAdvancesByEmpCode(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT EmpAdv_Id," & _
             " Emp_Code," & _
             " EmpAdv_Amount," & _
             " EmpAdv_User," & _
             " EmpAdv_Date" & _
             " FROM  PrTxEmployeeAdvances" & _
             " Where Emp_Code = " & enQuoteString(EmpCode) & _
            " Order By Empadv_Date desc"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrTxEmployeeDiscountsByEmpCode(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " EmpDis_id," & _
            " Emp_Code," & _
            " PrdGrp_Code," & _
            " EmpDis_Discount1," & _
            " EmpDis_Discount2," & _
            " EmpDis_Discount3," & _
            " EmpDis_Discount4," & _
            " EmpDis_Discount5," & _
            " EmpDis_Discount6," & _
            " EmpDis_Discount7," & _
            " EmpDis_Discount8," & _
            " EmpDis_Discount9," & _
            " EmpDis_Discount10," & _
            " EmpDis_LifeInsurance," & _
            " Usr_Id," & _
            " EmpDis_CreationDate," & _
            " EmpDis_AmendDate," & _
            " EmpDis_medical, " & _
            " EmpDis_PensionFund " & _
            " FROM PrTxEmployeeDiscounts" & _
            " Where Emp_Code=" & enQuoteString(EmpCode) & _
            " Order By PrdGrp_Code Asc"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsEmployeeContributions(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " EmpCon_Id," & _
            " Emp_Code," & _
            " ConCod_Code," & _
            " EmpCon_Value," & _
            " TemGrp_Code" & _
            " FROM PrMsEmployeeContributions" & _
            " Where Emp_Code=" & enQuoteString(EmpCode)
        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsEmployeeDeductions(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " EmpDed_Id," & _
            " Emp_Code," & _
            " DedCod_Code," & _
            " EmpDed_Value," & _
            " TemGrp_Code" & _
            " FROM PrMsEmployeeDeductions" & _
            " Where Emp_Code=" & enQuoteString(EmpCode)
        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsEmployeeEarnings(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " EmpErn_Id," & _
            " Emp_Code," & _
            " ErnCod_Code," & _
            " EmpErn_Value," & _
            " TemGrp_Code" & _
            " FROM PrMsEmployeeEarnings" & _
            " Where Emp_Code=" & enQuoteString(EmpCode)
        Return GetData(Str)
    End Function
    Protected Function DeleteEmployeeEarnings(ByVal EmpCode As String, ByVal TemGrpCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True

        Str = "Delete From PrMsEmployeeEarnings " & _
        " Where (Emp_Code=" & enQuoteString(EmpCode) & _
        " AND TemGrp_Code<>" & enQuoteString(TemGrpCode) & ")"

        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function DeleteEmployeeDeductions(ByVal EmpCode As String, ByVal TemGrpCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True

        Str = "Delete From PrMsEmployeeDeductions " & _
        " Where (Emp_Code=" & enQuoteString(EmpCode) & _
        " AND TemGrp_Code<>" & enQuoteString(TemGrpCode) & ")"

        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function DeleteEmployeeContributions(ByVal EmpCode As String, ByVal TemGrpCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True

        Str = "Delete From PrMsEmployeeContributions " & _
        " Where (Emp_Code=" & enQuoteString(EmpCode) & _
        " AND TemGrp_Code<>" & enQuoteString(TemGrpCode) & ")"

        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function DeletePeriodEarnings(ByVal PerGrpCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True

        Str = "Delete From PrMsPeriodEarnings " & _
        " Where PrdGrp_Code=" & enQuoteString(PerGrpCode)

        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function DeletePeriodDeductions(ByVal PerGrpCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True

        Str = "Delete From PrMsPeriodDeductions " & _
        " Where PrdGrp_Code=" & enQuoteString(PerGrpCode)

        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function DeletePeriodContributions(ByVal PerGrpCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True

        Str = "Delete From PrMsPeriodContributions " & _
        " Where PrdGrp_Code=" & enQuoteString(PerGrpCode)

        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function FindCurrentPeriod1(ByVal TemGrpCode As String) As DataSet
        Dim str As String
        str = " SELECT PrMsPeriodCodes.PrdCod_Code," & _
            " PrMsPeriodCodes.PrdGrp_Code," & _
            " PrMsPeriodCodes.PrdCod_Number," & _
            " PrMsPeriodCodes.PrdCod_Status, " & _
            " PrMsPeriodCodes.PrdCod_DescriptionL," & _
            " PrMsPeriodCodes.PrdCod_DescriptionS," & _
            " PrMsPeriodCodes.PrdCod_Sequence, " & _
            " PrMsPeriodCodes.SinPrd_Code," & _
            " PrMsPeriodCodes.PrdCod_DateFrom," & _
            " PrMsPeriodCodes.PrdCod_DateTo," & _
            " PrMsPeriodCodes.PrdCod_PeriodUnits," & _
            " PrMsPeriodCodes.PayCat_Code," & _
            " PrMsPeriodCodes.PrdCod_PeriodUnits2," & _
            " PrMsTemplateGroup.TemGrp_Code" & _
            " FROM PrMsPeriodGroups INNER JOIN" & _
            " PrMsTemplateGroup ON " & _
            " PrMsPeriodGroups.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN" & _
            " PrMsPeriodCodes ON " & _
            " PrMsPeriodGroups.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
            " WHERE (PrMsTemplateGroup.TemGrp_Code = " & enQuoteString(TemGrpCode) & ") AND" & _
            " (PrMsPeriodCodes.PrdCod_Status = 'O')"
        Return GetData(str)
    End Function
    Protected Function FindCurrentPeriodMonthNormalDays(ByVal Period As cPrMsPeriodCodes) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim NormalDays As Double = 0
        Str = "Select PrdNrm_WorkDays From PrMsPeriodWorkDays " & _
        " Where PrdGrp_code=" & enQuoteString(Period.PrdGrpCode) & _
        " And PrdCod_Code=" & enQuoteString(Period.Code)

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            NormalDays = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return NormalDays
    End Function
    Protected Function GetCurrentSalary(ByVal EmpCode As String, ByVal CurDate As Date) As cPrTxEmployeeSalary
        Dim Str As String
        Dim Salary As Double = 0
        Dim strCurDate As String
        strCurDate = Format(CurDate, "yyyy-MM-dd")
        ''
        Str = " SELECT" & _
                " EmpSal_id," & _
                " Emp_Code," & _
                " EmpSal_Date," & _
                " EmpSal_Value," & _
                " EmpSal_Basic," & _
                " EmpSal_EffPayDate," & _
                " EmpSal_EffArrearsDate," & _
                " EmpSal_Cola," & _
                " Usr_Id," & _
                " EmpSal_IsCola," & _
                " EmpSal_Dif," & _
                " EmpSal_Rate, " & _
                " EmpSal_RateSalary " & _
                " FROM PrTxEmployeeSalary" & _
                " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ") AND" & _
                " (EmpSal_EffPayDate <= " & enQuoteString(Utils.ChangeDateFormatForSearch(strCurDate)) & ")" & _
                " ORDER BY EmpSal_EffPayDate DESC"
        ''
        'Str = " SELECT EmpSal_Value" & _
        '      " FROM PrTxEmployeeSalary" & _
        '      " WHERE (Emp_Code = 1) AND" & _
        '      " (EmpSal_EffPayDate <= " & enQuoteString(Utils.ChangeDateFormatForSearch(strCurDate)) & ")" & _
        '      " ORDER BY EmpSal_EffPayDate DESC"

        Dim Ds As DataSet = GetData(Str)
        Dim EmpSalary As New cPrTxEmployeeSalary
        If CheckDataSet(Ds) Then
            EmpSalary = New cPrTxEmployeeSalary(Ds.Tables(0).Rows(0))
        End If
        Return EmpSalary
    End Function
  

    Protected Function GetNumberOfNormalPeriodsBack(ByVal EmpSalary As cPrTxEmployeeSalary, ByVal CurrentPeriod As cPrMsPeriodCodes) As Integer
        Dim Str As String
        Dim strCurPeriodStartDate As String
        Dim strArrearsDate As String
        Dim PeriodsNumber As Integer = 0

        strArrearsDate = Format(EmpSalary.EffArrearsDate, "yyyy-MM-dd")
        strCurPeriodStartDate = Format(CurrentPeriod.DateFrom, "yyyy-MM-dd")

        Str = " Select Count(*) From PrMsperiodcodes Where " & _
            " PrdCod_DateFrom >=" & _
            " (Select prdCod_DateFrom From PrMsPeriodcodes Where " & enQuoteString(Utils.ChangeDateFormatForSearch(strArrearsDate)) & _
            " between prdCod_DateFrom and prdCod_DateTo" & _
            " and PayCat_Code=" & enQuoteString(Global1.GLB_PeriodCategory_Normal) & _
            " and PrdGrp_Code=" & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
            " And PrdCod_DateFrom <" & enQuoteString(Utils.ChangeDateFormatForSearch(strCurPeriodStartDate)) & _
            " and PayCat_Code=" & enQuoteString(Global1.GLB_PeriodCategory_Normal) & _
            " and PrdGrp_Code=" & enQuoteString(CurrentPeriod.PrdGrpCode)

        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            PeriodsNumber = DbNullToInt(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return PeriodsNumber

    End Function
    Protected Function GetNumberOfNormalWorkedPeriods(ByVal EmpCode As String, ByVal CurrentPeriod As cPrMsPeriodCodes) As Integer
        Dim Str As String
        Dim PeriodsNumber As Integer = 0

        Str = " select count(*) from PrTxTrxnHeader " & _
              " where Emp_Code=" & enQuoteString(EmpCode) & _
              " and PrdGrp_Code =" & enQuoteString(CurrentPeriod.PrdGrpCode) & _
              " AND PayCat_Code ='K'"

        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            PeriodsNumber = DbNullToInt(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return PeriodsNumber

    End Function
    Protected Function Find13nthPeriodUnits(ByVal CurrentPeriod As cPrMsPeriodCodes) As Double

        Dim Str As String
        Dim t13Units As Double = 0
        Str = " SELECT PrdCod_PeriodUnits" & _
            "  FROM PrMsPeriodCodes" & _
            "  WHERE PrdGrp_Code=" & enQuoteString(CurrentPeriod.PrdGrpCode) & _
            "  AND PayCat_Code=" & enQuoteString(Global1.GLB_PeriodCategory_13)
        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            t13Units = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return t13Units
    End Function
    Protected Function Find14nthPeriodUnits(ByVal CurrentPeriod As cPrMsPeriodCodes) As Double

        Dim Str As String
        Dim t14Units As Double = 0
        Str = " SELECT PrdCod_PeriodUnits" & _
            "  FROM PrMsPeriodCodes" & _
            "  WHERE PrdGrp_Code=" & enQuoteString(CurrentPeriod.PrdGrpCode) & _
            "  AND PayCat_Code=" & enQuoteString(Global1.GLB_PeriodCategory_14)
        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            t14Units = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return t14Units
    End Function
    Protected Function GetSumOfAnuallUnitsForX(ByVal GLBCurrentPeriod As cPrMsPeriodCodes, ByVal EmployeeCode As String) As Double
        Dim Str As String
        Str = " SELECT SUM(PrTxTrxnHeader.TrxHdr_AnnualUnits)" &
            " FROM PrTxTrxnHeader INNER JOIN" &
            " PrMsPeriodCodes ON " &
            " PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code INNER JOIN" &
            " PrMsPeriodGroups ON" &
            " PrMsPeriodCodes.PrdGrp_Code = PrMsPeriodGroups.PrdGrp_Code" &
            " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmployeeCode) & ")" &
            " AND (PrTxTrxnHeader.PayCat_Code = " & enQuoteString(Global1.GLB_PeriodCategory_Normal) & ")" &
            " AND (PrMsPeriodGroups.PrdGrp_Code = " & enQuoteString(GLBCurrentPeriod.PrdGrpCode) & ")" &
        " AND (PrTxTrxnHeader.TrxHdr_Status<>'PREP')"
        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Return DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        Else
            Return 0
        End If

    End Function

    Protected Function GetAllPrSsLimits() As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " Lmt_Id," & _
            " Lmt_Cola," & _
            " Lmt_InsurableWk," & _
            " Lmt_InsurableMth," & _
            " Lmt_InsurableAnnual," & _
            " Lmt_DedContrAnnual," & _
            " Lmt_IndAnnual," & _
            " Lmt_UnemAnnual," & _
            " Lmt_EffectiveDate, " & _
             " Lmt_GesiD, " & _
            " Lmt_GesiC " & _
            " FROM PrSsLimits " & _
           " Order by  Lmt_EffectiveDate Desc "
        Return GetData(Str)
    End Function
    Protected Function GetActiveLimitsForPeriod(ByVal Period As cPrMsPeriodCodes) As DataSet
        Dim Str As String
        Dim sPeriodDate As String
        sPeriodDate = Format(Period.DateTo, "yyyy-MM-dd")
        Str = " SELECT " & _
            " Lmt_Id," & _
            " Lmt_Cola," & _
            " Lmt_InsurableWk," & _
            " Lmt_InsurableMth," & _
            " Lmt_InsurableAnnual," & _
            " Lmt_DedContrAnnual," & _
            " Lmt_IndAnnual," & _
            " Lmt_UnemAnnual," & _
            " Lmt_EffectiveDate, " & _
             " Lmt_GesiD, " & _
            " Lmt_GesiC " & _
            " FROM PrSsLimits where Lmt_EffectiveDate <= " & enQuoteString(Utils.ChangeDateFormatForSearch(sPeriodDate)) & _
            " Order by Lmt_EffectiveDate Desc"
        Return GetData(Str)
    End Function
    Protected Function FindSIPeriodInsurableIncomeForEmployeeForPeriod(ByVal Period As cPrMsPeriodCodes, ByVal EmpCode As String, ByVal TempGroupCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim SIIncome As Double = 0
        Dim Ds2 As DataSet
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim PeriodCode As String
        Dim PeriodInsurable As Double



        Ds2 = Me.GetAllPeriodsOF_SIPeriod(Period.SinPrdCode, TempGroupCode, Period.PrdGrpCode)
        If CheckDataSet(Ds2) Then
            Dim i As Integer
            For i = 0 To Ds2.Tables(0).Rows.Count - 1
                PeriodCode = DbNullToString(Ds2.Tables(0).Rows(i).Item(0))
                If i = 0 Then
                    Str2 = " AND (PrMsPeriodCodes.PrdCod_Code = " & enQuoteString(PeriodCode)
                Else
                    Str2 = Str2 & " OR PrMsPeriodCodes.PrdCod_Code = " & enQuoteString(PeriodCode)
                End If
            Next
            Str2 = Str2 & " ) "
        End If






        Str = " Select SUM(PrTxTrxnHeader.TrxHdr_PeriodInsurable )" & _
            " FROM PrMsPeriodCodes INNER JOIN  PrTxTrxnHeader " & _
            " ON PrMsPeriodCodes.PrdCod_Code = PrTxTrxnHeader.PrdCod_Code " & _
            " WHERE  (PrTxTrxnHeader.Emp_Code =" & enQuoteString(EmpCode) & " )  " & _
            " AND (PrMsPeriodCodes.PrdGrp_Code=" & enQuoteString(Period.PrdGrpCode) & " )"
        Str = Str & Str2


        Ds = MyBase.GetData(Str)

        If CheckDataSet(Ds) Then
            PeriodInsurable = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        If PeriodInsurable <> 0 Then
            PeriodInsurable = RoundMe3(PeriodInsurable, 2)
        End If

        Return PeriodInsurable
    End Function
    Protected Function FindSIPeriodInsurableIncomeForEmployeeForPeriodGroup(ByVal Period As cPrMsPeriodCodes, ByVal EmpCode As String, ByVal TempGroupCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim SIIncome As Double = 0

        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Dim PeriodInsurable As Double



        Str = " Select SUM(PrTxTrxnHeader.TrxHdr_PeriodInsurable )" & _
            " FROM PrMsPeriodCodes INNER JOIN  PrTxTrxnHeader " & _
            " ON PrMsPeriodCodes.PrdCod_Code = PrTxTrxnHeader.PrdCod_Code " & _
            " WHERE  (PrTxTrxnHeader.Emp_Code =" & enQuoteString(EmpCode) & " )  " & _
            " AND (PrMsPeriodCodes.PrdGrp_Code=" & enQuoteString(Period.PrdGrpCode) & " )"


        Ds = MyBase.GetData(Str)

        If CheckDataSet(Ds) Then
            PeriodInsurable = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        If PeriodInsurable <> 0 Then
            PeriodInsurable = RoundMe3(PeriodInsurable, 2)
        End If

        Return PeriodInsurable
    End Function
   
    Protected Function FindSIValueForEmployeeForPeriod(ByVal Period As cPrMsPeriodCodes, ByVal EmpCode As String, ByVal MyType As String, ByVal TempGroupCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim SIIncome As Double = 0
        Dim Ds2 As DataSet
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim PeriodCode As String
        Ds2 = Me.GetAllPeriodsOF_SIPeriod(Period.SinPrdCode, TempGroupCode, Period.PrdGrpCode)
        If CheckDataSet(Ds2) Then
            Dim i As Integer
            For i = 0 To Ds2.Tables(0).Rows.Count - 1
                PeriodCode = DbNullToString(Ds2.Tables(0).Rows(i).Item(0))
                If i = 0 Then
                    Str2 = " AND (PrMsPeriodCodes.PrdCod_Code = " & enQuoteString(PeriodCode)
                Else
                    Str2 = Str2 & " OR PrMsPeriodCodes.PrdCod_Code = " & enQuoteString(PeriodCode)
                End If
            Next
            Str2 = Str2 & " ) "
        End If



      
        If MyType = "D" Then
            Dim SIDeductionCode As String
            SIDeductionCode = Global1.Business.GetDecuctionCodeForSI


            Str = " Select SUM(PrTxTrxnLines.TrxLin_PeriodValue) " & _
             " FROM PrMsPeriodCodes INNER JOIN " & _
             " PrTxTrxnHeader ON PrMsPeriodCodes.PrdCod_Code = PrTxTrxnHeader.PrdCod_Code INNER JOIN " & _
             " PrTxTrxnLines ON PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id " & _
             " WHERE (PrMsPeriodCodes.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ") " & _
             " AND (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") " & _
             " AND (PrTxTrxnLines.DedCod_Code = " & enQuoteString(SIDeductionCode) & ") " & _
             " AND (PrTxTrxnLines.TrxLin_Type = 'D') "
            Str = Str & Str2
        Else
            Dim SIContributionCode As String
            SIContributionCode = Global1.Business.GetContributionCodeForSI
            Str = " Select SUM(PrTxTrxnLines.TrxLin_PeriodValue) " & _
             " FROM PrMsPeriodCodes INNER JOIN " & _
             " PrTxTrxnHeader ON PrMsPeriodCodes.PrdCod_Code = PrTxTrxnHeader.PrdCod_Code INNER JOIN " & _
             " PrTxTrxnLines ON PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id " & _
             " WHERE (PrMsPeriodCodes.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ") " & _
             " AND (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") " & _
             " AND (PrTxTrxnLines.ConCod_Code = " & enQuoteString(SIContributionCode) & ") " & _
             " AND (PrTxTrxnLines.TrxLin_Type = 'C') "

            Str = Str & Str2

        End If

        Ds = MyBase.GetData(Str)

        If CheckDataSet(Ds) Then
            SIIncome = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        If SIIncome <> 0 Then
            SIIncome = RoundMe3(SIIncome, 2)
        End If

        Return SIIncome
    End Function

    Protected Function FindSIIncomeForThisPeriodYearUntilNow(ByVal Period As cPrMsPeriodCodes, ByVal EmpCode As String, ByVal MyType As String, ByVal TempGroupCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim SIIncome As Double = 0
        Dim Ds2 As DataSet
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim PeriodCode As String
       
        If MyType = "D" Then
            Dim SIDeductionCode As String
            SIDeductionCode = Global1.Business.GetDecuctionCodeForSI


            Str = " Select SUM(PrTxTrxnLines.TrxLin_PeriodValue) " & _
             " FROM PrMsPeriodCodes INNER JOIN " & _
             " PrTxTrxnHeader ON PrMsPeriodCodes.PrdCod_Code = PrTxTrxnHeader.PrdCod_Code INNER JOIN " & _
             " PrTxTrxnLines ON PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id " & _
             " WHERE (PrMsPeriodCodes.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ") " & _
             " AND (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") " & _
             " AND (PrTxTrxnLines.DedCod_Code = " & enQuoteString(SIDeductionCode) & ") " & _
             " AND (PrTxTrxnLines.TrxLin_Type = 'D') "
            Str = Str & Str2 & Str3
        Else
            Dim SIContributionCode As String
            SIContributionCode = Global1.Business.GetContributionCodeForSI
            Str = " Select SUM(PrTxTrxnLines.TrxLin_PeriodValue) " & _
             " FROM PrMsPeriodCodes INNER JOIN " & _
             " PrTxTrxnHeader ON PrMsPeriodCodes.PrdCod_Code = PrTxTrxnHeader.PrdCod_Code INNER JOIN " & _
             " PrTxTrxnLines ON PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id " & _
             " WHERE (PrMsPeriodCodes.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ") " & _
             " AND (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") " & _
             " AND (PrTxTrxnLines.ConCod_Code = " & enQuoteString(SIContributionCode) & ") " & _
             " AND (PrTxTrxnLines.TrxLin_Type = 'C') "

            Str = Str & Str2 & Str3

        End If






        Ds = MyBase.GetData(Str)

        If CheckDataSet(Ds) Then
            SIIncome = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If

        Return SIIncome

    End Function
    Protected Function FindSumForThisPeriodYearUntilNowOfContributionCodeType(ByVal Period As cPrMsPeriodCodes, ByVal ConCode As cPrMsContributionCodes, ByVal EmpCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double = 0
        Str = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue) AS Expr1" & _
              " FROM PrMsPeriodCodes INNER JOIN" & _
              " PrTxTrxnHeader ON PrMsPeriodCodes.PrdCod_Code = PrTxTrxnHeader.PrdCod_Code INNER JOIN" & _
              " PrTxTrxnLines ON PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
              " PrMsContributionCodes ON PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code" & _
              " WHERE (PrMsPeriodCodes.PrdGrp_Code =" & enQuoteString(Period.PrdGrpCode) & ")" & _
              " AND (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
              " AND (PrMsContributionCodes.ConTyp_Code = " & enQuoteString(ConCode.ConTypCode) & ")"
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value
    End Function
    Protected Function GetAllPrMsEmployeesByTemplateGroup(ByVal TempGroupCode As String, ByVal FromEmployeeCode As String, ByVal ToEmployeeCode As String, ByVal CurrentPeriod As cPrMsPeriodCodes, ByVal Analysis As Integer, ByVal AnalCode As String, ByVal Cash As Boolean, ByVal Cheque As Boolean, ByVal Bank As Boolean, ByVal SortOrder As Integer, ByVal OnlyLeavers As Boolean, ByVal GenAnal1 As String, ByVal StartCode As String, ByVal NorP As Integer, ByVal Endcode As String, ByVal TopValue As String, ByVal EWallet As Boolean) As DataSet
todo:   ' check for status in trxnheader


        Dim StrA As String = ""
        Dim Str As String = ""

        Dim Str2 As String = ""

        If TopValue = 0 Then
            StrA = " Select "
        Else
            StrA = " Select Top(" & TopValue & ")"
        End If

        Str = "  Emp_Code," &
                " Emp_Status," &
                " PayTyp_Code," &
                " TemGrp_Code," &
                " EmpSta_Code," &
                " Emp_Title," &
                " Emp_LastName," &
                " Emp_FirstName," &
                " Emp_FullName," &
                " Emp_Sex," &
                " Emp_BirthDate," &
                " MarSta_Code," &
                " Emp_Address1," &
                " Emp_Address2," &
                " Emp_Address3," &
                " Emp_PostCode," &
                " Emp_Telephone1," &
                " Emp_Telephone2," &
                " Emp_Email," &
                " Emp_SocialInsNumber," &
                " ComSin_EmpSocialInsNo," &
                " Emp_IdentificationCard," &
                " Emp_TaxID," &
                " Emp_PassportNumber," &
                " Emp_AlienNumber," &
                " TicTyp_Code," &
                " EmpAn1_Code," &
                " EmpAn2_Code," &
                " EmpAn3_Code," &
                " EmpAn4_Code," &
                " EmpAn5_Code," &
                " Uni_Code," &
                " Cou_Code," &
                " EmpPos_Code," &
                " Sic_Code," &
                " EmpCmm_Code," &
                " PayUni_Code," &
                " Emp_PeriodUnits," &
                " Emp_AnnualUnits," &
                " Cur_Code," &
                " PmtMth_Code," &
                " Bnk_Code," &
                " Emp_BankAccount," &
                " Bnk_CodeCo," &
                " Emp_BankAccountCo," &
                " Emp_StartDate," &
                " Emp_TerminateDate," &
                " Emp_OtherIncome1," &
                " Emp_OtherIncome2," &
                " Emp_OtherIncome3," &
                " Emp_PreviousEarnings," &
                " Emp_PrevSIDeduct," &
                " Emp_PrevSIContribute," &
                " Emp_PrevITDeduct," &
                " Emp_PrevPFDeduct," &
                " ProFnd_Code," &
                " MedFnd_Code," &
                " SocInc_Code," &
                " Ind_Code," &
                " Une_Code," &
                " SocCoh_Code," &
                " Emp_CreationDate," &
                " Emp_CreatedBy," &
                " Emp_AmendDate," &
                " Emp_AmendBy," &
                " IntTem_Code, " &
                " Emp_GLAnal1," &
                " Emp_GLAnal2, " &
                " Emp_GLAnal3," &
                " Emp_GLAnal4, " &
                " IntTem_PFCode, " &
                " IntTem_MFCode, " &
                " Emp_PensionNo," &
                " Emp_DrivingLicense," &
                " Emp_HasSI," &
                " Emp_Pensiontype, " &
                " Emp_MyPayslipReport," &
                " Emp_IBAN," &
                " Emp_PreviousLifeIns," &
                " Emp_PreviousDis," &
                " Emp_PreviousST," &
                " Emp_OtherIncome4," &
                 " SecPay_Code, " &
                " ComRat_Code, " &
                " PerBon_Code, " &
                " DutHou_Code, " &
                " FliHou_Code, " &
                " Emp_PassFullName," &
                " Emp_TravelDocs, " &
                " Emp_FirstEmployment, " &
                " OveLay_Code, " &
                " Emp_Password, " &
                " Emp_Splitemployement, " &
                " Emp_NewEmployee, " &
                " Emp_Force50Percent, " &
                " Emp_Notes, " &
                " Emp_BankBenName, " &
                " Emp_AgreedSalary, " &
                " Emp_BonusOnSalary, " &
                " Emp_TaxForSplit, " &
                " Emp_PrevMF, " &
                " Emp_PrevPenF, " &
                " Emp_50PerOff, " &
                " Ges_Code, " &
                " Emp_PrevGesiD, " &
                " Emp_PrevGesiC, " &
                " Emp_LWBPen, " &
                " Emp_GESYFromSplit, " &
                " Emp_AnalGen1, " &
                " Emp_NameDay, " &
                " Emp_IsDirector, " &
                " Emp_Rehire, " &
                " Emp_CNP, " &
                " Emp_TACode, " &
                " Emp_HRCode, " &
                " Emp_TermReason, " &
                " Emp_HireReason, " &
                " Emp_Email2, " &
                " Emp_Maternity, " &
                " Emp_FEControlAmount, " &
                " Emp_PrevUnion " &
                "  FROM PrMsEmployees" &
                " Where TemGrp_Code=" & enQuoteString(TempGroupCode) &
                " AND Emp_Status='A'" &
                " AND Emp_NewEmployee='0'"


        Str = StrA & Str


        If FromEmployeeCode <> "" And ToEmployeeCode = "" Then
            Str2 = " AND  (Emp_Code>=" & enQuoteString(FromEmployeeCode) & ")"
        End If
        If FromEmployeeCode <> "" And ToEmployeeCode <> "" Then
            Str2 = " AND  (Emp_Code>=" & enQuoteString(FromEmployeeCode) & _
            "AND Emp_Code<=" & enQuoteString(ToEmployeeCode) & ")"
        End If

        If FromEmployeeCode = "" And ToEmployeeCode = "" Then
            If TopValue <> 0 Then
                If NorP = 1 Then
                    Str2 = " AND ( Emp_Code>" & enQuoteString(StartCode) & ")"

                Else
                    Str2 = " AND ( Emp_Code>=" & enQuoteString(StartCode) & _
                    " AND Emp_Code<=" & enQuoteString(Endcode) & " )"

                End If
            End If
        End If



        Dim str3 As String = ""
        Select Case Analysis
            Case 0
                str3 = ""

            Case 1
                str3 = " AND EmpAn1_Code=" & enQuoteString(AnalCode)
            Case 2
                str3 = " AND EmpAn2_Code=" & enQuoteString(AnalCode)
            Case 3
                str3 = " AND EmpAn3_Code=" & enQuoteString(AnalCode)
            Case 4
                str3 = " AND EmpAn4_Code=" & enQuoteString(AnalCode)
            Case 5
                str3 = " AND EmpAn5_Code=" & enQuoteString(AnalCode)
            Case 6
                str3 = " AND Uni_Code=" & enQuoteString(AnalCode)
        End Select
        Dim Str4 As String = ""

        If Cash Then
            Str4 = " AND (PmtMth_Code =1"
        End If
        If Cheque Then
            If Str4 = "" Then
                Str4 = " AND  (PmtMth_Code =2"
            Else
                Str4 = Str4 & " OR  PmtMth_Code =2"
            End If
        End If
        If Bank Then
            If Str4 = "" Then
                Str4 = " AND  (PmtMth_Code =3"
            Else
                Str4 = Str4 & " OR  PmtMth_Code =3"
            End If
        End If
        If EWallet Then
            If Str4 = "" Then
                Str4 = " AND  (PmtMth_Code =4"
            Else
                Str4 = Str4 & " OR  PmtMth_Code =4"
            End If
        End If

        If Str4 <> "" Then
            Str4 = Str4 & ")"
        End If

        Dim Str5 As String = ""
        If OnlyLeavers Then
            Str5 = " AND  (Emp_TerminateDate<>'') "
        Else
            Str5 = ""
        End If


        Dim Str6 As String = ""
        If GenAnal1 <> "" Then
            Str6 = " And (Emp_AnalGen1=" & enQuoteString(GenAnal1) & ")"

        End If



        Dim Str7 As String

        If SortOrder = 1 Then
            Str7 = " Order by Emp_Code ASC"
        ElseIf SortOrder = 2 Then
            Str7 = " Order by EmpAn2_Code ASC ,Emp_Code ASC"
        ElseIf SortOrder = 3 Then
            Str7 = " Order by Emp_TACode ASC ,Emp_Code ASC"
        Else
            Str7 = " Order by Emp_FullName ASC"
        End If

        Str = Str & Str2 & str3 & Str4 & Str5 & Str6 & Str7

        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsEmployeesByTemplateGroupFORSearch(ByVal TempGroupCode As String, ByVal FromEmployeeCode As String, ByVal ToEmployeeCode As String, ByVal CurrentPeriod As cPrMsPeriodCodes, ByVal AnalValue As String, ByVal SortOrder As Integer, ByVal Analysis As Integer, ByVal PUnit1 As String, ByVal PUnit2 As String, ByVal PUnit3 As String) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""
        Dim Str5 As String = ""
        Dim Str6 As String = ""

        Dim Str7 As String = ""
        Dim Str8 As String = ""
        Dim Str9 As String = ""


        Select Case Analysis
            Case 1
                Str3 = " AND PrMsEmployees.EmpAn1_Code=" & enQuoteString(AnalValue)

                Str5 = " PrAnEmployeeAnalysis1.EmpAn1_DescriptionL Analysis," & _
                   " prmsemployees.PayUni_Code" & _
                   " FROM PrMsEmployees INNER JOIN" & _
                   " PrAnEmployeeAnalysis1 ON" & _
                   " PrMsEmployees.EmpAn1_Code = PrAnEmployeeAnalysis1.EmpAn1_Code"

                Str4 = " ORDER BY PrMsEmployees.Emp_FullName," & _
                   " PrAnEmployeeAnalysis1.EmpAn1_DescriptionL"

                Str6 = " ORDER BY  PrMsEmployees.Emp_GLAnal4," & _
                  " PrMsEmployees.Emp_FullName"


            Case 2
                Str3 = " AND PrMsEmployees.EmpAn2_Code=" & enQuoteString(AnalValue)

                Str5 = " PrAnEmployeeAnalysis2.EmpAn2_DescriptionL  Analysis," & _
                " prmsemployees.PayUni_Code" & _
                    " FROM PrMsEmployees INNER JOIN" & _
                    " PrAnEmployeeAnalysis2 ON" & _
                    " PrMsEmployees.EmpAn2_Code = PrAnEmployeeAnalysis2.EmpAn2_Code"

                Str4 = " ORDER BY PrMsEmployees.Emp_FullName," & _
                   " PrAnEmployeeAnalysis2.EmpAn2_DescriptionL"

                Str6 = " ORDER BY  PrMsEmployees.Emp_GLAnal4," & _
                  " PrMsEmployees.Emp_FullName"
            Case 3
                Str3 = " AND PrMsEmployees.EmpAn3_Code=" & enQuoteString(AnalValue)

                Str5 = " PrAnEmployeeAnalysis3.EmpAn3_DescriptionL Analysis," & _
                " prmsemployees.PayUni_Code" & _
                    " FROM PrMsEmployees INNER JOIN" & _
                    " PrAnEmployeeAnalysis3 ON" & _
                    " PrMsEmployees.EmpAn3_Code = PrAnEmployeeAnalysis3.EmpAn3_Code"

                Str4 = " ORDER BY PrMsEmployees.Emp_FullName," & _
                   " PrAnEmployeeAnalysis3.EmpAn3_DescriptionL"

                Str6 = " ORDER BY  PrMsEmployees.Emp_GLAnal4," & _
                  " PrMsEmployees.Emp_FullName"
            Case 4
                Str3 = " AND PrMsEmployees.EmpAn4_Code=" & enQuoteString(AnalValue)

                Str5 = " PrAnEmployeeAnalysis4.EmpAn4_DescriptionL  Analysis," & _
                " prmsemployees.PayUni_Code" & _
                    " FROM PrMsEmployees INNER JOIN" & _
                    " PrAnEmployeeAnalysis4 ON" & _
                    " PrMsEmployees.EmpAn4_Code = PrAnEmployeeAnalysis4.EmpAn4_Code"

                Str4 = " ORDER BY PrMsEmployees.Emp_FullName," & _
                   " PrAnEmployeeAnalysis4.EmpAn4_DescriptionL"

                Str6 = " ORDER BY  PrMsEmployees.Emp_GLAnal4," & _
                  " PrMsEmployees.Emp_FullName"
            Case 5
                Str3 = " AND PrMsEmployees.EmpAn5_Code=" & enQuoteString(AnalValue)

                Str5 = " PrAnEmployeeAnalysis5.EmpAn5_DescriptionL  Analysis," & _
                " prmsemployees.PayUni_Code" & _
                    " FROM PrMsEmployees INNER JOIN" & _
                    " PrAnEmployeeAnalysis5 ON" & _
                    " PrMsEmployees.EmpAn5_Code = PrAnEmployeeAnalysis5.EmpAn5_Code"

                Str4 = " ORDER BY PrMsEmployees.Emp_FullName," & _
                   " PrAnEmployeeAnalysis5.EmpAn5_DescriptionL"

                Str6 = " ORDER BY  PrMsEmployees.Emp_GLAnal4," & _
                  " PrMsEmployees.Emp_FullName"



        End Select

        If PUnit1 <> "" Then
            Str7 = " AND (PrMsEmployees.PayUni_code=" & enQuoteString(PUnit1)
        End If
        If PUnit2 <> "" Then
            If Str7 = "" Then
                Str7 = " AND (PrMsEmployees.PayUni_code=" & enQuoteString(PUnit2)
            Else
                Str7 = Str7 & " OR PrMsEmployees.PayUni_code=" & enQuoteString(PUnit2)
            End If
        End If
        If PUnit3 <> "" Then
            If Str7 = "" Then
                Str7 = " AND (PrMsEmployees.PayUni_code=" & enQuoteString(PUnit3)
            Else
                Str7 = Str7 & " OR PrMsEmployees.PayUni_code=" & enQuoteString(PUnit3)
            End If
        End If
        If Str7 <> "" Then
            Str7 = Str7 & ")"
        End If
        If Global1.UserRole = Roles.TimeAttetance Then
            Dim Sstring As String
            Sstring = "%" & Global1.UserName & "%"
            Str8 = "" '" INNER JOIN PrAnEmployeeAnalysis5 ON PrMsEmployees.EmpAn5_Code = PrAnEmployeeAnalysis5.EmpAn5_Code"
            Str9 = " AND (PrAnEmployeeAnalysis5.EmpAn5_GLAnal1 like " & enQuoteString("%" & Global1.UserName & "%") & ")"
        End If

        Str = " SELECT 1 AS selected," & _
            " PrMsEmployees.Emp_Code," & _
            " PrMsEmployees.Emp_FullName,"


        Str = Str & Str5 & Str8

        Str = Str & " Where TemGrp_Code=" & enQuoteString(TempGroupCode) & _
                    " AND Emp_Status='A'"
        If FromEmployeeCode <> "" And ToEmployeeCode <> "" Then
            Str2 = " AND  (Emp_Code>=" & enQuoteString(FromEmployeeCode) & _
            "AND Emp_Code<=" & enQuoteString(ToEmployeeCode) & ")"
        End If

        If AnalValue = "ALL" Then
            Str3 = ""
        End If

        If SortOrder = 0 Then
            Str6 = ""
        Else
            Str4 = ""
        End If

        Str = Str & Str2 & Str3 & Str7 & Str9 & Str4
        Return GetData(Str)
    End Function
    Protected Function GetAllPrTxEmployeeDiscounts(ByVal PrdGrp_Code As String, ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " EmpDis_id," & _
            " Emp_Code," & _
            " PrdGrp_Code," & _
            " EmpDis_Discount1," & _
            " EmpDis_Discount2," & _
            " EmpDis_Discount3," & _
            " EmpDis_Discount4," & _
            " EmpDis_Discount5," & _
            " EmpDis_Discount6," & _
            " EmpDis_Discount7," & _
            " EmpDis_Discount8," & _
            " EmpDis_Discount9," & _
            " EmpDis_Discount10," & _
            " EmpDis_LifeInsurance," & _
            " Usr_Id," & _
            " EmpDis_CreationDate," & _
            " EmpDis_AmendDate," & _
            " EmpDis_medical, " & _
            " EmpDis_PensionFund " & _
            " FROM PrTxEmployeeDiscounts " & _
            " Where PrdGrp_Code = " & enQuoteString(PrdGrp_Code) & _
            " AND Emp_Code = " & enQuoteString(EmpCode)
        Return GetData(Str)
    End Function
    Protected Function GetAllPrTxEmployeeDiscountsForCopy(ByVal EmpCode As String, ByVal PeriodGroupCode As String) As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " EmpDis_id," & _
            " Emp_Code," & _
            " PrdGrp_Code," & _
            " EmpDis_Discount1," & _
            " EmpDis_Discount2," & _
            " EmpDis_Discount3," & _
            " EmpDis_Discount4," & _
            " EmpDis_Discount5," & _
            " EmpDis_Discount6," & _
            " EmpDis_Discount7," & _
            " EmpDis_Discount8," & _
            " EmpDis_Discount9," & _
            " EmpDis_Discount10," & _
            " EmpDis_LifeInsurance," & _
            " Usr_Id," & _
            " EmpDis_CreationDate," & _
            " EmpDis_AmendDate," & _
            " EmpDis_medical, " & _
            " EmpDis_PensionFund " & _
            " FROM PrTxEmployeeDiscounts " & _
            " Where Emp_Code = " & enQuoteString(EmpCode) & _
            " AND PrdGrp_Code=" & enQuoteString(PeriodGroupCode)

        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsEmployeeRemindersForCopy(ByVal EmpCode As String, ByVal PeriodGroupCode As String) As DataSet
        Dim Str As String
        Str = "SELECT Rem_Id, " & _
            " Emp_Code, " & _
            " Rem_Description, " & _
            " Rem_ReminderDate, " & _
            " Rem_IsActive, " & _
            " Rem_CreatedBy, " & _
            " Rem_CreatedAt, " & _
            " Rem_DeactivatedBy,  " & _
            " Rem_DeactivatedAt " & _
            " FROM PrMsReminders " & _
            " Where Emp_Code = " & enQuoteString(EmpCode)
        Return GetData(Str)
    End Function
    Protected Function GetToDate_SI_PF_MF(ByVal Employee As cPrMsEmployees, ByVal DedCod As cPrMsDeductionCodes, ByVal CurrentPeriod As cPrMsPeriodCodes) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double = 0
        Str = " SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
              " FROM PrTxTrxnHeader INNER JOIN" & _
              " PrTxTrxnLines ON PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id" & _
              " WHERE (PrTxTrxnLines.DedCod_Code = " & enQuoteString(DedCod.Code) & ")" & _
              " AND (PrTxTrxnHeader.Emp_Code = " & enQuoteString(Employee.Code) & ")" & _
              " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
              " AND (PrTxTrxnHeader.TrxHdr_Status='POST')"




        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value

    End Function
    Protected Function GetToDate_SplitSI(ByVal Employee As cPrMsEmployees, ByVal CurrentPeriod As cPrMsPeriodCodes) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double = 0


        Str = " SELECT  SUM(PrTxTrxnHeader.TrxHdr_PeriodSplitSI) AS Expr1" & _
        " FROM   PrTxTrxnHeader " & _
        " WHERE  (PrTxTrxnHeader.Emp_Code = " & enQuoteString(Employee.Code) & ")" & _
        " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
        " AND (PrTxTrxnHeader.TrxHdr_Status = 'POST')"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value

    End Function
    Protected Function GetToDate_SI_PF_MF(ByVal Employee As cPrMsEmployees, ByVal CurrentPeriod As cPrMsPeriodCodes, ByVal DedType As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double = 0


        Str = " SELECT  SUM(PrTxTrxnLines.TrxLin_PeriodValue) AS Expr1" & _
        " FROM   PrTxTrxnHeader INNER JOIN" & _
        " PrTxTrxnLines ON" & _
        " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
        " PrMsDeductionCodes ON" & _
        " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
        " WHERE  (PrTxTrxnHeader.Emp_Code = " & enQuoteString(Employee.Code) & ")" & _
        " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
        " AND (PrTxTrxnHeader.TrxHdr_Status = 'POST') AND " & _
        " (PrMsDeductionCodes.DedTyp_Code = " & enQuoteString(DedType) & ")"


        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value

    End Function
    Protected Function GetToDate_Contributions(ByVal Employee As cPrMsEmployees, ByVal CurrentPeriod As cPrMsPeriodCodes, ByVal DedType As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double = 0


        Str = " SELECT  SUM(PrTxTrxnLines.TrxLin_PeriodValue) AS Expr1" & _
        " FROM   PrTxTrxnHeader INNER JOIN" & _
        " PrTxTrxnLines ON" & _
        " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
        " PrMsContributionCodes ON" & _
        " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code" & _
        " WHERE  (PrTxTrxnHeader.Emp_Code = " & enQuoteString(Employee.Code) & ")" & _
        " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
        " AND (PrTxTrxnHeader.TrxHdr_Status = 'POST') AND " & _
        " (PrMsContributionCodes.ConTyp_Code = " & enQuoteString(DedType) & ")"


        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value

    End Function
    Protected Function GetToDate_PeriodSplit(ByVal Employee As cPrMsEmployees, ByVal CurrentPeriod As cPrMsPeriodCodes) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double = 0


        Str = " SELECT  SUM(PrTxTrxnHeader.TrxHdr_PeriodSplit)" & _
        " FROM   PrTxTrxnHeader " & _
        " WHERE  (PrTxTrxnHeader.Emp_Code = " & enQuoteString(Employee.Code) & ")" & _
        " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
        " AND (PrTxTrxnHeader.TrxHdr_Status = 'POST') "

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value

    End Function
    Protected Function GetToDate_SpecialTax(ByVal Employee As cPrMsEmployees, ByVal CurrentPeriod As cPrMsPeriodCodes, ByVal DedType As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double = 0


        Str = " SELECT  SUM(PrTxTrxnLines.TrxLin_PeriodValue) AS Expr1" & _
        " FROM   PrTxTrxnHeader INNER JOIN" & _
        " PrTxTrxnLines ON" & _
        " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
        " PrMsDeductionCodes ON" & _
        " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
        " WHERE  (PrTxTrxnHeader.Emp_Code = " & enQuoteString(Employee.Code) & ")" & _
        " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
        " AND (PrTxTrxnHeader.TrxHdr_Status = 'POST') AND " & _
        " (PrMsDeductionCodes.DedTyp_Code = " & enQuoteString(DedType) & ")"


        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value

    End Function
    Protected Function GetPeriodvalueOf_IT_ForHeader(ByVal HeaderId As Integer) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double = 0


        Str = " SELECT     PrTxTrxnLines.TrxLin_PeriodValue " & _
        " FROM PrTxTrxnLines INNER JOIN " & _
        " PrMsDeductionCodes ON PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN " & _
        " PrSsDeductionTypes ON PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code " & _
        " WHERE (PrTxTrxnLines.TrxHdr_Id =" & HeaderId & ")" & _
        " AND (PrTxTrxnLines.TrxLin_Type = 'D') " & _
        " AND (PrSsDeductionTypes.DedTyp_Code = 'IT') "

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value

    End Function
    Protected Function GetPeriodvalueOf_SI_ForHeader(ByVal HeaderId As Integer) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double = 0


        Str = " SELECT     PrTxTrxnLines.TrxLin_PeriodValue " & _
        " FROM PrTxTrxnLines INNER JOIN " & _
        " PrMsDeductionCodes ON PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN " & _
        " PrSsDeductionTypes ON PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code " & _
        " WHERE (PrTxTrxnLines.TrxHdr_Id =" & HeaderId & ")" & _
        " AND (PrTxTrxnLines.TrxLin_Type = 'D') " & _
        " AND (PrSsDeductionTypes.DedTyp_Code = 'SI') "

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value

    End Function
    Protected Function GetPeriodvalueOf_IT_ForEmployeeForPeriods(ByVal EmpCode As String, ByVal PerF As cPrMsPeriodCodes, ByVal perT As cPrMsPeriodCodes) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double = 0

        Dim StrIn As String
        StrIn = "(Select TrxHdr_id from PrtxTrxnHeader Where emp_Code=" & enQuoteString(EmpCode) & _
        " AND  PrdGrp_Code =" & enQuoteString(PerF.PrdGrpCode) & _
        " AND (PrdCod_code >=" & enQuoteString(PerF.Code) & " and " & "PrdCod_code <=" & enQuoteString(perT.Code) & "))"

        Str = " SELECT     PrTxTrxnLines.TrxLin_PeriodValue " & _
        " FROM PrTxTrxnLines INNER JOIN " & _
        " PrMsDeductionCodes ON PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN " & _
        " PrSsDeductionTypes ON PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code " & _
        " WHERE (PrTxTrxnLines.TrxHdr_Id in " & StrIn & ")" & _
        " AND (PrTxTrxnLines.TrxLin_Type = 'D') " & _
        " AND (PrSsDeductionTypes.DedTyp_Code = 'IT') "

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value

    End Function
    Protected Function GetPeriodvalueOf_SI_ForEmployeeForPeriods(ByVal EmpCode As String, ByVal PerF As cPrMsPeriodCodes, ByVal perT As cPrMsPeriodCodes) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double = 0
        Dim StrIn As String
        StrIn = "(Select TrxHdr_id from PrtxTrxnHeader Where emp_Code=" & enQuoteString(EmpCode) & _
                " AND  PrdGrp_Code =" & enQuoteString(PerF.PrdGrpCode) & _
                " AND (PrdCod_code >=" & enQuoteString(PerF.Code) & " and " & "PrdCod_code <=" & enQuoteString(perT.Code) & "))"

        Str = " SELECT     PrTxTrxnLines.TrxLin_PeriodValue " & _
        " FROM PrTxTrxnLines INNER JOIN " & _
        " PrMsDeductionCodes ON PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN " & _
        " PrSsDeductionTypes ON PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code " & _
        " WHERE (PrTxTrxnLines.TrxHdr_Id in " & StrIn & ")" & _
        " AND (PrTxTrxnLines.TrxLin_Type = 'D') " & _
        " AND (PrSsDeductionTypes.DedTyp_Code = 'SI') "

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value

    End Function
    Protected Function GetLifeInsurance_And_Discounts_ToDate(ByVal Emp As cPrMsEmployees, ByVal CurrentPeriod As cPrMsPeriodCodes) As DataSet
        Dim str As String
        'str = " SELECT SUM(TrxHdr_TotalErnPeriod)," & _
        '      " SUM(TrxHdr_LifeInsurance)," & _
        '      " SUM(TrxHdr_Discounts)" & _
        '      " FROM PrTxTrxnHeader" & _
        '      " WHERE (Emp_Code = " & enQuoteString(Emp.Code) & ")" & _
        '      " AND (PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
        '      " AND (TrxHdr_Status='POST')"
        str = " SELECT SUM(TrxHdr_TaxableIncome+TrxHdr_TaxableFromOther)," & _
             " SUM(TrxHdr_LifeInsurance)," & _
             " SUM(TrxHdr_Discounts)," & _
             " SUM(TrxHdr_PeriodInsurable), " & _
             " SUM(TrxHdr_FE) " & _
             " FROM PrTxTrxnHeader" & _
             " WHERE (Emp_Code = " & enQuoteString(Emp.Code) & ")" & _
             " AND (PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
             " AND (TrxHdr_Status='POST')"
        Return GetData(str)
    End Function
    Protected Function GetTaxableFromOther_ToDate(ByVal Emp As cPrMsEmployees, ByVal CurrentPeriod As cPrMsPeriodCodes) As DataSet
        Dim str As String
        'str = " SELECT SUM(TrxHdr_TotalErnPeriod)," & _
        '      " SUM(TrxHdr_LifeInsurance)," & _
        '      " SUM(TrxHdr_Discounts)" & _
        '      " FROM PrTxTrxnHeader" & _
        '      " WHERE (Emp_Code = " & enQuoteString(Emp.Code) & ")" & _
        '      " AND (PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
        '      " AND (TrxHdr_Status='POST')"
        str = " SELECT SUM(TrxHdr_TaxableFromOther)" & _
             " FROM PrTxTrxnHeader" & _
             " WHERE (Emp_Code = " & enQuoteString(Emp.Code) & ")" & _
             " AND (PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
             " AND (TrxHdr_Status='POST')"
        Return GetData(str)
    End Function
    Protected Function GetAllPrSsTaxTable() As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " TaxTbl_id," & _
            " TaxTbl_Sequence," & _
            " TaxTbl_BracketAmount," & _
            " TaxTbl_BracketRate," & _
            " TaxTbl_CreationDate," & _
            " TaxTbl_CreatedBy," & _
            " TaxTbl_AmendDate," & _
            " TaxTbl_AmendBy" & _
            " FROM PrSsTaxTable Order by " & _
            " TaxTbl_Sequence Asc"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrSsExtraTaxTable() As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " ExtTbl_id," & _
            " ExtTbl_Sequence," & _
            " ExtTbl_BracketAmount," & _
            " ExtTbl_DedRate," & _
            " ExtTbl_ConRate," & _
            " ExtTbl_CreationDate," & _
            " ExtTbl_CreatedBy," & _
            " ExtTbl_AmendDate," & _
            " ExtTbl_AmendBy" & _
            " FROM PrSsExtraTaxTable Order by " & _
            " ExtTbl_Sequence Asc"
        Return GetData(Str)
    End Function
    'Protected Function GetAllPrSsDecreaseTable(ByVal Code As String) As DataSet
    '    Dim Str As String
    '    Str = " SELECT " & _
    '        " DecTbl_id," & _
    '        " DecTbl_Sequence," & _
    '        " DecTbl_Code," & _
    '        " DecTbl_BracketAmount," & _
    '        " DecTbl_DedRate," & _
    '        " DecTbl_CreationDate," & _
    '        " DecTbl_CreatedBy," & _
    '        " DecTbl_AmendDate," & _
    '        " DecTbl_AmendBy" & _
    '        " FROM PrSsDecreaseTable  " & _
    '        " Where  DecTbl_Code=" & enQuoteString(Code) & _
    '         " Order by DecTbl_Sequence Asc"
    '    Return GetData(Str)
    'End Function
    Protected Function GetAllPrSsDecreaseTable() As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " DecTbl_id," & _
            " DecTbl_Sequence," & _
            " DecTbl_Code," & _
            " DecTbl_BracketAmount," & _
            " DecTbl_DedRate," & _
            " DecTbl_CreationDate," & _
            " DecTbl_CreatedBy," & _
            " DecTbl_AmendDate," & _
            " DecTbl_AmendBy" & _
            " FROM PrSsDecreaseTable  " & _
            " Order by DecTbl_Sequence Asc"
        Return GetData(Str)
    End Function
    Protected Function GetITValueToDate(ByVal Emp As cPrMsEmployees, ByVal DedCod As cPrMsDeductionCodes, ByVal CurrentPeriod As cPrMsPeriodCodes) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double = 0
        Str = " SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
              " FROM PrTxTrxnHeader INNER JOIN" & _
              " PrTxTrxnLines ON PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id" & _
              " WHERE (PrTxTrxnLines.DedCod_Code = " & enQuoteString(DedCod.Code) & ")" & _
              " AND (PrTxTrxnHeader.Emp_Code = " & enQuoteString(Emp.Code) & ")" & _
              " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")"
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If

        Return Value

    End Function
    Protected Function DeleteAllEDCFromTrxnLines(ByVal HdrId As Integer) As Boolean
        Dim Str As String
        Dim i As Integer
        Str = "DELETE FROM PrTxTrxnLines WHERE TrxHdr_id=" & HdrId
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            Return False
        Else
            Return True
        End If
    End Function
    Protected Function HasFutureRecords(ByVal EmpCode As String, ByVal HdrId As Integer) As Boolean
        Dim Str As String
        Dim Ds As DataSet
        Dim F As Boolean = False
        Str = "Select * from prtxtrxnheader where emp_code=" & enQuoteString(EmpCode) & _
        " AND trxhdr_id >" & HdrId
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            f = True
        End If
        Return f
    End Function

    Protected Function DeleteAllAnnualLeaveOfHeaderId(ByVal HdrId As Integer) As Boolean
        Dim Str As String
        Dim i As Integer
        Str = "DELETE FROM PrTxEmployeeLeave WHERE Hdr_id=" & HdrId
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            Return False
        Else
            Return True
        End If
    End Function
    Protected Function DeleteAllLoanLinesOfHeaderId(ByVal HDRId As Integer) As Boolean
        Dim Str As String
        Dim i As Integer
        Str = "Delete from PrTxEmployeeLoan Where TrxHdr_Id=" & HDRId
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            Return False
        Else
            Return True
        End If
    End Function
    Protected Function DeleteAllAnnualLeaveOfEmployeeCode(ByVal EmpCode As String) As Boolean
        Dim Str As String
        Dim i As Integer
        Str = "DELETE FROM PrTxEmployeeLeave WHERE emp_code=" & enQuoteString(empcode)
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            Return False
        Else
            Return True
        End If
    End Function
    Protected Function DeleteTrxnHeader(ByVal HdrId As Integer) As Boolean
        Dim Str As String
        Dim i As Integer
        Str = "DELETE FROM PrTxTrxnHeader WHERE TrxHdr_id=" & HdrId
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            Return False
        Else
            Return True
        End If
    End Function
    Protected Function DeleteIR59(ByVal HdrId As Integer) As Boolean
        Dim Str As String
        Dim i As Integer
        Str = "DELETE FROM PrTxIr59 WHERE TrxHdr_id=" & HdrId
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            Return False
        Else
            Return True
        End If
    End Function
    Protected Function GetErnYTD(ByVal Emp As cPrMsEmployees, ByVal CurrentPeriod As cPrMsPeriodCodes) As Double
        Dim Str As String
        Dim ds As DataSet
        Dim Value As Double = 0
        Str = "Select SUM(TrxHdr_TotalErnPeriod) " & _
              " FROM PrTxTrxnHeader" & _
              " WHERE (Emp_Code = " & enQuoteString(Emp.Code) & ")" & _
              " AND (PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
              " AND (TrxHdr_Status='POST')"
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Value = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value

    End Function
    Protected Function GetNetYTD(ByVal Emp As cPrMsEmployees, ByVal CurrentPeriod As cPrMsPeriodCodes) As Double
        Dim Str As String
        Dim ds As DataSet
        Dim Value As Double = 0
        Str = "Select SUM(TrxHdr_NetSalary) " & _
              " FROM PrTxTrxnHeader" & _
              " WHERE (Emp_Code = " & enQuoteString(Emp.Code) & ")" & _
              " AND (PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
              " AND (TrxHdr_Status='POST')"
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Value = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value

    End Function
    Protected Function GetDedYTD(ByVal Emp As cPrMsEmployees, ByVal CurrentPeriod As cPrMsPeriodCodes) As Double
        Dim Str As String
        Dim ds As DataSet
        Dim Value As Double = 0

        Str = "Select SUM(TrxHdr_TotalDedPeriod) " & _
              " FROM PrTxTrxnHeader" & _
              " WHERE (Emp_Code = " & enQuoteString(Emp.Code) & ")" & _
              " AND (PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
              " AND (TrxHdr_Status='POST')"

        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Value = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value
    End Function
    Protected Function GetConYTD(ByVal Emp As cPrMsEmployees, ByVal CurrentPeriod As cPrMsPeriodCodes) As Double
        Dim Str As String
        Dim ds As DataSet
        Dim Value As Double = 0
        Str = "Select SUM(TrxHdr_TotalConPeriod) " & _
              " FROM PrTxTrxnHeader" & _
              " WHERE (Emp_Code = " & enQuoteString(Emp.Code) & ")" & _
              " AND (PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
              " AND (TrxHdr_Status='POST')"

        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Value = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value
    End Function
    Protected Function GetAllTrxnLines(ByVal HeaderId As Long) As DataSet
        Dim Str As String

        Str = " SELECT TrxLin_Id," & _
        " TrxHdr_Id," & _
        " TrxLin_Type," & _
        " ErnCod_Code," & _
        " DedCod_Code," & _
        " ConCod_Code," & _
        " TrxLin_PeriodValue," & _
        " TrxLin_YTDValue," & _
        " TrxLin_EDC," & _
        " TrxLin_EDCDescription," & _
        " TrxLin_ConsolDesc" & _
        " FROM PrTxTrxnLines" & _
        " WHERE (TrxHdr_Id = " & HeaderId & ")" & _
        " ORDER BY TrxLin_Id"

        Return GetData(Str)

    End Function
    Protected Function GetAllTrxnHeaders(ByVal Emp As cPrMsEmployees, ByVal CurrPeriod As cPrMsPeriodCodes) As DataSet
        Dim Str As String
        Str = " SELECT PrTxTrxnHeader.TrxHdr_Id," & _
            " PrMsPeriodGroups.PrdGpr_Year," & _
            " PrTxTrxnHeader.PrdCod_Code," & _
            " PrMsPeriodCodes.PrdCod_DescriptionL, " & _
            " PrTxTrxnHeader.TrxHdr_Date," & _
            " PrTxTrxnHeader.TrxHdr_Status," & _
            " PrTxTrxnHeader.TrxHdr_InterfaceStatus," & _
            " 0 As Selected " & _
            " FROM  PrTxTrxnHeader INNER JOIN" & _
            " PrMsPeriodCodes ON " & _
            " PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
            " AND PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code" & _
            " INNER JOIN" & _
            " PrMsPeriodGroups ON PrMsPeriodCodes.PrdGrp_Code = PrMsPeriodGroups.PrdGrp_Code " & _
            " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(Emp.Code) & ")" & _
            " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(CurrPeriod.PrdGrpCode) & ")" & _
            " Order by PrMsPeriodCodes.PrdCod_Sequence asc "
        Return GetData(Str)
    End Function
   
    Protected Function GetAllTrxnHeadersOfEmployee(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT PrTxTrxnHeader.TrxHdr_Id," & _
        " PrMsPeriodGroups.PrdGpr_Year," & _
        " PrTxTrxnHeader.PrdCod_Code, " & _
        " PrMsPeriodCodes.PrdCod_DescriptionL," & _
        " PrTxTrxnHeader.TrxHdr_Date," & _
        " PrTxTrxnHeader.TrxHdr_Status, " & _
        " PrTxTrxnHeader.TrxHdr_InterfaceStatus," & _
        " 0 As selected " & _
        " FROM PrTxTrxnHeader INNER JOIN" & _
        " PrMsPeriodCodes ON PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code AND " & _
        " PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code INNER JOIN" & _
        " PrMsPeriodGroups ON PrMsPeriodCodes.PrdGrp_Code = PrMsPeriodGroups.PrdGrp_Code" & _
        " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
        " ORDER BY PrMsPeriodGroups.PrdGpr_Year  desc,PrMsPeriodCodes.PrdCod_Sequence"
        Return GetData(Str)
    End Function
  

    Protected Function GetAllCompaniesFullRow(ByVal ComCode As String) As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " Com_Id, " & _
            "Com_Code," & _
            "Com_Name," & _
            "Com_NameS," & _
            "Com_TIC," & _
            "Com_TaxCard," & _
            "Com_SIRegNo," & _
            "Com_CurSymbol," & _
            "Com_Address1," & _
            "Com_Address2," & _
            "Com_Address3," & _
            "Com_Address4," & _
            "Com_Tel1," & _
            "Com_Tel2," & _
            "Com_Fax1," & _
            " Com_Fax2," & _
            " Com_AccountantPostCode," & _
            " Com_AccountantPOBox," & _
            " Com_AccountantTitle," & _
            " Com_AccTIC," & _
            " Com_AccIdentity," & _
            " Com_TICCategory," & _
            " Com_TICType, " & _
            " Com_BankCode," & _
            "Com_GLAnal1," & _
            "Com_GLAnal2," & _
            "Com_GLAnal3," & _
            "Com_GLAnal4," & _
            "Com_GLAnal5, " & _
            " Com_TSAccount, " & _
            " Com_TSAccountType, " & _
            " Com_TSBalAccount, " & _
            " Com_TSBalAccountType, " & _
            " Com_TSDefaultJob, " & _
            " Com_SI2, " & _
            " Com_SI3," & _
            " Com_SI4," & _
            " Com_SI5," & _
            " Com_BankCode2," & _
            " Com_BankCode3," & _
            " Com_BankCode4, " & _
            " Com_Logo," & _
            " Com_Stamp" & _
            "  FROM AdMsCompany" & _
            " Where Com_code=" & enQuoteString(ComCode)
        Return MyBase.GetData(Str)
    End Function
    Protected Function GetAllCompaniesFullRow() As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " Com_Id, " & _
            "Com_Code," & _
            "Com_Name," & _
            "Com_NameS," & _
            "Com_TIC," & _
            "Com_TaxCard," & _
            "Com_SIRegNo," & _
            "Com_CurSymbol," & _
            "Com_Address1," & _
            "Com_Address2," & _
            "Com_Address3," & _
            "Com_Address4," & _
            "Com_Tel1," & _
            "Com_Tel2," & _
            "Com_Fax1," & _
            " Com_Fax2," & _
            " Com_AccountantPostCode," & _
            " Com_AccountantPOBox," & _
            " Com_AccountantTitle," & _
            " Com_AccTIC," & _
            " Com_AccIdentity," & _
            " Com_TICCategory," & _
            " Com_TICType, " & _
            " Com_BankCode, " & _
            " Com_GLAnal1," & _
            " Com_GLAnal2," & _
            " Com_GLAnal3," & _
            " Com_GLAnal4," & _
            " Com_GLAnal5," & _
            " Com_TSAccount, " & _
            " Com_TSAccountType, " & _
            " Com_TSBalAccount, " & _
            " Com_TSBalAccountType, " & _
            " Com_TSDefaultJob, " & _
            " Com_SI2, " & _
            " Com_SI3," & _
            " Com_SI4," & _
            " Com_SI5," & _
            " Com_BankCode2," & _
            " Com_BankCode3," & _
            " Com_BankCode4," & _
            " Com_Logo, " & _
            " Com_Stamp" & _
            "  FROM AdMsCompany"

        Return MyBase.GetData(Str)
    End Function

    Protected Function GetReportPaySlipEmployee(ByVal EmpCode As String) As DataSet
        'SELECT  Emp_FullName ,Emp_Address1,Emp_Address2 ,Emp_Address3,
        'Emp_PostCode ,Cou_Code,Emp_Code,EmpAn1_Code,Emp_SocialInsNumber,Emp_IdentificationCard
        'FROM         PrMsEmployees
        'where Emp_Code='1'


        Dim Str As String
        Str = " SELECT  Emp_FullName ,Emp_Address1,Emp_Address2 ,Emp_Address3," & _
        " Emp_PostCode, Cou_Code, Emp_Code, EmpAn1_Code, Emp_SocialInsNumber, Emp_IdentificationCard,Emp_Telephone1,Emp_Telephone2 " & _
        " FROM PrMsEmployees " & _
        " where Emp_Code=" & Utils.enQuoteString(EmpCode)
        Return MyBase.GetData(Str)
    End Function

   
    Protected Function GetReportPaySlipHeader(ByVal EmpCode As String, ByVal PrdGrp_Code As String, ByVal PrdCod_Code As String) As DataSet
        'select PrdGrp_Code,PrdCod_Code,TrxHdr_PeriodUnits,TrxHdr_Overtime1,
        'TrxHdr_Overtime2,TrxHdr_TotalErnPeriod,TrxHdr_TotalErnYTD,TrxHdr_TotalDedPeriod,
        'TrxHdr_TotalDedYTD,TrxHdr_TotalConPeriod,TrxHdr_TotalConYTD
        ' from PrTxTrxnHeader
        'where TrxHdr_Status in ('POST','CALC')
        'and Emp_Code='1'
        'and PrdGrp_Code='200901'
        'and PrdCod_Code='200901'



        Dim Str As String
        Str = "select TrxHdr_Id,Emp_Code,PrdGrp_Code,PrdCod_Code,TrxHdr_PeriodUnits,TrxHdr_Overtime1, " & _
        "TrxHdr_Overtime2,TrxHdr_TotalErnPeriod,TrxHdr_TotalErnYTD,TrxHdr_TotalDedPeriod, " & _
        "TrxHdr_TotalDedYTD, TrxHdr_TotalConPeriod, TrxHdr_TotalConYTD,TrxHdr_Overtime3 " & _
        "from PrTxTrxnHeader " & _
        "where TrxHdr_Status in ('POST','CALC')" & _
        "and Emp_Code=" & Utils.enQuoteString(EmpCode) & _
        "and PrdGrp_Code=" & Utils.enQuoteString(PrdGrp_Code) & _
        "and PrdCod_Code=" & Utils.enQuoteString(PrdCod_Code)

        Return MyBase.GetData(Str)
    End Function

    Protected Function GetReportPaySlipLines(ByVal EmpCode As String, ByVal PrdGrp_Code As String, ByVal PrdCod_Code As String, ByVal Type As String) As DataSet
        'select TrxLin_Id,TrxLin_Type, ErnCod_Code,DedCod_Code,ConCod_Code,TrxLin_EDCDescription,
        'TrxLin_PeriodValue,TrxLin_YTDValue
        'from PrTxTrxnHeader as a, PrTxTrxnLines as b
        'where a.TrxHdr_Id = b. TrxHdr_Id
        'and a.TrxHdr_Status in ('POST','CALC')
        'and a.Emp_Code='1'
        'and a.PrdGrp_Code='200901'
        'and a.PrdCod_Code='200901'
        'order by TrxLin_Id

        Dim Str As String
        Str = "SELECT A.TrxHdr_Id," & _
        " TrxLin_Id," & _
        " TrxLin_Type," & _
        " ErnCod_Code," & _
        " DedCod_Code," & _
        " ConCod_Code," & _
        " TrxLin_EDCDescription, " & _
        " TrxLin_PeriodValue," & _
        " TrxLin_YTDValue," & _
        " TrxLin_ConsolDesc " & _
        " FROM PrTxTrxnHeader as A, PrTxTrxnLines as B" & _
        " WHERE(A.TrxHdr_Id = b.TrxHdr_Id)" & _
        " and A.TrxHdr_Status IN ('POST','CALC')" & _
        " and A.Emp_Code=" & Utils.enQuoteString(EmpCode) & _
        " and A.PrdGrp_Code=" & Utils.enQuoteString(PrdGrp_Code) & _
        " and A.PrdCod_Code=" & Utils.enQuoteString(PrdCod_Code) & _
        " and B.TrxLin_Type=" & Utils.enQuoteString(Type) & _
                " ORDER BY TrxLin_Id"

        Return MyBase.GetData(Str)
    End Function
    Protected Function FindYTD_EDC(ByVal Employee As cPrMsEmployees, ByVal Period As cPrMsPeriodCodes, ByVal EDCCode As String, ByVal EDCType As String) As Double
        Dim Str As String = ""
        Dim Ds As DataSet
        Dim Value As Double = 0
        If EDCType = "E" Then
            Str = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue) AS Expr1" & _
                  " FROM PrTxTrxnLines INNER JOIN" & _
                  " PrTxTrxnHeader ON" & _
                  " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                  " WHERE (PrTxTrxnHeader.Emp_Code =" & enQuoteString(Employee.Code) & ")" & _
                  " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
                  " AND (PrTxTrxnHeader.TrxHdr_Status = 'POST'" & _
                  " OR PrTxTrxnHeader.TrxHdr_Status = 'OUTS')" & _
                  " AND (PrTxTrxnLines.TrxLin_Type = " & enQuoteString(EDCType) & ")" & _
                  " AND (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(EDCCode) & ")"
        ElseIf EDCType = "D" Then
            Str = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue) AS Expr1" & _
                  " FROM PrTxTrxnLines INNER JOIN" & _
                  " PrTxTrxnHeader ON" & _
                  " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                  " WHERE (PrTxTrxnHeader.Emp_Code =" & enQuoteString(Employee.Code) & ")" & _
                  " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
                  " AND (PrTxTrxnHeader.TrxHdr_Status = 'POST'" & _
                  " OR PrTxTrxnHeader.TrxHdr_Status = 'OUTS')" & _
                  " AND (PrTxTrxnLines.TrxLin_Type = " & enQuoteString(EDCType) & ")" & _
                  " AND (PrTxTrxnLines.DedCod_Code = " & enQuoteString(EDCCode) & ")"
        ElseIf EDCType = "C" Then
            Str = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue) AS Expr1" & _
                  " FROM PrTxTrxnLines INNER JOIN" & _
                  " PrTxTrxnHeader ON" & _
                  " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                  " WHERE (PrTxTrxnHeader.Emp_Code =" & enQuoteString(Employee.Code) & ")" & _
                  " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
                  " AND (PrTxTrxnHeader.TrxHdr_Status = 'POST'" & _
                  " OR PrTxTrxnHeader.TrxHdr_Status = 'OUTS')" & _
                  " AND (PrTxTrxnLines.TrxLin_Type = " & enQuoteString(EDCType) & ")" & _
                  " AND (PrTxTrxnLines.ConCod_Code = " & enQuoteString(EDCCode) & ")"
        End If
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value
    End Function
    Protected Function FindYTD_EDC_2(ByVal EmpCode As String, ByVal Period As cPrMsPeriodCodes, ByVal EDCCode As String, ByVal EDCType As String) As Double
        Dim Str As String = ""
        Dim Ds As DataSet
        Dim Value As Double = 0
        If EDCType = "E" Then
            Str = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue) AS Expr1" & _
                  " FROM PrTxTrxnLines INNER JOIN" & _
                  " PrTxTrxnHeader ON" & _
                  " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                  " WHERE (PrTxTrxnHeader.Emp_Code =" & enQuoteString(EmpCode) & ")" & _
                  " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
                  " AND (PrTxTrxnLines.TrxLin_Type = " & enQuoteString(EDCType) & ")" & _
                  " AND (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(EDCCode) & ")"
        ElseIf EDCType = "D" Then
            Str = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue) AS Expr1" & _
                  " FROM PrTxTrxnLines INNER JOIN" & _
                  " PrTxTrxnHeader ON" & _
                  " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                  " WHERE (PrTxTrxnHeader.Emp_Code =" & enQuoteString(EmpCode) & ")" & _
                  " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
                  " AND (PrTxTrxnLines.TrxLin_Type = " & enQuoteString(EDCType) & ")" & _
                  " AND (PrTxTrxnLines.DedCod_Code = " & enQuoteString(EDCCode) & ")"
        ElseIf EDCType = "C" Then
            Str = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue) AS Expr1" & _
                  " FROM PrTxTrxnLines INNER JOIN" & _
                  " PrTxTrxnHeader ON" & _
                  " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                  " WHERE (PrTxTrxnHeader.Emp_Code =" & enQuoteString(EmpCode) & ")" & _
                  " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
                  " AND (PrTxTrxnLines.TrxLin_Type = " & enQuoteString(EDCType) & ")" & _
                  " AND (PrTxTrxnLines.ConCod_Code = " & enQuoteString(EDCCode) & ")"
        End If
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Value
    End Function

    Protected Function GetReportIR63AHeader(ByVal EmpCode As String, ByVal PrdGrp_Code As String, ByVal PrdCod_Code As String) As DataSet
        Dim Str As String
        'Str = "select a.TrxHdr_Id,Emp_Code,PrdGrp_Code,PrdCod_Code,TrxHdr_TotalErnYTD," & _
        '    " sum(TrxLin_PeriodValue) as TrxLin_PeriodValue,SUM(TrxLin_YTDValue) as TrxLin_YTDValue," & _
        '    " TrxLin_EDCDescription" & _
        '    " from PrTxTrxnHeader as a, PrTxTrxnLines as b" & _
        '    " where Emp_Code=" & Utils.enQuoteString(EmpCode) & _
        '    " and PrdGrp_Code=" & Utils.enQuoteString(PrdGrp_Code) & _
        '    " and PrdCod_Code=" & Utils.enQuoteString(PrdCod_Code) & _
        '    " and (" & _
        '    " DedCod_Code in ('D7','D5','D4') " & _
        '    " or ConCod_Code in ('C4','C3','C2') )" & _
        '    " and a.TrxHdr_Id = b.TrxHdr_Id" & _
        '    " group by a.TrxHdr_Id,Emp_Code,PrdGrp_Code,PrdCod_Code,TrxHdr_TotalErnYTD,TrxLin_EDCDescription"
        'Console.WriteLine(Str)

        Str = "select a.TrxHdr_Id,Emp_Code,PrdGrp_Code,PrdCod_Code,TrxHdr_TotalErnYTD," & _
              " isnull((select sum(TrxLin_YTDValue) from PrTxTrxnLines  as b,PrMsDeductionCodes as dc" & _
                    " where(b.TrxHdr_Id = a.TrxHdr_Id)" & _
                    " and dc.DedCod_Code=b.DedCod_Code" & _
                    " and dc.DedTyp_Code='PF'" & _
                    " and b.TrxLin_Type='D'" & _
                    " ),0) as deProvFund," & _
            " isnull((select sum(TrxLin_YTDValue) from PrTxTrxnLines  as b,PrMsDeductionCodes as dc" & _
                    " where(b.TrxHdr_Id = a.TrxHdr_Id)" & _
                    " and dc.DedCod_Code=b.DedCod_Code" & _
                    " and dc.DedTyp_Code='MF'" & _
                    " and b.TrxLin_Type='D'" & _
                 " ),0) as deMedFund," & _
            " isnull((select sum(TrxLin_YTDValue) from PrTxTrxnLines  as b,PrMsDeductionCodes as dc" & _
                    " where(b.TrxHdr_Id = a.TrxHdr_Id)" & _
                    " and dc.DedCod_Code=b.DedCod_Code" & _
                    " and dc.DedTyp_Code='SI'" & _
                    " and b.TrxLin_Type='D'" & _
                 " ),0) as deSIFund," & _
            " isnull((select sum(TrxLin_YTDValue) from dbo.PrTxTrxnLines as b,PrMsContributionCodes as cc" & _
                    " where(a.TrxHdr_Id = b.TrxHdr_Id)" & _
                    "  and cc.ConCod_Code=b.ConCod_Code" & _
                    " and cc.ConTyp_Code='PF'" & _
                    " and b.TrxLin_Type='C'" & _
                    " ),0) as  ContProvFund," & _
            " isnull((select sum(TrxLin_YTDValue) from dbo.PrTxTrxnLines as b,PrMsContributionCodes as cc" & _
                    " where(a.TrxHdr_Id = b.TrxHdr_Id)" & _
                    " and cc.ConCod_Code=b.ConCod_Code" & _
                    " and cc.ConTyp_Code='MF'" & _
                    " and b.TrxLin_Type='C'" & _
                    " ),0) as  ContMedFund," & _
            " isnull((select sum(TrxLin_YTDValue) from dbo.PrTxTrxnLines as b,PrMsContributionCodes as cc" & _
                    " where(a.TrxHdr_Id = b.TrxHdr_Id)" & _
                    " and cc.ConCod_Code=b.ConCod_Code" & _
                    " and cc.ConTyp_Code='SI'" & _
                    " and b.TrxLin_Type='C'" & _
                    " ),0) as  ContSocIns" & _
            " from PrTxTrxnHeader as a" & _
          " where Emp_Code=" & Utils.enQuoteString(EmpCode) & _
            " and PrdGrp_Code=" & Utils.enQuoteString(PrdGrp_Code) & _
            " and PrdCod_Code=" & Utils.enQuoteString(PrdCod_Code)
        Return MyBase.GetData(Str)
    End Function

    
    Protected Function GetReportIR63AEmpl(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = "select Emp_Code,Emp_FullName, Emp_Address1,Emp_Address2,Emp_Address3,Emp_PostCode," & _
              " Emp_SocialInsNumber, Emp_TaxID, Emp_StartDate, Emp_TerminateDate " & _
              " from PrMsEmployees " & _
              " where Emp_Code=" & Utils.enQuoteString(EmpCode)
        Return MyBase.GetData(Str)
    End Function


    Protected Function GetReportIR7(ByVal PrdGrp_Code As String, ByVal PrdCod_Code As String) As DataSet
        Dim Str As String
        Str = "select e.Emp_Code,PayTyp_Code,Emp_FullName,Emp_TaxID,Emp_Address1,Emp_Address2,Emp_Address3,Emp_PostCode,Emp_StartDate,Emp_TerminateDate,TrxHdr_TotalErnYTD as 'Local'," & _
                " 0 as Abroad, 0 as Allowances," & _
                " isnull((select sum(TrxLin_YTDValue) from PrTxTrxnLines  as b,PrMsDeductionCodes as dc" & _
                "   where b.TrxHdr_Id = a.TrxHdr_Id" & _
                "    and dc.DedCod_Code=b.DedCod_Code" & _
                "    and dc.DedTyp_Code='SI'" & _
                "    and b.TrxLin_Type='D'" & _
                " ),0) as SocInsurance," & _
                " isnull((select sum(TrxLin_YTDValue) from PrTxTrxnLines  as b,PrMsDeductionCodes as dc" & _
                "   where b.TrxHdr_Id = a.TrxHdr_Id " & _
                "    and dc.DedCod_Code=b.DedCod_Code" & _
                "    and dc.DedTyp_Code='PF'" & _
                "    and b.TrxLin_Type='D'" & _
                " ),0) as ProvFund, " & _
                " isnull((select Sum(TrxLin_YTDValue) from PrTxTrxnLines  as b,PrMsDeductionCodes as dc" & _
                "    where b.TrxHdr_Id = a.TrxHdr_Id " & _
                "    and dc.DedCod_Code=b.DedCod_Code" & _
                "    and dc.DedTyp_Code='MF'" & _
                "    and b.TrxLin_Type='D'" & _
                "  ),0) as MedFund," & _
                " isnull((select Sum(TrxLin_YTDValue) from PrTxTrxnLines  as b,PrMsDeductionCodes as dc" & _
                "    where b.TrxHdr_Id = a.TrxHdr_Id " & _
                "    and dc.DedCod_Code=b.DedCod_Code" & _
                "    and dc.DedTyp_Code='UM'" & _
                "    and b.TrxLin_Type='D'" & _
                "  ),0) as 'Union'," & _
                " Emp_OtherIncome1 + Emp_OtherIncome2 +Emp_OtherIncome3 as  OtherDiscounts," & _
                " 0 as IncomeTaxAmount " & _
                " from PrMsEmployees as e,PrTxTrxnHeader  as a " & _
                " where(e.Emp_Code = a.Emp_Code)" & _
                " and PrdGrp_Code=" & Utils.enQuoteString(PrdGrp_Code) & _
                " and PrdCod_Code=" & Utils.enQuoteString(PrdCod_Code)
        Return MyBase.GetData(Str)
    End Function


    Protected Function GetReportSIContributions(ByVal PrdGrp_Code As String, ByVal PrdCod_Code As String) As DataSet
        Dim Str As String
        Str = "select Emp_IdentificationCard,Emp_SocialInsNumber,Emp_AlienNumber,Emp_FullName,PayTyp_Code," & _
               " 0 as GrossEarnings," & _
               " 0 as InsurableEarnings," & _
               " 0 as SILeaveAmount," & _
               " 0 as SIAmount," & _
               " 0 as SocialTAmount," & _
               " 0 as IndUnemAmount," & _
               " '' as WeekHol," & _
               " Emp_TerminateDate " & _
               " from PrMsEmployees as e,PrTxTrxnHeader as a " & _
               " where e.Emp_Code = a.Emp_Code " & _
               " and PrdGrp_Code=" & Utils.enQuoteString(PrdGrp_Code) & _
               " and PrdCod_Code=" & Utils.enQuoteString(PrdCod_Code)
        Return MyBase.GetData(Str)
    End Function


    Protected Function GetReportPayrollAnalysis(ByVal PrdGrp_Code As String, ByVal PrdCod_Code As String) As DataSet
        Dim Str As String
        Str = "select a.TrxHdr_Id,e.Emp_Code,Emp_FullName," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b, PrMsEarningCodes as ec" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id" & _
               "    and ec.ErnCod_Code=b.ErnCod_Code" & _
               "    and ec.ErnTyp_Code='SA'" & _
               "    and b.TrxLin_Type='E'" & _
               "  ),0) as  EarnBasic," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b,PrMsDeductionCodes as dc" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id" & _
               "    and dc.DedCod_Code=b.DedCod_Code" & _
               "    and dc.DedTyp_Code='SI'" & _
               "    and b.TrxLin_Type='D'" & _
               " ),0) as  DeduSocIns," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b,PrMsContributionCodes as cc" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id" & _
               "    and cc.ConCod_Code=b.ConCod_Code" & _
               "    and cc.ConTyp_Code='SI'" & _
               "   and b.TrxLin_Type='C'" & _
               " ),0) as  ContSocIns," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b,PrMsDeductionCodes as dc" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id" & _
               "    and dc.DedCod_Code=b.DedCod_Code" & _
               "    and dc.DedTyp_Code='IT'" & _
               "    and b.TrxLin_Type='D'" & _
               " ),0) as  IncTax," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b,PrMsContributionCodes as cc" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id" & _
               "    and cc.ConCod_Code=b.ConCod_Code" & _
               "    and cc.ConTyp_Code='IN'" & _
               "    and b.TrxLin_Type='C'" & _
               "  ),0) as  IndUne," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b,PrMsDeductionCodes as dc" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id" & _
               "    and dc.DedCod_Code=b.DedCod_Code" & _
               "    and dc.DedTyp_Code='XX'" & _
               "    and b.TrxLin_Type='D'" & _
               " ),0) as  DeDefence," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b,PrMsContributionCodes as cc" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id " & _
               "    and cc.ConCod_Code=b.ConCod_Code" & _
               "    and cc.ConTyp_Code='XX'" & _
               "    and b.TrxLin_Type='C'" & _
               " ),0) as  CoDefence," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b, PrMsEarningCodes as ec" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id " & _
               "    and ec.ErnCod_Code=b.ErnCod_Code" & _
               "    and ec.ErnTyp_Code='OE'" & _
               "    and b.TrxLin_Type='E'" & _
               "  ),0) as  Bonus," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b,PrMsDeductionCodes as dc" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id " & _
               "    and dc.DedCod_Code=b.DedCod_Code" & _
               "    and dc.DedTyp_Code='PF'" & _
               "    and b.TrxLin_Type='D'" & _
               "  ),0) as  DeProvFund," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b,PrMsContributionCodes as cc" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id " & _
               "    and cc.ConCod_Code=b.ConCod_Code" & _
               "    and cc.ConTyp_Code='PF'" & _
               "    and b.TrxLin_Type='C'" & _
               " ),0) as  CoProvFund," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b, PrMsEarningCodes as ec" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id " & _
               "    and ec.ErnCod_Code=b.ErnCod_Code" & _
               "    and ec.ErnTyp_Code='AR'" & _
               "    and b.TrxLin_Type='E'" & _
               " ),0) as  Arrears," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b,PrMsDeductionCodes as dc" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id " & _
               "    and dc.DedCod_Code=b.DedCod_Code" & _
               "    and dc.DedTyp_Code='AD'" & _
               "    and b.TrxLin_Type='D'" & _
               " ),0) as  Advance," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b,PrMsDeductionCodes as dc" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id " & _
               "    and dc.DedCod_Code=b.DedCod_Code" & _
               "    and dc.DedTyp_Code='MF'" & _
               "    and b.TrxLin_Type='D'" & _
               " ),0) as  DeMedFund," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b,PrMsContributionCodes as cc" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id " & _
               "    and cc.ConCod_Code=b.ConCod_Code" & _
               "    and cc.ConTyp_Code='MF'" & _
               "    and b.TrxLin_Type='C'" & _
               " ) ,0)as  CoDMedFund," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b,PrMsDeductionCodes as dc" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id " & _
               "    and dc.DedCod_Code=b.DedCod_Code" & _
               "    and dc.DedTyp_Code='UM'" & _
               "    and b.TrxLin_Type='D'" & _
               " ),0) as  DeMunTax," & _
               " isnull((select sum(TrxLin_PeriodValue) from dbo.PrTxTrxnLines as b,PrMsDeductionCodes as dc" & _
               "    where a.TrxHdr_Id = b.TrxHdr_Id " & _
               "    and dc.DedCod_Code=b.DedCod_Code" & _
               "    and dc.DedTyp_Code='XX'" & _
               "    and b.TrxLin_Type='D'" & _
               "  ),0) as  Others," & _
               " 0 as InsEarn," & _
               " 0 as TaxEarn," & _
               " 0 as EmpCost" & _
               " from PrMsEmployees as e,PrTxTrxnHeader  as a " & _
               " where e.Emp_Code = a.Emp_Code " & _
               "  and PrdGrp_Code=" & Utils.enQuoteString(PrdGrp_Code) & _
               "  and PrdCod_Code=" & Utils.enQuoteString(PrdCod_Code)

        'Console.WriteLine(Str)
        Return MyBase.GetData(Str)
    End Function

    Protected Function CalculateUnitsFor13(ByVal emp As cPrMsEmployees, ByVal Period As cPrMsPeriodCodes) As Double
        Dim Str As String
        Dim Ds As DataSet
        'Str = " SELECT SUM(PrTxTrxnHeader.TrxHdr_PeriodUnits)" & _
        '    "     + SUM(PrTxTrxnHeader.TrxHdr_SIUnits) AS Exp1" & _
        '    " FROM PrMsPeriodCodes INNER JOIN" & _
        '    "     PrTxTrxnHeader ON" & _
        '    "     PrMsPeriodCodes.PrdCod_Code = PrTxTrxnHeader.PrdCod_Code" & _
        '    "     AND PrMsPeriodCodes.PrdGrp_Code = PrTxTrxnHeader.PrdGrp_Code" & _
        '    " WHERE  (PrTxTrxnHeader.Emp_Code = " & enQuoteString(emp.Code) & ")" & _
        '    " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
        '    " AND (PrMsPeriodCodes.PayCat_Code = 'K')" & _
        '    " AND (PrTxTrxnHeader.TrxHdr_Status='POST')"
        Str = " SELECT SUM(PrTxTrxnHeader.TrxHdr_AnnualUnits)" & _
            "     FROM PrMsPeriodCodes INNER JOIN" & _
            "     PrTxTrxnHeader ON" & _
            "     PrMsPeriodCodes.PrdCod_Code = PrTxTrxnHeader.PrdCod_Code" & _
            "     AND PrMsPeriodCodes.PrdGrp_Code = PrTxTrxnHeader.PrdGrp_Code" & _
            " WHERE  (PrTxTrxnHeader.Emp_Code = " & enQuoteString(emp.Code) & ")" & _
            " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
            " AND (PrMsPeriodCodes.PayCat_Code = 'K')" & _
            " AND (PrTxTrxnHeader.TrxHdr_Status='POST')"
        Ds = GetData(Str)
        Return DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
    End Function
    Protected Function CalculateSalaryFor13(ByVal emp As cPrMsEmployees, ByVal Period As cPrMsPeriodCodes) As DataSet
        Dim Str As String
        Dim Ds As DataSet
        Str = " SELECT PrTxTrxnHeader.TrxHdr_MonthlySalary" & _
            "     FROM PrMsPeriodCodes INNER JOIN" & _
            "     PrTxTrxnHeader ON" & _
            "     PrMsPeriodCodes.PrdCod_Code = PrTxTrxnHeader.PrdCod_Code" & _
            "     AND PrMsPeriodCodes.PrdGrp_Code = PrTxTrxnHeader.PrdGrp_Code" & _
            " WHERE  (PrTxTrxnHeader.Emp_Code = " & enQuoteString(emp.Code) & ")" & _
            " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
            " AND (PrMsPeriodCodes.PayCat_Code = 'K')" & _
            " AND (PrTxTrxnHeader.TrxHdr_Status='POST')"
        Return GetData(Str)

    End Function
    Protected Function CalculateEarningsFor13SalaryAverage(ByVal emp As cPrMsEmployees, ByVal Period As cPrMsPeriodCodes, ByVal EarningCode As String) As DataSet
        Dim Str As String


        Str = " SELECT PrTxTrxnLines.TrxLin_PeriodValue " & _
        " FROM PrMsPeriodCodes INNER JOIN" & _
        " PrTxTrxnHeader ON PrMsPeriodCodes.PrdCod_Code = PrTxTrxnHeader.PrdCod_Code AND " & _
        " PrMsPeriodCodes.PrdGrp_Code = PrTxTrxnHeader.PrdGrp_Code INNER JOIN" & _
        " PrTxTrxnLines ON PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id" & _
        " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(emp.Code) & ")" & _
        " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
        " AND (PrMsPeriodCodes.PayCat_Code = 'K')  " & _
        " AND (PrTxTrxnHeader.TrxHdr_Status = 'POST') " & _
        " AND (PrTxTrxnLines.TrxLin_Type = 'E') " & _
        " AND (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(EarningCode) & ")"

        Return GetData(Str)

    End Function
    Protected Function CalculateNormalUnitsForPeriodsAfter(ByVal CurrentPeriod As cPrMsPeriodCodes) As Double
        Dim str As String
        Dim ds As DataSet
        str = " SELECT SUM(PrdCod_PeriodUnits)" & _
        " FROM PrMsPeriodCodes" & _
        " WHERE(PrdCod_Sequence > " & CurrentPeriod.Sequence & ")" & _
        " AND (PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
        " AND (PayCat_Code = 'K')"


        ds = GetData(str)
        Return DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
    End Function
    Protected Function CalculateUnitsFor14(ByVal emp As cPrMsEmployees, ByVal Period As cPrMsPeriodCodes) As Double
        Dim Str As String
        Dim Ds As DataSet

        Dim sDateFrom As String = Format(Period.DateFrom, "yyyy-MM-dd")
        Dim sDateTo As String = Format(Period.DateTo, "yyyy-MM-dd")


        'Str = " SELECT SUM(PrTxTrxnHeader.TrxHdr_PeriodUnits)" & _
        '    "  + SUM(PrTxTrxnHeader.TrxHdr_SIUnits) AS Expr1" & _
        '    " FROM   PrTxTrxnHeader INNER JOIN" & _
        '    " PrMsPeriodCodes ON " & _
        '    " PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code AND " & _
        '    " PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
        '    " WHERE  (PrTxTrxnHeader.Emp_Code = " & enQuoteString(emp.Code) & ")" & _
        '    " AND (PrMsPeriodCodes.PayCat_Code = 'K')" & _
        '    " AND (PrTxTrxnHeader.TrxHdr_Date >= " & enQuoteString(Utils.ChangeDateFormatForSearch(sDateFrom)) & ") AND " & _
        '    " (PrTxTrxnHeader.TrxHdr_Date <= " & enQuoteString(Utils.ChangeDateFormatForSearch(sDateTo)) & ")" & _
        '    " AND (PrTxTrxnHeader.TrxHdr_Status='POST')"
        Str = " SELECT SUM(PrTxTrxnHeader.TrxHdr_AnnualUnits)" & _
                 "     FROM PrMsPeriodCodes INNER JOIN" & _
                 "     PrTxTrxnHeader ON" & _
                 "     PrMsPeriodCodes.PrdCod_Code = PrTxTrxnHeader.PrdCod_Code" & _
                 "     AND PrMsPeriodCodes.PrdGrp_Code = PrTxTrxnHeader.PrdGrp_Code" & _
                 " WHERE  (PrTxTrxnHeader.Emp_Code = " & enQuoteString(emp.Code) & ")" & _
                 " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
                 " AND (PrMsPeriodCodes.PayCat_Code = 'K')" & _
                 " AND (PrTxTrxnHeader.TrxHdr_Status='POST')"
        Ds = GetData(Str)
        Return DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
       

    End Function
    Protected Function CalculateSalaryFor14(ByVal emp As cPrMsEmployees, ByVal Period As cPrMsPeriodCodes) As DataSet
        Dim Str As String
        Dim Ds As DataSet

        Dim sDateFrom As String = Format(Period.DateFrom, "yyyy-MM-dd")
        Dim sDateTo As String = Format(Period.DateTo, "yyyy-MM-dd")



        Str = " SELECT SUM(PrTxTrxnHeader.TrxHdr_AnnualUnits)" & _
                 "     FROM PrMsPeriodCodes INNER JOIN" & _
                 "     PrTxTrxnHeader ON" & _
                 "     PrMsPeriodCodes.PrdCod_Code = PrTxTrxnHeader.PrdCod_Code" & _
                 "     AND PrMsPeriodCodes.PrdGrp_Code = PrTxTrxnHeader.PrdGrp_Code" & _
                 " WHERE  (PrTxTrxnHeader.Emp_Code = " & enQuoteString(emp.Code) & ")" & _
                 " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
                 " AND (PrMsPeriodCodes.PayCat_Code = 'K')" & _
                 " AND (PrTxTrxnHeader.TrxHdr_Status='POST')"
        Return GetData(Str)


    End Function
    Protected Function CalculateNormalUnitsForPeriodsAfterByDate(ByVal Period As cPrMsPeriodCodes) As Double
        Dim str As String
        Dim ds As DataSet
        Dim sDateFrom As String = Format(Period.DateFrom, "yyyy-MM-dd")
        Dim sDateTo As String = Format(Period.DateTo, "yyyy-MM-dd")

        str = " SELECT SUM(PrdCod_PeriodUnits)" & _
        " FROM PrMsPeriodCodes" & _
        " WHERE (PrdCod_Sequence > " & Period.Sequence & ")" & _
        " AND  (PrdCod_DateFrom >=" & enQuoteString(Utils.ChangeDateFormatForSearch(sDateFrom)) & ") AND " & _
        " (PrdCod_DateTo <=" & enQuoteString(Utils.ChangeDateFormatForSearch(sDateTo)) & ") AND " & _
        " AND (PayCat_Code = 'K')"

        ds = GetData(str)
        Return DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
    End Function
    Protected Function GetAllActiveEmployeesForPeriod(ByVal Period As cPrMsPeriodCodes) As DataSet
        Dim Str As String
        Str = " SELECT PrMsEmployees.Emp_Code " & _
              " FROM PrMsEmployees " & _
              " WHERE TemGrp_Code in" & _
              " (SELECT TemGrp_Code FROM PrMsPeriodGroups" & _
              " WHERE PrdGrp_Code=" & enQuoteString(Period.PrdGrpCode) & ")" & _
              " AND Emp_Status='A'" & _
             " AND Emp_NewEmployee='0'"


        Return GetData(Str)
    End Function
    Protected Function GetAllTrxnsForPeriodByStatus(ByVal Period As cPrMsPeriodCodes, ByVal Status As String, ByVal InterStatus As String) As DataSet
        Dim Str As String
        Dim PerGrp As New cPrMsPeriodGroups(Period.PrdGrpCode)
        Str = " SELECT * FROM PrTxTrxnHeader" & _
               " WHERE PrdGrp_Code=" & enQuoteString(Period.PrdGrpCode) & _
               " AND PrdCod_Code=" & enQuoteString(Period.Code) & _
               " AND TrxHdr_Status=" & enQuoteString(Status) & _
               " AND TrxHdr_InterfaceStatus=" & enQuoteString(Status) & _
               " AND TemGrp_Code =" & enQuoteString(PerGrp.TemGrpCode)

        Return GetData(Str)
    End Function
    Protected Function OpenNextPeriodIfExist(ByVal Period As cPrMsPeriodCodes) As Boolean
        Dim ContinueFlag As Boolean = False
        Dim Str As String
        Dim flag As Boolean = True
        Dim Ds As DataSet
        Str = " SELECT" & _
               " PrdCod_Code," & _
               " PrdGrp_Code," & _
               " PrdCod_Status," & _
               " PrdCod_Number," & _
               " PrdCod_DescriptionL," & _
               " PrdCod_DescriptionS," & _
               " PrdCod_Sequence," & _
               " SinPrd_Code," & _
               " PrdCod_DateFrom," & _
               " PrdCod_DateTo," & _
               " PrdCod_PeriodUnits," & _
               " PayCat_Code," & _
               " PrdCod_PeriodUnits2 " & _
           "  FROM PrMsPeriodCodes" & _
           "  WHERE PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & _
           "  AND PrdCod_Sequence =" & Period.Sequence + 1

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Dim P As New cPrMsPeriodCodes(Ds.Tables(0).Rows(0))
            P.Status = "O"
            If Not P.Save Then
                flag = False
            End If
        Else
            Dim Ar() As String
            'Ar = Global1.UserName.Split("\")
            'Global1.UserName = Ar(0)
            If Global1.UserName = "sa" Or Global1.UserName = "nodal" Or Global1.UserName = "insoft" Or UCase(Global1.UserName) = UCase("HQ\nodal") Then
                ContinueFlag = True
            Else
                ContinueFlag = False
                Dim DsEOY As New DataSet
                DsEOY = Global1.Business.GetParameter("System", "EOY")
                If CheckDataSet(DsEOY) Then
                    Dim Parx As New cPrSsParameters(DsEOY.Tables(0).Rows(0))
                    If Parx.Value1 = "13" Then
                        ContinueFlag = True
                    End If
                End If

            End If
            'ContinueFlag = True
            If Not ContinueFlag Then
                MsgBox("In Order to open Next year Please contact iNsoft Ltd.", MsgBoxStyle.Information)
                Cursor.Current = Cursors.Default
                flag = False
                Exit Function
            End If
            'Dim ans As New MsgBoxResult
            'ans = MsgBox("Do you want to Open New Year", MsgBoxStyle.YesNo)
            flag = True

            Dim PeriodGroup As New cPrMsPeriodGroups(Period.PrdGrpCode)
            Dim Year As Integer = PeriodGroup.Year
            Dim NewYear As Integer
            NewYear = Year + 1
            Dim NewPeriodGroup As New cPrMsPeriodGroups
            NewPeriodGroup.Code = Replace(PeriodGroup.Code, Year.ToString, NewYear.ToString)
            NewPeriodGroup.Year = NewYear
            NewPeriodGroup.Status = PeriodGroup.Status
            NewPeriodGroup.TemGrpCode = PeriodGroup.TemGrpCode
            NewPeriodGroup.DescriptionL = Replace(PeriodGroup.DescriptionL, Year.ToString, NewYear.ToString)
            If Not NewPeriodGroup.Save() Then
                flag = False
            End If

            Dim Str1 As String
            Str1 = "INSERT INTO PrMsPeriodCodes " & _
            " (PrdCod_Code, " & _
            " PrdGrp_Code, " & _
            " PrdCod_Number, " & _
            " PrdCod_Status, " & _
            " PrdCod_DescriptionL, " & _
            " PrdCod_DescriptionS, " & _
            " PrdCod_Sequence, " & _
            " SinPrd_Code,  " & _
            " PrdCod_DateFrom, " & _
            " PrdCod_DateTo, " & _
            " PrdCod_PeriodUnits, " & _
            " PayCat_Code, " & _
            " PrdCod_PeriodUnits2 ) " & _
            " SELECT  Replace(PrdCod_Code," & enQuoteString(Year.ToString) & "," & enQuoteString(NewYear.ToString) & ") ," & _
            enQuoteString(NewPeriodGroup.Code) & ", " & _
            " PrdCod_Number, " & _
            " PrdCod_Status, " & _
            " PrdCod_DescriptionL, " & _
            " PrdCod_DescriptionS, " & _
            " PrdCod_Sequence,  " & _
            " SinPrd_Code,  " & _
            " dateadd(year,1,PrdCod_DateFrom), " & _
            " dateadd(year,1,PrdCod_DateTo), " & _
            " PrdCod_PeriodUnits, " & _
            " PayCat_Code, " & _
            " PrdCod_PeriodUnits2 " & _
            " FROM   PrMsPeriodCodes AS PrMsPeriodCodes_1 " & _
            " Where  PrMsPeriodCodes_1.PrdGrp_Code =" & enQuoteString(PeriodGroup.Code)

            If MyBase.ExecuteNonQuery(Str1) <= 0 Then
                flag = False
            End If


            Dim FirstPeriod As New cPrMsPeriodCodes(NewPeriodGroup.Year & "01", NewPeriodGroup.Code)
            FirstPeriod.Status = "O"
            If Not FirstPeriod.Save() Then
                flag = False
            End If

            Str1 = " INSERT INTO PrMsPeriodEarnings" & _
                "( PrdCod_Code," & _
                " PrdGrp_Code," & _
                " ErnCod_Code," & _
                " PrdErn_IsActive)" & _
                " SELECT  Replace(PrdCod_Code," & enQuoteString(Year.ToString) & "," & enQuoteString(NewYear.ToString) & ") ," & _
                enQuoteString(NewPeriodGroup.Code) & ", " & _
                " ErnCod_Code," & _
                " PrdErn_IsActive" & _
                " FROM PrMsPeriodEarnings AS PrMsPeriodEarnings_1" & _
                " Where  PrMsPeriodEarnings_1.PrdGrp_Code =" & enQuoteString(PeriodGroup.Code)

            If MyBase.ExecuteNonQuery(Str1) < 0 Then
                flag = False
            End If

            Str1 = "INSERT INTO PrMsPeriodDeductions" & _
            " (PrdCod_Code," & _
            " PrdGrp_Code, " & _
            " DedCod_Code, " & _
            " PrdDed_IsActive)" & _
            " SELECT  Replace(PrdCod_Code," & enQuoteString(Year.ToString) & "," & enQuoteString(NewYear.ToString) & ") ," & _
              enQuoteString(NewPeriodGroup.Code) & ", " & _
            " DedCod_Code," & _
            " PrdDed_IsActive" & _
            " FROM PrMsPeriodDeductions AS PrMsPeriodDeductions_1" & _
            " Where  PrMsPeriodDeductions_1.PrdGrp_Code =" & enQuoteString(PeriodGroup.Code)

            If MyBase.ExecuteNonQuery(Str1) < 0 Then
                flag = False
            End If

            Str1 = "INSERT INTO PrMsPeriodContributions" & _
            " (PrdCod_Code, " & _
            " PrdGrp_Code, " & _
            " ConCod_Code," & _
            " PrdCon_IsActive)" & _
            " SELECT  Replace(PrdCod_Code," & enQuoteString(Year.ToString) & "," & enQuoteString(NewYear.ToString) & ") ," & _
              enQuoteString(NewPeriodGroup.Code) & ", " & _
            " ConCod_Code," & _
            " PrdCon_IsActive" & _
            " FROM PrMsPeriodContributions AS PrMsPeriodContributions_1" & _
            " Where  PrMsPeriodContributions_1.PrdGrp_Code =" & enQuoteString(PeriodGroup.Code)

            If MyBase.ExecuteNonQuery(Str1) < 0 Then
                flag = False
            End If
            'Dim DsEmpDis As DataSet
            '''''''''''''''''''''''''''''''''''''''''''''''''
            Dim PFrom As New cPrMsPeriodGroups
            Dim PTo As New cPrMsPeriodGroups

            PFrom = PeriodGroup
            PTo = NewPeriodGroup

            If PFrom.TemGrpCode = PTo.TemGrpCode Then
                Dim DsDis As DataSet
                DsDis = Global1.Business.GetAllPrTxdiscountsForPeriodGroup(PFrom.Code)

                If CheckDataSet(DsDis) Then
                    Dim i As Integer
                    Dim Exx As New System.Exception
                    'Global1.Business.BeginTransaction()
                    Try
                        For i = 0 To DsDis.Tables(0).Rows.Count - 1
                            Dim Disc1 As New cPrTxEmployeeDiscounts(DsDis.Tables(0).Rows(i))
                            Dim Disc2 As New cPrTxEmployeeDiscounts(Disc1.Emp_Code, PTo.Code)
                            If Disc2.Id = 0 Then
                                Disc2 = New cPrTxEmployeeDiscounts(DsDis.Tables(0).Rows(i))
                                Disc2.Id = 0
                                Disc2.PrdGrp_Code = PTo.Code
                                Disc2.CreationDate = Now
                                Disc2.AmendDate = Now
                                Disc2.Usr_Id = Global1.GLBUserId
                                If Not Disc2.Save() Then
                                    Throw Exx
                                End If
                            End If
                        Next
                        'Global1.Business.CommitTransaction()
                        'MsgBox("Succefull Copy", MsgBoxStyle.Information)
                    Catch ex As Exception
                        '  Global1.Business.Rollback()
                        Utils.ShowException(ex)
                        flag = False 'MsgBox("Unable to Copy Discounts", MsgBoxStyle.Critical)
                    End Try
                End If
            Else
                MsgBox("Template Group of Period From and Period To must Much in Order to Proceed with copy", MsgBoxStyle.Information)
            End If

            If Not flag Then
                MsgBox("Unable to Create New Year Periods, Please Contact iNsoft", MsgBoxStyle.Critical)
            End If
        End If

        Return flag

    End Function
    Protected Function CheckIfLastPeriod(ByVal Period As cPrMsPeriodCodes) As Boolean
        Dim Ds As DataSet
        Dim Str As String
        Str = " SELECT" & _
               " PrdCod_Code," & _
               " PrdGrp_Code," & _
               " PrdCod_Status," & _
               " PrdCod_Number," & _
               " PrdCod_DescriptionL," & _
               " PrdCod_DescriptionS," & _
               " PrdCod_Sequence," & _
               " SinPrd_Code," & _
               " PrdCod_DateFrom," & _
               " PrdCod_DateTo," & _
               " PrdCod_PeriodUnits," & _
               " PayCat_Code," & _
               " PrdCod_PeriodUnits2 " & _
           "  FROM PrMsPeriodCodes" & _
           "  WHERE PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & _
           "  AND PrdCod_Sequence =" & Period.Sequence + 1

        Ds = GetData(Str)
    End Function
    Protected Function GetTaTrxnLines(ByVal EmpCode As String, ByVal fromDate As Date, ByVal ToDate As Date) As DataSet
        Dim Dfrom As String = Format(fromDate, "yyyy-MM-dd")
        Dfrom = Utils.ChangeDateFormatForSearch(Dfrom) & " 00:00:00"
        Dim DTo As String = Format(ToDate, "yyyy-MM-dd")
        DTo = Utils.ChangeDateFormatForSearch(DTo) & " 23:59:59"

        Dim Str As String
        Str = " SELECT TrxLin_Id," & _
         " TrxLin_Date," & _
         " Emp_Code," & _
         " TrxLin_Day," & _
         " TrxLin_FromTime," & _
         " TrxLin_ToTime," & _
         " TrxLin_TotalTime," & _
         " WrkGrp_Code," & _
         " WrkCod_Code," & _
         " Usr_IdCreate," & _
         " Usr_IdLastUpdate," & _
         " TrxLin_Created," & _
         " TrxLin_LastUpdate," & _
         " TrxLin_Status," & _
         " TrxLin_AnalCode," & _
         " TrxLin_AnalDesc" & _
         " FROM TaTxTrxnLines" & _
         " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
         " AND (TrxLin_Date >=" & enQuoteString(Dfrom) & " )" & _
         " AND (TrxLin_Date <=" & enQuoteString(DTo) & " )" & _
         " ORDER BY Emp_Code," & _
         " TrxLin_Day," & _
         " WrkGrp_Code," & _
         " WrkCod_Code"


        Return GetData(Str)
    End Function
    Protected Function GetTaTrxnLines2(ByVal EmpCode As String, ByVal fromDate As Date, ByVal ToDate As Date) As DataSet
        Dim Dfrom As String = Format(fromDate, "yyyy-MM-dd")
        Dfrom = Utils.ChangeDateFormatForSearch(Dfrom) & " 00:00:00"
        Dim DTo As String = Format(ToDate, "yyyy-MM-dd")
        DTo = Utils.ChangeDateFormatForSearch(DTo) & " 23:59:59"


        Dim Str As String
        Str = " SELECT TrxLin_Id," & _
         " TrxLin_Date," & _
         " Emp_Code," & _
         " TrxLin_Day," & _
         " TrxLin_FromTime," & _
         " TrxLin_ToTime," & _
         " TrxLin_TotalTime," & _
         " WrkGrp_Code," & _
         " WrkCod_Code," & _
         " Usr_IdCreate," & _
         " Usr_IdLastUpdate," & _
         " TrxLin_Created," & _
         " TrxLin_LastUpdate," & _
         " TrxLin_Status," & _
         " TrxLin_AnalCode," & _
         " TrxLin_AnalDesc" & _
         " FROM TaTxTrxnLines2" & _
         " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
         " AND (TrxLin_Date >=" & enQuoteString(Dfrom) & " )" & _
         " AND (TrxLin_Date <=" & enQuoteString(DTo) & " )" & _
         " ORDER BY Emp_Code," & _
         " TrxLin_Day," & _
         " WrkGrp_Code," & _
         " WrkCod_Code"


        Return GetData(Str)
    End Function
    Protected Function GetTaTrxnLines2_SumPerAnalysis(ByVal EmpCode As String, ByVal fromDate As Date, ByVal ToDate As Date) As DataSet
        Dim Dfrom As String = Format(fromDate, "yyyy-MM-dd")
        Dfrom = Utils.ChangeDateFormatForSearch(Dfrom) & " 00:00:00"
        Dim DTo As String = Format(ToDate, "yyyy-MM-dd")
        DTo = Utils.ChangeDateFormatForSearch(DTo) & " 23:59:59"

        Dim Str As String
        Str = "select SUM(trxlin_totaltime)," & _
        " TrxLin_AnalCode  " & _
        " from TaTxTrxnLines2 " & _
        " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
        " AND (TrxLin_Date >=" & enQuoteString(Dfrom) & " )" & _
        " AND (TrxLin_Date <=" & enQuoteString(DTo) & " )" & _
        " AND (trxlin_totaltime >0)" & _
        " Group by TrxLin_AnalCode"

        Return GetData(Str)
    End Function
    Protected Function GetTaTrxnLines2_Sum(ByVal EmpCode As String, ByVal fromDate As Date, ByVal ToDate As Date) As Double
        Dim Dfrom As String = Format(fromDate, "yyyy-MM-dd")
        Dfrom = Utils.ChangeDateFormatForSearch(Dfrom) & " 00:00:00"
        Dim DTo As String = Format(ToDate, "yyyy-MM-dd")
        DTo = Utils.ChangeDateFormatForSearch(DTo) & " 23:59:59"
        Dim Ds As DataSet
        Dim total As Double = 0

        Dim Str As String
        Str = "select SUM(trxlin_totaltime)" & _
        " from TaTxTrxnLines2 " & _
        " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
        " AND (TrxLin_Date >=" & enQuoteString(Dfrom) & " )" & _
        " AND (TrxLin_Date <=" & enQuoteString(DTo) & " )"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            total = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return total
    End Function
    Protected Function GetAllWorkCodes() As DataSet
        Dim Str As String

        Str = "SELECT WrkCod_Id," & _
        " WrkCod_Code," & _
        " WrkGrp_Code," & _
        " WrkCod_Desc," & _
        " WrkCod_IsActive," & _
        " WrkCod_Type," & _
        " Int_Code" & _
        " FROM TaMsWorkCodes" & _
        " ORDER BY WrkCod_Code," & _
        " WrkGrp_Code"

        Return MyBase.GetData(Str)
    End Function
    Protected Function GetAllTaEmployees(ByVal EmployeeCode As String) As DataSet
todo:   ' check for status in trxnheader

        Dim Str As String = ""
        Dim Str2 As String = ""
        Str = " SELECT" & _
                " Emp_Code," & _
                " Emp_Status," & _
                " PayTyp_Code," & _
                " TemGrp_Code," & _
                " EmpSta_Code," & _
                " Emp_Title," & _
                " Emp_LastName," & _
                " Emp_FirstName," & _
                " Emp_FullName," & _
                " Emp_Sex," & _
                " Emp_BirthDate," & _
                " MarSta_Code," & _
                " Emp_Address1," & _
                " Emp_Address2," & _
                " Emp_Address3," & _
                " Emp_PostCode," & _
                " Emp_Telephone1," & _
                " Emp_Telephone2," & _
                " Emp_Email," & _
                " Emp_SocialInsNumber," & _
                " ComSin_EmpSocialInsNo," & _
                " Emp_IdentificationCard," & _
                " Emp_TaxID," & _
                " Emp_PassportNumber," & _
                " Emp_AlienNumber," & _
                " TicTyp_Code," & _
                " EmpAn1_Code," & _
                " EmpAn2_Code," & _
                " EmpAn3_Code," & _
                " EmpAn4_Code," & _
                " EmpAn5_Code," & _
                " Uni_Code," & _
                " Cou_Code," & _
                " EmpPos_Code," & _
                " Sic_Code," & _
                " EmpCmm_Code," & _
                " PayUni_Code," & _
                " Emp_PeriodUnits," & _
                " Emp_AnnualUnits," & _
                " Cur_Code," & _
                " PmtMth_Code," & _
                " Bnk_Code," & _
                " Emp_BankAccount," & _
                " Bnk_CodeCo," & _
                " Emp_BankAccountCo," & _
                " Emp_StartDate," & _
                " Emp_TerminateDate," & _
                " Emp_OtherIncome1," & _
                " Emp_OtherIncome2," & _
                " Emp_OtherIncome3," & _
                " Emp_PreviousEarnings," & _
                " Emp_PrevSIDeduct," & _
                " Emp_PrevSIContribute," & _
                " Emp_PrevITDeduct," & _
                " Emp_PrevPFDeduct," & _
                " ProFnd_Code," & _
                " MedFnd_Code," & _
                " SocInc_Code," & _
                " Ind_Code," & _
                " Une_Code," & _
                " SocCoh_Code," & _
                " Emp_CreationDate," & _
                " Emp_CreatedBy," & _
                " Emp_AmendDate," & _
                " Emp_AmendBy" & _
                "  FROM PrMsEmployees" & _
                " Where Emp_Code=" & enQuoteString(EmployeeCode) & _
                " AND Emp_Status='A'"
        Str = Str
        Return GetData(Str)
    End Function
    Protected Function UpdateTaTxTrxnLines(ByVal EmpCode As String, ByVal FromDate As Date, ByVal ToDate As Date, ByVal Status As String) As Integer
        Dim Str As String
        Dim Flag As Boolean = True
        Dim sDateFrom As String
        Dim sDateTo As String
        sDateFrom = Format(FromDate, "yyyy-MM-dd")
        sDateTo = Format(ToDate, "yyyy-MM-dd")

        Dim i As Integer


        Str = " INSERT INTO TaTxTrxnLines2" & _
        " (TrxLin_Date," & _
        " Emp_Code," & _
        " TrxLin_Day," & _
        " TrxLin_FromTime," & _
        " TrxLin_ToTime," & _
        " TrxLin_TotalTime," & _
        " WrkGrp_Code," & _
        " WrkCod_Code," & _
        " Usr_IdCreate, " & _
        " Usr_IdLastUpdate," & _
        " TrxLin_Created," & _
        " TrxLin_LastUpdate," & _
        " TrxLin_Status," & _
        " TrxLin_AnalCode," & _
        " TrxLin_AnalDesc)" & _
        " SELECT TrxLin_Date," & _
        " Emp_Code," & _
        " TrxLin_Day," & _
        " TrxLin_FromTime," & _
        " TrxLin_ToTime," & _
        " TrxLin_TotalTime," & _
        " WrkGrp_Code," & _
        " WrkCod_Code," & _
        " Usr_IdCreate, " & _
        " Usr_IdLastUpdate," & _
        " TrxLin_Created," & _
        " TrxLin_LastUpdate," & _
        " 'POST'," & _
        " TrxLin_AnalCode," & _
        " TrxLin_AnalDesc" & _
        " FROM TaTxTrxnLines" & _
        " WHERE Emp_Code=" & enQuoteString(EmpCode) & _
        " AND (TrxLin_Date>=" & enQuoteString(Utils.ChangeDateFormatForSearch(sDateFrom)) & _
        " AND TrxLin_Date<=" & enQuoteString(Utils.ChangeDateFormatForSearch(sDateTo)) & ")" & _
        " AND TrxLin_Status='OUTS'"


        i = MyBase.ExecuteNonQuery(Str)
        If i <> -1 Then

            Str = "UPDATE TaTxTrxnLines" & _
            " Set TrxLin_Status=" & enQuoteString(Status) & _
            " WHERE Emp_Code=" & enQuoteString(EmpCode) & _
            " AND (TrxLin_Date>=" & enQuoteString(Utils.ChangeDateFormatForSearch(sDateFrom)) & _
            " AND TrxLin_Date<=" & enQuoteString(Utils.ChangeDateFormatForSearch(sDateTo)) & ")" & _
            " AND TrxLin_Status='OUTS'"
            i = MyBase.ExecuteNonQuery(Str)
            
        End If


        Return i



    End Function
    Protected Function UpdateTaTxTrxnLines2(ByVal EmpCode As String, ByVal MyDate As Date, ByVal Status As String) As Integer
        Dim Str As String
        Dim Flag As Boolean = True
        Dim sMyDate As String
        sMyDate = Format(MyDate, "yyyy-MM-dd")

        Dim i As Integer




        Str = "UPDATE TaTxTrxnLines2" & _
        " Set TrxLin_Status=" & enQuoteString(Status) & _
        " WHERE Emp_Code=" & enQuoteString(EmpCode) & _
        " AND TrxLin_Date=" & enQuoteString(Utils.ChangeDateFormatForSearch(sMyDate)) & _
        " AND TrxLin_Status='POST'"
        i = MyBase.ExecuteNonQuery(Str)


        Return i



    End Function
    Protected Function CheckIfExistsOnTrxnLines(ByVal EmpCode As String, ByVal Mydate As Date) As Boolean

        Dim Str As String
        Dim Flag As Boolean = True
        Dim sMyDate As String
        Dim Ds As DataSet
        sMyDate = Format(Mydate, "yyyy-MM-dd")

        Dim i As Integer

        Str = "Select * From TaTxTrxnLines" & _
        " WHERE Emp_Code=" & enQuoteString(EmpCode) & _
        " AND TrxLin_Date=" & enQuoteString(Utils.ChangeDateFormatForSearch(sMyDate)) & _
        " AND TrxLin_Status='OUTS'"
        Ds = MyBase.GetData(Str)
        If CheckDataSet(Ds) Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function CheckIfExistsOnTrxnLines2(ByVal EmpCode As String, ByVal Mydate As Date) As Boolean

        Dim Str As String
        Dim Flag As Boolean = True
        Dim sMyDate As String
        sMyDate = Format(Mydate, "yyyy-MM-dd")
        Dim ds As DataSet
        Dim i As Integer

        Str = "Select * From TaTxTrxnLines2" & _
        " WHERE Emp_Code=" & enQuoteString(EmpCode) & _
        " AND TrxLin_Date=" & enQuoteString(Utils.ChangeDateFormatForSearch(sMyDate))

        Ds = MyBase.GetData(Str)
        If CheckDataSet(Ds) Then
            Flag = False
        End If
        Return Flag

        Return Flag
    End Function
    Protected Function GetTAReportForTotalTimePerWorkPerEmployeeForDates(ByVal EmpCode As String, ByVal FromDate As Date, ByVal ToDate As Date, ByVal ForActual As Boolean) As DataSet
        Dim str As String
        Dim sFromDate As String
        sFromDate = Format(FromDate, "yyyy-MM-dd")
        Dim sToDate As String
        sToDate = Format(ToDate, "yyyy-MM-dd")
        If ForActual Then
            str = " SELECT PrMsEmployees.Emp_FullName As Name," & _
                "  TaTxTrxnLines2.WrkCod_Code," & _
                "  TaMsWorkCodes.WrkCod_Desc," & _
                "  SUM(TaTxTrxnLines2.TrxLin_TotalTime) AS Total" & _
                "  FROM TaTxTrxnLines2 INNER JOIN" & _
                "  PrMsEmployees ON TaTxTrxnLines2.Emp_Code = PrMsEmployees.Emp_Code INNER JOIN" & _
                "  TaMsWorkCodes ON TaTxTrxnLines2.WrkCod_Code = TaMsWorkCodes.WrkCod_Code" & _
                "  WHERE     (TaTxTrxnLines2.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                "  AND (TaTxTrxnLines2.TrxLin_Date >= " & enQuoteString(Utils.ChangeDateFormatForSearch(sFromDate)) & _
                "  AND  TaTxTrxnLines2.TrxLin_Date <= " & enQuoteString(Utils.ChangeDateFormatForSearch(sToDate)) & ")" & _
                "  GROUP BY TaTxTrxnLines2.WrkCod_Code," & _
                "  TaMsWorkCodes.WrkCod_Desc," & _
                "  PrMsEmployees.Emp_FullName," & _
                "  TaMsWorkCodes.WrkCod_Code," & _
                "  TaMsWorkCodes.WrkCod_Type" & _
                "  ORDER BY TaTxTrxnLines2.WrkCod_Code, TaMsWorkCodes.WrkCod_Type"
        Else

            str = " SELECT PrMsEmployees.Emp_FullName As Name," & _
                "  TaTxTrxnLines.WrkCod_Code," & _
                "  TaMsWorkCodes.WrkCod_Desc," & _
                "  SUM(TaTxTrxnLines.TrxLin_TotalTime) AS Total" & _
                "  FROM TaTxTrxnLines INNER JOIN" & _
                "  PrMsEmployees ON TaTxTrxnLines.Emp_Code = PrMsEmployees.Emp_Code INNER JOIN" & _
                "  TaMsWorkCodes ON TaTxTrxnLines.WrkCod_Code = TaMsWorkCodes.WrkCod_Code" & _
                "  WHERE     (TaTxTrxnLines.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                "  AND (TaTxTrxnLines.TrxLin_Date >= " & enQuoteString(Utils.ChangeDateFormatForSearch(sFromDate)) & _
                "  AND  TaTxTrxnLines.TrxLin_Date <= " & enQuoteString(Utils.ChangeDateFormatForSearch(sToDate)) & ")" & _
                "  GROUP BY TaTxTrxnLines.WrkCod_Code," & _
                "  TaMsWorkCodes.WrkCod_Desc," & _
                "  PrMsEmployees.Emp_FullName," & _
                "  TaMsWorkCodes.WrkCod_Code," & _
                "  TaMsWorkCodes.WrkCod_Type" & _
                "  ORDER BY TaTxTrxnLines.WrkCod_Code, TaMsWorkCodes.WrkCod_Type"
        End If
        Return GetData(str)
    End Function
    Protected Function GetEmployeeTotalPerDayPerWorkCode(ByVal EmpCode As String, ByVal FromDate As Date, ByVal ToDate As Date, ByVal FromWorkCode As String, ByVal ToWorkCode As String, ByVal Status As Boolean, ByVal Analysis2Code As String) As Double

        Dim D As Double = 0
        Dim Str As String
        Dim Str2 As String = ""
        Dim sFromDate As String
        sFromDate = Format(FromDate, "yyyy-MM-dd")
        Dim sToDate As String
        sToDate = Format(ToDate, "yyyy-MM-dd")
        Dim RStatus As String = ""

        If Status Then

            Str = " SELECT SUM(TrxLin_TotalTime) " & _
                " FROM TaTxTrxnLines2" & _
                " where Emp_Code=" & enQuoteString(EmpCode) & _
                " and TrxLin_Date>=" & enQuoteString(Utils.ChangeDateFormatForSearch(sFromDate)) & _
                " and TrxLin_Date<=" & enQuoteString(Utils.ChangeDateFormatForSearch(sToDate)) & _
                " and WrkCod_Code>=" & enQuoteString(FromWorkCode) & _
                " and WrkCod_Code<=" & enQuoteString(ToWorkCode)
        Else
            Str = " SELECT SUM(TrxLin_TotalTime) " & _
                        " FROM TaTxTrxnLines" & _
                        " where Emp_Code=" & enQuoteString(EmpCode) & _
                        " and TrxLin_Date>=" & enQuoteString(Utils.ChangeDateFormatForSearch(sFromDate)) & _
                        " and TrxLin_Date<=" & enQuoteString(Utils.ChangeDateFormatForSearch(sToDate)) & _
                        " and WrkCod_Code>=" & enQuoteString(FromWorkCode) & _
                        " and WrkCod_Code<=" & enQuoteString(ToWorkCode)

        End If

        If Analysis2Code <> "" Then
            'Str2 = " And TrxLin_AnalCode=" & enQuoteString(Analysis2Code)
        End If

        Str = Str & Str2

        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            D = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        End If
        Return D

    End Function
    Protected Function GetEmployeeTotalPerDayPerWorkCodeTime(ByVal EmpCode As String, ByVal FromDate As Date, ByVal ToDate As Date, ByVal FromWorkCode As String, ByVal ToWorkCode As String, ByVal Status As Boolean, ByVal Analysis2Code As String) As String()

        Dim D As Double = 0
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String
        Dim sFromDate As String
        sFromDate = Format(FromDate, "yyyy-MM-dd")
        Dim sToDate As String
        sToDate = Format(ToDate, "yyyy-MM-dd")
        Dim RStatus As String = ""
        Dim S(2) As String

        S(0) = "00:00"
        S(1) = "00:00"


        If Status Then

            Str = " SELECT TrxLin_FromTime,TrxLin_ToTime " & _
                " FROM TaTxTrxnLines2" & _
                " where Emp_Code=" & enQuoteString(EmpCode) & _
                " and TrxLin_Date>=" & enQuoteString(Utils.ChangeDateFormatForSearch(sFromDate)) & _
                " and TrxLin_Date<=" & enQuoteString(Utils.ChangeDateFormatForSearch(sToDate)) & _
                " and WrkCod_Code>=" & enQuoteString(FromWorkCode) & _
                " and WrkCod_Code<=" & enQuoteString(ToWorkCode)

        Else
            Str = " SELECT TrxLin_FromTime,TrxLin_ToTime " & _
                        " FROM TaTxTrxnLines" & _
                        " where Emp_Code=" & enQuoteString(EmpCode) & _
                        " and TrxLin_Date>=" & enQuoteString(Utils.ChangeDateFormatForSearch(sFromDate)) & _
                        " and TrxLin_Date<=" & enQuoteString(Utils.ChangeDateFormatForSearch(sToDate)) & _
                        " and WrkCod_Code>=" & enQuoteString(FromWorkCode) & _
                        " and WrkCod_Code<=" & enQuoteString(ToWorkCode)

        End If

        If Analysis2Code <> "" Then
            Str2 = " And TrxLin_AnalCode=" & enQuoteString(Analysis2Code)
        End If

        Str3 = " order by TrxLin_Id asc"

        Str = Str & Str2



        Str = Str & Str3

        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Dim i As Integer
            Dim FromTime As String
            Dim ToTime As String
            For i = 0 To ds.Tables(0).Rows.Count - 1
                If i = 0 Then
                    FromTime = DbNullToString(ds.Tables(0).Rows(i).Item(0))
                End If
                ToTime = DbNullToString(ds.Tables(0).Rows(i).Item(1))
            Next
            S(0) = FromTime
            S(1) = ToTime

        End If
        Return S

    End Function
    Public Shadows Function FindEmployeeInterfaceStatusForTA(ByVal EmpCode As String, ByVal FromDate As Date, ByVal ToDate As Date) As DataSet

        Dim D As Double = 0
        Dim Str As String
        Dim sFromDate As String
        sFromDate = Format(FromDate, "yyyy-MM-dd")
        Dim sToDate As String
        sToDate = Format(ToDate, "yyyy-MM-dd")
        Dim RStatus As String = ""


        Str = " SELECT Emp_Code, " & _
            " TrxLin_Date " & _
            " FROM TaTxTrxnLines2" & _
            " where Emp_Code=" & enQuoteString(EmpCode) & _
            " and TrxLin_Date>=" & enQuoteString(Utils.ChangeDateFormatForSearch(sFromDate)) & _
            " and TrxLin_Date<=" & enQuoteString(Utils.ChangeDateFormatForSearch(sToDate)) & _
            " and TrxLin_Status='INTE'"



        Return GetData(Str)

    End Function
    Protected Function SetTAStatusToInterfaceForEmployee(ByVal EmpCode As String, ByVal FromDate As Date, ByVal ToDate As Date) As Boolean
        Dim Flag As Boolean = False
        Dim Str As String
        Dim sFromDate As String
        sFromDate = Format(FromDate, "yyyy-MM-dd")
        Dim sToDate As String
        sToDate = Format(ToDate, "yyyy-MM-dd")


        Str = " Update TaTxTrxnLines2" & _
        " Set TrxLin_Status='INTE'" & _
            " where Emp_Code=" & enQuoteString(EmpCode) & _
            " and TrxLin_Date>=" & enQuoteString(Utils.ChangeDateFormatForSearch(sFromDate)) & _
            " and TrxLin_Date<=" & enQuoteString(Utils.ChangeDateFormatForSearch(sToDate))

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            Flag = True
        Else
            flag = False
        End If

        Return Flag

    End Function
    Protected Function GetEmployeeTotalPerTypePerAction(ByVal EmpCode As String, ByVal LeaveType As String, ByVal Action As String, ByVal FromDate As Date, ByVal ToDate As Date, ByVal Status As String, Optional ByVal ToDateLess As Boolean = False) As Double
        Dim Str As String
        Dim Str2 As String = ""
        Dim Dfrom As String = Format(FromDate, "yyyy-MM-dd")
        Dfrom = Utils.ChangeDateFormatForSearch(Dfrom)
        Dim DTo As String = Format(ToDate, "yyyy-MM-dd")
        DTo = Utils.ChangeDateFormatForSearch(DTo)
        If ToDateLess Then
            Str = " SELECT  sum(EmpLea_Units)" & _
            " FROM  PrTxEmployeeLeave" & _
            " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (EmpLea_Type = " & enQuoteString(LeaveType) & ")" & _
            " AND (EmpLea_Status = " & enQuoteString(Status) & ")" & _
            " AND (EmpLea_FromDate >= " & enQuoteString(Dfrom) & ")" & _
            " AND (EmpLea_ToDate <  " & enQuoteString(DTo) & ")"
        Else

            Str = " SELECT  sum(EmpLea_Units)" & _
            " FROM  PrTxEmployeeLeave" & _
            " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (EmpLea_Type = " & enQuoteString(LeaveType) & ")" & _
            " AND (EmpLea_Status = " & enQuoteString(Status) & ")" & _
            " AND (EmpLea_FromDate >= " & enQuoteString(Dfrom) & ")" & _
            " AND (EmpLea_ToDate <=  " & enQuoteString(DTo) & ")"
        End If

        If Action <> "ALL" Then
            Str2 = " AND (EmpLea_Action =" & enQuoteString(Action) & ")"
        End If

        Str = Str & Str2
        Dim Ds As DataSet

        Ds = GetData(Str)
        Return DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))

    End Function
    Protected Function GetFTPParameters(ByVal Type As String, ByVal SubType As String, ByVal TemGrpCode As String) As DataSet
        Dim Str As String
        Str = "SELECT FTP_Id," & _
            " FTP_RemoteHost," & _
            " FTP_RemotePath," & _
            " FTP_FileName," & _
            " FTP_User," & _
            " FTP_PWD FROM PrSsFtpParameter WHERE " & _
            " FTP_Type=" & enQuoteString(Type) & _
            " AND FTP_SubType=" & enQuoteString(SubType) & _
            " AND TemGrp_Code=" & enQuoteString(TemGrpCode)
        Return GetData(Str)
    End Function
    Protected Function GetMinAndMaxIDOfUnsendTrxns(ByVal TempGrp As cPrMsTemplateGroup) As DataSet
        Dim Str As String
        Str = " SELECT min(TrxHdr_Id)," & _
              " Max(Trxhdr_Id) FROM PrTxTrxnHeader" & _
              " WHERE TrxHdr_Status='POST'" & _
              " AND TrxHdr_InterfaceStatus='OUTS'" & _
              " AND TemGrp_code=" & enQuoteString(TempGrp.Code) '& _
              '" AND PrdCod_Code=" & enQuoteString(PeriodCode)
        Return MyBase.GetData(Str)

    End Function
    Protected Function GetPrTxTrxnHeader(ByVal MinId As Integer, ByVal MaxId As Integer, ByVal TempGroup As cPrMsTemplateGroup) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Str = " SELECT TrxHdr_Id," &
         " Emp_Code," &
         " PrdGrp_Code," &
         " PrdCod_Code," &
         " PayCat_Code," &
         " TrxHdr_Date," &
         " TrxHdr_Status," &
         " TrxHdr_TotalErnPeriod," &
         " TrxHdr_TotalErnYTD, " &
         " TrxHdr_TotalDedPeriod," &
         " TrxHdr_TotalDedYTD," &
         " TrxHdr_TotalConPeriod," &
         " TrxHdr_TotalConYTD," &
         " TrxHdr_SIIncome," &
         " TrxHdr_TaxableIncome," &
         " TrxHdr_PaymentMethod," &
         " TrxHdr_PaymentRef," &
         " TrxHdr_PeriodUnits," &
         " TrxHdr_AnnualUnits," &
         " TrxHdr_AnnualLeave," &
         " TrxHdr_LifeInsurance, " &
         " TrxHdr_Discounts," &
         " TrxHdr_InterfaceStatus," &
         " TrxHdr_Overtime1," &
         " TrxHdr_Overtime2," &
         " TrxHdr_SIUnits," &
         " TrxHdr_MonthlySalary," &
         " TrxHdr_NetSalary, " &
         " TrxHdr_PeriodInsurable," &
         " TemGrp_Code," &
         " TrxHdr_ChequeNo, " &
         " TrxHdr_TaxableFromOther," &
         " TrxHdr_CurrencySymbol, " &
         " TrxHdr_Rate, " &
         " TrxHdr_NormalDays, " &
         " TrxHdr_Salary1, " &
         " TrxHdr_Salary2," &
         " TrxHdr_Overtime3, " &
         " TrxHdr_Sectors," &
         " TrxHdr_Dutyhours," &
         " TrxHdr_FlightHours," &
         " TrxHdr_Commission," &
         " TrxHdr_PBAmount," &
         " TrxHdr_PBRate," &
         " TrxHdr_Overlay," &
         " TrxHdr_PeriodSplit, " &
         " TrxHdr_PeriodSplitSI, " &
         " TrxHdr_A1, " &
         " TrxHdr_A2, " &
         " TrxHdr_A3, " &
         " TrxHdr_A4, " &
         " TrxHdr_A5, " &
         " TrxHdr_Union, " &
         " TrxHdr_Position, " &
         " TrxHdr_COLA, " &
         " TrxHdr_MyRate, " &
         " TrxHdr_FE, " &
         " TrxHdr_NetYTD, " &
         " TrxHdr_PFOnAgreedSalary, " &
         " TrxHdr_BasisOnSalary, " &
         " TrxHdr_GesiD, " &
         " TrxHdr_GesiC, " &
        " TrxHdr_Medical, " &
        " Com_Code," &
        " TrxHdr_Year, " &
        " TrxHdr_GESIableAmount, " &
        " Trxhdr_BIK_GESID," &
        " Trxhdr_BIK_GESIC," &
        " Trxhdr_BIK_Gesiable, " &
        " Trxhdr_AnalGen1, " &
        " Trxhdr_Maternity, " &
        " Trxhdr_FEPercent, " &
        " Trxhdr_FEControlAmount, " &
        " TrxHdr_TaxOnBIK, " &
        " TrxHdr_SIPension, " &
        " TrxHdr_GovPension " &
         " FROM  PrTxTrxnHeader" &
         " WHERE (TrxHdr_Id >= " & MinId & ")" &
         " AND (TrxHdr_Id <= " & MaxId & ")" &
        " AND (TemGrp_Code=" & enQuoteString(TempGroup.Code) & ")" '& _

        If Global1.param_SortByChequeNo Then
            str2 = " Order by TrxHdr_PaymentRef Asc"
        End If

        ''" AND PrdCod_Code=" & enQuoteString(PeriodCode)
        Str = Str & Str2
        Return MyBase.GetData(Str)

    End Function
    Protected Function GetPrTxTrxnLinesOfHeaderID(ByVal HeaderId) As DataSet
        Dim Str As String
        Str = " SELECT  TrxLin_Id," & _
            " TrxHdr_Id," & _
            " TrxLin_Type," & _
            " ErnCod_Code," & _
            " DedCod_Code," & _
            " ConCod_Code," & _
            " TrxLin_PeriodValue," & _
            " TrxLin_YTDValue," & _
            " TrxLin_EDC, " & _
            " TrxLin_EDCDescription," & _
            " TrxLin_ConsolDesc" & _
            " FROM PrTxTrxnLines" & _
            " WHERE (TrxHdr_Id = " & HeaderId & ")" & _
            " ORDER BY TrxLin_Id"

        Return GetData(Str)

    End Function
    Protected Function GetPrTrxnLinesOfHeaderIdOfAdvances(ByVal HeaderID As Integer) As DataSet
        Dim Str As String
        Str = "SELECT PrTxTrxnLines.TrxLin_PeriodValue, PrTxTrxnLines.DedCod_Code" & _
            " FROM PrTxTrxnLines INNER JOIN" & _
            " PrMsDeductionCodes ON PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN" & _
            " PrSsDeductionTypes ON PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code" & _
            " WHERE(PrTxTrxnLines.TrxHdr_Id = " & HeaderID & ")" & _
            " AND (PrTxTrxnLines.TrxLin_Type = 'D') " & _
            " AND (PrSsDeductionTypes.DedTyp_Code = 'AD')" & _
            " AND (PrTxTrxnLines.TrxLin_PeriodValue <>0)" & _
            " ORDER BY PrTxTrxnLines.TrxLin_Id"

        Return GetData(Str)

    End Function
  
    Protected Function GetDetailsForNavInterface(ByVal Hdr As cPrTxTrxnHeader) As DataSet

        Dim Str As String
        Str = " SELECT PrAnEmployeeAnalysis1.EmpAn1_GLAnal1," & _
                " PrAnEmployeeAnalysis2.EmpAn2_GLAnal1," & _
                " PrAnEmployeeAnalysis3.EmpAn3_GLAnal1, " & _
                " PrAnEmployeeAnalysis4.EmpAn4_GLAnal1," & _
                " PrAnEmployeeAnalysis5.EmpAn5_GLAnal1" & _
                " FROM  PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON " & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code INNER JOIN" & _
                " PrAnEmployeeAnalysis1 ON" & _
                " PrMsEmployees.EmpAn1_Code = PrAnEmployeeAnalysis1.EmpAn1_Code INNER JOIN" & _
                " PrAnEmployeeAnalysis2 ON" & _
                " PrMsEmployees.EmpAn2_Code = PrAnEmployeeAnalysis2.EmpAn2_Code INNER JOIN" & _
                " PrAnEmployeeAnalysis3 ON" & _
                " PrMsEmployees.EmpAn3_Code = PrAnEmployeeAnalysis3.EmpAn3_Code INNER JOIN" & _
                " PrAnEmployeeAnalysis4 ON" & _
                " PrMsEmployees.EmpAn4_Code = PrAnEmployeeAnalysis4.EmpAn4_Code INNER JOIN" & _
                " PrAnEmployeeAnalysis5 ON" & _
                " PrMsEmployees.EmpAn5_Code = PrAnEmployeeAnalysis5.EmpAn5_Code" & _
                " WHERE (PrTxTrxnHeader.TrxHdr_Id = " & Hdr.Id & ")"
        Return GetData(Str)
    End Function
    Protected Function UpdateTrxnHeaderAsPosted(ByVal MinId As Integer, ByVal MaxId As Integer, ByVal TempGroup As cPrMsTemplateGroup, ByVal status As String) As Boolean
        Dim Str As String
        Dim i As Integer
        Dim Flag As Boolean = False
        Str = "Update PrTxTrxnHeader " & _
        " Set TrxHdr_InterfaceStatus=" & enQuoteString(status) & _
        " Where TrxHdr_Id>=" & MinId & _
        " AND TrxHdr_Id<=" & MaxId & _
        " AND TrxHdr_InterfaceStatus='OUTS'" & _
        " AND (TemGrp_Code=" & enQuoteString(TempGroup.Code) & ")"


        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            Flag = True
        End If
        Return Flag

    End Function
    Protected Function GetAllPrSsNavBatch(ByVal TemGrp As cPrMsTemplateGroup) As DataSet
        Dim Str As String
        Str = " SELECT" & _
            " GenBat_Id," & _
            " GenBat_IdFrom," & _
            " GenBat_IdTo," & _
            " TmpGrp_Code," & _
            " GenBat_User," & _
            " GenBat_FirstCreation," & _
            " GenBat_LastCreation," & _
            " GenBat_Times " & _
            " FROM PrSsNavBatch" & _
            " WHERE tmpGrp_Code = " & enQuoteString(TemGrp.Code) & _
            " Order by GenBat_LastCreation Desc"

        Return GetData(Str)
    End Function
    Protected Function GetAllPrSsNavBatch2(ByVal TemGrp As cPrMsTemplateGroup) As DataSet
        Dim Str As String
        Str = "SELECT PrSsNavBatch.GenBat_Id, " & _
                " PrSsNavBatch.GenBat_IdFrom, " & _
                " PrSsNavBatch.GenBat_IdTo, " & _
                " PrSsNavBatch.TmpGrp_Code,  " & _
                " PrSsNavBatch.GenBat_User,  " & _
                " PrSsNavBatch.GenBat_FirstCreation, " & _
                " PrSsNavBatch.GenBat_LastCreation, " & _
                " PrSsNavBatch.GenBat_Times,  " & _
                " PrMsPeriodCodes.PrdCod_DescriptionL " & _
                " FROM PrSsNavBatch INNER JOIN " & _
                " PrTxTrxnHeader ON  " & _
                " PrSsNavBatch.GenBat_IdFrom = PrTxTrxnHeader.TrxHdr_Id INNER JOIN " & _
                " PrMsPeriodCodes ON  " & _
                " PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code AND  " & _
                " PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code " & _
                " WHERE PrSsNavBatch.tmpGrp_Code = " & enQuoteString(TemGrp.Code) & _
                " Order by GenBat_LastCreation Desc"

        Return GetData(Str)
    End Function
    Protected Function GetAllPrTxHeader_InterfacedBankPayed(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal Bank As cPrAnBanks, ByVal CompanyBankAccount As String, ByVal ForReport As Boolean, ByVal IncludeInactive As Boolean, ByVal Analysis As String, ByVal AnalCode As String, ByVal EmployeeBankCode As String) As DataSet
        Dim Str As String
        Dim Str2 As String
        Dim Str4 As String = ""
        Dim PaymentMethod As String = "3"

        If ForReport Then
            Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
                " PrMsEmployees.Emp_FullName, " & _
                " PrTxTrxnHeader.TrxHdr_NetSalary," & _
                " PrMsEmployees.Bnk_Code," & _
                " PrMsEmployees.Emp_BankAccount, " & _
                " PrAnBanks.Bnk_DescriptionL," & _
                " PrMsEmployees.Emp_IBAN," & _
                " PrMsEmployees.Emp_IdentificationCard, " & _
                " PrMsEmployees.Emp_BankBenName " & _
                " FROM PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON" & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
                " INNER JOIN PrAnBanks ON" & _
                " PrMsEmployees.Bnk_Code = PrAnBanks.Bnk_Code" & _
                " WHERE PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp.Code) & _
                " AND PmtMth_Code=" & enQuoteString(PaymentMethod) & _
                " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(Period.PrdGrpCode) & _
                " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(Period.Code) & _
                " AND PrMsEmployees.Bnk_CodeCo=" & enQuoteString(Bank.Code) & _
                " AND PrMsEmployees.Emp_BankAccountCo= " & enQuoteString(CompanyBankAccount)
            If EmployeeBankCode <> "" Then
                Str4 = " AND PrMsEmployees.Bnk_Code=" & enQuoteString(EmployeeBankCode)
            End If

            '" AND PrTxTrxnHeader.TrxHdr_InterfaceStatus = 'POST'" & _
        Else
            Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
                " PrTxTrxnHeader.TrxHdr_NetSalary," & _
                " PrMsEmployees.Emp_FullName, " & _
                " PrMsEmployees.Bnk_Code," & _
                " PrMsEmployees.Emp_BankAccount," & _
                " PrMsEmployees.Bnk_CodeCo," & _
                " PrMsEmployees.Emp_BankAccountCo, " & _
                " PrMsEmployees.PmtMth_Code," & _
                " PrMsEmployees.Emp_IBAN," & _
                " PrMsEmployees.Emp_IdentificationCard, " & _
                " 1 as Selected, " & _
                " PrMsEmployees.Emp_AnalGen1 " & _
                " FROM PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON" & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
                " WHERE PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp.Code) & _
                " AND PmtMth_Code=" & enQuoteString(PaymentMethod) & _
                " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(Period.PrdGrpCode) & _
                " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(Period.Code) & _
                " AND PrMsEmployees.Bnk_CodeCo=" & enQuoteString(Bank.Code) & _
                " AND PrMsEmployees.Emp_BankAccountCo= " & enQuoteString(CompanyBankAccount)
            '" AND PrTxTrxnHeader.TrxHdr_InterfaceStatus = 'POST'" & _
            If EmployeeBankCode <> "" Then
                Str4 = " AND PrMsEmployees.Bnk_Code=" & enQuoteString(EmployeeBankCode)
            End If
        End If
        If Not IncludeInactive Then
            Str2 = " AND PrMsEmployees.Emp_Status='A'"
        End If



        Dim str3 As String = ""
        Select Case Analysis
            Case 0
                str3 = ""
            Case 1
                str3 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str3 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str3 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str3 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str3 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str3 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select




        Str = Str & Str2 & str3 & Str4

        Str = Str & " Order by PrMsEmployees.Emp_Code Asc "

        Return MyBase.GetData(Str)

    End Function
    Protected Function GetAllPrTxHeader_InterfacedBankPayedCONSOL(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal Bank As cPrAnBanks, ByVal CompanyBankAccount As String, ByVal ForReport As Boolean, ByVal IncludeInactive As Boolean, ByVal Create2Files As Boolean, ByVal ThisIsCompanyBankFile As Boolean, ByVal Analysis As String, ByVal AnalCode As String, ByVal EmployeeBank As String) As DataSet
        Dim Str As String
        Dim Str2 As String
        Dim PaymentMethod As String = "3"
        Dim Ds2 As DataSet
        Dim Ds3 As DataSet
        Dim i As Integer
        Dim Str4 As String
        Dim Str5 As String


        Dim Str6 As String = ""

        Str = " select * from prmstemplategroup" & _
              " where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Ds2 = GetData(Str)
        If CheckDataSet(Ds2) Then
            For i = 0 To Ds2.Tables(0).Rows.Count - 1
                Dim TempGrpCode As String
                Dim PeriodCode As String
                Dim PeriodGroup As String
                TempGrpCode = DbNullToString(Ds2.Tables(0).Rows(i).Item(0))
                Str = " SELECT PrMsPeriodGroups.PrdGrp_Code," & _
                    " PrMsPeriodCodes.PrdCod_Code " & _
                    " FROM PrMsPeriodGroups INNER JOIN" & _
                    " PrMsPeriodCodes ON  " & _
                    " PrMsPeriodGroups.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
                    " WHERE     (PrMsPeriodGroups.TemGrp_Code = " & enQuoteString(TempGrpCode) & ")" & _
                    " AND (PrMsPeriodCodes.PrdCod_Status = 'O')"
                Ds3 = GetData(Str)
                If CheckDataSet(Ds3) Then
                    PeriodGroup = Ds3.Tables(0).Rows(0).Item(0)
                    PeriodCode = Ds3.Tables(0).Rows(0).Item(1)
                    If Str4 = "" Then
                        Str4 = " And ((PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TempGrpCode) & _
                        " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PeriodGroup) & _
                        " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PeriodCode) & ")"
                    Else
                        Str4 = Str4 & " OR  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TempGrpCode) & _
                        " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PeriodGroup) & _
                        " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PeriodCode) & ")"
                    End If

                End If
            Next
            Str4 = Str4 & ")"
        End If




        If ForReport Then
            Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
                " PrMsEmployees.Emp_FullName, " & _
                " PrTxTrxnHeader.TrxHdr_NetSalary," & _
                " PrMsEmployees.Bnk_Code," & _
                " PrMsEmployees.Emp_BankAccount, " & _
                " PrAnBanks.Bnk_DescriptionL," & _
                " PrMsEmployees.Emp_IBAN," & _
                " PrMsEmployees.Emp_IdentificationCard, " & _
                " PrMsEmployees.Emp_BankBenName, " & _
                " PrAnBanks.Bnk_SwiftCode" & _
                " FROM PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON" & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
                " INNER JOIN PrAnBanks ON" & _
                " PrMsEmployees.Bnk_Code = PrAnBanks.Bnk_Code" & _
                " WHERE PmtMth_Code = " & enQuoteString(PaymentMethod) & _
                " AND PrMsEmployees.Bnk_CodeCo=" & enQuoteString(Bank.Code) & _
                " AND PrMsEmployees.Emp_BankAccountCo= " & enQuoteString(CompanyBankAccount)

            If EmployeeBank <> "" Then
                Str6 = " AND PrMsEmployees.Bnk_Code=" & enQuoteString(EmployeeBank)
            End If


            Str = Str & Str6 & Str4

            '" AND PrTxTrxnHeader.TrxHdr_InterfaceStatus = 'POST'" & _
        Else
            Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
                " PrTxTrxnHeader.TrxHdr_NetSalary," & _
                " PrMsEmployees.Emp_FullName, " & _
                " PrMsEmployees.Bnk_Code," & _
                " PrMsEmployees.Emp_BankAccount," & _
                " PrMsEmployees.Bnk_CodeCo," & _
                " PrMsEmployees.Emp_BankAccountCo, " & _
                " PrMsEmployees.PmtMth_Code," & _
                " PrMsEmployees.Emp_IBAN," & _
                " PrMsEmployees.Emp_IdentificationCard, " & _
                " PrMsEmployees.Emp_BankBenName, " & _
                " 1 as Selected, " & _
                " PrMsEmployees.Emp_AnalGen1 " & _
                " FROM PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON" & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
                " WHERE  PmtMth_Code = " & enQuoteString(PaymentMethod) & _
                " AND PrMsEmployees.Bnk_CodeCo=" & enQuoteString(Bank.Code) & _
                " AND PrMsEmployees.Emp_BankAccountCo= " & enQuoteString(CompanyBankAccount) & _
                " AND PrTxTrxnHeader.TrxHdr_NetSalary >0"

            If EmployeeBank <> "" Then
                Str6 = " AND PrMsEmployees.Bnk_Code=" & enQuoteString(EmployeeBank)
            End If


            Str = Str & Str6 & Str4
            If Create2Files Then
                If ThisIsCompanyBankFile Then
                    Str5 = " AND PrMsEmployees.Bnk_Code=" & enQuoteString(Bank.Code)
                Else
                    Str5 = " AND PrMsEmployees.Bnk_Code<>" & enQuoteString(Bank.Code)
                End If
            End If
            Str = Str & Str5

            '" AND PrTxTrxnHeader.TrxHdr_InterfaceStatus = 'POST'" & _
        End If
        If Not IncludeInactive Then
            Str2 = " AND PrMsEmployees.Emp_Status='A'"
        End If


        Dim str3 As String = ""
        Select Case Analysis
            Case 0
                str3 = ""
            Case 1
                str3 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str3 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str3 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str3 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str3 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str3 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select


        Str = Str & Str2 & str3

        Str = Str & " Order by PrMsEmployees.Emp_Code Asc "

        Return MyBase.GetData(Str)

    End Function
    Protected Function GetAllPrTxHeader_EWALLETFile(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal Bank As cPrAnBanks, ByVal CompanyBankAccount As String, ByVal ForReport As Boolean, ByVal IncludeInactive As Boolean, ByVal Create2Files As Boolean, ByVal ThisIsCompanyBankFile As Boolean, ByVal Analysis As String, ByVal AnalCode As String, ByVal EmployeeBank As String) As DataSet
        Dim Str As String
        Dim Str2 As String
        Dim PaymentMethod As String = "4"
        Dim Ds2 As DataSet
        Dim Ds3 As DataSet
        Dim i As Integer
        Dim Str4 As String
        Dim Str5 As String


        Dim Str6 As String = ""

        Str = " select * from prmstemplategroup" & _
              " where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Ds2 = GetData(Str)
        If CheckDataSet(Ds2) Then
            For i = 0 To Ds2.Tables(0).Rows.Count - 1
                Dim TempGrpCode As String
                Dim PeriodCode As String
                Dim PeriodGroup As String
                TempGrpCode = DbNullToString(Ds2.Tables(0).Rows(i).Item(0))
                Str = " SELECT PrMsPeriodGroups.PrdGrp_Code," & _
                    " PrMsPeriodCodes.PrdCod_Code " & _
                    " FROM PrMsPeriodGroups INNER JOIN" & _
                    " PrMsPeriodCodes ON  " & _
                    " PrMsPeriodGroups.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
                    " WHERE     (PrMsPeriodGroups.TemGrp_Code = " & enQuoteString(TempGrpCode) & ")" & _
                    " AND (PrMsPeriodCodes.PrdCod_Status = 'O')"
                Ds3 = GetData(Str)
                If CheckDataSet(Ds3) Then
                    PeriodGroup = Ds3.Tables(0).Rows(0).Item(0)
                    PeriodCode = Ds3.Tables(0).Rows(0).Item(1)
                    If Str4 = "" Then
                        Str4 = " And ((PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TempGrpCode) & _
                        " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PeriodGroup) & _
                        " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PeriodCode) & ")"
                    Else
                        Str4 = Str4 & " OR  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TempGrpCode) & _
                        " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PeriodGroup) & _
                        " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PeriodCode) & ")"
                    End If

                End If
            Next
            Str4 = Str4 & ")"
        End If




        If ForReport Then
            Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
                " PrMsEmployees.Emp_FullName, " & _
                " PrTxTrxnHeader.TrxHdr_NetSalary," & _
                " PrMsEmployees.Bnk_Code," & _
                " PrMsEmployees.Emp_BankAccount, " & _
                " PrAnBanks.Bnk_DescriptionL," & _
                " PrMsEmployees.Emp_IBAN," & _
                " PrMsEmployees.Emp_IdentificationCard, " & _
                 " PrMsEmployees.Emp_BankBenName " & _
                " FROM PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON" & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
                " INNER JOIN PrAnBanks ON" & _
                " PrMsEmployees.Bnk_Code = PrAnBanks.Bnk_Code" & _
                " WHERE PmtMth_Code = " & enQuoteString(PaymentMethod) & _
                " AND PrMsEmployees.Bnk_CodeCo=" & enQuoteString(Bank.Code) & _
                " AND PrMsEmployees.Emp_BankAccountCo= " & enQuoteString(CompanyBankAccount)

            If EmployeeBank <> "" Then
                Str6 = " AND PrMsEmployees.Bnk_Code=" & enQuoteString(EmployeeBank)
            End If


            Str = Str & Str6 & Str4

            '" AND PrTxTrxnHeader.TrxHdr_InterfaceStatus = 'POST'" & _
        Else
            Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
                " PrTxTrxnHeader.TrxHdr_NetSalary," & _
                " PrMsEmployees.Emp_FullName, " & _
                " PrMsEmployees.Bnk_Code," & _
                " PrMsEmployees.Emp_BankAccount," & _
                " PrMsEmployees.Bnk_CodeCo," & _
                " PrMsEmployees.Emp_BankAccountCo, " & _
                " PrMsEmployees.PmtMth_Code," & _
                " PrMsEmployees.Emp_IBAN," & _
                " PrMsEmployees.Emp_IdentificationCard, " & _
                " PrMsEmployees.Emp_BankBenName, " & _
                " 1 as Selected, " & _
                " PrMsEmployees.Emp_AnalGen1 " & _
                " FROM PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON" & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
                " WHERE  PmtMth_Code = " & enQuoteString(PaymentMethod) & _
                " AND PrMsEmployees.Bnk_CodeCo=" & enQuoteString(Bank.Code) & _
                " AND PrMsEmployees.Emp_BankAccountCo= " & enQuoteString(CompanyBankAccount) & _
                " AND PrTxTrxnHeader.TrxHdr_NetSalary >0"

            If EmployeeBank <> "" Then
                Str6 = " AND PrMsEmployees.Bnk_Code=" & enQuoteString(EmployeeBank)
            End If


            Str = Str & Str6 & Str4
            If Create2Files Then
                If ThisIsCompanyBankFile Then
                    Str5 = " AND PrMsEmployees.Bnk_Code=" & enQuoteString(Bank.Code)
                Else
                    Str5 = " AND PrMsEmployees.Bnk_Code<>" & enQuoteString(Bank.Code)
                End If
            End If
            Str = Str & Str5

            '" AND PrTxTrxnHeader.TrxHdr_InterfaceStatus = 'POST'" & _
        End If
        If Not IncludeInactive Then
            Str2 = " AND PrMsEmployees.Emp_Status='A'"
        End If


        Dim str3 As String = ""
        Select Case Analysis
            Case 0
                str3 = ""
            Case 1
                str3 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str3 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str3 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str3 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str3 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str3 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select


        Str = Str & Str2 & str3

        Str = Str & " Order by PrMsEmployees.Emp_IBAN,PrMsEmployees.Emp_Code Asc "

        Return MyBase.GetData(Str)

    End Function
    Protected Function GetAllIBANS_Report(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal IncludeInactive As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String
        Dim PaymentMethod As String = "3"
        Dim Ds2 As DataSet
        Dim Ds3 As DataSet
        Dim i As Integer
        Dim Str4 As String
        Dim Str5 As String


        Dim Str6 As String = ""
        Str4 = ""
        Str = " select * from prmstemplategroup" & _
              " where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Ds2 = GetData(Str)
        If CheckDataSet(Ds2) Then
            For i = 0 To Ds2.Tables(0).Rows.Count - 1
                Dim TempGrpCode As String
                Dim PeriodCode As String
                Dim PeriodGroup As String
                TempGrpCode = DbNullToString(Ds2.Tables(0).Rows(i).Item(0))
                Str = " SELECT PrMsPeriodGroups.PrdGrp_Code," & _
                    " PrMsPeriodCodes.PrdCod_Code " & _
                    " FROM PrMsPeriodGroups INNER JOIN" & _
                    " PrMsPeriodCodes ON  " & _
                    " PrMsPeriodGroups.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
                    " WHERE     (PrMsPeriodGroups.TemGrp_Code = " & enQuoteString(TempGrpCode) & ")" & _
                    " AND (PrMsPeriodCodes.PrdCod_Status = 'O')"
                Ds3 = GetData(Str)
                If CheckDataSet(Ds3) Then
                    PeriodGroup = Ds3.Tables(0).Rows(0).Item(0)
                    PeriodCode = Ds3.Tables(0).Rows(0).Item(1)
                    If Str4 = "" Then
                        Str4 = " Where ((PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TempGrpCode) & _
                        " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PeriodGroup) & _
                        " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PeriodCode) & ")"
                    Else
                        Str4 = Str4 & " OR  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TempGrpCode) & _
                        " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PeriodGroup) & _
                        " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PeriodCode) & ")"
                    End If

                End If
            Next
            Str4 = Str4 & ")"
        End If




        Str = "SELECT PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_FullName," & _
        " PrMsEmployees.Emp_Status, " & _
        " PrMsEmployees.PmtMth_Code," & _
        " PrTxTrxnHeader.TrxHdr_NetSalary," & _
        " PrAnBanks.Bnk_Code," & _
        " PrAnBanks.Bnk_DescriptionL," & _
        " PrAnBanks.Bnk_SwiftCode, " & _
        " PrMsEmployees.Emp_BankAccount," & _
        " PrMsEmployees.Emp_IBAN," & _
         " PrAnBanks_1.Bnk_Code AS CompanyBankCode," & _
        " PrAnBanks_1.Bnk_DescriptionL AS CompanyBankDescription, " & _
        " PrAnBanks_1.Bnk_SwiftCode AS CompanyBankSwift, " & _
        " PrMsEmployees.Emp_BankAccountCo" & _
        " FROM PrTxTrxnHeader INNER JOIN " & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code INNER JOIN " & _
        " PrAnBanks ON PrMsEmployees.Bnk_Code = PrAnBanks.Bnk_Code INNER JOIN " & _
        " PrAnBanks AS PrAnBanks_1 ON PrMsEmployees.Bnk_CodeCo = PrAnBanks_1.Bnk_Code"

        '" AND PrTxTrxnHeader.TrxHdr_InterfaceStatus = 'POST'" & _
     
        If Not IncludeInactive Then
            Str2 = " AND PrMsEmployees.Emp_Status='A'"
        End If

        Str = Str & Str4 & Str2

        Str = Str & " Order by PrMsEmployees.Emp_Code Asc "

        Return MyBase.GetData(Str)

    End Function
    Protected Function GetAllPrTxHeader_InterfacedBankPayed_Alpha(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal Bank As cPrAnBanks, ByVal CompanyBankAccount As String, ByVal ForReport As Boolean, ByVal IncludeInactive As Boolean, ByVal Analysis As String, ByVal AnalCode As String, ByVal EmployeeBankCode As String, ByVal OnlyAlpha As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String
        Dim Str4 As String = ""
        Dim PaymentMethod As String = "3"

        If ForReport Then
            Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
                " PrMsEmployees.Emp_FullName, " & _
                " PrTxTrxnHeader.TrxHdr_NetSalary," & _
                " PrMsEmployees.Bnk_Code," & _
                " PrMsEmployees.Emp_BankAccount, " & _
                " PrAnBanks.Bnk_DescriptionL," & _
                " PrMsEmployees.Emp_IBAN," & _
                " PrMsEmployees.Emp_IdentificationCard, " & _
                " PrMsEmployees.Emp_BankBenName " & _
                " FROM PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON" & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
                " INNER JOIN PrAnBanks ON" & _
                " PrMsEmployees.Bnk_Code = PrAnBanks.Bnk_Code" & _
                " WHERE PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp.Code) & _
                " AND PmtMth_Code=" & enQuoteString(PaymentMethod) & _
                " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(Period.PrdGrpCode) & _
                " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(Period.Code) & _
                " AND PrMsEmployees.Bnk_CodeCo=" & enQuoteString(Bank.Code) & _
                " AND PrMsEmployees.Emp_BankAccountCo= " & enQuoteString(CompanyBankAccount)
            If EmployeeBankCode <> "" Then
                If OnlyAlpha Then
                    Str4 = " AND PrMsEmployees.Bnk_Code=" & enQuoteString(EmployeeBankCode)
                Else
                    Str4 = " AND PrMsEmployees.Bnk_Code<>" & enQuoteString(EmployeeBankCode)
                End If
            End If

            '" AND PrTxTrxnHeader.TrxHdr_InterfaceStatus = 'POST'" & _
        Else
            Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
                " PrTxTrxnHeader.TrxHdr_NetSalary," & _
                " PrMsEmployees.Emp_FullName, " & _
                " PrMsEmployees.Bnk_Code," & _
                " PrMsEmployees.Emp_BankAccount," & _
                " PrMsEmployees.Bnk_CodeCo," & _
                " PrMsEmployees.Emp_BankAccountCo, " & _
                " PrMsEmployees.PmtMth_Code," & _
                " PrMsEmployees.Emp_IBAN," & _
                " PrMsEmployees.Emp_IdentificationCard, " & _
                " 1 as Selected, " & _
                " PrMsEmployees.Emp_AnalGen1 " & _
                " FROM PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON" & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
                " WHERE PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp.Code) & _
                " AND PmtMth_Code=" & enQuoteString(PaymentMethod) & _
                " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(Period.PrdGrpCode) & _
                " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(Period.Code) & _
                " AND PrMsEmployees.Bnk_CodeCo=" & enQuoteString(Bank.Code) & _
                " AND PrMsEmployees.Emp_BankAccountCo= " & enQuoteString(CompanyBankAccount)
            '" AND PrTxTrxnHeader.TrxHdr_InterfaceStatus = 'POST'" & _
            If EmployeeBankCode <> "" Then
                If OnlyAlpha Then
                    Str4 = " AND PrMsEmployees.Bnk_Code=" & enQuoteString(EmployeeBankCode)
                Else
                    Str4 = " AND PrMsEmployees.Bnk_Code<>" & enQuoteString(EmployeeBankCode)
                End If
            End If
        End If
        If Not IncludeInactive Then
            Str2 = " AND PrMsEmployees.Emp_Status='A'"
        End If



        Dim str3 As String = ""
        Select Case Analysis
            Case 0
                str3 = ""
            Case 1
                str3 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str3 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str3 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str3 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str3 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str3 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select




        Str = Str & Str2 & str3 & Str4

        Str = Str & " Order by PrMsEmployees.Emp_Code Asc "

        Return MyBase.GetData(Str)

    End Function
    Protected Function GetAllPrTxHeader_InterfacedBankPayedCONSOL_Alpha(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal Bank As cPrAnBanks, ByVal CompanyBankAccount As String, ByVal ForReport As Boolean, ByVal IncludeInactive As Boolean, ByVal Create2Files As Boolean, ByVal ThisIsCompanyBankFile As Boolean, ByVal Analysis As String, ByVal AnalCode As String, ByVal EmployeeBank As String, ByVal OnlyAlpha As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String
        Dim PaymentMethod As String = "3"
        Dim Ds2 As DataSet
        Dim Ds3 As DataSet
        Dim i As Integer
        Dim Str4 As String
        Dim Str5 As String


        Dim Str6 As String = ""

        Str = " select * from prmstemplategroup" & _
              " where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Ds2 = GetData(Str)
        If CheckDataSet(Ds2) Then
            For i = 0 To Ds2.Tables(0).Rows.Count - 1
                Dim TempGrpCode As String
                Dim PeriodCode As String
                Dim PeriodGroup As String
                TempGrpCode = DbNullToString(Ds2.Tables(0).Rows(i).Item(0))
                Str = " SELECT PrMsPeriodGroups.PrdGrp_Code," & _
                    " PrMsPeriodCodes.PrdCod_Code " & _
                    " FROM PrMsPeriodGroups INNER JOIN" & _
                    " PrMsPeriodCodes ON  " & _
                    " PrMsPeriodGroups.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
                    " WHERE     (PrMsPeriodGroups.TemGrp_Code = " & enQuoteString(TempGrpCode) & ")" & _
                    " AND (PrMsPeriodCodes.PrdCod_Status = 'O')"
                Ds3 = GetData(Str)
                If CheckDataSet(Ds3) Then
                    PeriodGroup = Ds3.Tables(0).Rows(0).Item(0)
                    PeriodCode = Ds3.Tables(0).Rows(0).Item(1)
                    If Str4 = "" Then
                        Str4 = " And ((PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TempGrpCode) & _
                        " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PeriodGroup) & _
                        " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PeriodCode) & ")"
                    Else
                        Str4 = Str4 & " OR  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TempGrpCode) & _
                        " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PeriodGroup) & _
                        " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PeriodCode) & ")"
                    End If

                End If
            Next
            Str4 = Str4 & ")"
        End If




        If ForReport Then
            Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
                " PrMsEmployees.Emp_FullName, " & _
                " PrTxTrxnHeader.TrxHdr_NetSalary," & _
                " PrMsEmployees.Bnk_Code," & _
                " PrMsEmployees.Emp_BankAccount, " & _
                " PrAnBanks.Bnk_DescriptionL," & _
                " PrMsEmployees.Emp_IBAN," & _
                " PrMsEmployees.Emp_IdentificationCard, " & _
                 " PrMsEmployees.Emp_BankBenName " & _
                " FROM PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON" & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
                " INNER JOIN PrAnBanks ON" & _
                " PrMsEmployees.Bnk_Code = PrAnBanks.Bnk_Code" & _
                " WHERE PmtMth_Code = " & enQuoteString(PaymentMethod) & _
                " AND PrMsEmployees.Bnk_CodeCo=" & enQuoteString(Bank.Code) & _
                " AND PrMsEmployees.Emp_BankAccountCo= " & enQuoteString(CompanyBankAccount)

            If EmployeeBank <> "" Then
                If OnlyAlpha Then
                    Str6 = " AND PrMsEmployees.Bnk_Code=" & enQuoteString(EmployeeBank)
                Else
                    Str6 = " AND PrMsEmployees.Bnk_Code<>" & enQuoteString(EmployeeBank)
                End If

            End If


            Str = Str & Str6 & Str4

            '" AND PrTxTrxnHeader.TrxHdr_InterfaceStatus = 'POST'" & _
        Else
            Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
                " PrTxTrxnHeader.TrxHdr_NetSalary," & _
                " PrMsEmployees.Emp_FullName, " & _
                " PrMsEmployees.Bnk_Code," & _
                " PrMsEmployees.Emp_BankAccount," & _
                " PrMsEmployees.Bnk_CodeCo," & _
                " PrMsEmployees.Emp_BankAccountCo, " & _
                " PrMsEmployees.PmtMth_Code," & _
                " PrMsEmployees.Emp_IBAN," & _
                " PrMsEmployees.Emp_IdentificationCard, " & _
                " PrMsEmployees.Emp_BankBenName, " & _
                " 1 as Selected, " & _
                " PrMsEmployees.Emp_AnalGen1 " & _
                " FROM PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON" & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
                " WHERE  PmtMth_Code = " & enQuoteString(PaymentMethod) & _
                " AND PrMsEmployees.Bnk_CodeCo=" & enQuoteString(Bank.Code) & _
                " AND PrMsEmployees.Emp_BankAccountCo= " & enQuoteString(CompanyBankAccount) & _
                " AND PrTxTrxnHeader.TrxHdr_NetSalary >0"

            If EmployeeBank <> "" Then
                If OnlyAlpha Then
                    Str6 = " AND PrMsEmployees.Bnk_Code=" & enQuoteString(EmployeeBank)
                Else
                    Str6 = " AND PrMsEmployees.Bnk_Code<>" & enQuoteString(EmployeeBank)
                End If
            End If


            Str = Str & Str6 & Str4
            If Create2Files Then
                If ThisIsCompanyBankFile Then
                    Str5 = " AND PrMsEmployees.Bnk_Code=" & enQuoteString(Bank.Code)
                Else
                    Str5 = " AND PrMsEmployees.Bnk_Code<>" & enQuoteString(Bank.Code)
                End If
            End If
            Str = Str & Str5

            '" AND PrTxTrxnHeader.TrxHdr_InterfaceStatus = 'POST'" & _
        End If
        If Not IncludeInactive Then
            Str2 = " AND PrMsEmployees.Emp_Status='A'"
        End If


        Dim str3 As String = ""
        Select Case Analysis
            Case 0
                str3 = ""
            Case 1
                str3 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str3 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str3 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str3 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str3 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str3 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select


        Str = Str & Str2 & str3

        Str = Str & " Order by PrMsEmployees.Emp_Code Asc "

        Return MyBase.GetData(Str)

    End Function
    Protected Function GetAllPrTxHeader_InterfacedBankPayedCONSOL_SEPAGA(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal Bank As cPrAnBanks, ByVal CompanyBankAccount As String, ByVal ForReport As Boolean, ByVal IncludeInactive As Boolean, ByVal Create2Files As Boolean, ByVal ThisIsCompanyBankFile As Boolean, ByVal Analysis As String, ByVal AnalCode As String, ByVal EmployeeBank As String) As DataSet
        Dim Str As String
        Dim Str2 As String
        Dim PaymentMethod As String = "3"
        Dim Ds2 As DataSet
        Dim Ds3 As DataSet
        Dim i As Integer
        Dim Str4 As String
        Dim Str5 As String


        Dim Str6 As String = ""

        Str = " select * from prmstemplategroup" & _
              " where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Ds2 = GetData(Str)
        If CheckDataSet(Ds2) Then
            For i = 0 To Ds2.Tables(0).Rows.Count - 1
                Dim TempGrpCode As String
                Dim PeriodCode As String
                Dim PeriodGroup As String
                TempGrpCode = DbNullToString(Ds2.Tables(0).Rows(i).Item(0))
                Str = " SELECT PrMsPeriodGroups.PrdGrp_Code," & _
                    " PrMsPeriodCodes.PrdCod_Code " & _
                    " FROM PrMsPeriodGroups INNER JOIN" & _
                    " PrMsPeriodCodes ON  " & _
                    " PrMsPeriodGroups.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
                    " WHERE     (PrMsPeriodGroups.TemGrp_Code = " & enQuoteString(TempGrpCode) & ")" & _
                    " AND (PrMsPeriodCodes.PrdCod_Status = 'O')"
                Ds3 = GetData(Str)
                If CheckDataSet(Ds3) Then
                    PeriodGroup = Ds3.Tables(0).Rows(0).Item(0)
                    PeriodCode = Ds3.Tables(0).Rows(0).Item(1)
                    If Str4 = "" Then
                        Str4 = " And ((PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TempGrpCode) & _
                        " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PeriodGroup) & _
                        " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PeriodCode) & ")"
                    Else
                        Str4 = Str4 & " OR  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TempGrpCode) & _
                        " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PeriodGroup) & _
                        " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PeriodCode) & ")"
                    End If

                End If
            Next
            Str4 = Str4 & ")"
        End If




        If ForReport Then
            Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
                " PrMsEmployees.Emp_FullName, " & _
                " PrTxTrxnHeader.TrxHdr_NetSalary," & _
                " PrMsEmployees.Bnk_Code," & _
                " PrMsEmployees.Emp_BankAccount, " & _
                " PrAnBanks.Bnk_DescriptionL," & _
                " PrMsEmployees.Emp_IBAN," & _
                " PrMsEmployees.Emp_IdentificationCard, " & _
                 " PrMsEmployees.Emp_BankBenName " & _
                " FROM PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON" & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
                " INNER JOIN PrAnBanks ON" & _
                " PrMsEmployees.Bnk_Code = PrAnBanks.Bnk_Code" & _
                " WHERE PmtMth_Code = " & enQuoteString(PaymentMethod) & _
                " AND PrMsEmployees.Bnk_CodeCo=" & enQuoteString(Bank.Code) & _
                " AND PrMsEmployees.Emp_BankAccountCo= " & enQuoteString(CompanyBankAccount)



            Str = Str & Str6 & Str4

            '" AND PrTxTrxnHeader.TrxHdr_InterfaceStatus = 'POST'" & _
        Else
            Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
                " PrTxTrxnHeader.TrxHdr_NetSalary," & _
                " PrMsEmployees.Emp_FullName, " & _
                " PrMsEmployees.Bnk_Code," & _
                " PrMsEmployees.Emp_BankAccount," & _
                " PrMsEmployees.Bnk_CodeCo," & _
                " PrMsEmployees.Emp_BankAccountCo, " & _
                " PrMsEmployees.PmtMth_Code," & _
                " PrMsEmployees.Emp_IBAN," & _
                " PrMsEmployees.Emp_IdentificationCard, " & _
                " PrMsEmployees.Emp_BankBenName, " & _
                " 1 as Selected, " & _
                " PrMsEmployees.Emp_AnalGen1 " & _
                " FROM PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON" & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
                " WHERE  PmtMth_Code = " & enQuoteString(PaymentMethod) & _
                " AND PrMsEmployees.Bnk_CodeCo=" & enQuoteString(Bank.Code) & _
                " AND PrMsEmployees.Emp_BankAccountCo= " & enQuoteString(CompanyBankAccount) & _
                " AND PrTxTrxnHeader.TrxHdr_NetSalary >0"



            Str = Str & Str6 & Str4
            If Create2Files Then
                If ThisIsCompanyBankFile Then
                    Str5 = " AND PrMsEmployees.Bnk_Code=" & enQuoteString(Bank.Code)
                Else
                    Str5 = " AND PrMsEmployees.Bnk_Code<>" & enQuoteString(Bank.Code)
                End If
            End If
            Str = Str & Str5

            '" AND PrTxTrxnHeader.TrxHdr_InterfaceStatus = 'POST'" & _
        End If
        If Not IncludeInactive Then
            Str2 = " AND PrMsEmployees.Emp_Status='A'"
        End If


        Dim str3 As String = ""
        Select Case Analysis
            Case 0
                str3 = ""
            Case 1
                str3 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str3 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str3 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str3 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str3 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str3 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select


        Str = Str & Str2 & str3

        Str = Str & " Order by PrMsEmployees.Emp_Code Asc "

        Return MyBase.GetData(Str)

    End Function
    Protected Function GetAllPrTxHeader_PFReportByanalysis(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal Analysis As Integer, ByVal AnalysisValue As String, ByVal PeriodDescription As String) As DataSet
        Dim Str As String
        Dim Str1 As String
        Dim Str2 As String
        Dim Str3 As String
        Dim PaymentMethod As String = "3"
        Dim Ds2 As DataSet
        Dim Ds3 As DataSet
        Dim i As Integer
        Dim Str4 As String
        Dim Str5 As String
        Str = " select * from prmstemplategroup" & _
              " where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Ds2 = GetData(Str)
        If CheckDataSet(Ds2) Then
            For i = 0 To Ds2.Tables(0).Rows.Count - 1
                Dim TempGrpCode As String
                Dim PeriodCode As String
                Dim PeriodGroup As String
                TempGrpCode = DbNullToString(Ds2.Tables(0).Rows(i).Item(0))
                Str = " SELECT PrMsPeriodGroups.PrdGrp_Code," & _
                    " PrMsPeriodCodes.PrdCod_Code " & _
                    " FROM PrMsPeriodGroups INNER JOIN" & _
                    " PrMsPeriodCodes ON  " & _
                    " PrMsPeriodGroups.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
                    " WHERE     (PrMsPeriodGroups.TemGrp_Code = " & enQuoteString(TempGrpCode) & ")" & _
                    " AND (PrMsPeriodCodes.PrdCod_Status = 'O')"
                Ds3 = GetData(Str)
                If CheckDataSet(Ds3) Then
                    PeriodGroup = Ds3.Tables(0).Rows(0).Item(0)
                    PeriodCode = Ds3.Tables(0).Rows(0).Item(1)
                    If Str4 = "" Then
                        Str4 = " And ((PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TempGrpCode) & _
                        " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PeriodGroup) & _
                        " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PeriodCode) & ")"
                    Else
                        Str4 = Str4 & " OR  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TempGrpCode) & _
                        " AND PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PeriodGroup) & _
                        " AND PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PeriodCode) & ")"
                    End If

                End If
            Next
            Str4 = Str4 & ")"
        End If

        Select Case Analysis
            Case 1
                Str3 = " PrMsEmployees.EmpAn1_Code"
            Case 2
                Str3 = " PrMsEmployees.EmpAn2_Code"
            Case 3
                Str3 = " PrMsEmployees.EmpAn3_Code"
            Case 4
                Str3 = " PrMsEmployees.EmpAn4_Code"
            Case 5
                Str3 = " PrMsEmployees.EmpAn5_Code"
        End Select


        Str1 = " SELECT "
        Str1 = Str1 & Str3
        Str1 = Str1 & " As AnalX , PrMsEmployees.Emp_Code," & _
        " PrMsEmployees.Emp_FirstName, " & _
        " PrMsEmployees.Emp_LastName," & _
        " PrTxTrxnLines.TrxLin_PeriodValue As DedValue," & _
        " PrTxTrxnLines.TrxLin_PeriodValue As ConValue," & _
        " PrTxTrxnLines.TrxLin_PeriodValue As Total " & _
        " FROM PrTxTrxnLines INNER JOIN" & _
        " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
        " PrMsDeductionCodes ON PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN" & _
        " PrSsDeductionTypes ON PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code INNER JOIN" & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
        " WHERE (PrSsDeductionTypes.DedTyp_Code = 'PF')" & _
        " And (" & Str3 & " = " & enQuoteString(AnalysisValue) & ")"



        Str1 = Str1 & Str4 & " Order by " & Str3
        Dim dsDed As DataSet
        dsDed = GetData(Str1)


        '  " PrTxTrxnHeader.TemGrp_Code," & _
        '" PrTxTrxnHeader.PrdGrp_Code," & _
        '" PrTxTrxnHeader.PrdCod_Code" & _

        Str2 = " SELECT "
        Str2 = Str2 & Str3
        Str2 = Str2 & " As AnalX, PrMsEmployees.Emp_Code," & _
        " PrMsEmployees.Emp_FirstName, " & _
        " PrMsEmployees.Emp_LastName," & _
        " PrTxTrxnLines.TrxLin_PeriodValue " & _
        " FROM PrTxTrxnLines INNER JOIN" & _
        " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
        " PrMsContributionCodes ON PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code INNER JOIN" & _
        " PrSsContributionTypes ON PrMsContributionCodes.ConTyp_Code = PrSsContributionTypes.ConTyp_Code INNER JOIN" & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
        " WHERE (PrSsContributionTypes.ConTyp_Code = 'PF')" & _
         " And (" & Str3 & " = " & enQuoteString(AnalysisValue) & ")"


        Str2 = Str2 & Str4 & " Order By " & Str3
        Dim DsCon As DataSet
        DsCon = GetData(Str2)

        Dim k As Integer
        i = 0
        Dim EmpDed As String
        Dim EmpCon As String
        Dim DedVal As Double
        Dim ConVal As Double

        Dim TotalA As Double
        Dim TotalB As Double
        Dim Total As Double

        Dim GTotalA As Double
        Dim GTotalB As Double
        Dim GrandTotal As Double


        If CheckDataSet(dsDed) Then
            If CheckDataSet(DsCon) Then
                For i = 0 To dsDed.Tables(0).Rows.Count - 1
                    EmpDed = DbNullToString(dsDed.Tables(0).Rows(i).Item(1))
                    DedVal = DbNullToDouble(dsDed.Tables(0).Rows(k).Item(4))
                    For k = 0 To DsCon.Tables(0).Rows.Count - 1
                        EmpCon = DbNullToString(DsCon.Tables(0).Rows(k).Item(1))
                        If EmpDed = EmpCon Then
                            ConVal = DbNullToDouble(DsCon.Tables(0).Rows(k).Item(4))
                            Exit For
                        End If
                    Next
                    dsDed.Tables(0).Rows(i).Item(5) = Format(ConVal, "0.00")
                    dsDed.Tables(0).Rows(i).Item(6) = 0
                    ConVal = 0
                    DedVal = 0
                Next
            End If
        End If

        Dim DsFinal As New DataSet
        Dim Dt1 As New DataTable
        Dim anal As String = ""
        Dim PrevAnal As String = -1
        Dt1 = dsDed.Tables(0).Copy
        Dt1.Rows.Clear()
        Dim Flag As Boolean = False
        If CheckDataSet(dsDed) Then
            Flag = True
            For i = 0 To dsDed.Tables(0).Rows.Count - 1

                anal = dsDed.Tables(0).Rows(i).Item(0)
                If i <> 0 Then
                    If PrevAnal <> anal Then
                        Dim r2 As DataRow = Dt1.NewRow

                        r2(0) = "Total of " & PrevAnal
                        r2(1) = ""
                        r2(2) = ""
                        r2(3) = ""
                        r2(4) = Format(TotalA, "0.00")
                        r2(5) = Format(TotalB, "0.00")
                        r2(6) = Format(TotalA + TotalB, "0.00")


                        Dt1.Rows.Add(r2)
                        PrevAnal = anal
                        TotalA = 0
                        TotalB = 0
                        Total = 0
                    End If
                Else
                    PrevAnal = anal
                End If
                Dim r As DataRow = Dt1.NewRow
                Dim a As Double
                Dim b As Double
                r(0) = dsDed.Tables(0).Rows(i).Item(0)
                r(1) = dsDed.Tables(0).Rows(i).Item(1)
                r(2) = dsDed.Tables(0).Rows(i).Item(2)
                r(3) = dsDed.Tables(0).Rows(i).Item(3)
                r(4) = dsDed.Tables(0).Rows(i).Item(4)
                r(5) = dsDed.Tables(0).Rows(i).Item(5)
                a = DbNullToDouble(dsDed.Tables(0).Rows(i).Item(4))
                b = DbNullToDouble(dsDed.Tables(0).Rows(i).Item(5))
                r(6) = Format(a + b, "0.00")

                TotalA = TotalA + DbNullToDouble(dsDed.Tables(0).Rows(i).Item(4))
                TotalB = TotalB + DbNullToDouble(dsDed.Tables(0).Rows(i).Item(5))
                Total = Total + a + b

                GTotalA = GTotalA + DbNullToDouble(dsDed.Tables(0).Rows(i).Item(4))
                GTotalB = GTotalB + DbNullToDouble(dsDed.Tables(0).Rows(i).Item(5))
                GrandTotal = GrandTotal + a + b

                Dt1.Rows.Add(r)

            Next
            Dim r1 As DataRow = Dt1.NewRow
            r1(0) = "Total of " & PeriodDescription & "-" & anal
            r1(1) = ""
            r1(2) = ""
            r1(3) = ""
            r1(4) = Format(TotalA, "0.00")
            r1(5) = Format(TotalB, "0.00")
            r1(6) = Format(Total, "0.00")

            TotalA = 0
            TotalB = 0
            Total = 0
            Dt1.Rows.Add(r1)

            Dim r3 As DataRow = Dt1.NewRow
            r3(0) = "GRAND Total"
            r3(1) = ""
            r3(2) = ""
            r3(3) = ""
            r3(4) = Format(GTotalA, "0.00")
            r3(5) = Format(GTotalB, "0.00")
            r3(6) = Format(GrandTotal, "0.00")

            TotalA = 0
            TotalB = 0
            Total = 0
            Dt1.Rows.Add(r3)

            DsFinal.Tables.Add(Dt1)

        End If



        If Flag Then
            Return DsFinal
        Else
            Return dsDed

        End If







    End Function
    
    Protected Function GetallAdMsCompany() As DataSet
        Dim Str As String
        Str = "Select Com_Id," & _
        " Com_Code," & _
        " Com_Name," & _
        " Com_NameS, " & _
        " Com_TIC, " & _
        " Com_TaxCard, " & _
        " Com_SIRegNo, " & _
        " Com_CurSymbol, " & _
        " Com_Address1, " & _
        " Com_Address2, " & _
        " Com_Address3, " & _
        " Com_Address4, " & _
        " Com_Tel1, " & _
        " Com_Tel2, " & _
        " Com_Fax1, " & _
        " Com_Fax2, " & _
        " Com_AccountantPostCode, " & _
        " Com_AccountantPOBox," & _
        " Com_AccountantTitle," & _
        " Com_AccTIC," & _
        " Com_AccIdentity," & _
        " Com_TICCategory," & _
        " Com_TICType, " & _
        " Com_BankCode," & _
        " Com_GLAnal1," & _
        " Com_GLAnal2," & _
        " Com_GLAnal3," & _
        " Com_GLAnal4," & _
        " Com_GLAnal5," & _
        " Com_TSAccount, " & _
        " Com_TSAccountType, " & _
        " Com_TSBalAccount, " & _
        " Com_TSBalAccountType, " & _
        " Com_TSDefaultJob, " & _
        " Com_SI2, " & _
        " Com_SI3," & _
        " Com_SI4," & _
        " Com_SI5," & _
        " Com_BankCode2," & _
        " Com_BankCode3," & _
        " Com_BankCode4, " & _
        " Com_Logo," & _
        " Com_Stamp " & _
        " FROM AdMsCompany "
        Return MyBase.GetData(Str)
    End Function
    Protected Function GetAllAdMsCompanyOfUser(ByVal UserCode As String) As DataSet
        Dim Str As String
        Str = "Select AdMSCompany.Com_Id," & _
        " AdMSCompany.Com_Code," & _
        " Com_Name," & _
        " Com_NameS, " & _
        " Com_TIC, " & _
        " Com_TaxCard, " & _
        " Com_SIRegNo, " & _
        " Com_CurSymbol, " & _
        " Com_Address1, " & _
        " Com_Address2, " & _
        " Com_Address3, " & _
        " Com_Address4, " & _
        " Com_Tel1, " & _
        " Com_Tel2, " & _
        " Com_Fax1, " & _
        " Com_Fax2, " & _
        " Com_AccountantPostCode, " & _
        " Com_AccountantPOBox," & _
        " Com_AccountantTitle," & _
        " Com_AccTIC," & _
        " Com_AccIdentity," & _
        " Com_TICCategory," & _
        " Com_TICType, " & _
        " Com_BankCode," & _
        " Com_GLAnal1," & _
        " Com_GLAnal2," & _
        " Com_GLAnal3," & _
        " Com_GLAnal4," & _
        " Com_GLAnal5," & _
        " Com_TSAccount, " & _
        " Com_TSAccountType, " & _
        " Com_TSBalAccount, " & _
        " Com_TSBalAccountType, " & _
        " Com_TSDefaultJob, " & _
        " Com_SI2, " & _
        " Com_SI3," & _
        " Com_SI4," & _
        " Com_SI5," & _
        " Com_BankCode2," & _
        " Com_BankCode3," & _
        " Com_BankCode4, " & _
        " Com_Logo, " & _
        " Com_Stamp " & _
        " FROM AdMsCompany " & _
        " INNER Join" & _
        " PrSsCompanyUsers ON AdMSCompany.Com_Code = PrSsCompanyUsers.Com_Code" & _
        " WHERE (PrSsCompanyUsers.Usr_UserName = " & enQuoteString(UserCode) & ")"

        Return MyBase.GetData(Str)


    End Function
    Protected Function GetAllPrMsinterfaceTemplate() As DataSet
        Dim Str As String
        Str = "SELECT IntTem_Code," & _
       " TemGrp_Code," & _
       " IntTem_Description " & _
       " From PrMsInterfaceTemplate " & _
       " Order By IntTem_Code Asc"

        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsinterfaceTemplateForUser(ByVal UserName As String) As DataSet
        Dim Str As String
        Str = "SELECT IntTem_Code," & _
       " PrMsInterfaceTemplate.TemGrp_Code," & _
       " IntTem_Description " & _
       " From PrMsInterfaceTemplate " & _
       " INNER JOIN" & _
       " PrMsTemplateGroup ON PrMsInterfaceTemplate.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN" & _
       " PrSsCompanyUsers ON PrMsTemplateGroup.Com_Code = PrSsCompanyUsers.Com_Code" & _
       " WHERE (PrSsCompanyUsers.Usr_UserName = " & enQuoteString(UserName) & ")" & _
       " Order By IntTem_Code Asc"


        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsinterfaceCodes(ByVal TmpGrpCode As String) As DataSet
        Dim Str As String
        Str = "SELECT IntCod_Code," & _
       " TemGrp_Code," & _
       " IntCod_Description," & _
       " IntCod_AccountType " & _
       " From PrMsInterfaceCodes " & _
       " Where TemGrp_Code=" & enQuoteString(TmpGrpCode) & _
       " Order By IntCod_Code Asc"

        Return GetData(Str)
    End Function
    Protected Function GetAllPrMsInterfaceCodesByTemplateGroup(ByVal TempGrpCode As String) As DataSet
        Dim Str As String
        Str = "SELECT IntCod_Code," & _
       " TemGrp_Code," & _
       " IntCod_Description," & _
       " IntCod_AccountType " & _
       " From PrMsInterfaceCodes " & _
       " Where TemGrp_Code=" & enQuoteString(TempGrpCode) & _
       " Order By IntCod_Code Asc"

        Return GetData(Str)


    End Function
    Protected Function GetAllPrMsInterfaceTemplateByTemplateGroup(ByVal TemGrpCode As String) As DataSet
        Dim Str As String
        Str = "SELECT IntTem_Code," & _
       " TemGrp_Code," & _
       " IntTem_Description " & _
       " From PrMsInterfaceTemplate " & _
       " Where TemGrp_Code=" & enQuoteString(TemGrpCode)

        Return GetData(Str)
    End Function
    Protected Function GetAllPrmsEarningsInterface(ByVal IntTemCode As String) As DataSet
        Dim Str As String
        Str = "SELECT ErnInt_Id," & _
               " IntTem_Code," & _
               " TemGrp_Code," & _
               " ErnCod_Code, " & _
               " ErnInt_CreditAcc," & _
               " ErnInt_CreditConsolLevel," & _
               " ErnInt_DebitAcc, " & _
               " ErnInt_DebitConsolLevel," & _
               " ErnInt_CreditAnal, " & _
               " ErnInt_Debitanal" & _
               " FROM PrMsEarningsInterface" & _
               " WHERE (IntTem_Code=" & enQuoteString(IntTemCode) & ")"
        Return GetData(Str)
    End Function
    Protected Function GetAllPrmsDeductionsInterface(ByVal IntTemCode As String) As DataSet
        Dim Str As String
        Str = "SELECT DedInt_Id," & _
      " IntTem_Code," & _
      " TemGrp_Code," & _
      " DedCod_Code, " & _
      " DedInt_CreditAcc," & _
      " DedInt_CreditConsolLevel," & _
      " DedInt_DebitAcc, " & _
      " DedInt_DebitConsolLevel," & _
      " DedInt_CreditAnal, " & _
      " DedInt_Debitanal" & _
      " FROM PrMsDeductionsInterface" & _
      " WHERE (IntTem_Code=" & enQuoteString(IntTemCode) & ")"
        Return GetData(Str)
    End Function

    Protected Function GetAllPrmsContributionsInterface(ByVal IntTemCode As String) As DataSet
        Dim Str As String
        Str = "SELECT ConInt_Id," & _
      " IntTem_Code," & _
      " TemGrp_Code," & _
      " ConCod_Code, " & _
      " ConInt_CreditAcc," & _
      " ConInt_CreditConsolLevel," & _
      " ConInt_DebitAcc, " & _
      " ConInt_DebitConsolLevel," & _
      " ConInt_CreditAnal, " & _
      " ConInt_Debitanal" & _
      " FROM PrMsContributionsInterface" & _
      " WHERE (IntTem_Code=" & enQuoteString(IntTemCode) & ")"
        Return GetData(Str)
    End Function
    Protected Function FindTempInterfaceLevel1(ByVal AccCode As String, ByVal EDCCode As String, ByVal EmpCode As String, ByVal TemGrpCode As String, ByVal ConsolLevel As String, ByVal A0 As String, ByVal A1 As String, ByVal A2 As String, ByVal A3 As String, ByVal A4 As String, ByVal A5 As String, ByVal AU As String, ByVal BalCode As String, ByVal ThisIsCheque As Integer) As DataSet
        Dim Str As String

        'If ThisIsCheque = 0 Then
        Str = " SELECT Id," & _
            " Acc_Code," & _
            " TemGrp_Code," & _
            " Emp_Code," & _
            " EDC_Code, " & _
            " Con_Level, " & _
            " Amount," & _
            " Anal0," & _
            " Anal1," & _
            " Anal2, " & _
            " Anal3, " & _
            " Anal4, " & _
            " Anal5, " & _
            " AnalUnion, " & _
            " ExternalDoc, " & _
            " IsCheque, " & _
            " AccType, " & _
            " Anal0Pos," & _
            " Anal1Pos," & _
            " Anal2Pos, " & _
            " Anal3Pos, " & _
            " Anal4Pos, " & _
            " Anal5Pos, " & _
            " AnalUnionPos, " & _
            " BalAccount, " & _
            " ReasonCode " & _
            " FROM  PrTmInterface" & _
            " WHERE Acc_Code = " & enQuoteString(AccCode) & _
            " AND EDC_Code = " & enQuoteString(EDCCode) & _
            " AND Emp_Code = " & enQuoteString(EmpCode) & _
            " AND TemGrp_Code = " & enQuoteString(TemGrpCode) & _
            " AND Con_Level = " & enQuoteString(ConsolLevel) & _
            " AND Anal0 = " & enQuoteString(A0) & _
            " AND Anal1 = " & enQuoteString(A1) & _
            " AND Anal2 = " & enQuoteString(A2) & _
            " AND Anal3 = " & enQuoteString(A3) & _
            " AND Anal4 = " & enQuoteString(A4) & _
            " AND Anal5 = " & enQuoteString(A5) & _
            " AND AnalUnion = " & enQuoteString(AU) & _
            " AND BalAccount= " & enQuoteString(BalCode)
        'Else
        'Str = " SELECT Id," & _
        '               " Acc_Code," & _
        '               " TemGrp_Code," & _
        '               " Emp_Code," & _
        '               " EDC_Code, " & _
        '               " Con_Level, " & _
        '               " Amount," & _
        '               " Anal0," & _
        '               " Anal1," & _
        '               " Anal2, " & _
        '               " Anal3, " & _
        '               " Anal4, " & _
        '               " Anal5, " & _
        '               " AnalUnion, " & _
        '               " ExternalDoc, " & _
        '               " IsCheque, " & _
        '               " AccType, " & _
        '               " Anal0Pos," & _
        '               " Anal1Pos," & _
        '               " Anal2Pos, " & _
        '               " Anal3Pos, " & _
        '               " Anal4Pos, " & _
        '               " Anal5Pos, " & _
        '               " AnalUnionPos, " & _
        '               " BalAccount, " & _
        '               " ReasonCode " & _
        '               " FROM  PrTmInterface" & _
        '               " WHERE Acc_Code = " & enQuoteString(AccCode) & _
        '               " AND EDC_Code = " & enQuoteString(EDCCode) & _
        '               " AND Emp_Code = " & enQuoteString(EmpCode) & _
        '               " AND TemGrp_Code = " & enQuoteString(TemGrpCode) & _
        '               " AND Con_Level = " & enQuoteString(ConsolLevel) & _
        '               " AND AnalUnion = " & enQuoteString(AU) & _
        '               " AND BalAccount= " & enQuoteString(BalCode)
        'End If

        Return MyBase.GetData(Str)
    End Function
    Protected Function FindTempInterfaceLevel2(ByVal AccCode As String, ByVal EmpCode As String, ByVal TemGrpCode As String, ByVal ConsolLevel As String, ByVal A0 As String, ByVal A1 As String, ByVal A2 As String, ByVal A3 As String, ByVal A4 As String, ByVal A5 As String, ByVal AU As String, ByVal BalCode As String, ByVal ThisIsCheque As Integer) As DataSet
        Dim Str As String
        ' If ThisIsCheque = 0 Then
        Str = " SELECT Id," & _
            " Acc_Code," & _
            " TemGrp_Code," & _
            " Emp_Code," & _
            " EDC_Code, " & _
            " Con_Level, " & _
            " Amount, " & _
            " Anal0, " & _
            " Anal1," & _
            " Anal2, " & _
            " Anal3, " & _
            " Anal4, " & _
            " Anal5, " & _
            " AnalUnion, " & _
            " ExternalDoc, " & _
            " IsCheque, " & _
            " AccType," & _
            " Anal0Pos," & _
            " Anal1Pos," & _
            " Anal2Pos, " & _
            " Anal3Pos, " & _
            " Anal4Pos, " & _
            " Anal5Pos, " & _
            " AnalUnionPos, " & _
            " BalAccount, " & _
            " ReasonCode " & _
            " FROM  PrTmInterface" & _
            " WHERE Acc_Code = " & enQuoteString(AccCode) & _
            " AND Emp_Code = " & enQuoteString(EmpCode) & _
            " AND TemGrp_Code = " & enQuoteString(TemGrpCode) & _
            " AND Con_Level = " & enQuoteString(ConsolLevel) & _
            " AND Anal0 = " & enQuoteString(A0) & _
            " AND Anal1 = " & enQuoteString(A1) & _
            " AND Anal2 = " & enQuoteString(A2) & _
            " AND Anal3 = " & enQuoteString(A3) & _
            " AND Anal4 = " & enQuoteString(A4) & _
            " AND Anal5 = " & enQuoteString(A5) & _
            " AND AnalUnion = " & enQuoteString(AU) & _
            " AND BalAccount= " & enQuoteString(BalCode)
        'Else
        'Str = " SELECT Id," & _
        '               " Acc_Code," & _
        '               " TemGrp_Code," & _
        '               " Emp_Code," & _
        '               " EDC_Code, " & _
        '               " Con_Level, " & _
        '               " Amount, " & _
        '               " Anal0, " & _
        '               " Anal1," & _
        '               " Anal2, " & _
        '               " Anal3, " & _
        '               " Anal4, " & _
        '               " Anal5, " & _
        '               " AnalUnion, " & _
        '               " ExternalDoc, " & _
        '               " IsCheque, " & _
        '               " AccType," & _
        '               " Anal0Pos," & _
        '               " Anal1Pos," & _
        '               " Anal2Pos, " & _
        '               " Anal3Pos, " & _
        '               " Anal4Pos, " & _
        '               " Anal5Pos, " & _
        '               " AnalUnionPos, " & _
        '               " BalAccount, " & _
        '               " ReasonCode " & _
        '               " FROM  PrTmInterface" & _
        '               " WHERE Acc_Code = " & enQuoteString(AccCode) & _
        '               " AND Emp_Code = " & enQuoteString(EmpCode) & _
        '               " AND TemGrp_Code = " & enQuoteString(TemGrpCode) & _
        '               " AND Con_Level = " & enQuoteString(ConsolLevel) & _
        '               " AND AnalUnion = " & enQuoteString(AU) & _
        '               " AND BalAccount= " & enQuoteString(BalCode)
        'End If

        Return MyBase.GetData(Str)

    End Function
    Protected Function FindTempInterfaceLevel3(ByVal AccCode As String, ByVal TemGrpCode As String, ByVal ConsolLevel As String, ByVal A0 As String, ByVal A1 As String, ByVal A2 As String, ByVal A3 As String, ByVal A4 As String, ByVal A5 As String, ByVal AU As String, ByVal BalCode As String, ByVal ThisIsCheque As Integer) As DataSet
        Dim Str As String
        '  If ThisIsCheque = 0 Then
        Str = " SELECT Id," & _
            " Acc_Code," & _
            " TemGrp_Code," & _
            " Emp_Code," & _
            " EDC_Code, " & _
            " Con_Level, " & _
            " Amount," & _
            " Anal0, " & _
            " Anal1, " & _
            " Anal2, " & _
            " Anal3, " & _
            " Anal4, " & _
            " Anal5, " & _
            " AnalUnion, " & _
            " ExternalDoc, " & _
            " IsCheque, " & _
            " AccType," & _
            " Anal0Pos," & _
            " Anal1Pos," & _
            " Anal2Pos, " & _
            " Anal3Pos, " & _
            " Anal4Pos, " & _
            " Anal5Pos, " & _
            " AnalUnionPos, " & _
            " BalAccount, " & _
            " ReasonCode " & _
            " FROM  PrTmInterface" & _
            " WHERE Acc_Code = " & enQuoteString(AccCode) & _
            " AND TemGrp_Code = " & enQuoteString(TemGrpCode) & _
            " AND Con_Level = " & enQuoteString(ConsolLevel) & _
            " AND Anal0 = " & enQuoteString(A0) & _
            " AND Anal1 = " & enQuoteString(A1) & _
            " AND Anal2 = " & enQuoteString(A2) & _
            " AND Anal3 = " & enQuoteString(A3) & _
            " AND Anal4 = " & enQuoteString(A4) & _
            " AND Anal5 = " & enQuoteString(A5) & _
            " AND AnalUnion = " & enQuoteString(AU) & _
            " AND BalAccount= " & enQuoteString(BalCode)
        'Else
        'Str = " SELECT Id," & _
        '              " Acc_Code," & _
        '              " TemGrp_Code," & _
        '              " Emp_Code," & _
        '              " EDC_Code, " & _
        '              " Con_Level, " & _
        '              " Amount," & _
        '              " Anal0, " & _
        '              " Anal1, " & _
        '              " Anal2, " & _
        '              " Anal3, " & _
        '              " Anal4, " & _
        '              " Anal5, " & _
        '              " AnalUnion, " & _
        '              " ExternalDoc, " & _
        '              " IsCheque, " & _
        '              " AccType," & _
        '              " Anal0Pos," & _
        '              " Anal1Pos," & _
        '              " Anal2Pos, " & _
        '              " Anal3Pos, " & _
        '              " Anal4Pos, " & _
        '              " Anal5Pos, " & _
        '              " AnalUnionPos, " & _
        '              " BalAccount, " & _
        '              " ReasonCode " & _
        '              " FROM  PrTmInterface" & _
        '              " WHERE Acc_Code = " & enQuoteString(AccCode) & _
        '              " AND TemGrp_Code = " & enQuoteString(TemGrpCode) & _
        '              " AND Con_Level = " & enQuoteString(ConsolLevel) & _
        '              " AND AnalUnion = " & enQuoteString(AU) & _
        '              " AND BalAccount= " & enQuoteString(BalCode)
        'End If
        Return MyBase.GetData(Str)
    End Function
    Protected Function DeleteAllFromTempInterface(ByVal TemGrpCode) As Boolean
        Dim Str As String
        Dim Flag As Boolean
        Str = "Delete From PrTmInterface" & _
        " Where TemGrp_Code=" & enQuoteString(TemGrpCode)

        Dim i As String
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            Flag = True
        Else
            Flag = False
        End If
        Return Flag

    End Function
    Protected Function FindEmployee(ByVal Code As String, ByVal NextEmp As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String
        Str = " SELECT Top(1) " & _
              " Emp_Code " & _
              " FROM PrMsEmployees"
        If NextEmp Then
            Str2 = " WHERE Emp_Code >" & enQuoteString(Code) & _
                   " Order by Emp_Code Asc"
        Else
            Str2 = " WHERE Emp_Code <" & enQuoteString(Code) & _
                   " Order by Emp_Code Desc"
        End If

        Str = Str & Str2

        Return MyBase.GetData(Str)
    End Function
    Protected Function FindEmployeeOfUser(ByVal Code As String, ByVal NextEmp As Boolean, ByVal UserName As String, ByVal SameCode As Boolean, OnlyActive As Boolean, OnlyThisTemplateGroup As String) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""



        If OnlyThisTemplateGroup <> "" Then
            Str3 = " AND PrMsEmployees.TemGrp_Code=" & enQuoteString(OnlyThisTemplateGroup)
            OnlyActive = False
        End If
        If OnlyActive Then
            Str3 = " AND Emp_Status='A'"
        End If

        Str4 = " AND PrMsTemplateGroup.TemGrp_IsActive='Y'"

        Str = " SELECT Top(1) " &
              " Emp_Code " &
              " FROM PrMsEmployees" &
              " INNER JOIN" &
              " PrMsTemplateGroup ON PrMsEmployees.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN" &
              " PrSsCompanyUsers ON PrMsTemplateGroup.Com_Code = PrSsCompanyUsers.Com_Code"
        If Not SameCode Then
            If NextEmp Then
                Str2 = " WHERE Emp_Code >" & enQuoteString(Code) &
                        " AND (PrSsCompanyUsers.Usr_UserName = " & enQuoteString(UserName) & ")" &
                        Str3 & Str4 &
                       " Order by Emp_Code Asc"
            Else
                Str2 = " WHERE Emp_Code <" & enQuoteString(Code) &
                        " AND (PrSsCompanyUsers.Usr_UserName = " & enQuoteString(UserName) & ")" &
                        Str3 & Str4 &
                       " Order by Emp_Code Desc"
            End If
        Else
            Str2 = " WHERE Emp_Code =" & enQuoteString(Code) &
                    " AND (PrSsCompanyUsers.Usr_UserName = " & enQuoteString(UserName) & ")" &
                    Str3 & Str4 &
                   " Order by Emp_Code Asc"

        End If

        Str = Str & Str2

        Return MyBase.GetData(Str)
    End Function
    Protected Function GetAllEmployeesOfUser(ByVal UserName As String) As DataSet
        Dim Str As String

        Str = " SELECT " & _
              " PrMsEmployees.TemGrp_code," & _
              " Emp_Code," & _
              " Emp_LastName," & _
              " Emp_FirstName," & _
              " Emp_BirthDate," & _
              " Emp_SocialInsNumber," & _
              " Emp_IdentificationCard," & _
              " Emp_AlienNumber," & _
              " Emp_StartDate" & _
              " FROM PrMsEmployees" & _
              " INNER JOIN" & _
              " PrMsTemplateGroup ON PrMsEmployees.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN" & _
              " PrSsCompanyUsers ON PrMsTemplateGroup.Com_Code = PrSsCompanyUsers.Com_Code" & _
              " where PrMsEmployees.emp_status='A' " & _
               " AND (PrSsCompanyUsers.Usr_UserName = " & enQuoteString(UserName) & ")" & _
               " Order by PrMsEmployees.TemGrp_Code,PrMsEmployees.Emp_Code Asc"

        Return MyBase.GetData(Str)
    End Function
    Protected Function GetAllEmployeesOfUserByDepartmentWithSalary_1(ByVal UserName As String) As DataSet
        Dim Str As String
        Str = "SELECT PrMsEmployees.TemGrp_Code," & _
        " PrAnEmployeeAnalysis2.EmpAn2_Code, " & _
        " PrAnEmployeeAnalysis2.EmpAn2_DescriptionL," & _
        " PrMsEmployees.Emp_Code," & _
        " PrMsEmployees.Emp_LastName," & _
        " PrMsEmployees.Emp_FirstName, " & _
        " PrMsEmployees.Emp_StartDate," & _
        " PrMsEmployees.Emp_BirthDate," & _
        " PrMsEmployees.Emp_SocialInsNumber," & _
        " PrMsEmployees.Emp_IdentificationCard," & _
        " PrMsEmployees.Emp_AlienNumber, " & _
        " PrMsEmployees.Emp_telephone1, " & _
        " PrMsEmployees.Emp_telephone2, " & _
        " PrMsEmployees.Sic_Code," & _
        " 0.00 as Salary" & _
        " FROM            PrMsEmployees INNER JOIN" & _
        " PrAnEmployeeAnalysis2 ON PrMsEmployees.EmpAn2_Code = PrAnEmployeeAnalysis2.EmpAn2_Code INNER JOIN" & _
        " PrMsTemplateGroup ON PrMsEmployees.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN" & _
        " PrSsCompanyUsers ON PrMsTemplateGroup.Com_Code = PrSsCompanyUsers.Com_Code" & _
        " WHERE (PrMsEmployees.ComSin_EmpSocialInsNo <> '') AND (PrMsEmployees.Emp_Status = 'A')" & _
        " AND  (PrSsCompanyUsers.Usr_UserName=" & enQuoteString(UserName) & ")" & _
        " ORDER BY PrMsEmployees.EmpAn2_Code,PrMsEmployees.Emp_Code"

        Dim ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Dim i As Integer
            Dim EmpCode As String = ""
            Dim Date1 As Date = Now.Date
            Dim Sal As cPrTxEmployeeSalary
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                EmpCode = DbNullToString(ds.Tables(0).Rows(i).Item(3))
                Sal = GetCurrentSalary(EmpCode, Date1)
                If Sal.Id <> 0 Then
                    ds.Tables(0).Rows(i).Item(14) = Sal.SalaryValue
                End If
            Next
        End If
        Return Ds


    End Function
    Protected Function GetAllPrTmInterface(ByVal TmpGrpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT Id," & _
           " Acc_Code," & _
           " TemGrp_Code," & _
           " Emp_Code," & _
           " EDC_Code, " & _
           " Con_Level, " & _
           " Amount," & _
           " Anal0," & _
           " Anal1," & _
           " Anal2," & _
           " Anal3," & _
           " Anal4," & _
           " Anal5," & _
           " AnalUnion, " & _
           " ExternalDoc, " & _
            " IsCheque, " & _
            " AccType, " & _
            " Anal0Pos, " & _
            " Anal1Pos, " & _
            " Anal2Pos, " & _
            " Anal3Pos, " & _
            " Anal4Pos, " & _
            " Anal5Pos, " & _
            " AnalUnionPos," & _
            " BalAccount, " & _
            " ReasonCode " & _
           " FROM  PrTmInterface" & _
           " WHERE TemGrp_Code = " & enQuoteString(TmpGrpCode) & _
           " Order By Acc_Code Asc ,Id Asc"
        ' balaccount,Id Asc"
        Return MyBase.GetData(Str)

    End Function
    Protected Function GetAllPrTmInterfacePerAccount(ByVal TmpGrpCode As String, ByVal AccountCode As String) As DataSet
        Dim Str As String
        Str = " SELECT Id," & _
           " Acc_Code," & _
           " TemGrp_Code," & _
           " Emp_Code," & _
           " EDC_Code, " & _
           " Con_Level, " & _
           " Amount," & _
           " Anal0," & _
           " Anal1," & _
           " Anal2," & _
           " Anal3," & _
           " Anal4," & _
           " Anal5," & _
           " AnalUnion, " & _
           " ExternalDoc, " & _
            " IsCheque, " & _
            " AccType, " & _
            " Anal0Pos, " & _
            " Anal1Pos, " & _
            " Anal2Pos, " & _
            " Anal3Pos, " & _
            " Anal4Pos, " & _
            " Anal5Pos, " & _
            " AnalUnionPos," & _
            " BalAccount, " & _
            " ReasonCode " & _
           " FROM  PrTmInterface" & _
           " WHERE TemGrp_Code = " & enQuoteString(TmpGrpCode) & _
           " AND Acc_Code = " & enQuoteString(AccountCode) & _
           " Order By balaccount,Id Asc"
        Return MyBase.GetData(Str)

    End Function
    Protected Function GetAllPrTmInterfaceSumPerAccount(ByVal TmpGrpCode As String, ByVal AccountCode As String) As Double
        Dim Str As String
        Dim total As Double = 0
        Dim Ds As DataSet
        Str = " SELECT Sum(Amount)" & _
           " FROM  PrTmInterface" & _
           " WHERE TemGrp_Code = " & enQuoteString(TmpGrpCode) & _
           " AND Acc_Code = " & enQuoteString(AccountCode)


        Ds = MyBase.GetData(Str)
        If CheckDataSet(Ds) Then
            total = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return total

    End Function
    Protected Function GetAllPrTmInterfaceAmountSumPerAccount(ByVal TmpGrpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT Sum(Amount)," & _
           " Acc_Code" & _
            " FROM  PrTmInterface" & _
           " WHERE TemGrp_Code = " & enQuoteString(TmpGrpCode) & _
           " Group By Acc_Code"
        Return MyBase.GetData(Str)

    End Function
    Protected Function GetAllPrTmInterface_TA(ByVal TmpGrpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT Id," & _
           " Acc_Code," & _
           " TemGrp_Code," & _
           " Emp_Code," & _
           " EDC_Code, " & _
           " Con_Level, " & _
           " Amount," & _
           " Anal0," & _
           " Anal1," & _
           " Anal2," & _
           " Anal3," & _
           " Anal4," & _
           " Anal5," & _
           " AnalUnion, " & _
           " ExternalDoc, " & _
            " IsCheque, " & _
            " AccType, " & _
            " Anal0Pos, " & _
            " Anal1Pos, " & _
            " Anal2Pos, " & _
            " Anal3Pos, " & _
            " Anal4Pos, " & _
            " Anal5Pos, " & _
            " AnalUnionPos," & _
            " BalAccount, " & _
            " ReasonCode " & _
           " FROM  PrTmInterface" & _
           " WHERE TemGrp_Code = " & enQuoteString(TmpGrpCode) & _
           " Order By balaccount,Id Asc"
        Return MyBase.GetData(Str)

    End Function
    Protected Function GetAllPrMsCodeMasking(ByVal InterfaceCode As String) As DataSet
        Dim Str As String
        Str = "  SELECT" & _
               " CodMsk_Id," & _
               " IntCod_Code," & _
               " CodMsk_Position," & _
               " CodMsk_Type," & _
               " CodMsk_Value " & _
               " FROM PrMsCodeMasking" & _
               " WHERE IntCod_Code = " & enQuoteString(InterfaceCode) & _
               " Order By CodMsk_Position asc "
        Return MyBase.GetData(Str)

    End Function
    Protected Function GetNumberOfTaxablePeriodsToDate(ByVal tPerCode As cPrMsPeriodCodes)
        Dim Str As String
        Dim Ds As DataSet
        Dim Ds2 As DataSet
        Dim NOfPeriods As Integer = 1
        Dim PeriodCode As String
        Dim Count As Integer
        Dim i As Integer
        Str = "SELECT PrdCod_Code FROM PrMsPeriodCodes" & _
              " WHERE PrdGrp_code=" & enQuoteString(tPerCode.PrdGrpCode) & _
              " AND PrdCod_Sequence<=" & tPerCode.Sequence

        DS = GetData(Str)

        If CheckDataSet(DS) Then
            For i = 0 To DS.Tables(0).Rows.Count - 1
                PeriodCode = DbNullToString(DS.Tables(0).Rows(i).Item(0))
                Str = " SELECT  PrMsPeriodDeductions.PrdDed_id " & _
                           " FROM PrMsPeriodDeductions INNER JOIN" & _
                           " PrMsDeductionCodes ON" & _
                           " PrMsPeriodDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN" & _
                           " PrSsDeductionTypes ON" & _
                           " PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code" & _
                           " WHERE (PrMsPeriodDeductions.PrdDed_IsActive = 'Y')" & _
                           " AND (PrMsPeriodDeductions.PrdCod_Code = " & PeriodCode & ") AND " & _
                           " (PrMsPeriodDeductions.PrdGrp_Code = " & enQuoteString(tPerCode.PrdGrpCode) & ") AND" & _
                           " (PrSsDeductionTypes.DedTyp_Code = 'IT') "
                ds2 = GetData(Str)
                If CheckDataSet(Ds2) Then
                    count = count + 1
                End If
            Next
        End If


       
        Return Count
    End Function
    Public Shadows Function GetAllTrxnHeaderForPeriod(ByVal Per As cPrMsPeriodCodes, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String, ByVal Cash As Boolean, ByVal Cheque As Boolean, ByVal Bank As Boolean, ByVal IsSplitEmployee As Boolean, ByVal OnlyActiveemployees As Boolean, ByVal GenAnal1 As String, ByVal orderbyanal As Integer, ByVal BankCode As String, ByVal EmpBankCode As String, ByVal OnlyEmpWithTermDate As Boolean, ByVal SICategory As String, ByVal AgeFilter As String, ByVal OnlyLeavers As Boolean, ByVal OnlyHiredthisYear As Boolean, ByVal EWallet As Boolean) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = " SELECT  PrTxTrxnHeader.TrxHdr_Id," & _
        " PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_FullName, " & _
         " PrTxTrxnHeader.TrxHdr_NetSalary," & _
        " PrTxTrxnHeader.TrxHdr_MonthlySalary," & _
        " PrTxTrxnHeader.TrxHdr_PeriodUnits," & _
        " PrTxTrxnHeader.TrxHdr_Paymentref," & _
        " PrTxTrxnHeader.TrxHdr_OverTime1," & _
        " PrTxTrxnHeader.TrxHdr_OverTime2," & _
        " PrTxTrxnHeader.TrxHdr_Salary1," & _
        " PrTxTrxnHeader.TrxHdr_Salary2," & _
        " PrTxTrxnHeader.TrxHdr_OverTime3, " & _
        " PrTxTrxnHeader.TrxHdr_Sectors," & _
        " PrTxTrxnHeader.TrxHdr_Dutyhours," & _
        " PrTxTrxnHeader.TrxHdr_FlightHours," & _
        " PrTxTrxnHeader.TrxHdr_Commission," & _
        " PrTxTrxnHeader.TrxHdr_PBAmount," & _
        " PrTxTrxnHeader.TrxHdr_PBRate," & _
        " PrTxTrxnHeader.TrxHdr_A2," & _
        " PrTxTrxnHeader.TrxHdr_Overlay," & _
        " PrTxTrxnHeader.TrxHdr_PeriodSplit," & _
        " PrMsEmployees.Emp_StartDate," & _
        " PrTxTrxnHeader.TrxHdr_Position," & _
        " PrTxTrxnHeader.TrxHdr_TotalErnPeriod," & _
        " PrTxTrxnHeader.TrxHdr_TotalDedPeriod," & _
        " PrTxTrxnHeader.TrxHdr_TotalConPeriod," & _
        " PrTxTrxnHeader.TrxHdr_BasisOnSalary, " & _
        " PrTxTrxnHeader.TrxHdr_GesiD, " & _
        " PrTxTrxnHeader.TrxHdr_GesiC, " & _
        " PrTxTrxnHeader.TrxHdr_Medical, " & _
        " PrTxTrxnHeader.Com_Code," & _
        " PrTxTrxnHeader.TrxHdr_Year, " & _
        " TrxHdr_GESIableAmount, " & _
        " Trxhdr_BIK_GESID," & _
        " Trxhdr_BIK_GESIC," & _
        " Trxhdr_BIK_Gesiable, " & _
        " Trxhdr_AnalGen1, " & _
        " PrTxTrxnHeader.TrxHdr_A1 as Anl1," & _
        " PrTxTrxnHeader.TrxHdr_A2 as Anl2," & _
        " PrTxTrxnHeader.TrxHdr_A3 as Anl3," & _
        " PrTxTrxnHeader.TrxHdr_A4 as Anl4," & _
        " PrTxTrxnHeader.TrxHdr_A5 as Anl5," & _
        " PrAnEmployeeAnalysis1.EmpAn1_DescriptionL," & _
        " PrAnEmployeeAnalysis2.EmpAn2_DescriptionL," & _
        " PrAnEmployeeAnalysis3.EmpAn3_DescriptionL," & _
        " PrAnEmployeeAnalysis4.EmpAn4_DescriptionL," & _
        " PrAnEmployeeAnalysis5.EmpAn5_DescriptionL, " & _
        " PrMsEmployees.Emp_TerminateDate, " & _
        " PrMsEmployees.Emp_SocialInsNumber, " & _
        " PrMsEmployees.Emp_BankBenName ," & _
        " PrMsEmployees.Emp_BankAccountCo, " & _
        " PrMsEmployees.Emp_BirthDate, " & _
        " PrMsEmployees.Emp_IdentificationCard," & _
        " PrMsEmployees.Emp_TaxID, " & _
        " PrMsEmployees.Emp_Address1," & _
        " PrMsEmployees.Emp_Address3," & _
        " PrMsEmployees.Emp_PostCode," & _
        " PrMsEmployees.Emp_Address2, " & _
        " PrMsEmployees.Emp_HRCode, " & _
        " PrTxTrxnHeader.TrxHdr_Maternity, " & _
        " PrTxTrxnHeader.TrxHdr_FEPercent, " & _
        " PrTxTrxnHeader.TrxHdr_FEControlAmount, " & _
        " PrMsEmployees.Emp_TermReason " & _
        " FROM PrTxTrxnHeader inner JOIN" & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code INNER JOIN " & _
        " PrAnEmployeeAnalysis1 ON PrTxTrxnheader.Trxhdr_A1 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis1.EmpAn1_Code INNER JOIN " & _
        " PrAnEmployeeAnalysis2 ON PrTxTrxnheader.Trxhdr_A2 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis2.EmpAn2_Code INNER JOIN " & _
        " PrAnEmployeeAnalysis3 ON PrTxTrxnheader.Trxhdr_A3 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis3.EmpAn3_Code INNER JOIN " & _
        " PrAnEmployeeAnalysis4 ON PrTxTrxnheader.Trxhdr_A4 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis4.EmpAn4_Code INNER JOIN " & _
        " PrAnEmployeeAnalysis5 ON PrTxTrxnheader.Trxhdr_A5 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis5.EmpAn5_Code " & _
        " WHERE (PrdCod_Code =" & enQuoteString(Per.Code) & ")" & _
        " AND (PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")"
        '" PrAnEmployeeAnalysis1 ON PrMsEmployees.EmpAn1_Code = PrAnEmployeeAnalysis1.EmpAn1_Code INNER JOIN " & _
        '" PrAnEmployeeAnalysis2 ON PrMsEmployees.EmpAn2_Code = PrAnEmployeeAnalysis2.EmpAn2_Code INNER JOIN " & _
        '" PrAnEmployeeAnalysis3 ON PrMsEmployees.EmpAn3_Code = PrAnEmployeeAnalysis3.EmpAn3_Code INNER JOIN " & _
        '" PrAnEmployeeAnalysis4 ON PrMsEmployees.EmpAn4_Code = PrAnEmployeeAnalysis4.EmpAn4_Code INNER JOIN " & _
        '" PrAnEmployeeAnalysis5 ON PrMsEmployees.EmpAn5_Code = PrAnEmployeeAnalysis5.EmpAn5_Code " & _

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxTrxnHeader.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxTrxnHeader.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If
        Dim str4 As String = ""
        Select Case Analysis
            Case 0
                str4 = ""

            Case 1
                str4 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str4 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str4 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str4 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str4 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str4 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select

        Dim Str5 As String = ""

        If Cash Then
            Str5 = " AND (PrMsEmployees.PmtMth_Code =1"
        End If
        If Cheque Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =2"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =2"
            End If
        End If
        If Bank Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =3"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =3"
            End If
        End If
        If EWallet Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =4"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =4"
            End If
        End If
        If Str5 <> "" Then
            Str5 = Str5 & ")"
        End If
        Dim Str6 As String = ""
        If IsSplitEmployee Then
            Str6 = " AND Emp_Splitemployement='1'"
        End If

        Dim Str7 As String = ""
        If OnlyActiveemployees Then
            Str7 = " AND prmsemployees.Emp_Status='A'"
        End If

        Dim Str8 As String = ""
        If GenAnal1 <> "" Then
            Str8 = " AND prmsemployees.Emp_AnalGen1=" & enQuoteString(GenAnal1)
        End If

        Dim Str9 As String = ""
        If BankCode <> "ALL" Then
            Str9 = " AND prmsemployees.Bnk_CodeCo=" & enQuoteString(BankCode)
        End If

        Dim Str10 As String = ""
        If EmpBankCode <> "ALL" Then
            Str10 = " AND prmsemployees.Bnk_Code=" & enQuoteString(EmpBankCode)
        End If

        Dim Str11 As String = ""
        If OnlyEmpWithTermDate Then
            Str11 = " AND prmsemployees.Emp_TerminateDate<>''"
        End If

        Dim Str12 As String = ""
        If SICategory <> "" Then
            Str12 = " AND prmsemployees.Sic_Code=" & enQuoteString(SICategory)
        End If

        Dim Str13 As String = ""
        If AgeFilter <> "" Then
            Dim Date1 As String
            Date1 = Utils.ChangeDateFormatForSearch(Format(Now.Date, "yyyy-MM-dd"))
            Str13 = " AND datediff(""HOUR"" ,Emp_BirthDate ," & enQuoteString(Date1) & ")/8766.0 " & AgeFilter
        End If

        Dim Str14 As String = ""
        If OnlyLeavers Then
            Str14 = " AND Emp_TerminateDate<>''"
        End If

        Dim Str15 As String = ""
        If OnlyHiredthisYear Then
            Str15 = " AND datepart(year,PrMsEmployees .Emp_StartDate)=" & enQuoteString(Per.DateFrom.Year)
        End If

        Dim Str16 As String = ""
        If orderbyanal = 0 Then
            Str16 = " Order by PrMsEmployees.Emp_Code Asc"
        Else
            Select Case orderbyanal
                Case 1
                    Str16 = " Order by PrTxTrxnHeader.TrxHdr_A1 asc, PrMsEmployees.Emp_Code Asc"
                Case 2
                    Str16 = " Order by PrTxTrxnHeader.TrxHdr_A2, PrMsEmployees.Emp_Code Asc"
                Case 3
                    Str16 = " Order by PrTxTrxnHeader.TrxHdr_A3 asc, PrMsEmployees.Emp_Code Asc"
                Case 4
                    Str16 = " Order by PrTxTrxnHeader.TrxHdr_A4 asc, PrMsEmployees.Emp_Code Asc"
                Case 5
                    Str16 = " Order by PrTxTrxnHeader.TrxHdr_A5, PrMsEmployees.Emp_Code Asc"
                Case 6
                    Str16 = " Order by PrTxTrxnHeader.TrxHdr_Union, PrMsEmployees.Emp_Code Asc"

            End Select

        End If

        Str = Str & Str2 & Str3 & str4 & Str5 & Str6 & Str7 & Str8 & Str9 & Str10 & Str11 & Str12 & Str13 & Str14 & Str15 & Str16



        Return GetData(Str)
    End Function
    Public Shadows Function GetAllTrxnHeaderForTemplateGroupForPeriodGroup(ByVal TempGroup As String, ByVal PerGroup As String, ByVal PeriodCode As String) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = " SELECT  TrxHdr_Id " & _
                " From PrTxTrxnHeader where " & _
                " TemGrp_Code = " & enQuoteString(TempGroup) & _
                " AND PrdGrp_Code = " & enQuoteString(PerGroup)
        If PeriodCode <> "" Then
            Str2 = " AND PrdCod_Code <> " & enQuoteString(PeriodCode)
        End If
        str3 = " Order by PrdCod_Code Asc"
        Str = Str & Str2 & str3
        Return GetData(Str)

    End Function
    Public Shadows Function GetAllTrxnHeaderForTemplateGroupForPeriodGroupForPeriod(ByVal TempGroup As String, ByVal PerGroup As String, ByVal PeriodCode As String) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = " SELECT  TrxHdr_Id," & _
                " Emp_Code " & _
                " From PrTxTrxnHeader where " & _
                " TemGrp_Code = " & enQuoteString(TempGroup) & _
                " AND PrdGrp_Code = " & enQuoteString(PerGroup) & _
                " AND PrdCod_Code = " & enQuoteString(PeriodCode) & _
                " Order by trxhdr_id Asc"

        Return GetData(Str)

    End Function
    Public Shadows Function GetAllTrxnHeaderForPeriodForUnitsReport(ByVal Per As cPrMsPeriodCodes, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String, ByVal Cash As Boolean, ByVal Cheque As Boolean, ByVal Bank As Boolean, ByVal IsSplitEmployee As Boolean, ByVal OnlyActiveemployees As Boolean, ByVal GenAnal1 As String, ByVal orderbyanal As Integer, ByVal BankCode As String, ByVal EmpBankCode As String, ByVal OnlyEmpWithTermDate As Boolean, ByVal SICategory As String, ByVal AgeFilter As String, ByVal OnlyLeavers As Boolean, ByVal OnlyHiredthisYear As Boolean, ByVal PerTo As cPrMsPeriodCodes, ByVal EWallet As Boolean) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = " SELECT  " & _
        " PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_FullName, " & _
        " PrMsEmployees.Emp_BirthDate, " & _
        " PrMsEmployees.Emp_StartDate," & _
        " PrMsEmployees.Emp_TerminateDate, " & _
        " PrMsEmployees.Emp_SocialInsNumber, " & _
        " PrMsEmployees.Emp_IdentificationCard," & _
        " PrMsEmployees.Emp_TaxID," & _
        " sum(PrTxTrxnHeader.TrxHdr_PeriodUnits)," & _
        " sum(PrTxTrxnHeader.TrxHdr_AnnualUnits)," & _
        " PrTxTrxnHeader.TrxHdr_A1 as Anl1," & _
        " PrTxTrxnHeader.TrxHdr_A2 as Anl2," & _
        " PrTxTrxnHeader.TrxHdr_A3 as Anl3," & _
        " PrTxTrxnHeader.TrxHdr_A4 as Anl4," & _
        " PrTxTrxnHeader.TrxHdr_A5 as Anl5," & _
        " PrAnEmployeeAnalysis1.EmpAn1_DescriptionL," & _
        " PrAnEmployeeAnalysis2.EmpAn2_DescriptionL," & _
        " PrAnEmployeeAnalysis3.EmpAn3_DescriptionL," & _
        " PrAnEmployeeAnalysis4.EmpAn4_DescriptionL," & _
        " PrAnEmployeeAnalysis5.EmpAn5_DescriptionL " & _
        " FROM PrTxTrxnHeader inner JOIN" & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code INNER JOIN " & _
        " PrAnEmployeeAnalysis1 ON PrTxTrxnheader.Trxhdr_A1 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis1.EmpAn1_Code INNER JOIN " & _
        " PrAnEmployeeAnalysis2 ON PrTxTrxnheader.Trxhdr_A2 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis2.EmpAn2_Code INNER JOIN " & _
        " PrAnEmployeeAnalysis3 ON PrTxTrxnheader.Trxhdr_A3 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis3.EmpAn3_Code INNER JOIN " & _
        " PrAnEmployeeAnalysis4 ON PrTxTrxnheader.Trxhdr_A4 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis4.EmpAn4_Code INNER JOIN " & _
        " PrAnEmployeeAnalysis5 ON PrTxTrxnheader.Trxhdr_A5 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis5.EmpAn5_Code " & _
        " WHERE (PrdCod_Code >=" & enQuoteString(Per.Code) & " AND PrdCod_Code <=" & enQuoteString(PerTo.Code) & ")" & _
        " AND (PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")"
        '" PrAnEmployeeAnalysis1 ON PrMsEmployees.EmpAn1_Code = PrAnEmployeeAnalysis1.EmpAn1_Code INNER JOIN " & _
        '" PrAnEmployeeAnalysis2 ON PrMsEmployees.EmpAn2_Code = PrAnEmployeeAnalysis2.EmpAn2_Code INNER JOIN " & _
        '" PrAnEmployeeAnalysis3 ON PrMsEmployees.EmpAn3_Code = PrAnEmployeeAnalysis3.EmpAn3_Code INNER JOIN " & _
        '" PrAnEmployeeAnalysis4 ON PrMsEmployees.EmpAn4_Code = PrAnEmployeeAnalysis4.EmpAn4_Code INNER JOIN " & _
        '" PrAnEmployeeAnalysis5 ON PrMsEmployees.EmpAn5_Code = PrAnEmployeeAnalysis5.EmpAn5_Code " & _

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxTrxnHeader.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxTrxnHeader.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If
        Dim str4 As String = ""
        Select Case Analysis
            Case 0
                str4 = ""

            Case 1
                str4 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str4 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str4 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str4 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str4 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str4 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select

        Dim Str5 As String = ""

        If Cash Then
            Str5 = " AND (PrMsEmployees.PmtMth_Code =1"
        End If
        If Cheque Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =2"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =2"
            End If
        End If
        If Bank Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =3"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =3"
            End If
        End If
        If EWallet Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =4"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =4"
            End If
        End If
        If Str5 <> "" Then
            Str5 = Str5 & ")"
        End If
        Dim Str6 As String = ""
        If IsSplitEmployee Then
            Str6 = " AND Emp_Splitemployement='1'"
        End If

        Dim Str7 As String = ""
        If OnlyActiveemployees Then
            Str7 = " AND prmsemployees.Emp_Status='A'"
        End If

        Dim Str8 As String = ""
        If GenAnal1 <> "" Then
            Str8 = " AND prmsemployees.Emp_AnalGen1=" & enQuoteString(GenAnal1)
        End If

        Dim Str9 As String = ""
        If BankCode <> "ALL" Then
            Str9 = " AND prmsemployees.Bnk_CodeCo=" & enQuoteString(BankCode)
        End If

        Dim Str10 As String = ""
        If EmpBankCode <> "ALL" Then
            Str10 = " AND prmsemployees.Bnk_Code=" & enQuoteString(EmpBankCode)
        End If

        Dim Str11 As String = ""
        If OnlyEmpWithTermDate Then
            Str11 = " AND prmsemployees.Emp_TerminateDate<>''"
        End If

        Dim Str12 As String = ""
        If SICategory <> "" Then
            Str12 = " AND prmsemployees.Sic_Code=" & enQuoteString(SICategory)
        End If

        Dim Str13 As String = ""
        If AgeFilter <> "" Then
            Dim Date1 As String
            Date1 = Utils.ChangeDateFormatForSearch(Format(Now.Date, "yyyy-MM-dd"))
            Str13 = " AND datediff(""HOUR"" ,Emp_BirthDate ," & enQuoteString(Date1) & ")/8766.0 " & AgeFilter
        End If

        Dim Str14 As String = ""
        If OnlyLeavers Then
            Str14 = " AND Emp_TerminateDate<>''"
        End If

        Dim Str15 As String
        If OnlyHiredthisYear Then
            Str15 = " AND datepart(year,PrMsEmployees .Emp_StartDate)=" & enQuoteString(Per.DateFrom.Year)
        End If



        Dim Str16 As String
        Str16 = " Group By " & _
        " PrTxTrxnHeader.Emp_Code, " & _
        " PrMsEmployees.Emp_FullName, " & _
        " PrMsEmployees.Emp_BirthDate, " & _
        " PrMsEmployees.Emp_StartDate," & _
        " PrMsEmployees.Emp_TerminateDate, " & _
        " PrMsEmployees.Emp_SocialInsNumber, " & _
        " PrMsEmployees.Emp_IdentificationCard," & _
        " PrMsEmployees.Emp_TaxID, " & _
        " PrTxTrxnHeader.TrxHdr_A1," & _
        " PrTxTrxnHeader.TrxHdr_A2," & _
        " PrTxTrxnHeader.TrxHdr_A3," & _
        " PrTxTrxnHeader.TrxHdr_A4," & _
        " PrTxTrxnHeader.TrxHdr_A5," & _
        " PrAnEmployeeAnalysis1.EmpAn1_DescriptionL," & _
        " PrAnEmployeeAnalysis2.EmpAn2_DescriptionL," & _
        " PrAnEmployeeAnalysis3.EmpAn3_DescriptionL," & _
        " PrAnEmployeeAnalysis4.EmpAn4_DescriptionL," & _
        " PrAnEmployeeAnalysis5.EmpAn5_DescriptionL "

        Dim Str17 As String = ""
        If orderbyanal = 0 Then
            Str17 = " Order by PrTxTrxnHeader.Emp_Code Asc"
        Else
            Select Case orderbyanal
                Case 1
                    Str17 = " Order by PrTxTrxnHeader.TrxHdr_A1 asc, PrTxTrxnHeader.Emp_Code Asc"
                Case 2
                    Str17 = " Order by PrTxTrxnHeader.TrxHdr_A2, PrTxTrxnHeader.Emp_Code Asc"
                Case 3
                    Str17 = " Order by PrTxTrxnHeader.TrxHdr_A3 asc, PrTxTrxnHeader.Emp_Code Asc"
                Case 4
                    Str17 = " Order by PrTxTrxnHeader.TrxHdr_A4 asc, PrTxTrxnHeader.Emp_Code Asc"
                Case 5
                    Str17 = " Order by PrTxTrxnHeader.TrxHdr_A5, PrTxTrxnHeader.Emp_Code Asc"
                Case 6
                    Str17 = " Order by PrTxTrxnHeader.TrxHdr_Union, PrTxTrxnHeader.Emp_Code Asc"

            End Select

        End If


        Str = Str & Str2 & Str3 & str4 & Str5 & Str6 & Str7 & Str8 & Str9 & Str10 & Str11 & Str12 & Str13 & Str14 & Str15 & Str16 & Str17



        Return GetData(Str)
    End Function
    Public Shadows Function GetAllTrxnHeaderForPeriodEDCTotals1(ByVal Per As cPrMsPeriodCodes, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String, ByVal Cash As Boolean, ByVal Cheque As Boolean, ByVal Bank As Boolean, ByVal IsSplitEmployee As Boolean, ByVal GenAnal1 As String, ByVal orderbyanal As Integer, ByVal Ern1 As String, ByVal Ern2 As String, ByVal BankCode As String) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""



        Str = " SELECT  PrTxTrxnHeader.TrxHdr_Id," & _
        " PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_FullName, " & _
        " PrTxTrxnHeader.TrxHdr_NetSalary," & _
        " PrTxTrxnHeader.TrxHdr_MonthlySalary," & _
        " PrTxTrxnHeader.TrxHdr_PeriodUnits," & _
        " PrTxTrxnHeader.TrxHdr_Paymentref," & _
        " PrTxTrxnHeader.TrxHdr_A2," & _
        " PrTxTrxnHeader.TrxHdr_TotalErnPeriod," & _
        " PrTxTrxnHeader.TrxHdr_TotalDedPeriod," & _
        " PrTxTrxnHeader.TrxHdr_TotalConPeriod," & _
        " 0.00 AS Cost," & _
        " Trxhdr_AnalGen1, " & _
        " PrTxTrxnLines.TrxLin_PeriodValue, " & _
        " PrTxTrxnLines.TrxLin_EDCDescription AS Des1, " & _
        " PrTxTrxnLines.ErnCod_Code As C1, " & _
        " PrTxTrxnLines_1.TrxLin_PeriodValue, " & _
        " PrTxTrxnLines_1.TrxLin_EDCDescription AS Des2, " & _
        " PrTxTrxnLines_1.ErnCod_Code AS C2 " & _
        " FROM PrTxTrxnHeader inner JOIN " & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code INNER JOIN " & _
        " PrTxTrxnLines ON PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN " & _
        " PrTxTrxnLines AS PrTxTrxnLines_1 ON PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines_1.TrxHdr_Id " & _
        " WHERE (PrdCod_Code =" & enQuoteString(Per.Code) & ")" & _
        " AND (PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")" & _
        " AND (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ern1) & ")" & _
        " AND (PrTxTrxnLines_1.ErnCod_Code = " & enQuoteString(Ern2) & ")"

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxTrxnHeader.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxTrxnHeader.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If
        Dim str4 As String = ""
        Select Case Analysis
            Case 0
                str4 = ""
            Case 1
                str4 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str4 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str4 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str4 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str4 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str4 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select

        Dim Str5 As String = ""

        If Cash Then
            Str5 = " AND (PrMsEmployees.PmtMth_Code =1"
        End If
        If Cheque Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =2"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =2"
            End If
        End If
        If Bank Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =3"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =3"
            End If
        End If
        If Str5 <> "" Then
            Str5 = Str5 & ")"
        End If
        Dim Str6 As String = ""
        If IsSplitEmployee Then
            Str6 = " AND Emp_Splitemployement='1'"
        End If

        Dim Str7 As String = ""

        Dim Str8 As String = ""
        If GenAnal1 <> "" Then
            Str8 = " AND prmsemployees.Emp_AnalGen1=" & enQuoteString(GenAnal1)
        End If
        Dim Str9 As String = ""
        If BankCode <> "ALL" Then
            Str9 = " AND prmsemployees.Bnk_CodeCo=" & enQuoteString(BankCode)
        End If

        Dim Str10 As String = ""
        If orderbyanal = 0 Then
            Str10 = " Order by PrMsEmployees.Emp_Code Asc"
        Else
            Select Case orderbyanal
                Case 1
                    Str10 = " Order by PrTxTrxnHeader.TrxHdr_A1 asc, PrMsEmployees.Emp_Code Asc"
                Case 2
                    Str10 = " Order by PrTxTrxnHeader.TrxHdr_A2, PrMsEmployees.Emp_Code Asc"
                Case 3
                    Str10 = " Order by PrTxTrxnHeader.TrxHdr_A3 asc, PrMsEmployees.Emp_Code Asc"
                Case 4
                    Str10 = " Order by PrTxTrxnHeader.TrxHdr_A4 asc, PrMsEmployees.Emp_Code Asc"
                Case 5
                    Str10 = " Order by PrTxTrxnHeader.TrxHdr_A5, PrMsEmployees.Emp_Code Asc"
                Case 6
                    Str10 = " Order by PrTxTrxnHeader.TrxHdr_Union, PrMsEmployees.Emp_Code Asc"

            End Select

        End If

        Str = Str & Str2 & Str3 & str4 & Str5 & Str6 & Str7 & Str8 & Str9 & Str10



        Return GetData(Str)
    End Function
    Public Shadows Function GetAllTrxnHeaderForPeriod_GroupByAnalysis(ByVal Per As cPrMsPeriodCodes, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String, ByVal Cash As Boolean, ByVal Cheque As Boolean, ByVal Bank As Boolean, ByVal IsSplitEmployee As Boolean, ByVal OnlyActiveemployees As Boolean, ByVal GenAnal1 As String, ByVal orderbyanal As Integer, ByVal SICategory As String, ByVal AgeFilter As String, ByVal OnlyLeavers As Boolean, ByVal OnlyHiredThisyear As Boolean, ByVal Ewallet As Boolean) As DataSet

        Dim Str As String = ""
        Dim StrB As String = ""
        Dim StrC As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = " SELECT  PrTxTrxnHeader.TrxHdr_Id," & _
        " PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_FullName, " & _
         " PrTxTrxnHeader.TrxHdr_NetSalary," & _
        " PrTxTrxnHeader.TrxHdr_MonthlySalary," & _
        " PrTxTrxnHeader.TrxHdr_PeriodUnits," & _
        " PrTxTrxnHeader.TrxHdr_Paymentref," & _
        " PrTxTrxnHeader.TrxHdr_OverTime1," & _
        " PrTxTrxnHeader.TrxHdr_OverTime2," & _
        " PrTxTrxnHeader.TrxHdr_Salary1," & _
        " PrTxTrxnHeader.TrxHdr_Salary2," & _
        " PrTxTrxnHeader.TrxHdr_OverTime3, " & _
        " PrTxTrxnHeader.TrxHdr_Sectors," & _
        " PrTxTrxnHeader.TrxHdr_Dutyhours," & _
        " PrTxTrxnHeader.TrxHdr_FlightHours," & _
        " PrTxTrxnHeader.TrxHdr_Commission," & _
        " PrTxTrxnHeader.TrxHdr_PBAmount," & _
        " PrTxTrxnHeader.TrxHdr_PBRate,"

        Select Case orderbyanal

            Case 1
                StrB = " PrTxTrxnHeader.TrxHdr_A1,"
            Case 2
                StrB = " PrTxTrxnHeader.TrxHdr_A2,"
            Case 3
                StrB = " PrTxTrxnHeader.TrxHdr_A3,"
            Case 4
                StrB = " PrTxTrxnHeader.TrxHdr_A4,"
            Case 5
                StrB = " PrTxTrxnHeader.TrxHdr_A5,"
            Case 6
                StrB = " PrTxTrxnHeader.TrxHdr_Union,"
            Case 7
                StrB = " PrTxTrxnHeader.Trxhdr_AnalGen1,"

        End Select


        StrC = " PrTxTrxnHeader.TrxHdr_Overlay," & _
        " PrTxTrxnHeader.TrxHdr_PeriodSplit," & _
        " PrMsEmployees.Emp_StartDate," & _
        " PrTxTrxnHeader.TrxHdr_Position," & _
        " PrTxTrxnHeader.TrxHdr_TotalErnPeriod," & _
        " PrTxTrxnHeader.TrxHdr_TotalDedPeriod," & _
        " PrTxTrxnHeader.TrxHdr_TotalConPeriod," & _
        " PrTxTrxnHeader.TrxHdr_BasisOnSalary, " & _
        " PrTxTrxnHeader.TrxHdr_GesiD, " & _
        " PrTxTrxnHeader.TrxHdr_GesiC, " & _
        " PrTxTrxnHeader.TrxHdr_Medical, " & _
        " PrTxTrxnHeader.Com_Code," & _
        " PrTxTrxnHeader.TrxHdr_Year, " & _
        " TrxHdr_GESIableAmount, " & _
        " Trxhdr_BIK_GESID," & _
        " Trxhdr_BIK_GESIC," & _
        " Trxhdr_BIK_Gesiable, " & _
        " Trxhdr_AnalGen1, " & _
        " PrTxTrxnHeader.TrxHdr_A1 as Anl1," & _
        " PrTxTrxnHeader.TrxHdr_A2 as Anl2," & _
        " PrTxTrxnHeader.TrxHdr_A3 as Anl3," & _
        " PrTxTrxnHeader.TrxHdr_A4 as Anl4," & _
        " PrTxTrxnHeader.TrxHdr_A5 as Anl5," & _
        " PrAnEmployeeAnalysis1.EmpAn1_DescriptionL," & _
        " PrAnEmployeeAnalysis2.EmpAn2_DescriptionL," & _
        " PrAnEmployeeAnalysis3.EmpAn3_DescriptionL," & _
        " PrAnEmployeeAnalysis4.EmpAn4_DescriptionL," & _
        " PrAnEmployeeAnalysis5.EmpAn5_DescriptionL, " & _
        " PrMsEmployees.Emp_TerminateDate, " & _
        " PrMsEmployees.Emp_SocialInsNumber, " & _
        " PrMsEmployees.Emp_BankBenName ," & _
        " PrMsEmployees.Emp_BankAccountCo, " & _
        " PrMsEmployees.Emp_BirthDate, " & _
        " PrMsEmployees.Emp_IdentificationCard," & _
        " PrMsEmployees.Emp_TaxID," & _
        " PrMsEmployees.Emp_Address1," & _
        " PrMsEmployees.Emp_Address3," & _
        " PrMsEmployees.Emp_PostCode," & _
        " PrMsEmployees.Emp_Address2 " & _
        " FROM PrTxTrxnHeader inner JOIN" & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code INNER JOIN " & _
         " PrAnEmployeeAnalysis1 ON PrTxTrxnheader.Trxhdr_A1 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis1.EmpAn1_Code INNER JOIN " & _
        " PrAnEmployeeAnalysis2 ON PrTxTrxnheader.Trxhdr_A2 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis2.EmpAn2_Code INNER JOIN " & _
        " PrAnEmployeeAnalysis3 ON PrTxTrxnheader.Trxhdr_A3 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis3.EmpAn3_Code INNER JOIN " & _
        " PrAnEmployeeAnalysis4 ON PrTxTrxnheader.Trxhdr_A4 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis4.EmpAn4_Code INNER JOIN " & _
        " PrAnEmployeeAnalysis5 ON PrTxTrxnheader.Trxhdr_A5 COLLATE Greek_CI_AS= PrAnEmployeeAnalysis5.EmpAn5_Code " & _
        " WHERE (PrdCod_Code =" & enQuoteString(Per.Code) & ")" & _
        " AND (PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")"

        '" PrAnEmployeeAnalysis1 ON PrMsEmployees.EmpAn1_Code = PrAnEmployeeAnalysis1.EmpAn1_Code INNER JOIN " & _
        '       " PrAnEmployeeAnalysis2 ON PrMsEmployees.EmpAn2_Code = PrAnEmployeeAnalysis2.EmpAn2_Code INNER JOIN " & _
        '      " PrAnEmployeeAnalysis3 ON PrMsEmployees.EmpAn3_Code = PrAnEmployeeAnalysis3.EmpAn3_Code INNER JOIN " & _
        '     " PrAnEmployeeAnalysis4 ON PrMsEmployees.EmpAn4_Code = PrAnEmployeeAnalysis4.EmpAn4_Code INNER JOIN " & _
        '    " PrAnEmployeeAnalysis5 ON PrMsEmployees.EmpAn5_Code = PrAnEmployeeAnalysis5.EmpAn5_Code " & _

        Str = Str & StrB & StrC

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxTrxnHeader.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxTrxnHeader.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If
        Dim str4 As String = ""
        Select Case Analysis
            Case 0
                str4 = ""

            Case 1
                str4 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str4 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str4 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str4 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str4 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str4 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select

        Dim Str5 As String = ""

        If Cash Then
            Str5 = " AND (PrMsEmployees.PmtMth_Code =1"
        End If
        If Cheque Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =2"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =2"
            End If
        End If
        If Bank Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =3"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =3"
            End If
        End If
        If Ewallet Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =4"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =4"
            End If
        End If
        If Str5 <> "" Then
            Str5 = Str5 & ")"
        End If
        Dim Str6 As String = ""
        If IsSplitEmployee Then
            Str6 = " AND Emp_Splitemployement='1'"
        End If

        Dim Str7 As String = ""
        If OnlyActiveemployees Then
            Str7 = " AND prmsemployees.Emp_Status='A'"
        End If

        Dim Str8 As String = ""
        If GenAnal1 <> "" Then
            Str8 = " AND prmsemployees.Emp_AnalGen1=" & enQuoteString(GenAnal1)
        End If
        Dim Str9 As String = ""
        If SICategory <> "" Then
            Str9 = " AND prmsemployees.Sic_Code=" & enQuoteString(SICategory)
        End If

        Dim Str10 As String = ""
        If AgeFilter <> "" Then
            Dim Date1 As String
            Date1 = Utils.ChangeDateFormatForSearch(Format(Now.Date, "yyyy-MM-dd"))
            Str10 = " AND datediff(""HOUR"" ,Emp_BirthDate ," & enQuoteString(Date1) & ")/8766.0 " & AgeFilter
        End If

        Dim Str11 As String = ""
        If OnlyLeavers Then
            Str11 = " AND Emp_terminateDate<>''"
        End If
        Dim Str12 As String = ""
        If OnlyHiredThisyear Then
            Str12 = " AND datepart(year,PrMsEmployees .Emp_StartDate)=" & enQuoteString(Per.DateFrom.Year)
        End If

        Dim Str13 As String = ""
        If orderbyanal = 0 Then
            Str13 = " Order by PrMsEmployees.Emp_Code Asc"
        Else
            Select Case orderbyanal
                Case 1
                    Str13 = " Order by PrTxTrxnHeader.TrxHdr_A1 asc, PrMsEmployees.Emp_Code Asc"
                Case 2
                    Str13 = " Order by PrTxTrxnHeader.TrxHdr_A2, PrMsEmployees.Emp_Code Asc"
                Case 3
                    Str13 = " Order by PrTxTrxnHeader.TrxHdr_A3 asc, PrMsEmployees.Emp_Code Asc"
                Case 4
                    Str13 = " Order by PrTxTrxnHeader.TrxHdr_A4 asc, PrMsEmployees.Emp_Code Asc"
                Case 5
                    Str13 = " Order by PrTxTrxnHeader.TrxHdr_A5, PrMsEmployees.Emp_Code Asc"
                Case 6
                    Str13 = " Order by PrTxTrxnHeader.TrxHdr_Union, PrMsEmployees.Emp_Code Asc"
                Case 7
                    Str13 = " Order by PrTxTrxnHeader.TrxHdr_AnalGen1, PrMsEmployees.Emp_Code Asc"
            End Select

        End If

        Str = Str & Str2 & Str3 & str4 & Str5 & Str6 & Str7 & Str8 & Str9 & Str10 & Str11 & Str12 & Str13



        Return GetData(Str)
    End Function
    Public Shadows Function GetUnitsReportForPeriod(ByVal Per As cPrMsPeriodCodes, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String, ByVal Cash As Boolean, ByVal Cheque As Boolean, ByVal Bank As Boolean, ByVal IsSplitEmployee As Boolean, ByVal Ewallet As Boolean) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = " SELECT  " & _
        " PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_FullName, " & _
        "PrMsEmployees.PayUni_Code ," & _
        " PrAnEmployeePositions.EmpPos_DescriptionL," & _
        " PrAnEmployeePositions.EmpPos_Units, " & _
        " 0 DaysWorked," & _
        " 0 UnitAmount," & _
        " 0 TotalService, " & _
        " PrAnEmployeeAnalysis2.EmpAn2_DescriptionL, " & _
        " PrAnEmployeeAnalysis2.EmpAn2_Code, " & _
        " '' Period " & _
        " FROM PrTxTrxnHeader inner JOIN " & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
        " INNER JOIN PrAnEmployeePositions ON PrMsEmployees.EmpPos_Code = PrAnEmployeePositions.EmpPos_Code " & _
        " INNER JOIN PrAnEmployeeAnalysis2 ON PrMsEmployees.EmpAn2_Code = PrAnEmployeeAnalysis2.EmpAn2_Code " & _
        " WHERE (PrdCod_Code =" & enQuoteString(Per.Code) & ")" & _
        " AND (PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")"

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxTrxnHeader.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxTrxnHeader.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If
        Dim str4 As String = ""
        Select Case Analysis
            Case 0
                str4 = ""

            Case 1
                str4 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str4 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str4 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str4 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str4 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str4 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select

        Dim Str5 As String = ""

        If Cash Then
            Str5 = " AND (PrMsEmployees.PmtMth_Code =1"
        End If
        If Cheque Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =2"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =2"
            End If
        End If
        If Bank Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =3"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =3"
            End If
        End If
        If Ewallet Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =4"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =4"
            End If
        End If
        If Str5 <> "" Then
            Str5 = Str5 & ")"
        End If
        Dim Str6 As String = ""
        If IsSplitEmployee Then
            Str6 = " AND Emp_Splitemployement='1'"
        End If
        Dim Str7 As String

        Str7 = " Order by PrMsEmployees.Emp_Code Asc"

        Str = Str & Str2 & Str3 & str4 & Str5 & Str6 & Str7



        Return GetData(Str)
    End Function
    Public Shadows Function GetAllEmployeesForAL(ByVal Per As cPrMsPeriodCodes, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String, ByVal Cash As Boolean, ByVal Cheque As Boolean, ByVal Bank As Boolean, ByVal IsSplitEmployee As Boolean, ByVal Ewallet As Boolean) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = " SELECT  PrMsEmployees.Emp_Code As Code," & _
        " PrMsEmployees.Emp_FullName as Name, " & _
        " 0.00 as OpeningBalance, " & _
        " 0.00 as Entitlement, " & _
        " 0.00 as Used, " & _
        " 0.00 as ClosingBalance " & _
        " FROM PrTxTrxnHeader inner JOIN" & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
        " WHERE (PrdCod_Code =" & enQuoteString(Per.Code) & ")" & _
        " AND (PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")"

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxTrxnHeader.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxTrxnHeader.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If
        Dim str4 As String = ""
        Select Case Analysis
            Case 0
                str4 = ""

            Case 1
                str4 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str4 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str4 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str4 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str4 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str4 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select

        Dim Str5 As String = ""

        If Cash Then
            Str5 = " AND (PrMsEmployees.PmtMth_Code =1"
        End If
        If Cheque Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =2"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =2"
            End If
        End If
        If Bank Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =3"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =3"
            End If
        End If
        If Ewallet Then
            If Str5 = "" Then
                Str5 = " AND  (PrMsEmployees.PmtMth_Code =4"
            Else
                Str5 = Str5 & " OR  PrMsEmployees.PmtMth_Code =4"
            End If
        End If
        If Str5 <> "" Then
            Str5 = Str5 & ")"
        End If
        Dim Str6 As String = ""
        If IsSplitEmployee Then
            Str6 = " AND Emp_Splitemployement='1'"
        End If
        Dim Str7 As String
        Str7 = " Order by PrMsEmployees.Emp_Code Asc"

        Str = Str & Str2 & Str3 & str4 & Str5 & Str6 & Str7



        Return GetData(Str)
    End Function
    Public Shadows Function GetAllRmployessWithSplit(ByVal TempGroup As String) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = " SELECT  Emp_Code " & _
        " From PrMsEmployees" & _
        " Where Emp_Splitemployement='1' " & _
        " And TemGrp_Code=" & enQuoteString(TempGroup)

        Return GetData(Str)
    End Function
    Protected Function GetAllEmployeesWithPayrollForPeriods(ByVal PerFrom As cPrMsPeriodCodes, ByVal PerTo As cPrMsPeriodCodes, ByVal EmpFromcode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String, ByVal Cash As Boolean, ByVal Cheque As Boolean, ByVal Bank As Boolean, ByVal Ewallet As Boolean) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = " SELECT   Emp_Code," & _
        " Emp_FullName " & _
        " FROM PrMsEmployees" & _
        " WHERE emp_Code in (Select Emp_Code from PrTxTrxnHeader where (PrdCod_Code =" & enQuoteString(PerFrom.Code) & _
        " AND PrdGrp_Code = " & enQuoteString(PerFrom.PrdGrpCode) & ")" & _
        " OR (PrdCod_Code =" & enQuoteString(PerTo.Code) & _
        " AND PrdGrp_Code = " & enQuoteString(PerTo.PrdGrpCode) & ")"

        Dim str4 As String = ""
        Select Case Analysis
            Case 0
                str4 = ""
            Case 1
                str4 = " AND TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str4 = " AND TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str4 = " AND TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str4 = " AND TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str4 = " AND TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str4 = " AND TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select
        str4 = str4 & ")"

        If EmpFromcode <> "" Then
            Str2 = " AND (Emp_Code>=" & enQuoteString(EmpFromcode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If


        Dim Str5 As String = ""

        If Cash Then
            Str5 = " AND (PmtMth_Code =1"
        End If
        If Cheque Then
            If Str5 = "" Then
                Str5 = " AND  (PmtMth_Code =2"
            Else
                Str5 = Str5 & " OR  PmtMth_Code =2"
            End If
        End If
        If Bank Then
            If Str5 = "" Then
                Str5 = " AND  (PmtMth_Code =3"
            Else
                Str5 = Str5 & " OR  PmtMth_Code =3"
            End If
        End If
        If Ewallet Then
            If Str5 = "" Then
                Str5 = " AND  (PmtMth_Code =4"
            Else
                Str5 = Str5 & " OR  PmtMth_Code =4"
            End If
        End If
        If Str5 <> "" Then
            Str5 = Str5 & ")"
        End If
        Dim Str6 As String
        Str6 = " Order by Emp_Code Asc"

        Str = Str & Str2 & str4 & Str3 & Str5 & Str6



        Return GetData(Str)
    End Function
    Protected Function GetAllEDCLinesForPeriodsForEmployee(ByVal Per As cPrMsPeriodCodes, ByVal EmpCode As String) As DataSet
        Dim str As String
        str = " SELECT PrTxTrxnLines.TrxLin_Id, " & _
        " PrTxTrxnLines.TrxHdr_Id, " & _
        " PrTxTrxnLines.TrxLin_Type, " & _
        " PrTxTrxnLines.ErnCod_Code, " & _
        " PrTxTrxnLines.DedCod_Code,  " & _
        " PrTxTrxnLines.ConCod_Code,  " & _
        " PrTxTrxnLines.TrxLin_PeriodValue, " & _
        " PrTxTrxnHeader.Emp_Code, " & _
        " PrTxTrxnHeader.PrdCod_Code, " & _
        " PrTxTrxnLines.TrxLin_EDCDescription,  " & _
        " PrTxTrxnHeader.PrdGrp_Code, " & _
        " PrTxTrxnHeader.TrxHdr_NetSalary " & _
        " FROM PrTxTrxnLines INNER JOIN " & _
        " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id " & _
        " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & _
        " AND PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(Per.Code) & _
        " AND PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")" & _
        " ORDER BY PrTxTrxnLines.TrxHdr_Id, PrTxTrxnLines.TrxLin_Id "



        Return GetData(str)
    End Function

    Protected Function GetAllLoansReport(ByVal TempGrpCode As String, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String, ByVal LoanStatus As String) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim str4 As String = ""
        Dim Str5 As String = ""

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxEmployeeLoan.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxEmployeeLoan.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If

        Select Case Analysis
            Case 0
                str4 = ""
            Case 1
                str4 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str4 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str4 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str4 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str4 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str4 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select

        'Str = " SELECT PrTxEmployeeLoan.Emp_Code," & _
        '    " PrMsEmployees.Emp_FullName," & _
        '    " PrTxEmployeeLoan.EmpLne_Code," & _
        '    " PrTxEmployeeLoan.EmpLne_Description," & _
        '    " PrTxEmployeeLoan.EmpLne_LoanDate ," & _
        '    " SUM(PrTxEmployeeLoan.EmpLne_TotalAmount) " & _
        '    " AS OpeningAmount, SUM(PrTxEmployeeLoan.EmpLne_Payment) AS Payments, " & _
        '    " SUM(PrTxEmployeeLoan.EmpLne_TotalAmount - PrTxEmployeeLoan.EmpLne_Payment)" & _
        '    " AS Balance" & _
        '    " FROM PrTxEmployeeLoan INNER JOIN" & _
        '    " PrMsEmployees ON PrTxEmployeeLoan.Emp_Code COLLATE Greek_CI_AS = PrMsEmployees.Emp_Code" & _
        '    " WHERE (PrTxEmployeeLoan.EmpLne_Status = " & enQuoteString(LoanStatus) & ")" & _
        '    " And PrTxEmployeeLoan.TemGrp_Code= " & enQuoteString(TempGrpCode)

        Str = "SELECT PrTxEmployeeLoan.Emp_Code, " & _
        " PrMsEmployees.Emp_IdentificationCard, " & _
        " PrMsEmployees.Emp_FullName, " & _
        " PrTxEmployeeLoan.EmpLne_Description, " & _
        " PrTxEmployeeLoan.EmpLne_LoanDate, " & _
        " SUM(PrTxEmployeeLoan.EmpLne_TotalAmount) AS OpeningAmount, " & _
        " SUM(PrTxEmployeeLoan.EmpLne_Payment) AS TotalPayments, " & _
        " SUM(PrTxEmployeeLoan.EmpLne_TotalAmount - PrTxEmployeeLoan.EmpLne_Payment) AS Balance" & _
        " FROM  PrTxEmployeeLoan INNER JOIN" & _
        " PrMsEmployees ON PrTxEmployeeLoan.Emp_Code COLLATE Greek_CI_AS = PrMsEmployees.Emp_Code" & _
        " WHERE (PrTxEmployeeLoan.EmpLne_Status = " & enQuoteString(LoanStatus) & ")" & _
        " AND (PrTxEmployeeLoan.TemGrp_Code = " & enQuoteString(TempGrpCode) & ")"


        Str5 = " GROUP BY PrTxEmployeeLoan.Emp_Code, " & _
            " PrTxEmployeeLoan.EmpLne_Code, " & _
            " PrTxEmployeeLoan.EmpLne_Description," & _
            " PrMsEmployees.Emp_FullName," & _
            " PrTxEmployeeLoan.EmpLne_LoanDate, " & _
          " PrMsEmployees.Emp_IdentificationCard"

        Str = Str & Str2 & Str3 & str4 & Str5





        Return GetData(Str)





    End Function
    Protected Function GetAllLoansReport2(ByVal TempGrpCode As String, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String, ByVal LoanStatus As String, ByVal PeriodFrom As String, ByVal PeriodTo As String) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim str4 As String = ""
        Dim Str5 As String = ""

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxEmployeeLoan.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxEmployeeLoan.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If

        Select Case Analysis
            Case 0
                str4 = ""
            Case 1
                str4 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                str4 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                str4 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                str4 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                str4 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                str4 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select

        Str = "SELECT PrTxEmployeeLoan.Emp_Code, " & _
        " PrMsEmployees.Emp_IdentificationCard, " & _
        " PrMsEmployees.Emp_FullName," & _
        " PrTxEmployeeLoan.EmpLne_Description, " & _
        " PrTxEmployeeLoan.EmpLne_LoanDate," & _
        " SUM(PrTxEmployeeLoan.EmpLne_TotalAmount) AS OpeningAmount," & _
        " SUM(PrTxEmployeeLoan.EmpLne_Payment) AS TotalPayments," & _
        " SUM(PrTxEmployeeLoan.EmpLne_TotalAmount - PrTxEmployeeLoan.EmpLne_Payment) AS Balance" & _
        " FROM  PrTxEmployeeLoan INNER JOIN" & _
        " PrMsEmployees ON PrTxEmployeeLoan.Emp_Code COLLATE Greek_CI_AS = PrMsEmployees.Emp_Code" & _
        " WHERE (PrTxEmployeeLoan.EmpLne_Status = " & enQuoteString(LoanStatus) & ")" & _
        " AND (PrTxEmployeeLoan.TemGrp_Code = " & enQuoteString(TempGrpCode) & ")" & _
        " AND (PrTxEmployeeLoan.DedCod_Code = 'D6')"

        Str5 = " GROUP BY PrTxEmployeeLoan.Emp_Code, " & _
            " PrTxEmployeeLoan.EmpLne_Code, " & _
            " PrTxEmployeeLoan.EmpLne_Description," & _
            " PrMsEmployees.Emp_FullName," & _
            " PrTxEmployeeLoan.EmpLne_LoanDate, " & _
            " PrMsEmployees.Emp_IdentificationCard," & _
            "  PrTxEmployeeLoan.DedCod_Code"


        Str = Str & Str2 & Str3 & str4 & Str5


       


        Return GetData(Str)





    End Function
    
    Public Shadows Function GetAllTrxnHeaderForPeriodForPFReport(ByVal Per As cPrMsPeriodCodes, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""
        Dim Str5 As String = ""

        Str = " SELECT  PrTxTrxnHeader.TrxHdr_Id," & _
        " PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_FullName, " & _
        " PrTxTrxnHeader.TrxHdr_NetSalary," & _
        " PrTxTrxnHeader.TrxHdr_MonthlySalary," & _
        " PrTxTrxnHeader.TrxHdr_PeriodUnits," & _
        " 0.00 as PFA," & _
        " 0.00 as PFB," & _
        " PrMsEmployees.emp_identificationcard  " & _
        " FROM PrTxTrxnHeader INNER JOIN" & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
        " WHERE (PrdCod_Code =" & enQuoteString(Per.Code) & ")" & _
        " AND (PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")"

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxTrxnHeader.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxTrxnHeader.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If
        Select Case Analysis
            Case 0
                str4 = ""

            Case 1
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                Str4 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select


        Str5 = " order by PrTxTrxnHeader.Emp_Code Asc"
        Str = Str & Str2 & Str3 & Str4 & str5



        Return GetData(Str)
    End Function
    Public Shadows Function GetAllTrxnHeaderForPeriodForPFReport_C12(ByVal Per As cPrMsPeriodCodes, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""

        Str = " SELECT  PrTxTrxnHeader.TrxHdr_Id," & _
        " PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_FullName, " & _
        " PrTxTrxnHeader.TrxHdr_NetSalary," & _
        " PrTxTrxnHeader.TrxHdr_MonthlySalary," & _
        " PrTxTrxnHeader.TrxHdr_PeriodUnits," & _
        " 0.00 as PFA," & _
        " 0.00 as PFB," & _
        " 0.00 as C12," & _
        " PrMsEmployees.emp_identificationcard  " & _
        " FROM PrTxTrxnHeader INNER JOIN" & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
        " WHERE (PrdCod_Code =" & enQuoteString(Per.Code) & ")" & _
        " AND (PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")"

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxTrxnHeader.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxTrxnHeader.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If
        Select Case Analysis
            Case 0
                Str4 = ""

            Case 1
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                Str4 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select

        Dim Str5 As String
        Str5 = " Order by PrTxTrxnHeader.Emp_Code Asc"

        Str = Str & Str2 & Str3 & Str4 & Str5



        Return GetData(Str)
    End Function
    Public Shadows Function GetAllTrxnHeaderForPeriodForPFReport_Loan(ByVal Per As cPrMsPeriodCodes, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""

        Str = " SELECT  PrTxTrxnHeader.TrxHdr_Id," & _
        " PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_FullName, " & _
        " PrTxTrxnHeader.TrxHdr_NetSalary," & _
        " PrTxTrxnHeader.TrxHdr_MonthlySalary," & _
        " PrTxTrxnHeader.TrxHdr_PeriodUnits," & _
        " 0.00 as PFA," & _
        " 0.00 as PFB," & _
        " 0.00 as C12," & _
        " PrMsEmployees.emp_identificationcard,  " & _
        " 0.00 as Total, " & _
        " PrMsEmployees.Emp_SocialInsNumber  " & _
        " FROM PrTxTrxnHeader INNER JOIN" & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
        " WHERE (PrdCod_Code =" & enQuoteString(Per.Code) & ")" & _
        " AND (PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")"

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxTrxnHeader.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxTrxnHeader.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If
        Select Case Analysis
            Case 0
                Str4 = ""

            Case 1
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                Str4 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select


        Str = Str & Str2 & Str3 & Str4



        Return GetData(Str)
    End Function
    Public Shadows Function GetAllTrxnHeaderForPeriodForPensionFundReport(ByVal Per As cPrMsPeriodCodes, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""

        Str = " SELECT  PrTxTrxnHeader.TrxHdr_Id," & _
        " PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_FullName, " & _
        " PrTxTrxnHeader.TrxHdr_NetSalary," & _
        " PrTxTrxnHeader.TrxHdr_MonthlySalary," & _
        " PrTxTrxnHeader.TrxHdr_PeriodUnits," & _
        " 0.00 as PenFund," & _
        " 0.00 as WidowFund," & _
        " 0.00 as C10," & _
        " 0.00 as C11," & _
        " PrMsEmployees.emp_identificationcard,  " & _
        " PrMsEmployees.emp_CNP  " & _
        " FROM PrTxTrxnHeader INNER JOIN" & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
        " WHERE (PrdCod_Code =" & enQuoteString(Per.Code) & ")" & _
        " AND (PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")"

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxTrxnHeader.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxTrxnHeader.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If
        Select Case Analysis
            Case 0
                Str4 = ""

            Case 1
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                Str4 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select

        Dim Str5 As String
        Str5 = " order By PrTxTrxnHeader.Emp_Code "
        Str = Str & Str2 & Str3 & Str4 & Str5



        Return GetData(Str)
    End Function
    Public Shadows Function GetAllTrxnHeaderForPeriodForPensionFundReport4(ByVal Per As cPrMsPeriodCodes, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""

        Str = " SELECT  PrTxTrxnHeader.TrxHdr_Id," &
        " PrTxTrxnHeader.Emp_Code," &
        " PrMsEmployees.Emp_FullName, " &
        " PrTxTrxnHeader.TrxHdr_NetSalary," &
        " PrTxTrxnHeader.TrxHdr_MonthlySalary," &
        " PrTxTrxnHeader.TrxHdr_PeriodUnits," &
        " 0.00 as Salary," &
        " 0.00 as COLA," &
        " 0.00 as Total," &
        " 0.00 as D18," &
        " 0.00 as Widow," &
        " 0.00 as C10," &
        " PrMsEmployees.emp_identificationcard,  " &
        " PrMsEmployees.emp_CNP  " &
        " FROM PrTxTrxnHeader INNER JOIN" &
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" &
        " WHERE (PrdCod_Code =" & enQuoteString(Per.Code) & ")" &
        " AND (PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")"

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxTrxnHeader.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxTrxnHeader.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If
        Select Case Analysis
            Case 0
                Str4 = ""

            Case 1
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                Str4 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select

        Dim Str5 As String
        Str5 = " order By PrTxTrxnHeader.Emp_Code "
        Str = Str & Str2 & Str3 & Str4 & Str5



        Return GetData(Str)
    End Function
    Public Shadows Function GetAllTrxnHeaderForPeriodForPensionFundReport7(ByVal Per As cPrMsPeriodCodes, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal Analysis As Integer, ByVal AnalCode As String) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""

        Str = " SELECT  PrTxTrxnHeader.TrxHdr_Id," &
        " PrTxTrxnHeader.Emp_Code," &
        " PrMsEmployees.Emp_FullName, " &
        " PrTxTrxnHeader.TrxHdr_NetSalary," &
        " PrTxTrxnHeader.TrxHdr_MonthlySalary," &
        " PrTxTrxnHeader.TrxHdr_PeriodUnits," &
        " 0.00 as Salary," &
        " 0.00 as COLA," &
        " 0.00 as Total," &
        " 0.00 as D18," &
        " 0.00 as Widow," &
        " 0.00 as C10," &
        " PrMsEmployees.emp_identificationcard,  " &
        " PrMsEmployees.emp_CNP,  " &
        " 0.00 as Arrears" &
        " FROM PrTxTrxnHeader INNER JOIN" &
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" &
        " WHERE (PrdCod_Code =" & enQuoteString(Per.Code) & ")" &
        " AND (PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")"

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxTrxnHeader.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxTrxnHeader.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If
        Select Case Analysis
            Case 0
                Str4 = ""

            Case 1
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A1=" & enQuoteString(AnalCode)
            Case 2
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A2=" & enQuoteString(AnalCode)
            Case 3
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A3=" & enQuoteString(AnalCode)
            Case 4
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A4=" & enQuoteString(AnalCode)
            Case 5
                Str4 = " AND PrTxTrxnHeader.TrxHdr_A5=" & enQuoteString(AnalCode)
            Case 6
                Str4 = " AND PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(AnalCode)
        End Select

        Dim Str5 As String
        Str5 = " order By PrTxTrxnHeader.Emp_Code "
        Str = Str & Str2 & Str3 & Str4 & Str5



        Return GetData(Str)
    End Function

    Public Shadows Function GetAllTrxnHeaderForPeriodForUNIONReport(ByVal Per As cPrMsPeriodCodes, ByVal EmpFromCode As String, ByVal EmpToCode As String, ByVal UnionCode As String) As DataSet

        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""

        Str = " SELECT  PrTxTrxnHeader.TrxHdr_Id," &
        " PrTxTrxnHeader.Emp_Code," &
        " PrMsEmployees.Emp_FullName, " &
        " PrTxTrxnHeader.TrxHdr_NetSalary," &
        " PrTxTrxnHeader.TrxHdr_MonthlySalary," &
        " PrTxTrxnHeader.TrxHdr_PeriodUnits," &
        " PrTxTrxnHeader.TrxHdr_TaxableIncome," &
        " 0.00 as MFD," &
        " 0.00 as MFC," &
        " 0.00 as MFTOTAL," &
        " 0.00 as UNION1," &
        " 0.00 as LINETOTAL," &
        " PrMsEmployees.emp_identificationcard,  " &
        " PrMsEmployees.Emp_SocialInsNumber,  " &
        " 0.00 as UNIONDed," &
        " 0.00 as UNIONCon," &
        " 0.00 as UNIONTotal, " &
        " PrMsEmployees.Emp_TerminateDate " &
        " FROM PrTxTrxnHeader INNER JOIN" &
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" &
        " WHERE (PrdCod_Code =" & enQuoteString(Per.Code) & ")" &
        " AND (PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")" &
        " AND (PrTxTrxnHeader.TrxHdr_Union=" & enQuoteString(UnionCode) & ")"

        If EmpFromCode <> "" Then
            Str2 = " AND (PrTxTrxnHeader.Emp_Code>=" & enQuoteString(EmpFromCode) & ")"
        End If

        If EmpToCode <> "" Then
            Str3 = " AND (PrTxTrxnHeader.Emp_Code<=" & enQuoteString(EmpToCode) & ")"
        End If

        Str = Str & Str2 & Str3



        Return GetData(Str)
    End Function
   
    Protected Function GetDeductionForHeader(ByVal HeaderId As Integer, ByVal Deductiontype As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double = 0
        Dim i As Integer
        Str = " SELECT PrTxTrxnLines.TrxLin_PeriodValue" & _
        " FROM PrTxTrxnLines INNER JOIN" & _
        " PrTxTrxnHeader ON " & _
        " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
        " PrMsDeductionCodes ON" & _
        " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN" & _
        " PrSsDeductionTypes ON" & _
        " PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code" & _
        " WHERE (PrTxTrxnHeader.TrxHdr_Id = " & HeaderId & ")" & _
        " AND (PrSsDeductionTypes.DedTyp_Code = " & enQuoteString(Deductiontype) & ")"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                Value = Value + DbNullToDouble(Ds.Tables(0).Rows(i).Item(0))
            Next
        End If

        Return Value

    End Function
    Protected Function GetContributionForHeader(ByVal HeaderId As Integer, ByVal contributionType As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double

        Str = " SELECT PrTxTrxnLines.TrxLin_PeriodValue" & _
        " FROM PrTxTrxnLines INNER JOIN" & _
        " PrTxTrxnHeader ON " & _
        " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
        " PrMsContributionCodes ON" & _
        " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code INNER JOIN" & _
        " PrSsContributionTypes ON" & _
        " PrMsContributionCodes.ConTyp_Code = PrSsContributionTypes.ConTyp_Code" & _
        " WHERE (PrTxTrxnHeader.TrxHdr_Id = " & HeaderId & ")" & _
        " AND (PrSsContributionTypes.ConTyp_Code = " & enQuoteString(contributionType) & ")"

        Ds = GetData(Str)
        Dim i As Integer
        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                Value = Value + DbNullToDouble(Ds.Tables(0).Rows(i).Item(0))
            Next
        End If
        Return Value
    End Function
    Protected Function GetContributionCodeForHeader(ByVal HeaderId As Integer, ByVal ContributionCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double

        Str = "SELECT PrTxTrxnLines.TrxLin_PeriodValue " & _
        " FROM PrTxTrxnLines INNER JOIN " & _
        " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN " & _
        " PrMsContributionCodes ON PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code " & _
        " WHERE (PrTxTrxnHeader.TrxHdr_Id = " & HeaderId & ")  " & _
        " AND (PrMsContributionCodes.ConCod_Code = " & enQuoteString(ContributionCode) & ") "


        Ds = GetData(Str)
        Dim i As Integer
        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                Value = Value + DbNullToDouble(Ds.Tables(0).Rows(i).Item(0))
            Next
        End If
        Return Value
    End Function
    Protected Function GetEarningCodeForHeader(ByVal HeaderId As Integer, ByVal EarningCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double

        Str = "SELECT PrTxTrxnLines.TrxLin_PeriodValue " & _
        " FROM PrTxTrxnLines INNER JOIN " & _
        " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN " & _
        " PrMsEarningCodes ON PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code " & _
        " WHERE (PrTxTrxnHeader.TrxHdr_Id = " & HeaderId & ")  " & _
        " AND (PrMsEarningCodes.ErnCod_Code = " & enQuoteString(EarningCode) & ") "


        Ds = GetData(Str)
        Dim i As Integer
        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                Value = Value + DbNullToDouble(Ds.Tables(0).Rows(i).Item(0))
            Next
        End If
        Return Value
    End Function
    Protected Function GetDeductionCodeForHeader(ByVal HeaderId As Integer, ByVal DeductionCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double

        Str = "SELECT PrTxTrxnLines.TrxLin_PeriodValue " & _
        " FROM PrTxTrxnLines INNER JOIN " & _
        " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN " & _
        " PrMsDeductionCodes ON PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code " & _
        " WHERE (PrTxTrxnHeader.TrxHdr_Id = " & HeaderId & ")  " & _
        " AND (PrMsDeductionCodes.DedCod_Code = " & enQuoteString(DeductionCode) & ") "


        Ds = GetData(Str)
        Dim i As Integer
        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                Value = Value + DbNullToDouble(Ds.Tables(0).Rows(i).Item(0))
            Next
        End If
        Return Value
    End Function
    Protected Function GetContributionCodeForHeaderForPeriod(ByVal HeaderId As Integer, ByVal ContributionCode As String, ByVal PerCode As String, ByVal PerGroup As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double

        Str = "SELECT PrTxTrxnLines.TrxLin_PeriodValue " & _
        " FROM PrTxTrxnLines INNER JOIN " & _
        " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN " & _
        " PrMsContributionCodes ON PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code " & _
        " WHERE (PrTxTrxnHeader.TrxHdr_Id = " & HeaderId & ")  " & _
        " AND (PrMsContributionCodes.ConCod_Code = " & enQuoteString(ContributionCode) & ") " & _
        " AND (PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PerCode) & ") " & _
        " AND (PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PerGroup) & ") "

        Ds = GetData(Str)
        Dim i As Integer
        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                Value = Value + DbNullToDouble(Ds.Tables(0).Rows(i).Item(0))
            Next
        End If
        Return Value
    End Function
    Protected Function GetDeductionCodeForHeaderForPeriod(ByVal HeaderId As Integer, ByVal DeductionCode As String, ByVal PerCode As String, ByVal PerGroup As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double

        Str = "SELECT PrTxTrxnLines.TrxLin_PeriodValue " & _
        " FROM PrTxTrxnLines INNER JOIN " & _
        " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN " & _
        " PrMsDeductionCodes ON PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code " & _
        " WHERE (PrTxTrxnHeader.TrxHdr_Id = " & HeaderId & ")  " & _
        " AND (PrMsDeductionCodes.DedCod_Code = " & enQuoteString(DeductionCode) & ") " & _
        " AND (PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PerCode) & ") " & _
        " AND (PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PerGroup) & ") "


        Ds = GetData(Str)
        Dim i As Integer
        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                Value = Value + DbNullToDouble(Ds.Tables(0).Rows(i).Item(0))
            Next
        End If
        Return Value
    End Function
    Protected Function GetEarningCodeForHeaderForPeriod(ByVal HeaderId As Integer, ByVal DeductionCode As String, ByVal PerCode As String, ByVal PerGroup As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Value As Double

        Str = "SELECT PrTxTrxnLines.TrxLin_PeriodValue " & _
        " FROM PrTxTrxnLines INNER JOIN " & _
        " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN " & _
        " PrMsEarningCodes ON PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code " & _
        " WHERE (PrTxTrxnHeader.TrxHdr_Id = " & HeaderId & ")  " & _
        " AND (PrMsEarningCodes.ErnCod_Code = " & enQuoteString(DeductionCode) & ") " & _
        " AND (PrTxTrxnHeader.PrdGrp_Code=" & enQuoteString(PerCode) & ") " & _
        " AND (PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PerGroup) & ") "


        Ds = GetData(Str)
        Dim i As Integer
        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                Value = Value + DbNullToDouble(Ds.Tables(0).Rows(i).Item(0))
            Next
        End If
        Return Value
    End Function
   
    Protected Function GetTrxnLinesEarningsForHeaderForPeriod(ByVal HeaderId As Integer, ByVal Period As cPrMsPeriodCodes) As DataSet
        Dim Str As String
        Str = " SELECT PrTxTrxnLines.ErnCod_Code," & _
         " PrTxTrxnLines.TrxLin_PeriodValue, " & _
         " PrTxTrxnLines.TrxLin_EDCDescription," & _
         " PrTxTrxnLines.TrxLin_ConsolDesc," & _
         " PrTxTrxnLines.TrxLin_EDC " & _
         " FROM PrTxTrxnLines INNER JOIN" & _
         " PrMsPeriodEarnings ON PrTxTrxnLines.ErnCod_Code = PrMsPeriodEarnings.ErnCod_Code" & _
         " WHERE (PrTxTrxnLines.TrxLin_Type = 'E')" & _
         " AND (PrMsPeriodEarnings.PrdCod_Code = " & enQuoteString(Period.Code) & ")" & _
         " AND (PrMsPeriodEarnings.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
         " AND (PrTxTrxnLines.TrxHdr_Id = " & HeaderId & ")"

        Return MyBase.GetData(Str)
    End Function
    Protected Function GetTrxnLinesDeductionsForHeaderForPeriod(ByVal HeaderId As Integer, ByVal Period As cPrMsPeriodCodes) As DataSet
        Dim Str As String
        Str = " SELECT PrTxTrxnLines.DedCod_Code," & _
         " PrTxTrxnLines.TrxLin_PeriodValue, " & _
         " PrTxTrxnLines.TrxLin_EDCDescription," & _
         " PrTxTrxnLines.TrxLin_ConsolDesc" & _
         " FROM PrTxTrxnLines INNER JOIN" & _
         " PrMsPeriodDeductions ON PrTxTrxnLines.DedCod_Code = PrMsPeriodDeductions.DedCod_Code" & _
         " WHERE (PrTxTrxnLines.TrxLin_Type = 'D')" & _
         " AND (PrMsPeriodDeductions.PrdCod_Code = " & enQuoteString(Period.Code) & ")" & _
         " AND (PrMsPerioddeductions.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
         " AND (PrTxTrxnLines.TrxHdr_Id = " & HeaderId & ")" 

        Return MyBase.GetData(Str)
    End Function
    Protected Function GetTrxnLinesContributionsForHeaderForPeriod(ByVal HeaderId As Integer, ByVal Period As cPrMsPeriodCodes) As DataSet
        Dim Str As String
        Str = " SELECT PrTxTrxnLines.ConCod_Code," & _
         " PrTxTrxnLines.TrxLin_PeriodValue, " & _
         " PrTxTrxnLines.TrxLin_EDCDescription," & _
         " PrTxTrxnLines.TrxLin_ConsolDesc" & _
         " FROM PrTxTrxnLines INNER JOIN" & _
         " PrMsPeriodContributions ON PrTxTrxnLines.ConCod_Code = PrMsPeriodContributions.ConCod_Code" & _
         " WHERE (PrTxTrxnLines.TrxLin_Type = 'C')" & _
         " AND (PrMsPeriodContributions.PrdCod_Code = " & enQuoteString(Period.Code) & ")" & _
         " AND (PrMsPeriodContributions.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
         " AND (PrTxTrxnLines.TrxHdr_Id = " & HeaderId & ")" 
        Return MyBase.GetData(Str)
    End Function
    Protected Function GetDeductionofType_PF_PerPeriodGroupANDTemplate(ByVal TempGroupCode As String, ByVal CurrentPeriod As cPrMsPeriodCodes) As DataSet
        Dim Str As String
        Str = "SELECT  TemDed_id," & _
            " TemGrp_Code," & _
            " DedCod_Code," & _
            " TemDed_DisplayName," & _
            " TemDed_IsDispalyed," & _
            " TemDed_Sequence," & _
            " TemDed_TypeMode," & _
            " TemDed_FromMode, " & _
            " TemDed_CalcFormula, " & _
            " TemDed_CreationDate," & _
            " TemDed_CreatedBy," & _
            " TemDed_AmendDate," & _
            " TemDed_AmendBy," & _
            " TemDed_NavCreditAccount, " & _
            " TemDed_NavDebitAccount" & _
            " FROM PrMsTemplateDeductions" & _
            " WHERE (DedCod_Code IN (SELECT DedCod_Code FROM PrMsDeductionCodes WHERE (DedTyp_Code = 'PF'))) " & _
            " AND (DedCod_Code IN (SELECT DedCod_Code FROM PrMsPeriodDeductions WHERE (PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ") " & _
            " AND (PrdDed_IsActive = 'Y'))) " & _
            " AND (TemGrp_Code = " & enQuoteString(TempGroupCode) & ")"

        Return MyBase.GetData(Str)

    End Function
    Protected Function GetPeriodsRemainingForThisDeductionCode(ByVal DedCode As String, ByVal PeriodSequence As String, ByVal PeriodGroup As String) As Integer
        Dim Str As String
        Str = "SELECT COUNT(*) " & _
        " FROM PrMsPeriodDeductions INNER JOIN " & _
        " PrMsPeriodCodes ON PrMsPeriodDeductions.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code AND  " & _
        " PrMsPeriodDeductions.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code " & _
        " WHERE (PrMsPeriodDeductions.PrdGrp_Code =  " & enQuoteString(PeriodGroup) & " )  " & _
        " AND (PrMsPeriodDeductions.DedCod_Code = " & enQuoteString(DedCode) & ") " & _
        " AND (PrMsPeriodDeductions.PrdDed_IsActive = 'Y') " & _
        " AND PrMsPeriodCodes .PrdCod_Sequence >" & PeriodSequence
        Dim Ds As DataSet
        Ds = MyBase.GetData(Str)
        Dim No As Integer = 0
        If CheckDataSet(Ds) Then
            No = DbNullToInt(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return No


    End Function
    Protected Function GetPeriodsRemainingForThisEarningCode(ByVal ErnCode As String, ByVal PeriodSequence As String, ByVal PeriodGroup As String) As Integer
        Dim Str As String
        Str = "SELECT COUNT(*) " & _
        " FROM PrMsPeriodEarnings INNER JOIN " & _
        " PrMsPeriodCodes ON PrMsPeriodEarnings.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code AND  " & _
        " PrMsPeriodEarnings.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code " & _
        " WHERE (PrMsPeriodEarnings.PrdGrp_Code =  " & enQuoteString(PeriodGroup) & " )  " & _
        " AND (PrMsPeriodEarnings.ErnCod_Code = " & enQuoteString(ErnCode) & ") " & _
        " AND (PrMsPeriodEarnings.PrdErn_IsActive = 'Y') " & _
        " AND PrMsPeriodCodes .PrdCod_Sequence >" & PeriodSequence
        Dim Ds As DataSet
        Ds = MyBase.GetData(Str)
        Dim No As Integer = 0
        If CheckDataSet(Ds) Then
            No = DbNullToInt(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return No


    End Function


    Protected Function GetAllEmployeesOfCodeOfTemplateGroup(ByVal FromEmpCode As String, ByVal ToEmpCode As String, ByVal TempGrpCode As String) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""


        Str = " SELECT Emp_Code" & _
        " FROM PrMsEmployees" & _
        " WHERE (TemGrp_Code = " & enQuoteString(TempGrpCode) & ")"
        If FromEmpCode <> "" Or ToEmpCode <> "" Then
            Str2 = " AND (Emp_Code >= " & enQuoteString(FromEmpCode) & _
                 " AND Emp_Code <= " & enQuoteString(ToEmpCode) & ")"
        End If
        Str = Str & Str2

        Return GetData(Str)

    End Function
    Protected Function GetAllEmployees() As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""


        Str = " SELECT Emp_Code" & _
        " FROM PrMsEmployees" & _
        " WHERE emp_status='A'"

        Return GetData(Str)

    End Function
    Protected Function GetAllEmployeesOfTemplateGroup(ByVal TempGrpCode As String) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""


        Str = " SELECT Emp_Code," & _
        " Emp_FullName" & _
        " FROM PrMsEmployees" & _
        " WHERE (TemGrp_Code = " & enQuoteString(TempGrpCode) & ")"


        Return GetData(Str)

    End Function
    Protected Function GetAllEmployeesOfCodeOfTemplateGroupForYear(ByVal FromEmpCode As String, ByVal ToEmpCode As String, ByVal TempGrpCode As String, ByVal YearPeriod As Date, ByVal OrderByanalysis2 As Boolean) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""

        Dim SYear As String = Format(YearPeriod, "yyyy-MM-dd")
        SYear = Utils.ChangeDateFormatForSearch(SYear)

        Str = " SELECT Emp_Code" & _
        " FROM PrMsEmployees" & _
        " WHERE (TemGrp_Code = " & enQuoteString(TempGrpCode) & ")" & _
        " AND (emp_startdate < " & enQuoteString(SYear) & ")"
        If FromEmpCode <> "" Or ToEmpCode <> "" Then
            Str2 = " AND (Emp_Code >= " & enQuoteString(FromEmpCode) & _
                 " AND Emp_Code <= " & enQuoteString(ToEmpCode) & ")"
        End If
        If Global1.PARAM_HideEmpWithBlanksSIR Then
            Str3 = " AND (ComSin_EmpSocialInsNo <>'')"
        End If
        If OrderByanalysis2 Then
            Str4 = " Order By EmpAn2_Code"
        End If

        Str = Str & Str2 & Str3 & Str4

        Return GetData(Str)

    End Function
    Protected Function GetAllEmployeesOfCompany(ByVal CompanyCode As String)
        Dim Str As String = ""
        Dim Str2 As String = ""



        Str = " SELECT PrMsEmployees.Emp_Code" & _
            " FROM  PrMsTemplateGroup INNER JOIN" & _
            " PrMsEmployees ON PrMsTemplateGroup.TemGrp_Code = PrMsEmployees.TemGrp_Code INNER JOIN" & _
            " AdMsCompany ON PrMsTemplateGroup.Com_Code = AdMsCompany.Com_Code" & _
            " WHERE (AdMsCompany.Com_Code = " & enQuoteString(CompanyCode) & ") " & _
            " and Emp_Status ='A'"


        Return GetData(Str)

    End Function
    Protected Function GetAllCompanyDetails(ByVal FromCompany As String, ByVal ToCompany As String) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""



        Str = " SELECT Com_Code Code," & _
            "Com_Name Name," & _
            "Com_TIC TIC," & _
            "Com_SIRegNo SIReg, " & _
            "Com_Address1 Address1," & _
            "Com_Address2 Address2," & _
            "Com_Address3 Address3," & _
            "Com_Address4 Address4, " & _
            "Com_Tel1 Phone1," & _
            "Com_Tel2 Phone2," & _
            "0 NoEmployees ," & _
            "0.00 Gross" & _
            " FROM  AdMsCompany " & _
            " WHERE Com_Code >= " & enQuoteString(FromCompany) & _
            " AND Com_Code <= " & enQuoteString(ToCompany) & _
            " order by Com_Code asc"

        Return GetData(Str)

    End Function
#End Region

#Region "PAYSLIP REPORT"
    Protected Function REPORT_PreparePayslipFor(ByVal Emp As cPrMsEmployees, ByVal Per As cPrMsPeriodCodes, ByVal Hdr As cPrTxTrxnHeader, ByVal ChequeDate As Date, ByVal PrintInCurrency As Boolean) As DataSet


        ' Global1.GLBPayslipShowOnlyWithValue = True

        Dim Rate As Decimal
        Dim ds As DataSet = New DataSet
        Dim Ds2 As DataSet = New DataSet
        Dim i As Integer
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim DsEmp As DataSet
        Dim DsCompany As DataSet
        Dim DsTrxnHeader As DataSet
        Dim DsErn As DataSet
        Dim DsDed As DataSet
        Dim DsCon As DataSet

        Dim colTrxHdr_Id As Integer = 0
        Dim colTrxLin_Id As Integer = 1
        Dim colTrxLin_Type As Integer = 2
        Dim colE_Code As Integer = 3
        Dim colD_Code As Integer = 4
        Dim colC_Code As Integer = 5
        Dim colE_Description As Integer = 6
        Dim colD_Description As Integer = 7
        Dim colC_Description As Integer = 8
        Dim colE_PeriodValue As Integer = 9
        Dim colD_PeriodValue As Integer = 10
        Dim colC_PeriodValue As Integer = 11
        Dim colE_YTDValue As Integer = 12
        Dim colD_YTDValue As Integer = 13
        Dim colC_YTDValue As Integer = 14

        Dim CompanyCost As Double = 0


        Dim Balance As Double = 0
        Dim DaysBalance As Double = 0
        Dim LeaveTypes As New cPrSsLeaveTypes()
        Dim TempGrp As New cPrMsTemplateGroup(Hdr.TemGrpCode)
        Dim LeaveCode As String
        Dim dsAL As DataSet
        Dim AL_Entitlement As Double
        Dim AL_Taken As Double
        Dim Month_Taken As Double = 0
        Dim Month_entitled As Double = 0

        dsAL = Global1.Business.GetParameter("Leave Type", "Annual Leave ID")

        Dim Balance2 As Double = 0
        Dim DaysBalance2 As Double = 0
        Dim LeaveTypes2 As New cPrSsLeaveTypes()
        Dim TempGrp2 As New cPrMsTemplateGroup(Hdr.TemGrpCode)
        Dim LeaveCode2 As String
        Dim dsAL2 As DataSet
        Dim AL_Entitlement2 As Double
        Dim AL_Taken2 As Double
        Dim Month_Taken2 As Double = 0
        Dim Month_entitled2 As Double = 0

        Dim R_OpeningBalance As Double
        Dim R_MonthEntitlement As Double
        Dim R_MonthBooked As Double
        Dim R_ClosingBalance As Double

        Dim R_OpeningBalance2 As Double
        Dim R_MonthEntitlement2 As Double
        Dim R_MonthBooked2 As Double
        Dim R_ClosingBalance2 As Double

        If Global1.PARAM_MonthlyALBalance Then
            If CheckDataSet(dsAL) Then
                Dim TakenBeforePeriod As Double
                Dim Par As New cPrSsParameters(dsAL.Tables(0).Rows(0))
                LeaveCode = Par.Value1
                LeaveTypes = New cPrSsLeaveTypes(LeaveCode)

                Dim YearStart As Date = CDate(Per.DateFrom.Year & "/" & "01/01")
                Dim YearEnd As Date = CDate(Per.DateFrom.Year & "/" & "12/31")
                Dim LastPeriodEnd As Date = DateAdd(DateInterval.Day, -1, Per.DateFrom)

                Dim EOY As Double = 0
                Balance = 0
                Balance = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_IncreaseCODE, YearStart, LastPeriodEnd, AN_Approved)
                Balance = Balance + Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_CarryForwardCODE, YearStart, YearEnd, AN_Approved)
                AL_Entitlement = Balance

                AL_Taken = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_DecreaseCODE, YearStart, LastPeriodEnd, AN_Approved)
                TakenBeforePeriod = AL_Taken
                'AL_Taken = RoundMe3(Balance - TakenBeforePeriod, 2)


                Month_Taken = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_DecreaseCODE, Per.DateFrom, Per.DateTo, AN_Approved)
                Month_Entitled = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_IncreaseCODE, Per.DateFrom, Per.DateTo, AN_Approved)

                Balance = RoundMe3(Balance - TakenBeforePeriod - Month_Taken, 2)
                DaysBalance = RoundMe3(Balance / TempGrp.DayUnits, 2)

                R_OpeningBalance = RoundMe3(AL_Entitlement - TakenBeforePeriod, 2)
                R_MonthEntitlement = Month_entitled
                R_MonthBooked = Month_Taken
                R_ClosingBalance = RoundMe3(R_OpeningBalance + R_MonthEntitlement - R_MonthBooked, 2)



            End If
            '''

            dsAL2 = Global1.Business.GetParameter("Leave Type", "Sick Leave ID")
            If CheckDataSet(dsAL2) Then
                Dim TakenBeforePeriod2 As Double
                Dim Par2 As New cPrSsParameters(dsAL2.Tables(0).Rows(0))
                LeaveCode2 = Par2.Value1
                LeaveTypes2 = New cPrSsLeaveTypes(LeaveCode2)

                Dim YearStart As Date = CDate(Per.DateFrom.Year & "/" & "01/01")
                Dim YearEnd As Date = CDate(Per.DateFrom.Year & "/" & "12/31")
                Dim LastPeriodEnd As Date = DateAdd(DateInterval.Day, -1, Per.DateFrom)

                Dim EOY As Double = 0
                Balance2 = 0
                Balance2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_IncreaseCODE, YearStart, LastPeriodEnd, AN_Approved)
                Balance2 = Balance2 + Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_CarryForwardCODE, YearStart, YearEnd, AN_Approved)
                AL_Entitlement2 = Balance2

                AL_Taken2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_DecreaseCODE, YearStart, LastPeriodEnd, AN_Approved)
                TakenBeforePeriod2 = AL_Taken2
                'AL_Taken = RoundMe3(Balance - TakenBeforePeriod, 2)


                Month_Taken2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_DecreaseCODE, Per.DateFrom, Per.DateTo, AN_Approved)
                Month_entitled2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_IncreaseCODE, Per.DateFrom, Per.DateTo, AN_Approved)

                Balance2 = RoundMe3(Balance2 - TakenBeforePeriod2 - Month_Taken2, 2)
                DaysBalance2 = RoundMe3(Balance2 / TempGrp.DayUnits, 2)


                R_OpeningBalance2 = RoundMe3(AL_Entitlement2 - TakenBeforePeriod2, 2)
                R_MonthEntitlement2 = Month_entitled2
                R_MonthBooked2 = Month_Taken2
                R_ClosingBalance2 = RoundMe3(R_OpeningBalance2 + R_MonthEntitlement2 - R_MonthBooked2, 2)


            End If
            'If CheckDataSet(dsAL) Then
            '    Dim TakenBeforePeriod As Double
            '    Dim Par As New cPrSsParameters(dsAL.Tables(0).Rows(0))
            '    LeaveCode = Par.Value1
            '    LeaveTypes = New cPrSsLeaveTypes(LeaveCode)
            '    Dim FromDate As Date = CDate(Per.DateFrom.Year & "/" & "01/01")
            '    Dim ToDate As Date = CDate(Per.DateFrom.Year & "/" & "12/31")

            '    Dim EOY As Double = 0
            '    Balance = 0
            '    Balance = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_IncreaseCODE, FromDate, ToDate, AN_Approved)
            '    Balance = Balance + Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_CarryForwardCODE, FromDate, ToDate, AN_Approved)
            '    AL_Entitlement = Balance


            '    ToDate = CDate(Per.DateFrom)
            '    AL_Taken = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_DecreaseCODE, FromDate, ToDate, AN_Approved, True)
            '    TakenBeforePeriod = AL_Taken
            '    AL_Taken = RoundMe3(Balance - TakenBeforePeriod, 2)


            '    FromDate = CDate(Per.DateFrom)
            '    ToDate = CDate(Per.DateTo)

            '    Month_Taken = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_DecreaseCODE, FromDate, ToDate, AN_Approved)

            '    Balance = RoundMe3(Balance - TakenBeforePeriod - Month_Taken, 2)
            '    DaysBalance = RoundMe3(Balance / TempGrp.DayUnits, 2)
            'End If
            ' '''

            'dsAL2 = Global1.Business.GetParameter("Leave Type", "Sick Leave ID")
            'If CheckDataSet(dsAL2) Then
            '    Dim TakenBeforePeriod2 As Double
            '    Dim Par2 As New cPrSsParameters(dsAL2.Tables(0).Rows(0))
            '    LeaveCode2 = Par2.Value1
            '    LeaveTypes2 = New cPrSsLeaveTypes(LeaveCode2)
            '    Dim FromDate As Date = CDate(Per.DateFrom.Year & "/" & "01/01")
            '    Dim ToDate As Date = CDate(Per.DateFrom.Year & "/" & "12/31")

            '    Dim EOY As Double = 0
            '    Balance2 = 0
            '    Balance2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_IncreaseCODE, FromDate, ToDate, AN_Approved)
            '    Balance2 = Balance2 + Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_CarryForwardCODE, FromDate, ToDate, AN_Approved)
            '    AL_Entitlement2 = Balance2

            '    ToDate = CDate(Per.DateFrom)
            '    AL_Taken2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_DecreaseCODE, FromDate, ToDate, AN_Approved, True)
            '    TakenBeforePeriod2 = AL_Taken2
            '    AL_Taken2 = RoundMe3(Balance2 - TakenBeforePeriod2, 2)

            '    FromDate = CDate(Per.DateFrom)
            '    ToDate = CDate(Per.DateTo)

            '    Month_Taken2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_DecreaseCODE, FromDate, ToDate, AN_Approved)

            '    Balance2 = RoundMe3(Balance2 - TakenBeforePeriod2 - Month_Taken2, 2)
            '    DaysBalance2 = RoundMe3(Balance2 / TempGrp.DayUnits, 2)
            'End If
        Else
            If CheckDataSet(dsAL) Then
                Dim Par As New cPrSsParameters(dsAL.Tables(0).Rows(0))
                LeaveCode = Par.Value1
                LeaveTypes = New cPrSsLeaveTypes(LeaveCode)
                Dim FromDate As Date = CDate(Per.DateFrom.Year & "/" & "01/01")
                Dim ToDate As Date = CDate(Per.DateFrom.Year & "/" & "12/31")

                Dim EOY As Double = 0
                Balance = 0
                Balance = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_IncreaseCODE, FromDate, ToDate, AN_Approved)
                Balance = Balance + Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_CarryForwardCODE, FromDate, ToDate, AN_Approved)
                AL_Entitlement = Balance
                AL_Taken = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_DecreaseCODE, FromDate, ToDate, AN_Approved)
                Balance = Balance - AL_Taken
                DaysBalance = RoundMe3(Balance / TempGrp.DayUnits, 2)
            End If
            '''
            dsAL2 = Global1.Business.GetParameter("Leave Type", "Sick Leave ID")
            If CheckDataSet(dsAL2) Then
                Dim Par2 As New cPrSsParameters(dsAL2.Tables(0).Rows(0))
                LeaveCode2 = Par2.Value1
                LeaveTypes2 = New cPrSsLeaveTypes(LeaveCode2)
                Dim FromDate As Date = CDate(Per.DateFrom.Year & "/" & "01/01")
                Dim ToDate As Date = CDate(Per.DateFrom.Year & "/" & "12/31")

                Dim EOY As Double = 0
                Balance2 = 0
                Balance2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_IncreaseCODE, FromDate, ToDate, AN_Approved)
                Balance2 = Balance2 + Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_CarryForwardCODE, FromDate, ToDate, AN_Approved)
                AL_Entitlement2 = Balance2
                AL_Taken2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_DecreaseCODE, FromDate, ToDate, AN_Approved)
                Balance2 = Balance2 - AL_Taken2
                DaysBalance2 = RoundMe3(Balance2 / TempGrp.DayUnits, 2)
            End If
        End If
        Dim DsRate As DataSet

        DsRate = Global1.Business.GetParameter("Dolar", "Rate")
        If CheckDataSet(DsRate) Then
            Dim Par As New cPrSsParameters(DsRate.Tables(0).Rows(0))
            Global1.PARAM_USDRate = Par.Value1
        End If
        '''
        'Dim Department As String
        'Dim Anl2 As New cPrAnEmployeeAnalysis2(Emp.EmpAn2_Code)
        'Department = Anl2.DescriptionL

        'Dim Position As String
        'Dim Pos As New cPrAnEmployeePositions(Emp.EmpPos_Code)
        'Department = Anl2.DescriptionL
        'Position = Pos.DescriptionL




        Str = "Select Emp_Code, " &
            " Emp_FullName," &
            " Emp_Address1," &
            " Emp_Address2," &
            " Emp_Address3," &
            " Emp_PostCode," &
            " Emp_Telephone1," &
            " Emp_SocialInsNumber, " &
            " Emp_IdentificationCard," &
            " 0.00 ALBalance," &
            " 0.00 CompanyCost," &
            " 0.00 ALBalanceInDays," &
            " '' Department," &
            " '' Position," &
            " Emp_PassportNumber," &
            " Emp_TaxId, " &
            " Emp_AlienNumber," &
            " Emp_startDate, " &
            " Emp_TerminateDate, " &
            " 0.00 AL1Entitlement," &
            " 0.00 AL1Taken," &
            " 0.00 AL1Balance," &
            " 0.00 AL2Entitlement," &
            " 0.00 AL2Taken," &
            " 0.00 AL2Balance, " &
            " 0.00 MonthTake," &
            " 0.00 MonthTake2, " &
            " 0.00 OB, " &
            " 0.00 EOM, " &
            " 0.00 BOM, " &
            " 0.00 CB, " &
            " 0.00 OB_2, " &
            " 0.00 EOM_2, " &
            " 0.00 BOM_2, " &
            " 0.00 CB_2, " &
            " '' TSWork, " &
            " '' TSNormal, " &
            " '' TSAL, " &
            " '' TSSic, " &
            " '' TSArmy, " &
            " '' TSDiff, " &
            " Emp_IBAN, " &
            " Bnk_Code, " &
            " '' DepartmentCode " &
            " FROM  PrMsEmployees" &
            " WHERE (Emp_Code = " & enQuoteString(Emp.Code) & ")"

        DsEmp = GetData(Str)
        If CheckDataSet(DsEmp) Then

            DsEmp.Tables(0).Rows(0).Item(9) = Balance
            DsEmp.Tables(0).Rows(0).Item(11) = DaysBalance
            DsEmp.Tables(0).Rows(0).Item(12) = "" 'Department
            DsEmp.Tables(0).Rows(0).Item(13) = "" 'Position

            DsEmp.Tables(0).Rows(0).Item(19) = RoundMe2(AL_Entitlement / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(20) = RoundMe2(AL_Taken / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(21) = RoundMe2(Balance / TempGrp.DayUnits, 2)

            DsEmp.Tables(0).Rows(0).Item(22) = RoundMe2(AL_Entitlement2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(23) = RoundMe2(AL_Taken2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(24) = RoundMe2(Balance2 / TempGrp.DayUnits, 2)

            DsEmp.Tables(0).Rows(0).Item(25) = RoundMe2(Month_Taken / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(26) = RoundMe2(Month_Taken2 / TempGrp.DayUnits, 2)

            DsEmp.Tables(0).Rows(0).Item(27) = RoundMe2(R_OpeningBalance / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(28) = RoundMe2(R_MonthEntitlement / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(29) = RoundMe2(R_MonthBooked / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(30) = RoundMe2(R_ClosingBalance / TempGrp.DayUnits, 2)

            DsEmp.Tables(0).Rows(0).Item(31) = RoundMe2(R_OpeningBalance2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(32) = RoundMe2(R_MonthEntitlement2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(33) = RoundMe2(R_MonthBooked2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(34) = RoundMe2(R_ClosingBalance2 / TempGrp.DayUnits, 2)






            Dim ID As String = ""
            Dim Pass As String = ""
            Dim ARC As String = ""
            ID = DbNullToString(DsEmp.Tables(0).Rows(0).Item(8))
            Pass = DbNullToString(DsEmp.Tables(0).Rows(0).Item(14))
            ARC = DbNullToString(DsEmp.Tables(0).Rows(0).Item(16))
            If ID = "" Then
                ID = Pass
                DsEmp.Tables(0).Rows(0).Item(8) = ID
            End If
            If ID = "" Then
                ID = ARC
                DsEmp.Tables(0).Rows(0).Item(8) = ID
            End If
            Dim termDay As String
            termDay = DbNullToString(DsEmp.Tables(0).Rows(0).Item(18))
            If termDay <> "" Then
                Dim ar() As String
                ar = termDay.Split("/")
                termDay = ar(2) & "/" & ar(1) & "/" & ar(0)
                DsEmp.Tables(0).Rows(0).Item(18) = termDay
            End If
        End If
        ds.Tables.Add(DsEmp.Tables(0).Copy)
        ds.Tables(0).TableName = "Employees"


        'COMPANY()

        Str = " SELECT Com_Name, " &
              " Com_TIC," &
              " Com_Address1," &
              " Com_Address2," &
              " Com_Address3," &
              " Com_Address4," &
              " Com_Tel1," &
              " Com_Logo," &
              " Com_Stamp " &
              " FROM AdMsCompany where com_code=" & enQuoteString(TempGrp.CompanyCode)
        DsCompany = GetData(Str)
        ds.Tables.Add(DsCompany.Tables(0).Copy)
        ds.Tables(1).TableName = "Company"

        'HEADER

        Str = "SELECT PrTxTrxnHeader.TrxHdr_Id," &
                " PrMsPeriodCodes.PrdCod_DescriptionL," &
                " PrTxTrxnHeader.TrxHdr_Date," &
                " PrTxTrxnHeader.TrxHdr_TotalErnPeriod," &
                " PrTxTrxnHeader.TrxHdr_TotalErnYTD," &
                " PrTxTrxnHeader.TrxHdr_TotalDedPeriod," &
                " PrTxTrxnHeader.TrxHdr_TotalDedYTD," &
                " PrTxTrxnHeader.TrxHdr_TotalConPeriod, " &
                " PrTxTrxnHeader.TrxHdr_TotalConYTD," &
                " PrTxTrxnHeader.TrxHdr_SIIncome," &
                " PrTxTrxnHeader.TrxHdr_TaxableIncome, " &
                " PrTxTrxnHeader.TrxHdr_PaymentMethod," &
                " PrTxTrxnHeader.TrxHdr_PaymentRef," &
                " PrTxTrxnHeader.TrxHdr_PeriodUnits, " &
                " PrTxTrxnHeader.TrxHdr_AnnualUnits," &
                " PrTxTrxnHeader.TrxHdr_AnnualLeave," &
                " PrTxTrxnHeader.TrxHdr_LifeInsurance, " &
                " PrTxTrxnHeader.TrxHdr_Discounts," &
                " PrTxTrxnHeader.TrxHdr_Overtime1," &
                " PrTxTrxnHeader.TrxHdr_Overtime2," &
                " PrTxTrxnHeader.TrxHdr_SIUnits, " &
                " PrTxTrxnHeader.TrxHdr_Id," &
                " PrTxTrxnHeader.TrxHdr_MonthlySalary," &
                " PrTxTrxnHeader.TrxHdr_NetSalary," &
                " PrMsPeriodGroups.PrdGpr_Year," &
                " '' as Y1, " &
                " '' as Y2, " &
                " '' as Y3, " &
                " '' as Y4, " &
                " '' as M1, " &
                " '' as M2, " &
                " '' as D1, " &
                " '' as D2, " &
                " '' as TAmount, " &
                " '' as Net1, " &
                " '' as Net2, " &
                " PrTxTrxnHeader.TrxHdr_Rate," &
                " PrTxTrxnHeader.TrxHdr_Overtime3, " &
                " PrTxTrxnHeader.TrxHdr_Sectors," &
                " PrTxTrxnHeader.TrxHdr_Dutyhours," &
                " PrTxTrxnHeader.TrxHdr_FlightHours," &
                " PrTxTrxnHeader.TrxHdr_Commission," &
                " PrTxTrxnHeader.TrxHdr_PBAmount," &
                " PrTxTrxnHeader.TrxHdr_PBRate," &
                " PrTxTrxnHeader.TrxHdr_Overlay, " &
                " PrTxTrxnHeader.TrxHdr_PeriodSplit, " &
                " '' as HourlyRate," &
                " '' as ApprovedBy," &
                " '' as PreparedBy," &
                " PrTxTrxnHeader.TrxHdr_A2," &
                " PrTxTrxnHeader.TrxHdr_Position," &
                " PrTxTrxnHeader.TrxHdr_NetYTD, " &
                " PrTxTrxnHeader.TrxHdr_BasisOnSalary, " &
                " PrTxTrxnHeader.TrxHdr_GesiD, " &
                " PrTxTrxnHeader.TrxHdr_GesiC, " &
                " PrTxTrxnHeader.TrxHdr_Medical, " &
                " PrTxTrxnHeader.Com_Code," &
                " PrTxTrxnHeader.TrxHdr_Year, " &
                " 0.00 SalUSD," &
                " 0.0000 RateUSD " &
                " FROM PrTxTrxnHeader INNER JOIN" &
                " PrMsPeriodCodes ON " &
                " PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code AND " &
                " PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code" &
                " INNER JOIN PrMsPeriodGroups ON" &
                " PrMsPeriodCodes.PrdGrp_Code = PrMsPeriodGroups.PrdGrp_Code" &
                " WHERE (PrTxTrxnHeader.TrxHdr_Id = " & Hdr.Id & ")"

        DsTrxnHeader = GetData(Str)
        If CheckDataSet(DsTrxnHeader) Then

            Rate = DbNullToDecimal(DsTrxnHeader.Tables(0).Rows(i).Item(36))
            If Rate = 0 Then
                Rate = 1
            End If
            Dim S As String = Format(ChequeDate.Date, "yyyy/MM/dd")
            Dim Y1 As String = S.Substring(0, 1)
            Dim Y2 As String = S.Substring(1, 1)
            Dim Y3 As String = S.Substring(2, 1)
            Dim Y4 As String = S.Substring(3, 1)
            Dim M1 As String = S.Substring(5, 1)
            Dim M2 As String = S.Substring(6, 1)
            Dim D1 As String = S.Substring(8, 1)
            Dim D2 As String = S.Substring(9, 1)


            DsTrxnHeader.Tables(0).Rows(i).Item("Y1") = Y1
            DsTrxnHeader.Tables(0).Rows(i).Item("Y2") = Y2
            DsTrxnHeader.Tables(0).Rows(i).Item("Y3") = Y3
            DsTrxnHeader.Tables(0).Rows(i).Item("Y4") = Y4
            DsTrxnHeader.Tables(0).Rows(i).Item("M1") = M1
            DsTrxnHeader.Tables(0).Rows(i).Item("M2") = M2
            DsTrxnHeader.Tables(0).Rows(i).Item("D1") = D1
            DsTrxnHeader.Tables(0).Rows(i).Item("D2") = D2

            DsTrxnHeader.Tables(0).Rows(i).Item("ApprovedBy") = Global1.PARAM_Payslip_ApprovedBy
            DsTrxnHeader.Tables(0).Rows(i).Item("PreparedBy") = Global1.PARAM_Payslip_PreparedBy


            Dim NetSalary As Double
            If PrintInCurrency Then
                NetSalary = Format(DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_NetSalary") * (1 / Rate), "0.00")

            Else
                NetSalary = Format(DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_NetSalary"), "0.00")
            End If

            Dim Epidoma As Double = 0
            If Global1.PARAM_RemoveE37 Then
                Epidoma = Global1.Business.Get_EARNING_VALUE_FromTrxnLines_For_HeaderID(Hdr.Id, "E37")
                NetSalary = RoundMe2(NetSalary - Epidoma, 2)
                DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_NetSalary") = NetSalary
            End If

            Dim Ar() As String
            Dim Net As String
            Net = Format(NetSalary, "0.00")
            Ar = Net.Split(".")

            DsTrxnHeader.Tables(0).Rows(i).Item("Net1") = Ar(0)
            DsTrxnHeader.Tables(0).Rows(i).Item("Net2") = Ar(1)


            Dim Amount1 As String
            Amount1 = NumToWords(CInt(Ar(0)))
            Amount1 = UCase(Amount1) & " EURO "

            Dim Amount2 As String
            Amount2 = NumToWords(CInt(Ar(1)))
            Amount2 = " AND " & UCase(Amount2) & " CENTS"

            DsTrxnHeader.Tables(0).Rows(i).Item("TAmount") = Amount1 & Amount2


            Dim HourlyRate As Double
            Dim MonthlySalary As Double = DbNullToDouble(DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_MonthlySalary"))
            Dim BasisOnsalary As Double = DbNullToDouble(DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_BasisOnSalary"))

            MonthlySalary = MonthlySalary + BasisOnsalary
            DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_MonthlySalary") = MonthlySalary
            '''''

            If Emp.PayUni_Code = Global1.GLB_Units_Hourly_Code Then
                'Hourly
                HourlyRate = MonthlySalary

            ElseIf Emp.PayUni_Code = Global1.GLB_Units_Period_Code Then
                Dim PeriodUnits As Double = 0
                If Emp.PeriodUnits = 0 Then
                    Dim Prd As New cPrMsPeriodCodes(Hdr.PrdCod_Code, Hdr.PrdGrp_Code)
                    PeriodUnits = Prd.PeriodUnits
                Else
                    PeriodUnits = Emp.PeriodUnits
                End If

                HourlyRate = RoundMe2(MonthlySalary / PeriodUnits, 2)
            End If



            '''''
            DsTrxnHeader.Tables(0).Rows(i).Item("HourlyRate") = HourlyRate

            Dim Department As String
            Dim Position As String
            Department = DsTrxnHeader.Tables(0).Rows(i).Item(49)
            Position = DsTrxnHeader.Tables(0).Rows(i).Item(50)
            Dim Anl2 As New cPrAnEmployeeAnalysis2(Department)
            Department = Anl2.DescriptionL
            Dim Pos As New cPrAnEmployeePositions(Position)
            Position = Pos.DescriptionL
            If Global1.param_showAnalysis3onPayslip Then
                Department = Hdr.A3
                Dim Anl3 As New cPrAnEmployeeAnalysis3(Department)
                Department = Anl3.DescriptionL
            End If

            If CheckDataSet(DsEmp) Then
                ds.Tables(0).Rows(0).Item(12) = Department
                ds.Tables(0).Rows(0).Item(13) = Position
                ds.Tables(0).Rows(0).Item(43) = Anl2.Code
            End If
            Dim NetInDollar As Decimal = 0.0
            Dim DollarRate As Double = Global1.PARAM_USDRate

            NetInDollar = RoundMe2(NetSalary * Global1.PARAM_USDRate, 2)

            DsTrxnHeader.Tables(0).Rows(i).Item("SalUSD") = NetInDollar
            DsTrxnHeader.Tables(0).Rows(i).Item("RateUSD") = DollarRate

            If Global1.PARAM_AddBIKOnEarnings Then
                Dim DsBik1 As DataSet
                Dim DsBik2 As DataSet
                Dim BIKPeriod As Double = 0
                Dim BIKYTD As Double = 0
                DsBik1 = FindBenefitsInKindTotalFor_Template_PeriodCode_Employee(Hdr.TemGrpCode, Hdr.PrdCod_Code, Hdr.Emp_Code)
                DsBik2 = FindBenefitsInKindTotalFor_Template_PeriodGroup_Employee(Hdr.TemGrpCode, Hdr.PrdGrp_Code, Hdr.Emp_Code, Hdr.PrdCod_Code)
                If CheckDataSet(DsBik1) Then
                    BIKPeriod = DbNullToDouble(DsBik1.Tables(0).Rows(0).Item(0))
                End If
                If CheckDataSet(DsBik2) Then
                    BIKYTD = DbNullToDouble(DsBik2.Tables(0).Rows(0).Item(0))
                End If
                Dim TEarn As Double = DbNullToDouble(DsTrxnHeader.Tables(0).Rows(0).Item(3))
                Dim TEarnYTD As Double = DbNullToDouble(DsTrxnHeader.Tables(0).Rows(0).Item(4))

                TEarn = TEarn + BIKPeriod
                TEarnYTD = TEarnYTD + BIKYTD

                DsTrxnHeader.Tables(0).Rows(0).Item(3) = TEarn
                DsTrxnHeader.Tables(0).Rows(0).Item(4) = TEarnYTD
            End If
        End If

        ds.Tables.Add(DsTrxnHeader.Tables(0).Copy)
        ds.Tables(2).TableName = "Header"




        Dim dt As New DataTable

        dt = New DataTable("EDC")
        '0
        dt.Columns.Add(New DataColumn("TrxHdr_Id", System.Type.GetType("System.String")))
        '1
        dt.Columns.Add(New DataColumn("TrxLin_Id", System.Type.GetType("System.String")))
        '2
        dt.Columns.Add(New DataColumn("TrxLin_Type", System.Type.GetType("System.String")))
        '3
        dt.Columns.Add(New DataColumn("E_Code", System.Type.GetType("System.String")))
        '4
        dt.Columns.Add(New DataColumn("D_Code", System.Type.GetType("System.String")))
        '5
        dt.Columns.Add(New DataColumn("C_Code", System.Type.GetType("System.String")))
        '6
        dt.Columns.Add(New DataColumn("E_Description", System.Type.GetType("System.String")))
        '7
        dt.Columns.Add(New DataColumn("D_Description", System.Type.GetType("System.String")))
        '8
        dt.Columns.Add(New DataColumn("C_Description", System.Type.GetType("System.String")))
        '9
        dt.Columns.Add(New DataColumn("E_PeriodValue", System.Type.GetType("System.String")))
        '10
        dt.Columns.Add(New DataColumn("D_PeriodValue", System.Type.GetType("System.String")))
        '11
        dt.Columns.Add(New DataColumn("C_PeriodValue", System.Type.GetType("System.String")))
        '12
        dt.Columns.Add(New DataColumn("E_YTDValue", System.Type.GetType("System.String")))
        '13
        dt.Columns.Add(New DataColumn("D_YTDValue", System.Type.GetType("System.String")))
        '14
        dt.Columns.Add(New DataColumn("C_YTDValue", System.Type.GetType("System.String")))


        Ds2.Tables.Add(dt)

        'EARNINGS

        'Str = " SELECT TrxLin_Id," & _
        '    " TrxHdr_Id," & _
        '    " TrxLin_Type," & _
        '    " ErnCod_Code," & _
        '    " DedCod_Code," & _
        '    " ConCod_Code," & _
        '    " TrxLin_PeriodValue," & _
        '    " TrxLin_YTDValue," & _
        '    " TrxLin_EDC," & _
        '    " TrxLin_EDCDescription" & _
        '    " FROM PrTxTrxnLines" & _
        '    " WHERE TrxHdr_Id=" & Hdr.Id & _
        '    " AND TrxLin_Type='E'" & _
        '    " ORDER BY TrxHdr_Id Asc"
        Str = "SELECT PrTxTrxnLines.TrxLin_Id," &
            " PrTxTrxnLines.TrxHdr_Id," &
            " PrTxTrxnLines.TrxLin_Type," &
            " PrTxTrxnLines.ErnCod_Code," &
            " PrTxTrxnLines.DedCod_Code, " &
            " PrTxTrxnLines.ConCod_Code, " &
            " PrTxTrxnLines.TrxLin_PeriodValue, " &
            " PrTxTrxnLines.TrxLin_YTDValue, " &
            " PrTxTrxnLines.TrxLin_EDC, " &
            " PrTxTrxnLines.TrxLin_EDCDescription," &
            " PrTxTrxnLines.TrxLin_ConsolDesc" &
            " FROM PrTxTrxnLines INNER JOIN PrMsTemplateEarnings" &
            " ON PrTxTrxnLines.ErnCod_Code = PrMsTemplateEarnings.ErnCod_Code" &
            " WHERE (PrTxTrxnLines.TrxHdr_Id = " & Hdr.Id & ") " &
            " AND (PrTxTrxnLines.TrxLin_Type = 'E')" &
            " AND (PrMsTemplateEarnings.TemErn_IsDispalyed = 'Y')" &
            " AND (PrMsTemplateEarnings.TemGrp_Code = " & enQuoteString(Hdr.TemGrpCode) & ")"

        Str2 = ""
        If Global1.GLBPayslipShowOnlyWithValue Then
            Str2 = " AND (PrTxTrxnLines.TrxLin_PeriodValue<>0 OR PrTxTrxnLines.TrxLin_YTDValue<>0 ) "
        End If
        Str3 = " ORDER BY PrTxTrxnLines.TrxHdr_Id,TrxLin_Id"
        Str = Str & Str2 & Str3

        DsErn = GetData(Str)


        'DEDUCTIONS

        'Str = " SELECT TrxLin_Id," & _
        '   " TrxHdr_Id," & _
        '   " TrxLin_Type," & _
        '   " ErnCod_Code," & _
        '   " DedCod_Code," & _
        '   " ConCod_Code," & _
        '   " TrxLin_PeriodValue," & _
        '   " TrxLin_YTDValue," & _
        '   " TrxLin_EDC," & _
        '   " TrxLin_EDCDescription" & _
        '   " FROM PrTxTrxnLines" & _
        '   " WHERE TrxHdr_Id=" & Hdr.Id & _
        '    " AND TrxLin_Type='D'" & _
        '   " ORDER BY TrxHdr_Id Asc"
        Str = "SELECT PrTxTrxnLines.TrxLin_Id," &
                   " PrTxTrxnLines.TrxHdr_Id," &
                   " PrTxTrxnLines.TrxLin_Type," &
                   " PrTxTrxnLines.ErnCod_Code," &
                   " PrTxTrxnLines.DedCod_Code, " &
                   " PrTxTrxnLines.ConCod_Code, " &
                   " PrTxTrxnLines.TrxLin_PeriodValue, " &
                   " PrTxTrxnLines.TrxLin_YTDValue, " &
                   " PrTxTrxnLines.TrxLin_EDC, " &
                   " PrTxTrxnLines.TrxLin_EDCDescription," &
                   " PrTxTrxnLines.TrxLin_ConsolDesc" &
                   " FROM PrTxTrxnLines INNER JOIN PrMsTemplateDeductions" &
                   " ON PrTxTrxnLines.DedCod_Code = PrMsTemplateDeductions.DedCod_Code" &
                   " WHERE (PrTxTrxnLines.TrxHdr_Id = " & Hdr.Id & ") " &
                   " AND (PrTxTrxnLines.TrxLin_Type = 'D')" &
                   " AND (PrMsTemplateDeductions.TemDed_IsDispalyed = 'Y')" &
                   " AND (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(Hdr.TemGrpCode) & ")"

        Str2 = ""
        If Global1.GLBPayslipShowOnlyWithValue Then
            Str2 = " AND (PrTxTrxnLines.TrxLin_PeriodValue<>0 OR PrTxTrxnLines.TrxLin_YTDValue<>0 ) "
        End If
        Str3 = " ORDER BY PrTxTrxnLines.TrxHdr_Id,TrxLin_Id"
        Str = Str & Str2 & Str3

        DsDed = GetData(Str)


        'CONTRIBUTIONS

        'Str = " SELECT  TrxLin_Id," & _
        '   " TrxHdr_Id," & _
        '   " TrxLin_Type," & _
        '   " ErnCod_Code," & _
        '   " DedCod_Code," & _
        '   " ConCod_Code," & _
        '   " TrxLin_PeriodValue," & _
        '   " TrxLin_YTDValue," & _
        '   " TrxLin_EDC," & _
        '   " TrxLin_EDCDescription" & _
        '   " FROM PrTxTrxnLines" & _
        '   " WHERE TrxHdr_Id=" & Hdr.Id & _
        '   " AND TrxLin_Type='C'" & _
        '   " ORDER BY TrxHdr_Id Asc"
        Str = "SELECT PrTxTrxnLines.TrxLin_Id," &
           " PrTxTrxnLines.TrxHdr_Id," &
           " PrTxTrxnLines.TrxLin_Type," &
           " PrTxTrxnLines.ErnCod_Code," &
           " PrTxTrxnLines.DedCod_Code, " &
           " PrTxTrxnLines.ConCod_Code, " &
           " PrTxTrxnLines.TrxLin_PeriodValue, " &
           " PrTxTrxnLines.TrxLin_YTDValue, " &
           " PrTxTrxnLines.TrxLin_EDC, " &
           " PrTxTrxnLines.TrxLin_EDCDescription," &
           " PrTxTrxnLines.TrxLin_ConsolDesc" &
           " FROM PrTxTrxnLines INNER JOIN PrMsTemplateContributions" &
           " ON PrTxTrxnLines.ConCod_Code = PrMsTemplateContributions.ConCod_Code" &
           " WHERE (PrTxTrxnLines.TrxHdr_Id = " & Hdr.Id & ") " &
           " AND (PrTxTrxnLines.TrxLin_Type = 'C')" &
           " AND (PrMsTemplateContributions.TemCon_IsDispalyed = 'Y')" &
           " AND (PrMsTemplateContributions.TemGrp_Code = " & enQuoteString(Hdr.TemGrpCode) & ")"


        Str2 = ""
        If Global1.GLBPayslipShowOnlyWithValue Then
            Str2 = " AND (PrTxTrxnLines.TrxLin_PeriodValue<>0 OR PrTxTrxnLines.TrxLin_YTDValue<>0 ) "
        End If
        Str3 = " ORDER BY PrTxTrxnLines.TrxHdr_Id,TrxLin_Id"
        Str = Str & Str2 & Str3

        DsCon = GetData(Str)

        Dim R As DataRow
        'COBALT
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

        '''''''''''''''''''''''

        Dim Total_ErnPeriodValue As Double = 0
        Dim Total_ErnYTDValue As Double = 0
        Dim Total_DedPeriodValue As Double = 0
        Dim Total_DedYTDValue As Double = 0
        Dim Total_ConPeriodValue As Double = 0
        Dim Total_ConYTDValue As Double = 0



        Dim RCounter As Integer = 0
        For i = 0 To DsErn.Tables(0).Rows.Count - 1
            With DsErn.Tables(0).Rows(i)
                Dim ConsolDesc As String
                Dim k As Integer
                Dim EditRow As Boolean = False
                Dim EditRowIndex As Integer = 0
                ConsolDesc = DbNullToString(.Item(10))
                If ConsolDesc <> "" Then
                    For k = 0 To dt.Rows.Count - 1
                        If dt.Rows(k).Item(colE_Description) = ConsolDesc Then
                            EditRowIndex = k
                            EditRow = True
                            Exit For
                        End If
                    Next
                End If
                If EditRow Then
                    If PrintInCurrency Then
                        dt.Rows(EditRowIndex).Item(colE_PeriodValue) = Format(DbNullToDouble(.Item(6)) * (1 / Rate) + dt.Rows(EditRowIndex).Item(colE_PeriodValue), "0.00")
                        dt.Rows(EditRowIndex).Item(colE_YTDValue) = Format(DbNullToDouble(.Item(7)) * (1 / Rate) + dt.Rows(EditRowIndex).Item(colE_YTDValue), "0.00")
                        CompanyCost = CompanyCost + DbNullToDouble(.Item(6) * (1 / Rate))
                    Else
                        dt.Rows(EditRowIndex).Item(colE_PeriodValue) = Format(DbNullToDouble(.Item(6)) + dt.Rows(EditRowIndex).Item(colE_PeriodValue), "0.00")
                        dt.Rows(EditRowIndex).Item(colE_YTDValue) = Format(DbNullToDouble(.Item(7)) + dt.Rows(EditRowIndex).Item(colE_YTDValue), "0.00")
                        CompanyCost = CompanyCost + DbNullToDouble(.Item(6))
                    End If
                Else
                    R = dt.NewRow()
                    R(colTrxHdr_Id) = DbNullToInt(.Item(1))
                    R(colTrxLin_Id) = DbNullToInt(.Item(0))
                    R(colTrxLin_Type) = ""
                    R(colE_Code) = DbNullToString(.Item(3))
                    R(colD_Code) = ""
                    R(colC_Code) = ""
                    If ConsolDesc = "" Then
                        R(colE_Description) = DbNullToString(.Item(9))
                    Else
                        R(colE_Description) = ConsolDesc

                    End If
                    R(colD_Description) = ""
                    R(colC_Description) = ""
                    If PrintInCurrency Then
                        R(colE_PeriodValue) = Format(DbNullToDouble(.Item(6)) * (1 / Rate), "0.00")
                        R(colE_YTDValue) = Format(DbNullToDouble(.Item(7)) * (1 / Rate), "0.00")
                        CompanyCost = CompanyCost + DbNullToDouble(.Item(6) * (1 / Rate))
                    Else
                        R(colE_PeriodValue) = Format(DbNullToDouble(.Item(6)), "0.00")
                        R(colE_YTDValue) = Format(DbNullToDouble(.Item(7)), "0.00")
                        CompanyCost = CompanyCost + DbNullToDouble(.Item(6))
                    End If
                    R(colD_PeriodValue) = ""
                    R(colC_PeriodValue) = ""
                    R(colD_YTDValue) = ""
                    R(colC_YTDValue) = ""

                    Total_ErnPeriodValue = Total_ErnPeriodValue + R(colE_PeriodValue)
                    Total_ErnYTDValue = Total_ErnYTDValue + R(colE_YTDValue)

                    dt.Rows.Add(R)
                    RCounter = RCounter + 1
                End If

            End With
        Next
        If DsErn.Tables(0).Rows.Count < 15 Then
            'For i = DsErn.Tables(0).Rows.Count To 14
            For i = RCounter To 14
                R = dt.NewRow()
                R(colTrxHdr_Id) = ""
                R(colTrxLin_Id) = ""
                R(colTrxLin_Type) = ""
                R(colE_Code) = ""
                R(colD_Code) = ""
                R(colC_Code) = ""
                R(colE_Description) = ""
                R(colD_Description) = ""
                R(colC_Description) = ""
                R(colE_PeriodValue) = ""
                R(colD_PeriodValue) = ""
                R(colC_PeriodValue) = ""
                R(colE_YTDValue) = ""
                R(colD_YTDValue) = ""
                R(colC_YTDValue) = ""


                dt.Rows.Add(R)

            Next
        End If
        ' ds.Tables.Add(dt)
        For i = 0 To DsDed.Tables(0).Rows.Count - 1
            With DsDed.Tables(0).Rows(i)
                Ds2.Tables(0).Rows(i).Item(colD_Code) = DbNullToString(.Item(3))
                Ds2.Tables(0).Rows(i).Item(colD_Description) = DbNullToString(.Item(9))
                If PrintInCurrency Then
                    Ds2.Tables(0).Rows(i).Item(colD_PeriodValue) = Format(DbNullToDouble(.Item(6)) * (1 / Rate), "0.00")
                    Ds2.Tables(0).Rows(i).Item(colD_YTDValue) = Format(DbNullToDouble(.Item(7)) * (1 / Rate), "0.00")
                Else
                    Ds2.Tables(0).Rows(i).Item(colD_PeriodValue) = Format(DbNullToDouble(.Item(6)), "0.00")
                    Ds2.Tables(0).Rows(i).Item(colD_YTDValue) = Format(DbNullToDouble(.Item(7)), "0.00")
                End If
                Total_DedPeriodValue = Total_DedPeriodValue + Ds2.Tables(0).Rows(i).Item(colD_PeriodValue)
                Total_DedYTDValue = Total_DedYTDValue + Ds2.Tables(0).Rows(i).Item(colD_YTDValue)
            End With
        Next
        For i = 0 To DsCon.Tables(0).Rows.Count - 1
            With DsCon.Tables(0).Rows(i)
                Ds2.Tables(0).Rows(i).Item(colC_Code) = DbNullToString(.Item(3))
                Ds2.Tables(0).Rows(i).Item(colC_Description) = DbNullToString(.Item(9))
                If PrintInCurrency Then
                    Ds2.Tables(0).Rows(i).Item(colC_PeriodValue) = Format(DbNullToDouble(.Item(6)) * (1 / Rate), "0.00")
                    Ds2.Tables(0).Rows(i).Item(colC_YTDValue) = Format(DbNullToDouble(.Item(7)) * (1 / Rate), "0.00")
                    CompanyCost = CompanyCost + DbNullToDouble(.Item(6)) * (1 / Rate)
                Else
                    Ds2.Tables(0).Rows(i).Item(colC_PeriodValue) = Format(DbNullToDouble(.Item(6)), "0.00")
                    Ds2.Tables(0).Rows(i).Item(colC_YTDValue) = Format(DbNullToDouble(.Item(7)), "0.00")
                    CompanyCost = CompanyCost + DbNullToDouble(.Item(6))
                End If
                Total_ConPeriodValue = Total_ConPeriodValue + Ds2.Tables(0).Rows(i).Item(colC_PeriodValue)
                Total_ConYTDValue = Total_ConYTDValue + Ds2.Tables(0).Rows(i).Item(colC_YTDValue)
            End With
        Next


        ds.Tables.Add(Ds2.Tables(0).Copy)
        ds.Tables(3).TableName = "EDC"
        If ds.Tables(0).Rows.Count - 1 >= 0 Then
            ds.Tables(0).Rows(0).Item(10) = CompanyCost
        End If


        'ds.Tables(2).Rows(0).Item(3) = Total_ErnPeriodValue
        'ds.Tables(2).Rows(0).Item(4) = Total_ErnYTDValue
        'ds.Tables(2).Rows(0).Item(5) = Total_DedPeriodValue
        'ds.Tables(2).Rows(0).Item(6) = Total_DedYTDValue
        ds.Tables(2).Rows(0).Item(7) = Total_ConPeriodValue
        ds.Tables(2).Rows(0).Item(8) = Total_ConYTDValue


        Dim DsTimesheets As DataSet
        DsTimesheets = Global1.Business.GetEmployeeTimesheets(Emp.Code, Emp.TemGrp_Code, Per.PrdGrpCode, Per.Code)
        ds.Tables.Add(DsTimesheets.Tables(0).Copy)
        ds.Tables(4).TableName = "TimeSheets"
        If CheckDataSet(DsTimesheets) Then
            If CheckDataSet(DsEmp) Then
                Dim totalWork As String

                Dim k As Integer
                For k = 0 To DsTimesheets.Tables(0).Rows.Count - 1
                    totalWork = DbNullToString(DsTimesheets.Tables(0).Rows(k).Item(14))
                    If totalWork <> "0:00:00" Then
                        Exit For
                    End If
                Next

                Dim totalNormal As String = DbNullToString(DsTimesheets.Tables(0).Rows(0).Item(22))
                Dim totalAL As String = DbNullToString(DsTimesheets.Tables(0).Rows(0).Item(28))
                Dim totalSIC As String = DbNullToString(DsTimesheets.Tables(0).Rows(0).Item(29))
                Dim totalARMY As String = DbNullToString(DsTimesheets.Tables(0).Rows(0).Item(30))
                Dim totalDIF As String = DbNullToString(DsTimesheets.Tables(0).Rows(0).Item(21))
                ds.Tables(0).Rows(0).Item(35) = totalWork
                ds.Tables(0).Rows(0).Item(36) = totalNormal
                ds.Tables(0).Rows(0).Item(37) = totalAL
                ds.Tables(0).Rows(0).Item(38) = totalSIC
                ds.Tables(0).Rows(0).Item(39) = totalARMY
                ds.Tables(0).Rows(0).Item(40) = totalDIF
            End If
        End If

        Return ds

    End Function
    Protected Function REPORT_PreparePayslipForAllMonths(ByVal Emp As cPrMsEmployees, ByVal Per As cPrMsPeriodCodes, ByVal Hdr As cPrTxTrxnHeader, ByVal ChequeDate As Date, ByVal PrintInCurrency As Boolean) As DataSet


        ' Global1.GLBPayslipShowOnlyWithValue = True

        Dim Rate As Decimal
        Dim ds As DataSet = New DataSet
        Dim Ds2 As DataSet = New DataSet
        Dim i As Integer
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim DsEmp As DataSet
        Dim DsCompany As DataSet
        Dim DsTrxnHeader As DataSet
        Dim DsErn As DataSet
        Dim DsDed As DataSet
        Dim DsCon As DataSet

        Dim colTrxHdr_Id As Integer = 0
        Dim colTrxLin_Id As Integer = 1
        Dim colTrxLin_Type As Integer = 2
        Dim colE_Code As Integer = 3
        Dim colD_Code As Integer = 4
        Dim colC_Code As Integer = 5
        Dim colE_Description As Integer = 6
        Dim colD_Description As Integer = 7
        Dim colC_Description As Integer = 8
        Dim colE_PeriodValue As Integer = 9
        Dim colD_PeriodValue As Integer = 10
        Dim colC_PeriodValue As Integer = 11
        Dim colE_YTDValue As Integer = 12
        Dim colD_YTDValue As Integer = 13
        Dim colC_YTDValue As Integer = 14

        Dim CompanyCost As Double = 0


        Dim Balance As Double = 0
        Dim DaysBalance As Double = 0
        Dim LeaveTypes As New cPrSsLeaveTypes()
        Dim TempGrp As New cPrMsTemplateGroup(Hdr.TemGrpCode)
        Dim LeaveCode As String
        Dim dsAL As DataSet
        Dim AL_Entitlement As Double
        Dim AL_Taken As Double
        Dim Month_Taken As Double = 0
        Dim Month_entitled As Double = 0

        dsAL = Global1.Business.GetParameter("Leave Type", "Annual Leave ID")

        Dim Balance2 As Double = 0
        Dim DaysBalance2 As Double = 0
        Dim LeaveTypes2 As New cPrSsLeaveTypes()
        Dim TempGrp2 As New cPrMsTemplateGroup(Hdr.TemGrpCode)
        Dim LeaveCode2 As String
        Dim dsAL2 As DataSet
        Dim AL_Entitlement2 As Double
        Dim AL_Taken2 As Double
        Dim Month_Taken2 As Double = 0
        Dim Month_entitled2 As Double = 0

        Dim R_OpeningBalance As Double
        Dim R_MonthEntitlement As Double
        Dim R_MonthBooked As Double
        Dim R_ClosingBalance As Double

        Dim R_OpeningBalance2 As Double
        Dim R_MonthEntitlement2 As Double
        Dim R_MonthBooked2 As Double
        Dim R_ClosingBalance2 As Double

        If Global1.PARAM_MonthlyALBalance Then
            If CheckDataSet(dsAL) Then
                Dim TakenBeforePeriod As Double
                Dim Par As New cPrSsParameters(dsAL.Tables(0).Rows(0))
                LeaveCode = Par.Value1
                LeaveTypes = New cPrSsLeaveTypes(LeaveCode)

                Dim YearStart As Date = CDate(Per.DateFrom.Year & "/" & "01/01")
                Dim YearEnd As Date = CDate(Per.DateFrom.Year & "/" & "12/31")
                Dim LastPeriodEnd As Date = DateAdd(DateInterval.Day, -1, Per.DateFrom)

                Dim EOY As Double = 0
                Balance = 0
                Balance = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_IncreaseCODE, YearStart, LastPeriodEnd, AN_Approved)
                Balance = Balance + Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_CarryForwardCODE, YearStart, YearEnd, AN_Approved)
                AL_Entitlement = Balance

                AL_Taken = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_DecreaseCODE, YearStart, LastPeriodEnd, AN_Approved)
                TakenBeforePeriod = AL_Taken
                'AL_Taken = RoundMe3(Balance - TakenBeforePeriod, 2)


                Month_Taken = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_DecreaseCODE, Per.DateFrom, Per.DateTo, AN_Approved)
                Month_entitled = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_IncreaseCODE, Per.DateFrom, Per.DateTo, AN_Approved)

                Balance = RoundMe3(Balance - TakenBeforePeriod - Month_Taken, 2)
                DaysBalance = RoundMe3(Balance / TempGrp.DayUnits, 2)

                R_OpeningBalance = RoundMe3(AL_Entitlement - TakenBeforePeriod, 2)
                R_MonthEntitlement = Month_entitled
                R_MonthBooked = Month_Taken
                R_ClosingBalance = RoundMe3(R_OpeningBalance + R_MonthEntitlement - R_MonthBooked, 2)



            End If
            '''

            dsAL2 = Global1.Business.GetParameter("Leave Type", "Sick Leave ID")
            If CheckDataSet(dsAL2) Then
                Dim TakenBeforePeriod2 As Double
                Dim Par2 As New cPrSsParameters(dsAL2.Tables(0).Rows(0))
                LeaveCode2 = Par2.Value1
                LeaveTypes2 = New cPrSsLeaveTypes(LeaveCode2)

                Dim YearStart As Date = CDate(Per.DateFrom.Year & "/" & "01/01")
                Dim YearEnd As Date = CDate(Per.DateFrom.Year & "/" & "12/31")
                Dim LastPeriodEnd As Date = DateAdd(DateInterval.Day, -1, Per.DateFrom)

                Dim EOY As Double = 0
                Balance2 = 0
                Balance2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_IncreaseCODE, YearStart, LastPeriodEnd, AN_Approved)
                Balance2 = Balance2 + Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_CarryForwardCODE, YearStart, YearEnd, AN_Approved)
                AL_Entitlement2 = Balance2

                AL_Taken2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_DecreaseCODE, YearStart, LastPeriodEnd, AN_Approved)
                TakenBeforePeriod2 = AL_Taken2
                'AL_Taken = RoundMe3(Balance - TakenBeforePeriod, 2)


                Month_Taken2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_DecreaseCODE, Per.DateFrom, Per.DateTo, AN_Approved)
                Month_entitled2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_IncreaseCODE, Per.DateFrom, Per.DateTo, AN_Approved)

                Balance2 = RoundMe3(Balance2 - TakenBeforePeriod2 - Month_Taken2, 2)
                DaysBalance2 = RoundMe3(Balance2 / TempGrp.DayUnits, 2)


                R_OpeningBalance2 = RoundMe3(AL_Entitlement2 - TakenBeforePeriod2, 2)
                R_MonthEntitlement2 = Month_entitled2
                R_MonthBooked2 = Month_Taken2
                R_ClosingBalance2 = RoundMe3(R_OpeningBalance2 + R_MonthEntitlement2 - R_MonthBooked2, 2)


            End If

        Else
            If CheckDataSet(dsAL) Then
                Dim Par As New cPrSsParameters(dsAL.Tables(0).Rows(0))
                LeaveCode = Par.Value1
                LeaveTypes = New cPrSsLeaveTypes(LeaveCode)
                Dim FromDate As Date = CDate(Per.DateFrom.Year & "/" & "01/01")
                Dim ToDate As Date = CDate(Per.DateFrom.Year & "/" & "12/31")

                Dim EOY As Double = 0
                Balance = 0
                Balance = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_IncreaseCODE, FromDate, ToDate, AN_Approved)
                Balance = Balance + Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_CarryForwardCODE, FromDate, ToDate, AN_Approved)
                AL_Entitlement = Balance
                AL_Taken = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_DecreaseCODE, FromDate, ToDate, AN_Approved)
                Balance = Balance - AL_Taken
                DaysBalance = RoundMe3(Balance / TempGrp.DayUnits, 2)
            End If
            '''
            dsAL2 = Global1.Business.GetParameter("Leave Type", "Sick Leave ID")
            If CheckDataSet(dsAL2) Then
                Dim Par2 As New cPrSsParameters(dsAL2.Tables(0).Rows(0))
                LeaveCode2 = Par2.Value1
                LeaveTypes2 = New cPrSsLeaveTypes(LeaveCode2)
                Dim FromDate As Date = CDate(Per.DateFrom.Year & "/" & "01/01")
                Dim ToDate As Date = CDate(Per.DateFrom.Year & "/" & "12/31")

                Dim EOY As Double = 0
                Balance2 = 0
                Balance2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_IncreaseCODE, FromDate, ToDate, AN_Approved)
                Balance2 = Balance2 + Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_CarryForwardCODE, FromDate, ToDate, AN_Approved)
                AL_Entitlement2 = Balance2
                AL_Taken2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_DecreaseCODE, FromDate, ToDate, AN_Approved)
                Balance2 = Balance2 - AL_Taken2
                DaysBalance2 = RoundMe3(Balance2 / TempGrp.DayUnits, 2)
            End If
        End If
        Dim DsRate As DataSet

        DsRate = Global1.Business.GetParameter("Dolar", "Rate")
        If CheckDataSet(DsRate) Then
            Dim Par As New cPrSsParameters(DsRate.Tables(0).Rows(0))
            Global1.PARAM_USDRate = Par.Value1
        End If
        '''
        'Dim Department As String
        'Dim Anl2 As New cPrAnEmployeeAnalysis2(Emp.EmpAn2_Code)
        'Department = Anl2.DescriptionL

        'Dim Position As String
        'Dim Pos As New cPrAnEmployeePositions(Emp.EmpPos_Code)
        'Department = Anl2.DescriptionL
        'Position = Pos.DescriptionL




        Str = "Select Emp_Code, " &
            " Emp_FullName," &
            " Emp_Address1," &
            " Emp_Address2," &
            " Emp_Address3," &
            " Emp_PostCode," &
            " Emp_Telephone1," &
            " Emp_SocialInsNumber, " &
            " Emp_IdentificationCard," &
            " 0.00 ALBalance," &
            " 0.00 CompanyCost," &
            " 0.00 ALBalanceInDays," &
            " '' Department," &
            " '' Position," &
            " Emp_PassportNumber," &
            " Emp_TaxId, " &
            " Emp_AlienNumber," &
            " Emp_startDate, " &
            " Emp_TerminateDate, " &
            " 0.00 AL1Entitlement," &
            " 0.00 AL1Taken," &
            " 0.00 AL1Balance," &
            " 0.00 AL2Entitlement," &
            " 0.00 AL2Taken," &
            " 0.00 AL2Balance, " &
            " 0.00 MonthTake," &
            " 0.00 MonthTake2, " &
            " 0.00 OB, " &
            " 0.00 EOM, " &
            " 0.00 BOM, " &
            " 0.00 CB, " &
            " 0.00 OB_2, " &
            " 0.00 EOM_2, " &
            " 0.00 BOM_2, " &
            " 0.00 CB_2, " &
            " '' TSWork, " &
            " '' TSNormal, " &
            " '' TSAL, " &
            " '' TSSic, " &
            " '' TSArmy, " &
            " '' TSDiff, " &
            " Emp_IBAN, " &
            " Bnk_Code, " &
            " '' DepartmentCode " &
            " FROM  PrMsEmployees" &
            " WHERE (Emp_Code = " & enQuoteString(Emp.Code) & ")"

        DsEmp = GetData(Str)
        If CheckDataSet(DsEmp) Then

            DsEmp.Tables(0).Rows(0).Item(9) = Balance
            DsEmp.Tables(0).Rows(0).Item(11) = DaysBalance
            DsEmp.Tables(0).Rows(0).Item(12) = "" 'Department
            DsEmp.Tables(0).Rows(0).Item(13) = "" 'Position

            DsEmp.Tables(0).Rows(0).Item(19) = RoundMe2(AL_Entitlement / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(20) = RoundMe2(AL_Taken / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(21) = RoundMe2(Balance / TempGrp.DayUnits, 2)

            DsEmp.Tables(0).Rows(0).Item(22) = RoundMe2(AL_Entitlement2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(23) = RoundMe2(AL_Taken2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(24) = RoundMe2(Balance2 / TempGrp.DayUnits, 2)

            DsEmp.Tables(0).Rows(0).Item(25) = RoundMe2(Month_Taken / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(26) = RoundMe2(Month_Taken2 / TempGrp.DayUnits, 2)

            DsEmp.Tables(0).Rows(0).Item(27) = RoundMe2(R_OpeningBalance / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(28) = RoundMe2(R_MonthEntitlement / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(29) = RoundMe2(R_MonthBooked / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(30) = RoundMe2(R_ClosingBalance / TempGrp.DayUnits, 2)

            DsEmp.Tables(0).Rows(0).Item(31) = RoundMe2(R_OpeningBalance2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(32) = RoundMe2(R_MonthEntitlement2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(33) = RoundMe2(R_MonthBooked2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(34) = RoundMe2(R_ClosingBalance2 / TempGrp.DayUnits, 2)






            Dim ID As String = ""
            Dim Pass As String = ""
            Dim ARC As String = ""
            ID = DbNullToString(DsEmp.Tables(0).Rows(0).Item(8))
            Pass = DbNullToString(DsEmp.Tables(0).Rows(0).Item(14))
            ARC = DbNullToString(DsEmp.Tables(0).Rows(0).Item(16))
            If ID = "" Then
                ID = Pass
                DsEmp.Tables(0).Rows(0).Item(8) = ID
            End If
            If ID = "" Then
                ID = ARC
                DsEmp.Tables(0).Rows(0).Item(8) = ID
            End If
            Dim termDay As String
            termDay = DbNullToString(DsEmp.Tables(0).Rows(0).Item(18))
            If termDay <> "" Then
                Dim ar() As String
                ar = termDay.Split("/")
                termDay = ar(2) & "/" & ar(1) & "/" & ar(0)
                DsEmp.Tables(0).Rows(0).Item(18) = termDay
            End If
        End If
        ds.Tables.Add(DsEmp.Tables(0).Copy)
        ds.Tables(0).TableName = "Employees"


        'COMPANY()

        Str = " SELECT Com_Name, " &
              " Com_TIC," &
              " Com_Address1," &
              " Com_Address2," &
              " Com_Address3," &
              " Com_Address4," &
              " Com_Tel1," &
              " Com_Logo," &
              " Com_Stamp " &
              " FROM AdMsCompany where com_code=" & enQuoteString(TempGrp.CompanyCode)
        DsCompany = GetData(Str)
        ds.Tables.Add(DsCompany.Tables(0).Copy)
        ds.Tables(1).TableName = "Company"






        'HEADER

        Str = "SELECT PrTxTrxnHeader.TrxHdr_Id," &
                " PrMsPeriodCodes.PrdCod_DescriptionL," &
                " PrTxTrxnHeader.TrxHdr_Date," &
                " PrTxTrxnHeader.TrxHdr_TotalErnPeriod," &
                " PrTxTrxnHeader.TrxHdr_TotalErnYTD," &
                " PrTxTrxnHeader.TrxHdr_TotalDedPeriod," &
                " PrTxTrxnHeader.TrxHdr_TotalDedYTD," &
                " PrTxTrxnHeader.TrxHdr_TotalConPeriod, " &
                " PrTxTrxnHeader.TrxHdr_TotalConYTD," &
                " PrTxTrxnHeader.TrxHdr_SIIncome," &
                " PrTxTrxnHeader.TrxHdr_TaxableIncome, " &
                " PrTxTrxnHeader.TrxHdr_PaymentMethod," &
                " PrTxTrxnHeader.TrxHdr_PaymentRef," &
                " PrTxTrxnHeader.TrxHdr_PeriodUnits, " &
                " PrTxTrxnHeader.TrxHdr_AnnualUnits," &
                " PrTxTrxnHeader.TrxHdr_AnnualLeave," &
                " PrTxTrxnHeader.TrxHdr_LifeInsurance, " &
                " PrTxTrxnHeader.TrxHdr_Discounts," &
                " PrTxTrxnHeader.TrxHdr_Overtime1," &
                " PrTxTrxnHeader.TrxHdr_Overtime2," &
                " PrTxTrxnHeader.TrxHdr_SIUnits, " &
                " PrTxTrxnHeader.TrxHdr_Id," &
                " PrTxTrxnHeader.TrxHdr_MonthlySalary," &
                " PrTxTrxnHeader.TrxHdr_NetSalary," &
                " PrMsPeriodGroups.PrdGpr_Year," &
                " '' as Y1, " &
                " '' as Y2, " &
                " '' as Y3, " &
                " '' as Y4, " &
                " '' as M1, " &
                " '' as M2, " &
                " '' as D1, " &
                " '' as D2, " &
                " '' as TAmount, " &
                " '' as Net1, " &
                " '' as Net2, " &
                " PrTxTrxnHeader.TrxHdr_Rate," &
                " PrTxTrxnHeader.TrxHdr_Overtime3, " &
                " PrTxTrxnHeader.TrxHdr_Sectors," &
                " PrTxTrxnHeader.TrxHdr_Dutyhours," &
                " PrTxTrxnHeader.TrxHdr_FlightHours," &
                " PrTxTrxnHeader.TrxHdr_Commission," &
                " PrTxTrxnHeader.TrxHdr_PBAmount," &
                " PrTxTrxnHeader.TrxHdr_PBRate," &
                " PrTxTrxnHeader.TrxHdr_Overlay, " &
                " PrTxTrxnHeader.TrxHdr_PeriodSplit, " &
                " '' as HourlyRate," &
                " '' as ApprovedBy," &
                " '' as PreparedBy," &
                " PrTxTrxnHeader.TrxHdr_A2," &
                " PrTxTrxnHeader.TrxHdr_Position," &
                " PrTxTrxnHeader.TrxHdr_NetYTD, " &
                " PrTxTrxnHeader.TrxHdr_BasisOnSalary, " &
                " PrTxTrxnHeader.TrxHdr_GesiD, " &
                " PrTxTrxnHeader.TrxHdr_GesiC, " &
                " PrTxTrxnHeader.TrxHdr_Medical, " &
                " PrTxTrxnHeader.Com_Code," &
                " PrTxTrxnHeader.TrxHdr_Year, " &
                " 0.00 SalUSD," &
                " 0.0000 RateUSD " &
                " FROM PrTxTrxnHeader INNER JOIN" &
                " PrMsPeriodCodes ON " &
                " PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code AND " &
                " PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code" &
                " INNER JOIN PrMsPeriodGroups ON" &
                " PrMsPeriodCodes.PrdGrp_Code = PrMsPeriodGroups.PrdGrp_Code" &
                " WHERE (PrTxTrxnHeader.TrxHdr_Id = " & Hdr.Id & ")"

        DsTrxnHeader = GetData(Str)
        If CheckDataSet(DsTrxnHeader) Then

            Rate = DbNullToDecimal(DsTrxnHeader.Tables(0).Rows(i).Item(36))
            If Rate = 0 Then
                Rate = 1
            End If
            Dim S As String = Format(ChequeDate.Date, "yyyy/MM/dd")
            Dim Y1 As String = S.Substring(0, 1)
            Dim Y2 As String = S.Substring(1, 1)
            Dim Y3 As String = S.Substring(2, 1)
            Dim Y4 As String = S.Substring(3, 1)
            Dim M1 As String = S.Substring(5, 1)
            Dim M2 As String = S.Substring(6, 1)
            Dim D1 As String = S.Substring(8, 1)
            Dim D2 As String = S.Substring(9, 1)


            DsTrxnHeader.Tables(0).Rows(i).Item("Y1") = Y1
            DsTrxnHeader.Tables(0).Rows(i).Item("Y2") = Y2
            DsTrxnHeader.Tables(0).Rows(i).Item("Y3") = Y3
            DsTrxnHeader.Tables(0).Rows(i).Item("Y4") = Y4
            DsTrxnHeader.Tables(0).Rows(i).Item("M1") = M1
            DsTrxnHeader.Tables(0).Rows(i).Item("M2") = M2
            DsTrxnHeader.Tables(0).Rows(i).Item("D1") = D1
            DsTrxnHeader.Tables(0).Rows(i).Item("D2") = D2

            DsTrxnHeader.Tables(0).Rows(i).Item("ApprovedBy") = Global1.PARAM_Payslip_ApprovedBy
            DsTrxnHeader.Tables(0).Rows(i).Item("PreparedBy") = Global1.PARAM_Payslip_PreparedBy


            Dim NetSalary As Double
            If PrintInCurrency Then
                NetSalary = Format(DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_NetSalary") * (1 / Rate), "0.00")

            Else
                NetSalary = Format(DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_NetSalary"), "0.00")
            End If

            Dim Epidoma As Double = 0
            If Global1.PARAM_RemoveE37 Then
                Epidoma = Global1.Business.Get_EARNING_VALUE_FromTrxnLines_For_HeaderID(Hdr.Id, "E37")
                NetSalary = RoundMe2(NetSalary - Epidoma, 2)
                DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_NetSalary") = NetSalary
            End If

            Dim Ar() As String
            Dim Net As String
            Net = Format(NetSalary, "0.00")
            Ar = Net.Split(".")

            DsTrxnHeader.Tables(0).Rows(i).Item("Net1") = Ar(0)
            DsTrxnHeader.Tables(0).Rows(i).Item("Net2") = Ar(1)


            Dim Amount1 As String
            Amount1 = NumToWords(CInt(Ar(0)))
            Amount1 = UCase(Amount1) & " EURO "

            Dim Amount2 As String
            Amount2 = NumToWords(CInt(Ar(1)))
            Amount2 = " AND " & UCase(Amount2) & " CENTS"

            DsTrxnHeader.Tables(0).Rows(i).Item("TAmount") = Amount1 & Amount2


            Dim HourlyRate As Double
            Dim MonthlySalary As Double = DbNullToDouble(DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_MonthlySalary"))
            Dim BasisOnsalary As Double = DbNullToDouble(DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_BasisOnSalary"))

            MonthlySalary = MonthlySalary + BasisOnsalary
            DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_MonthlySalary") = MonthlySalary
            '''''

            If Emp.PayUni_Code = Global1.GLB_Units_Hourly_Code Then
                'Hourly
                HourlyRate = MonthlySalary

            ElseIf Emp.PayUni_Code = Global1.GLB_Units_Period_Code Then
                Dim PeriodUnits As Double = 0
                If Emp.PeriodUnits = 0 Then
                    Dim Prd As New cPrMsPeriodCodes(Hdr.PrdCod_Code, Hdr.PrdGrp_Code)
                    PeriodUnits = Prd.PeriodUnits
                Else
                    PeriodUnits = Emp.PeriodUnits
                End If

                HourlyRate = RoundMe2(MonthlySalary / PeriodUnits, 2)
            End If



            '''''
            DsTrxnHeader.Tables(0).Rows(i).Item("HourlyRate") = HourlyRate

            Dim Department As String
            Dim Position As String
            Department = DsTrxnHeader.Tables(0).Rows(i).Item(49)
            Position = DsTrxnHeader.Tables(0).Rows(i).Item(50)
            Dim Anl2 As New cPrAnEmployeeAnalysis2(Department)
            Department = Anl2.DescriptionL
            Dim Pos As New cPrAnEmployeePositions(Position)
            Position = Pos.DescriptionL
            If Global1.PARAM_ShowAnalysis3onPayslip Then
                Department = Hdr.A3
                Dim Anl3 As New cPrAnEmployeeAnalysis3(Department)
                Department = Anl3.DescriptionL
            End If

            If CheckDataSet(DsEmp) Then
                ds.Tables(0).Rows(0).Item(12) = Department
                ds.Tables(0).Rows(0).Item(13) = Position
                ds.Tables(0).Rows(0).Item(43) = Anl2.Code
            End If
            Dim NetInDollar As Decimal = 0.0
            Dim DollarRate As Double = Global1.PARAM_USDRate

            NetInDollar = RoundMe2(NetSalary * Global1.PARAM_USDRate, 2)

            DsTrxnHeader.Tables(0).Rows(i).Item("SalUSD") = NetInDollar
            DsTrxnHeader.Tables(0).Rows(i).Item("RateUSD") = DollarRate

            If Global1.PARAM_AddBIKOnEarnings Then
                Dim DsBik1 As DataSet
                Dim DsBik2 As DataSet
                Dim BIKPeriod As Double = 0
                Dim BIKYTD As Double = 0
                DsBik1 = FindBenefitsInKindTotalFor_Template_PeriodCode_Employee(Hdr.TemGrpCode, Hdr.PrdCod_Code, Hdr.Emp_Code)
                DsBik2 = FindBenefitsInKindTotalFor_Template_PeriodGroup_Employee(Hdr.TemGrpCode, Hdr.PrdGrp_Code, Hdr.Emp_Code, Hdr.PrdCod_Code)
                If CheckDataSet(DsBik1) Then
                    BIKPeriod = DbNullToDouble(DsBik1.Tables(0).Rows(0).Item(0))
                End If
                If CheckDataSet(DsBik2) Then
                    BIKYTD = DbNullToDouble(DsBik2.Tables(0).Rows(0).Item(0))
                End If
                Dim TEarn As Double = DbNullToDouble(DsTrxnHeader.Tables(0).Rows(0).Item(3))
                Dim TEarnYTD As Double = DbNullToDouble(DsTrxnHeader.Tables(0).Rows(0).Item(4))

                TEarn = TEarn + BIKPeriod
                TEarnYTD = TEarnYTD + BIKYTD

                DsTrxnHeader.Tables(0).Rows(0).Item(3) = TEarn
                DsTrxnHeader.Tables(0).Rows(0).Item(4) = TEarnYTD
            End If
        End If

        ds.Tables.Add(DsTrxnHeader.Tables(0).Copy)
        ds.Tables(2).TableName = "Header"


        Dim DsPeriods As DataSet
        Dim lastId As Integer
        DsPeriods = GetAllPrMsPeriodsByPeriodGroup(Per.PrdGrpCode)
        If CheckDataSet(DsPeriods) Then
            Dim tPerCode As String
            For i = 0 To DsPeriods.Tables(0).Rows.Count - 1
                tPerCode = DbNullToString(DsPeriods.Tables(0).Rows(i).Item(0))
                Dim DsPX As DataSet
                DsPX = GetEDCinLineForPayslip(Emp.Code, tPerCode, Per.PrdGrpCode)
                ds.Tables.Add(DsPX.Tables(0).Copy)
                ds.Tables(i + 3).TableName = "EDC_" & i + 1
                lastId = i + 3
            Next
        End If
        lastId = lastId + 1
        Dim lasthh As Integer
        If CheckDataSet(DsPeriods) Then
            Dim tPerCode As String
            For i = 0 To DsPeriods.Tables(0).Rows.Count - 1
                tPerCode = DbNullToString(DsPeriods.Tables(0).Rows(i).Item(0))
                Dim DsHX As DataSet
                DsHX = GetHeaderInfoForPayslipAllMonths(Emp.Code, tPerCode, Per.PrdGrpCode)
                ds.Tables.Add(DsHX.Tables(0).Copy)
                ds.Tables(i + lastId).TableName = "Head_" & i + 1
                lasthh = i + lastId
            Next
        End If


        Return ds

    End Function
    Protected Function REPORT_PreparePayslipForAllMonthsTOTALS(ByVal Emp As cPrMsEmployees, ByVal Per As cPrMsPeriodCodes, ByVal Hdr As cPrTxTrxnHeader, ByVal ChequeDate As Date, ByVal PrintInCurrency As Boolean) As DataSet


        ' Global1.GLBPayslipShowOnlyWithValue = True

        Dim Rate As Decimal
        Dim ds As DataSet = New DataSet
        Dim Ds2 As DataSet = New DataSet
        Dim i As Integer
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim DsEmp As DataSet
        Dim DsCompany As DataSet
        Dim DsTrxnHeader As DataSet
        Dim DsErn As DataSet
        Dim DsDed As DataSet
        Dim DsCon As DataSet

        Dim colTrxHdr_Id As Integer = 0
        Dim colTrxLin_Id As Integer = 1
        Dim colTrxLin_Type As Integer = 2
        Dim colE_Code As Integer = 3
        Dim colD_Code As Integer = 4
        Dim colC_Code As Integer = 5
        Dim colE_Description As Integer = 6
        Dim colD_Description As Integer = 7
        Dim colC_Description As Integer = 8
        Dim colE_PeriodValue As Integer = 9
        Dim colD_PeriodValue As Integer = 10
        Dim colC_PeriodValue As Integer = 11
        Dim colE_YTDValue As Integer = 12
        Dim colD_YTDValue As Integer = 13
        Dim colC_YTDValue As Integer = 14

        Dim CompanyCost As Double = 0


        Dim Balance As Double = 0
        Dim DaysBalance As Double = 0
        Dim LeaveTypes As New cPrSsLeaveTypes()
        Dim TempGrp As New cPrMsTemplateGroup(Hdr.TemGrpCode)
        Dim LeaveCode As String
        Dim dsAL As DataSet
        Dim AL_Entitlement As Double
        Dim AL_Taken As Double
        Dim Month_Taken As Double = 0
        Dim Month_entitled As Double = 0

        dsAL = Global1.Business.GetParameter("Leave Type", "Annual Leave ID")

        Dim Balance2 As Double = 0
        Dim DaysBalance2 As Double = 0
        Dim LeaveTypes2 As New cPrSsLeaveTypes()
        Dim TempGrp2 As New cPrMsTemplateGroup(Hdr.TemGrpCode)
        Dim LeaveCode2 As String
        Dim dsAL2 As DataSet
        Dim AL_Entitlement2 As Double
        Dim AL_Taken2 As Double
        Dim Month_Taken2 As Double = 0
        Dim Month_entitled2 As Double = 0

        Dim R_OpeningBalance As Double
        Dim R_MonthEntitlement As Double
        Dim R_MonthBooked As Double
        Dim R_ClosingBalance As Double

        Dim R_OpeningBalance2 As Double
        Dim R_MonthEntitlement2 As Double
        Dim R_MonthBooked2 As Double
        Dim R_ClosingBalance2 As Double

        If Global1.PARAM_MonthlyALBalance Then
            If CheckDataSet(dsAL) Then
                Dim TakenBeforePeriod As Double
                Dim Par As New cPrSsParameters(dsAL.Tables(0).Rows(0))
                LeaveCode = Par.Value1
                LeaveTypes = New cPrSsLeaveTypes(LeaveCode)

                Dim YearStart As Date = CDate(Per.DateFrom.Year & "/" & "01/01")
                Dim YearEnd As Date = CDate(Per.DateFrom.Year & "/" & "12/31")
                Dim LastPeriodEnd As Date = DateAdd(DateInterval.Day, -1, Per.DateFrom)

                Dim EOY As Double = 0
                Balance = 0
                Balance = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_IncreaseCODE, YearStart, LastPeriodEnd, AN_Approved)
                Balance = Balance + Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_CarryForwardCODE, YearStart, YearEnd, AN_Approved)
                AL_Entitlement = Balance

                AL_Taken = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_DecreaseCODE, YearStart, LastPeriodEnd, AN_Approved)
                TakenBeforePeriod = AL_Taken
                'AL_Taken = RoundMe3(Balance - TakenBeforePeriod, 2)


                Month_Taken = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_DecreaseCODE, Per.DateFrom, Per.DateTo, AN_Approved)
                Month_entitled = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_IncreaseCODE, Per.DateFrom, Per.DateTo, AN_Approved)

                Balance = RoundMe3(Balance - TakenBeforePeriod - Month_Taken, 2)
                DaysBalance = RoundMe3(Balance / TempGrp.DayUnits, 2)

                R_OpeningBalance = RoundMe3(AL_Entitlement - TakenBeforePeriod, 2)
                R_MonthEntitlement = Month_entitled
                R_MonthBooked = Month_Taken
                R_ClosingBalance = RoundMe3(R_OpeningBalance + R_MonthEntitlement - R_MonthBooked, 2)



            End If
            '''

            dsAL2 = Global1.Business.GetParameter("Leave Type", "Sick Leave ID")
            If CheckDataSet(dsAL2) Then
                Dim TakenBeforePeriod2 As Double
                Dim Par2 As New cPrSsParameters(dsAL2.Tables(0).Rows(0))
                LeaveCode2 = Par2.Value1
                LeaveTypes2 = New cPrSsLeaveTypes(LeaveCode2)

                Dim YearStart As Date = CDate(Per.DateFrom.Year & "/" & "01/01")
                Dim YearEnd As Date = CDate(Per.DateFrom.Year & "/" & "12/31")
                Dim LastPeriodEnd As Date = DateAdd(DateInterval.Day, -1, Per.DateFrom)

                Dim EOY As Double = 0
                Balance2 = 0
                Balance2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_IncreaseCODE, YearStart, LastPeriodEnd, AN_Approved)
                Balance2 = Balance2 + Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_CarryForwardCODE, YearStart, YearEnd, AN_Approved)
                AL_Entitlement2 = Balance2

                AL_Taken2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_DecreaseCODE, YearStart, LastPeriodEnd, AN_Approved)
                TakenBeforePeriod2 = AL_Taken2
                'AL_Taken = RoundMe3(Balance - TakenBeforePeriod, 2)


                Month_Taken2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_DecreaseCODE, Per.DateFrom, Per.DateTo, AN_Approved)
                Month_entitled2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_IncreaseCODE, Per.DateFrom, Per.DateTo, AN_Approved)

                Balance2 = RoundMe3(Balance2 - TakenBeforePeriod2 - Month_Taken2, 2)
                DaysBalance2 = RoundMe3(Balance2 / TempGrp.DayUnits, 2)


                R_OpeningBalance2 = RoundMe3(AL_Entitlement2 - TakenBeforePeriod2, 2)
                R_MonthEntitlement2 = Month_entitled2
                R_MonthBooked2 = Month_Taken2
                R_ClosingBalance2 = RoundMe3(R_OpeningBalance2 + R_MonthEntitlement2 - R_MonthBooked2, 2)


            End If

        Else
            If CheckDataSet(dsAL) Then
                Dim Par As New cPrSsParameters(dsAL.Tables(0).Rows(0))
                LeaveCode = Par.Value1
                LeaveTypes = New cPrSsLeaveTypes(LeaveCode)
                Dim FromDate As Date = CDate(Per.DateFrom.Year & "/" & "01/01")
                Dim ToDate As Date = CDate(Per.DateFrom.Year & "/" & "12/31")

                Dim EOY As Double = 0
                Balance = 0
                Balance = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_IncreaseCODE, FromDate, ToDate, AN_Approved)
                Balance = Balance + Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_CarryForwardCODE, FromDate, ToDate, AN_Approved)
                AL_Entitlement = Balance
                AL_Taken = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes.Code, AN_DecreaseCODE, FromDate, ToDate, AN_Approved)
                Balance = Balance - AL_Taken
                DaysBalance = RoundMe3(Balance / TempGrp.DayUnits, 2)
            End If
            '''
            dsAL2 = Global1.Business.GetParameter("Leave Type", "Sick Leave ID")
            If CheckDataSet(dsAL2) Then
                Dim Par2 As New cPrSsParameters(dsAL2.Tables(0).Rows(0))
                LeaveCode2 = Par2.Value1
                LeaveTypes2 = New cPrSsLeaveTypes(LeaveCode2)
                Dim FromDate As Date = CDate(Per.DateFrom.Year & "/" & "01/01")
                Dim ToDate As Date = CDate(Per.DateFrom.Year & "/" & "12/31")

                Dim EOY As Double = 0
                Balance2 = 0
                Balance2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_IncreaseCODE, FromDate, ToDate, AN_Approved)
                Balance2 = Balance2 + Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_CarryForwardCODE, FromDate, ToDate, AN_Approved)
                AL_Entitlement2 = Balance2
                AL_Taken2 = Global1.Business.GetEmployeeTotalPerTypePerAction(Emp.Code, LeaveTypes2.Code, AN_DecreaseCODE, FromDate, ToDate, AN_Approved)
                Balance2 = Balance2 - AL_Taken2
                DaysBalance2 = RoundMe3(Balance2 / TempGrp.DayUnits, 2)
            End If
        End If
        Dim DsRate As DataSet

        DsRate = Global1.Business.GetParameter("Dolar", "Rate")
        If CheckDataSet(DsRate) Then
            Dim Par As New cPrSsParameters(DsRate.Tables(0).Rows(0))
            Global1.PARAM_USDRate = Par.Value1
        End If
        '''
        'Dim Department As String
        'Dim Anl2 As New cPrAnEmployeeAnalysis2(Emp.EmpAn2_Code)
        'Department = Anl2.DescriptionL

        'Dim Position As String
        'Dim Pos As New cPrAnEmployeePositions(Emp.EmpPos_Code)
        'Department = Anl2.DescriptionL
        'Position = Pos.DescriptionL




        Str = "Select Emp_Code, " &
            " Emp_FullName," &
            " Emp_Address1," &
            " Emp_Address2," &
            " Emp_Address3," &
            " Emp_PostCode," &
            " Emp_Telephone1," &
            " Emp_SocialInsNumber, " &
            " Emp_IdentificationCard," &
            " 0.00 ALBalance," &
            " 0.00 CompanyCost," &
            " 0.00 ALBalanceInDays," &
            " '' Department," &
            " '' Position," &
            " Emp_PassportNumber," &
            " Emp_TaxId, " &
            " Emp_AlienNumber," &
            " Emp_startDate, " &
            " Emp_TerminateDate, " &
            " 0.00 AL1Entitlement," &
            " 0.00 AL1Taken," &
            " 0.00 AL1Balance," &
            " 0.00 AL2Entitlement," &
            " 0.00 AL2Taken," &
            " 0.00 AL2Balance, " &
            " 0.00 MonthTake," &
            " 0.00 MonthTake2, " &
            " 0.00 OB, " &
            " 0.00 EOM, " &
            " 0.00 BOM, " &
            " 0.00 CB, " &
            " 0.00 OB_2, " &
            " 0.00 EOM_2, " &
            " 0.00 BOM_2, " &
            " 0.00 CB_2, " &
            " '' TSWork, " &
            " '' TSNormal, " &
            " '' TSAL, " &
            " '' TSSic, " &
            " '' TSArmy, " &
            " '' TSDiff, " &
            " Emp_IBAN, " &
            " Bnk_Code, " &
            " '' DepartmentCode " &
            " FROM  PrMsEmployees" &
            " WHERE (Emp_Code = " & enQuoteString(Emp.Code) & ")"

        DsEmp = GetData(Str)
        If CheckDataSet(DsEmp) Then

            DsEmp.Tables(0).Rows(0).Item(9) = Balance
            DsEmp.Tables(0).Rows(0).Item(11) = DaysBalance
            DsEmp.Tables(0).Rows(0).Item(12) = "" 'Department
            DsEmp.Tables(0).Rows(0).Item(13) = "" 'Position

            DsEmp.Tables(0).Rows(0).Item(19) = RoundMe2(AL_Entitlement / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(20) = RoundMe2(AL_Taken / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(21) = RoundMe2(Balance / TempGrp.DayUnits, 2)

            DsEmp.Tables(0).Rows(0).Item(22) = RoundMe2(AL_Entitlement2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(23) = RoundMe2(AL_Taken2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(24) = RoundMe2(Balance2 / TempGrp.DayUnits, 2)

            DsEmp.Tables(0).Rows(0).Item(25) = RoundMe2(Month_Taken / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(26) = RoundMe2(Month_Taken2 / TempGrp.DayUnits, 2)

            DsEmp.Tables(0).Rows(0).Item(27) = RoundMe2(R_OpeningBalance / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(28) = RoundMe2(R_MonthEntitlement / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(29) = RoundMe2(R_MonthBooked / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(30) = RoundMe2(R_ClosingBalance / TempGrp.DayUnits, 2)

            DsEmp.Tables(0).Rows(0).Item(31) = RoundMe2(R_OpeningBalance2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(32) = RoundMe2(R_MonthEntitlement2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(33) = RoundMe2(R_MonthBooked2 / TempGrp.DayUnits, 2)
            DsEmp.Tables(0).Rows(0).Item(34) = RoundMe2(R_ClosingBalance2 / TempGrp.DayUnits, 2)






            Dim ID As String = ""
            Dim Pass As String = ""
            Dim ARC As String = ""
            ID = DbNullToString(DsEmp.Tables(0).Rows(0).Item(8))
            Pass = DbNullToString(DsEmp.Tables(0).Rows(0).Item(14))
            ARC = DbNullToString(DsEmp.Tables(0).Rows(0).Item(16))
            If ID = "" Then
                ID = Pass
                DsEmp.Tables(0).Rows(0).Item(8) = ID
            End If
            If ID = "" Then
                ID = ARC
                DsEmp.Tables(0).Rows(0).Item(8) = ID
            End If
            Dim termDay As String
            termDay = DbNullToString(DsEmp.Tables(0).Rows(0).Item(18))
            If termDay <> "" Then
                Dim ar() As String
                ar = termDay.Split("/")
                termDay = ar(2) & "/" & ar(1) & "/" & ar(0)
                DsEmp.Tables(0).Rows(0).Item(18) = termDay
            End If
        End If
        ds.Tables.Add(DsEmp.Tables(0).Copy)
        ds.Tables(0).TableName = "Employees"


        'COMPANY()

        Str = " SELECT Com_Name, " &
              " Com_TIC," &
              " Com_Address1," &
              " Com_Address2," &
              " Com_Address3," &
              " Com_Address4," &
              " Com_Tel1," &
              " Com_Logo," &
              " Com_Stamp " &
              " FROM AdMsCompany where com_code=" & enQuoteString(TempGrp.CompanyCode)
        DsCompany = GetData(Str)
        ds.Tables.Add(DsCompany.Tables(0).Copy)
        ds.Tables(1).TableName = "Company"






        'HEADER

        Str = "SELECT PrTxTrxnHeader.TrxHdr_Id," &
                " PrMsPeriodCodes.PrdCod_DescriptionL," &
                " PrTxTrxnHeader.TrxHdr_Date," &
                " PrTxTrxnHeader.TrxHdr_TotalErnPeriod," &
                " PrTxTrxnHeader.TrxHdr_TotalErnYTD," &
                " PrTxTrxnHeader.TrxHdr_TotalDedPeriod," &
                " PrTxTrxnHeader.TrxHdr_TotalDedYTD," &
                " PrTxTrxnHeader.TrxHdr_TotalConPeriod, " &
                " PrTxTrxnHeader.TrxHdr_TotalConYTD," &
                " PrTxTrxnHeader.TrxHdr_SIIncome," &
                " PrTxTrxnHeader.TrxHdr_TaxableIncome, " &
                " PrTxTrxnHeader.TrxHdr_PaymentMethod," &
                " PrTxTrxnHeader.TrxHdr_PaymentRef," &
                " PrTxTrxnHeader.TrxHdr_PeriodUnits, " &
                " PrTxTrxnHeader.TrxHdr_AnnualUnits," &
                " PrTxTrxnHeader.TrxHdr_AnnualLeave," &
                " PrTxTrxnHeader.TrxHdr_LifeInsurance, " &
                " PrTxTrxnHeader.TrxHdr_Discounts," &
                " PrTxTrxnHeader.TrxHdr_Overtime1," &
                " PrTxTrxnHeader.TrxHdr_Overtime2," &
                " PrTxTrxnHeader.TrxHdr_SIUnits, " &
                " PrTxTrxnHeader.TrxHdr_Id," &
                " PrTxTrxnHeader.TrxHdr_MonthlySalary," &
                " PrTxTrxnHeader.TrxHdr_NetSalary," &
                " PrMsPeriodGroups.PrdGpr_Year," &
                " '' as Y1, " &
                " '' as Y2, " &
                " '' as Y3, " &
                " '' as Y4, " &
                " '' as M1, " &
                " '' as M2, " &
                " '' as D1, " &
                " '' as D2, " &
                " '' as TAmount, " &
                " '' as Net1, " &
                " '' as Net2, " &
                " PrTxTrxnHeader.TrxHdr_Rate," &
                " PrTxTrxnHeader.TrxHdr_Overtime3, " &
                " PrTxTrxnHeader.TrxHdr_Sectors," &
                " PrTxTrxnHeader.TrxHdr_Dutyhours," &
                " PrTxTrxnHeader.TrxHdr_FlightHours," &
                " PrTxTrxnHeader.TrxHdr_Commission," &
                " PrTxTrxnHeader.TrxHdr_PBAmount," &
                " PrTxTrxnHeader.TrxHdr_PBRate," &
                " PrTxTrxnHeader.TrxHdr_Overlay, " &
                " PrTxTrxnHeader.TrxHdr_PeriodSplit, " &
                " '' as HourlyRate," &
                " '' as ApprovedBy," &
                " '' as PreparedBy," &
                " PrTxTrxnHeader.TrxHdr_A2," &
                " PrTxTrxnHeader.TrxHdr_Position," &
                " PrTxTrxnHeader.TrxHdr_NetYTD, " &
                " PrTxTrxnHeader.TrxHdr_BasisOnSalary, " &
                " PrTxTrxnHeader.TrxHdr_GesiD, " &
                " PrTxTrxnHeader.TrxHdr_GesiC, " &
                " PrTxTrxnHeader.TrxHdr_Medical, " &
                " PrTxTrxnHeader.Com_Code," &
                " PrTxTrxnHeader.TrxHdr_Year, " &
                " 0.00 SalUSD," &
                " 0.0000 RateUSD " &
                " FROM PrTxTrxnHeader INNER JOIN" &
                " PrMsPeriodCodes ON " &
                " PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code AND " &
                " PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code" &
                " INNER JOIN PrMsPeriodGroups ON" &
                " PrMsPeriodCodes.PrdGrp_Code = PrMsPeriodGroups.PrdGrp_Code" &
                " WHERE (PrTxTrxnHeader.TrxHdr_Id = " & Hdr.Id & ")"

        DsTrxnHeader = GetData(Str)
        If CheckDataSet(DsTrxnHeader) Then

            Rate = DbNullToDecimal(DsTrxnHeader.Tables(0).Rows(i).Item(36))
            If Rate = 0 Then
                Rate = 1
            End If
            Dim S As String = Format(ChequeDate.Date, "yyyy/MM/dd")
            Dim Y1 As String = S.Substring(0, 1)
            Dim Y2 As String = S.Substring(1, 1)
            Dim Y3 As String = S.Substring(2, 1)
            Dim Y4 As String = S.Substring(3, 1)
            Dim M1 As String = S.Substring(5, 1)
            Dim M2 As String = S.Substring(6, 1)
            Dim D1 As String = S.Substring(8, 1)
            Dim D2 As String = S.Substring(9, 1)


            DsTrxnHeader.Tables(0).Rows(i).Item("Y1") = Y1
            DsTrxnHeader.Tables(0).Rows(i).Item("Y2") = Y2
            DsTrxnHeader.Tables(0).Rows(i).Item("Y3") = Y3
            DsTrxnHeader.Tables(0).Rows(i).Item("Y4") = Y4
            DsTrxnHeader.Tables(0).Rows(i).Item("M1") = M1
            DsTrxnHeader.Tables(0).Rows(i).Item("M2") = M2
            DsTrxnHeader.Tables(0).Rows(i).Item("D1") = D1
            DsTrxnHeader.Tables(0).Rows(i).Item("D2") = D2

            DsTrxnHeader.Tables(0).Rows(i).Item("ApprovedBy") = Global1.PARAM_Payslip_ApprovedBy
            DsTrxnHeader.Tables(0).Rows(i).Item("PreparedBy") = Global1.PARAM_Payslip_PreparedBy


            Dim NetSalary As Double
            If PrintInCurrency Then
                NetSalary = Format(DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_NetSalary") * (1 / Rate), "0.00")

            Else
                NetSalary = Format(DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_NetSalary"), "0.00")
            End If

            Dim Epidoma As Double = 0
            If Global1.PARAM_RemoveE37 Then
                Epidoma = Global1.Business.Get_EARNING_VALUE_FromTrxnLines_For_HeaderID(Hdr.Id, "E37")
                NetSalary = RoundMe2(NetSalary - Epidoma, 2)
                DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_NetSalary") = NetSalary
            End If

            Dim Ar() As String
            Dim Net As String
            Net = Format(NetSalary, "0.00")
            Ar = Net.Split(".")

            DsTrxnHeader.Tables(0).Rows(i).Item("Net1") = Ar(0)
            DsTrxnHeader.Tables(0).Rows(i).Item("Net2") = Ar(1)


            Dim Amount1 As String
            Amount1 = NumToWords(CInt(Ar(0)))
            Amount1 = UCase(Amount1) & " EURO "

            Dim Amount2 As String
            Amount2 = NumToWords(CInt(Ar(1)))
            Amount2 = " AND " & UCase(Amount2) & " CENTS"

            DsTrxnHeader.Tables(0).Rows(i).Item("TAmount") = Amount1 & Amount2


            Dim HourlyRate As Double
            Dim MonthlySalary As Double = DbNullToDouble(DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_MonthlySalary"))
            Dim BasisOnsalary As Double = DbNullToDouble(DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_BasisOnSalary"))

            MonthlySalary = MonthlySalary + BasisOnsalary
            DsTrxnHeader.Tables(0).Rows(i).Item("TrxHdr_MonthlySalary") = MonthlySalary
            '''''

            If Emp.PayUni_Code = Global1.GLB_Units_Hourly_Code Then
                'Hourly
                HourlyRate = MonthlySalary

            ElseIf Emp.PayUni_Code = Global1.GLB_Units_Period_Code Then
                Dim PeriodUnits As Double = 0
                If Emp.PeriodUnits = 0 Then
                    Dim Prd As New cPrMsPeriodCodes(Hdr.PrdCod_Code, Hdr.PrdGrp_Code)
                    PeriodUnits = Prd.PeriodUnits
                Else
                    PeriodUnits = Emp.PeriodUnits
                End If

                HourlyRate = RoundMe2(MonthlySalary / PeriodUnits, 2)
            End If



            '''''
            DsTrxnHeader.Tables(0).Rows(i).Item("HourlyRate") = HourlyRate

            Dim Department As String
            Dim Position As String
            Department = DsTrxnHeader.Tables(0).Rows(i).Item(49)
            Position = DsTrxnHeader.Tables(0).Rows(i).Item(50)
            Dim Anl2 As New cPrAnEmployeeAnalysis2(Department)
            Department = Anl2.DescriptionL
            Dim Pos As New cPrAnEmployeePositions(Position)
            Position = Pos.DescriptionL
            If Global1.PARAM_ShowAnalysis3onPayslip Then
                Department = Hdr.A3
                Dim Anl3 As New cPrAnEmployeeAnalysis3(Department)
                Department = Anl3.DescriptionL
            End If

            If CheckDataSet(DsEmp) Then
                ds.Tables(0).Rows(0).Item(12) = Department
                ds.Tables(0).Rows(0).Item(13) = Position
                ds.Tables(0).Rows(0).Item(43) = Anl2.Code
            End If
            Dim NetInDollar As Decimal = 0.0
            Dim DollarRate As Double = Global1.PARAM_USDRate

            NetInDollar = RoundMe2(NetSalary * Global1.PARAM_USDRate, 2)

            DsTrxnHeader.Tables(0).Rows(i).Item("SalUSD") = NetInDollar
            DsTrxnHeader.Tables(0).Rows(i).Item("RateUSD") = DollarRate

            If Global1.PARAM_AddBIKOnEarnings Then
                Dim DsBik1 As DataSet
                Dim DsBik2 As DataSet
                Dim BIKPeriod As Double = 0
                Dim BIKYTD As Double = 0
                DsBik1 = FindBenefitsInKindTotalFor_Template_PeriodCode_Employee(Hdr.TemGrpCode, Hdr.PrdCod_Code, Hdr.Emp_Code)
                DsBik2 = FindBenefitsInKindTotalFor_Template_PeriodGroup_Employee(Hdr.TemGrpCode, Hdr.PrdGrp_Code, Hdr.Emp_Code, Hdr.PrdCod_Code)
                If CheckDataSet(DsBik1) Then
                    BIKPeriod = DbNullToDouble(DsBik1.Tables(0).Rows(0).Item(0))
                End If
                If CheckDataSet(DsBik2) Then
                    BIKYTD = DbNullToDouble(DsBik2.Tables(0).Rows(0).Item(0))
                End If
                Dim TEarn As Double = DbNullToDouble(DsTrxnHeader.Tables(0).Rows(0).Item(3))
                Dim TEarnYTD As Double = DbNullToDouble(DsTrxnHeader.Tables(0).Rows(0).Item(4))

                TEarn = TEarn + BIKPeriod
                TEarnYTD = TEarnYTD + BIKYTD

                DsTrxnHeader.Tables(0).Rows(0).Item(3) = TEarn
                DsTrxnHeader.Tables(0).Rows(0).Item(4) = TEarnYTD
            End If
        End If

        ds.Tables.Add(DsTrxnHeader.Tables(0).Copy)
        ds.Tables(2).TableName = "Header"


        Dim DsPeriods As DataSet
        Dim lastId As Integer
        DsPeriods = GetAllPrMsPeriodsByPeriodGroup(Per.PrdGrpCode)
        If CheckDataSet(DsPeriods) Then
            Dim tPerCode As String
            For i = 0 To DsPeriods.Tables(0).Rows.Count - 1
                tPerCode = DbNullToString(DsPeriods.Tables(0).Rows(i).Item(0))
                Dim DsPX As DataSet
                DsPX = GetEDCinLineForPayslipTOTALS(Emp.Code, tPerCode, Per.PrdGrpCode)
                ds.Tables.Add(DsPX.Tables(0).Copy)
                ds.Tables(i + 3).TableName = "EDC_" & i + 1
                lastId = i + 3
            Next
        End If
        lastId = lastId + 1
        Dim lasthh As Integer
        If CheckDataSet(DsPeriods) Then
            Dim tPerCode As String
            For i = 0 To DsPeriods.Tables(0).Rows.Count - 1
                tPerCode = DbNullToString(DsPeriods.Tables(0).Rows(i).Item(0))
                Dim DsHX As DataSet
                DsHX = GetHeaderInfoForPayslipAllMonthsTOTALS(Emp.Code, tPerCode, Per.PrdGrpCode)
                ds.Tables.Add(DsHX.Tables(0).Copy)
                ds.Tables(i + lastId).TableName = "Head_" & i + 1
                lasthh = i + lastId
            Next
        End If


        Return ds

    End Function
    Public Shadows Function GetTypeOfEDCIfPercentage(TemplateCode As String) As DataSet
        Dim Str As String
        Str = "select erncod_code from PrMsTemplateEarnings where temern_typemode='P' and TemGrp_Code = " & enQuoteString(TemplateCode) &
        " union " &
        " select dedcod_code from PrMsTemplatedeductions where temded_typemode='P' and TemGrp_Code =" & enQuoteString(TemplateCode) &
        " union " &
        " select concod_code from PrMsTemplatecontributions where temcon_typemode='P' and TemGrp_Code =" & enQuoteString(TemplateCode)

        Return GetData(Str)
    End Function
    Public Function GetEDCinLineForPayslip(EmpCode As String, PerCode As String, PerGroup As String) As DataSet
        Dim Str As String
        Str = " select trxlin_id,trxlin_type,erncod_code,TrxLin_EDCDescription ,trxlin_edc,trxlin_periodvalue,trxlin_YTDValue from PrTxTrxnLines " &
              " where trxlin_type ='E'  " &
              " And trxhdr_id in (Select Trxhdr_id from PrTxTrxnHeader where emp_code=" & enQuoteString(EmpCode) & " and PrdCod_Code =" & enQuoteString(PerCode) & " and PrdGrp_Code=" & enQuoteString(PerGroup) & " and Trxhdr_status<>'PREP'" & ") " &
              " union " &
              " Select trxlin_id,trxlin_type,dedcod_code,TrxLin_EDCDescription ,trxlin_edc,trxlin_periodvalue,trxlin_YTDValue  from PrTxTrxnLines  " &
              " where trxlin_type ='D' " &
              " And trxhdr_id in (Select Trxhdr_id from PrTxTrxnHeader where emp_code=" & enQuoteString(EmpCode) & " and PrdCod_Code =" & enQuoteString(PerCode) & " and PrdGrp_Code=" & enQuoteString(PerGroup) & " and Trxhdr_status<>'PREP'" & ") " &
              " union " &
              " Select trxlin_id,trxlin_type,concod_code,TrxLin_EDCDescription ,trxlin_edc,trxlin_periodvalue,trxlin_YTDValue  from PrTxTrxnLines " &
              " where trxlin_type ='C' " &
              " And trxhdr_id in (Select Trxhdr_id from PrTxTrxnHeader where emp_code=" & enQuoteString(EmpCode) & " and PrdCod_Code =" & enQuoteString(PerCode) & " and PrdGrp_Code=" & enQuoteString(PerGroup) & " and Trxhdr_status<>'PREP'" & ") " &
              " order by TrxLin_Id  "
        Return GetData(Str)
    End Function
    Public Function GetHeaderInfoForPayslipAllMonths(EmpCode As String, PerCode As String, PerGroup As String) As DataSet
        Dim Str As String
        Str = "SELECT TrxHdr_Id, " &
            " TrxHdr_TotalErnPeriod, " &
            " TrxHdr_TotalDedPeriod,  " &
            " TrxHdr_TotalConPeriod, " &
            " TrxHdr_NetSalary, " &
            " TrxHdr_Year,  " &
            " TrxHdr_BIK_GesiC, " &
            " PrdGrp_Code,  " &
            " PrdCod_Code," &
            " TrxHdr_TotalErnYTD, " &
            " TrxHdr_TotalDedYTD,  " &
            " TrxHdr_TotalConYTD, " &
            " 0.00 as PeriodTotaltoSI, " &
            " 0.00 as PeriodTotaltoIR, " &
            " 0.00 as YTDTotaltoSI, " &
            " 0.00 as YTDTotaltoIR " &
            " FROM PrTxTrxnHeader " &
            " where emp_code = " & enQuoteString(EmpCode) &
            " and PrdGrp_Code = " & enQuoteString(PerGroup) &
            " and PrdCod_Code = " & enQuoteString(PerCode) &
            " and Trxhdr_status<>'PREP' "
        Return GetData(Str)
    End Function
    Public Function GetEDCinLineForPayslipTOTALS(EmpCode As String, PerCode As String, PerGroup As String) As DataSet
        Dim Str As String
        Str = " select trxlin_id,trxlin_type,erncod_code,TrxLin_EDCDescription ,sum(trxlin_edc),sum(trxlin_periodvalue),sum(trxlin_YTDValue) from PrTxTrxnLines " &
              " where trxlin_type ='E'  " &
              " And trxhdr_id in (Select Trxhdr_id from PrTxTrxnHeader where PrdCod_Code =" & enQuoteString(PerCode) & " and PrdGrp_Code=" & enQuoteString(PerGroup) & " and Trxhdr_status<>'PREP'" & ") " &
              " Group By " &
              " trxlin_id,trxlin_type,erncod_code,TrxLin_EDCDescription " &
              " union " &
              " Select trxlin_id,trxlin_type,dedcod_code,TrxLin_EDCDescription ,sum(trxlin_edc),sum(trxlin_periodvalue),sum(trxlin_YTDValue)  from PrTxTrxnLines  " &
              " where trxlin_type ='D' " &
              " And trxhdr_id in (Select Trxhdr_id from PrTxTrxnHeader where PrdCod_Code =" & enQuoteString(PerCode) & " and PrdGrp_Code=" & enQuoteString(PerGroup) & " and Trxhdr_status<>'PREP'" & ") " &
              " Group By " &
              " trxlin_id,trxlin_type,dedcod_code,TrxLin_EDCDescription " &
              " union " &
              " Select trxlin_id,trxlin_type,concod_code,TrxLin_EDCDescription ,sum(trxlin_edc),sum(trxlin_periodvalue),sum(trxlin_YTDValue)  from PrTxTrxnLines " &
              " where trxlin_type ='C' " &
              " And trxhdr_id in (Select Trxhdr_id from PrTxTrxnHeader where PrdCod_Code =" & enQuoteString(PerCode) & " and PrdGrp_Code=" & enQuoteString(PerGroup) & " and Trxhdr_status<>'PREP'" & ") " &
              " Group By " &
              " trxlin_id,trxlin_type,concod_code,TrxLin_EDCDescription " &
              " order by TrxLin_Id  "
        Return GetData(Str)
    End Function
    Public Function GetHeaderInfoForPayslipAllMonthsTOTALS(EmpCode As String, PerCode As String, PerGroup As String) As DataSet
        Dim Str As String
        Str = "SELECT sum(0.00) as TrxHdrId, " &
            " sum(TrxHdr_TotalErnPeriod), " &
            " sum(TrxHdr_TotalDedPeriod),  " &
            " sum(TrxHdr_TotalConPeriod), " &
            " sum(TrxHdr_NetSalary), " &
            " TrxHdr_Year,  " &
            " sum(TrxHdr_BIK_GesiC), " &
            " PrdGrp_Code,  " &
            " PrdCod_Code," &
            " sum(TrxHdr_TotalErnYTD), " &
            " sum(TrxHdr_TotalDedYTD),  " &
            " sum(TrxHdr_TotalConYTD), " &
            " sum(0.00) as PeriodTotaltoSI, " &
            " sum(0.00) as PeriodTotaltoIR, " &
            " sum(0.00) as YTDTotaltoSI, " &
            " sum(0.00) as YTDTotaltoIR " &
            " FROM PrTxTrxnHeader " &
            " where PrdGrp_Code = " & enQuoteString(PerGroup) &
            " and PrdCod_Code = " & enQuoteString(PerCode) &
            " and Trxhdr_status<>'PREP' " &
            " Group by " &
            " TrxHdr_Year, PrdGrp_Code,  PrdCod_Code"


        Return GetData(Str)
    End Function

    Protected Function GetCompanyDetailsForShowTotalsAsPayslipReport(ByVal CompanyCode As String) As DataSet
        Dim Ds As DataSet
        Dim Str As String
        Str = " Select Com_Name, " & _
            " Com_TIC," & _
            " Com_Address1," & _
            " Com_Address2," & _
            " Com_Address3," & _
            " Com_Address4," & _
            " Com_Tel1," & _
            " Com_Logo," & _
            " Com_Stamp " & _
            " FROM AdMsCompany where com_code=" & enQuoteString(CompanyCode)
        Ds = GetData(Str)
        Return Ds
    End Function
    Protected Function GetEmployeeTimesheets(ByVal EmpCode As String, ByVal TemGroup As String, ByVal PerGroup As String, ByVal PerCode As String) As DataSet
        Dim Str As String
        Str = " Select Tms_Id, " & _
            " Emp_Code, " & _
            " TemGrp_Code, " & _
            " PrdGrp_Code, " & _
            " PrdCod_Code, " & _
            " Tms_Date, " & _
            " Tms_In1, " & _
            " Tms_Out1, " & _
            " Tms_In2, " & _
            " Tms_Out2,  " & _
            " Tms_In3, " & _
            " Tms_Out3,  " & _
            " Tms_TotalWorkPerDay,  " & _
            " Tms_TotalWorkPerWeek, " & _
            " Tms_TotalWorkPerMonth, " & _
            " Tms_ALHours, " & _
            " Tms_SickHours, " & _
            " Tms_ArmyHours, " & _
            " Tms_MaterHours,  " & _
             " Tms_NormalDayHours,  " & _
            " Tms_DayDiff,  " & _
            " Tms_MonthDiff,  " & _
            " Tms_TotalMonthNormal,  " & _
            " Tms_FromFile, " & _
            " Tms_BusTrip, " & _
            " Tms_FamDeath, " & _
            " Tms_Study, " & _
            " Tms_WFH, " & _
            " Tms_TotalMAL,  " & _
            " Tms_TotalMSic,  " & _
            " Tms_TotalMArmy,  " & _
            " Tms_TotalMMat  " & _
            " FROM PrTxTimeSheets " & _
            " WHERE Emp_Code= " & enQuoteString(EmpCode) & _
            " And TemGrp_Code= " & enQuoteString(TemGroup) & _
            " And PrdGrp_Code= " & enQuoteString(PerGroup) & _
            " And PrdCod_Code= " & enQuoteString(PerCode) & _
            " Order by Tms_Date Asc"

        Return MyBase.GetData(Str)

    End Function

    Protected Function GetTimesheets(ByVal TemGroup As String, ByVal PerGroup As String, ByVal PerCode As String) As DataSet
        Dim Str As String
        Str = " Select Tms_Id, " & _
            " Emp_Code, " & _
            " TemGrp_Code, " & _
            " PrdGrp_Code, " & _
            " PrdCod_Code, " & _
            " Tms_Date, " & _
            " Tms_In1, " & _
            " Tms_Out1, " & _
            " Tms_In2, " & _
            " Tms_Out2,  " & _
            " Tms_In3, " & _
            " Tms_Out3,  " & _
            " Tms_TotalWorkPerDay,  " & _
            " Tms_TotalWorkPerWeek, " & _
            " Tms_TotalWorkPerMonth, " & _
            " Tms_ALHours, " & _
            " Tms_SickHours, " & _
            " Tms_ArmyHours, " & _
            " Tms_MaterHours,  " & _
             " Tms_NormalDayHours,  " & _
            " Tms_DayDiff,  " & _
            " Tms_MonthDiff,  " & _
            " Tms_TotalMonthNormal,  " & _
            " Tms_FromFile,  " & _
            " Tms_BusTrip, " & _
            " Tms_FamDeath, " & _
            " Tms_Study, " & _
            " Tms_WFH, " & _
            " Tms_TotalMAL,  " & _
            " Tms_TotalMSic,  " & _
            " Tms_TotalMArmy,  " & _
            " Tms_TotalMMat  " & _
            " FROM PrTxTimeSheets " & _
            " WHERE " & _
            " TemGrp_Code= " & enQuoteString(TemGroup) & _
            " And PrdGrp_Code= " & enQuoteString(PerGroup) & _
            " And PrdCod_Code= " & enQuoteString(PerCode) & _
            " Order by Emp_Code,Tms_Date Asc"

        Return MyBase.GetData(Str)

    End Function

    Protected Function DeleteEmployeeTimesheets(ByVal TemGroup As String, ByVal PerGroup As String, ByVal PerCode As String) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = " Delete from PrTxTimeSheets  " & _
             " WHERE  TemGrp_Code= " & enQuoteString(TemGroup) & _
            " And PrdGrp_Code= " & enQuoteString(PerGroup) & _
            " And PrdCod_Code= " & enQuoteString(PerCode)

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        Else
            F = False
        End If
        Return F

    End Function
    Protected Function UpdateEmployeeTimesheets(ByVal EmpCode As String, ByVal TemGroup As String, ByVal PerGroup As String, ByVal PerCode As String, ByVal MonthDiff As String, ByVal TotalMonthNormal As String, ByVal TotalAL As String, ByVal TotalSick As String, ByVal TotalArmy As String, ByVal TotalMater As String) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = " Update PrTxTimeSheets  " & _
        " Set Tms_MonthDiff = " & enQuoteString(MonthDiff) & _
        ",TMS_totalMonthNormal = " & enQuoteString(TotalMonthNormal) & _
        ",TMS_totalMal = " & enQuoteString(TotalAL) & _
        ",Tms_TotalMSic = " & enQuoteString(TotalSick) & _
        ",TMS_totalMarmy = " & enQuoteString(TotalArmy) & _
        ",Tms_TotalMMat = " & enQuoteString(TotalMater) & _
             " WHERE  Emp_Code = " & enQuoteString(EmpCode) & _
            " And TemGrp_Code = " & enQuoteString(TemGroup) & _
            " And PrdGrp_Code= " & enQuoteString(PerGroup) & _
            " And PrdCod_Code= " & enQuoteString(PerCode)

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        Else
            F = False
        End If
        Return F

    End Function

    
   

    Protected Function NumToWords(ByVal N As Integer) As String
        Dim Str As String
        Dim Minus As String = ""
        Dim Answer As String = ""
        If N < 0 Then
            Minus = "Minus "
            N = Math.Abs(N)
        End If
        Str = "Select dbo.udf_num_towords(" & N & ")"
        Dim ds As DataSet
        ds = GetData(Str)
        Answer = ds.Tables(0).Rows(0).Item(0)
        Answer = Minus & Answer
        Return Answer

    End Function
    Protected Function GetDalaryDiference(ByVal EmpCode As String, ByVal DatePay As Date) As DataSet
        Dim Sdatepay As String = Format(DatePay, "yyyy-MM-dd")
        Sdatepay = Utils.ChangeDateFormatForSearch(Sdatepay)
        Dim Str As String
        Str = " Select empsal_value from prtxemployeesalary " & _
            " where emp_code=" & enQuoteString(EmpCode) & _
            " And empsal_effpaydate<" & enQuoteString(Sdatepay) & _
            " order by empsal_effpaydate desc"

        Return GetData(Str)

    End Function

        'Protected Function REPORT_PrepareSIContributions(ByVal Per As cPrMsPeriodCodes, ByVal TemGrp As cPrMsTemplateGroup) As DataSet
    Protected Function REPORT_PrepareSIContributions(ByVal Per As cPrMsPeriodCodes, ByVal TemGrp As cPrMsTemplateGroup, ByVal SocInsCat As cPrAnSocialInsCategories, ByVal SocialInsPeriod As cPrSsSocialInsPeriods, ByVal PerGrp As cPrMsPeriodGroups) As DataSet

        Dim Ds As New DataSet
        Dim Col_EmpName As Integer = 0
        Dim Col_ICno As Integer = 1
        Dim Col_SINo As Integer = 2
        Dim Col_AlienNo As Integer = 3
        Dim Col_EmpP As Integer = 4
        Dim Col_Earnings As Integer = 5
        Dim Col_Insurable As Integer = 6
        Dim Col_SiLeave As Integer = 7
        Dim Col_SI As Integer = 8
        Dim Col_ST As Integer = 9
        Dim Col_IndUne As Integer = 10
        Dim Col_WeekHol As Integer = 11
        Dim Col_TermDate As Integer = 12

        Dim j As Integer

        Dim T_InsEarn As Double = 0
        Dim T_Gross As Double = 0


        Dim dt As New DataTable

        dt = New DataTable("Employee")
        '0
        dt.Columns.Add(New DataColumn("EmpName", System.Type.GetType("System.String")))
        '1
        dt.Columns.Add(New DataColumn("EmpICNo", System.Type.GetType("System.String")))
        '2
        dt.Columns.Add(New DataColumn("EmpS.I.No", System.Type.GetType("System.String")))
        '3
        dt.Columns.Add(New DataColumn("EmpAlienNo", System.Type.GetType("System.String")))
        '4
        dt.Columns.Add(New DataColumn("EmpP", System.Type.GetType("System.String")))
        '5
        dt.Columns.Add(New DataColumn("Earnings", System.Type.GetType("System.Double")))
        '6
        dt.Columns.Add(New DataColumn("Insurable", System.Type.GetType("System.Double")))
        '7
        dt.Columns.Add(New DataColumn("SILeave", System.Type.GetType("System.Double")))
        '8
        dt.Columns.Add(New DataColumn("SI", System.Type.GetType("System.Double")))
        '9
        dt.Columns.Add(New DataColumn("SocialTax", System.Type.GetType("System.Double")))
        '10
        dt.Columns.Add(New DataColumn("IND_Une", System.Type.GetType("System.Double")))
        '11
        dt.Columns.Add(New DataColumn("WeekHol", System.Type.GetType("System.String")))
        '12
        dt.Columns.Add(New DataColumn("TermDate", System.Type.GetType("System.String")))

        Ds.Tables.Add(dt)

        Dim dt2 As New DataTable

        dt2 = New DataTable("EmployeeDetails")
        '0
        dt2.Columns.Add(New DataColumn("TotalEmp", System.Type.GetType("System.String")))
        '1
        dt2.Columns.Add(New DataColumn("NewEmp", System.Type.GetType("System.String")))
        '2
        dt2.Columns.Add(New DataColumn("StopEmp", System.Type.GetType("System.String")))
        '3
        dt2.Columns.Add(New DataColumn("T_Gross", System.Type.GetType("System.Double")))
        '4
        dt2.Columns.Add(New DataColumn("T_Insurable", System.Type.GetType("System.Double")))
        '5
        dt2.Columns.Add(New DataColumn("T_SI", System.Type.GetType("System.Double")))
        '6
        dt2.Columns.Add(New DataColumn("T_SIL", System.Type.GetType("System.Double")))
        '7
        dt2.Columns.Add(New DataColumn("T_Une", System.Type.GetType("System.Double")))
        '8
        dt2.Columns.Add(New DataColumn("T_Ind", System.Type.GetType("System.Double")))
        '9
        dt2.Columns.Add(New DataColumn("T_SCoh", System.Type.GetType("System.Double")))
        '10
        dt2.Columns.Add(New DataColumn("T_Grand", System.Type.GetType("System.Double")))
        '11
        dt2.Columns.Add(New DataColumn("PeriodCat", System.Type.GetType("System.String")))
        '12
        dt2.Columns.Add(New DataColumn("EmpCat", System.Type.GetType("System.String")))
        '13
        dt2.Columns.Add(New DataColumn("PeriodDesc", System.Type.GetType("System.String")))




        'Dim PerGrp As New cPrMsPeriodGroups(Per.PrdGrpCode)
        Dim Str As String = ""
        Dim Str2X As String = ""
        Dim Str3X As String = ""
        Dim Str4 As String = ""

        Str = " Select TemGrp_Code from PrMsTemplateGroup" & _
              " Where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Dim DsT As DataSet
        Dim DsPG As DataSet

        DsT = GetData(Str)

        If CheckDataSet(DsT) Then
            Dim Code As String
            Dim z As Integer
            Dim PeriodGroupCode As String = ""
            For z = 0 To DsT.Tables(0).Rows.Count - 1
                Code = DbNullToString(DsT.Tables(0).Rows(z).Item(0))
                Str = "Select PRDGRP_CODE FROM PRMSPERIODGROUPS" & _
                      " WHERE TEMGRP_CODE=" & enQuoteString(Code) & _
                " And PrdGpr_Year=" & enQuoteString(Per.DateFrom.Year)
                DsPG = GetData(Str)
                If CheckDataSet(DsPG) Then
                    PeriodGroupCode = DbNullToString(DsPG.Tables(0).Rows(0).Item(0))
                End If

                If z = 0 Then
                    Str2X = " (PrMsEmployees.TemGrp_Code = " & enQuoteString(Code) & ")"
                    Str3X = " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
                Else
                    Str2X = Str2X & " Or  (PrMsEmployees.TemGrp_Code = " & enQuoteString(Code) & ")"
                    Str3X = Str3X & " Or (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
                End If
            Next
            Str2X = "And (" & Str2X & ")"
            Str3X = "And (" & Str3X & ")"



        End If


        Dim StrSIPer As String
        Dim StrAllPeriodGroups As String
        StrAllPeriodGroups = Str3X.Replace("PrTxTrxnHeader", "PrMsPeriodCodes")

        StrSIPer = "Select PrMsPeriodCodes.PrdCod_Code" & _
            " FROM  PrMsPeriodGroups INNER JOIN" & _
            " PrMsPeriodCodes On " & _
            " PrMsPeriodGroups.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
            " WHERE (PrMsPeriodCodes.SinPrd_Code = " & enQuoteString(SocialInsPeriod.Code) & ") "
        StrSIPer = StrSIPer & StrAllPeriodGroups

        Dim dsHdr As DataSet
        Str = " Select PrTxTrxnHeader.Emp_Code," & _
             " sum(PrTxTrxnHeader.TrxHdr_TotalErnPeriod)," & _
             " sum(PrTxTrxnHeader.TrxHdr_PeriodInsurable)" & _
             " FROM  PrTxTrxnHeader INNER JOIN" & _
             " PrMsEmployees On PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
             " WHERE  (PrMsEmployees.Sic_Code=" & enQuoteString(SocInsCat.Code) & ")" & _
            " And (PrTxTrxnHeader.PrdCod_Code In ("

        Str = Str & StrSIPer & "))"


        Str4 = "GROUP BY PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_IdentificationCard," & _
        " PrMsEmployees.Emp_SocialInsNumber" & _
        " ORDER BY  PrMsEmployees.Emp_IdentificationCard," & _
        " PrMsEmployees.Emp_SocialInsNumber," & _
        " PrTxTrxnHeader.Emp_Code"

        Str = Str & Str2X & Str3X & Str4

        Dim DsNewEmp As DataSet
        Dim DateFrom As Date
        Dim DateTo As Date
        Dim DsPeriods As DataSet
        Dim PeriodTemp As New cPrMsPeriodCodes
        Dim StrNew As String

        StrNew = "Select PrdCod_code FROM PrMsPeriodCodes " & _
        " WHERE PrdGrp_Code=" & enQuoteString(PerGrp.Code) & _
        " And SinPrd_Code=" & SocialInsPeriod.Code
        DsPeriods = GetData(StrNew)

        PeriodTemp = FindSocialInsCategoryDate(DsPeriods, PerGrp)


        StrNew = "Select PrMsEmployees.Emp_Code " & _
            " FROM PrMsEmployees INNER JOIN" & _
            " PrTxTrxnHeader On PrMsEmployees.Emp_Code = PrTxTrxnHeader.Emp_Code" & _
            " WHERE (PrMsEmployees.Emp_StartDate >= CONVERT(DATETIME, " & enQuoteString(Format(PeriodTemp.DateFrom, "yyyy-MM-dd")) & ", 102))" & _
            " And (PrMsEmployees.Emp_StartDate <= CONVERT(DATETIME," & enQuoteString(Format(PeriodTemp.DateTo, "yyyy-MM-dd")) & ", 102))" & _
            " And (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
            " And( PrMsEmployees.Sic_Code=" & enQuoteString(SocInsCat.Code) & ")" & _
            " GROUP  BY PrMsEmployees.Emp_Code "
        DsNewEmp = GetData(StrNew)

        dsHdr = GetData(Str)
        Dim companySINo As String = ""
        Dim Str2 As String
        Dim DsEmpSIErn As DataSet = GetERNFromTrxnLinesFor(StrSIPer, Str3X, "SI", SocInsCat, companySINo)
        Dim DsEmpSIDed As DataSet = GetDEDFromTrxnLinesFor(StrSIPer, Str3X, "SI", SocInsCat, companySINo)
        Dim DsEmpSICon As DataSet = GetCONFromTrxnLinesFor(StrSIPer, Str3X, "SI", SocInsCat, companySINo)
        Dim DsEmpSocTaxDed As DataSet = GetDEDFromTrxnLinesFor(StrSIPer, Str3X, "ST", SocInsCat, companySINo)
        Dim DsEmpSocTaxCon As DataSet = GetCONFromTrxnLinesFor(StrSIPer, Str3X, "ST", SocInsCat, companySINo)
        Dim DsEmpINDCon As DataSet = GetCONFromTrxnLinesFor(StrSIPer, Str3X, "In", SocInsCat, companySINo)
        Dim DsEmpUNECon As DataSet = GetCONFromTrxnLinesFor(StrSIPer, Str3X, "UN", SocInsCat, companySINo)
        Dim i As Integer
        Dim k As Integer
        Dim EmpCode As String = ""
        Dim ICNo As String = ""
        Dim SINo As String = ""
        Dim AlienNo As String = ""
        Dim EmpName As String = ""
        Dim GrossEarn As Double = 0
        Dim InsEarn As Double = 0
        Dim SILeave As Double = 0
        Dim SI As Double = 0
        Dim ST As Double = 0
        Dim IND As Double = 0
        Dim UNE As Double = 0
        Dim TermDate As String = ""
        Dim R As DataRow
        Dim TotalEmp As Integer
        Dim StartDate As Date
        Dim NewEmp As Integer
        Dim StopEmp As Integer
        Dim WeekHol As String
        For i = 0 To dsHdr.Tables(0).Rows.Count - 1
            SILeave = 0
            SI = 0
            ST = 0
            UNE = 0
            IND = 0
            WeekHol = ""

            EmpCode = DbNullToString(dsHdr.Tables(0).Rows(i).Item(0))
            Dim DsEmp As DataSet

            Str = " Select Emp_Code," & _
            " PayTyp_Code," & _
            " TemGrp_Code," & _
            " Emp_FullName," & _
            " Emp_SocialInsNumber," & _
            " Emp_IdentificationCard," & _
            " Emp_AlienNumber," & _
            " Emp_StartDate, " & _
            " Emp_TerminateDate," & _
            " SicCode," & _
            " Emp_PassportNumber " & _
            " FROM PrMsEmployees Where Emp_Code = " & enQuoteString(EmpCode)
            Str = Str & Str2

            DsEmp = GetData(Str)

            EmpName = DbNullToString(DsEmp.Tables(0).Rows(0).Item(3))
            SINo = DbNullToString(DsEmp.Tables(0).Rows(0).Item(4))
            ICNo = DbNullToString(DsEmp.Tables(0).Rows(0).Item(5))
            AlienNo = DbNullToString(DsEmp.Tables(0).Rows(0).Item(6))
            StartDate = DbNullToDate(DsEmp.Tables(0).Rows(0).Item(7))
            TermDate = DbNullToString(DsEmp.Tables(0).Rows(0).Item(8))

            If ICNo = "" Then
                ICNo = DbNullToString(DsEmp.Tables(0).Rows(0).Item(10))
            End If
            If ICNo = "" Then
                ICNo = AlienNo
            End If


            GrossEarn = DbNullToDouble(dsHdr.Tables(0).Rows(i).Item(1))
            InsEarn = DbNullToDouble(dsHdr.Tables(0).Rows(i).Item(2))
            T_Gross = T_Gross + GrossEarn
            T_InsEarn = T_InsEarn + InsEarn

            If CheckDataSet(DsEmpSIErn) Then
                For k = 0 To DsEmpSIErn.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSIErn.Tables(0).Rows(k).Item(0)) Then
                        SILeave = SILeave + DbNullToDouble(DsEmpSIErn.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpSIDed) Then
                For k = 0 To DsEmpSIDed.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSIDed.Tables(0).Rows(k).Item(0)) Then
                        SI = SI + DbNullToDouble(DsEmpSIDed.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpSICon) Then
                For k = 0 To DsEmpSICon.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSICon.Tables(0).Rows(k).Item(0)) Then
                        SI = SI + DbNullToDouble(DsEmpSICon.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpSocTaxDed) Then
                For k = 0 To DsEmpSocTaxDed.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSocTaxDed.Tables(0).Rows(k).Item(0)) Then
                        ST = ST + DbNullToDouble(DsEmpSocTaxDed.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpSocTaxCon) Then
                For k = 0 To DsEmpSocTaxCon.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSocTaxCon.Tables(0).Rows(k).Item(0)) Then
                        ST = ST + DbNullToDouble(DsEmpSocTaxCon.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpINDCon) Then
                For k = 0 To DsEmpINDCon.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpINDCon.Tables(0).Rows(k).Item(0)) Then
                        IND = IND + DbNullToDouble(DsEmpINDCon.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpUNECon) Then
                For k = 0 To DsEmpUNECon.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpUNECon.Tables(0).Rows(k).Item(0)) Then
                        UNE = UNE + DbNullToDouble(DsEmpUNECon.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If

            WeekHol = GetSILeave(EmpCode, PeriodTemp)

            R = dt.NewRow
            R(Col_EmpName) = EmpName
            R(Col_ICno) = ICNo
            R(Col_SINo) = SINo
            R(Col_AlienNo) = AlienNo
            R(Col_EmpP) = "M"
            R(Col_Earnings) = GrossEarn
            R(Col_Insurable) = InsEarn
            R(Col_SiLeave) = SILeave
            R(Col_SI) = SI
            R(Col_ST) = ST
            R(Col_IndUne) = IND + UNE
            R(Col_WeekHol) = WeekHol
            R(Col_TermDate) = TermDate
            dt.Rows.Add(R)

            TotalEmp = TotalEmp + 1

            If StartDate >= Per.DateFrom And StartDate <= Per.DateTo Then
                NewEmp = NewEmp + 1
            End If
            If TermDate <> "" Then
                Dim TD As Date
                TD = CDate(TermDate)
                If TD >= Per.DateFrom And TD <= Per.DateTo Then
                    StopEmp = StopEmp + 1
                End If
            End If
        Next
        Dim DsComp As DataSet
        DsComp = Me.GetAllCompaniesFullRow(TemGrp.CompanyCode)

        Ds.Tables.Add(DsComp.Tables(0).Copy)
        Ds.Tables(1).TableName = "Company"

        Dim DsPer As DataSet
        DsPer = Me.GetPeriodDetails(Per)

        Ds.Tables.Add(DsPer.Tables(0).Copy)
        Ds.Tables(2).TableName = "Period"



        R = dt2.NewRow

        Dim T_SIL As Double = 0
        Dim T_SI As Double = 0
        Dim T_IND As Double = 0
        Dim T_UNE As Double = 0
        Dim T_Grand As Double = 0
        Dim T_SCOH As Double = 0

        If CheckDataSet(DsEmpSIErn) Then
            For k = 0 To DsEmpSIErn.Tables(0).Rows.Count - 1
                T_SIL = T_SIL + DbNullToDouble(DsEmpSIErn.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpSIDed) Then
            For k = 0 To DsEmpSIDed.Tables(0).Rows.Count - 1
                T_SI = T_SI + DbNullToDouble(DsEmpSIDed.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpSICon) Then
            For k = 0 To DsEmpSICon.Tables(0).Rows.Count - 1
                T_SI = T_SI + DbNullToDouble(DsEmpSICon.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpINDCon) Then
            For k = 0 To DsEmpINDCon.Tables(0).Rows.Count - 1
                T_IND = T_IND + DbNullToDouble(DsEmpINDCon.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpUNECon) Then
            For k = 0 To DsEmpUNECon.Tables(0).Rows.Count - 1
                T_UNE = T_UNE + DbNullToDouble(DsEmpUNECon.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpSocTaxCon) Then
            For k = 0 To DsEmpSocTaxCon.Tables(0).Rows.Count - 1
                T_SCOH = T_SCOH + DbNullToDouble(DsEmpSocTaxCon.Tables(0).Rows(k).Item(2))
            Next
        End If

        Dim PayCat As New cPrSsPaymentCategory(Per.PayCat_Code)

        ''''
        T_Grand = T_SIL + T_SI + T_UNE + T_IND + T_SCOH

        R(0) = TotalEmp 'Total
        R(1) = NewEmp 'New
        R(2) = StopEmp 'Stoped
        R(3) = T_Gross
        R(4) = T_InsEarn
        R(5) = T_SI
        R(6) = T_SIL
        R(7) = T_UNE
        R(8) = T_IND
        R(9) = T_SCOH
        R(10) = T_Grand
        R(11) = PayCat.Code & "-" & PayCat.DescriptionL
        R(12) = SocInsCat.Code & "-" & SocInsCat.DescriptionL

        R(13) = PeriodTemp.DateFrom.Month & "/" & PeriodTemp.DateFrom.Year




        dt2.Rows.Add(R)

        Ds.Tables.Add(dt2)
        Str = "Select '' as Line1," & _
        " '' as Line2," & _
        " '' as Line3," & _
        " '' as Line4," & _
        " '' as Line5," & _
        " '' as Line6," & _
        " '' as Line7," & _
        " '' as Line8," & _
        " '' as Line9," & _
        " '' as Line10" & _
        " From adMsCompany where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Dim DsNew As DataSet
        DsNew = GetData(Str)
        If CheckDataSet(DsNewEmp) Then
            Dim Line As String
            Dim Emp As New cPrMsEmployees
            Dim S As String
            For i = 0 To DsNewEmp.Tables(0).Rows.Count - 1
                Line = ""
                S = ""
                Emp = New cPrMsEmployees(DbNullToString(DsNewEmp.Tables(0).Rows(0).Item(0)))
                With Emp
                    If .FullName.Length >= 30 Then
                        S = .FullName.Substring(0, 30)
                    Else
                        S = .FullName
                    End If
                    Line = Line & S.PadRight(30, " ")

                    S = .IdentificationCard.PadLeft(10, " ")
                    Line = Line & S

                    S = .SocialInsNumber.PadLeft(13, " ")
                    Line = Line & S

                    S = Format(.BirthDate, "dd-MM-yyyy").PadLeft(17, " ")
                    Line = Line & S

                    S = .Sex.PadLeft(6, " ")
                    Line = Line & S

                    S = .PayTyp_Code.Substring(0, 1).PadLeft(6, " ")
                    Line = Line & S
                    If .IsSI Then
                        S = "Y"
                    Else
                        S = "X"
                    End If
                    S = S.PadLeft(12, " ")
                    Line = Line & S

                    S = Format(.StartDate, "dd-MM-yyyy").PadLeft(13, " ")
                    Line = Line & S

                    Dim An As New cPrAnEmployeeAnalysis2(.EmpAn2_Code)
                    S = An.DescriptionS.PadLeft(22, " ")
                    Line = Line & S

                    DsNew.Tables(0).Rows(0).Item(i) = Line

                End With

            Next
        End If

        Ds.Tables.Add(DsNew.Tables(0).Copy)
        Ds.Tables(4).TableName = "DsNew"



        Return Ds
    End Function
    Protected Function REPORT_PrepareSIContributions_PerCompany(ByVal Per As cPrMsPeriodCodes, ByVal TemGrp As cPrMsTemplateGroup, ByVal SocInsCat As cPrAnSocialInsCategories, ByVal SocialInsPeriod As cPrSsSocialInsPeriods, ByVal PerGrp As cPrMsPeriodGroups, ByVal CompanySINo As String) As DataSet

        Dim Ds As New DataSet
        Dim Col_EmpName As Integer = 0
        Dim Col_ICno As Integer = 1
        Dim Col_SINo As Integer = 2
        Dim Col_AlienNo As Integer = 3
        Dim Col_EmpP As Integer = 4
        Dim Col_Earnings As Integer = 5
        Dim Col_Insurable As Integer = 6
        Dim Col_SiLeave As Integer = 7
        Dim Col_SI As Integer = 8
        Dim Col_ST As Integer = 9
        Dim Col_IndUne As Integer = 10
        Dim Col_WeekHol As Integer = 11
        Dim Col_TermDate As Integer = 12
        Dim Col_Gesiable As Integer = 13



        Dim j As Integer

        Dim T_InsEarn As Double = 0
        Dim T_Gross As Double = 0
        Dim T_GESYable As Double = 0


        Dim dt As New DataTable

        dt = New DataTable("Employee")
        '0
        dt.Columns.Add(New DataColumn("EmpName", System.Type.GetType("System.String")))
        '1
        dt.Columns.Add(New DataColumn("EmpICNo", System.Type.GetType("System.String")))
        '2
        dt.Columns.Add(New DataColumn("EmpS.I.No", System.Type.GetType("System.String")))
        '3
        dt.Columns.Add(New DataColumn("EmpAlienNo", System.Type.GetType("System.String")))
        '4
        dt.Columns.Add(New DataColumn("EmpP", System.Type.GetType("System.String")))
        '5
        dt.Columns.Add(New DataColumn("Earnings", System.Type.GetType("System.Double")))
        '6
        dt.Columns.Add(New DataColumn("Insurable", System.Type.GetType("System.Double")))
        '7
        dt.Columns.Add(New DataColumn("SILeave", System.Type.GetType("System.Double")))
        '8
        dt.Columns.Add(New DataColumn("SI", System.Type.GetType("System.Double")))
        '9
        dt.Columns.Add(New DataColumn("SocialTax", System.Type.GetType("System.Double")))
        '10
        dt.Columns.Add(New DataColumn("IND_Une", System.Type.GetType("System.Double")))
        '11
        dt.Columns.Add(New DataColumn("WeekHol", System.Type.GetType("System.String")))
        '12
        dt.Columns.Add(New DataColumn("TermDate", System.Type.GetType("System.String")))
        '13
        dt.Columns.Add(New DataColumn("Gesiable", System.Type.GetType("System.Double")))





        Ds.Tables.Add(dt)

        Dim dt2 As New DataTable

        dt2 = New DataTable("EmployeeDetails")
        '0
        dt2.Columns.Add(New DataColumn("TotalEmp", System.Type.GetType("System.String")))
        '1
        dt2.Columns.Add(New DataColumn("NewEmp", System.Type.GetType("System.String")))
        '2
        dt2.Columns.Add(New DataColumn("StopEmp", System.Type.GetType("System.String")))
        '3
        dt2.Columns.Add(New DataColumn("T_Gross", System.Type.GetType("System.Double")))
        '4
        dt2.Columns.Add(New DataColumn("T_Insurable", System.Type.GetType("System.Double")))
        '5
        dt2.Columns.Add(New DataColumn("T_SI", System.Type.GetType("System.Double")))
        '6
        dt2.Columns.Add(New DataColumn("T_SIL", System.Type.GetType("System.Double")))
        '7
        dt2.Columns.Add(New DataColumn("T_Une", System.Type.GetType("System.Double")))
        '8
        dt2.Columns.Add(New DataColumn("T_Ind", System.Type.GetType("System.Double")))
        '9
        dt2.Columns.Add(New DataColumn("T_SCoh", System.Type.GetType("System.Double")))
        '10
        dt2.Columns.Add(New DataColumn("T_Grand", System.Type.GetType("System.Double")))
        '11
        dt2.Columns.Add(New DataColumn("PeriodCat", System.Type.GetType("System.String")))
        '12
        dt2.Columns.Add(New DataColumn("EmpCat", System.Type.GetType("System.String")))
        '13
        dt2.Columns.Add(New DataColumn("PeriodDesc", System.Type.GetType("System.String")))
        '14
        dt2.Columns.Add(New DataColumn("T_Gesiable", System.Type.GetType("System.Double")))
        '15
        dt2.Columns.Add(New DataColumn("T_SGesi", System.Type.GetType("System.Double")))

        '''
        Dim dt3 As New DataTable

        dt3 = New DataTable("NewEmp")
        '0
        dt3.Columns.Add(New DataColumn("Name", System.Type.GetType("System.String")))
        '1
        dt3.Columns.Add(New DataColumn("ID", System.Type.GetType("System.String")))
        '2
        dt3.Columns.Add(New DataColumn("SI", System.Type.GetType("System.String")))
        '3
        dt3.Columns.Add(New DataColumn("BDate", System.Type.GetType("System.String")))
        '4
        dt3.Columns.Add(New DataColumn("SEX", System.Type.GetType("System.String")))
        '5
        dt3.Columns.Add(New DataColumn("PayType", System.Type.GetType("System.String")))
        '6
        dt3.Columns.Add(New DataColumn("Is SI", System.Type.GetType("System.String")))
        '7
        dt3.Columns.Add(New DataColumn("StartDate", System.Type.GetType("System.String")))
        '8
        dt3.Columns.Add(New DataColumn("Possition", System.Type.GetType("System.String")))

        '8
        dt3.Columns.Add(New DataColumn("SicCode", System.Type.GetType("System.String")))
        '8

        'Dim PerGrp As New cPrMsPeriodGroups(Per.PrdGrpCode)
        Dim Str As String = ""
        Dim Str2X As String = ""
        Dim Str3X As String = ""
        Dim Str4 As String = ""

        Str = " Select TemGrp_Code from PrMsTemplateGroup" & _
              " Where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Dim DsT As DataSet
        Dim DsPG As DataSet

        DsT = GetData(Str)
     
        

        If CheckDataSet(DsT) Then
            Dim Code As String
            Dim z As Integer
            Dim PeriodGroupCode As String = ""

           
            For z = 0 To DsT.Tables(0).Rows.Count - 1


                Code = DbNullToString(DsT.Tables(0).Rows(z).Item(0))
                Str = "SELECT PRDGRP_CODE FROM PRMSPERIODGROUPS" & _
                      " WHERE TEMGRP_CODE=" & enQuoteString(Code) & _
                " AND PrdGpr_Year=" & enQuoteString(Per.DateFrom.Year)
                DsPG = GetData(Str)
                If CheckDataSet(DsPG) Then
                    PeriodGroupCode = DbNullToString(DsPG.Tables(0).Rows(0).Item(0))
                End If

                If z = 0 Then
                    Str2X = " (PrMsEmployees.TemGrp_Code = " & enQuoteString(Code) & ")"
                    Str3X = " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"

                Else
                    Str2X = Str2X & " OR  (PrMsEmployees.TemGrp_Code = " & enQuoteString(Code) & ")"
                    Str3X = Str3X & " OR (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"


                End If
            Next
            Str2X = "AND (" & Str2X & ")"
            Str3X = "AND (" & Str3X & ")"



        End If


        Dim StrSIPer As String
        Dim StrAllPeriodGroups As String
        StrAllPeriodGroups = Str3X.Replace("PrTxTrxnHeader", "PrMsPeriodCodes")

        StrSIPer = "SELECT PrMsPeriodCodes.PrdCod_Code " & _
            " FROM  PrMsPeriodGroups INNER JOIN" & _
            " PrMsPeriodCodes ON " & _
            " PrMsPeriodGroups.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
            " WHERE (PrMsPeriodCodes.SinPrd_Code = " & enQuoteString(SocialInsPeriod.Code) & ") "
        StrSIPer = StrSIPer & StrAllPeriodGroups


        Dim StrSIPer2 As String
        StrSIPer2 = "SELECT PrMsPeriodCodes.PrdCod_Code," & _
            " PrMsPeriodCodes.PrdGrp_Code" & _
            " FROM  PrMsPeriodGroups INNER JOIN" & _
            " PrMsPeriodCodes ON " & _
            " PrMsPeriodGroups.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
            " WHERE (PrMsPeriodCodes.SinPrd_Code = " & enQuoteString(SocialInsPeriod.Code) & ") "
        StrSIPer2 = StrSIPer2 & StrAllPeriodGroups








        Dim dsHdr As DataSet
        Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
             " sum(PrTxTrxnHeader.TrxHdr_TotalErnPeriod)," & _
             " sum(PrTxTrxnHeader.TrxHdr_PeriodInsurable)," & _
             " sum(PrTxTrxnHeader.TrxHdr_Gesiableamount)" & _
             " FROM  PrTxTrxnHeader INNER JOIN" & _
             " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
             " WHERE  (PrMsEmployees.Sic_Code=" & enQuoteString(SocInsCat.Code) & ")" & _
             " AND  (PrMsEmployees.ComSin_EmpSocialInsNo=" & enQuoteString(CompanySINo) & ")" & _
            " AND (PrTxTrxnHeader.PrdCod_Code IN ("

        Str = Str & StrSIPer & "))"


        Str4 = "GROUP BY PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_IdentificationCard," & _
        " PrMsEmployees.Emp_SocialInsNumber" & _
        " ORDER BY " & _
        " PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_IdentificationCard," & _
        " PrMsEmployees.Emp_SocialInsNumber"

        Dim Str5 As String = " AND PrTxTrxnHeader.TrxHdr_Status='PREP'"
        Dim Str6 As String
        Str6 = Str & Str2X & Str3X & Str5 & Str4
        Dim DsPrep As DataSet
        DsPrep = GetData(Str6)
        If CheckDataSet(DsPrep) Then
            MsgBox("There are Employees with Payroll Status 'PREPARED', Cannot proceed with S.I. Report", MsgBoxStyle.Critical)
            Cursor.Current = Cursors.Default
            Exit Function
        End If

        Str = Str & Str2X & Str3X & Str4

        Dim DsNewEmp As DataSet
        Dim DateFrom As Date
        Dim DateTo As Date
        Dim DsPeriods As DataSet
        Dim PeriodTemp As New cPrMsPeriodCodes
        Dim StrNew As String

        StrNew = "SELECT PrdCod_code FROM PrMsPeriodCodes " & _
        " WHERE PrdGrp_Code=" & enQuoteString(PerGrp.Code) & _
        " AND SinPrd_Code=" & SocialInsPeriod.Code
        DsPeriods = GetData(StrNew)

        PeriodTemp = FindSocialInsCategoryDate(DsPeriods, PerGrp)


        StrNew = "SELECT PrMsEmployees.Emp_Code " & _
            " FROM PrMsEmployees INNER JOIN" & _
            " PrTxTrxnHeader ON PrMsEmployees.Emp_Code = PrTxTrxnHeader.Emp_Code" & _
            " WHERE (PrMsEmployees.Emp_StartDate >= CONVERT(DATETIME, " & enQuoteString(Format(PeriodTemp.DateFrom, "yyyy-MM-dd")) & ", 102))" & _
            " AND (PrMsEmployees.Emp_StartDate <= CONVERT(DATETIME," & enQuoteString(Format(PeriodTemp.DateTo, "yyyy-MM-dd")) & ", 102))" & _
            " AND( PrMsEmployees.Sic_Code=" & enQuoteString(SocInsCat.Code) & ")" & _
            " AND  (PrMsEmployees.ComSin_EmpSocialInsNo=" & enQuoteString(CompanySINo) & ")"

        '" AND (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _

        StrNew = StrNew & Str3X & " GROUP  BY PrMsEmployees.Emp_Code "
        DsNewEmp = GetData(StrNew)


        dsHdr = GetData(Str)
        Dim Str2 As String
        Dim DsEmpSIErn As DataSet = GetERNFromTrxnLinesFor(StrSIPer, Str3X, "SI", SocInsCat, CompanySINo)
        Dim DsEmpSIDed As DataSet = GetDEDFromTrxnLinesFor(StrSIPer, Str3X, "SI", SocInsCat, CompanySINo)
        Dim DsEmpSICon As DataSet = GetCONFromTrxnLinesFor(StrSIPer, Str3X, "SI", SocInsCat, CompanySINo)
        Dim DsEmpSocTaxDed As DataSet = GetDEDFromTrxnLinesFor(StrSIPer, Str3X, "ST", SocInsCat, CompanySINo)
        Dim DsEmpSocTaxCon As DataSet = GetCONFromTrxnLinesFor(StrSIPer, Str3X, "ST", SocInsCat, CompanySINo)
        Dim DsEmpINDCon As DataSet = GetCONFromTrxnLinesFor(StrSIPer, Str3X, "IN", SocInsCat, CompanySINo)
        Dim DsEmpUNECon As DataSet = GetCONFromTrxnLinesFor(StrSIPer, Str3X, "UN", SocInsCat, CompanySINo)

        Dim DsEmpGESYDed As DataSet = GetDEDFromTrxnLinesFor(StrSIPer, Str3X, "GD", SocInsCat, CompanySINo)
        Dim DsEmpGESYCon As DataSet = GetCONFromTrxnLinesFor(StrSIPer, Str3X, "GC", SocInsCat, CompanySINo)






        Dim i As Integer
        Dim k As Integer
        Dim EmpCode As String = ""
        Dim ICNo As String = ""
        Dim SINo As String = ""
        Dim AlienNo As String = ""
        Dim EmpName As String = ""
        Dim GrossEarn As Double = 0
        Dim InsEarn As Double = 0
        Dim SILeave As Double = 0
        Dim SI As Double = 0
        Dim ST As Double = 0
        Dim IND As Double = 0
        Dim UNE As Double = 0
        Dim TermDate As String = ""
        Dim R As DataRow
        Dim TotalEmp As Integer
        Dim StartDate As Date
        Dim NewEmp As Integer
        Dim StopEmp As Integer
        Dim WeekHol As String

        Dim GESYD As Double = 0
        Dim GESYC As Double = 0
        Dim GESYableamount As Double = 0



        For i = 0 To dsHdr.Tables(0).Rows.Count - 1





            SILeave = 0
            SI = 0
            ST = 0
            UNE = 0
            IND = 0
            WeekHol = ""
            GESYD = 0
            GESYC = 0

            EmpCode = DbNullToString(dsHdr.Tables(0).Rows(i).Item(0))

            Dim DsEmp As DataSet

            Str = " SELECT Emp_Code," & _
            " PayTyp_Code," & _
            " TemGrp_Code," & _
            " Emp_FullName," & _
            " Emp_SocialInsNumber," & _
            " Emp_IdentificationCard," & _
            " Emp_AlienNumber," & _
            " Emp_StartDate, " & _
            " Emp_TerminateDate, " & _
            " Sic_code, " & _
            " Emp_PassportNumber " & _
            " FROM PrMsEmployees Where Emp_Code = " & enQuoteString(EmpCode) & _
            " Order By Emp_Code ASC "
            Str = Str & Str2

            DsEmp = GetData(Str)

            EmpName = DbNullToString(DsEmp.Tables(0).Rows(0).Item(3))
            SINo = DbNullToString(DsEmp.Tables(0).Rows(0).Item(4))
            ICNo = DbNullToString(DsEmp.Tables(0).Rows(0).Item(5))
            AlienNo = DbNullToString(DsEmp.Tables(0).Rows(0).Item(6))
            StartDate = DbNullToDate(DsEmp.Tables(0).Rows(0).Item(7))
            TermDate = DbNullToString(DsEmp.Tables(0).Rows(0).Item(8))

            If Trim(TermDate) <> "" Then
                If Per.PayCat_Code = "K" Then
                    If CDate(TermDate) < Per.DateFrom Or CDate(TermDate) > Per.DateTo Then
                        TermDate = ""
                    End If
                Else
                    TermDate = ""
                End If
            End If

            If ICNo = "" Then
                ICNo = DbNullToString(DsEmp.Tables(0).Rows(0).Item(10))
            End If
            If ICNo = "" Then
                ICNo = AlienNo
            End If


            Dim TempTempGroupCode As String = DbNullToString(DsEmp.Tables(0).Rows(0).Item(2))
            Dim TempPerGrp As String

            ''''''''''''''''''''''''''''''''CHANGE FOR PAPAGIANNIS '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

            Dim DsAllPeriods As DataSet
            DsAllPeriods = GetData(StrSIPer2)

            Dim h As Integer
            Dim tPerCode As String = Per.Code

            'If CheckDataSet(DsAllPeriods) Then
            '    For h = 0 To DsAllPeriods.Tables(0).Rows.Count - 1
            '        tPerCode = DbNullToString(DsAllPeriods.Tables(0).Rows(h).Item(0))

            '        Dim TempTempGroup As New cPrMsTemplateGroup(TempTempGroupCode)

            '        TempPerGrp = findPeriodGroupOfPeriodTempGroup(TempTempGroupCode, tPerCode)
            '        If TempPerGrp = "" Then
            '            TempPerGrp = Per.PrdGrpCode
            '        End If
            '        Dim TempPer As New cPrMsPeriodCodes(tPerCode, TempPerGrp)

            '        Dim DsGrossInsurable
            '        DsGrossInsurable = Global1.Business.SI_File_GetEmployees_Gross_Insurable(TempTempGroup, TempPer, EmpCode)
            '        If CheckDataSet(DsGrossInsurable) Then
            '            GrossEarn = GrossEarn + DbNullToDouble(DsGrossInsurable.Tables(0).Rows(0).Item(0))
            '            InsEarn = InsEarn + DbNullToDouble(DsGrossInsurable.Tables(0).Rows(0).Item(1))

            '        End If

            '        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

            '        ' GrossEarn = DbNullToDouble(dsHdr.Tables(0).Rows(i).Item(1))
            '        ' InsEarn = DbNullToDouble(dsHdr.Tables(0).Rows(i).Item(2))
            '        GESYableamount = GESYableamount + DbNullToDouble(dsHdr.Tables(0).Rows(i).Item(3))
            '        'T_Gross = T_Gross + GrossEarn
            '        'T_InsEarn = T_InsEarn + InsEarn
            '    Next
            'End If
            ''''''''''''''''''''''
            ' Before Change
            Dim TempTempGroup As New cPrMsTemplateGroup(TempTempGroupCode)

            TempPerGrp = findPeriodGroupOfPeriodTempGroup(TempTempGroupCode, Per.Code)
            If TempPerGrp = "" Then
                Dim x As Integer
                For x = 0 To DsAllPeriods.Tables(0).Rows.Count - 1
                    Dim xPerCode As String
                    xPerCode = DsAllPeriods.Tables(0).Rows(x).Item(0)
                    TempPerGrp = findPeriodGroupOfPeriodTempGroup(TempTempGroupCode, xPerCode)
                    If TempPerGrp <> "" Then Exit For
                Next
                If TempPerGrp = "" Then
                    TempPerGrp = Per.PrdGrpCode
                End If
            End If

            Dim Dsgrossinsurable As DataSet = GetGrossANDInsurable_NEW(StrSIPer, Str3X, SocInsCat, CompanySINo, EmpCode, TempTempGroupCode, TempPerGrp, DsAllPeriods)
            If CheckDataSet(Dsgrossinsurable) Then
                GrossEarn = DbNullToDouble(Dsgrossinsurable.Tables(0).Rows(0).Item(0))
                InsEarn = DbNullToDouble(Dsgrossinsurable.Tables(0).Rows(0).Item(1))

            End If

            'Dim TempPer As New cPrMsPeriodCodes(Per.Code, TempPerGrp)

            'Dim DsGrossInsurable
            'DsGrossInsurable = Global1.Business.SI_File_GetEmployees_Gross_Insurable(TempTempGroup, TempPer, EmpCode)
            'If CheckDataSet(DsGrossInsurable) Then
            '    GrossEarn = DbNullToDouble(DsGrossInsurable.Tables(0).Rows(0).Item(0))
            '    InsEarn = DbNullToDouble(DsGrossInsurable.Tables(0).Rows(0).Item(1))

            'End If

            ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''


            GESYableamount = DbNullToDouble(dsHdr.Tables(0).Rows(i).Item(3))


            '''''''''''''''''''''


            If CheckDataSet(DsEmpSIErn) Then
                For k = 0 To DsEmpSIErn.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSIErn.Tables(0).Rows(k).Item(0)) Then
                        SILeave = SILeave + DbNullToDouble(DsEmpSIErn.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If

            If CheckDataSet(DsEmpSIDed) Then
                For k = 0 To DsEmpSIDed.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSIDed.Tables(0).Rows(k).Item(0)) Then
                        SI = SI + DbNullToDouble(DsEmpSIDed.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpSICon) Then
                For k = 0 To DsEmpSICon.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSICon.Tables(0).Rows(k).Item(0)) Then
                        SI = SI + DbNullToDouble(DsEmpSICon.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpSocTaxDed) Then
                For k = 0 To DsEmpSocTaxDed.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSocTaxDed.Tables(0).Rows(k).Item(0)) Then
                        ST = ST + DbNullToDouble(DsEmpSocTaxDed.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpSocTaxCon) Then
                For k = 0 To DsEmpSocTaxCon.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSocTaxCon.Tables(0).Rows(k).Item(0)) Then
                        ST = ST + DbNullToDouble(DsEmpSocTaxCon.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpINDCon) Then
                For k = 0 To DsEmpINDCon.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpINDCon.Tables(0).Rows(k).Item(0)) Then
                        IND = IND + DbNullToDouble(DsEmpINDCon.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpUNECon) Then
                For k = 0 To DsEmpUNECon.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpUNECon.Tables(0).Rows(k).Item(0)) Then
                        UNE = UNE + DbNullToDouble(DsEmpUNECon.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If



            If CheckDataSet(DsEmpGESYDed) Then
                For k = 0 To DsEmpGESYDed.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpGESYDed.Tables(0).Rows(k).Item(0)) Then
                        GESYD = GESYD + DbNullToDouble(DsEmpGESYDed.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpGESYCon) Then
                For k = 0 To DsEmpGESYCon.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpGESYCon.Tables(0).Rows(k).Item(0)) Then
                        GESYC = GESYC + DbNullToDouble(DsEmpGESYCon.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If


            'Remove From GrossEarn Non Insurable Earnings
            Dim NonInsurable As Double = 0
            Dim NonTaxable As Double = 0



            'NonInsurable for 14/13 cases
            h = 0
            tPerCode = Per.Code


            If CheckDataSet(DsAllPeriods) Then
                For h = 0 To DsAllPeriods.Tables(0).Rows.Count - 1
                    tPerCode = DbNullToString(DsAllPeriods.Tables(0).Rows(h).Item(0))
                    NonInsurable = NonInsurable + FindNonInsurableTotalForTemplateGroupPeriodEmployee(TempTempGroupCode, TempPerGrp, EmpCode, tPerCode)

                Next

            End If

            'Non Insurable for 14/13 Cases


            'NonInsurable = FindNonInsurableTotalForTemplateGroupPeriodEmployee(TempTempGroupCode, Per.PrdGrpCode, EmpCode, Per.Code)
            '  NonInsurable = FindNonInsurableTotalForTemplateGroupPeriodEmployee(TempTempGroupCode, TempPerGrp, EmpCode, Per.Code)

            'changefor papagiannis the next line in comment
            'GrossEarn = GrossEarn - NonInsurable

            GrossEarn = Utils.RoundMeUp(GrossEarn)



            'Remove From Insurable earnings SILeave
            ' Dim SILeave As Double
            'SILeave = FindSILeaveTotalForTemplateGroupPeriodEmployee(TemGrp.Code, Per.PrdGrpCode, EmpCode, Per.Code)
            InsEarn = InsEarn - SILeave
            GESYableamount = GESYableamount - SILeave

            If SILeave <> 0 Then
                InsEarn = Utils.RoundMeUp(InsEarn)
                GESYableamount = Utils.RoundMeUp(GESYableamount)
                If Math.Abs(InsEarn - GrossEarn) = 1 Then
                    InsEarn = GrossEarn
                End If
                If Math.Abs(GESYableamount - GrossEarn) = 1 Then
                    GESYableamount = GrossEarn
                End If
            End If
            InsEarn = RoundMeUp(InsEarn)
            GESYableamount = Utils.RoundMeUp(GESYableamount)
            If Math.Abs(InsEarn - GrossEarn) = 1 Then
                GrossEarn = InsEarn
            End If
            If Math.Abs(GESYableamount - GrossEarn) = 1 Then
                GESYableamount = GrossEarn
            End If


            T_Gross = T_Gross + GrossEarn
            T_InsEarn = T_InsEarn + InsEarn
            T_GESYable = T_GESYable + GESYableamount

            WeekHol = GetSILeave(EmpCode, PeriodTemp)



            R = dt.NewRow
            R(Col_EmpName) = EmpName
            R(Col_ICno) = ICNo
            R(Col_SINo) = SINo
            R(Col_AlienNo) = AlienNo
            R(Col_EmpP) = "M"
            R(Col_Earnings) = GrossEarn
            R(Col_Insurable) = InsEarn
            R(Col_SiLeave) = SILeave
            R(Col_SI) = SI
            R(Col_ST) = ST
            R(Col_IndUne) = IND + UNE
            R(Col_WeekHol) = WeekHol
            R(Col_TermDate) = TermDate
            R(Col_Gesiable) = GESYableamount


            dt.Rows.Add(R)


            TotalEmp = TotalEmp + 1

            If StartDate >= Per.DateFrom And StartDate <= Per.DateTo Then
                NewEmp = NewEmp + 1
            End If
            If TermDate <> "" Then
                Dim TD As Date
                TD = CDate(TermDate)
                If TD >= Per.DateFrom And TD <= Per.DateTo Then
                    StopEmp = StopEmp + 1
                End If
            End If

        Next

        Dim DsComp As DataSet
        DsComp = Me.GetAllCompaniesFullRow(TemGrp.CompanyCode)
        DsComp.Tables(0).Rows(0).Item(6) = CompanySINo
        Ds.Tables.Add(DsComp.Tables(0).Copy)
        Ds.Tables(1).TableName = "Company"

        Dim DsPer As DataSet
        DsPer = Me.GetPeriodDetails(Per)

        Ds.Tables.Add(DsPer.Tables(0).Copy)
        Ds.Tables(2).TableName = "Period"



        R = dt2.NewRow

        Dim T_SIL As Double = 0
        Dim T_SI As Double = 0
        Dim T_IND As Double = 0
        Dim T_UNE As Double = 0
        Dim T_Grand As Double = 0
        Dim T_SCOH As Double = 0
        Dim T_GesyDandC As Double = 0


        If CheckDataSet(DsEmpSIErn) Then
            For k = 0 To DsEmpSIErn.Tables(0).Rows.Count - 1
                T_SIL = T_SIL + DbNullToDouble(DsEmpSIErn.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpSIDed) Then
            For k = 0 To DsEmpSIDed.Tables(0).Rows.Count - 1
                T_SI = T_SI + DbNullToDouble(DsEmpSIDed.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpSICon) Then
            For k = 0 To DsEmpSICon.Tables(0).Rows.Count - 1
                T_SI = T_SI + DbNullToDouble(DsEmpSICon.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpINDCon) Then
            For k = 0 To DsEmpINDCon.Tables(0).Rows.Count - 1
                T_IND = T_IND + DbNullToDouble(DsEmpINDCon.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpUNECon) Then
            For k = 0 To DsEmpUNECon.Tables(0).Rows.Count - 1
                T_UNE = T_UNE + DbNullToDouble(DsEmpUNECon.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpSocTaxCon) Then
            For k = 0 To DsEmpSocTaxCon.Tables(0).Rows.Count - 1
                T_SCOH = T_SCOH + DbNullToDouble(DsEmpSocTaxCon.Tables(0).Rows(k).Item(2))
            Next
        End If


        If CheckDataSet(DsEmpGESYDed) Then
            For k = 0 To DsEmpGESYDed.Tables(0).Rows.Count - 1
                T_GesyDandC = T_GesyDandC + DbNullToDouble(DsEmpGESYDed.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpGESYCon) Then
            For k = 0 To DsEmpGESYCon.Tables(0).Rows.Count - 1
                T_GesyDandC = T_GesyDandC + DbNullToDouble(DsEmpGESYCon.Tables(0).Rows(k).Item(2))
            Next
        End If


        Dim PayCat As New cPrSsPaymentCategory(Per.PayCat_Code)

        ''''
        T_Grand = T_SIL + T_SI + T_UNE + T_IND + T_SCOH + T_GesyDandC

        R(0) = TotalEmp 'Total
        R(1) = NewEmp 'New
        R(2) = StopEmp 'Stoped
        R(3) = T_Gross + T_SIL
        R(4) = T_InsEarn + T_SIL
        R(5) = T_SI
        R(6) = T_SIL
        R(7) = T_UNE
        R(8) = T_IND
        R(9) = T_SCOH
        R(10) = T_Grand
        R(11) = PayCat.Code & "-" & PayCat.DescriptionL
        R(12) = SocInsCat.Code & "-" & SocInsCat.DescriptionL

        R(13) = PeriodTemp.DateFrom.Month & "/" & PeriodTemp.DateFrom.Year
        R(14) = T_GESYable + T_SIL
        R(15) = T_GesyDandC




        dt2.Rows.Add(R)

        Ds.Tables.Add(dt2)
        Str = "Select '' as Line1," & _
        " '' as Line2," & _
        " '' as Line3," & _
        " '' as Line4," & _
        " '' as Line5," & _
        " '' as Line6," & _
        " '' as Line7," & _
        " '' as Line8," & _
        " '' as Line9," & _
        " '' as Line10," & _
        " '' as Line11," & _
        " '' as Line12," & _
        " '' as Line13," & _
        " '' as Line14," & _
        " '' as Line15," & _
        " '' as Line16," & _
        " '' as Line17," & _
        " '' as Line18," & _
        " '' as Line19," & _
        " '' as Line20," & _
        " '' as Line21," & _
        " '' as Line22," & _
        " '' as Line23," & _
        " '' as Line24," & _
        " '' as Line25," & _
        " '' as Line26," & _
        " '' as Line27," & _
        " '' as Line28," & _
        " '' as Line29," & _
        " '' as Line30," & _
        " '' as Line31," & _
        " '' as Line32," & _
        " '' as Line33," & _
        " '' as Line34," & _
        " '' as Line35," & _
        " '' as Line36," & _
        " '' as Line37," & _
        " '' as Line38," & _
        " '' as Line39," & _
        " '' as Line40 " & _
        " From adMsCompany where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Dim DsNew As DataSet
        DsNew = GetData(Str)
        If CheckDataSet(DsNewEmp) Then
            Dim Line As String
            Dim Emp As New cPrMsEmployees
            Dim S As String
            For i = 0 To DsNewEmp.Tables(0).Rows.Count - 1
                Debug.WriteLine(DsNewEmp.Tables(0).Rows.Count - 1)
                Line = ""
                S = ""
                Emp = New cPrMsEmployees(DbNullToString(DsNewEmp.Tables(0).Rows(i).Item(0)))
                With Emp
                    R = dt3.NewRow

                    If .FullName.Length >= 30 Then
                        S = .FullName.Substring(0, 30)
                    Else
                        S = .FullName
                    End If
                    R(0) = S
                    ' Line = Line & S.PadRight(30, " ")
                    Dim EmpId As String
                    EmpId = .IdentificationCard

                    If EmpId = "" Then
                        EmpId = .PassportNumber
                    End If

                    If EmpId = "" Then
                        EmpId = .AlienNumber
                    End If

                    S = EmpId.PadLeft(10, " ")
                    ' Line = Line & S
                    R(1) = EmpId

                    'S = .SocialInsNumber.PadLeft(13, " ")
                    'Line = Line & S
                    R(2) = .SocialInsNumber

                    S = Format(.BirthDate, "dd-MM-yyyy").PadLeft(17, " ")
                    'Line = Line & S
                    R(3) = S

                    S = .Sex.PadLeft(6, " ")
                    ' Line = Line & S
                    R(4) = S
                    'S = .PayTyp_Code.Substring(0, 1).PadLeft(6, " ")
                    'Line = Line & S
                    R(5) = .PayTyp_Code
                    If .IsSI Then
                        S = "Y"
                    Else
                        S = "X"
                    End If
                    ' S = S.PadLeft(12, " ")
                    ' Line = Line & S
                    R(6) = S

                    S = Format(.StartDate, "dd-MM-yyyy").PadLeft(13, " ")
                    Line = Line & S
                    R(7) = S
                    If Global1.PARAM_UsePosition Then
                        Dim Pos As New cPrAnEmployeePositions(.EmpPos_Code)
                        S = Pos.DescriptionL.PadLeft(22, " ")
                        Line = Line & S
                        R(8) = S
                    Else
                        Dim An As New cPrAnEmployeeAnalysis2(.EmpAn2_Code)
                        S = An.DescriptionS.PadLeft(22, " ")
                        Line = Line & S
                        R(8) = S
                    End If
                    R(9) = Emp.Sic_Code
                    Try
                        'DsNew.Tables(0).Rows(0).Item(i) = Line
                        dt3.Rows.Add(R)
                    Catch ex As Exception

                    End Try

                End With

            Next
        End If

        ' Ds.Tables.Add(DsNew.Tables(0).Copy)
        'Ds.Tables(4).TableName = "DsNew"
        Ds.Tables.Add(dt3)
        Ds.Tables(4).TableName = "DsNew"




        Return Ds
    End Function
    Private Function findPeriodGroupOfPeriodTempGroup(ByVal TempGroupCode As String, ByVal PeriodCode As String) As String
        Dim Ds As DataSet
        Dim Str As String
        Dim PerGroupCode As String = ""
        Str = "SELECT     PrMsPeriodGroups.PrdGrp_Code " & _
        " FROM         PrMsPeriodCodes INNER JOIN " & _
        " PrMsPeriodGroups ON PrMsPeriodCodes.PrdGrp_Code = PrMsPeriodGroups.PrdGrp_Code " & _
        " WHERE     (PrMsPeriodCodes.PrdCod_Code = " & enQuoteString(PeriodCode) & ")  " & _
        " AND (PrMsPeriodGroups.TemGrp_Code = " & enQuoteString(TempGroupCode) & ") "

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            PerGroupCode = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If

        Return PerGroupCode

    End Function


    Protected Function REPORT_PrepareSIContributionsPERPeriod_PerCompany(ByVal Per As cPrMsPeriodCodes, ByVal TemGrp As cPrMsTemplateGroup, ByVal SocInsCat As cPrAnSocialInsCategories, ByVal PerGrp As cPrMsPeriodGroups, ByVal CompanySINo As String) As DataSet

        Dim Ds As New DataSet
        Dim Col_EmpName As Integer = 0
        Dim Col_ICno As Integer = 1
        Dim Col_SINo As Integer = 2
        Dim Col_AlienNo As Integer = 3
        Dim Col_EmpP As Integer = 4
        Dim Col_Earnings As Integer = 5
        Dim Col_Insurable As Integer = 6
        Dim Col_SiLeave As Integer = 7
        Dim Col_SI As Integer = 8
        Dim Col_ST As Integer = 9
        Dim Col_IndUne As Integer = 10
        Dim Col_WeekHol As Integer = 11
        Dim Col_TermDate As Integer = 12
        Dim Col_Gesiable As Integer = 13


        Dim T_InsEarn As Double = 0
        Dim T_Gross As Double = 0
        Dim T_GESYable As Double = 0


        Dim dt As New DataTable

        dt = New DataTable("Employee")
        '0
        dt.Columns.Add(New DataColumn("EmpName", System.Type.GetType("System.String")))
        '1
        dt.Columns.Add(New DataColumn("EmpICNo", System.Type.GetType("System.String")))
        '2
        dt.Columns.Add(New DataColumn("EmpS.I.No", System.Type.GetType("System.String")))
        '3
        dt.Columns.Add(New DataColumn("EmpAlienNo", System.Type.GetType("System.String")))
        '4
        dt.Columns.Add(New DataColumn("EmpP", System.Type.GetType("System.String")))
        '5
        dt.Columns.Add(New DataColumn("Earnings", System.Type.GetType("System.Double")))
        '6
        dt.Columns.Add(New DataColumn("Insurable", System.Type.GetType("System.Double")))
        '7
        dt.Columns.Add(New DataColumn("SILeave", System.Type.GetType("System.Double")))
        '8
        dt.Columns.Add(New DataColumn("SI", System.Type.GetType("System.Double")))
        '9
        dt.Columns.Add(New DataColumn("SocialTax", System.Type.GetType("System.Double")))
        '10
        dt.Columns.Add(New DataColumn("IND_Une", System.Type.GetType("System.Double")))
        '11
        dt.Columns.Add(New DataColumn("WeekHol", System.Type.GetType("System.String")))
        '12
        dt.Columns.Add(New DataColumn("TermDate", System.Type.GetType("System.String")))
        '13
        dt.Columns.Add(New DataColumn("Gesiable", System.Type.GetType("System.Double")))



        Ds.Tables.Add(dt)

        Dim dt2 As New DataTable

        dt2 = New DataTable("EmployeeDetails")
        '0
        dt2.Columns.Add(New DataColumn("TotalEmp", System.Type.GetType("System.String")))
        '1
        dt2.Columns.Add(New DataColumn("NewEmp", System.Type.GetType("System.String")))
        '2
        dt2.Columns.Add(New DataColumn("StopEmp", System.Type.GetType("System.String")))
        '3
        dt2.Columns.Add(New DataColumn("T_Gross", System.Type.GetType("System.Double")))
        '4
        dt2.Columns.Add(New DataColumn("T_Insurable", System.Type.GetType("System.Double")))
        '5
        dt2.Columns.Add(New DataColumn("T_SI", System.Type.GetType("System.Double")))
        '6
        dt2.Columns.Add(New DataColumn("T_SIL", System.Type.GetType("System.Double")))
        '7
        dt2.Columns.Add(New DataColumn("T_Une", System.Type.GetType("System.Double")))
        '8
        dt2.Columns.Add(New DataColumn("T_Ind", System.Type.GetType("System.Double")))
        '9
        dt2.Columns.Add(New DataColumn("T_SCoh", System.Type.GetType("System.Double")))
        '10
        dt2.Columns.Add(New DataColumn("T_Grand", System.Type.GetType("System.Double")))
        '11
        dt2.Columns.Add(New DataColumn("PeriodCat", System.Type.GetType("System.String")))
        '12
        dt2.Columns.Add(New DataColumn("EmpCat", System.Type.GetType("System.String")))
        '13
        dt2.Columns.Add(New DataColumn("PeriodDesc", System.Type.GetType("System.String")))
        '14
        dt2.Columns.Add(New DataColumn("T_Gesiable", System.Type.GetType("System.Double")))
        '15
        dt2.Columns.Add(New DataColumn("T_SGesi", System.Type.GetType("System.Double")))




        'Dim PerGrp As New cPrMsPeriodGroups(Per.PrdGrpCode)
        Dim Str As String = ""
        Dim Str2X As String = ""
        Dim Str3X As String = ""
        Dim Str4 As String = ""

        Str = " Select TemGrp_Code from PrMsTemplateGroup" & _
              " Where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Dim DsT As DataSet
        Dim DsPG As DataSet

        DsT = GetData(Str)

        If CheckDataSet(DsT) Then
            Dim Code As String
            Dim z As Integer
            Dim PeriodGroupCode As String = ""
            For z = 0 To DsT.Tables(0).Rows.Count - 1
                Code = DbNullToString(DsT.Tables(0).Rows(z).Item(0))
                Str = "SELECT PRDGRP_CODE FROM PRMSPERIODGROUPS" & _
                      " WHERE TEMGRP_CODE=" & enQuoteString(Code) & _
                " AND PrdGpr_Year=" & enQuoteString(Per.DateFrom.Year)
                DsPG = GetData(Str)
                If CheckDataSet(DsPG) Then
                    PeriodGroupCode = DbNullToString(DsPG.Tables(0).Rows(0).Item(0))
                End If

                If z = 0 Then
                    Str2X = " (PrMsEmployees.TemGrp_Code = " & enQuoteString(Code) & ")"
                    Str3X = " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
                Else
                    Str2X = Str2X & " OR  (PrMsEmployees.TemGrp_Code = " & enQuoteString(Code) & ")"
                    Str3X = Str3X & " OR (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
                End If
            Next
            Str2X = "AND (" & Str2X & ")"
            Str3X = "AND (" & Str3X & ")"



        End If


        Dim StrSIPer As String
        Dim StrAllPeriodGroups As String
        StrAllPeriodGroups = Str3X.Replace("PrTxTrxnHeader", "PrMsPeriodCodes")

        StrSIPer = "SELECT PrMsPeriodCodes.PrdCod_Code" & _
            " FROM  PrMsPeriodGroups INNER JOIN" & _
            " PrMsPeriodCodes ON " & _
            " PrMsPeriodGroups.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
            " WHERE (PrMsPeriodCodes.PrdCod_Code = " & enQuoteString(Per.Code) & ") "
        StrSIPer = StrSIPer & StrAllPeriodGroups

        Dim dsHdr As DataSet
        Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
             " sum(PrTxTrxnHeader.TrxHdr_TotalErnPeriod)," & _
             " sum(PrTxTrxnHeader.TrxHdr_PeriodInsurable)," & _
             " sum(PrTxTrxnHeader.TrxHdr_GesiableAmount)" & _
             " FROM  PrTxTrxnHeader INNER JOIN" & _
             " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
             " WHERE  (PrMsEmployees.Sic_Code=" & enQuoteString(SocInsCat.Code) & ")" & _
             " AND  (PrMsEmployees.ComSin_EmpSocialInsNo=" & enQuoteString(CompanySINo) & ")" & _
            " AND (PrTxTrxnHeader.PrdCod_Code IN ("

        Str = Str & StrSIPer & "))"


        Str4 = "GROUP BY PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_IdentificationCard," & _
        " PrMsEmployees.Emp_SocialInsNumber" & _
        " ORDER BY " & _
        " PrTxTrxnHeader.Emp_Code," & _
        " PrMsEmployees.Emp_IdentificationCard," & _
        " PrMsEmployees.Emp_SocialInsNumber"


        Str = Str & Str2X & Str3X & Str4

        Dim DsNewEmp As DataSet
        Dim DateFrom As Date
        Dim DateTo As Date
        Dim DsPeriods As DataSet
        Dim PeriodTemp As New cPrMsPeriodCodes
        Dim StrNew As String

        StrNew = "SELECT PrdCod_code FROM PrMsPeriodCodes " & _
        " WHERE PrdGrp_Code=" & enQuoteString(PerGrp.Code)

        DsPeriods = GetData(StrNew)

        PeriodTemp = FindSocialInsCategoryDate(DsPeriods, PerGrp)


        StrNew = "SELECT PrMsEmployees.Emp_Code " & _
            " FROM PrMsEmployees INNER JOIN" & _
            " PrTxTrxnHeader ON PrMsEmployees.Emp_Code = PrTxTrxnHeader.Emp_Code" & _
            " WHERE (PrMsEmployees.Emp_StartDate >= CONVERT(DATETIME, " & enQuoteString(Format(Per.DateFrom, "yyyy-MM-dd")) & ", 102))" & _
            " AND (PrMsEmployees.Emp_StartDate <= CONVERT(DATETIME," & enQuoteString(Format(Per.DateTo, "yyyy-MM-dd")) & ", 102))" & _
            " AND (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
            " AND( PrMsEmployees.Sic_Code=" & enQuoteString(SocInsCat.Code) & ")" & _
            " AND  (PrMsEmployees.ComSin_EmpSocialInsNo=" & enQuoteString(CompanySINo) & ")" & _
            " GROUP  BY PrMsEmployees.Emp_Code "
        DsNewEmp = GetData(StrNew)

        dsHdr = GetData(Str)
        Dim Str2 As String
        Dim DsEmpSIErn As DataSet = GetERNFromTrxnLinesFor(StrSIPer, Str3X, "SI", SocInsCat, CompanySINo)
        Dim DsEmpSIDed As DataSet = GetDEDFromTrxnLinesFor(StrSIPer, Str3X, "SI", SocInsCat, CompanySINo)
        Dim DsEmpSICon As DataSet = GetCONFromTrxnLinesFor(StrSIPer, Str3X, "SI", SocInsCat, CompanySINo)
        Dim DsEmpSocTaxDed As DataSet = GetDEDFromTrxnLinesFor(StrSIPer, Str3X, "ST", SocInsCat, CompanySINo)
        Dim DsEmpSocTaxCon As DataSet = GetCONFromTrxnLinesFor(StrSIPer, Str3X, "ST", SocInsCat, CompanySINo)
        Dim DsEmpINDCon As DataSet = GetCONFromTrxnLinesFor(StrSIPer, Str3X, "IN", SocInsCat, CompanySINo)
        Dim DsEmpUNECon As DataSet = GetCONFromTrxnLinesFor(StrSIPer, Str3X, "UN", SocInsCat, CompanySINo)

        Dim DsEmpGESYDed As DataSet = GetDEDFromTrxnLinesFor(StrSIPer, Str3X, "GD", SocInsCat, CompanySINo)
        Dim DsEmpGESYCon As DataSet = GetCONFromTrxnLinesFor(StrSIPer, Str3X, "GC", SocInsCat, CompanySINo)




        Dim i As Integer
        Dim k As Integer
        Dim EmpCode As String = ""
        Dim ICNo As String = ""
        Dim SINo As String = ""
        Dim AlienNo As String = ""
        Dim EmpName As String = ""
        Dim GrossEarn As Double = 0
        Dim InsEarn As Double = 0
        Dim SILeave As Double = 0
        Dim SI As Double = 0
        Dim ST As Double = 0
        Dim IND As Double = 0
        Dim UNE As Double = 0
        Dim TermDate As String = ""
        Dim R As DataRow
        Dim TotalEmp As Integer
        Dim StartDate As Date
        Dim NewEmp As Integer
        Dim StopEmp As Integer
        Dim WeekHol As String
        Dim GESYD As Double = 0
        Dim GESYC As Double = 0
        Dim GESYableamount As Double = 0




        For i = 0 To dsHdr.Tables(0).Rows.Count - 1
            SILeave = 0
            SI = 0
            ST = 0
            UNE = 0
            IND = 0
            WeekHol = ""
            GESYD = 0
            GESYC = 0

            EmpCode = DbNullToString(dsHdr.Tables(0).Rows(i).Item(0))
            Dim DsEmp As DataSet

            Str = " SELECT Emp_Code," & _
            " PayTyp_Code," & _
            " TemGrp_Code," & _
            " Emp_FullName," & _
            " Emp_SocialInsNumber," & _
            " Emp_IdentificationCard," & _
            " Emp_AlienNumber," & _
            " Emp_StartDate, " & _
            " Emp_TerminateDate," & _
            " Sic_Code, " & _
            " Emp_PassportNumber " & _
            " FROM PrMsEmployees Where Emp_Code = " & enQuoteString(EmpCode) & _
            " Order By Emp_Code ASC "
            Str = Str & Str2

            DsEmp = GetData(Str)

            EmpName = DbNullToString(DsEmp.Tables(0).Rows(0).Item(3))
            SINo = DbNullToString(DsEmp.Tables(0).Rows(0).Item(4))
            ICNo = DbNullToString(DsEmp.Tables(0).Rows(0).Item(5))
            AlienNo = DbNullToString(DsEmp.Tables(0).Rows(0).Item(6))
            StartDate = DbNullToDate(DsEmp.Tables(0).Rows(0).Item(7))
            TermDate = DbNullToString(DsEmp.Tables(0).Rows(0).Item(8))

            If Trim(TermDate) <> "" Then
                If Per.PayCat_Code = "K" Then
                    If CDate(TermDate) < Per.DateFrom Or CDate(TermDate) > Per.DateTo Then
                        TermDate = ""
                    End If
                Else
                    TermDate = ""
                End If
            End If


            GrossEarn = DbNullToDouble(dsHdr.Tables(0).Rows(i).Item(1))
            InsEarn = DbNullToDouble(dsHdr.Tables(0).Rows(i).Item(2))
            GESYableamount = DbNullToDouble(dsHdr.Tables(0).Rows(i).Item(3))

            'T_Gross = T_Gross + GrossEarn
            'T_InsEarn = T_InsEarn + InsEarn


            If CheckDataSet(DsEmpSIErn) Then
                For k = 0 To DsEmpSIErn.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSIErn.Tables(0).Rows(k).Item(0)) Then
                        SILeave = SILeave + DbNullToDouble(DsEmpSIErn.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpSIDed) Then
                For k = 0 To DsEmpSIDed.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSIDed.Tables(0).Rows(k).Item(0)) Then
                        SI = SI + DbNullToDouble(DsEmpSIDed.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpSICon) Then
                For k = 0 To DsEmpSICon.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSICon.Tables(0).Rows(k).Item(0)) Then
                        SI = SI + DbNullToDouble(DsEmpSICon.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpSocTaxDed) Then
                For k = 0 To DsEmpSocTaxDed.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSocTaxDed.Tables(0).Rows(k).Item(0)) Then
                        ST = ST + DbNullToDouble(DsEmpSocTaxDed.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpSocTaxCon) Then
                For k = 0 To DsEmpSocTaxCon.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpSocTaxCon.Tables(0).Rows(k).Item(0)) Then
                        ST = ST + DbNullToDouble(DsEmpSocTaxCon.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpINDCon) Then
                For k = 0 To DsEmpINDCon.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpINDCon.Tables(0).Rows(k).Item(0)) Then
                        IND = IND + DbNullToDouble(DsEmpINDCon.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpUNECon) Then
                For k = 0 To DsEmpUNECon.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpUNECon.Tables(0).Rows(k).Item(0)) Then
                        UNE = UNE + DbNullToDouble(DsEmpUNECon.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If




            If CheckDataSet(DsEmpGESYDed) Then
                For k = 0 To DsEmpGESYDed.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpGESYDed.Tables(0).Rows(k).Item(0)) Then
                        GESYD = GESYD + DbNullToDouble(DsEmpGESYDed.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If
            If CheckDataSet(DsEmpGESYCon) Then
                For k = 0 To DsEmpGESYCon.Tables(0).Rows.Count - 1
                    If EmpCode = DbNullToString(DsEmpGESYCon.Tables(0).Rows(k).Item(0)) Then
                        GESYC = GESYC + DbNullToDouble(DsEmpGESYCon.Tables(0).Rows(k).Item(2))
                    End If
                Next
            End If


            'Remove From GrossEarn Non Insurable Earnings
            Dim NonInsurable As Double
            '  xxxxxxxxx()
            NonInsurable = FindNonInsurableTotalForTemplateGroupPeriodEmployee(TemGrp.Code, Per.PrdGrpCode, EmpCode, Per.Code)
            GrossEarn = GrossEarn - NonInsurable
            GrossEarn = Utils.RoundMeUp(GrossEarn)

            'Remove From Insurable earnings SILeave
            ' Dim SILeave As Double
            'SILeave = FindSILeaveTotalForTemplateGroupPeriodEmployee(TemGrp.Code, Per.PrdGrpCode, EmpCode, Per.Code)
            InsEarn = InsEarn - SILeave
            GESYableamount = GESYableamount - SILeave

            If SILeave <> 0 Then
                InsEarn = Utils.RoundMeUp(InsEarn)
                If Math.Abs(InsEarn - GrossEarn) = 1 Then
                    InsEarn = GrossEarn
                End If
                GESYableamount = Utils.RoundMeUp(GESYableamount)
                If Math.Abs(GESYableamount - GrossEarn) = 1 Then
                    GESYableamount = GrossEarn
                End If
            End If
            GESYableamount = Utils.RoundMeUp(GESYableamount)
            If Math.Abs(GESYableamount - GrossEarn) = 1 Then
                GESYableamount = GrossEarn
            End If

            T_Gross = T_Gross + GrossEarn
            T_InsEarn = T_InsEarn + InsEarn

            T_GESYable = T_GESYable + GESYableamount

            WeekHol = GetSILeave(EmpCode, PeriodTemp)

            R = dt.NewRow
            R(Col_EmpName) = EmpName
            R(Col_ICno) = ICNo
            R(Col_SINo) = SINo
            R(Col_AlienNo) = AlienNo
            R(Col_EmpP) = "M"
            R(Col_Earnings) = GrossEarn
            R(Col_Insurable) = InsEarn
            R(Col_SiLeave) = SILeave
            R(Col_SI) = SI
            R(Col_ST) = ST
            R(Col_IndUne) = IND + UNE
            R(Col_WeekHol) = WeekHol
            R(Col_TermDate) = TermDate
            R(Col_Gesiable) = GESYableamount




            dt.Rows.Add(R)

            TotalEmp = TotalEmp + 1

            If StartDate >= Per.DateFrom And StartDate <= Per.DateTo Then
                NewEmp = NewEmp + 1
            End If
            If TermDate <> "" Then
                Dim TD As Date
                TD = CDate(TermDate)
                If TD >= Per.DateFrom And TD <= Per.DateTo Then
                    StopEmp = StopEmp + 1
                Else
                    TermDate = ""
                    R(Col_TermDate) = ""
                End If
            End If
        Next
        Dim DsComp As DataSet
        DsComp = Me.GetAllCompaniesFullRow(TemGrp.CompanyCode)
        DsComp.Tables(0).Rows(0).Item(6) = CompanySINo
        Ds.Tables.Add(DsComp.Tables(0).Copy)
        Ds.Tables(1).TableName = "Company"

        Dim DsPer As DataSet
        DsPer = Me.GetPeriodDetails(Per)

        Ds.Tables.Add(DsPer.Tables(0).Copy)
        Ds.Tables(2).TableName = "Period"



        R = dt2.NewRow

        Dim T_SIL As Double = 0
        Dim T_SI As Double = 0
        Dim T_IND As Double = 0
        Dim T_UNE As Double = 0
        Dim T_Grand As Double = 0
        Dim T_SCOH As Double = 0
        Dim T_GesyDandC As Double = 0

        If CheckDataSet(DsEmpSIErn) Then
            For k = 0 To DsEmpSIErn.Tables(0).Rows.Count - 1
                T_SIL = T_SIL + DbNullToDouble(DsEmpSIErn.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpSIDed) Then
            For k = 0 To DsEmpSIDed.Tables(0).Rows.Count - 1
                T_SI = T_SI + DbNullToDouble(DsEmpSIDed.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpSICon) Then
            For k = 0 To DsEmpSICon.Tables(0).Rows.Count - 1
                T_SI = T_SI + DbNullToDouble(DsEmpSICon.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpINDCon) Then
            For k = 0 To DsEmpINDCon.Tables(0).Rows.Count - 1
                T_IND = T_IND + DbNullToDouble(DsEmpINDCon.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpUNECon) Then
            For k = 0 To DsEmpUNECon.Tables(0).Rows.Count - 1
                T_UNE = T_UNE + DbNullToDouble(DsEmpUNECon.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpSocTaxCon) Then
            For k = 0 To DsEmpSocTaxCon.Tables(0).Rows.Count - 1
                T_SCOH = T_SCOH + DbNullToDouble(DsEmpSocTaxCon.Tables(0).Rows(k).Item(2))
            Next
        End If

        If CheckDataSet(DsEmpGESYDed) Then
            For k = 0 To DsEmpGESYDed.Tables(0).Rows.Count - 1
                T_GesyDandC = T_GesyDandC + DbNullToDouble(DsEmpGESYDed.Tables(0).Rows(k).Item(2))
            Next
        End If
        If CheckDataSet(DsEmpGESYCon) Then
            For k = 0 To DsEmpGESYCon.Tables(0).Rows.Count - 1
                T_GesyDandC = T_GesyDandC + DbNullToDouble(DsEmpGESYCon.Tables(0).Rows(k).Item(2))
            Next
        End If

        Dim PayCat As New cPrSsPaymentCategory(Per.PayCat_Code)

        ''''
        T_Grand = T_SIL + T_SI + T_UNE + T_IND + T_SCOH + T_GesyDandC

        R(0) = TotalEmp 'Total
        R(1) = NewEmp 'New
        R(2) = StopEmp 'Stoped
        R(3) = T_Gross + T_SIL
        R(4) = T_InsEarn + T_SIL
        R(5) = T_SI
        R(6) = T_SIL
        R(7) = T_UNE
        R(8) = T_IND
        R(9) = T_SCOH
        R(10) = T_Grand
        R(11) = PayCat.Code & "-" & PayCat.DescriptionL
        R(12) = SocInsCat.Code & "-" & SocInsCat.DescriptionL

        R(13) = Per.DateFrom.Month & "/" & Per.DateFrom.Year
        R(14) = T_GESYable + T_SIL
        R(15) = T_GesyDandC




        dt2.Rows.Add(R)

        Ds.Tables.Add(dt2)
        Str = "Select '' as Line1," & _
        " '' as Line2," & _
        " '' as Line3," & _
        " '' as Line4," & _
        " '' as Line5," & _
        " '' as Line6," & _
        " '' as Line7," & _
        " '' as Line8," & _
        " '' as Line9," & _
        " '' as Line10," & _
        " '' as Line11," & _
        " '' as Line12" & _
        " From adMsCompany where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Dim DsNew As DataSet
        DsNew = GetData(Str)
        If CheckDataSet(DsNewEmp) Then
            Dim Line As String
            Dim Emp As New cPrMsEmployees
            Dim S As String
            For i = 0 To DsNewEmp.Tables(0).Rows.Count - 1
                Debug.WriteLine(DsNewEmp.Tables(0).Rows.Count - 1)
                Line = ""
                S = ""
                Emp = New cPrMsEmployees(DbNullToString(DsNewEmp.Tables(0).Rows(i).Item(0)))
                With Emp
                    If .FullName.Length >= 30 Then
                        S = .FullName.Substring(0, 30)
                    Else
                        S = .FullName
                    End If
                    Line = Line & S.PadRight(30, " ")
                    Dim EmpID As String
                    EmpID = .IdentificationCard
                    If EmpID = "" Then
                        EmpID = .PassportNumber
                    End If
                    If EmpID = "" Then
                        EmpID = .AlienNumber
                    End If
                    S = EmpID.PadLeft(10, " ")
                    Line = Line & S

                    S = .SocialInsNumber.PadLeft(13, " ")
                    Line = Line & S

                    S = Format(.BirthDate, "dd-MM-yyyy").PadLeft(17, " ")
                    Line = Line & S

                    S = .Sex.PadLeft(6, " ")
                    Line = Line & S

                    S = .PayTyp_Code.Substring(0, 1).PadLeft(6, " ")
                    Line = Line & S
                    If .IsSI Then
                        S = "Y"
                    Else
                        S = "X"
                    End If
                    S = S.PadLeft(12, " ")
                    Line = Line & S

                    S = Format(.StartDate, "dd-MM-yyyy").PadLeft(13, " ")
                    Line = Line & S

                    Dim An As New cPrAnEmployeeAnalysis2(.EmpAn2_Code)
                    S = An.DescriptionS.PadLeft(22, " ")
                    Line = Line & S
                    Try
                        DsNew.Tables(0).Rows(0).Item(i) = Line
                    Catch ex As Exception

                    End Try

                End With

            Next
        End If

        Ds.Tables.Add(DsNew.Tables(0).Copy)
        Ds.Tables(4).TableName = "DsNew"



        Return Ds
    End Function
    Private Function GetSILeave(ByVal EmpCode As String, ByVal PeriodTemp As cPrMsPeriodCodes) As String
        Dim Str As String
        Dim retVal As String = ""
        Dim i As Integer
        Dim k As Integer
        Dim D As Date
        Dim DateFrom As Date
        Dim DateTo As Date
        Str = " SELECT EmpLea_Id, " & _
            " EmpLea_FromDate, " & _
            " EmpLea_ToDate " & _
            " FROM PrTxEmployeeLeave " & _
            " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")  " & _
            " AND (EmpLea_Type = '5')" & _
            " AND (EmpLea_Status = " & enQuoteString(Global1.AN_Approved) & ") " & _
            " AND (EmpLea_FromDate >= CONVERT(DATETIME," & enQuoteString(Format(PeriodTemp.DateFrom, "yyyy-MM-dd")) & ", 102)  " & _
            " AND (EmpLea_ToDate <= CONVERT(DATETIME, " & enQuoteString(Format(PeriodTemp.DateTo, "yyyy-MM-dd")) & ", 102)))"

        Dim Ds As DataSet
        Ds = (GetData(Str))
        D = PeriodTemp.DateFrom


        Dim W() As Boolean
        ReDim W(5)

        Dim s As Integer
        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                DateFrom = DbNullToDate(Ds.Tables(0).Rows(i).Item(1))
                DateTo = DbNullToDate(Ds.Tables(0).Rows(i).Item(2))
                D = DateFrom
                Do While DateTo > D
                    s = GetWeekOfMonth(D.Year, D.Month, D.Day)
                    If s <> 0 Then
                        W(s - 1) = True
                    End If
                    D = DateAdd(DateInterval.Day, 1, D)
                Loop
            Next
        End If
        For i = 0 To W.Length - 1
            If W(i) = True Then
                retVal = retVal & "M "
            Else
                retVal = retVal & "  "
            End If
        Next

        Return retVal


    End Function
    Public Function GetWeekOfMonth(ByVal xYear As Integer, ByVal xMonth As Integer, ByVal xDay As Integer) As Integer
        Try

            Dim xDate As Date
            Dim xDate1 As DayOfWeek
            Dim xFirstdayOfMonth As Integer
            Dim xWeek1DayRange As String
            Dim xWeek2DayRange As String
            Dim xWeek3DayRange As String
            Dim xWeek4DayRange As String
            Dim xWeek5DayRange As String
            Dim xWeek1() As String
            Dim xWeek2() As String
            Dim xWeek3() As String
            Dim xWeek4() As String
            Dim xWeek5() As String
            Dim xMaxDay() As Integer = {0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31, 0}
            Dim xTotalDayOfMonth As Integer
            xDate = DateSerial(xYear, xMonth, 1)

            xTotalDayOfMonth = xMaxDay(xMonth)

            If xMonth = 2 Then

                If ((xYear Mod 4 = 0 And xYear Mod 100 <> 0) Or xYear Mod 400 = 0) Then

                    xTotalDayOfMonth = xTotalDayOfMonth + 1

                End If

            End If

            xDate1 = xDate.DayOfWeek

            xFirstdayOfMonth = xDate1

            xWeek1DayRange = 1 & "," & 7 - xFirstdayOfMonth

            xWeek2DayRange = 7 - xFirstdayOfMonth + 1 & "," & 7 - xFirstdayOfMonth + 1 + 6

            xWeek3DayRange = 7 - xFirstdayOfMonth + 1 + 6 + 1 & "," & 7 - xFirstdayOfMonth + 1 + 6 + 6 + 1

            xWeek4DayRange = 7 - xFirstdayOfMonth + 1 + 6 + 6 + 1 + 1 & "," & 7 - xFirstdayOfMonth + 1 + 6 + 6 + 6 + 1 + 1

            xWeek5DayRange = 7 - xFirstdayOfMonth + 1 + 6 + 6 + 6 + 1 + 1 + 1 & "," & xTotalDayOfMonth

            xWeek1 = xWeek1DayRange.Split(",".ToCharArray)

            xWeek2 = xWeek2DayRange.Split(",".ToCharArray)

            xWeek3 = xWeek3DayRange.Split(",".ToCharArray)

            xWeek4 = xWeek4DayRange.Split(",".ToCharArray)

            xWeek5 = xWeek5DayRange.Split(",".ToCharArray)



            If xDay < xWeek1(1) Then

                GetWeekOfMonth = 1

            Else

                If xDay > xWeek2(1) Then

                    If xDay > xWeek3(1) Then

                        If xDay > xWeek4(1) Then

                            GetWeekOfMonth = 5

                        Else

                            GetWeekOfMonth = 4

                        End If

                    Else

                        GetWeekOfMonth = 3

                    End If

                Else

                    GetWeekOfMonth = 2

                End If

            End If

        Catch errMsg As System.Exception

            Utils.ShowException(errMsg)

            GetWeekOfMonth = 0

        End Try
    End Function
    Private Function FindSocialInsCategoryDate(ByVal Ds As DataSet, ByVal PerGrp As cPrMsPeriodGroups) As cPrMsPeriodCodes
        If CheckDataSet(Ds) Then
            Dim i As Integer
            Dim Code As String
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                Code = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
                Dim Per As New cPrMsPeriodCodes(Code, PerGrp.Code)
                If Per.PayCat_Code = "K" Then
                    Return Per
                    Exit Function
                End If
            Next
        End If

    End Function
    Protected Function REPORT_IR63A(ByVal PerGrp As cPrMsPeriodGroups, ByVal EmpCode As String, ByVal DsIr7 As DataSet, ByVal Name_OnIR63 As String, ByVal Designation_OnIR63 As String, ByVal PrintDate_OnIR63 As String) As DataSet
        Dim ShowBonusSeparatly As Boolean = False
        Dim SeparateBonus As Double = 0
        Dim BonusEarningCode As String = ""
        '--------------------------------------------------------------------------
        Dim ShowSep1 As Boolean = False
        Dim SepAmount1 As Double = 0
        Dim SepEarningCode1 As String = ""
        Dim SepDesc1 As String = ""

        Dim ShowSep2 As Boolean = False
        Dim SepAmount2 As Double = 0
        Dim SepEarningCode2 As String = ""
        Dim SepDesc2 As String = ""

        Dim ShowSep3 As Boolean = False
        Dim SepAmount3 As Double = 0
        Dim SepEarningCode3 As String = ""
        Dim SepDesc3 As String = ""

        Dim ShowSep4 As Boolean = False
        Dim SepAmount4 As Double = 0
        Dim SepEarningCode4 As String = ""
        Dim SepDesc4 As String = ""

        Dim ShowSep5 As Boolean = False
        Dim SepAmount5 As Double = 0
        Dim SepEarningCode5 As String = ""
        Dim SepDesc5 As String = ""

        Dim ShowSep6 As Boolean = False
        Dim SepAmount6 As Double = 0
        Dim SepEarningCode6 As String = ""
        Dim SepDesc6 As String = ""

        Dim ShowSep7 As Boolean = False
        Dim SepAmount7 As Double = 0
        Dim SepEarningCode7 As String = ""
        Dim SepDesc7 As String = ""

        Dim ShowSep8 As Boolean = False
        Dim SepAmount8 As Double = 0
        Dim SepEarningCode8 As String = ""
        Dim SepDesc8 As String = ""

        Dim ShowSep9 As Boolean = False
        Dim SepAmount9 As Double = 0
        Dim SepEarningCode9 As String = ""
        Dim SepDesc9 As String = ""

        Dim ShowSep10 As Boolean = False
        Dim SepAmount10 As Double = 0
        Dim SepEarningCode10 As String = ""
        Dim SepDesc10 As String = ""
        '--------------------------------------------------------------------------

        ShowBonusSeparatly = Global1.PARAM_IR63_ShowBonusSeparatly
        BonusEarningCode = Global1.PARAM_IR63_BonusEarningCode

        ShowSep1 = Global1.PARAM_IR63_ShowSep1
        SepEarningCode1 = Global1.PARAM_IR63_Sep1Code
        SepDesc1 = Global1.PARAM_IR63_Sep1Desc

        ShowSep2 = Global1.PARAM_IR63_ShowSep2
        SepEarningCode2 = Global1.PARAM_IR63_Sep2Code
        SepDesc2 = Global1.PARAM_IR63_Sep2Desc

        ShowSep3 = Global1.PARAM_IR63_ShowSep3
        SepEarningCode3 = Global1.PARAM_IR63_Sep3Code
        SepDesc3 = Global1.PARAM_IR63_Sep3Desc

        ShowSep4 = Global1.PARAM_IR63_ShowSep4
        SepEarningCode4 = Global1.PARAM_IR63_Sep4Code
        SepDesc4 = Global1.PARAM_IR63_Sep4Desc

        ShowSep5 = Global1.PARAM_IR63_ShowSep5
        SepEarningCode5 = Global1.PARAM_IR63_Sep5Code
        SepDesc5 = Global1.PARAM_IR63_Sep5Desc


        ShowSep6 = Global1.PARAM_IR63_ShowSep6
        SepEarningCode6 = Global1.PARAM_IR63_Sep6Code
        SepDesc6 = Global1.PARAM_IR63_Sep6Desc

        ShowSep7 = Global1.PARAM_IR63_ShowSep7
        SepEarningCode7 = Global1.PARAM_IR63_Sep7Code
        SepDesc7 = Global1.PARAM_IR63_Sep7Desc

        ShowSep8 = Global1.PARAM_IR63_ShowSep8
        SepEarningCode8 = Global1.PARAM_IR63_Sep8Code
        SepDesc8 = Global1.PARAM_IR63_Sep8Desc

        ShowSep9 = Global1.PARAM_IR63_ShowSep9
        SepEarningCode9 = Global1.PARAM_IR63_Sep9Code
        SepDesc9 = Global1.PARAM_IR63_Sep9Desc

        ShowSep10 = Global1.PARAM_IR63_ShowSep10
        SepEarningCode10 = Global1.PARAM_IR63_Sep10Code
        SepDesc10 = Global1.PARAM_IR63_Sep10Desc




        Dim Ds As DataSet
        Dim Str As String
        Dim TotalEarnings As Double
        Dim TICofFund As String = ""
        Str = " SELECT Emp_Code," & _
            " Emp_FullName," & _
            " Emp_Address1," & _
            " Emp_Address2," & _
            " Emp_Address3, " & _
            " Emp_PostCode," & _
            " Emp_SocialInsNumber," & _
            " Emp_IdentificationCard, " & _
            " Emp_TaxID," & _
            " Emp_TerminateDate," & _
            " TemGrp_Code," & _
            " Emp_StartDate," & _
            " Emp_OtherIncome1, " & _
            " '' as DirectorFees, " & _
            " '' as OtherDesc, " & _
            " '' as StartDate, " & _
            " '' as PFFundTIC, " & _
            " '' as ExtraBonus, " & _
            " '' as ExtraBonusDesc, " & _
            " '' as Sep1, " & _
            " '' as Sep1Des, " & _
            " '' as Sep2, " & _
            " '' as Sep2Des, " & _
            " '' as Sep3, " & _
            " '' as Sep3Des, " & _
            " '' as Sep4, " & _
            " '' as Sep4Des, " & _
            " '' as Sep5, " & _
            " '' as Sep5Des, " & _
            " '' as Sep6, " & _
            " '' as Sep6Des, " & _
            " '' as Sep7, " & _
            " '' as Sep7Des, " & _
            " '' as Sep8, " & _
            " '' as Sep8Des, " & _
            " '' as Sep9, " & _
            " '' as Sep9Des, " & _
             " '' as Sep10, " & _
            " '' as Sep10Des, " & _
            " '' as PublicSector, " & _
            " Emp_Code as EmpCode2 " & _
            " FROM PrMsEmployees" & _
            " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

        Ds = GetData(Str)
        If Trim(Global1.GLB_IR63Description) <> "" Then
            If CheckDataSet(Ds) Then
                Ds.Tables(0).Rows(0).Item(14) = Global1.GLB_IR63Description
                Ds.Tables(0).Rows(0).Item(13) = Utils.AddCommaToThousands(Ds.Tables(0).Rows(0).Item(12))
                Ds.Tables(0).Rows(0).Item(12) = 0
            End If
        End If
        If ShowBonusSeparatly Then
            SeparateBonus = RoundMe2(Find_EarningCode_Total_IR63(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, BonusEarningCode), 2)
            If RoundMe2(SeparateBonus, 2) > 0 Then
                Ds.Tables(0).Rows(0).Item(17) = Utils.AddCommaToThousands(SeparateBonus)
                Ds.Tables(0).Rows(0).Item(18) = "Bonus"
            End If
        End If
        '------------------------------------------------------------------------------------------------
        If ShowSep1 Then
            SepAmount1 = RoundMe2(Find_EarningCode_Total_IR63(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode1), 2)
            If RoundMe2(SepAmount1, 2) > 0 Then
                Ds.Tables(0).Rows(0).Item(19) = Utils.AddCommaToThousands(SepAmount1)
                Ds.Tables(0).Rows(0).Item(20) = SepDesc1
            End If
        End If
        If ShowSep2 Then
            SepAmount2 = RoundMe2(Find_EarningCode_Total_IR63(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode2), 2)
            'If RoundMe2(SepAmount2, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(21) = Utils.AddCommaToThousands(SepAmount2)
            Ds.Tables(0).Rows(0).Item(22) = SepDesc2
            'End If
        End If
        If ShowSep3 Then
            SepAmount3 = RoundMe2(Find_EarningCode_Total_IR63(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode3), 2)
            ' If RoundMe2(SepAmount3, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(23) = Utils.AddCommaToThousands(SepAmount3)
            Ds.Tables(0).Rows(0).Item(24) = SepDesc3
            'End If
        End If
        If ShowSep4 Then
            SepAmount4 = RoundMe2(Find_EarningCode_Total_IR63(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode4), 2)
            'If RoundMe2(SepAmount4, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(25) = Utils.AddCommaToThousands(SepAmount4)
            Ds.Tables(0).Rows(0).Item(26) = SepDesc4
            'End If
        End If
        If ShowSep5 Then
            SepAmount5 = RoundMe2(Find_EarningCode_Total_IR63(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode5), 2)
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(27) = Utils.AddCommaToThousands(SepAmount5)
            Ds.Tables(0).Rows(0).Item(28) = SepDesc5
            'End If
        End If
        If ShowSep6 Then
            SepAmount6 = RoundMe2(Find_EarningCode_Total_IR63(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode6), 2)
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(29) = Utils.AddCommaToThousands(SepAmount6)
            Ds.Tables(0).Rows(0).Item(30) = SepDesc6
            'End If
        End If
        If ShowSep7 Then
            SepAmount7 = RoundMe2(Find_EarningCode_Total_IR63(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode7), 2)
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(31) = Utils.AddCommaToThousands(SepAmount7)
            Ds.Tables(0).Rows(0).Item(32) = SepDesc7
            'End If
        End If
        If ShowSep8 Then
            SepAmount8 = RoundMe2(Find_EarningCode_Total_IR63(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode8), 2)
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(33) = Utils.AddCommaToThousands(SepAmount8)
            Ds.Tables(0).Rows(0).Item(34) = SepDesc8
            'End If
        End If
        If ShowSep9 Then
            SepAmount9 = RoundMe2(Find_EarningCode_Total_IR63(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode9), 2)
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(35) = Utils.AddCommaToThousands(SepAmount9)
            Ds.Tables(0).Rows(0).Item(36) = SepDesc9
            'End If
        End If
        If ShowSep10 Then
            SepAmount10 = RoundMe2(Find_EarningCode_Total_IR63(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode10), 2)
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(37) = Utils.AddCommaToThousands(SepAmount10)
            Ds.Tables(0).Rows(0).Item(38) = SepDesc10
            'End If
        End If
        '------------------------------------------------------------------------------------------------
        Ds.Tables(0).Rows(0).Item(39) = Global1.PARAM_PublicSector

        Dim SD As Date
        SD = DbNullToDate(Ds.Tables(0).Rows(0).Item(11))
        ' If SD.Year = PerGrp.Year Then
        Ds.Tables(0).Rows(0).Item(15) = Format(SD, "dd/MM/yyy")
        'Else
        'Ds.Tables(0).Rows(0).Item(15) = ""
        'End If
        Dim TD As String
        TD = DbNullToString(Ds.Tables(0).Rows(0).Item(9))
        If Trim(TD) <> "" Then
            Dim DD As Date
            DD = CDate(TD)
            Ds.Tables(0).Rows(0).Item(9) = Format(DD, "dd/MM/yyy")


        End If

        If CheckDataSet(DsIr7) Then
            Dim i As Integer
            For i = 0 To DsIr7.Tables(0).Rows.Count - 1
                If DsIr7.Tables(0).Rows(i).Item(27) = EmpCode Then
                    Ds.Tables(0).Rows(0).Item(0) = i + 1
                    Exit For

                End If
            Next
        End If

        Ds.Tables(0).TableName = "EmpDetails"
        Dim DsGrossEarnings As DataSet

        'Str = " SELECT SUM(TrxHdr_TaxableIncome)" & _
        '      " FROM  PrTxTrxnHeader" & _
        '      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
        '      " AND (PrdGrp_Code =  " & enQuoteString(PerGrp.Code) & ")"

        Str = " SELECT SUM(TrxHdr_TotalErnPeriod)" & _
             " FROM  PrTxTrxnHeader" & _
             " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
             " AND (PrdGrp_Code =  " & enQuoteString(PerGrp.Code) & ")"

        Dim NonTaxable As Double = 0
        Dim NonInsurable As Double = 0
        NonTaxable = FindNonTaxableTotalForTemplateGroupForEmployee(PerGrp.TemGrpCode, PerGrp.Code, EmpCode)
        ' If NonTaxable = 0 Then
        'NonInsurable = FindNonInsurableTotalForTemplateGroupForEmployee(PerGrp.TemGrpCode, PerGrp.Code, EmpCode)
        ' End If
        Dim OtherIncome1 As Double
        OtherIncome1 = DbNullToDouble(Ds.Tables(0).Rows(0).Item(12))
        If DbNullToString(Ds.Tables(0).Rows(0).Item(13)) <> "" Then
            OtherIncome1 = OtherIncome1 + DbNullToDouble(Ds.Tables(0).Rows(0).Item(13))
        End If

        DsGrossEarnings = GetData(Str)
        If NonTaxable <> 0 Or NonInsurable <> 0 Then
            If CheckDataSet(DsGrossEarnings) Then
                Dim total As Double
                total = DsGrossEarnings.Tables(0).Rows(0).Item(0)
                DsGrossEarnings.Tables(0).Rows(0).Item(0) = total - NonTaxable - NonInsurable

            End If
        End If



        Dim DsSILeave As DataSet
        DsSILeave = Me.FindSILeaveTotalIR63(PerGrp.TemGrpCode, PerGrp.Code, EmpCode)
        Dim SILeaveValue As Double = 0
        If CheckDataSet(DsSILeave) Then
            SILeaveValue = DbNullToDouble(DsSILeave.Tables(0).Rows(0).Item(0))
        End If

        Dim DsBenefitsInKind As DataSet
        DsBenefitsInKind = Me.FindBenefitsInKindTotalIR63(PerGrp.TemGrpCode, PerGrp.Code, EmpCode)
        Dim BenefitsInKind As Double = 0
        If CheckDataSet(DsBenefitsInKind) Then
            BenefitsInKind = DbNullToDouble(DsBenefitsInKind.Tables(0).Rows(0).Item(0))
        End If

        ' Ds.Tables(0).Rows(0).Item(17) = BenefitsInKind
        Ds.Tables(0).Rows(0).Item(12) = DbNullToDouble(Ds.Tables(0).Rows(0).Item(12)) + BenefitsInKind

        Dim total2 As Double

        total2 = DbNullToDouble(DsGrossEarnings.Tables(0).Rows(0).Item(0))

        DsGrossEarnings.Tables(0).Rows(0).Item(0) = total2 + SILeaveValue - SeparateBonus - SepAmount1 - SepAmount2 - SepAmount3 - SepAmount4 - SepAmount5 - SepAmount6 - SepAmount7 - SepAmount8 - SepAmount9 - SepAmount10

        TotalEarnings = total2 + SILeaveValue + OtherIncome1 + BenefitsInKind


        Ds.Tables.Add(DsGrossEarnings.Tables(0).Copy)
        Ds.Tables(1).TableName = "GrossEarnings"

        Dim DsPF As DataSet = GetSumsOfEmployeeDeductions("PF", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsPF.Tables(0).Copy)
        Ds.Tables(2).TableName = "PF_Deductions"


        Dim DsMF As DataSet = GetSumsOfEmployeeDeductions("MF", EmpCode, PerGrp.Code)
        Dim DsUMF As DataSet = GetSumsOfEmployeeDeductions("UM", EmpCode, PerGrp.Code)
        If CheckDataSet(DsUMF) Then
            If CheckDataSet(DsMF) Then
                DsMF.Tables(0).Rows(0).Item(0) = DbNullToDouble(DsMF.Tables(0).Rows(0).Item(0)) + DbNullToDouble(DsUMF.Tables(0).Rows(0).Item(0))
            End If
        End If
        Ds.Tables.Add(DsMF.Tables(0).Copy)
        Ds.Tables(3).TableName = "MF_Deductions"

        Dim DsSI As DataSet = GetSumsOfEmployeeDeductions("SI", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsSI.Tables(0).Copy)
        Ds.Tables(4).TableName = "SI_Deductions"

        Dim DsIT As DataSet = GetSumsOfEmployeeDeductions("IT", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsIT.Tables(0).Copy)
        Ds.Tables(5).TableName = "IT_Deductions"

        Dim DsUnion As DataSet = GetSumsOfEmployeeDeductions("US", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsUnion.Tables(0).Copy)
        Ds.Tables(6).TableName = "Union_Deductions"

        Dim DsTotal As DataSet = GetSumsOfEmployeeDeductions("SI", EmpCode, PerGrp.Code)
        DsTotal.Tables(0).Rows(0).Item(0) = TotalEarnings
        Ds.Tables.Add(DsTotal.Tables(0).Copy)
        Ds.Tables(7).TableName = "TotalEarnings"





        Dim DsComp As DataSet
        Str = " SELECT AdMsCompany.Com_Name," & _
            " AdMsCompany.Com_TIC," & _
            " AdMsCompany.Com_Address1," & _
            " AdMsCompany.Com_Address2, " & _
            " AdMsCompany.Com_Address3," & _
            " AdMsCompany.Com_Address4," & _
            " AdMsCompany.Com_AccountantTitle," & _
            " PrMsTemplateGroup.TemGrp_Code," & _
            " AdMsCompany.Com_AccIdentity," & _
            " '' as Identity1, " & _
            " AdMsCompany.Com_GLAnal4, " & _
            " AdMsCompany.Com_Stamp, " & _
            " '' as PrintDate " & _
            " FROM AdMsCompany INNER JOIN" & _
            " PrMsTemplateGroup ON " & _
            " AdMsCompany.Com_Code = PrMsTemplateGroup.Com_Code" & _
            " WHERE (PrMsTemplateGroup.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

        DsComp = GetData(Str)
        If CheckDataSet(DsComp) Then
            Dim DsP As DataSet
            DsP = Global1.Business.GetParameter("IR63", "Designation")
            If CheckDataSet(DsP) Then
                Dim Par As New cPrSsParameters(DsP.Tables(0).Rows(0))
                Dim DescP As String
                DescP = Par.Value1
                DsComp.Tables(0).Rows(0).Item(9) = DescP
            End If

            DsComp.Tables(0).Rows(0).Item(6) = Name_OnIR63
            DsComp.Tables(0).Rows(0).Item(9) = Designation_OnIR63

            DsComp.Tables(0).Rows(0).Item(12) = PrintDate_OnIR63

            TICofFund = DbNullToString(DsComp.Tables(0).Rows(0).Item(10))


            'Select Case DsComp.Tables(0).Rows(0).Item(8)
            '    Case "1"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Manager/Director"
            '    Case "2"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Secretary"
            '    Case "3"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Partner"
            '    Case "4"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Authorized Representative"
            '    Case "0"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Not Applicable"
            'End Select
        End If
        Ds.Tables.Add(DsComp.Tables(0).Copy)
        Ds.Tables(8).TableName = "CompanyDetails"

        Dim DsYear As DataSet
        Str = " SELECT PrdGpr_Year" & _
              " FROM PrMsPeriodGroups" & _
              " where PrdGrp_Code=" & enQuoteString(PerGrp.Code)

        DsYear = GetData(Str)
        Ds.Tables.Add(DsYear.Tables(0).Copy)
        Ds.Tables(9).TableName = "Year"

        Dim DsSpecialTax As DataSet = GetSumsOfEmployeeDeductions("EX", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsSpecialTax.Tables(0).Copy)
        Ds.Tables(10).TableName = "SpecialTax_Deductions"

        Dim DsSpecialTaxCon As DataSet = GetSumsOfEmployeeContributions("EX", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsSpecialTaxCon.Tables(0).Copy)
        Ds.Tables(11).TableName = "SpecialTax_Contribution"

        If CheckDataSet(DsPF) Then
            If DbNullToDouble(DsPF.Tables(0).Rows(0).Item(0)) <> 0 Then
                If CheckDataSet(Ds) Then
                    Ds.Tables(0).Rows(0).Item(16) = TICofFund
                End If
            End If
        End If

        Dim DsPEN As DataSet = GetSumsOfEmployeeDeductions("PN", EmpCode, PerGrp.Code)
        Dim DsWO As DataSet = GetSumsOfEmployeeDeductions("WO", EmpCode, PerGrp.Code)
        If CheckDataSet(DsPEN) Then
            If CheckDataSet(DsWO) Then
                DsPEN.Tables(0).Rows(0).Item(0) = DbNullToDouble(DsPEN.Tables(0).Rows(0).Item(0)) + DbNullToDouble(DsWO.Tables(0).Rows(0).Item(0))
            End If
        End If
        Ds.Tables.Add(DsPEN.Tables(0).Copy)
        Ds.Tables(12).TableName = "PNWO_Deductions"

        Dim DsDN As DataSet = GetSumsOfEmployeeDeductions("DN", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsDN.Tables(0).Copy)
        Ds.Tables(13).TableName = "Decrease_Deductions"

        Dim DsGESY As DataSet = GetSumsOfEmployeeDeductions("GD", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsGESY.Tables(0).Copy)
        Ds.Tables(14).TableName = "GESY_Deductions"

        Dim DsBIKGESY As DataSet = GetSumsOfEmployeeDeductions("GT", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsBIKGESY.Tables(0).Copy)
        Ds.Tables(15).TableName = "BIKGESY_Deductions"

        'savvasir63

        Return Ds
    End Function
    Protected Function REPORT_IR63A_2019(ByVal PerGrp As cPrMsPeriodGroups, ByVal EmpCode As String, ByVal DsIr7 As DataSet, ByVal Name_OnIR63 As String, ByVal Designation_OnIR63 As String, ByVal PrintDate_OnIr63 As String) As DataSet
        Dim ShowBonusSeparatly As Boolean = False
        Dim SeparateBonus As Double = 0
        Dim SeparateBonus_12 As Double = 0
        Dim BonusEarningCode As String = ""
        '--------------------------------------------------------------------------
        Dim ShowSep1 As Boolean = False
        Dim SepAmount1 As Double = 0
        Dim SepAmount1_12 As Double = 0
        Dim SepEarningCode1 As String = ""
        Dim SepDesc1 As String = ""

        Dim ShowSep2 As Boolean = False
        Dim SepAmount2 As Double = 0
        Dim SepAmount2_12 As Double = 0
        Dim SepEarningCode2 As String = ""
        Dim SepDesc2 As String = ""

        Dim ShowSep3 As Boolean = False
        Dim SepAmount3 As Double = 0
        Dim SepAmount3_12 As Double = 0
        Dim SepEarningCode3 As String = ""
        Dim SepDesc3 As String = ""

        Dim ShowSep4 As Boolean = False
        Dim SepAmount4 As Double = 0
        Dim SepAmount4_12 As Double = 0
        Dim SepEarningCode4 As String = ""
        Dim SepDesc4 As String = ""

        Dim ShowSep5 As Boolean = False
        Dim SepAmount5 As Double = 0
        Dim SepAmount5_12 As Double = 0
        Dim SepEarningCode5 As String = ""
        Dim SepDesc5 As String = ""

        Dim ShowSep6 As Boolean = False
        Dim SepAmount6 As Double = 0
        Dim SepAmount6_12 As Double = 0
        Dim SepEarningCode6 As String = ""
        Dim SepDesc6 As String = ""

        Dim ShowSep7 As Boolean = False
        Dim SepAmount7 As Double = 0
        Dim SepAmount7_12 As Double = 0
        Dim SepEarningCode7 As String = ""
        Dim SepDesc7 As String = ""

        Dim ShowSep8 As Boolean = False
        Dim SepAmount8 As Double = 0
        Dim SepAmount8_12 As Double = 0
        Dim SepEarningCode8 As String = ""
        Dim SepDesc8 As String = ""

        Dim ShowSep9 As Boolean = False
        Dim SepAmount9 As Double = 0
        Dim SepAmount9_12 As Double = 0
        Dim SepEarningCode9 As String = ""
        Dim SepDesc9 As String = ""

        Dim ShowSep10 As Boolean = False
        Dim SepAmount10 As Double = 0
        Dim SepAmount10_12 As Double = 0

        Dim SepEarningCode10 As String = ""
        Dim SepDesc10 As String = ""



        Dim JanPeriod As String = PerGrp.Year & "01"
        Dim FebPeriod As String = PerGrp.Year & "02"
        '--------------------------------------------------------------------------
        Dim D1 As Date = CDate("01/01/" & PerGrp.Year)
        Dim D2 As Date = CDate("03/01/" & PerGrp.Year)
        D2 = DateAdd(DateInterval.Day, -1, D2)

        Dim D3 As Date = CDate("03/01/" & PerGrp.Year)
        Dim D4 As Date = CDate("12/31/" & PerGrp.Year)
        '--------------------------------------------------------------------------


        ShowBonusSeparatly = Global1.PARAM_IR63_ShowBonusSeparatly
        BonusEarningCode = Global1.PARAM_IR63_BonusEarningCode

        ShowSep1 = Global1.PARAM_IR63_ShowSep1
        SepEarningCode1 = Global1.PARAM_IR63_Sep1Code
        SepDesc1 = Global1.PARAM_IR63_Sep1Desc

        ShowSep2 = Global1.PARAM_IR63_ShowSep2
        SepEarningCode2 = Global1.PARAM_IR63_Sep2Code
        SepDesc2 = Global1.PARAM_IR63_Sep2Desc

        ShowSep3 = Global1.PARAM_IR63_ShowSep3
        SepEarningCode3 = Global1.PARAM_IR63_Sep3Code
        SepDesc3 = Global1.PARAM_IR63_Sep3Desc

        ShowSep4 = Global1.PARAM_IR63_ShowSep4
        SepEarningCode4 = Global1.PARAM_IR63_Sep4Code
        SepDesc4 = Global1.PARAM_IR63_Sep4Desc

        ShowSep5 = Global1.PARAM_IR63_ShowSep5
        SepEarningCode5 = Global1.PARAM_IR63_Sep5Code
        SepDesc5 = Global1.PARAM_IR63_Sep5Desc


        ShowSep6 = Global1.PARAM_IR63_ShowSep6
        SepEarningCode6 = Global1.PARAM_IR63_Sep6Code
        SepDesc6 = Global1.PARAM_IR63_Sep6Desc

        ShowSep7 = Global1.PARAM_IR63_ShowSep7
        SepEarningCode7 = Global1.PARAM_IR63_Sep7Code
        SepDesc7 = Global1.PARAM_IR63_Sep7Desc

        ShowSep8 = Global1.PARAM_IR63_ShowSep8
        SepEarningCode8 = Global1.PARAM_IR63_Sep8Code
        SepDesc8 = Global1.PARAM_IR63_Sep8Desc

        ShowSep9 = Global1.PARAM_IR63_ShowSep9
        SepEarningCode9 = Global1.PARAM_IR63_Sep9Code
        SepDesc9 = Global1.PARAM_IR63_Sep9Desc

        ShowSep10 = Global1.PARAM_IR63_ShowSep10
        SepEarningCode10 = Global1.PARAM_IR63_Sep10Code
        SepDesc10 = Global1.PARAM_IR63_Sep10Desc




        Dim Ds As DataSet
        Dim Str As String
        Dim Str_12 As String
        Dim TotalEarnings As Double
        Dim TotalEarnings_12 As Double

        Dim TICofFund As String = ""
        Str = " SELECT Emp_Code," & _
            " Emp_FullName," & _
            " Emp_Address1," & _
            " Emp_Address2," & _
            " Emp_Address3, " & _
            " Emp_PostCode," & _
            " Emp_SocialInsNumber," & _
            " Emp_IdentificationCard, " & _
            " Emp_TaxID," & _
            " Emp_TerminateDate," & _
            " TemGrp_Code," & _
            " Emp_StartDate," & _
            " Emp_OtherIncome1, " & _
            " '' as DirectorFees, " & _
            " '' as OtherDesc, " & _
            " '' as StartDate, " & _
            " '' as PFFundTIC, " & _
            " '' as ExtraBonus, " & _
            " '' as ExtraBonusDesc, " & _
            " '' as Sep1, " & _
            " '' as Sep1Des, " & _
            " '' as Sep2, " & _
            " '' as Sep2Des, " & _
            " '' as Sep3, " & _
            " '' as Sep3Des, " & _
            " '' as Sep4, " & _
            " '' as Sep4Des, " & _
            " '' as Sep5, " & _
            " '' as Sep5Des, " & _
            " '' as Sep6, " & _
            " '' as Sep6Des, " & _
            " '' as Sep7, " & _
            " '' as Sep7Des, " & _
            " '' as Sep8, " & _
            " '' as Sep8Des, " & _
            " '' as Sep9, " & _
            " '' as Sep9Des, " & _
             " '' as Sep10, " & _
            " '' as Sep10Des, " & _
            " '' as ExtraBonus_12, " & _
            " '' as Sep1_12, " & _
            " '' as Sep2_12, " & _
            " '' as Sep3_12, " & _
            " '' as Sep4_12, " & _
            " '' as Sep5_12, " & _
            " '' as Sep6_12, " & _
            " '' as Sep7_12, " & _
            " '' as Sep8_12, " & _
            " '' as Sep9_12, " & _
            " '' as Sep10_12, " & _
            " '' As OtherIncome1_12," & _
            " '' as PublicSector," & _
            " Emp_Code as EmpCode2 " & _
            " FROM PrMsEmployees" & _
            " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

        Ds = GetData(Str)
        If Trim(Global1.GLB_IR63Description) <> "" Then
            If CheckDataSet(Ds) Then
                Ds.Tables(0).Rows(0).Item(14) = Global1.GLB_IR63Description
                Ds.Tables(0).Rows(0).Item(13) = Utils.AddCommaToThousands(Ds.Tables(0).Rows(0).Item(12))
                Ds.Tables(0).Rows(0).Item(12) = 0
            End If
        End If
        If ShowBonusSeparatly Then
            SeparateBonus = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, BonusEarningCode, JanPeriod, FebPeriod), 2)
            '39
            SeparateBonus_12 = RoundMe2(Find_EarningCode_Total_IR63_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, BonusEarningCode, JanPeriod, FebPeriod), 2)
            ' SeparateBonus = SeparateBonus - SeparateBonus_12
            If RoundMe2(SeparateBonus, 2) > 0 Or RoundMe2(SeparateBonus_12, 2) > 0 Then
                Ds.Tables(0).Rows(0).Item(17) = Utils.AddCommaToThousands(SeparateBonus)
                Ds.Tables(0).Rows(0).Item(18) = "Bonus"
                Ds.Tables(0).Rows(0).Item(39) = Utils.AddCommaToThousands(SeparateBonus_12)
            End If
        End If
        '------------------------------------------------------------------------------------------------
        If ShowSep1 Then
            SepAmount1 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode1, JanPeriod, FebPeriod), 2)
            '40
            SepAmount1_12 = RoundMe2(Find_EarningCode_Total_IR63_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode1, JanPeriod, FebPeriod), 2)
            ' SepAmount1 = SepAmount1 - SepAmount1_12
            If RoundMe2(SepAmount1, 2) > 0 Or RoundMe2(SepAmount1_12, 2) > 0 Then
                Ds.Tables(0).Rows(0).Item(19) = Utils.AddCommaToThousands(SepAmount1)
                Ds.Tables(0).Rows(0).Item(20) = SepDesc1
                Ds.Tables(0).Rows(0).Item(40) = Utils.AddCommaToThousands(SepAmount1_12)
            End If
        End If
        If ShowSep2 Then
            SepAmount2 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode2, JanPeriod, FebPeriod), 2)
            '41
            SepAmount2_12 = RoundMe2(Find_EarningCode_Total_IR63_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode2, JanPeriod, FebPeriod), 2)
            ' SepAmount2 = SepAmount2 - SepAmount2_12
            Ds.Tables(0).Rows(0).Item(21) = Utils.AddCommaToThousands(SepAmount2)
            Ds.Tables(0).Rows(0).Item(22) = SepDesc2
            Ds.Tables(0).Rows(0).Item(41) = Utils.AddCommaToThousands(SepAmount2_12)

            'End If
        End If
        If ShowSep3 Then
            SepAmount3 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode3, JanPeriod, FebPeriod), 2)
            '42
            SepAmount3_12 = RoundMe2(Find_EarningCode_Total_IR63_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode3, JanPeriod, FebPeriod), 2)
            ' SepAmount3 = SepAmount3 - SepAmount3_12
            ' If RoundMe2(SepAmount3, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(23) = Utils.AddCommaToThousands(SepAmount3)
            Ds.Tables(0).Rows(0).Item(24) = SepDesc3
            Ds.Tables(0).Rows(0).Item(42) = Utils.AddCommaToThousands(SepAmount3_12)
            'End If
        End If
        If ShowSep4 Then
            SepAmount4 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode4, JanPeriod, FebPeriod), 2)
            '43
            SepAmount4_12 = RoundMe2(Find_EarningCode_Total_IR63_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode4, JanPeriod, FebPeriod), 2)
            ' SepAmount4 = SepAmount4 - SepAmount4_12
            'If RoundMe2(SepAmount4, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(25) = Utils.AddCommaToThousands(SepAmount4)
            Ds.Tables(0).Rows(0).Item(26) = SepDesc4
            Ds.Tables(0).Rows(0).Item(43) = Utils.AddCommaToThousands(SepAmount4_12)
            'End If
        End If
        If ShowSep5 Then
            SepAmount5 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode5, JanPeriod, FebPeriod), 2)
            '44
            SepAmount5_12 = RoundMe2(Find_EarningCode_Total_IR63_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode5, JanPeriod, FebPeriod), 2)
            ' SepAmount5 = SepAmount5 - SepAmount5_12
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(27) = Utils.AddCommaToThousands(SepAmount5)
            Ds.Tables(0).Rows(0).Item(28) = SepDesc5
            Ds.Tables(0).Rows(0).Item(44) = Utils.AddCommaToThousands(SepAmount5_12)
            'End If
        End If
        If ShowSep6 Then
            SepAmount6 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode6, JanPeriod, FebPeriod), 2)
            '45
            SepAmount6_12 = RoundMe2(Find_EarningCode_Total_IR63_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode6, JanPeriod, FebPeriod), 2)
            ' SepAmount6 = SepAmount6 - SepAmount6_12
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(29) = Utils.AddCommaToThousands(SepAmount6)
            Ds.Tables(0).Rows(0).Item(30) = SepDesc6
            Ds.Tables(0).Rows(0).Item(45) = Utils.AddCommaToThousands(SepAmount6_12)
            'End If
        End If
        If ShowSep7 Then
            SepAmount7 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode7, JanPeriod, FebPeriod), 2)
            '46
            SepAmount7_12 = RoundMe2(Find_EarningCode_Total_IR63_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode7, JanPeriod, FebPeriod), 2)
            'SepAmount7 = SepAmount7 - SepAmount7_12
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(31) = Utils.AddCommaToThousands(SepAmount7)
            Ds.Tables(0).Rows(0).Item(32) = SepDesc7
            Ds.Tables(0).Rows(0).Item(46) = Utils.AddCommaToThousands(SepAmount7_12)
            'End If
        End If
        If ShowSep8 Then
            SepAmount8 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode8, JanPeriod, FebPeriod), 2)
            '47
            SepAmount8_12 = RoundMe2(Find_EarningCode_Total_IR63_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode8, JanPeriod, FebPeriod), 2)
            ' SepAmount8 = SepAmount8 - SepAmount8_12
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(33) = Utils.AddCommaToThousands(SepAmount8)
            Ds.Tables(0).Rows(0).Item(34) = SepDesc8
            Ds.Tables(0).Rows(0).Item(47) = Utils.AddCommaToThousands(SepAmount8_12)
            'End If
        End If
        If ShowSep9 Then
            SepAmount9 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode9, JanPeriod, FebPeriod), 2)
            '48
            SepAmount9_12 = RoundMe2(Find_EarningCode_Total_IR63_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode9, JanPeriod, FebPeriod), 2)
            'SepAmount9 = SepAmount9 - SepAmount9_12
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(35) = Utils.AddCommaToThousands(SepAmount9)
            Ds.Tables(0).Rows(0).Item(36) = SepDesc9
            Ds.Tables(0).Rows(0).Item(48) = Utils.AddCommaToThousands(SepAmount9_12)
            'End If
        End If
        If ShowSep10 Then
            SepAmount10 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode10, JanPeriod, FebPeriod), 2)
            '49
            SepAmount10_12 = RoundMe2(Find_EarningCode_Total_IR63_JanANDFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode10, JanPeriod, FebPeriod), 2)
            ' SepAmount10 = SepAmount10 - SepAmount10_12
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(37) = Utils.AddCommaToThousands(SepAmount10)
            Ds.Tables(0).Rows(0).Item(38) = SepDesc10
            Ds.Tables(0).Rows(0).Item(49) = Utils.AddCommaToThousands(SepAmount10_12)
            'End If
        End If

        Ds.Tables(0).Rows(0).Item(51) = Global1.PARAM_PublicSector
        '------------------------------------------------------------------------------------------------


        Dim SD As Date
        SD = DbNullToDate(Ds.Tables(0).Rows(0).Item(11))
        ' If SD.Year = PerGrp.Year Then
        Ds.Tables(0).Rows(0).Item(15) = Format(SD, "dd/MM/yyy")
        'Else
        'Ds.Tables(0).Rows(0).Item(15) = ""
        'End If
        Dim TD As String
        TD = DbNullToString(Ds.Tables(0).Rows(0).Item(9))
        If Trim(TD) <> "" Then
            Dim DD As Date
            DD = CDate(TD)
            Ds.Tables(0).Rows(0).Item(9) = Format(DD, "dd/MM/yyy")


        End If

        If CheckDataSet(DsIr7) Then
            Dim i As Integer
            For i = 0 To DsIr7.Tables(0).Rows.Count - 1
                If DsIr7.Tables(0).Rows(i).Item(27) = EmpCode Then
                    Ds.Tables(0).Rows(0).Item(0) = i + 1
                    Exit For
                End If
            Next
        End If
        Ds.Tables(0).TableName = "EmpDetails"
        Dim DsGrossEarnings As DataSet
        Dim DsGrossEarnings_12 As DataSet

        'Str = " SELECT SUM(TrxHdr_TaxableIncome)" & _
        '      " FROM  PrTxTrxnHeader" & _
        '      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
        '      " AND (PrdGrp_Code =  " & enQuoteString(PerGrp.Code) & ")"

        Str = " SELECT SUM(TrxHdr_TotalErnPeriod)" & _
             " FROM  PrTxTrxnHeader" & _
             " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
             " AND (PrdGrp_Code =  " & enQuoteString(PerGrp.Code) & ")" & _
            " AND (PrdCod_Code <>  " & enQuoteString(JanPeriod) & " AND " & " PrdCod_Code <>  " & enQuoteString(FebPeriod) & ")"


        Str_12 = " SELECT SUM(TrxHdr_TotalErnPeriod)" & _
            " FROM  PrTxTrxnHeader" & _
            " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (PrdGrp_Code =  " & enQuoteString(PerGrp.Code) & ")" & _
            " AND (PrdCod_Code =  " & enQuoteString(JanPeriod) & " OR " & " PrdCod_Code =  " & enQuoteString(FebPeriod) & ")"

        Dim NonTaxable As Double = 0
        Dim NonTaxable_12 As Double = 0
        Dim NonInsurable As Double = 0
        NonTaxable = FindNonTaxableTotalForTemplateGroupForEmployee_NOT_JanAndFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, JanPeriod, FebPeriod)
        NonTaxable_12 = FindNonTaxableTotalForTemplateGroupForEmployee_JanAndFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, JanPeriod, FebPeriod)

        ' If NonTaxable = 0 Then
        'NonInsurable = FindNonInsurableTotalForTemplateGroupForEmployee(PerGrp.TemGrpCode, PerGrp.Code, EmpCode)
        ' End If
        Dim OtherIncome1 As Double
        OtherIncome1 = DbNullToDouble(Ds.Tables(0).Rows(0).Item(12))
        If DbNullToString(Ds.Tables(0).Rows(0).Item(13)) <> "" Then
            OtherIncome1 = OtherIncome1 + DbNullToDouble(Ds.Tables(0).Rows(0).Item(13))
        End If

        Dim TotalGross_12 As Double = 0
        ''''''''''''''''''''''''''''''''''''''''''''''
        '             Gross                          '
        ''''''''''''''''''''''''''''''''''''''''''''''
        DsGrossEarnings_12 = GetData(Str_12)
        If NonTaxable_12 <> 0 Then
            If CheckDataSet(DsGrossEarnings_12) Then
                Dim total_12 As Double
                total_12 = DbNullToDouble(DsGrossEarnings_12.Tables(0).Rows(0).Item(0))
                TotalGross_12 = RoundMe2(total_12 - NonTaxable_12, 2)
                DsGrossEarnings_12.Tables(0).Rows(0).Item(0) = TotalGross_12
            End If
        End If

        DsGrossEarnings = GetData(Str)
        If NonTaxable <> 0 Then
            If CheckDataSet(DsGrossEarnings) Then
                Dim total As Double
                total = DbNullToDouble(DsGrossEarnings.Tables(0).Rows(0).Item(0))
                total = RoundMe2(total - NonTaxable, 2)
                DsGrossEarnings.Tables(0).Rows(0).Item(0) = total

            End If
        End If

        ''''''''''''''''''''''''''''''''''''''''''''''
        '             SI Leave                       '
        ''''''''''''''''''''''''''''''''''''''''''''''
        Dim DsSILeave_12 As DataSet

        DsSILeave_12 = Me.FindSILeaveTotalIR63_JanAndFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, JanPeriod, FebPeriod)
        Dim SILeaveValue_12 As Double = 0
        If CheckDataSet(DsSILeave_12) Then
            SILeaveValue_12 = DbNullToDouble(DsSILeave_12.Tables(0).Rows(0).Item(0))
        End If

        Dim DsSILeave As DataSet
        DsSILeave = Me.FindSILeaveTotalIR63_NOT_JanAndFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, JanPeriod, FebPeriod)
        Dim SILeaveValue As Double = 0
        If CheckDataSet(DsSILeave) Then
            SILeaveValue = DbNullToDouble(DsSILeave.Tables(0).Rows(0).Item(0))
        End If
        ''''''''''''''''''''''''''''''''''''''''''''''
        '             Benifits In Kind               '
        ''''''''''''''''''''''''''''''''''''''''''''''
        Dim DsBenefitsInKind_12 As DataSet
        DsBenefitsInKind_12 = Me.FindBenefitsInKindTotalIR63_JanAndFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, JanPeriod, FebPeriod)
        Dim BenefitsInKind_12 As Double = 0
        If CheckDataSet(DsBenefitsInKind_12) Then
            BenefitsInKind_12 = DbNullToDouble(DsBenefitsInKind_12.Tables(0).Rows(0).Item(0))
        End If

        Dim DsBenefitsInKind As DataSet
        DsBenefitsInKind = Me.FindBenefitsInKindTotalIR63_NOT_JanAndFeb(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, JanPeriod, FebPeriod)
        Dim BenefitsInKind As Double = 0
        If CheckDataSet(DsBenefitsInKind) Then
            BenefitsInKind = DbNullToDouble(DsBenefitsInKind.Tables(0).Rows(0).Item(0))
        End If

        ' Ds.Tables(0).Rows(0).Item(17) = BenefitsInKind
        Ds.Tables(0).Rows(0).Item(12) = DbNullToDouble(Ds.Tables(0).Rows(0).Item(12)) + BenefitsInKind
        Ds.Tables(0).Rows(0).Item(50) = BenefitsInKind_12
        ''''''''''''''''''''''''''''''''''''''''''''''

        Dim total2 As Double
        Dim total2_12 As Double

        total2 = DbNullToDouble(DsGrossEarnings.Tables(0).Rows(0).Item(0))
        total2_12 = DbNullToDouble(DsGrossEarnings_12.Tables(0).Rows(0).Item(0))

        Dim TempTotal_12 As Double = 0
        TempTotal_12 = total2_12 + SILeaveValue_12 - SeparateBonus_12 - SepAmount1_12 - SepAmount2_12 - SepAmount3_12 - SepAmount4_12 - SepAmount5_12 - SepAmount6_12 - SepAmount7_12 - SepAmount8_12 - SepAmount9_12 - SepAmount10_12
        DsGrossEarnings_12.Tables(0).Rows(0).Item(0) = TempTotal_12
        DsGrossEarnings.Tables(0).Rows(0).Item(0) = total2 + SILeaveValue - SeparateBonus - SepAmount1 - SepAmount2 - SepAmount3 - SepAmount4 - SepAmount5 - SepAmount6 - SepAmount7 - SepAmount8 - SepAmount9 - SepAmount10 '- (TempTotal_12)


        TotalEarnings_12 = total2_12 + SILeaveValue_12 + BenefitsInKind_12
        TotalEarnings = total2 + SILeaveValue + OtherIncome1 + BenefitsInKind '- TotalEarnings_12

        Dim GrandTotal As Double = 0
        GrandTotal = TotalEarnings_12 + TotalEarnings


        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        Ds.Tables.Add(DsGrossEarnings.Tables(0).Copy)
        Ds.Tables(1).TableName = "GrossEarnings"
        'savvasIR62
        '       xxxxx()

        Dim DsPF As DataSet = GetSumsOfEmployeeDeductions("PF", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsPF.Tables(0).Copy)
        Ds.Tables(2).TableName = "PF_Deductions"



        Dim DsMF As DataSet = GetSumsOfEmployeeDeductions("MF", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsMF.Tables(0).Copy)
        Ds.Tables(3).TableName = "MF_Deductions"

        Dim DsSI As DataSet = GetSumsOfEmployeeDeductions("SI", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsSI.Tables(0).Copy)
        Ds.Tables(4).TableName = "SI_Deductions"

        Dim DsIT As DataSet = GetSumsOfEmployeeDeductions("IT", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsIT.Tables(0).Copy)
        Ds.Tables(5).TableName = "IT_Deductions"

        Dim DsUnion As DataSet = GetSumsOfEmployeeDeductions("US", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsUnion.Tables(0).Copy)
        Ds.Tables(6).TableName = "Union_Deductions"

        Dim DsTotal As DataSet = GetSumsOfEmployeeDeductions("SI", EmpCode, PerGrp.Code)
        DsTotal.Tables(0).Rows(0).Item(0) = Utils.AddCommaToThousands(TotalEarnings)

        Ds.Tables.Add(DsTotal.Tables(0).Copy)
        Ds.Tables(7).TableName = "TotalEarnings"

        Dim DsTotal_12 As DataSet = GetSumsOfEmployeeDeductions("SI", EmpCode, PerGrp.Code)
        DsTotal_12.Tables(0).Rows(0).Item(0) = Utils.AddCommaToThousands(TotalEarnings_12)

        Dim DsGrand As DataSet = GetSumsOfEmployeeDeductions("SI", EmpCode, PerGrp.Code)
        DsGrand.Tables(0).Rows(0).Item(0) = Utils.AddCommaToThousands(GrandTotal)




        'added at the end

        Dim DsComp As DataSet
        Str = " SELECT AdMsCompany.Com_Name," & _
            " AdMsCompany.Com_TIC," & _
            " AdMsCompany.Com_Address1," & _
            " AdMsCompany.Com_Address2, " & _
            " AdMsCompany.Com_Address3," & _
            " AdMsCompany.Com_Address4," & _
            " AdMsCompany.Com_AccountantTitle," & _
            " PrMsTemplateGroup.TemGrp_Code," & _
            " AdMsCompany.Com_AccIdentity," & _
            " '' as Identity1, " & _
            " AdMsCompany.Com_GLAnal4, " & _
            " '' as FromP1," & _
            " '' as FromP2, " & _
            " AdMsCompany.Com_Stamp, " & _
            " '' as PrintDate " & _
            " FROM AdMsCompany INNER JOIN" & _
            " PrMsTemplateGroup ON " & _
            " AdMsCompany.Com_Code = PrMsTemplateGroup.Com_Code" & _
            " WHERE (PrMsTemplateGroup.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

        DsComp = GetData(Str)
        If CheckDataSet(DsComp) Then
            Dim DsP As DataSet
            DsP = Global1.Business.GetParameter("IR63", "Designation")
            If CheckDataSet(DsP) Then
                Dim Par As New cPrSsParameters(DsP.Tables(0).Rows(0))
                Dim DescP As String
                DescP = Par.Value1
                DsComp.Tables(0).Rows(0).Item(9) = DescP
            End If

            DsComp.Tables(0).Rows(0).Item(6) = Name_OnIR63
            DsComp.Tables(0).Rows(0).Item(9) = Designation_OnIR63
            DsComp.Tables(0).Rows(0).Item(14) = PrintDate_OnIr63

            TICofFund = DbNullToString(DsComp.Tables(0).Rows(0).Item(10))

            DsComp.Tables(0).Rows(0).Item(11) = Format(D1, "dd/MM") & " - " & Format(D2, "dd/MM/yyyy")
            DsComp.Tables(0).Rows(0).Item(12) = Format(D3, "dd/MM") & " - " & Format(D4, "dd/MM/yyyy")
            'Select Case DsComp.Tables(0).Rows(0).Item(8)
            '    Case "1"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Manager/Director"
            '    Case "2"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Secretary"
            '    Case "3"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Partner"
            '    Case "4"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Authorized Representative"
            '    Case "0"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Not Applicable"
            'End Select
        End If
        Ds.Tables.Add(DsComp.Tables(0).Copy)
        Ds.Tables(8).TableName = "CompanyDetails"

        Dim DsYear As DataSet
        Str = " SELECT PrdGpr_Year" & _
              " FROM PrMsPeriodGroups" & _
              " where PrdGrp_Code=" & enQuoteString(PerGrp.Code)

        DsYear = GetData(Str)
        Ds.Tables.Add(DsYear.Tables(0).Copy)
        Ds.Tables(9).TableName = "Year"

        Dim DsSpecialTax As DataSet = GetSumsOfEmployeeDeductions("EX", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsSpecialTax.Tables(0).Copy)
        Ds.Tables(10).TableName = "SpecialTax_Deductions"

        Dim DsSpecialTaxCon As DataSet = GetSumsOfEmployeeContributions("EX", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsSpecialTaxCon.Tables(0).Copy)
        Ds.Tables(11).TableName = "SpecialTax_Contribution"

        If CheckDataSet(DsPF) Then
            If DbNullToDouble(DsPF.Tables(0).Rows(0).Item(0)) <> 0 Then
                If CheckDataSet(Ds) Then
                    Ds.Tables(0).Rows(0).Item(16) = TICofFund
                End If
            End If
        End If

        Dim DsPEN As DataSet = GetSumsOfEmployeeDeductions("PN", EmpCode, PerGrp.Code)
        Dim DsWO As DataSet = GetSumsOfEmployeeDeductions("WO", EmpCode, PerGrp.Code)
        If CheckDataSet(DsPEN) Then
            If CheckDataSet(DsWO) Then
                DsPEN.Tables(0).Rows(0).Item(0) = DbNullToDouble(DsPEN.Tables(0).Rows(0).Item(0)) + DbNullToDouble(DsWO.Tables(0).Rows(0).Item(0))
            End If
        End If
        Ds.Tables.Add(DsPEN.Tables(0).Copy)
        Ds.Tables(12).TableName = "PNWO_Deductions"

        Dim DsDN As DataSet = GetSumsOfEmployeeDeductions("DN", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsDN.Tables(0).Copy)
        Ds.Tables(13).TableName = "Decrease_Deductions"

        Dim DsGESY As DataSet = GetSumsOfEmployeeDeductions("GD", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsGESY.Tables(0).Copy)
        Ds.Tables(14).TableName = "GESY_Deductions"

        Dim DsBIKGESY As DataSet = GetSumsOfEmployeeDeductions("GT", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsBIKGESY.Tables(0).Copy)
        Ds.Tables(15).TableName = "BIKGESY_Deductions"


        Ds.Tables.Add(DsGrossEarnings_12.Tables(0).Copy)
        Ds.Tables(16).TableName = "Gross_12"

        Ds.Tables.Add(DsTotal_12.Tables(0).Copy)
        Ds.Tables(17).TableName = "TotalEarnings_12"

        Ds.Tables.Add(DsGrand.Tables(0).Copy)
        Ds.Tables(18).TableName = "GrandTotal"
        'savvasir63

        Return Ds
    End Function
    Protected Function REPORT_IR63A_2020(ByVal PerGrp As cPrMsPeriodGroups, ByVal EmpCode As String, ByVal DsIr7 As DataSet, ByVal Name_OnIR63 As String, ByVal Designation_OnIR63 As String, ByVal March As Boolean, ByVal Period14 As Boolean, ByVal PrintDate_OnIR63 As String) As DataSet
        Dim ShowBonusSeparatly As Boolean = False
        Dim SeparateBonus As Double = 0
        Dim SeparateBonus_12 As Double = 0
        Dim BonusEarningCode As String = ""
        '--------------------------------------------------------------------------
        Dim ShowSep1 As Boolean = False
        Dim SepAmount1 As Double = 0
        Dim SepAmount1_12 As Double = 0
        Dim SepEarningCode1 As String = ""
        Dim SepDesc1 As String = ""

        Dim ShowSep2 As Boolean = False
        Dim SepAmount2 As Double = 0
        Dim SepAmount2_12 As Double = 0
        Dim SepEarningCode2 As String = ""
        Dim SepDesc2 As String = ""

        Dim ShowSep3 As Boolean = False
        Dim SepAmount3 As Double = 0
        Dim SepAmount3_12 As Double = 0
        Dim SepEarningCode3 As String = ""
        Dim SepDesc3 As String = ""

        Dim ShowSep4 As Boolean = False
        Dim SepAmount4 As Double = 0
        Dim SepAmount4_12 As Double = 0
        Dim SepEarningCode4 As String = ""
        Dim SepDesc4 As String = ""

        Dim ShowSep5 As Boolean = False
        Dim SepAmount5 As Double = 0
        Dim SepAmount5_12 As Double = 0
        Dim SepEarningCode5 As String = ""
        Dim SepDesc5 As String = ""

        Dim ShowSep6 As Boolean = False
        Dim SepAmount6 As Double = 0
        Dim SepAmount6_12 As Double = 0
        Dim SepEarningCode6 As String = ""
        Dim SepDesc6 As String = ""

        Dim ShowSep7 As Boolean = False
        Dim SepAmount7 As Double = 0
        Dim SepAmount7_12 As Double = 0
        Dim SepEarningCode7 As String = ""
        Dim SepDesc7 As String = ""

        Dim ShowSep8 As Boolean = False
        Dim SepAmount8 As Double = 0
        Dim SepAmount8_12 As Double = 0
        Dim SepEarningCode8 As String = ""
        Dim SepDesc8 As String = ""

        Dim ShowSep9 As Boolean = False
        Dim SepAmount9 As Double = 0
        Dim SepAmount9_12 As Double = 0
        Dim SepEarningCode9 As String = ""
        Dim SepDesc9 As String = ""

        Dim ShowSep10 As Boolean = False
        Dim SepAmount10 As Double = 0
        Dim SepAmount10_12 As Double = 0

        Dim SepEarningCode10 As String = ""
        Dim SepDesc10 As String = ""



        Dim JanPeriod As String = PerGrp.Year & "01"
        Dim FebPeriod As String = PerGrp.Year & "02"
        Dim AprPeriod As String = PerGrp.Year & "04"
        Dim MayPeriod As String = PerGrp.Year & "05"
        Dim JunPeriod As String = PerGrp.Year & "06"
        Dim t14Period As String = "00"
        If March Then
            JunPeriod = PerGrp.Year & "03"
        End If
        If Period14 Then
            t14Period = PerGrp.Year & "14"
        End If

        '--------------------------------------------------------------------------
        ' Dim D1 As Date = CDate("01/01/" & PerGrp.Year)
        ' Dim D2 As Date = CDate("03/01/" & PerGrp.Year)
        ' D2 = DateAdd(DateInterval.Day, -1, D2)

        'Dim D3 As Date = CDate("03/01/" & PerGrp.Year)
        'Dim D4 As Date = CDate("12/31/" & PerGrp.Year)
        '--------------------------------------------------------------------------


        ShowBonusSeparatly = Global1.PARAM_IR63_ShowBonusSeparatly
        BonusEarningCode = Global1.PARAM_IR63_BonusEarningCode

        ShowSep1 = Global1.PARAM_IR63_ShowSep1
        SepEarningCode1 = Global1.PARAM_IR63_Sep1Code
        SepDesc1 = Global1.PARAM_IR63_Sep1Desc

        ShowSep2 = Global1.PARAM_IR63_ShowSep2
        SepEarningCode2 = Global1.PARAM_IR63_Sep2Code
        SepDesc2 = Global1.PARAM_IR63_Sep2Desc

        ShowSep3 = Global1.PARAM_IR63_ShowSep3
        SepEarningCode3 = Global1.PARAM_IR63_Sep3Code
        SepDesc3 = Global1.PARAM_IR63_Sep3Desc

        ShowSep4 = Global1.PARAM_IR63_ShowSep4
        SepEarningCode4 = Global1.PARAM_IR63_Sep4Code
        SepDesc4 = Global1.PARAM_IR63_Sep4Desc

        ShowSep5 = Global1.PARAM_IR63_ShowSep5
        SepEarningCode5 = Global1.PARAM_IR63_Sep5Code
        SepDesc5 = Global1.PARAM_IR63_Sep5Desc


        ShowSep6 = Global1.PARAM_IR63_ShowSep6
        SepEarningCode6 = Global1.PARAM_IR63_Sep6Code
        SepDesc6 = Global1.PARAM_IR63_Sep6Desc

        ShowSep7 = Global1.PARAM_IR63_ShowSep7
        SepEarningCode7 = Global1.PARAM_IR63_Sep7Code
        SepDesc7 = Global1.PARAM_IR63_Sep7Desc

        ShowSep8 = Global1.PARAM_IR63_ShowSep8
        SepEarningCode8 = Global1.PARAM_IR63_Sep8Code
        SepDesc8 = Global1.PARAM_IR63_Sep8Desc

        ShowSep9 = Global1.PARAM_IR63_ShowSep9
        SepEarningCode9 = Global1.PARAM_IR63_Sep9Code
        SepDesc9 = Global1.PARAM_IR63_Sep9Desc

        ShowSep10 = Global1.PARAM_IR63_ShowSep10
        SepEarningCode10 = Global1.PARAM_IR63_Sep10Code
        SepDesc10 = Global1.PARAM_IR63_Sep10Desc




        Dim Ds As DataSet
        Dim Str As String
        Dim Str_12 As String
        Dim TotalEarnings As Double
        Dim TotalEarnings_12 As Double

        Dim TICofFund As String = ""
        Str = " SELECT Emp_Code," & _
            " Emp_FullName," & _
            " Emp_Address1," & _
            " Emp_Address2," & _
            " Emp_Address3, " & _
            " Emp_PostCode," & _
            " Emp_SocialInsNumber," & _
            " Emp_IdentificationCard, " & _
            " Emp_TaxID," & _
            " Emp_TerminateDate," & _
            " TemGrp_Code," & _
            " Emp_StartDate," & _
            " Emp_OtherIncome1, " & _
            " '' as DirectorFees, " & _
            " '' as OtherDesc, " & _
            " '' as StartDate, " & _
            " '' as PFFundTIC, " & _
            " '' as ExtraBonus, " & _
            " '' as ExtraBonusDesc, " & _
            " '' as Sep1, " & _
            " '' as Sep1Des, " & _
            " '' as Sep2, " & _
            " '' as Sep2Des, " & _
            " '' as Sep3, " & _
            " '' as Sep3Des, " & _
            " '' as Sep4, " & _
            " '' as Sep4Des, " & _
            " '' as Sep5, " & _
            " '' as Sep5Des, " & _
            " '' as Sep6, " & _
            " '' as Sep6Des, " & _
            " '' as Sep7, " & _
            " '' as Sep7Des, " & _
            " '' as Sep8, " & _
            " '' as Sep8Des, " & _
            " '' as Sep9, " & _
            " '' as Sep9Des, " & _
             " '' as Sep10, " & _
            " '' as Sep10Des, " & _
            " '' as ExtraBonus_12, " & _
            " '' as Sep1_12, " & _
            " '' as Sep2_12, " & _
            " '' as Sep3_12, " & _
            " '' as Sep4_12, " & _
            " '' as Sep5_12, " & _
            " '' as Sep6_12, " & _
            " '' as Sep7_12, " & _
            " '' as Sep8_12, " & _
            " '' as Sep9_12, " & _
            " '' as Sep10_12, " & _
            " '' As OtherIncome1_12," & _
            " '' as PublicSector," & _
            " Emp_Code as EmpCode2 " & _
            " FROM PrMsEmployees" & _
            " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

        Ds = GetData(Str)
        If Trim(Global1.GLB_IR63Description) <> "" Then
            If CheckDataSet(Ds) Then
                Ds.Tables(0).Rows(0).Item(14) = Global1.GLB_IR63Description
                Ds.Tables(0).Rows(0).Item(13) = Utils.AddCommaToThousands(Ds.Tables(0).Rows(0).Item(12))
                Ds.Tables(0).Rows(0).Item(12) = 0
            End If
        End If
        If ShowBonusSeparatly Then
            SeparateBonus = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, BonusEarningCode, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            '39
            SeparateBonus_12 = RoundMe2(Find_EarningCode_Total_IR63_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, BonusEarningCode, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            ' SeparateBonus = SeparateBonus - SeparateBonus_12
            If RoundMe2(SeparateBonus, 2) > 0 Or RoundMe2(SeparateBonus_12, 2) > 0 Then
                Ds.Tables(0).Rows(0).Item(17) = Utils.AddCommaToThousands(SeparateBonus)
                Ds.Tables(0).Rows(0).Item(18) = "Bonus"
                Ds.Tables(0).Rows(0).Item(39) = Utils.AddCommaToThousands(SeparateBonus_12)
            End If
        End If
        '------------------------------------------------------------------------------------------------
        If ShowSep1 Then
            SepAmount1 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode1, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            '40
            SepAmount1_12 = RoundMe2(Find_EarningCode_Total_IR63_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode1, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            ' SepAmount1 = SepAmount1 - SepAmount1_12
            If RoundMe2(SepAmount1, 2) > 0 Or RoundMe2(SepAmount1_12, 2) > 0 Then
                Ds.Tables(0).Rows(0).Item(19) = Utils.AddCommaToThousands(SepAmount1)
                Ds.Tables(0).Rows(0).Item(20) = SepDesc1
                Ds.Tables(0).Rows(0).Item(40) = Utils.AddCommaToThousands(SepAmount1_12)
            End If
        End If
        If ShowSep2 Then
            SepAmount2 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode2, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            '41
            SepAmount2_12 = RoundMe2(Find_EarningCode_Total_IR63_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode2, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            ' SepAmount2 = SepAmount2 - SepAmount2_12
            Ds.Tables(0).Rows(0).Item(21) = Utils.AddCommaToThousands(SepAmount2)
            Ds.Tables(0).Rows(0).Item(22) = SepDesc2
            Ds.Tables(0).Rows(0).Item(41) = Utils.AddCommaToThousands(SepAmount2_12)

            'End If
        End If
        If ShowSep3 Then
            SepAmount3 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode3, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            '42
            SepAmount3_12 = RoundMe2(Find_EarningCode_Total_IR63_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode3, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            ' SepAmount3 = SepAmount3 - SepAmount3_12
            ' If RoundMe2(SepAmount3, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(23) = Utils.AddCommaToThousands(SepAmount3)
            Ds.Tables(0).Rows(0).Item(24) = SepDesc3
            Ds.Tables(0).Rows(0).Item(42) = Utils.AddCommaToThousands(SepAmount3_12)
            'End If
        End If
        If ShowSep4 Then
            SepAmount4 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode4, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            '43
            SepAmount4_12 = RoundMe2(Find_EarningCode_Total_IR63_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode4, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            ' SepAmount4 = SepAmount4 - SepAmount4_12
            'If RoundMe2(SepAmount4, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(25) = Utils.AddCommaToThousands(SepAmount4)
            Ds.Tables(0).Rows(0).Item(26) = SepDesc4
            Ds.Tables(0).Rows(0).Item(43) = Utils.AddCommaToThousands(SepAmount4_12)
            'End If
        End If
        If ShowSep5 Then
            SepAmount5 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode5, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            '44
            SepAmount5_12 = RoundMe2(Find_EarningCode_Total_IR63_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode5, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            ' SepAmount5 = SepAmount5 - SepAmount5_12
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(27) = Utils.AddCommaToThousands(SepAmount5)
            Ds.Tables(0).Rows(0).Item(28) = SepDesc5
            Ds.Tables(0).Rows(0).Item(44) = Utils.AddCommaToThousands(SepAmount5_12)
            'End If
        End If
        If ShowSep6 Then
            SepAmount6 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode6, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            '45
            SepAmount6_12 = RoundMe2(Find_EarningCode_Total_IR63_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode6, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            ' SepAmount6 = SepAmount6 - SepAmount6_12
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(29) = Utils.AddCommaToThousands(SepAmount6)
            Ds.Tables(0).Rows(0).Item(30) = SepDesc6
            Ds.Tables(0).Rows(0).Item(45) = Utils.AddCommaToThousands(SepAmount6_12)
            'End If
        End If
        If ShowSep7 Then
            SepAmount7 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode7, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            '46
            SepAmount7_12 = RoundMe2(Find_EarningCode_Total_IR63_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode7, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            'SepAmount7 = SepAmount7 - SepAmount7_12
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(31) = Utils.AddCommaToThousands(SepAmount7)
            Ds.Tables(0).Rows(0).Item(32) = SepDesc7
            Ds.Tables(0).Rows(0).Item(46) = Utils.AddCommaToThousands(SepAmount7_12)
            'End If
        End If
        If ShowSep8 Then
            SepAmount8 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode8, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            '47
            SepAmount8_12 = RoundMe2(Find_EarningCode_Total_IR63_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode8, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            ' SepAmount8 = SepAmount8 - SepAmount8_12
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(33) = Utils.AddCommaToThousands(SepAmount8)
            Ds.Tables(0).Rows(0).Item(34) = SepDesc8
            Ds.Tables(0).Rows(0).Item(47) = Utils.AddCommaToThousands(SepAmount8_12)
            'End If
        End If
        If ShowSep9 Then
            SepAmount9 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode9, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            '48
            SepAmount9_12 = RoundMe2(Find_EarningCode_Total_IR63_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode9, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            'SepAmount9 = SepAmount9 - SepAmount9_12
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(35) = Utils.AddCommaToThousands(SepAmount9)
            Ds.Tables(0).Rows(0).Item(36) = SepDesc9
            Ds.Tables(0).Rows(0).Item(48) = Utils.AddCommaToThousands(SepAmount9_12)
            'End If
        End If
        If ShowSep10 Then
            SepAmount10 = RoundMe2(Find_EarningCode_Total_IR63_NOT_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode10, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            '49
            SepAmount10_12 = RoundMe2(Find_EarningCode_Total_IR63_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, SepEarningCode10, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period), 2)
            ' SepAmount10 = SepAmount10 - SepAmount10_12
            ' If RoundMe2(SepAmount5, 2) > 0 Then
            Ds.Tables(0).Rows(0).Item(37) = Utils.AddCommaToThousands(SepAmount10)
            Ds.Tables(0).Rows(0).Item(38) = SepDesc10
            Ds.Tables(0).Rows(0).Item(49) = Utils.AddCommaToThousands(SepAmount10_12)
            'End If
        End If
        '------------------------------------------------------------------------------------------------


        Dim SD As Date
        SD = DbNullToDate(Ds.Tables(0).Rows(0).Item(11))
        ' If SD.Year = PerGrp.Year Then
        Ds.Tables(0).Rows(0).Item(15) = Format(SD, "dd/MM/yyy")
        'Else
        'Ds.Tables(0).Rows(0).Item(15) = ""
        'End If
        Dim TD As String
        TD = DbNullToString(Ds.Tables(0).Rows(0).Item(9))
        If Trim(TD) <> "" Then
            Dim DD As Date
            DD = CDate(TD)
            Ds.Tables(0).Rows(0).Item(9) = Format(DD, "dd/MM/yyy")


        End If

        If CheckDataSet(DsIr7) Then
            Dim i As Integer
            For i = 0 To DsIr7.Tables(0).Rows.Count - 1
                If DsIr7.Tables(0).Rows(i).Item(27) = EmpCode Then
                    Ds.Tables(0).Rows(0).Item(0) = i + 1
                    Exit For
                End If
            Next
        End If
        Ds.Tables(0).TableName = "EmpDetails"
        Dim DsGrossEarnings As DataSet
        Dim DsGrossEarnings_12 As DataSet

        'Str = " SELECT SUM(TrxHdr_TaxableIncome)" & _
        '      " FROM  PrTxTrxnHeader" & _
        '      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
        '      " AND (PrdGrp_Code =  " & enQuoteString(PerGrp.Code) & ")"

        Str = " SELECT SUM(TrxHdr_TotalErnPeriod)" & _
            " FROM  PrTxTrxnHeader" & _
            " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (PrdGrp_Code =  " & enQuoteString(PerGrp.Code) & ")" & _
            " AND (PrdCod_Code <>  " & enQuoteString(JanPeriod) & _
            " AND " & " PrdCod_Code <>  " & enQuoteString(FebPeriod) & _
            " AND " & " PrdCod_Code <>  " & enQuoteString(AprPeriod) & _
            " AND " & " PrdCod_Code <>  " & enQuoteString(MayPeriod) & _
            " AND " & " PrdCod_Code <>  " & enQuoteString(JunPeriod) & _
            " AND " & " PrdCod_Code <>  " & enQuoteString(t14Period) & ")"


        Str_12 = " SELECT SUM(TrxHdr_TotalErnPeriod)" & _
            " FROM  PrTxTrxnHeader" & _
            " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (PrdGrp_Code =  " & enQuoteString(PerGrp.Code) & ")" & _
            " AND (PrdCod_Code =  " & enQuoteString(JanPeriod) & _
            " OR " & " PrdCod_Code =  " & enQuoteString(FebPeriod) & _
            " OR " & " PrdCod_Code =  " & enQuoteString(FebPeriod) & _
            " OR " & " PrdCod_Code =  " & enQuoteString(AprPeriod) & _
            " OR " & " PrdCod_Code =  " & enQuoteString(MayPeriod) & _
            " OR " & " PrdCod_Code =  " & enQuoteString(JunPeriod) & _
           " OR " & " PrdCod_Code =  " & enQuoteString(t14Period) & ")"

        Dim NonTaxable As Double = 0
        Dim NonTaxable_12 As Double = 0
        Dim NonInsurable As Double = 0

        NonTaxable = FindNonTaxableTotalForTemplateGroupForEmployee_NOT_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period)
        NonTaxable_12 = FindNonTaxableTotalForTemplateGroupForEmployee_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period)

        ' If NonTaxable = 0 Then
        'NonInsurable = FindNonInsurableTotalForTemplateGroupForEmployee(PerGrp.TemGrpCode, PerGrp.Code, EmpCode)
        ' End If
        Dim OtherIncome1 As Double
        OtherIncome1 = DbNullToDouble(Ds.Tables(0).Rows(0).Item(12))
        If DbNullToString(Ds.Tables(0).Rows(0).Item(13)) <> "" Then
            OtherIncome1 = OtherIncome1 + DbNullToDouble(Ds.Tables(0).Rows(0).Item(13))
        End If

        Dim TotalGross_12 As Double = 0
        ''''''''''''''''''''''''''''''''''''''''''''''
        '             Gross                          '
        ''''''''''''''''''''''''''''''''''''''''''''''
        DsGrossEarnings_12 = GetData(Str_12)
        If NonTaxable_12 <> 0 Then
            If CheckDataSet(DsGrossEarnings_12) Then
                Dim total_12 As Double
                total_12 = DbNullToDouble(DsGrossEarnings_12.Tables(0).Rows(0).Item(0))
                TotalGross_12 = RoundMe2(total_12 - NonTaxable_12, 2)
                DsGrossEarnings_12.Tables(0).Rows(0).Item(0) = TotalGross_12
            End If
        End If

        DsGrossEarnings = GetData(Str)
        If NonTaxable <> 0 Then
            If CheckDataSet(DsGrossEarnings) Then
                Dim total As Double
                total = DbNullToDouble(DsGrossEarnings.Tables(0).Rows(0).Item(0))
                total = RoundMe2(total - NonTaxable, 2)
                DsGrossEarnings.Tables(0).Rows(0).Item(0) = total

            End If
        End If

        ''''''''''''''''''''''''''''''''''''''''''''''
        '             SI Leave                       '
        ''''''''''''''''''''''''''''''''''''''''''''''
        Dim DsSILeave_12 As DataSet

        DsSILeave_12 = Me.FindSILeaveTotalIR63_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period)
        Dim SILeaveValue_12 As Double = 0
        If CheckDataSet(DsSILeave_12) Then
            SILeaveValue_12 = DbNullToDouble(DsSILeave_12.Tables(0).Rows(0).Item(0))
        End If

        Dim DsSILeave As DataSet
        DsSILeave = Me.FindSILeaveTotalIR63_NOT_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period)
        Dim SILeaveValue As Double = 0
        If CheckDataSet(DsSILeave) Then
            SILeaveValue = DbNullToDouble(DsSILeave.Tables(0).Rows(0).Item(0))
        End If
        ''''''''''''''''''''''''''''''''''''''''''''''
        '             Benifits In Kind               '
        ''''''''''''''''''''''''''''''''''''''''''''''
        Dim DsBenefitsInKind_12 As DataSet
        DsBenefitsInKind_12 = Me.FindBenefitsInKindTotalIR63_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period)
        Dim BenefitsInKind_12 As Double = 0
        If CheckDataSet(DsBenefitsInKind_12) Then
            BenefitsInKind_12 = DbNullToDouble(DsBenefitsInKind_12.Tables(0).Rows(0).Item(0))
        End If

        Dim DsBenefitsInKind As DataSet
        DsBenefitsInKind = Me.FindBenefitsInKindTotalIR63_NOT_JanFebAprMayJun(PerGrp.TemGrpCode, PerGrp.Code, EmpCode, JanPeriod, FebPeriod, AprPeriod, MayPeriod, JunPeriod, t14Period)
        Dim BenefitsInKind As Double = 0
        If CheckDataSet(DsBenefitsInKind) Then
            BenefitsInKind = DbNullToDouble(DsBenefitsInKind.Tables(0).Rows(0).Item(0))
        End If

        ' Ds.Tables(0).Rows(0).Item(17) = BenefitsInKind
        Ds.Tables(0).Rows(0).Item(12) = DbNullToDouble(Ds.Tables(0).Rows(0).Item(12)) + BenefitsInKind
        Ds.Tables(0).Rows(0).Item(50) = BenefitsInKind_12

        Ds.Tables(0).Rows(0).Item(51) = Global1.PARAM_PublicSector
        ''''''''''''''''''''''''''''''''''''''''''''''

        Dim total2 As Double
        Dim total2_12 As Double

        total2 = DbNullToDouble(DsGrossEarnings.Tables(0).Rows(0).Item(0))
        total2_12 = DbNullToDouble(DsGrossEarnings_12.Tables(0).Rows(0).Item(0))

        Dim TempTotal_12 As Double = 0
        TempTotal_12 = total2_12 + SILeaveValue_12 - SeparateBonus_12 - SepAmount1_12 - SepAmount2_12 - SepAmount3_12 - SepAmount4_12 - SepAmount5_12 - SepAmount6_12 - SepAmount7_12 - SepAmount8_12 - SepAmount9_12 - SepAmount10_12
        DsGrossEarnings_12.Tables(0).Rows(0).Item(0) = TempTotal_12
        DsGrossEarnings.Tables(0).Rows(0).Item(0) = total2 + SILeaveValue - SeparateBonus - SepAmount1 - SepAmount2 - SepAmount3 - SepAmount4 - SepAmount5 - SepAmount6 - SepAmount7 - SepAmount8 - SepAmount9 - SepAmount10 '- (TempTotal_12)


        TotalEarnings_12 = total2_12 + SILeaveValue_12 + BenefitsInKind_12
        TotalEarnings = total2 + SILeaveValue + OtherIncome1 + BenefitsInKind '- TotalEarnings_12

        Dim GrandTotal As Double = 0
        GrandTotal = TotalEarnings_12 + TotalEarnings


        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        Ds.Tables.Add(DsGrossEarnings.Tables(0).Copy)
        Ds.Tables(1).TableName = "GrossEarnings"
        'savvasIR62
        '       xxxxx()

        Dim DsPF As DataSet = GetSumsOfEmployeeDeductions("PF", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsPF.Tables(0).Copy)
        Ds.Tables(2).TableName = "PF_Deductions"


        Dim DsMF As DataSet = GetSumsOfEmployeeDeductions("MF", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsMF.Tables(0).Copy)
        Ds.Tables(3).TableName = "MF_Deductions"

        Dim DsSI As DataSet = GetSumsOfEmployeeDeductions("SI", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsSI.Tables(0).Copy)
        Ds.Tables(4).TableName = "SI_Deductions"

        Dim DsIT As DataSet = GetSumsOfEmployeeDeductions("IT", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsIT.Tables(0).Copy)
        Ds.Tables(5).TableName = "IT_Deductions"

        Dim DsUnion As DataSet = GetSumsOfEmployeeDeductions("US", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsUnion.Tables(0).Copy)
        Ds.Tables(6).TableName = "Union_Deductions"

        Dim DsTotal As DataSet = GetSumsOfEmployeeDeductions("SI", EmpCode, PerGrp.Code)
        DsTotal.Tables(0).Rows(0).Item(0) = Utils.AddCommaToThousands(TotalEarnings)

        Ds.Tables.Add(DsTotal.Tables(0).Copy)
        Ds.Tables(7).TableName = "TotalEarnings"

        Dim DsTotal_12 As DataSet = GetSumsOfEmployeeDeductions("SI", EmpCode, PerGrp.Code)
        DsTotal_12.Tables(0).Rows(0).Item(0) = Utils.AddCommaToThousands(TotalEarnings_12)

        Dim DsGrand As DataSet = GetSumsOfEmployeeDeductions("SI", EmpCode, PerGrp.Code)
        DsGrand.Tables(0).Rows(0).Item(0) = Utils.AddCommaToThousands(GrandTotal)




        'added at the end

        Dim DsComp As DataSet
        Str = " SELECT AdMsCompany.Com_Name," & _
            " AdMsCompany.Com_TIC," & _
            " AdMsCompany.Com_Address1," & _
            " AdMsCompany.Com_Address2, " & _
            " AdMsCompany.Com_Address3," & _
            " AdMsCompany.Com_Address4," & _
            " AdMsCompany.Com_AccountantTitle," & _
            " PrMsTemplateGroup.TemGrp_Code," & _
            " AdMsCompany.Com_AccIdentity," & _
            " '' as Identity1, " & _
            " AdMsCompany.Com_GLAnal4, " & _
            " '' as FromP1," & _
            " '' as FromP2, " & _
            " AdMsCompany.Com_Stamp, " & _
            " '' as PrintDate " & _
            " FROM AdMsCompany INNER JOIN" & _
            " PrMsTemplateGroup ON " & _
            " AdMsCompany.Com_Code = PrMsTemplateGroup.Com_Code" & _
            " WHERE (PrMsTemplateGroup.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

        DsComp = GetData(Str)
        If CheckDataSet(DsComp) Then
            Dim DsP As DataSet
            DsP = Global1.Business.GetParameter("IR63", "Designation")
            If CheckDataSet(DsP) Then
                Dim Par As New cPrSsParameters(DsP.Tables(0).Rows(0))
                Dim DescP As String
                DescP = Par.Value1
                DsComp.Tables(0).Rows(0).Item(9) = DescP
            End If

            DsComp.Tables(0).Rows(0).Item(6) = Name_OnIR63
            DsComp.Tables(0).Rows(0).Item(9) = Designation_OnIR63
            DsComp.Tables(0).Rows(0).Item(14) = PrintDate_OnIR63
            TICofFund = DbNullToString(DsComp.Tables(0).Rows(0).Item(10))

            DsComp.Tables(0).Rows(0).Item(11) = "N.H.S. 1.70%" 'Format(D1, "dd/MM") & " - " & Format(D2, "dd/MM/yyyy")
            DsComp.Tables(0).Rows(0).Item(12) = "N.H.S. 2.65%" 'Format(D3, "dd/MM") & " - " & Format(D4, "dd/MM/yyyy")
            'Select Case DsComp.Tables(0).Rows(0).Item(8)
            '    Case "1"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Manager/Director"
            '    Case "2"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Secretary"
            '    Case "3"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Partner"
            '    Case "4"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Authorized Representative"
            '    Case "0"
            '        DsComp.Tables(0).Rows(0).Item(9) = "Not Applicable"
            'End Select
        End If
        Ds.Tables.Add(DsComp.Tables(0).Copy)
        Ds.Tables(8).TableName = "CompanyDetails"

        Dim DsYear As DataSet
        Str = " SELECT PrdGpr_Year" & _
              " FROM PrMsPeriodGroups" & _
              " where PrdGrp_Code=" & enQuoteString(PerGrp.Code)

        DsYear = GetData(Str)
        Ds.Tables.Add(DsYear.Tables(0).Copy)
        Ds.Tables(9).TableName = "Year"

        Dim DsSpecialTax As DataSet = GetSumsOfEmployeeDeductions("EX", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsSpecialTax.Tables(0).Copy)
        Ds.Tables(10).TableName = "SpecialTax_Deductions"

        Dim DsSpecialTaxCon As DataSet = GetSumsOfEmployeeContributions("EX", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsSpecialTaxCon.Tables(0).Copy)
        Ds.Tables(11).TableName = "SpecialTax_Contribution"

        If CheckDataSet(DsPF) Then
            If DbNullToDouble(DsPF.Tables(0).Rows(0).Item(0)) <> 0 Then
                If CheckDataSet(Ds) Then
                    Ds.Tables(0).Rows(0).Item(16) = TICofFund
                End If
            End If
        End If

        Dim DsPEN As DataSet = GetSumsOfEmployeeDeductions("PN", EmpCode, PerGrp.Code)
        Dim DsWO As DataSet = GetSumsOfEmployeeDeductions("WO", EmpCode, PerGrp.Code)
        If CheckDataSet(DsPEN) Then
            If CheckDataSet(DsWO) Then
                DsPEN.Tables(0).Rows(0).Item(0) = DbNullToDouble(DsPEN.Tables(0).Rows(0).Item(0)) + DbNullToDouble(DsWO.Tables(0).Rows(0).Item(0))
            End If
        End If
        Ds.Tables.Add(DsPEN.Tables(0).Copy)
        Ds.Tables(12).TableName = "PNWO_Deductions"

        Dim DsDN As DataSet = GetSumsOfEmployeeDeductions("DN", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsDN.Tables(0).Copy)
        Ds.Tables(13).TableName = "Decrease_Deductions"

        Dim DsGESY As DataSet = GetSumsOfEmployeeDeductions("GD", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsGESY.Tables(0).Copy)
        Ds.Tables(14).TableName = "GESY_Deductions"

        Dim DsBIKGESY As DataSet = GetSumsOfEmployeeDeductions("GT", EmpCode, PerGrp.Code)
        Ds.Tables.Add(DsBIKGESY.Tables(0).Copy)
        Ds.Tables(15).TableName = "BIKGESY_Deductions"


        Ds.Tables.Add(DsGrossEarnings_12.Tables(0).Copy)
        Ds.Tables(16).TableName = "Gross_12"

        Ds.Tables.Add(DsTotal_12.Tables(0).Copy)
        Ds.Tables(17).TableName = "TotalEarnings_12"

        Ds.Tables.Add(DsGrand.Tables(0).Copy)
        Ds.Tables(18).TableName = "GrandTotal"
        'savvasir63

        Return Ds
    End Function
    Protected Function REPORT_SpecialContribution(ByVal PerGrp As cPrMsPeriodGroups, ByVal EmpCode As String, ByVal DsIr7 As DataSet) As DataSet
        Dim Ds As DataSet
        Dim Str As String
        Dim TotalEarnings As Double
        Dim EmployeeFound As Boolean = False

        Str = " SELECT Emp_Code," & _
            " Emp_FullName," & _
            " Emp_Address1," & _
            " Emp_Address2," & _
            " Emp_Address3, " & _
            " Emp_PostCode," & _
            " Emp_SocialInsNumber," & _
            " Emp_IdentificationCard, " & _
            " Emp_TaxID," & _
            " Emp_TerminateDate," & _
            " TemGrp_Code," & _
            " Emp_StartDate," & _
            " Emp_OtherIncome1, " & _
            " '' as DirectorFees, " & _
            " '' as OtherDesc, " & _
            " '' as StartDate " & _
            " FROM PrMsEmployees" & _
            " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

        Ds = GetData(Str)
        

        If CheckDataSet(DsIr7) Then
            Dim i As Integer
            For i = 0 To DsIr7.Tables(0).Rows.Count - 1
                If DsIr7.Tables(0).Rows(i).Item(27) = EmpCode Then
                    Ds.Tables(0).Rows(0).Item(0) = i + 1
                    EmployeeFound = True
                    Exit For
                End If
            Next
        End If
        If employeefound Then
            Ds.Tables(0).TableName = "EmpDetails"


            'Str = " SELECT SUM(TrxHdr_TaxableIncome)" & _
            '      " FROM  PrTxTrxnHeader" & _
            '      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            '      " AND (PrdGrp_Code =  " & enQuoteString(PerGrp.Code) & ")"

            'Str = " SELECT SUM(TrxHdr_TotalErnPeriod)" & _
            '     " FROM  PrTxTrxnHeader" & _
            '     " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            '     " AND (PrdGrp_Code =  " & enQuoteString(PerGrp.Code) & ")"

            'Dim NonTaxable As Double = 0
            'Dim NonInsurable As Double = 0
            'NonTaxable = FindNonTaxableTotalForTemplateGroupForEmployee(PerGrp.TemGrpCode, PerGrp.Code, EmpCode)
            'If NonTaxable = 0 Then
            '    NonInsurable = FindNonInsurableTotalForTemplateGroupForEmployee(PerGrp.TemGrpCode, PerGrp.Code, EmpCode)
            'End If
            'Dim OtherIncome1 As Double
            'OtherIncome1 = DbNullToDouble(Ds.Tables(0).Rows(0).Item(12))
            'If DbNullToString(Ds.Tables(0).Rows(0).Item(13)) <> "" Then
            '    OtherIncome1 = OtherIncome1 + DbNullToDouble(Ds.Tables(0).Rows(0).Item(13))
            'End If

            'DsGrossEarnings = GetData(Str)
            'If NonTaxable <> 0 Or NonInsurable <> 0 Then
            '    If CheckDataSet(DsGrossEarnings) Then
            '        Dim total As Double
            '        total = DsGrossEarnings.Tables(0).Rows(0).Item(0)
            '        DsGrossEarnings.Tables(0).Rows(0).Item(0) = total - NonTaxable - NonInsurable

            '    End If
            'End If



            'Dim DsSILeave As DataSet
            'DsSILeave = Me.FindSILeaveTotalIR63(PerGrp.TemGrpCode, PerGrp.Code, EmpCode)
            'Dim SILeaveValue As Double = 0
            'If CheckDataSet(DsSILeave) Then
            '    SILeaveValue = DbNullToDouble(DsSILeave.Tables(0).Rows(0).Item(0))
            'End If
            'Dim total2 As Double

            'total2 = DbNullToDouble(DsGrossEarnings.Tables(0).Rows(0).Item(0))

            'DsGrossEarnings.Tables(0).Rows(0).Item(0) = total2 + SILeaveValue

            'TotalEarnings = total2 + SILeaveValue + OtherIncome1


            'Ds.Tables.Add(DsGrossEarnings.Tables(0).Copy)
            'Ds.Tables(1).TableName = "GrossEarnings"

            'Dim DsPF As DataSet = GetSumsOfEmployeeDeductions("PF", EmpCode, PerGrp.Code)
            'Ds.Tables.Add(DsPF.Tables(0).Copy)
            'Ds.Tables(2).TableName = "PF_Deductions"

            'Dim DsMF As DataSet = GetSumsOfEmployeeDeductions("MF", EmpCode, PerGrp.Code)
            'Ds.Tables.Add(DsMF.Tables(0).Copy)
            'Ds.Tables(3).TableName = "MF_Deductions"

            'Dim DsSI As DataSet = GetSumsOfEmployeeDeductions("SI", EmpCode, PerGrp.Code)
            'Ds.Tables.Add(DsSI.Tables(0).Copy)
            'Ds.Tables(4).TableName = "SI_Deductions"

            'Dim DsIT As DataSet = GetSumsOfEmployeeDeductions("IT", EmpCode, PerGrp.Code)
            'Ds.Tables.Add(DsIT.Tables(0).Copy)
            'Ds.Tables(5).TableName = "IT_Deductions"

            'Dim DsUnion As DataSet = GetSumsOfEmployeeDeductions("US", EmpCode, PerGrp.Code)
            'Ds.Tables.Add(DsUnion.Tables(0).Copy)
            'Ds.Tables(6).TableName = "Union_Deductions"

            'Dim DsTotal As DataSet = GetSumsOfEmployeeDeductions("SI", EmpCode, PerGrp.Code)
            'DsTotal.Tables(0).Rows(0).Item(0) = TotalEarnings
            'Ds.Tables.Add(DsTotal.Tables(0).Copy)
            'Ds.Tables(7).TableName = "TotalEarnings"



            '------------------------------
            'Special contribution DEDUCTION
            '------------------------------

            Str = "SELECT  PrMsPeriodCodes.PrdCod_Number As PerNumber," & _
                " PrTxTrxnHeader.PrdGrp_Code As PeriodGroup, " & _
                " PrTxTrxnHeader.Emp_Code as EmpCode," & _
                " PrTxTrxnHeader.TrxHdr_TotalErnPeriod as PeriodTotalEarnings," & _
                " PrTxTrxnLines.TrxLin_PeriodValue as PeriodValue, " & _
                " PrTxTrxnHeader.PrdCod_Code as PeriodCode, " & _
                " PrMsPeriodCodes.PrdCod_DescriptionL as Description, " & _
                " 0.00 as Contribution, " & _
                " 0.00 as TotalGross, " & _
                " 0.00 as TotalDed, " & _
                " 0.00 as TotalCon " & _
                " FROM PrTxTrxnHeader INNER JOIN" & _
                " PrTxTrxnLines ON " & _
                " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
                " PrMsDeductionCodes ON " & _
                " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN" & _
                " PrSsDeductionTypes ON " & _
                " PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code INNER JOIN" & _
                " PrMsPeriodCodes ON " & _
                " PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code AND " & _
                " PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code" & _
                " WHERE (PrSsDeductionTypes.DedTyp_Code = 'EX') AND" & _
                " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrp.Code) & ") AND" & _
                " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                " Order by PrTxTrxnHeader.PrdCod_Code Asc"

            Dim Dsded As DataSet
            Dsded = GetData(Str)
            '---------------------------------
            'Special contribution CONTRIBUTION
            '---------------------------------

            Str = "SELECT  PrMsPeriodCodes.PrdCod_Number As PerNumber," & _
                 " PrTxTrxnHeader.PrdGrp_Code As PeriodGroup, " & _
                 " PrTxTrxnHeader.Emp_Code as EmpCode," & _
                 " PrTxTrxnHeader.TrxHdr_TotalErnPeriod as PeriodTotalEarnings," & _
                 " 0.00 as PeriodValue, " & _
                 " PrTxTrxnHeader.PrdCod_Code as PeriodCode, " & _
                 " PrMsPeriodCodes.PrdCod_DescriptionL as Description, " & _
                 " PrTxTrxnLines.TrxLin_PeriodValue as Contribution, " & _
                 " 0.00 as TotalGross, " & _
                " 0.00 as TotalDed, " & _
                " 0.00 as TotalCon " & _
                 " FROM PrTxTrxnHeader INNER JOIN" & _
                 " PrTxTrxnLines ON " & _
                 " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
                 " PrMsContributionCodes ON " & _
                 " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code INNER JOIN" & _
                 " PrSsContributionTypes ON " & _
                 " PrMsContributionCodes.ConTyp_Code = PrSsContributionTypes.ConTyp_Code INNER JOIN" & _
                 " PrMsPeriodCodes ON " & _
                 " PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code AND " & _
                 " PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code" & _
                 " WHERE (PrSsContributionTypes.ConTyp_Code = 'EX') AND" & _
                 " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrp.Code) & ") AND" & _
                 " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                 " Order by PrTxTrxnHeader.PrdCod_Code Asc"
            Dim DsCon As DataSet
            DsCon = GetData(Str)


            '------------------------------
            'SI LEAVE
            '------------------------------





            Dim Added As Boolean = False
            If CheckDataSet(Dsded) Then
                Dim i As Integer = 0
                If CheckDataSet(DsCon) Then
                    Dim k As Integer
                    Dim Per As String = ""
                    For i = 0 To Dsded.Tables(0).Rows.Count - 1
                        Per = DbNullToString(Dsded.Tables(0).Rows(i).Item(5))
                        For k = 0 To DsCon.Tables(0).Rows.Count - 1
                            If DbNullToString(DsCon.Tables(0).Rows(k).Item(5)) = Per Then
                                Dsded.Tables(0).Rows(i).Item(7) = DsCon.Tables(0).Rows(k).Item(7)
                                Exit For
                            End If
                        Next
                    Next
                End If

                Dim TotalGross As Double = 0
                Dim TotalDed As Double = 0
                Dim TotalCon As Double = 0
                Dim PeriodCode As String
                Dim SILeave As Double = 0
                For i = 0 To Dsded.Tables(0).Rows.Count - 1
                    PeriodCode = DbNullToString(Dsded.Tables(0).Rows(i).Item(5))
                    Str = "SELECT  PrTxTrxnLines.TrxLin_PeriodValue as PeriodValue " & _
                                " FROM PrTxTrxnHeader INNER JOIN" & _
                               " PrTxTrxnLines ON " & _
                               " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
                               " PrMsEarningCodes ON " & _
                               " PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code INNER JOIN" & _
                               " PrSsEarningTypes ON " & _
                               " PrMsEarningCodes.ErnTyp_Code = PrSsEarningTypes.ErnTyp_Code INNER JOIN" & _
                               " PrMsPeriodCodes ON " & _
                               " PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code AND " & _
                               " PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code" & _
                               " WHERE (PrSsEarningTypes.ErnTyp_Code = 'SI') AND" & _
                               " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrp.Code) & ") AND" & _
                               " (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PeriodCode) & ") AND" & _
                               " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                               " Order by PrTxTrxnHeader.PrdCod_Code Asc"

                    Dim DsErn As DataSet
                    DsErn = GetData(Str)
                    SILeave = 0
                    If CheckDataSet(DsErn) Then
                        SILeave = DbNullToDouble(DsErn.Tables(0).Rows(0).Item(0))
                    End If

                    Dsded.Tables(0).Rows(i).Item(3) = DbNullToDouble(Dsded.Tables(0).Rows(i).Item(3)) + SILeave
                    TotalGross = TotalGross + DbNullToDouble(Dsded.Tables(0).Rows(i).Item(3))

                    TotalDed = TotalDed + DbNullToDouble(Dsded.Tables(0).Rows(i).Item(4))
                    TotalCon = TotalCon + DbNullToDouble(Dsded.Tables(0).Rows(i).Item(7))
                Next
                For i = 0 To Dsded.Tables(0).Rows.Count - 1
                    Dsded.Tables(0).Rows(i).Item(8) = TotalGross
                    Dsded.Tables(0).Rows(i).Item(9) = TotalDed
                    Dsded.Tables(0).Rows(i).Item(10) = TotalCon
                Next


            Else
                If CheckDataSet(DsCon) Then

                    Dim i As Integer
                    Dim TotalGross As Double = 0
                    Dim TotalDed As Double = 0
                    Dim TotalCon As Double = 0
                    Dim PeriodCode As String
                    Dim SILeave As Double = 0
                    For i = 0 To DsCon.Tables(0).Rows.Count - 1
                        PeriodCode = DbNullToString(Dsded.Tables(0).Rows(i).Item(5))
                        Str = "SELECT  PrTxTrxnLines.TrxLin_PeriodValue as PeriodValue " & _
                                    " FROM PrTxTrxnHeader INNER JOIN" & _
                                   " PrTxTrxnLines ON " & _
                                   " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
                                   " PrMsEarningCodes ON " & _
                                   " PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code INNER JOIN" & _
                                   " PrSsEarningTypes ON " & _
                                   " PrMsEarningCodes.ErnTyp_Code = PrSsEarningTypes.ErnTyp_Code INNER JOIN" & _
                                   " PrMsPeriodCodes ON " & _
                                   " PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code AND " & _
                                   " PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code" & _
                                   " WHERE (PrSsEarningTypes.ErnTyp_Code = 'SI') AND" & _
                                   " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrp.Code) & ") AND" & _
                                   " (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PeriodCode) & ") AND" & _
                                   " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                                   " Order by PrTxTrxnHeader.PrdCod_Code Asc"

                        Dim DsErn As DataSet
                        DsErn = GetData(Str)
                        SILeave = 0
                        If CheckDataSet(DsErn) Then
                            SILeave = DbNullToDouble(DsErn.Tables(0).Rows(0).Item(0))
                        End If

                        DsCon.Tables(0).Rows(i).Item(3) = DbNullToDouble(DsCon.Tables(0).Rows(i).Item(3)) + SILeave

                        TotalGross = TotalGross + DbNullToDouble(DsCon.Tables(0).Rows(i).Item(3))
                        TotalDed = TotalDed + DbNullToDouble(DsCon.Tables(0).Rows(i).Item(4))
                        TotalCon = TotalCon + DbNullToDouble(DsCon.Tables(0).Rows(i).Item(7))
                    Next
                    For i = 0 To DsCon.Tables(0).Rows.Count - 1
                        DsCon.Tables(0).Rows(i).Item(8) = TotalGross
                        DsCon.Tables(0).Rows(i).Item(9) = TotalDed
                        DsCon.Tables(0).Rows(i).Item(10) = TotalCon
                    Next

                    Added = True
                    Ds.Tables.Add(DsCon.Tables(0).Copy)
                    Ds.Tables(1).TableName = "SpecialTax"
                End If
            End If
            If Not Added Then
                Ds.Tables.Add(Dsded.Tables(0).Copy)
                Ds.Tables(1).TableName = "SpecialTax"
            End If






            Dim DsComp As DataSet
            Str = " SELECT AdMsCompany.Com_Name," & _
                " AdMsCompany.Com_TIC," & _
                " AdMsCompany.Com_Address1," & _
                " AdMsCompany.Com_Address2, " & _
                " AdMsCompany.Com_Address3," & _
                " AdMsCompany.Com_Address4," & _
                " AdMsCompany.Com_AccountantTitle," & _
                " PrMsTemplateGroup.TemGrp_Code," & _
                " AdMsCompany.Com_AccIdentity," & _
                " '' as Identity1 " & _
                " FROM AdMsCompany INNER JOIN" & _
                " PrMsTemplateGroup ON " & _
                " AdMsCompany.Com_Code = PrMsTemplateGroup.Com_Code" & _
                " WHERE (PrMsTemplateGroup.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

            DsComp = GetData(Str)
            'If CheckDataSet(DsComp) Then
            '    Dim DsP As DataSet
            '    DsP = Global1.Business.GetParameter("IR63", "Designation")
            '    If CheckDataSet(DsP) Then
            '        Dim Par As New cPrSsParameters(DsP.Tables(0).Rows(0))
            '        Dim DescP As String
            '        DescP = Par.Value1
            '        DsComp.Tables(0).Rows(0).Item(9) = DescP
            '    End If



            '    'Select Case DsComp.Tables(0).Rows(0).Item(8)
            '    '    Case "1"
            '    '        DsComp.Tables(0).Rows(0).Item(9) = "Manager/Director"
            '    '    Case "2"
            '    '        DsComp.Tables(0).Rows(0).Item(9) = "Secretary"
            '    '    Case "3"
            '    '        DsComp.Tables(0).Rows(0).Item(9) = "Partner"
            '    '    Case "4"
            '    '        DsComp.Tables(0).Rows(0).Item(9) = "Authorized Representative"
            '    '    Case "0"
            '    '        DsComp.Tables(0).Rows(0).Item(9) = "Not Applicable"
            '    'End Select
            'End If
            Ds.Tables.Add(DsComp.Tables(0).Copy)
            Ds.Tables(2).TableName = "CompanyDetails"

            Dim DsYear As DataSet
            Str = " SELECT PrdGpr_Year" & _
                  " FROM PrMsPeriodGroups" & _
                  " where PrdGrp_Code=" & enQuoteString(PerGrp.Code)

            DsYear = GetData(Str)
            Ds.Tables.Add(DsYear.Tables(0).Copy)
            Ds.Tables(3).TableName = "Year"

        Else
            Ds = New DataSet
        End If

        Return Ds
    End Function
    Protected Function FindSILeaveTotalIR63(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnTyp_Code = 'SI' )" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")"

        Return GetData(Str)

    End Function
    Protected Function FindSILeaveTotalIR63_JanAndFeb(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnTyp_Code = 'SI' )" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(JanPeriod) & " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(FebPeriod) & ")"


        Return GetData(Str)

    End Function
    Protected Function FindSILeaveTotalIR63_NOT_JanAndFeb(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnTyp_Code = 'SI' )" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(JanPeriod) & " AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(FebPeriod) & ")"


        Return GetData(Str)

    End Function
    Protected Function FindSILeaveTotalIR63_JanFebAprMayJun(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String, ByVal AprPeriod As String, ByVal MayPeriod As String, ByVal JunPeriod As String, ByVal t14Period As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnTyp_Code = 'SI' )" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(JanPeriod) & _
            " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(FebPeriod) & _
            " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(AprPeriod) & _
            " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(MayPeriod) & _
            " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(JunPeriod) & _
            " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(t14Period) & ")"


        Return GetData(Str)

    End Function
    Protected Function FindSILeaveTotalIR63_NOT_JanFebAprMayJun(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String, ByVal AprPeriod As String, ByVal MayPeriod As String, ByVal JunPeriod As String, ByVal t14Period As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnTyp_Code = 'SI' )" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(JanPeriod) & _
            "  AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(FebPeriod) & _
            "  AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(AprPeriod) & _
            "  AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(MayPeriod) & _
            "  AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(JunPeriod) & _
            "  AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(t14Period) & ")"



        Return GetData(Str)

    End Function


    Protected Function FindSILeaveTotalIR63_2Groups(ByVal TemGrpCode As String, ByVal StrWithPeriodGroups As String, ByVal EmpCode As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE" & _
            "  (PrMsEarningCodes.ErnTyp_Code = 'SI' )" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")"

        Str = Str & StrWithPeriodGroups

        Return GetData(Str)

    End Function

    Protected Function FindBenefitsInKindTotalIR63(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnTyp_Code = 'BK' OR PrMsEarningCodes.ErnTyp_Code = 'BR' OR PrMsEarningCodes.ErnTyp_Code = 'B2' )" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")"

        Return GetData(Str)

    End Function
    Protected Function FindBenefitsInKindTotalIR63_JanAndFeb(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnTyp_Code = 'BK' OR PrMsEarningCodes.ErnTyp_Code = 'BR' OR PrMsEarningCodes.ErnTyp_Code = 'B2')" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(JanPeriod) & " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(FebPeriod) & ")"

        Return GetData(Str)

    End Function
    Protected Function FindBenefitsInKindTotalIR63_NOT_JanAndFeb(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnTyp_Code = 'BK' OR PrMsEarningCodes.ErnTyp_Code = 'BR' OR PrMsEarningCodes.ErnTyp_Code = 'B2' )" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(JanPeriod) & " AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(FebPeriod) & ")"

        Return GetData(Str)

    End Function
    Protected Function FindBenefitsInKindTotalIR63_JanFebAprMayJun(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String, ByVal AprPeriod As String, ByVal MayPeriod As String, ByVal JunPeriod As String, ByVal t14Period As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnTyp_Code = 'BK' OR PrMsEarningCodes.ErnTyp_Code = 'BR' OR PrMsEarningCodes.ErnTyp_Code = 'B2')" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(JanPeriod) & _
            "  OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(FebPeriod) & _
            "  OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(AprPeriod) & _
            "  OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(MayPeriod) & _
            "  OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(JunPeriod) & _
            "  OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(t14Period) & ")"

        Return GetData(Str)

    End Function
    Protected Function FindBenefitsInKindTotalIR63_NOT_JanFebAprMayJun(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String, ByVal AprPeriod As String, ByVal MayPeriod As String, ByVal JunPeriod As String, ByVal t14Period As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnTyp_Code = 'BK' OR PrMsEarningCodes.ErnTyp_Code = 'BR' OR PrMsEarningCodes.ErnTyp_Code = 'B2' )" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(JanPeriod) & _
            " AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(FebPeriod) & _
            " AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(AprPeriod) & _
            " AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(MayPeriod) & _
            " AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(JunPeriod) & _
            " AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(t14Period) & ")"

        Return GetData(Str)

    End Function
    Protected Function Find_EarningCode_Total_IR63(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String, ByVal EarnCode As String) As Double
        Dim Str As String
        Dim Value As Double = 0

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnCod_Code = " & enQuoteString(EarnCode) & ")" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")"
        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Value = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        Else
            Value = 0
        End If
        Return Value

    End Function
    Protected Function Find_EarningCode_Total_IR63_JanANDFeb(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String, ByVal EarnCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String) As Double
        Dim Str As String
        Dim Value As Double = 0



        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnCod_Code = " & enQuoteString(EarnCode) & ")" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")" & _
           "  AND (PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(JanPeriod) & " OR PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(FebPeriod) & ")"
        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Value = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        Else
            Value = 0
        End If
        Return Value

    End Function
    
    Protected Function Find_EarningCode_Total_IR63_NOT_JanANDFeb(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String, ByVal EarnCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String) As Double
        Dim Str As String
        Dim Value As Double = 0



        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnCod_Code = " & enQuoteString(EarnCode) & ")" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")" & _
           "  AND (PrTxTrxnHeader.PrdCod_Code<> " & enQuoteString(JanPeriod) & " AND PrTxTrxnHeader.PrdCod_Code<>" & enQuoteString(FebPeriod) & ")"
        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Value = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        Else
            Value = 0
        End If
        Return Value

    End Function
    Protected Function Find_EarningCode_Total_IR63_JanFebAprMayJun(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String, ByVal EarnCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String, ByVal AprPeriod As String, ByVal MayPeriod As String, ByVal JunPeriod As String, ByVal t14Period As String) As Double
        Dim Str As String
        Dim Value As Double = 0



        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnCod_Code = " & enQuoteString(EarnCode) & ")" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")" & _
           "  AND (PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(JanPeriod) & _
           " OR PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(FebPeriod) & _
           " OR PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(AprPeriod) & _
           " OR PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(MayPeriod) & _
           " OR PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(JunPeriod) & _
           " OR PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(t14Period) & ")"
        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Value = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        Else
            Value = 0
        End If
        Return Value

    End Function

    Protected Function Find_EarningCode_Total_IR63_NOT_JanFebAprMayJun(ByVal TemGrpCode As String, ByVal PerGrpCode As String, ByVal EmpCode As String, ByVal EarnCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String, ByVal AprPeriod As String, ByVal MayPeriod As String, ByVal JunPeriod As String, ByVal t14Period As String) As Double
        Dim Str As String
        Dim Value As Double = 0



        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            "  AND (PrMsEarningCodes.ErnCod_Code = " & enQuoteString(EarnCode) & ")" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")" & _
            "  AND (PrTxTrxnHeader.PrdCod_Code<> " & enQuoteString(JanPeriod) & _
            " AND PrTxTrxnHeader.PrdCod_Code<>" & enQuoteString(FebPeriod) & _
            " AND PrTxTrxnHeader.PrdCod_Code<>" & enQuoteString(AprPeriod) & _
            " AND PrTxTrxnHeader.PrdCod_Code<>" & enQuoteString(MayPeriod) & _
            " AND PrTxTrxnHeader.PrdCod_Code<>" & enQuoteString(JunPeriod) & _
            " AND PrTxTrxnHeader.PrdCod_Code<>" & enQuoteString(t14Period) & ")"
        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Value = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        Else
            Value = 0
        End If
        Return Value

    End Function



    Protected Function FindBenefitsInKindTotalIR63_2Groups(ByVal TemGrpCode As String, ByVal StrWithPeriodGroups As String, ByVal EmpCode As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE" & _
            "  (PrMsEarningCodes.ErnTyp_Code = 'BK' or PrMsEarningCodes.ErnTyp_Code = 'BR' or PrMsEarningCodes.ErnTyp_Code = 'B2' )" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")"

        Str = Str & StrWithPeriodGroups

        Return GetData(Str)

    End Function
    Protected Function FindBenefitsInKindTotalFor_Template_PeriodCode_Employee(ByVal TemGrpCode As String, ByVal PeriodCode As String, ByVal EmpCode As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue) " & _
        " FROM  PrTxTrxnLines INNER JOIN " & _
        " PrTxTrxnHeader ON  " & _
        " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN " & _
        " PrMsEarningCodes ON " & _
        " PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code " & _
        " WHERE " & _
        " (PrMsEarningCodes.ErnTyp_Code = 'BK' or PrMsEarningCodes.ErnTyp_Code = 'BR' or PrMsEarningCodes.ErnTyp_Code = 'B2' ) " & _
        " AND (PrTxTrxnHeader.Emp_Code= " & enQuoteString(EmpCode) & " ) " & _
        " AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PeriodCode) & " ) " & _
        " AND (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & " ) "

        Return GetData(Str)

    End Function
    Protected Function FindBenefitsInKindTotalFor_Template_PeriodGroup_Employee(ByVal TemGrpCode As String, ByVal PeriodGroup As String, ByVal EmpCode As String, ByVal PeriodCode As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue) " & _
        " FROM  PrTxTrxnLines INNER JOIN " & _
        " PrTxTrxnHeader ON  " & _
        " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN " & _
        " PrMsEarningCodes ON " & _
        " PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code " & _
        " WHERE " & _
        " (PrMsEarningCodes.ErnTyp_Code = 'BK' or PrMsEarningCodes.ErnTyp_Code = 'BR' or PrMsEarningCodes.ErnTyp_Code = 'B2' ) " & _
        " AND (PrTxTrxnHeader.Emp_Code= " & enQuoteString(EmpCode) & " ) " & _
        " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & " ) " & _
        " AND (PrTxTrxnHeader.PrdCod_Code <= " & enQuoteString(PeriodCode) & " ) " & _
        " AND (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode) & " ) "

        Return GetData(Str)

    End Function
    Protected Function FindDirFeesTotalIR63_2Groups(ByVal TemGrpCode As String, ByVal StrWithPeriodGroups As String, ByVal EmpCode As String) As DataSet
        Dim Str As String

        Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            "  FROM  PrTxTrxnLines INNER JOIN" & _
            "  PrTxTrxnHeader ON " & _
            "  PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            "  PrMsEarningCodes ON" & _
            "  PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            "  WHERE" & _
            "  (PrMsEarningCodes.ErnTyp_Code = 'DF')" & _
            "  AND (PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode) & ")"

        Str = Str & StrWithPeriodGroups

        Return GetData(Str)

    End Function
    Public Function GetSplitAcrossCompaniesForPeriods(ByVal empCode As String, ByVal PerF As cPrMsPeriodCodes, ByVal PerT As cPrMsPeriodCodes) As DataSet
        Dim Str As String
        Str = "select SUM(TrxHdr_PeriodUnits ), " & _
        " SUM(TrxHdr_totalernPeriod ), " & _
        " SUM(TrxHdr_totaldedPeriod ), " & _
        " SUM(TrxHdr_totalconPeriod ), " & _
        " SUM(TrxHdr_NetSalary  ) " & _
        " from PrTxTrxnHeader  " & _
        " where Emp_Code= " & enQuoteString(empCode) & _
        " and PrdGrp_Code = " & enQuoteString(PerF.PrdGrpCode) & _
        " and (PrdCod_code >=" & enQuoteString(PerF.Code) & " and PrdCod_code <=" & enQuoteString(PerT.Code) & ")"

        Return GetData(Str)
    End Function
    Public Function GetTaxCalculationReport(ByVal FromEmp As String, ByVal ToEmp As String, ByVal PeriodCode As String, ByVal PeriodGroup As String, ByVal TempGroup As String) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Ds As DataSet

        Str = "SELECT PrMsEmployees.Emp_Code AS Code,  " & _
        " PrMsEmployees.Emp_FullName as Name, " & _
        " PrTxIr59.TemGrp_Code as TemplateGroup, " & _
        " PrTxIr59.PrdGrp_Code as PeriodGroup, " & _
        " PrTxIr59.PrdCod_Code as Period, " & _
        " PrTxIr59.Act_GrossIncome as Gross, " & _
        " PrTxIr59.Act_Discounts as Discounts,  " & _
        " PrTxIr59.Act_FirstEmployeement as FirstEmployment, " & _
        " PrTxIr59.Act_Saldecrease as SalaryDecrease,  " & _
        " PrTxIr59.Act_PenFund as PensionFund,  " & _
        " PrTxIr59.Act_WOFund as WidowAndOrphansFund, " & _
        " PrTxIr59.Act_Union as UnionFund, " & _
        " PrTxIr59.Act_LifeIns as LifeInsurance, " & _
        " PrTxIr59.Act_PF as ProvidentFund,  " & _
        " PrTxIr59.Act_PFLimit ProvidentFundLimit, " & _
        " PrTxIr59.Act_SI as SocialInsurance,  " & _
        " PrTxIr59.Act_MF as MedicalFund, " & _
        " PrTxIr59.Act_MFLimit as MedicalFundLimit, " & _
        " PrTxIr59.Act_Gesi as NHS, " & _
        " PrTxIr59.Act_Gesi_BIK as NHSonBenefitsInKind, " & _
        " PrTxIr59.Act_Gesi_Limit as NHSLimit,  " & _
        " PrTxIr59.Act_Total as TotalTaxDeductableWithoutDiscount, " & _
        " PrTxIr59.Act_OneSixth as OneFifthRuleTotal, " & _
        " PrTxIr59.Act_Taxable as TaxableIncome,  " & _
        " PrTxIr59.Act_TotalTax as TaxOnTaxableIncome, " & _
        " PrTxIr59.Act_PaidTax as PaidTax, " & _
        " PrTxIr59.Act_RemTax as RemainingTax, " & _
        " PrTxIr59.Act_RemDivTaxableP as RemainingTaxDividedByTaxablePeriods, " & _
        " PrTxIr59.Pay_RemTaxablePeriods as RemainingTaxablePeriods, " & _
        " PrTxIr59.Pay_ActualDivNormal as ActualDivNormal, " & _
        " PrTxIr59.Pay_Dif as Taxdifference,  " & _
        " PrTxIr59.Pay_PeriodTax as PeriodTax" & _
        " FROM PrTxIr59 INNER JOIN " & _
        " PrMsEmployees ON PrTxIr59.Emp_Code COLLATE Greek_CI_AS = PrMsEmployees.Emp_Code " & _
        " WHERE (PrTxIr59.TemGrp_Code = " & enQuoteString(TempGroup) & " ) " & _
        " AND (PrTxIr59.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ") " & _
        " AND (PrTxIr59.PrdCod_Code = " & enQuoteString(PeriodCode) & " ) "

        If FromEmp <> "" Or ToEmp <> "" Then
            Str2 = " AND (PrTxIr59.Emp_Code>= " & enQuoteString(FromEmp) & ") " & _
            " AND (PrTxIr59.Emp_Code<= " & enQuoteString(ToEmp) & ") "
        End If

        Str = Str & Str2
        ds = GetData(Str)
        Return ds





    End Function



    Protected Function REPORT_IR7(ByVal PerGrp As cPrMsPeriodGroups, ByVal FromCode As String, ByVal ToCode As String, ByVal YearDate As Date) As DataSet
        Dim Ds As New DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim DsEmp As DataSet
        Dim i As Integer

        Dim R As DataRow

        Dim C_EmpLastName As Integer = 0
        Dim C_EmpFirstName As Integer = 1
        Dim C_EmpName As Integer = 2
        Dim C_EmpTaxID As Integer = 3
        Dim C_EmpIDType As Integer = 4
        Dim C_EmpIDCard As Integer = 5
        Dim C_Local As Integer = 6
        Dim C_Abroad As Integer = 7
        Dim C_Allowances As Integer = 8
        Dim C_Total456 As Integer = 9
        Dim C_SI As Integer = 10
        Dim C_PF As Integer = 11
        Dim C_MF As Integer = 12
        Dim C_UNION As Integer = 13
        Dim C_OtherDisc As Integer = 14
        Dim C_TotalDisc As Integer = 15
        Dim C_Taxable As Integer = 16
        Dim C_IT As Integer = 17
        Dim C_StartDate As Integer = 18
        Dim C_LeaveDate As Integer = 19
        Dim C_Adr1 As Integer = 20
        Dim C_Adr2 As Integer = 21
        Dim C_Adr3 As Integer = 22
        Dim C_PostCode As Integer = 23
        Dim C_PensionNo As Integer = 24
        Dim C_PensionType As Integer = 25
        Dim C_SINo As Integer = 26


        Dim LocalErn As Integer = 0
        Dim AbroadErn As Integer = 0
        Dim Allowances As Integer = 0
        Dim TotalErn As Integer = 0
        Dim SI As Integer = 0
        Dim MF As Integer = 0
        Dim Union As Integer = 0
        Dim PF As Integer = 0
        Dim LifeInsurance As Double = 0
        Dim OtherDisc As Double = 0
        Dim Life_Other As Integer
        Dim TotalDisc As Integer = 0

        Dim SYear As String = Format(YearDate, "yyyy-MM-dd")
        SYear = Utils.ChangeDateFormatForSearch(SYear)

        ' Define Data Table
        Dim dt As New DataTable

        dt = New DataTable("Employee")
        '0
        dt.Columns.Add(New DataColumn("EmpLastName", System.Type.GetType("System.String")))
        '1
        dt.Columns.Add(New DataColumn("EmpFirstName", System.Type.GetType("System.String")))
        '2
        dt.Columns.Add(New DataColumn("EmpName", System.Type.GetType("System.String")))
        '3
        dt.Columns.Add(New DataColumn("EmpTaxID", System.Type.GetType("System.String")))
        '4
        dt.Columns.Add(New DataColumn("EmpIDType", System.Type.GetType("System.String")))
        '5
        dt.Columns.Add(New DataColumn("EmpIDCard", System.Type.GetType("System.String")))
        '6
        dt.Columns.Add(New DataColumn("Local", System.Type.GetType("System.Int32")))
        '7
        dt.Columns.Add(New DataColumn("Abroad", System.Type.GetType("System.Int32")))
        '8
        dt.Columns.Add(New DataColumn("Allowances", System.Type.GetType("System.Int32")))
        '9
        dt.Columns.Add(New DataColumn("Total456", System.Type.GetType("System.Int32")))
        '10
        dt.Columns.Add(New DataColumn("SI", System.Type.GetType("System.Int32")))
        '11
        dt.Columns.Add(New DataColumn("PF", System.Type.GetType("System.Int32")))
        '12
        dt.Columns.Add(New DataColumn("MF", System.Type.GetType("System.Int32")))
        '13
        dt.Columns.Add(New DataColumn("UNION", System.Type.GetType("System.Int32")))
        '14
        dt.Columns.Add(New DataColumn("OtherDisc", System.Type.GetType("System.Int32")))
        '15
        dt.Columns.Add(New DataColumn("TotalDisc", System.Type.GetType("System.Int32")))
        '16
        dt.Columns.Add(New DataColumn("Taxable", System.Type.GetType("System.Int32")))
        '17
        dt.Columns.Add(New DataColumn("IT", System.Type.GetType("System.Double")))
        '18
        dt.Columns.Add(New DataColumn("StartDate", System.Type.GetType("System.String")))
        '19
        dt.Columns.Add(New DataColumn("LeaveDate", System.Type.GetType("System.String")))
        '20
        dt.Columns.Add(New DataColumn("Adr1", System.Type.GetType("System.String")))
        '21
        dt.Columns.Add(New DataColumn("Adr2", System.Type.GetType("System.String")))
        '22
        dt.Columns.Add(New DataColumn("Adr3", System.Type.GetType("System.String")))
        '23
        dt.Columns.Add(New DataColumn("PostCode", System.Type.GetType("System.String")))
        '24
        dt.Columns.Add(New DataColumn("PensionNo", System.Type.GetType("System.String")))
        '25
        dt.Columns.Add(New DataColumn("PensionType", System.Type.GetType("System.String")))
        '26
        dt.Columns.Add(New DataColumn("SINumber", System.Type.GetType("System.String")))

        Ds.Tables.Add(dt)

        '''''''''''''''''

        Str = " SELECT Emp_Code," & _
        " Emp_FullName," & _
        " Emp_Address1," & _
        " Emp_Address2," & _
        " Emp_Address3," & _
        " Emp_PostCode," & _
        " Emp_TaxID," & _
        " Emp_TerminateDate, " & _
        " Emp_StartDate," & _
        " Emp_LastName," & _
        " Emp_FirstName," & _
        " Emp_PassportNumber," & _
        " Emp_IdentificationCard," & _
        " Emp_AlienNumber," & _
        " Emp_SocialInsNumber," & _
        " TicTyp_Code," & _
        " Emp_DrivingLicense, " & _
        " Emp_PensionNo," & _
        " Emp_PensionType, " & _
        " Emp_socialinsnumber " & _
        " FROM PrMsEmployees" & _
        " WHERE (TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")" & _
        " AND (emp_startdate < " & enQuoteString(SYear) & ")"
        If FromCode <> "" Or ToCode <> "" Then
            Str2 = " AND (Emp_Code >= " & enQuoteString(FromCode) & _
                 " AND Emp_Code <= " & enQuoteString(ToCode) & ")"
        End If
        Str = Str & Str2

        DsEmp = GetData(Str)
        If CheckDataSet(DsEmp) Then


            For i = 0 To DsEmp.Tables(0).Rows.Count - 1
                R = dt.NewRow

                Dim EmpCode As String
                EmpCode = DbNullToString(DsEmp.Tables(0).Rows(i).Item(0))

                R(C_EmpName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(1))
                R(C_Adr1) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(2))
                R(C_Adr2) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(3))
                R(C_Adr3) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(4))
                R(C_PostCode) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(5))
                R(C_EmpTaxID) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(6))
                Dim T As String
                T = DbNullToString(DsEmp.Tables(0).Rows(i).Item(7))
                If T = "" Then
                    R(C_LeaveDate) = ""
                Else
                    R(C_LeaveDate) = Format(CDate(T), "dd/MM/yyyy")
                End If 'DbNullToString(DsEmp.Tables(0).Rows(i).Item(7))
                R(C_StartDate) = Format(DbNullToDate(DsEmp.Tables(0).Rows(i).Item(8)), "dd/MM/yyyy")

                R(C_EmpLastName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(9))
                R(C_EmpFirstName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(10))

                Dim IDType As String = DbNullToString(DsEmp.Tables(0).Rows(i).Item(15))
                If IDType = "1" Then
                    R(C_EmpIDType) = " "
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(6))
                ElseIf IDType = "2" Then
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(11))
                ElseIf IDType = "3" Then
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(12))
                ElseIf IDType = "4" Then
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(16))
                ElseIf IDType = "5" Then
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(14))
                ElseIf IDType = "6" Then
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(16))
                ElseIf IDType = "7" Then
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(13))
                End If

                R(C_PensionNo) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(17))
                R(C_PensionType) = DbNullToInt(DsEmp.Tables(0).Rows(i).Item(18))
                R(C_SINo) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(19))



                Dim DsGrossEarnings As DataSet
                Str = " SELECT SUM(TrxHdr_TaxableIncome)" & _
                      " FROM  PrTxTrxnHeader" & _
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                      " AND (PrdGrp_Code =  " & enQuoteString(PerGrp.Code) & ")"

                DsGrossEarnings = GetData(Str)

                LocalErn = RoundMe3(DbNullToDouble(DsGrossEarnings.Tables(0).Rows(0).Item(0)), 0)
                R(C_Local) = LocalErn

                AbroadErn = "0.00"
                R(C_Abroad) = AbroadErn
                Allowances = "0.00"
                R(C_Allowances) = Allowances

                TotalErn = LocalErn + AbroadErn + Allowances
                R(C_Total456) = TotalErn



                Dim DsSI As DataSet = GetSumsOfEmployeeDeductions("SI", EmpCode, PerGrp.Code)
                SI = RoundMe3(DbNullToDouble(DsSI.Tables(0).Rows(0).Item(0)), 0)
                R(C_SI) = SI

                Dim DsPF As DataSet = GetSumsOfEmployeeDeductions("PF", EmpCode, PerGrp.Code)
                PF = RoundMe3(DbNullToDouble(DsPF.Tables(0).Rows(0).Item(0)), 0)
                R(C_PF) = PF

                Dim DsMF As DataSet = GetSumsOfEmployeeDeductions("MF", EmpCode, PerGrp.Code)
                MF = RoundMe3(DbNullToDouble(DsMF.Tables(0).Rows(0).Item(0)), 0)
                R(C_MF) = MF


                Dim DsU2 As DataSet = GetSumsOfEmployeeDeductions("U2", EmpCode, PerGrp.Code)
                Dim DsU3 As DataSet = GetSumsOfEmployeeDeductions("U3", EmpCode, PerGrp.Code)
                Dim DsUS As DataSet = GetSumsOfEmployeeDeductions("US", EmpCode, PerGrp.Code)
                Dim U As Double
                U = U + DbNullToDouble(DsU2.Tables(0).Rows(0).Item(0))
                U = U + DbNullToDouble(DsU3.Tables(0).Rows(0).Item(0))
                U = U + DbNullToDouble(DsUS.Tables(0).Rows(0).Item(0))
                Union = RoundMe3(U, 2)

                R(C_UNION) = Union
                Dim DsDiscounts As DataSet
                Str = " Select SUM(TrxHdr_LifeInsurance)," & _
                      " SUM(TrxHdr_Discounts)" & _
                      " FROM  PrTxTrxnHeader" & _
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                      " AND (PrdGrp_Code =  " & enQuoteString(PerGrp.Code) & ")"
                DsDiscounts = GetData(Str)
                LifeInsurance = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(0))
                OtherDisc = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(1))

                Life_Other = RoundMe3(LifeInsurance + OtherDisc, 2)

                R(C_OtherDisc) = Life_Other

                TotalDisc = SI + PF + MF + Union + +Life_Other

                R(C_TotalDisc) = TotalDisc
                R(C_Taxable) = TotalErn - TotalDisc

                Dim DsIT As DataSet = GetSumsOfEmployeeDeductions("IT", EmpCode, PerGrp.Code)
                R(C_IT) = DbNullToDouble(DsIT.Tables(0).Rows(0).Item(0))


                dt.Rows.Add(R)
            Next

            Dim DsComp As DataSet
            Str = " SELECT AdMsCompany.Com_Name," & _
                " AdMsCompany.Com_TIC," & _
                " AdMsCompany.Com_Address1," & _
                " AdMsCompany.Com_Address2, " & _
                " AdMsCompany.Com_Address3," & _
                " AdMsCompany.Com_Address4," & _
                " AdMsCompany.Com_AccountantTitle," & _
                " PrMsTemplateGroup.TemGrp_Code" & _
                " FROM AdMsCompany INNER JOIN" & _
                " PrMsTemplateGroup ON " & _
                " AdMsCompany.Com_Code = PrMsTemplateGroup.Com_Code" & _
                " WHERE (PrMsTemplateGroup.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

            DsComp = GetData(Str)
            Ds.Tables.Add(DsComp.Tables(0).Copy)
            Ds.Tables(1).TableName = "CompanyDetails"

            Dim DsYear As DataSet
            Str = " SELECT PrdGpr_Year" & _
                  " FROM PrMsPeriodGroups" & _
                  " where PrdGrp_Code=" & enQuoteString(PerGrp.Code)

            DsYear = GetData(Str)
            Ds.Tables.Add(DsYear.Tables(0).Copy)
            Ds.Tables(2).TableName = "Year"

        End If


        Return Ds
    End Function
    Protected Function REPORT_IR7_2(ByVal PerGrp As cPrMsPeriodGroups, ByVal FromCode As String, ByVal ToCode As String, ByVal YearDate As Date, ByVal ShowMessages As Boolean) As DataSet
        Dim Ds As New DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim DsEmp As DataSet
        Dim i As Integer

        Dim R As DataRow

        Dim C_EmpLastName As Integer = 0
        Dim C_EmpFirstName As Integer = 1
        Dim C_EmpName As Integer = 2
        Dim C_EmpTaxID As Integer = 3
        Dim C_EmpIDType As Integer = 4
        Dim C_EmpIDCard As Integer = 5
        Dim C_Local As Integer = 6
        Dim C_Abroad As Integer = 7
        Dim C_Allowances As Integer = 8
        Dim C_Total456 As Integer = 9
        Dim C_SI As Integer = 10
        Dim C_PF As Integer = 11
        Dim C_MF As Integer = 12
        Dim C_UNION As Integer = 13
        Dim C_OtherDisc As Integer = 14
        Dim C_TotalDisc As Integer = 15
        Dim C_Taxable As Integer = 16
        Dim C_IT As Integer = 17
        Dim C_StartDate As Integer = 18
        Dim C_LeaveDate As Integer = 19
        Dim C_Adr1 As Integer = 20
        Dim C_Adr2 As Integer = 21
        Dim C_Adr3 As Integer = 22
        Dim C_PostCode As Integer = 23
        Dim C_PensionNo As Integer = 24
        Dim C_PensionType As Integer = 25
        Dim C_SINo As Integer = 26
        Dim C_EmpCode As Integer = 27
        Dim C_STDeduction As Integer = 28
        Dim C_STContribution As Integer = 29
        Dim C_salaryPeriods As Integer = 30



        Dim LocalErn As Integer = 0
        Dim AbroadErn As Integer = 0
        Dim Allowances As Integer = 0
        Dim TotalErn As Integer = 0
        Dim SI As Integer = 0
        Dim MF As Integer = 0
        Dim Union As Integer = 0
        Dim PF As Integer = 0
        Dim LifeInsurance As Double = 0
        Dim OtherDisc As Double = 0
        Dim Life_Other As Integer
        Dim TotalDisc As Integer = 0

        Dim D2 As Date
        D2 = DateAdd(DateInterval.Year, 1, YearDate)
        Dim SYear As String = Format(D2, "yyyy-MM-dd")
        SYear = Utils.ChangeDateFormatForSearch(SYear)

        ' Define Data Table
        Dim dt As New DataTable

        dt = New DataTable("Employee")
        '0
        dt.Columns.Add(New DataColumn("EmpLastName", System.Type.GetType("System.String")))
        '1
        dt.Columns.Add(New DataColumn("EmpFirstName", System.Type.GetType("System.String")))
        '2
        dt.Columns.Add(New DataColumn("EmpName", System.Type.GetType("System.String")))
        '3
        dt.Columns.Add(New DataColumn("EmpTaxID", System.Type.GetType("System.String")))
        '4
        dt.Columns.Add(New DataColumn("EmpIDType", System.Type.GetType("System.String")))
        '5
        dt.Columns.Add(New DataColumn("EmpIDCard", System.Type.GetType("System.String")))
        '6
        dt.Columns.Add(New DataColumn("Local", System.Type.GetType("System.Int32")))
        '7
        dt.Columns.Add(New DataColumn("Abroad", System.Type.GetType("System.Int32")))
        '8
        dt.Columns.Add(New DataColumn("Allowances", System.Type.GetType("System.Int32")))
        '9
        dt.Columns.Add(New DataColumn("Total456", System.Type.GetType("System.Int32")))
        '10
        dt.Columns.Add(New DataColumn("SI", System.Type.GetType("System.Int32")))
        '11
        dt.Columns.Add(New DataColumn("PF", System.Type.GetType("System.Int32")))
        '12
        dt.Columns.Add(New DataColumn("MF", System.Type.GetType("System.Int32")))
        '13
        dt.Columns.Add(New DataColumn("UNION", System.Type.GetType("System.Int32")))
        '14
        dt.Columns.Add(New DataColumn("OtherDisc", System.Type.GetType("System.Int32")))
        '15
        dt.Columns.Add(New DataColumn("TotalDisc", System.Type.GetType("System.Int32")))
        '16
        dt.Columns.Add(New DataColumn("Taxable", System.Type.GetType("System.Int32")))
        '17
        dt.Columns.Add(New DataColumn("IT", System.Type.GetType("System.Double")))
        '18
        dt.Columns.Add(New DataColumn("StartDate", System.Type.GetType("System.String")))
        '19
        dt.Columns.Add(New DataColumn("LeaveDate", System.Type.GetType("System.String")))
        '20
        dt.Columns.Add(New DataColumn("Adr1", System.Type.GetType("System.String")))
        '21
        dt.Columns.Add(New DataColumn("Adr2", System.Type.GetType("System.String")))
        '22
        dt.Columns.Add(New DataColumn("Adr3", System.Type.GetType("System.String")))
        '23
        dt.Columns.Add(New DataColumn("PostCode", System.Type.GetType("System.String")))
        '24
        dt.Columns.Add(New DataColumn("PensionNo", System.Type.GetType("System.String")))
        '25
        dt.Columns.Add(New DataColumn("PensionType", System.Type.GetType("System.String")))
        '26
        dt.Columns.Add(New DataColumn("SINumber", System.Type.GetType("System.String")))
        '27
        dt.Columns.Add(New DataColumn("EmpCode", System.Type.GetType("System.String")))
        '28
        dt.Columns.Add(New DataColumn("STDeduction", System.Type.GetType("System.Double")))
        '29
        dt.Columns.Add(New DataColumn("STContribution", System.Type.GetType("System.Double")))
        '30
        dt.Columns.Add(New DataColumn("SalaryPeriods", System.Type.GetType("System.Int32")))

        Ds.Tables.Add(dt)

        '''''''''''''''''
        Dim TempGroup As New cPrMsTemplateGroup(PerGrp.TemGrpCode)

        Str = " SELECT Emp_Code," & _
        " Emp_FullName," & _
        " Emp_Address1," & _
        " Emp_Address2," & _
        " Emp_Address3," & _
        " Emp_PostCode," & _
        " Emp_TaxID," & _
        " Emp_TerminateDate, " & _
        " Emp_StartDate," & _
        " Emp_LastName," & _
        " Emp_FirstName," & _
        " Emp_PassportNumber," & _
        " Emp_IdentificationCard," & _
        " Emp_AlienNumber," & _
        " Emp_SocialInsNumber," & _
        " TicTyp_Code," & _
        " Emp_DrivingLicense, " & _
        " Emp_PensionNo," & _
        " Emp_PensionType, " & _
        " Emp_socialinsnumber, " & _
        " Emp_OtherIncome1 " & _
         " FROM PrMsEmployees" & _
        " inner join PrMsTemplateGroup ON " & _
        " PrMsEmployees.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code " & _
        " INNER JOIN" & _
        " AdMsCompany ON " & _
        " PrMsTemplateGroup.Com_Code = AdMsCompany.Com_Code" & _
        " WHERE (AdMsCompany.Com_Code = " & enQuoteString(TempGroup.CompanyCode) & ")" & _
        " AND (emp_startdate < " & enQuoteString(SYear) & ")"
        If FromCode <> "" Or ToCode <> "" Then
            Str2 = " AND (Emp_Code >= " & enQuoteString(FromCode) & _
                 " AND Emp_Code <= " & enQuoteString(ToCode) & ")"
        End If
        Str = Str & Str2

        DsEmp = GetData(Str)
        If CheckDataSet(DsEmp) Then


            For i = 0 To DsEmp.Tables(0).Rows.Count - 1
                R = dt.NewRow
               

                Application.DoEvents()
                Dim EmpCode As String
                EmpCode = DbNullToString(DsEmp.Tables(0).Rows(i).Item(0))

                R(C_EmpName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(1))
                '  Debug.WriteLine(i & " " & DbNullToString(DsEmp.Tables(0).Rows(i).Item(1)))

                R(C_Adr1) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(2))
                R(C_Adr2) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(3))
                R(C_Adr3) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(4))
                R(C_PostCode) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(5))
                R(C_EmpTaxID) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(6))
                Dim T As String
                T = DbNullToString(DsEmp.Tables(0).Rows(i).Item(7))
                If T = "" Then
                    R(C_LeaveDate) = ""
                Else
                    Try
                        R(C_LeaveDate) = Format(CDate(T), "dd/MM/yyyy")

                    Catch ex As Exception
                        MsgBox("Error on Employee with Code " & EmpCode & " Leave date is invalid", MsgBoxStyle.Critical)
                        Ds.Tables.Clear()
                        Exit Function

                    End Try
                End If 'DbNullToString(DsEmp.Tables(0).Rows(i).Item(7))
                If DbNullToDate(DsEmp.Tables(0).Rows(i).Item(8)).Year = YearDate.Year() Then
                    R(C_StartDate) = Format(DbNullToDate(DsEmp.Tables(0).Rows(i).Item(8)), "dd/MM/yyyy")
                Else
                    R(C_StartDate) = " "
                End If


                R(C_EmpLastName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(9))
                R(C_EmpFirstName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(10))

                Dim IDType As String = DbNullToString(DsEmp.Tables(0).Rows(i).Item(15))
                Dim Found As Boolean = False
                If IDType = "1" Then
                    Found = True
                    R(C_EmpIDType) = " "
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(6))
                    'ElseIf IDType = "2" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(11))
                ElseIf IDType = "3" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    'R(C_EmpIDType) = ""
                    If DbNullToString(DsEmp.Tables(0).Rows(i).Item(12)) <> "" Then
                        Dim S As String
                        S = DsEmp.Tables(0).Rows(i).Item(12)
                        If S.Substring(0, 1) = "0" Then
                            S = S.Substring(1, S.Length - 1)
                            DsEmp.Tables(0).Rows(i).Item(12) = S
                        End If
                    End If
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(12))
                ElseIf IDType = "4" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(16))
                    'ElseIf IDType = "5" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(14))
                    'ElseIf IDType = "6" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(16))
                ElseIf IDType = "7" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(13))
                End If
                If Not Found Then
                    If ShowMessages Then
                        MsgBox("Employee with Code " & EmpCode & " Does not have a Valid Tax Identification Type, Valid types are 1,3,4 and 7")
                        Ds.Tables.Clear()
                        Exit Function
                    End If
                End If

                R(C_PensionNo) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(17))
                R(C_PensionType) = DbNullToInt(DsEmp.Tables(0).Rows(i).Item(18))
                R(C_SINo) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(19))
                R(C_EmpCode) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(0))
                Dim DsPerPerCom As DataSet
                Dim StrX As String
                StrX = "SELECT PrMsPeriodGroups.PrdGrp_Code " & _
                " FROM PrMsPeriodGroups INNER JOIN " & _
                " PrMsTemplateGroup ON " & _
                " PrMsPeriodGroups.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code " & _
                " INNER JOIN " & _
                " AdMsCompany ON PrMsTemplateGroup.Com_Code = AdMsCompany.Com_Code " & _
                " WHERE (PrMsTemplateGroup.Com_Code = " & enQuoteString(TempGroup.CompanyCode) & ")  " & _
                " AND (PrMsPeriodGroups.PrdGpr_Year = " & PerGrp.Year & ") "
                DsPerPerCom = GetData(StrX)

                Dim f As Integer
                Dim StrPeriodGroupCodes
                Dim StrPeriodGroupCodes2
                Dim TempPer As String
                If CheckDataSet(DsPerPerCom) Then
                    For f = 0 To DsPerPerCom.Tables(0).Rows.Count - 1
                        TempPer = DsPerPerCom.Tables(0).Rows(f).Item(0)
                        If f = 0 Then
                            StrPeriodGroupCodes = " AND ((PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                            StrPeriodGroupCodes2 = " AND ((PrTxTrxnHeader.PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                        Else
                            StrPeriodGroupCodes = StrPeriodGroupCodes & " OR (PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                            StrPeriodGroupCodes2 = StrPeriodGroupCodes2 & " OR (PrTxTrxnHeader.PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                        End If
                    Next
                    StrPeriodGroupCodes = StrPeriodGroupCodes & ")"
                    StrPeriodGroupCodes2 = StrPeriodGroupCodes2 & ")"

                End If

                Dim DsSpecialTaxDed As DataSet
                Dim DsSpecialTaxCon As DataSet
                GetSumsOfEmployeeDeductions("EX", EmpCode, PerGrp.Code)
                Dim StrSP1 As String
                Dim StrSP2 As String

                StrSP1 = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnHeader INNER JOIN" & _
                    " PrTxTrxnLines ON" & _
                    " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
                    " PrMsDeductionCodes ON" & _
                    " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN" & _
                    " PrSsDeductionTypes ON" & _
                    " PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code" & _
                    " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                    " AND (PrSsDeductionTypes.DedTyp_Code = 'EX')"

                StrSP1 = StrSP1 + StrPeriodGroupCodes2

                StrSP2 = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnHeader INNER JOIN" & _
                    " PrTxTrxnLines ON" & _
                    " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
                    " PrMsContributionCodes ON" & _
                    " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code INNER JOIN" & _
                    " PrSsContributionTypes ON" & _
                    " PrMsContributionCodes.ConTyp_Code = PrSsContributionTypes.ConTyp_Code" & _
                    " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                    " AND (PrSsContributionTypes.ConTyp_Code = 'EX')"

                StrSP2 = StrSP2 + StrPeriodGroupCodes2

                DsSpecialTaxDed = GetData(StrSP1)
                DsSpecialTaxCon = GetData(StrSP2)
                Dim SPTaxDed As Double = 0
                Dim SPTaxCon As Double = 0

                If CheckDataSet(DsSpecialTaxDed) Then
                    SPTaxDed = DbNullToDouble(DsSpecialTaxDed.Tables(0).Rows(0).Item(0))
                End If
                If CheckDataSet(DsSpecialTaxCon) Then
                    SPTaxCon = DbNullToDouble(DsSpecialTaxCon.Tables(0).Rows(0).Item(0))
                End If

                R(C_STDeduction) = SPTaxDed
                R(C_STContribution) = SPTaxCon


                Dim DsGrossEarnings As DataSet
                Dim DsTaxableEarnings As DataSet


                Str = " SELECT SUM(TrxHdr_TotalErnPeriod)" & _
                      " FROM  PrTxTrxnHeader" & _
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                Str = Str & StrPeriodGroupCodes
                DsGrossEarnings = GetData(Str)

                Str = " SELECT SUM(TrxHdr_TaxableIncome)" & _
                      " FROM  PrTxTrxnHeader" & _
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                Str = Str & StrPeriodGroupCodes
                DsTaxableEarnings = GetData(Str)

                Dim NonTaxable As Double
                NonTaxable = FindNonTaxableTotalForTemplateGroupForEmployee(TempGroup.Code, PerGrp.Code, EmpCode)

                Dim DsSILeave As DataSet
                'DsSILeave = Me.FindSILeaveTotalIR632(PerGrp.TemGrpCode, PerGrp.Code, EmpCode)
                DsSILeave = Me.FindSILeaveTotalIR63_2Groups(PerGrp.TemGrpCode, StrPeriodGroupCodes, EmpCode)
                Dim SILeaveValue As Double = 0
                If CheckDataSet(DsSILeave) Then
                    SILeaveValue = DbNullToDouble(DsSILeave.Tables(0).Rows(0).Item(0))
                    If SILeaveValue <> 0 Then
                        ' MsgBox(1)
                    End If
                End If

                Dim DsBenefitsInKind As DataSet
                DsBenefitsInKind = Me.FindBenefitsInKindTotalIR63_2Groups(PerGrp.TemGrpCode, StrPeriodGroupCodes, EmpCode)
                Dim BenefitsInKind As Double = 0
                If CheckDataSet(DsBenefitsInKind) Then
                    BenefitsInKind = DbNullToDouble(DsBenefitsInKind.Tables(0).Rows(0).Item(0))
                    If BenefitsInKind <> 0 Then
                        ' MsgBox(1)
                    End If
                End If



                LocalErn = DbNullToDouble(DsGrossEarnings.Tables(0).Rows(0).Item(0)) - NonTaxable + SILeaveValue + BenefitsInKind





                'LocalErn = RoundMe3(LocalErn, 0)

                R(C_Local) = LocalErn




                AbroadErn = "0.00"
                R(C_Abroad) = AbroadErn
                Allowances = RoundMe3(DbNullToDouble(DsEmp.Tables(0).Rows(i).Item(20)), 2)

                R(C_Allowances) = Allowances

                TotalErn = LocalErn + AbroadErn + Allowances
                R(C_Total456) = TotalErn



                Dim DsSI As DataSet = GetSumsOfEmployeeDeductions_IR7("SI", EmpCode, StrPeriodGroupCodes)
                SI = RoundMe3(DbNullToDouble(DsSI.Tables(0).Rows(0).Item(0)), 0)
                R(C_SI) = SI

                Dim DsPF As DataSet = GetSumsOfEmployeeDeductions_IR7("PF", EmpCode, StrPeriodGroupCodes)
                PF = RoundMe3(DbNullToDouble(DsPF.Tables(0).Rows(0).Item(0)), 0)
                R(C_PF) = PF

                Dim DsMF As DataSet = GetSumsOfEmployeeDeductions_IR7("MF", EmpCode, StrPeriodGroupCodes)
                MF = RoundMe3(DbNullToDouble(DsMF.Tables(0).Rows(0).Item(0)), 0)
                R(C_MF) = MF


                Dim DsU2 As DataSet = GetSumsOfEmployeeDeductions_IR7("U2", EmpCode, StrPeriodGroupCodes)
                Dim DsU3 As DataSet = GetSumsOfEmployeeDeductions_IR7("U3", EmpCode, StrPeriodGroupCodes)
                Dim DsUS As DataSet = GetSumsOfEmployeeDeductions_IR7("US", EmpCode, StrPeriodGroupCodes)
                Dim U As Double = 0
                U = U + DbNullToDouble(DsU2.Tables(0).Rows(0).Item(0))
                U = U + DbNullToDouble(DsU3.Tables(0).Rows(0).Item(0))
                U = U + DbNullToDouble(DsUS.Tables(0).Rows(0).Item(0))
                Union = 0
                Union = RoundMe3(U, 2)

                R(C_UNION) = Union

                'FindEmployeeSalaryPeriods
                Dim NoOfSalary As Integer
                NoOfSalary = Global1.Business.GetNumberOfTotalPeriodsFOREmployee(EmpCode, PerGrp.Year)
                R(C_salaryPeriods) = NoOfSalary

                '
                Life_Other = 0
                OtherDisc = 0

                If Global1.GLB_IR7Discounts = 0 Then
                    '------------------------------------
                    ''''''Discounts from Header''''''''''
                    '------------------------------------
                    Dim DsDiscounts As DataSet
                    Str = " Select SUM(TrxHdr_LifeInsurance)," & _
                          " SUM(TrxHdr_Discounts+TrxHdr_FE)" & _
                          " FROM  PrTxTrxnHeader" & _
                          " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                    Str = Str & StrPeriodGroupCodes

                    DsDiscounts = GetData(Str)
                    LifeInsurance = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(0))
                    OtherDisc = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(1))

                    Life_Other = RoundMe3(LifeInsurance + OtherDisc, 2)
                Else
                    '------------------------------------
                    ''''''Discounts from Header''''''''''
                    '------------------------------------
                    Dim DsDiscounts
                    DsDiscounts = GetSumsOfEmployeeDiscounts_IR7(EmpCode, StrPeriodGroupCodes)
                    If CheckDataSet(DsDiscounts) Then
                        OtherDisc = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(0))
                    End If

                    Life_Other = RoundMe3(OtherDisc, 2)

                End If
                '''''''''''''''''''''''''''''''''''''
                '------------------------------------
                '''''''''''''''''''''''''''''''''''''
                Life_Other = Life_Other + SPTaxDed

                R(C_OtherDisc) = Life_Other


                TotalDisc = SI + PF + MF + Union + Life_Other

                R(C_TotalDisc) = TotalDisc

                Dim Taxable As Double
                Taxable = RoundMe3(DbNullToDouble(DsTaxableEarnings.Tables(0).Rows(0).Item(0)), 0)
                'R(C_Taxable) = TotalErn - TotalDisc
                Taxable = Taxable - TotalDisc + Allowances
                ''''''''''''''''''''''''''''''''''''''''''
                'Change Action Pension
                ''''''''''''''''''''''''''''''''''''''''''
                If Taxable <> TotalErn - TotalDisc Then
                    Taxable = TotalErn - TotalDisc
                End If
                ''''''''''''''''''''''''''''''''''''''''''

                R(C_Taxable) = Taxable


                Dim DsIT As DataSet = GetSumsOfEmployeeDeductions_IR7("IT", EmpCode, StrPeriodGroupCodes)
                R(C_IT) = DbNullToDouble(DsIT.Tables(0).Rows(0).Item(0))

                Str = " SELECT count(*)" & _
                      " FROM  PrTxTrxnHeader" & _
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                Str = Str & StrPeriodGroupCodes
                Dim DsCount As DataSet
                DsCount = GetData(Str)
                If CheckDataSet(DsCount) Then
                    If DbNullToInt(DsCount.Tables(0).Rows(0).Item(0)) <> 0 Then
                        dt.Rows.Add(R)
                    End If
                End If
            Next

            Dim DsComp As DataSet
            Str = " SELECT AdMsCompany.Com_Name," & _
                " AdMsCompany.Com_TIC," & _
                " AdMsCompany.Com_Address1," & _
                " AdMsCompany.Com_Address2, " & _
                " AdMsCompany.Com_Address3," & _
                " AdMsCompany.Com_Address4," & _
                " AdMsCompany.Com_AccountantTitle," & _
                " PrMsTemplateGroup.TemGrp_Code" & _
                " FROM AdMsCompany INNER JOIN" & _
                " PrMsTemplateGroup ON " & _
                " AdMsCompany.Com_Code = PrMsTemplateGroup.Com_Code" & _
                " WHERE (PrMsTemplateGroup.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

            DsComp = GetData(Str)
            Ds.Tables.Add(DsComp.Tables(0).Copy)
            Ds.Tables(1).TableName = "CompanyDetails"

            Dim DsYear As DataSet
            Str = " SELECT PrdGpr_Year" & _
                  " FROM PrMsPeriodGroups" & _
                  " where PrdGrp_Code=" & enQuoteString(PerGrp.Code)

            DsYear = GetData(Str)
            Ds.Tables.Add(DsYear.Tables(0).Copy)
            Ds.Tables(2).TableName = "Year"

        End If


        Return Ds
    End Function
    Protected Function REPORT_IR7_3(ByVal PerGrp As cPrMsPeriodGroups, ByVal FromCode As String, ByVal ToCode As String, ByVal YearDate As Date, ByVal ShowMessages As Boolean) As DataSet
        Dim Ds As New DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim DsEmp As DataSet
        Dim i As Integer

        Dim R As DataRow

        Dim C_EmpLastName As Integer = 0
        Dim C_EmpFirstName As Integer = 1
        Dim C_EmpName As Integer = 2
        Dim C_EmpTaxID As Integer = 3
        Dim C_EmpIDType As Integer = 4
        Dim C_EmpIDCard As Integer = 5
        Dim C_Local As Integer = 6
        Dim C_Abroad As Integer = 7
        Dim C_Allowances As Integer = 8
        Dim C_Total456 As Integer = 9
        Dim C_SI As Integer = 10
        Dim C_PF As Integer = 11
        Dim C_MF As Integer = 12
        Dim C_UNION As Integer = 13
        Dim C_OtherDisc As Integer = 14
        Dim C_TotalDisc As Integer = 15
        Dim C_Taxable As Integer = 16
        Dim C_IT As Integer = 17
        Dim C_StartDate As Integer = 18
        Dim C_LeaveDate As Integer = 19
        Dim C_Adr1 As Integer = 20
        Dim C_Adr2 As Integer = 21
        Dim C_Adr3 As Integer = 22
        Dim C_PostCode As Integer = 23
        Dim C_PensionNo As Integer = 24
        Dim C_PensionType As Integer = 25
        Dim C_SINo As Integer = 26
        Dim C_EmpCode As Integer = 27
        Dim C_STDeduction As Integer = 28
        Dim C_STContribution As Integer = 29
        Dim C_salaryPeriods As Integer = 30
        Dim C_LifeInsurance As Integer = 31

        Dim C_AllowancesBenefits As Integer = 32
        Dim C_TaxableFromOther As Integer = 33
        Dim C_NonTaxableIncome As Integer = 34
        Dim C_SyntaksiodotikaOfelimata As Integer = 35
        Dim C_MeiwsiApolavon As Integer = 36
        Dim C_WidowAndOrphans As Integer = 37
        Dim C_Pensionfund As Integer = 38




        Dim LocalErn As Integer = 0
        Dim AbroadErn As Integer = 0
        Dim Allowances As Integer = 0
        Dim TotalErn As Integer = 0
        Dim SI As Integer = 0
        Dim MF As Integer = 0
        Dim Union As Integer = 0
        Dim PF As Integer = 0
        Dim LifeInsurance As Double = 0
        Dim OtherDisc As Double = 0
        Dim FE As Double = 0
        Dim Life_Other As Integer
        Dim LifeIns As Integer
        Dim TotalDisc As Integer = 0


        Dim MeiwsiApolavon As Double
        Dim WidowAndOrphans As Double
        Dim Pensionfund As Integer

        Dim D2 As Date
        D2 = DateAdd(DateInterval.Year, 1, YearDate)
        Dim SYear As String = Format(D2, "yyyy-MM-dd")
        SYear = Utils.ChangeDateFormatForSearch(SYear)

        ' Define Data Table
        Dim dt As New DataTable

        dt = New DataTable("Employee")
        '0
        dt.Columns.Add(New DataColumn("EmpLastName", System.Type.GetType("System.String")))
        '1
        dt.Columns.Add(New DataColumn("EmpFirstName", System.Type.GetType("System.String")))
        '2
        dt.Columns.Add(New DataColumn("EmpName", System.Type.GetType("System.String")))
        '3
        dt.Columns.Add(New DataColumn("EmpTaxID", System.Type.GetType("System.String")))
        '4
        dt.Columns.Add(New DataColumn("EmpIDType", System.Type.GetType("System.String")))
        '5
        dt.Columns.Add(New DataColumn("EmpIDCard", System.Type.GetType("System.String")))
        '6
        dt.Columns.Add(New DataColumn("Local", System.Type.GetType("System.Int32")))
        '7
        dt.Columns.Add(New DataColumn("Abroad", System.Type.GetType("System.Int32")))
        '8
        dt.Columns.Add(New DataColumn("Allowances", System.Type.GetType("System.Int32")))
        '9
        dt.Columns.Add(New DataColumn("Total456", System.Type.GetType("System.Int32")))
        '10
        dt.Columns.Add(New DataColumn("SI", System.Type.GetType("System.Int32")))
        '11
        dt.Columns.Add(New DataColumn("PF", System.Type.GetType("System.Int32")))
        '12
        dt.Columns.Add(New DataColumn("MF", System.Type.GetType("System.Int32")))
        '13
        dt.Columns.Add(New DataColumn("UNION", System.Type.GetType("System.Int32")))
        '14
        dt.Columns.Add(New DataColumn("OtherDisc", System.Type.GetType("System.Int32")))
        '15
        dt.Columns.Add(New DataColumn("TotalDisc", System.Type.GetType("System.Int32")))
        '16
        dt.Columns.Add(New DataColumn("Taxable", System.Type.GetType("System.Int32")))
        '17
        dt.Columns.Add(New DataColumn("IT", System.Type.GetType("System.Double")))
        '18
        dt.Columns.Add(New DataColumn("StartDate", System.Type.GetType("System.String")))
        '19
        dt.Columns.Add(New DataColumn("LeaveDate", System.Type.GetType("System.String")))
        '20
        dt.Columns.Add(New DataColumn("Adr1", System.Type.GetType("System.String")))
        '21
        dt.Columns.Add(New DataColumn("Adr2", System.Type.GetType("System.String")))
        '22
        dt.Columns.Add(New DataColumn("Adr3", System.Type.GetType("System.String")))
        '23
        dt.Columns.Add(New DataColumn("PostCode", System.Type.GetType("System.String")))
        '24
        dt.Columns.Add(New DataColumn("PensionNo", System.Type.GetType("System.String")))
        '25
        dt.Columns.Add(New DataColumn("PensionType", System.Type.GetType("System.String")))
        '26
        dt.Columns.Add(New DataColumn("SINumber", System.Type.GetType("System.String")))
        '27
        dt.Columns.Add(New DataColumn("EmpCode", System.Type.GetType("System.String")))
        '28
        dt.Columns.Add(New DataColumn("STDeduction", System.Type.GetType("System.Double")))
        '29
        dt.Columns.Add(New DataColumn("STContribution", System.Type.GetType("System.Double")))
        '30
        dt.Columns.Add(New DataColumn("SalaryPeriods", System.Type.GetType("System.Int32")))
        '31
        dt.Columns.Add(New DataColumn("LifeInsurance", System.Type.GetType("System.Int32")))
        '32
        dt.Columns.Add(New DataColumn("AllowancesBenefits", System.Type.GetType("System.Int32")))
        '33
        dt.Columns.Add(New DataColumn("TaxableFromOther", System.Type.GetType("System.Int32")))
        '34
        dt.Columns.Add(New DataColumn("NonTaxable", System.Type.GetType("System.Int32")))
        '35
        dt.Columns.Add(New DataColumn("Syntaksiodotika", System.Type.GetType("System.Int32")))
        '36
        dt.Columns.Add(New DataColumn("MeiwsiApolavon", System.Type.GetType("System.Double")))
        '37
        dt.Columns.Add(New DataColumn("WidowAndOrphans", System.Type.GetType("System.Double")))
        '38
        dt.Columns.Add(New DataColumn("PensionFund", System.Type.GetType("System.Int32")))

        Ds.Tables.Add(dt)

        '''''''''''''''''
        Dim TempGroup As New cPrMsTemplateGroup(PerGrp.TemGrpCode)

        Str = " SELECT Emp_Code," & _
        " Emp_FullName," & _
        " Emp_Address1," & _
        " Emp_Address2," & _
        " Emp_Address3," & _
        " Emp_PostCode," & _
        " Emp_TaxID," & _
        " Emp_TerminateDate, " & _
        " Emp_StartDate," & _
        " Emp_LastName," & _
        " Emp_FirstName," & _
        " Emp_PassportNumber," & _
        " Emp_IdentificationCard," & _
        " Emp_AlienNumber," & _
        " Emp_SocialInsNumber," & _
        " TicTyp_Code," & _
        " Emp_DrivingLicense, " & _
        " Emp_PensionNo," & _
        " Emp_PensionType, " & _
        " Emp_socialinsnumber, " & _
        " Emp_OtherIncome1 " & _
         " FROM PrMsEmployees" & _
        " inner join PrMsTemplateGroup ON " & _
        " PrMsEmployees.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code " & _
        " INNER JOIN" & _
        " AdMsCompany ON " & _
        " PrMsTemplateGroup.Com_Code = AdMsCompany.Com_Code" & _
        " WHERE (AdMsCompany.Com_Code = " & enQuoteString(TempGroup.CompanyCode) & ")" & _
        " AND (emp_startdate < " & enQuoteString(SYear) & ")"
        If FromCode <> "" Or ToCode <> "" Then
            Str2 = " AND (Emp_Code >= " & enQuoteString(FromCode) & _
                 " AND Emp_Code <= " & enQuoteString(ToCode) & ")"
        End If
        Dim Str1_1 As String = ""
        If Global1.PARAM_HideEmpWithBlanksSIR Then
            str1_1 = " AND (ComSin_EmpSocialInsNo <>'')"
        End If


        Str = Str & Str2 & str1_1

        DsEmp = GetData(Str)
        If CheckDataSet(DsEmp) Then


            For i = 0 To DsEmp.Tables(0).Rows.Count - 1
                R = dt.NewRow


                Application.DoEvents()
                Dim EmpCode As String
                EmpCode = DbNullToString(DsEmp.Tables(0).Rows(i).Item(0))
              

                R(C_EmpName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(1))
                '  Debug.WriteLine(i & " " & DbNullToString(DsEmp.Tables(0).Rows(i).Item(1)))

                R(C_Adr1) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(2))
                R(C_Adr2) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(3))
                R(C_Adr3) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(4))
                R(C_PostCode) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(5))
                R(C_EmpTaxID) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(6))
                Dim T As String
                T = DbNullToString(DsEmp.Tables(0).Rows(i).Item(7))
                If T = "" Then
                    R(C_LeaveDate) = ""
                Else
                    Try
                        R(C_LeaveDate) = Format(CDate(T), "dd/MM/yyyy")

                    Catch ex As Exception
                        MsgBox("Error on Employee with Code " & EmpCode & " Leave date is invalid", MsgBoxStyle.Critical)
                        Ds.Tables.Clear()
                        Exit Function

                    End Try
                End If 'DbNullToString(DsEmp.Tables(0).Rows(i).Item(7))
                If DbNullToDate(DsEmp.Tables(0).Rows(i).Item(8)).Year = YearDate.Year() Then
                    R(C_StartDate) = Format(DbNullToDate(DsEmp.Tables(0).Rows(i).Item(8)), "dd/MM/yyyy")
                Else
                    R(C_StartDate) = " "
                End If


                R(C_EmpLastName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(9))
                R(C_EmpFirstName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(10))

                Dim IDType As String = DbNullToString(DsEmp.Tables(0).Rows(i).Item(15))
                Dim Found As Boolean = False
                If IDType = "1" Then
                    Found = True
                    R(C_EmpIDType) = " "
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(6))
                    'ElseIf IDType = "2" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(11))
                ElseIf IDType = "3" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    'R(C_EmpIDType) = ""
                    If DbNullToString(DsEmp.Tables(0).Rows(i).Item(12)) <> "" Then
                        Dim S As String
                        S = DsEmp.Tables(0).Rows(i).Item(12)
                        If S.Substring(0, 1) = "0" Then
                            S = S.Substring(1, S.Length - 1)
                            DsEmp.Tables(0).Rows(i).Item(12) = S
                        End If
                    End If
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(12))
                ElseIf IDType = "4" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(16))
                    'ElseIf IDType = "5" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(14))
                    'ElseIf IDType = "6" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(16))
                ElseIf IDType = "7" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(13))
                End If
                If Not Found Then
                    If ShowMessages Then
                        MsgBox("Employee with Code " & EmpCode & " Does not have a Valid Tax Identification Type, Valid types are 1,3,4 and 7")
                        Ds.Tables.Clear()
                        Exit Function
                    End If
                End If

                R(C_PensionNo) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(17))
                R(C_PensionType) = DbNullToInt(DsEmp.Tables(0).Rows(i).Item(18))
                R(C_SINo) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(19))
                R(C_EmpCode) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(0))
                Dim DsPerPerCom As DataSet
                Dim StrX As String
                StrX = "SELECT PrMsPeriodGroups.PrdGrp_Code " & _
                " FROM PrMsPeriodGroups INNER JOIN " & _
                " PrMsTemplateGroup ON " & _
                " PrMsPeriodGroups.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code " & _
                " INNER JOIN " & _
                " AdMsCompany ON PrMsTemplateGroup.Com_Code = AdMsCompany.Com_Code " & _
                " WHERE (PrMsTemplateGroup.Com_Code = " & enQuoteString(TempGroup.CompanyCode) & ")  " & _
                " AND (PrMsPeriodGroups.PrdGpr_Year = " & PerGrp.Year & ") "
                DsPerPerCom = GetData(StrX)

                Dim f As Integer
                Dim StrPeriodGroupCodes
                Dim StrPeriodGroupCodes2
                Dim TempPer As String
                If CheckDataSet(DsPerPerCom) Then
                    For f = 0 To DsPerPerCom.Tables(0).Rows.Count - 1
                        TempPer = DsPerPerCom.Tables(0).Rows(f).Item(0)
                        If f = 0 Then
                            StrPeriodGroupCodes = " AND ((PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                            StrPeriodGroupCodes2 = " AND ((PrTxTrxnHeader.PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                        Else
                            StrPeriodGroupCodes = StrPeriodGroupCodes & " OR (PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                            StrPeriodGroupCodes2 = StrPeriodGroupCodes2 & " OR (PrTxTrxnHeader.PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                        End If
                    Next
                    StrPeriodGroupCodes = StrPeriodGroupCodes & ")"
                    StrPeriodGroupCodes2 = StrPeriodGroupCodes2 & ")"

                End If

                Dim DsSpecialTaxDed As DataSet
                Dim DsSpecialTaxCon As DataSet
                GetSumsOfEmployeeDeductions("EX", EmpCode, PerGrp.Code)
                Dim StrSP1 As String
                Dim StrSP2 As String

                StrSP1 = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnHeader INNER JOIN" & _
                    " PrTxTrxnLines ON" & _
                    " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
                    " PrMsDeductionCodes ON" & _
                    " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN" & _
                    " PrSsDeductionTypes ON" & _
                    " PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code" & _
                    " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                    " AND (PrSsDeductionTypes.DedTyp_Code = 'EX')"

                StrSP1 = StrSP1 + StrPeriodGroupCodes2

                StrSP2 = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnHeader INNER JOIN" & _
                    " PrTxTrxnLines ON" & _
                    " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
                    " PrMsContributionCodes ON" & _
                    " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code INNER JOIN" & _
                    " PrSsContributionTypes ON" & _
                    " PrMsContributionCodes.ConTyp_Code = PrSsContributionTypes.ConTyp_Code" & _
                    " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                    " AND (PrSsContributionTypes.ConTyp_Code = 'EX')"

                StrSP2 = StrSP2 + StrPeriodGroupCodes2

                DsSpecialTaxDed = GetData(StrSP1)
                DsSpecialTaxCon = GetData(StrSP2)
                Dim SPTaxDed As Double = 0
                Dim SPTaxCon As Double = 0

                If CheckDataSet(DsSpecialTaxDed) Then
                    SPTaxDed = DbNullToDouble(DsSpecialTaxDed.Tables(0).Rows(0).Item(0))
                End If
                If CheckDataSet(DsSpecialTaxCon) Then
                    SPTaxCon = DbNullToDouble(DsSpecialTaxCon.Tables(0).Rows(0).Item(0))
                End If

                R(C_STDeduction) = SPTaxDed
                R(C_STContribution) = SPTaxCon


                Dim DsGrossEarnings As DataSet
                Dim DsTaxableEarnings As DataSet


                Str = " SELECT SUM(TrxHdr_TotalErnPeriod)" & _
                      " FROM  PrTxTrxnHeader" & _
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                Str = Str & StrPeriodGroupCodes
                DsGrossEarnings = GetData(Str)

                Str = " SELECT SUM(TrxHdr_TaxableIncome)" & _
                      " FROM  PrTxTrxnHeader" & _
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                Str = Str & StrPeriodGroupCodes
                DsTaxableEarnings = GetData(Str)

                Dim NonTaxable As Double
                NonTaxable = FindNonTaxableTotalForTemplateGroupForEmployee(TempGroup.Code, PerGrp.Code, EmpCode)

                Dim DsSILeave As DataSet
                'DsSILeave = Me.FindSILeaveTotalIR632(PerGrp.TemGrpCode, PerGrp.Code, EmpCode)
                DsSILeave = Me.FindSILeaveTotalIR63_2Groups(PerGrp.TemGrpCode, StrPeriodGroupCodes, EmpCode)
                Dim SILeaveValue As Double = 0
                If CheckDataSet(DsSILeave) Then
                    SILeaveValue = DbNullToDouble(DsSILeave.Tables(0).Rows(0).Item(0))
                    If SILeaveValue <> 0 Then
                        '   MsgBox(1)
                    End If
                End If

                Dim DsBenefitsInKind As DataSet
                DsBenefitsInKind = Me.FindBenefitsInKindTotalIR63_2Groups(PerGrp.TemGrpCode, StrPeriodGroupCodes, EmpCode)
                Dim BenefitsInKind As Double = 0
                If CheckDataSet(DsBenefitsInKind) Then
                    BenefitsInKind = DbNullToDouble(DsBenefitsInKind.Tables(0).Rows(0).Item(0))
                    If BenefitsInKind <> 0 Then
                        '   MsgBox(1)
                    End If
                End If



                LocalErn = DbNullToDouble(DsGrossEarnings.Tables(0).Rows(0).Item(0)) - NonTaxable + SILeaveValue + BenefitsInKind
              





                'LocalErn = RoundMe3(LocalErn, 0)

                R(C_Local) = LocalErn




                AbroadErn = "0.00"
                R(C_Abroad) = AbroadErn
                Allowances = RoundMe3(DbNullToDouble(DsEmp.Tables(0).Rows(i).Item(20)), 2)

                R(C_Allowances) = Allowances

                TotalErn = LocalErn + AbroadErn + Allowances
                R(C_Total456) = TotalErn



                Dim DsSI As DataSet = GetSumsOfEmployeeDeductions_IR7("SI", EmpCode, StrPeriodGroupCodes)
                SI = RoundMe3(DbNullToDouble(DsSI.Tables(0).Rows(0).Item(0)), 0)
                R(C_SI) = SI


                Dim DsPensionFund As DataSet = GetSumsOfEmployeeDeductions_IR7("PN", EmpCode, StrPeriodGroupCodes)
                Pensionfund = RoundMe3(DbNullToDouble(DsPensionFund.Tables(0).Rows(0).Item(0)), 0)
                R(C_Pensionfund) = Pensionfund

                Dim DSWidowAndOrphans As DataSet = GetSumsOfEmployeeDeductions_IR7("WO", EmpCode, StrPeriodGroupCodes)
                WidowAndOrphans = RoundMe3(DbNullToDouble(DSWidowAndOrphans.Tables(0).Rows(0).Item(0)), 0)
                R(C_WidowAndOrphans) = WidowAndOrphans


                Dim DsPF As DataSet = GetSumsOfEmployeeDeductions_IR7("PF", EmpCode, StrPeriodGroupCodes)
                PF = RoundMe3(DbNullToDouble(DsPF.Tables(0).Rows(0).Item(0)), 0)
                PF = PF + Pensionfund + WidowAndOrphans
                R(C_PF) = PF

                R(C_SyntaksiodotikaOfelimata) = Pensionfund + WidowAndOrphans

               
                Dim DsMF As DataSet = GetSumsOfEmployeeDeductions_IR7("MF", EmpCode, StrPeriodGroupCodes)
                MF = RoundMe3(DbNullToDouble(DsMF.Tables(0).Rows(0).Item(0)), 0)
                R(C_MF) = MF

                Dim DSMeiosiApolavon As DataSet = GetSumsOfEmployeeDeductions_IR7("DN", EmpCode, StrPeriodGroupCodes)
                MeiwsiApolavon = RoundMe3(DbNullToDouble(DSMeiosiApolavon.Tables(0).Rows(0).Item(0)), 0)
                R(C_MeiwsiApolavon) = MeiwsiApolavon

               

                Dim DsU2 As DataSet = GetSumsOfEmployeeDeductions_IR7("U2", EmpCode, StrPeriodGroupCodes)
                Dim DsU3 As DataSet = GetSumsOfEmployeeDeductions_IR7("U3", EmpCode, StrPeriodGroupCodes)
                Dim DsUS As DataSet = GetSumsOfEmployeeDeductions_IR7("US", EmpCode, StrPeriodGroupCodes)
                Dim U As Double = 0
                U = U + DbNullToDouble(DsU2.Tables(0).Rows(0).Item(0))
                U = U + DbNullToDouble(DsU3.Tables(0).Rows(0).Item(0))
                U = U + DbNullToDouble(DsUS.Tables(0).Rows(0).Item(0))
                Union = 0
                Union = RoundMe3(U, 2)

                R(C_UNION) = Union

                'FindEmployeeSalaryPeriods
                Dim NoOfSalary As Integer
                NoOfSalary = Global1.Business.GetNumberOfTotalPeriodsFOREmployee(EmpCode, PerGrp.Year)
                R(C_salaryPeriods) = NoOfSalary

                '
                Life_Other = 0
                OtherDisc = 0
                fe = 0

                If Global1.GLB_IR7Discounts = 0 Then
                    '------------------------------------
                    ''''''Discounts from Header''''''''''
                    '------------------------------------
                    Dim DsDiscounts As DataSet
                    Str = " Select SUM(TrxHdr_LifeInsurance), " & _
                          " SUM(TrxHdr_Discounts), " & _
                          " SUM(TrxHdr_FE) " & _
                          " FROM  PrTxTrxnHeader" & _
                          " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                    Str = Str & StrPeriodGroupCodes

                    DsDiscounts = GetData(Str)
                    LifeInsurance = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(0))
                    OtherDisc = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(1))
                    FE = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(2))
                    OtherDisc = OtherDisc + FE
                    'Life_Other = RoundMe3(LifeInsurance + OtherDisc, 2)
                    Life_Other = RoundMe3(OtherDisc, 2)
                Else
                    '------------------------------------
                    ''''''Discounts from Header''''''''''
                    '------------------------------------
                    Dim DsDiscounts
                    DsDiscounts = GetSumsOfEmployeeDiscounts_IR7(EmpCode, StrPeriodGroupCodes)
                    If CheckDataSet(DsDiscounts) Then
                        OtherDisc = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(0))
                    End If

                    Life_Other = RoundMe3(OtherDisc, 2)

                End If
                LifeIns = RoundMe3(LifeInsurance, 2)

                '''''''''''''''''''''''''''''''''''''
                '------------------------------------
                '''''''''''''''''''''''''''''''''''''
                Life_Other = Life_Other + SPTaxDed

                R(C_OtherDisc) = Life_Other


                'TotalDisc = SI + PF + MF + Union + Life_Other 
                TotalDisc = SI + PF + MF + Union + Life_Other + LifeIns + MeiwsiApolavon

                R(C_TotalDisc) = TotalDisc
                R(C_LifeInsurance) = LifeIns

                Dim Taxable As Double
                Taxable = RoundMe3(DbNullToDouble(DsTaxableEarnings.Tables(0).Rows(0).Item(0)), 0)
                'R(C_Taxable) = TotalErn - TotalDisc
                Taxable = Taxable - TotalDisc + Allowances
                ''''''''''''''''''''''''''''''''''''''''''
                'Change Action Pension
                ''''''''''''''''''''''''''''''''''''''''''
                If Taxable <> TotalErn - TotalDisc Then
                    Taxable = TotalErn - TotalDisc
                End If
                ''''''''''''''''''''''''''''''''''''''''''

                R(C_Taxable) = Taxable


                Dim DsIT As DataSet = GetSumsOfEmployeeDeductions_IR7("IT", EmpCode, StrPeriodGroupCodes)
                R(C_IT) = DbNullToDouble(DsIT.Tables(0).Rows(0).Item(0))

                Str = " SELECT count(*)" & _
                      " FROM  PrTxTrxnHeader" & _
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                Str = Str & StrPeriodGroupCodes
                Dim DsCount As DataSet
                DsCount = GetData(Str)
                If CheckDataSet(DsCount) Then
                    If DbNullToInt(DsCount.Tables(0).Rows(0).Item(0)) <> 0 Then
                        dt.Rows.Add(R)
                    End If
                End If








            Next

            Dim DsComp As DataSet
            Str = " SELECT AdMsCompany.Com_Name," & _
                " AdMsCompany.Com_TIC," & _
                " AdMsCompany.Com_Address1," & _
                " AdMsCompany.Com_Address2, " & _
                " AdMsCompany.Com_Address3," & _
                " AdMsCompany.Com_Address4," & _
                " AdMsCompany.Com_AccountantTitle," & _
                " PrMsTemplateGroup.TemGrp_Code" & _
                " FROM AdMsCompany INNER JOIN" & _
                " PrMsTemplateGroup ON " & _
                " AdMsCompany.Com_Code = PrMsTemplateGroup.Com_Code" & _
                " WHERE (PrMsTemplateGroup.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

            DsComp = GetData(Str)
            Ds.Tables.Add(DsComp.Tables(0).Copy)
            Ds.Tables(1).TableName = "CompanyDetails"

            Dim DsYear As DataSet
            Str = " SELECT PrdGpr_Year" & _
                  " FROM PrMsPeriodGroups" & _
                  " where PrdGrp_Code=" & enQuoteString(PerGrp.Code)

            DsYear = GetData(Str)
            Ds.Tables.Add(DsYear.Tables(0).Copy)
            Ds.Tables(2).TableName = "Year"

        End If


        '  LoadDataSetToExcel(Ds, "ir7")

        Return Ds
    End Function
    Protected Function REPORT_IR7_4(ByVal PerGrp As cPrMsPeriodGroups, ByVal FromCode As String, ByVal ToCode As String, ByVal YearDate As Date, ByVal ShowMessages As Boolean, ByVal ShowinExcel As Boolean, ByVal BIKonSI As Boolean, ByVal DissableRehire As Boolean) As DataSet
        Dim Ds As New DataSet
        Dim Str As String
        Dim str1_1 As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim DsEmp As DataSet
        Dim i As Integer
        Dim Error1 As String = "1 Before All"
        Dim MainError As String = ""
        Dim HasErrors As Boolean = False

        Dim R As DataRow
        Dim NoAddition As Boolean = False

        Dim ii As Integer = 0

        Dim C_EmpLastName As Integer = 0
        Dim C_EmpFirstName As Integer = 1
        Dim C_EmpName As Integer = 2
        Dim C_EmpTaxID As Integer = 3
        Dim C_EmpIDType As Integer = 4
        Dim C_EmpIDCard As Integer = 5
        Dim C_Local As Integer = 6
        Dim C_Abroad As Integer = 7
        Dim C_Allowances As Integer = 8
        Dim C_Total456 As Integer = 9
        Dim C_SI As Integer = 10
        Dim C_PF As Integer = 11
        Dim C_MF As Integer = 12
        Dim C_UNION As Integer = 13
        Dim C_OtherDisc As Integer = 14
        Dim C_TotalDisc As Integer = 15
        Dim C_Taxable As Integer = 16
        Dim C_IT As Integer = 17
        Dim C_StartDate As Integer = 18
        Dim C_LeaveDate As Integer = 19
        Dim C_Adr1 As Integer = 20
        Dim C_Adr2 As Integer = 21
        Dim C_Adr3 As Integer = 22
        Dim C_PostCode As Integer = 23
        Dim C_PensionNo As Integer = 24
        Dim C_PensionType As Integer = 25
        Dim C_SINo As Integer = 26
        Dim C_EmpCode As Integer = 27
        Dim C_STDeduction As Integer = 28
        Dim C_STContribution As Integer = 29
        Dim C_salaryPeriods As Integer = 30
        Dim C_LifeInsurance As Integer = 31

        Dim C_AllowancesBenefits As Integer = 32
        Dim C_TaxableFromOther As Integer = 33
        Dim C_NonTaxableIncome As Integer = 34

        Dim C_SyntaksiodotikaOfelimata As Integer = 35
        Dim C_MeiwsiApolavon As Integer = 36
        Dim C_WidowAndOrphans As Integer = 37
        Dim C_Pensionfund As Integer = 38

        '#2019
        Dim C_BIK_withSI As Integer = 39
        Dim C_BIK_withoutSI As Integer = 40

        'Include them in Total epr7m3t0r4c1
        'end of #2019
        Dim C_GESYtoSI As Integer = 41
        Dim C_GESYtoBIKDed As Integer = 42
        Dim C_GESYtoBIKCon As Integer = 43



        Dim C_EmpType As Integer = 44
        Dim C_Rehire As Integer = 45

        Dim C_DirectorFees As Integer = 46





        Dim LocalErn As Integer = 0
        Dim AbroadErn As Integer = 0
        Dim Allowances As Integer = 0
        Dim TotalErn As Integer = 0
        Dim SI As Integer = 0
        Dim MF As Integer = 0
        Dim UnionMF As Integer
        Dim Union As Integer = 0
        Dim PF As Integer = 0
        Dim LifeInsurance As Double = 0
        Dim OtherDisc As Double = 0
        Dim FE As Double = 0
        Dim Life_Other As Integer
        Dim LifeIns As Integer
        Dim TotalDisc As Integer = 0


        Dim MeiwsiApolavon As Double
        Dim WidowAndOrphans As Double
        Dim Pensionfund As Integer

        Dim D2 As Date
        D2 = DateAdd(DateInterval.Year, 1, YearDate)
        Dim SYear As String = Format(D2, "yyyy-MM-dd")
        SYear = Utils.ChangeDateFormatForSearch(SYear)

        ' Define Data Table
        Dim dt As New DataTable

        dt = New DataTable("Employee")
        '0
        dt.Columns.Add(New DataColumn("EmpLastName", System.Type.GetType("System.String")))
        '1
        dt.Columns.Add(New DataColumn("EmpFirstName", System.Type.GetType("System.String")))
        '2
        dt.Columns.Add(New DataColumn("EmpName", System.Type.GetType("System.String")))
        '3
        dt.Columns.Add(New DataColumn("EmpTaxID", System.Type.GetType("System.String")))
        '4
        dt.Columns.Add(New DataColumn("EmpIDType", System.Type.GetType("System.String")))
        '5
        dt.Columns.Add(New DataColumn("EmpIDCard", System.Type.GetType("System.String")))
        '6
        dt.Columns.Add(New DataColumn("Local", System.Type.GetType("System.Int32")))
        '7
        dt.Columns.Add(New DataColumn("Abroad", System.Type.GetType("System.Int32")))
        '8
        dt.Columns.Add(New DataColumn("Allowances", System.Type.GetType("System.Int32")))
        '9
        dt.Columns.Add(New DataColumn("Total456", System.Type.GetType("System.Int32")))
        '10
        dt.Columns.Add(New DataColumn("SI", System.Type.GetType("System.Int32")))
        '11
        dt.Columns.Add(New DataColumn("PF", System.Type.GetType("System.Int32")))
        '12
        dt.Columns.Add(New DataColumn("MF", System.Type.GetType("System.Int32")))
        '13
        dt.Columns.Add(New DataColumn("UNION", System.Type.GetType("System.Int32")))
        '14
        dt.Columns.Add(New DataColumn("OtherDisc", System.Type.GetType("System.Int32")))
        '15
        dt.Columns.Add(New DataColumn("TotalDisc", System.Type.GetType("System.Int32")))
        '16
        dt.Columns.Add(New DataColumn("Taxable", System.Type.GetType("System.Int32")))
        '17
        dt.Columns.Add(New DataColumn("IT", System.Type.GetType("System.Double")))
        '18
        dt.Columns.Add(New DataColumn("StartDate", System.Type.GetType("System.String")))
        '19
        dt.Columns.Add(New DataColumn("LeaveDate", System.Type.GetType("System.String")))
        '20
        dt.Columns.Add(New DataColumn("Adr1", System.Type.GetType("System.String")))
        '21
        dt.Columns.Add(New DataColumn("Adr2", System.Type.GetType("System.String")))
        '22
        dt.Columns.Add(New DataColumn("Adr3", System.Type.GetType("System.String")))
        '23
        dt.Columns.Add(New DataColumn("PostCode", System.Type.GetType("System.String")))
        '24
        dt.Columns.Add(New DataColumn("PensionNo", System.Type.GetType("System.String")))
        '25
        dt.Columns.Add(New DataColumn("PensionType", System.Type.GetType("System.String")))
        '26
        dt.Columns.Add(New DataColumn("SINumber", System.Type.GetType("System.String")))
        '27
        dt.Columns.Add(New DataColumn("EmpCode", System.Type.GetType("System.String")))
        '28
        dt.Columns.Add(New DataColumn("STDeduction", System.Type.GetType("System.Double")))
        '29
        dt.Columns.Add(New DataColumn("STContribution", System.Type.GetType("System.Double")))
        '30
        dt.Columns.Add(New DataColumn("SalaryPeriods", System.Type.GetType("System.Int32")))
        '31
        dt.Columns.Add(New DataColumn("LifeInsurance", System.Type.GetType("System.Int32")))
        '32
        dt.Columns.Add(New DataColumn("AllowancesBenefits", System.Type.GetType("System.Int32")))
        '33
        dt.Columns.Add(New DataColumn("TaxableFromOther", System.Type.GetType("System.Int32")))
        '34
        dt.Columns.Add(New DataColumn("NonTaxable", System.Type.GetType("System.Int32")))
        '35
        dt.Columns.Add(New DataColumn("Syntaksiodotika", System.Type.GetType("System.Int32")))
        '36
        dt.Columns.Add(New DataColumn("MeiwsiApolavon", System.Type.GetType("System.Double")))
        '37
        dt.Columns.Add(New DataColumn("WidowAndOrphans", System.Type.GetType("System.Double")))
        '38
        dt.Columns.Add(New DataColumn("PensionFund", System.Type.GetType("System.Int32")))

        '#2019
        '39
        dt.Columns.Add(New DataColumn("BIKwithGESY", System.Type.GetType("System.Int32")))
        '40
        dt.Columns.Add(New DataColumn("BIKWithoutGESY", System.Type.GetType("System.Int32")))
        '41
        dt.Columns.Add(New DataColumn("GESYToSI", System.Type.GetType("System.Double")))
        '42
        dt.Columns.Add(New DataColumn("GESYtoBIKDed", System.Type.GetType("System.Double")))
        '43
        dt.Columns.Add(New DataColumn("GESYtoBIKCon", System.Type.GetType("System.Double")))
        '44
        dt.Columns.Add(New DataColumn("EmpType", System.Type.GetType("System.String")))
        '45
        dt.Columns.Add(New DataColumn("Rehire", System.Type.GetType("System.String")))
        '46
        dt.Columns.Add(New DataColumn("DirectorFees", System.Type.GetType("System.Double")))



        Ds.Tables.Add(dt)

        '''''''''''''''''
        Dim TempGroup As New cPrMsTemplateGroup(PerGrp.TemGrpCode)

        Str = " SELECT Emp_Code," & _
        " Emp_FullName," & _
        " Emp_Address1," & _
        " Emp_Address2," & _
        " Emp_Address3," & _
        " Emp_PostCode," & _
        " Emp_TaxID," & _
        " Emp_TerminateDate, " & _
        " Emp_StartDate," & _
        " Emp_LastName," & _
        " Emp_FirstName," & _
        " Emp_PassportNumber," & _
        " Emp_IdentificationCard," & _
        " Emp_AlienNumber," & _
        " Emp_SocialInsNumber," & _
        " TicTyp_Code," & _
        " Emp_DrivingLicense, " & _
        " Emp_PensionNo," & _
        " Emp_PensionType, " & _
        " Emp_socialinsnumber, " & _
        " Emp_OtherIncome1, " & _
        " Emp_LWBPen, " & _
        " Emp_Rehire, " & _
        " Emp_IsDirector " & _
        " FROM PrMsEmployees " & _
        " WHERE Emp_Code in " & _
        " (SELECT Emp_Code FROM PrTxTrxnHeader WHERE " & _
        " (PrTxTrxnHeader.Com_Code = " & enQuoteString(TempGroup.CompanyCode) & " ) " & _
        " AND (PrTxTrxnHeader.TrxHdr_Year = " & enQuoteString(PerGrp.Year) & "))"

        If Global1.PARAM_HideEmpWithBlanksSIR Then
            str1_1 = " AND (ComSin_EmpSocialInsNo <>'')"
        End If


        If FromCode <> "" Or ToCode <> "" Then
            Str2 = " AND (Emp_Code >= " & enQuoteString(FromCode) & _
                 " AND Emp_Code <= " & enQuoteString(ToCode) & ")"
        End If

        Str3 = " Order by Emp_Rehire Asc"
        If DissableRehire Then
            Str3 = " Order by Emp_Code Asc"
        End If
        Str = Str & str1_1 & Str2 & Str3
        Error1 = "2 Before Query"
        DsEmp = GetData(Str)
        Error1 = "3 After Query"
        If CheckDataSet(DsEmp) Then


            For i = 0 To DsEmp.Tables(0).Rows.Count - 1
                Dim k As Integer
                ' sss()
                'For k = 0 To dt.Rows.Count - 1


                'Next

                R = dt.NewRow
                Dim Rehire As String
                Rehire = DbNullToString(DsEmp.Tables(0).Rows(i).Item(22))
                If Rehire <> "" Then
                    NoAddition = True
                End If


                Application.DoEvents()
                Dim EmpCode As String
                EmpCode = DbNullToString(DsEmp.Tables(0).Rows(i).Item(0))


                R(C_EmpName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(1))
                '  Debug.WriteLine(i & " " & DbNullToString(DsEmp.Tables(0).Rows(i).Item(1)))
                Dim Adr1 As String = DbNullToString(DsEmp.Tables(0).Rows(i).Item(2))
                Dim Adr2 As String = DbNullToString(DsEmp.Tables(0).Rows(i).Item(3))
                Dim Adr3 As String = DbNullToString(DsEmp.Tables(0).Rows(i).Item(4))

                Adr1 = Adr1.Replace("!", "")
                Adr1 = Adr1.Replace("&", "")
                Adr1 = Adr1.Replace("$", "")
                Adr1 = Adr1.Replace("@", "")
                Adr1 = Adr1.Replace("/", "")
                Adr1 = Adr1.Replace(",", "")
                Adr1 = Adr1.Replace("-", "")
                Adr1 = Adr1.Replace(".", "")

                Adr2 = Adr2.Replace("!", "")
                Adr2 = Adr2.Replace("&", "")
                Adr2 = Adr2.Replace("$", "")
                Adr2 = Adr2.Replace("@", "")
                Adr2 = Adr2.Replace("/", "")
                Adr2 = Adr2.Replace(",", "")
                Adr2 = Adr2.Replace("-", "")
                Adr2 = Adr2.Replace(".", "")

                Adr3 = Adr3.Replace("!", "")
                Adr3 = Adr3.Replace("&", "")
                Adr3 = Adr3.Replace("$", "")
                Adr3 = Adr3.Replace("@", "")
                Adr3 = Adr3.Replace("/", "")
                Adr3 = Adr3.Replace(",", "")
                Adr3 = Adr3.Replace("-", "")
                Adr3 = Adr3.Replace(".", "")


                R(C_Adr1) = Adr1
                R(C_Adr2) = Adr2
                R(C_Adr3) = Adr3
                R(C_PostCode) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(5))
                R(C_EmpTaxID) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(6))
                R(C_Rehire) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(22))

                If Adr1 = "" Then
                    If ShowMessages Then
                        HasErrors = True
                        'MsgBox("Employee with Code " & EmpCode & " has a Tax Identification Type of " & IDType & " with an empty Value,Please correct", MsgBoxStyle.Critical)
                        MainError = MainError & Chr(10) & "Employee with Code " & EmpCode & " has no Address Line 1"
                        'Ds.Tables.Clear()
                        'Exit Function
                    End If
                End If

                If DbNullToString(DsEmp.Tables(0).Rows(i).Item(3)) = "" Then
                    If ShowMessages Then
                        HasErrors = True
                        'MsgBox("Employee with Code " & EmpCode & " has a Tax Identification Type of " & IDType & " with an empty Value,Please correct", MsgBoxStyle.Critical)
                        MainError = MainError & Chr(10) & "Employee with Code " & EmpCode & " has no CITY"
                        'Ds.Tables.Clear()
                        'Exit Function
                    End If
                End If

                If DbNullToString(DsEmp.Tables(0).Rows(i).Item(5)) = "" Then
                    If ShowMessages Then
                        HasErrors = True
                        'MsgBox("Employee with Code " & EmpCode & " has a Tax Identification Type of " & IDType & " with an empty Value,Please correct", MsgBoxStyle.Critical)
                        MainError = MainError & Chr(10) & "Employee with Code " & EmpCode & " has no POST CODE"
                        'Ds.Tables.Clear()
                        'Exit Function
                    End If
                End If
                If DbNullToString(DsEmp.Tables(0).Rows(i).Item(14)) = "" Then
                    If ShowMessages Then
                        HasErrors = True
                        'MsgBox("Employee with Code " & EmpCode & " has a Tax Identification Type of " & IDType & " with an empty Value,Please correct", MsgBoxStyle.Critical)
                        MainError = MainError & Chr(10) & "Employee with Code " & EmpCode & " has no Social Insurance Number"
                        'Ds.Tables.Clear()
                        'Exit Function
                    End If
                End If





                Dim T As String
                T = DbNullToString(DsEmp.Tables(0).Rows(i).Item(7))
                If T = "" Then
                    R(C_LeaveDate) = ""
                Else
                    Try
                        R(C_LeaveDate) = Format(CDate(T), "dd/MM/yyyy")

                    Catch ex As Exception
                        MsgBox("Error on Employee with Code " & EmpCode & " Leave date is invalid", MsgBoxStyle.Critical)
                        Ds.Tables.Clear()
                        Exit Function

                    End Try
                End If 'DbNullToString(DsEmp.Tables(0).Rows(i).Item(7))
                If DbNullToDate(DsEmp.Tables(0).Rows(i).Item(8)).Year = YearDate.Year() Then
                    R(C_StartDate) = Format(DbNullToDate(DsEmp.Tables(0).Rows(i).Item(8)), "dd/MM/yyyy")
                Else
                    R(C_StartDate) = " "
                End If


                R(C_EmpLastName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(9))
                R(C_EmpFirstName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(10))

                Dim IDType As String = DbNullToString(DsEmp.Tables(0).Rows(i).Item(15))
                Dim Found As Boolean = False
                Dim IDValue As String = ""
                If IDType = "1" Then
                    Found = True
                    R(C_EmpIDType) = " "
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(6))
                    IDValue = DbNullToString(DsEmp.Tables(0).Rows(i).Item(6))
                    'ElseIf IDType = "2" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(11))
                ElseIf IDType = "3" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    'R(C_EmpIDType) = ""
                    If DbNullToString(DsEmp.Tables(0).Rows(i).Item(12)) <> "" Then
                        Dim S As String
                        S = DsEmp.Tables(0).Rows(i).Item(12)
                        If S.Substring(0, 1) = "0" Then
                            S = S.Substring(1, S.Length - 1)
                            DsEmp.Tables(0).Rows(i).Item(12) = S
                        End If
                    End If
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(12))
                    IDValue = DbNullToString(DsEmp.Tables(0).Rows(i).Item(12))
                ElseIf IDType = "4" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(16))
                    IDValue = DbNullToString(DsEmp.Tables(0).Rows(i).Item(16))
                    'ElseIf IDType = "5" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(14))
                    'ElseIf IDType = "6" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(16))
                ElseIf IDType = "7" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(13))
                    IDValue = DbNullToString(DsEmp.Tables(0).Rows(i).Item(13))
                End If
                If Found And IDValue = "" Then
                    If ShowMessages Then
                        HasErrors = True
                        'MsgBox("Employee with Code " & EmpCode & " has a Tax Identification Type of " & IDType & " with an empty Value,Please correct", MsgBoxStyle.Critical)
                        MainError = MainError & Chr(10) & "Employee with Code " & EmpCode & " has a Tax Identification Type of " & IDType & " with an empty Value"
                        'Ds.Tables.Clear()
                        'Exit Function
                    End If
                End If
                If Not Found Then
                    If ShowMessages Then
                        HasErrors = True
                        'MsgBox("Employee with Code " & EmpCode & " Does not have a Valid Tax Identification Type, Valid types are 1,3,4 and 7", MsgBoxStyle.Critical)
                        MainError = MainError & Chr(10) & "Employee with Code " & EmpCode & " Does not have a Valid Tax Identification Type, Valid types are 1,3,4 and 7"
                        'Ds.Tables.Clear()
                        'Exit Function
                    End If
                End If

                R(C_PensionNo) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(17))
                R(C_PensionType) = DbNullToInt(DsEmp.Tables(0).Rows(i).Item(18))
                R(C_SINo) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(19))
                R(C_EmpCode) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(0))
                Dim EmpType As String = "1"
                If DbNullToString(DsEmp.Tables(0).Rows(i).Item(21)) = "1" Then
                    EmpType = "2"
                End If
                If DbNullToString(DsEmp.Tables(0).Rows(i).Item(23)) = "1" Then
                    EmpType = "3"
                End If
                R(C_EmpType) = EmpType

                Dim DsPerPerCom As DataSet
                Dim StrX As String
                StrX = "SELECT PrMsPeriodGroups.PrdGrp_Code " & _
                " FROM PrMsPeriodGroups INNER JOIN " & _
                " PrMsTemplateGroup ON " & _
                " PrMsPeriodGroups.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code " & _
                " INNER JOIN " & _
                " AdMsCompany ON PrMsTemplateGroup.Com_Code = AdMsCompany.Com_Code " & _
                " WHERE (PrMsTemplateGroup.Com_Code = " & enQuoteString(TempGroup.CompanyCode) & ")  " & _
                " AND (PrMsPeriodGroups.PrdGpr_Year = " & PerGrp.Year & ") "
                DsPerPerCom = GetData(StrX)

                Dim f As Integer
                Dim StrPeriodGroupCodes
                Dim StrPeriodGroupCodes2
                Dim TempPer As String
                Error1 = "3 Before second Query"
                If CheckDataSet(DsPerPerCom) Then
                    For f = 0 To DsPerPerCom.Tables(0).Rows.Count - 1
                        TempPer = DsPerPerCom.Tables(0).Rows(f).Item(0)
                        If f = 0 Then
                            StrPeriodGroupCodes = " AND ((PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                            StrPeriodGroupCodes2 = " AND ((PrTxTrxnHeader.PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                        Else
                            StrPeriodGroupCodes = StrPeriodGroupCodes & " OR (PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                            StrPeriodGroupCodes2 = StrPeriodGroupCodes2 & " OR (PrTxTrxnHeader.PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                        End If
                    Next
                    StrPeriodGroupCodes = StrPeriodGroupCodes & ")"
                    StrPeriodGroupCodes2 = StrPeriodGroupCodes2 & ")"

                End If
                Error1 = "4 After second Query"
                Dim DsSpecialTaxDed As DataSet
                Dim DsSpecialTaxCon As DataSet
                GetSumsOfEmployeeDeductions("EX", EmpCode, PerGrp.Code)
                Dim StrSP1 As String
                Dim StrSP2 As String

                StrSP1 = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnHeader INNER JOIN" & _
                    " PrTxTrxnLines ON" & _
                    " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
                    " PrMsDeductionCodes ON" & _
                    " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN" & _
                    " PrSsDeductionTypes ON" & _
                    " PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code" & _
                    " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                    " AND (PrSsDeductionTypes.DedTyp_Code = 'EX')"

                StrSP1 = StrSP1 + StrPeriodGroupCodes2

                StrSP2 = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnHeader INNER JOIN" & _
                    " PrTxTrxnLines ON" & _
                    " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
                    " PrMsContributionCodes ON" & _
                    " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code INNER JOIN" & _
                    " PrSsContributionTypes ON" & _
                    " PrMsContributionCodes.ConTyp_Code = PrSsContributionTypes.ConTyp_Code" & _
                    " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                    " AND (PrSsContributionTypes.ConTyp_Code = 'EX')"

                StrSP2 = StrSP2 + StrPeriodGroupCodes2

                DsSpecialTaxDed = GetData(StrSP1)
                DsSpecialTaxCon = GetData(StrSP2)
                Dim SPTaxDed As Double = 0
                Dim SPTaxCon As Double = 0

                If CheckDataSet(DsSpecialTaxDed) Then
                    SPTaxDed = DbNullToDouble(DsSpecialTaxDed.Tables(0).Rows(0).Item(0))
                End If
                If CheckDataSet(DsSpecialTaxCon) Then
                    SPTaxCon = DbNullToDouble(DsSpecialTaxCon.Tables(0).Rows(0).Item(0))
                End If

                R(C_STDeduction) = SPTaxDed
                R(C_STContribution) = SPTaxCon


                Dim DsGrossEarnings As DataSet
                Dim DsTaxableEarnings As DataSet


                Str = " SELECT SUM(TrxHdr_TotalErnPeriod)" & _
                      " FROM  PrTxTrxnHeader" & _
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                Str = Str & StrPeriodGroupCodes
                DsGrossEarnings = GetData(Str)

                Str = " SELECT SUM(TrxHdr_TaxableIncome)" & _
                      " FROM  PrTxTrxnHeader" & _
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                Str = Str & StrPeriodGroupCodes
                DsTaxableEarnings = GetData(Str)

                Dim NonTaxable As Double
                Dim dsTempAndPer As DataSet
                Dim EmpTempGroup As String = TempGroup.Code
                Dim EmpPerGroup As String = PerGrp.Code
                dsTempAndPer = GetTemplateGroupAndPeriodGroupOfEmployee(EmpCode, PerGrp.Year)
                If CheckDataSet(dsTempAndPer) Then
                    EmpTempGroup = DbNullToString(dsTempAndPer.Tables(0).Rows(0).Item(0))
                    EmpPerGroup = DbNullToString(dsTempAndPer.Tables(0).Rows(0).Item(1))
                End If
                NonTaxable = FindNonTaxableTotalForTemplateGroupForEmployee(EmpTempGroup, EmpPerGroup, EmpCode)

                Dim DsSILeave As DataSet
                'DsSILeave = Me.FindSILeaveTotalIR632(PerGrp.TemGrpCode, PerGrp.Code, EmpCode)
                DsSILeave = Me.FindSILeaveTotalIR63_2Groups(PerGrp.TemGrpCode, StrPeriodGroupCodes, EmpCode)
                Dim SILeaveValue As Double = 0
                If CheckDataSet(DsSILeave) Then
                    SILeaveValue = DbNullToDouble(DsSILeave.Tables(0).Rows(0).Item(0))
                    If SILeaveValue <> 0 Then
                        '   MsgBox(1)
                    End If
                End If

                Dim DsBenefitsInKind As DataSet
                DsBenefitsInKind = Me.FindBenefitsInKindTotalIR63_2Groups(PerGrp.TemGrpCode, StrPeriodGroupCodes, EmpCode)
                Dim BenefitsInKind As Double = 0
                If CheckDataSet(DsBenefitsInKind) Then
                    BenefitsInKind = DbNullToDouble(DsBenefitsInKind.Tables(0).Rows(0).Item(0))
                End If

                Dim DsDirFees As DataSet
                DsDirFees = Me.FindDirFeesTotalIR63_2Groups(PerGrp.TemGrpCode, StrPeriodGroupCodes, EmpCode)
                Dim DirFees As Double = 0
                If CheckDataSet(DsDirFees) Then
                    DirFees = DbNullToDouble(DsDirFees.Tables(0).Rows(0).Item(0))
                End If

                Dim DsOtherCon As DataSet
                Dim OtherContributions As Double = 0
                If Global1.PARAM_AddOtherContributionsOnIR7Gross Then
                    DsOtherCon = Global1.Business.REPORT_IR7_OtherContributions_CONTRIBUTION(EmpCode, StrPeriodGroupCodes)
                    If CheckDataSet(DsOtherCon) Then
                        OtherContributions = DbNullToDouble(DsOtherCon.Tables(0).Rows(0).Item(0))
                    End If
                End If



                LocalErn = DbNullToDouble(DsGrossEarnings.Tables(0).Rows(0).Item(0)) - NonTaxable + SILeaveValue + BenefitsInKind
                LocalErn = LocalErn + OtherContributions






                'LocalErn = RoundMe3(LocalErn, 0)

                R(C_Local) = LocalErn




                AbroadErn = "0.00"
                R(C_Abroad) = AbroadErn
                Allowances = RoundMe3(DbNullToDouble(DsEmp.Tables(0).Rows(i).Item(20)), 2)

                R(C_Allowances) = Allowances

                TotalErn = LocalErn + AbroadErn + Allowances
                R(C_Total456) = TotalErn



                Dim DsSI As DataSet = GetSumsOfEmployeeDeductions_IR7("SI", EmpCode, StrPeriodGroupCodes)
                SI = RoundMe3(DbNullToDouble(DsSI.Tables(0).Rows(0).Item(0)), 0)
                R(C_SI) = SI


                Dim DsPensionFund As DataSet = GetSumsOfEmployeeDeductions_IR7("PN", EmpCode, StrPeriodGroupCodes)
                Pensionfund = RoundMe3(DbNullToDouble(DsPensionFund.Tables(0).Rows(0).Item(0)), 0)
                R(C_Pensionfund) = Pensionfund

                Dim DSWidowAndOrphans As DataSet = GetSumsOfEmployeeDeductions_IR7("WO", EmpCode, StrPeriodGroupCodes)
                WidowAndOrphans = RoundMe3(DbNullToDouble(DSWidowAndOrphans.Tables(0).Rows(0).Item(0)), 0)
                R(C_WidowAndOrphans) = WidowAndOrphans


                Dim DsPF As DataSet = GetSumsOfEmployeeDeductions_IR7("PF", EmpCode, StrPeriodGroupCodes)
                PF = RoundMe3(DbNullToDouble(DsPF.Tables(0).Rows(0).Item(0)), 0)
                PF = PF + Pensionfund + WidowAndOrphans
                R(C_PF) = PF

                R(C_SyntaksiodotikaOfelimata) = Pensionfund + WidowAndOrphans


                Dim DsMF As DataSet = GetSumsOfEmployeeDeductions_IR7("MF", EmpCode, StrPeriodGroupCodes)
                MF = RoundMe3(DbNullToDouble(DsMF.Tables(0).Rows(0).Item(0)), 0)
                Dim MF2 As Double = 0
                Dim MFLimit As Double = 0
                Dim DsUnionMF As DataSet = GetSumsOfEmployeeDeductions_IR7("UM", EmpCode, StrPeriodGroupCodes)
                UnionMF = RoundMe3(DbNullToDouble(DsUnionMF.Tables(0).Rows(0).Item(0)), 0)
                MF = MF + UnionMF

                Dim DsMF2 As DataSet = GetEmployeeMF_For_IR7(EmpCode, StrPeriodGroupCodes)
                If CheckDataSet(DsMF2) Then
                    MF2 = DbNullToDouble(DsMF2.Tables(0).Rows(0).Item(0))
                    MFLimit = DbNullToDouble(DsMF2.Tables(0).Rows(0).Item(1))
                End If
                MF = MF + MF2
                If MFLimit <> 0 Then
                    If MF > MFLimit Then
                        MF = MFLimit
                    End If
                End If

                R(C_MF) = MF

                '2022 MEIWSI round to 2 Decimals
                Dim DSMeiosiApolavon As DataSet = GetSumsOfEmployeeDeductions_IR7("DN", EmpCode, StrPeriodGroupCodes)
                MeiwsiApolavon = RoundMe3(DbNullToDouble(DSMeiosiApolavon.Tables(0).Rows(0).Item(0)), 2)
                R(C_MeiwsiApolavon) = MeiwsiApolavon



                Dim DsU2 As DataSet = GetSumsOfEmployeeDeductions_IR7("U2", EmpCode, StrPeriodGroupCodes)
                Dim DsU3 As DataSet = GetSumsOfEmployeeDeductions_IR7("U3", EmpCode, StrPeriodGroupCodes)
                Dim DsUS As DataSet = GetSumsOfEmployeeDeductions_IR7("US", EmpCode, StrPeriodGroupCodes)
                Dim U As Double = 0
                U = U + DbNullToDouble(DsU2.Tables(0).Rows(0).Item(0))
                U = U + DbNullToDouble(DsU3.Tables(0).Rows(0).Item(0))
                U = U + DbNullToDouble(DsUS.Tables(0).Rows(0).Item(0))
                Union = 0
                Union = RoundMe3(U, 2)

                R(C_UNION) = Union

                'FindEmployeeSalaryPeriods
                Dim NoOfSalary As Integer
                NoOfSalary = Global1.Business.GetNumberOfTotalPeriodsFOREmployee(EmpCode, PerGrp.Year)
                R(C_salaryPeriods) = NoOfSalary

                '
                Life_Other = 0
                OtherDisc = 0
                FE = 0

                If Global1.GLB_IR7Discounts = 0 Then
                    '------------------------------------
                    ''''''Discounts from Header''''''''''
                    '------------------------------------
                    Dim DsDiscounts As DataSet
                    Str = " Select SUM(TrxHdr_LifeInsurance), " & _
                          " SUM(TrxHdr_Discounts), " & _
                          " SUM(TrxHdr_FE) " & _
                          " FROM  PrTxTrxnHeader" & _
                          " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                    Str = Str & StrPeriodGroupCodes

                    DsDiscounts = GetData(Str)
                    LifeInsurance = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(0))
                    OtherDisc = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(1))
                    FE = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(2))
                    OtherDisc = OtherDisc + FE
                    'Life_Other = RoundMe3(LifeInsurance + OtherDisc, 2)
                    Life_Other = RoundMe3(OtherDisc, 2)
                Else
                    '------------------------------------
                    ''''''Discounts from Header''''''''''
                    '------------------------------------
                    Dim DsDiscounts
                    DsDiscounts = GetSumsOfEmployeeDiscounts_IR7(EmpCode, StrPeriodGroupCodes)
                    If CheckDataSet(DsDiscounts) Then
                        OtherDisc = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(0))
                    End If

                    Life_Other = RoundMe3(OtherDisc, 2)

                End If
                LifeIns = RoundMe3(LifeInsurance, 2)

                '''''''''''''''''''''''''''''''''''''
                '------------------------------------
                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                'GESY and GESY on BIK
                Dim GesyToSIValue As Double = 0
                Dim GesyToBIKDed As Double = 0
                Dim GesyToBIKCon As Double = 0



                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                '''''''' COPY OF IR61 Code for 701 - 711
                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                Dim DsG71 As DataSet
                Dim D71 As Double = 0
                '711
                DsG71 = Global1.Business.REPORT_IR7_Gesy_DEDUCTION(EmpCode, StrPeriodGroupCodes)
                If CheckDataSet(DsG71) Then
                    D71 = DbNullToDouble(DsG71.Tables(0).Rows(0).Item(0))
                End If

                Dim DsG72 As DataSet
                Dim C72 As Double = 0

                DsG72 = Global1.Business.REPORT_IR7_Gesy_CONTRIBUTION(EmpCode, StrPeriodGroupCodes)
                If CheckDataSet(DsG72) Then
                    C72 = DbNullToDouble(DsG72.Tables(0).Rows(0).Item(0))
                End If

                Dim DsG73 As DataSet

                DsG73 = Global1.Business.REPORT_IR7_Gesy_CONTRIBUTION_LWBPen(EmpCode, StrPeriodGroupCodes)
                If CheckDataSet(DsG73) Then
                    C72 = C72 + DbNullToDouble(DsG73.Tables(0).Rows(0).Item(0))
                    'D71 = D71 + DbNullToDouble(DsG73.Tables(0).Rows(0).Item(0))
                End If

                Dim DsG74 As DataSet
                DsG74 = Global1.Business.REPORT_IR7_Gesy_CONTRIBUTION_Directors(EmpCode, StrPeriodGroupCodes)
                If CheckDataSet(DsG74) Then
                    D71 = D71 + DbNullToDouble(DsG74.Tables(0).Rows(0).Item(0))
                End If

                Dim DsG75 As DataSet
                DsG75 = Global1.Business.REPORT_IR7_Gesy_DEDUCTION_Directors(EmpCode, StrPeriodGroupCodes)
                If CheckDataSet(DsG75) Then
                    C72 = C72 + DbNullToDouble(DsG75.Tables(0).Rows(0).Item(0))
                End If



                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''






                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                '                          IR7 GESY HANDLING
                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''



                Dim DsGESY As DataSet = GetSumsOfEmployeeDeductionsPerString("GD", EmpCode, StrPeriodGroupCodes)
                If CheckDataSet(DsGESY) Then
                    If EmpType <> "2" Then
                        GesyToSIValue = DbNullToDouble(DsGESY.Tables(0).Rows(0).Item(0))
                    End If
                End If
                ' *******************************************************************************************************************************
                ' Commented out and replaced with above see COPY OF IR61 Code for 701 - 711
                ' *******************************************************************************************************************************
                'Dim DsBIKGESY As DataSet = GetSumsOfEmployeeDeductionsPerString("GT", EmpCode, StrPeriodGroupCodes)
                'If CheckDataSet(DsBIKGESY) Then
                '    GesyToBIKDed = DbNullToDouble(DsBIKGESY.Tables(0).Rows(0).Item(0))
                'End If

                'Dim DsBIKGESYC As DataSet = GetSumsOfEmployeeContributionsPerString("BC", EmpCode, StrPeriodGroupCodes)
                'If CheckDataSet(DsBIKGESYC) Then
                '    GesyToBIKCon = DbNullToDouble(DsBIKGESYC.Tables(0).Rows(0).Item(0))
                'End If
                ' *******************************************************************************************************************************
                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                GesyToBIKDed = D71
                GesyToBIKCon = C72





                If BIKonSI Then
                    If GesyToBIKDed <> 0 Then
                        If IDType <> "1" Then
                            GesyToSIValue = GesyToSIValue + GesyToBIKDed + GesyToBIKCon
                            GesyToBIKCon = 0
                            GesyToBIKDed = 0
                            'Change Termination date 31/12/of year when BIK
                            ' If R(C_LeaveDate) = "" Then
                            'R(C_LeaveDate) = "31/12/" & PerGrp.Year
                            'End If
                        End If
                    End If
                End If


        R(C_GESYtoSI) = GesyToSIValue
        R(C_GESYtoBIKDed) = GesyToBIKDed
        R(C_GESYtoBIKCon) = GesyToBIKCon
        ''''''''''''''''''''''''''''''''''''''''''''''
        Life_Other = Life_Other + SPTaxDed
        '*Change 15/12/2020 for Lamber
        'Life_Other = Life_Other + GesyToSIValue + GesyToBIKCon
        Life_Other = Life_Other + GesyToSIValue + GesyToBIKDed

        R(C_OtherDisc) = Life_Other


        'TotalDisc = SI + PF + MF + Union + Life_Other 
        'addition round me up

        TotalDisc = SI + PF + MF + Union + Life_Other + LifeIns + RoundMe3(MeiwsiApolavon, 0)

        R(C_TotalDisc) = TotalDisc
        R(C_LifeInsurance) = LifeIns

        Dim Taxable As Double
        Taxable = RoundMe3(DbNullToDouble(DsTaxableEarnings.Tables(0).Rows(0).Item(0)), 0)
        'R(C_Taxable) = TotalErn - TotalDisc
        If Taxable > 0 Then
            Taxable = Taxable - TotalDisc + Allowances
        End If
        ''''''''''''''''''''''''''''''''''''''''''
        'Change Action Pension
        ''''''''''''''''''''''''''''''''''''''''''
        ' If Taxable > 0 Then
        If Taxable <> TotalErn - TotalDisc Then
            Taxable = TotalErn - TotalDisc
        End If
        'End If
        ''''''''''''''''''''''''''''''''''''''''''

        R(C_Taxable) = Taxable


        Dim DsIT As DataSet = GetSumsOfEmployeeDeductions_IR7("IT", EmpCode, StrPeriodGroupCodes)
        R(C_IT) = DbNullToDouble(DsIT.Tables(0).Rows(0).Item(0))



        R(C_BIK_withSI) = 0
        R(C_BIK_withoutSI) = BenefitsInKind
        R(C_DirectorFees) = DirFees





        Str = " SELECT count(*)" & _
              " FROM  PrTxTrxnHeader" & _
              " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
        Str = Str & StrPeriodGroupCodes
        Dim DsCount As DataSet
        DsCount = GetData(Str)
        If CheckDataSet(DsCount) Then
            If DbNullToInt(DsCount.Tables(0).Rows(0).Item(0)) <> 0 Then
                If Not NoAddition Then
                    dt.Rows.Add(R)
                Else
                    If DissableRehire Then
                        dt.Rows.Add(R)
                    Else
                        AddPreviousHireOnRow(Ds, R, Rehire)
                    End If
                End If
            End If
        Else
            MsgBox("Employee with Code " & EmpCode & " will not be added in IR7, zero values for this year")
        End If


            Next

            Dim DsComp As DataSet
            Str = " SELECT AdMsCompany.Com_Name," & _
                " AdMsCompany.Com_TIC," & _
                " AdMsCompany.Com_Address1," & _
                " AdMsCompany.Com_Address2, " & _
                " AdMsCompany.Com_Address3," & _
                " AdMsCompany.Com_Address4," & _
                " AdMsCompany.Com_AccountantTitle," & _
                " PrMsTemplateGroup.TemGrp_Code" & _
                " FROM AdMsCompany INNER JOIN" & _
                " PrMsTemplateGroup ON " & _
                " AdMsCompany.Com_Code = PrMsTemplateGroup.Com_Code" & _
                " WHERE (PrMsTemplateGroup.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

            DsComp = GetData(Str)
            Ds.Tables.Add(DsComp.Tables(0).Copy)
            Ds.Tables(1).TableName = "CompanyDetails"

            Dim DsYear As DataSet
            Str = " SELECT PrdGpr_Year" & _
                  " FROM PrMsPeriodGroups" & _
                  " where PrdGrp_Code=" & enQuoteString(PerGrp.Code)

            DsYear = GetData(Str)
            Ds.Tables.Add(DsYear.Tables(0).Copy)
            Ds.Tables(2).TableName = "Year"

        End If


        If HasErrors Then
            Ds.Tables.Clear()
            My.Computer.Clipboard.SetText(MainError)
            MainError = "Errors Found ! " & Chr(10) & MainError
            MsgBox(MainError, MsgBoxStyle.Critical)
            MsgBox("Errors are copied to clipboard", MsgBoxStyle.Critical)

        End If


        'If ShowinExcel Then
        ' LoadDataSetToExcel(Ds, "ir7")
        ' End If

        Return Ds
    End Function
    Private Function GetTemplateGroupAndPeriodGroupOfEmployee(ByVal EmpCode As String, ByVal Year As String) As DataSet
        Dim Str As String
        Str = " SELECT PrMsEmployees.TemGrp_Code, " &
        " PrMsPeriodGroups.PrdGrp_Code," &
        " PrMsPeriodGroups.PrdGpr_Year" &
        " FROM PrMsEmployees INNER JOIN" &
        " PrMsPeriodGroups ON PrMsEmployees.TemGrp_Code = PrMsPeriodGroups.TemGrp_Code" &
        " WHERE (PrMsEmployees.Emp_Code = " & enQuoteString(EmpCode) & ")" &
        " AND (PrMsPeriodGroups.PrdGpr_Year = " & enQuoteString(Year) & ")"

        Return GetData(Str)

    End Function
    Protected Function FindProvFundCodeFromDedValueConValue(DedValue As Double, ConValue As Double) As String

        Dim Str As String
        Dim Code As String = ""
        Str = "Select ProFnd_Code from PrSsProvidentFund " &
            " where ProFnd_DedValue =" & DedValue &
            " and ProFnd_ConValue =" & ConValue
        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Code = DbNullToString(ds.Tables(0).Rows(0).Item(0))
        End If
        Return Code
    End Function
    Protected Function FindSocialInsuranceCodeFromDedValueConValue(DedValue As Double, ConValue As Double) As String

        Dim Str As String
        Dim Code As String = ""
        Str = "Select SocInc_Code from PrSsSocialInsurance " &
            " where SocInc_DedValue =" & DedValue &
            " and SocIns_ConValue =" & ConValue
        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Code = DbNullToString(ds.Tables(0).Rows(0).Item(0))
        End If
        Return Code
    End Function
    Protected Function DeleteAllEmployeeDiscountsOfPeriodGroup(PrdGrpCode As String) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = "Update PrTxEmployeeDiscounts " &
                " SET " &
                " EmpDis_Discount1=0," &
                " EmpDis_Discount2=0," &
                " EmpDis_Discount3=0," &
                " EmpDis_Discount4=0," &
                " EmpDis_Discount5=0," &
                " EmpDis_Discount6=0," &
                " EmpDis_Discount7=0," &
                " EmpDis_Discount8=0," &
                " EmpDis_Discount9=0," &
                " EmpDis_Discount10=0," &
                " EmpDis_LifeInsurance=0," &
                " EmpDis_Medical=0, " &
                " EmpDis_PensionFund=0 " &
                "  Where PrdGrp_Code =" & enQuoteString(PrdGrpCode)

        Dim i As Integer
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        End If
        Return F
    End Function
    Protected Function RemoveFirstEmploymentFromAllActiveEmployees(TempGrpCode As String) As Boolean
        Dim Str As String = ""
        Dim F As Boolean = False
        Str = "update prmsemployees " &
            " Set Emp_FEControlAmount = 0," &
            " Emp_FirstEmployment = 0," &
            " Emp_Force50Percent = 0," &
            " Emp_50Peroff = 0 " &
            " where TemGrp_Code =" & enQuoteString(TempGrpCode) &
            " AND Emp_Status='A' "

        Dim i As Integer
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        End If
        Return F
    End Function
    Private Sub AddPreviousHireOnRow(ByRef Ds As DataSet, ByVal r As DataRow, ByVal RehireCode As String)
        Dim Found As Boolean = False
        Dim Msg As String
        'Dim C_EmpLastName As Integer = 0
        'Dim C_EmpFirstName As Integer = 1
        'Dim C_EmpName As Integer = 2
        'Dim C_EmpTaxID As Integer = 3
        'Dim C_EmpIDType As Integer = 4
        'Dim C_EmpIDCard As Integer = 5
        Dim C_Local As Integer = 6
        Dim C_Abroad As Integer = 7
        Dim C_Allowances As Integer = 8
        Dim C_Total456 As Integer = 9
        Dim C_SI As Integer = 10
        Dim C_PF As Integer = 11
        Dim C_MF As Integer = 12
        Dim C_UNION As Integer = 13
        Dim C_OtherDisc As Integer = 14
        Dim C_TotalDisc As Integer = 15
        Dim C_Taxable As Integer = 16
        Dim C_IT As Integer = 17
        'Dim C_StartDate As Integer = 18
        'Dim C_LeaveDate As Integer = 19
        'Dim C_Adr1 As Integer = 20
        'Dim C_Adr2 As Integer = 21
        'Dim C_Adr3 As Integer = 22
        'Dim C_PostCode As Integer = 23
        'Dim C_PensionNo As Integer = 24
        'Dim C_PensionType As Integer = 25
        'Dim C_SINo As Integer = 26
        Dim C_EmpCode As Integer = 27
        Dim C_STDeduction As Integer = 28
        Dim C_STContribution As Integer = 29
        'Dim C_salaryPeriods As Integer = 30
        Dim C_LifeInsurance As Integer = 31

        Dim C_AllowancesBenefits As Integer = 32
        Dim C_TaxableFromOther As Integer = 33
        Dim C_NonTaxableIncome As Integer = 34

        Dim C_SyntaksiodotikaOfelimata As Integer = 35
        Dim C_MeiwsiApolavon As Integer = 36
        Dim C_WidowAndOrphans As Integer = 37
        Dim C_Pensionfund As Integer = 38

        '#2019
        Dim C_BIK_withSI As Integer = 39
        Dim C_BIK_withoutSI As Integer = 40
        'Include them in Total epr7m3t0r4c1
        'end of #2019
        Dim C_GESYtoSI As Integer = 41
        Dim C_GESYtoBIKDed As Integer = 42
        Dim C_GESYtoBIKCon As Integer = 43



        Dim index As Integer
        Dim i As Integer
        Found = False
        msg = RehireCode
        For i = 0 To Ds.Tables(0).Rows.Count - 1
            If DbNullToString(Ds.Tables(0).Rows(i).Item(C_EmpCode)) = RehireCode Then
                index = i
                Found = True
                Exit For
            End If
        Next
        If Not Found Then
            Dim emp As New cPrMsEmployees(RehireCode)
            If emp.Rehire <> "" Then
                RehireCode = emp.Rehire
                msg = msg & "," & RehireCode
                For i = 0 To Ds.Tables(0).Rows.Count - 1
                    If DbNullToString(Ds.Tables(0).Rows(i).Item(C_EmpCode)) = RehireCode Then
                        index = i
                        Found = True
                        Exit For
                    End If
                Next
            End If
        End If

        If Found Then
            With Ds.Tables(0).Rows(index)
                .Item(C_STDeduction) = .Item(C_STDeduction) + r(C_STDeduction)
                .Item(C_STContribution) = .Item(C_STContribution) + r(C_STContribution)
                .Item(C_Local) = .Item(C_Local) + r(C_Local)
                .Item(C_Abroad) = .Item(C_Abroad) + r(C_Abroad)
                .Item(C_Allowances) = .Item(C_Allowances) + r(C_Allowances)
                .Item(C_Total456) = .Item(C_Total456) + r(C_Total456)
                .Item(C_SI) = .Item(C_SI) + r(C_SI)
                .Item(C_Pensionfund) = .Item(C_Pensionfund) + r(C_Pensionfund)
                .Item(C_WidowAndOrphans) = .Item(C_WidowAndOrphans) + r(C_WidowAndOrphans)
                .Item(C_PF) = .Item(C_PF) + r(C_PF)
                .Item(C_SyntaksiodotikaOfelimata) = .Item(C_SyntaksiodotikaOfelimata) + r(C_SyntaksiodotikaOfelimata)
                .Item(C_MF) = .Item(C_MF) + r(C_MF)
                .Item(C_MeiwsiApolavon) = .Item(C_MeiwsiApolavon) + r(C_MeiwsiApolavon)
                .Item(C_UNION) = .Item(C_UNION) + r(C_UNION)
                .Item(C_OtherDisc) = .Item(C_OtherDisc) + r(C_OtherDisc)
                .Item(C_TotalDisc) = .Item(C_TotalDisc) + r(C_TotalDisc)
                .Item(C_LifeInsurance) = .Item(C_LifeInsurance) + r(C_LifeInsurance)
                .Item(C_Taxable) = .Item(C_Taxable) + r(C_Taxable)
                .Item(C_IT) = .Item(C_IT) + r(C_IT)
                .Item(C_BIK_withSI) = .Item(C_BIK_withSI) + r(C_BIK_withSI)
                .Item(C_BIK_withoutSI) = .Item(C_BIK_withoutSI) + r(C_BIK_withoutSI)
                .Item(C_GESYtoSI) = .Item(C_GESYtoSI) + r(C_GESYtoSI)
                .Item(C_GESYtoBIKDed) = .Item(C_GESYtoBIKDed) + r(C_GESYtoBIKDed)
                .Item(C_GESYtoBIKCon) = .Item(C_GESYtoBIKCon) + r(C_GESYtoBIKCon)

            End With
        Else
            MsgBox("Cannot find employee with rehire code " & msg)
        End If


    End Sub
    Private Sub LoadDataSetToExcel(ByVal DsX As DataSet, ByVal Desc As String)

        Dim HeaderStr As New ArrayList
        HeaderStr.Add(Desc)

        Dim HeaderSize As New ArrayList

        Dim Loader As New cExcelLoader


        Loader.PrintFooter = " Printed At:" & Format(Now, "yyyy-MM-dd hh:mm:ss")
        Loader.LoadIntoExcel(DsX, HeaderStr, HeaderSize)

    End Sub
    Protected Function REPORT_IR7_2017(ByVal PerGrp As cPrMsPeriodGroups, ByVal FromCode As String, ByVal ToCode As String, ByVal YearDate As Date, ByVal ShowMessages As Boolean) As DataSet
        Dim Ds As New DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim DsEmp As DataSet
        Dim i As Integer

        Dim R As DataRow

        Dim C_EmpLastName As Integer = 0
        Dim C_EmpFirstName As Integer = 1
        Dim C_EmpName As Integer = 2
        Dim C_EmpTaxID As Integer = 3
        Dim C_EmpIDType As Integer = 4
        Dim C_EmpIDCard As Integer = 5
        Dim C_Local As Integer = 6
        Dim C_Abroad As Integer = 7
        Dim C_Allowances As Integer = 8
        Dim C_Total456 As Integer = 9
        Dim C_SI As Integer = 10
        Dim C_PF As Integer = 11
        Dim C_MF As Integer = 12
        Dim C_UNION As Integer = 13
        Dim C_OtherDisc As Integer = 14
        Dim C_TotalDisc As Integer = 15
        Dim C_Taxable As Integer = 16
        Dim C_IT As Integer = 17
        Dim C_StartDate As Integer = 18
        Dim C_LeaveDate As Integer = 19
        Dim C_Adr1 As Integer = 20
        Dim C_Adr2 As Integer = 21
        Dim C_Adr3 As Integer = 22
        Dim C_PostCode As Integer = 23
        Dim C_PensionNo As Integer = 24
        Dim C_PensionType As Integer = 25
        Dim C_SINo As Integer = 26
        Dim C_EmpCode As Integer = 27
        Dim C_STDeduction As Integer = 28
        Dim C_STContribution As Integer = 29
        Dim C_salaryPeriods As Integer = 30
        Dim C_LifeInsurance As Integer = 31



        Dim LocalErn As Integer = 0
        Dim AbroadErn As Integer = 0
        Dim Allowances As Integer = 0
        Dim TotalErn As Integer = 0
        Dim SI As Integer = 0
        Dim MF As Integer = 0
        Dim Union As Integer = 0
        Dim PF As Integer = 0
        Dim LifeInsurance As Double = 0
        Dim OtherDisc As Double = 0
        Dim Life_Other As Integer
        Dim LifeIns As Integer
        Dim TotalDisc As Integer = 0

        Dim D2 As Date
        D2 = DateAdd(DateInterval.Year, 1, YearDate)
        Dim SYear As String = Format(D2, "yyyy-MM-dd")
        SYear = Utils.ChangeDateFormatForSearch(SYear)

        ' Define Data Table
        Dim dt As New DataTable

        dt = New DataTable("Employee")
        '0
        dt.Columns.Add(New DataColumn("EmpLastName", System.Type.GetType("System.String")))
        '1
        dt.Columns.Add(New DataColumn("EmpFirstName", System.Type.GetType("System.String")))
        '2
        dt.Columns.Add(New DataColumn("EmpName", System.Type.GetType("System.String")))
        '3
        dt.Columns.Add(New DataColumn("EmpTaxID", System.Type.GetType("System.String")))
        '4
        dt.Columns.Add(New DataColumn("EmpIDType", System.Type.GetType("System.String")))
        '5
        dt.Columns.Add(New DataColumn("EmpIDCard", System.Type.GetType("System.String")))
        '6
        dt.Columns.Add(New DataColumn("Local", System.Type.GetType("System.Int32")))
        '7
        dt.Columns.Add(New DataColumn("Abroad", System.Type.GetType("System.Int32")))
        '8
        dt.Columns.Add(New DataColumn("Allowances", System.Type.GetType("System.Int32")))
        '9
        dt.Columns.Add(New DataColumn("Total456", System.Type.GetType("System.Int32")))
        '10
        dt.Columns.Add(New DataColumn("SI", System.Type.GetType("System.Int32")))
        '11
        dt.Columns.Add(New DataColumn("PF", System.Type.GetType("System.Int32")))
        '12
        dt.Columns.Add(New DataColumn("MF", System.Type.GetType("System.Int32")))
        '13
        dt.Columns.Add(New DataColumn("UNION", System.Type.GetType("System.Int32")))
        '14
        dt.Columns.Add(New DataColumn("OtherDisc", System.Type.GetType("System.Int32")))
        '15
        dt.Columns.Add(New DataColumn("TotalDisc", System.Type.GetType("System.Int32")))
        '16
        dt.Columns.Add(New DataColumn("Taxable", System.Type.GetType("System.Int32")))
        '17
        dt.Columns.Add(New DataColumn("IT", System.Type.GetType("System.Double")))
        '18
        dt.Columns.Add(New DataColumn("StartDate", System.Type.GetType("System.String")))
        '19
        dt.Columns.Add(New DataColumn("LeaveDate", System.Type.GetType("System.String")))
        '20
        dt.Columns.Add(New DataColumn("Adr1", System.Type.GetType("System.String")))
        '21
        dt.Columns.Add(New DataColumn("Adr2", System.Type.GetType("System.String")))
        '22
        dt.Columns.Add(New DataColumn("Adr3", System.Type.GetType("System.String")))
        '23
        dt.Columns.Add(New DataColumn("PostCode", System.Type.GetType("System.String")))
        '24
        dt.Columns.Add(New DataColumn("PensionNo", System.Type.GetType("System.String")))
        '25
        dt.Columns.Add(New DataColumn("PensionType", System.Type.GetType("System.String")))
        '26
        dt.Columns.Add(New DataColumn("SINumber", System.Type.GetType("System.String")))
        '27
        dt.Columns.Add(New DataColumn("EmpCode", System.Type.GetType("System.String")))
        '28
        dt.Columns.Add(New DataColumn("STDeduction", System.Type.GetType("System.Double")))
        '29
        dt.Columns.Add(New DataColumn("STContribution", System.Type.GetType("System.Double")))
        '30
        dt.Columns.Add(New DataColumn("SalaryPeriods", System.Type.GetType("System.Int32")))
        '31
        dt.Columns.Add(New DataColumn("LifeInsurance", System.Type.GetType("System.Int32")))

        Ds.Tables.Add(dt)

        '''''''''''''''''
        Dim TempGroup As New cPrMsTemplateGroup(PerGrp.TemGrpCode)

        Str = " SELECT Emp_Code," & _
        " Emp_FullName," & _
        " Emp_Address1," & _
        " Emp_Address2," & _
        " Emp_Address3," & _
        " Emp_PostCode," & _
        " Emp_TaxID," & _
        " Emp_TerminateDate, " & _
        " Emp_StartDate," & _
        " Emp_LastName," & _
        " Emp_FirstName," & _
        " Emp_PassportNumber," & _
        " Emp_IdentificationCard," & _
        " Emp_AlienNumber," & _
        " Emp_SocialInsNumber," & _
        " TicTyp_Code," & _
        " Emp_DrivingLicense, " & _
        " Emp_PensionNo," & _
        " Emp_PensionType, " & _
        " Emp_socialinsnumber, " & _
        " Emp_OtherIncome1 " & _
         " FROM PrMsEmployees" & _
        " inner join PrMsTemplateGroup ON " & _
        " PrMsEmployees.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code " & _
        " INNER JOIN" & _
        " AdMsCompany ON " & _
        " PrMsTemplateGroup.Com_Code = AdMsCompany.Com_Code" & _
        " WHERE (AdMsCompany.Com_Code = " & enQuoteString(TempGroup.CompanyCode) & ")" & _
        " AND (emp_startdate < " & enQuoteString(SYear) & ")"
        If FromCode <> "" Or ToCode <> "" Then
            Str2 = " AND (Emp_Code >= " & enQuoteString(FromCode) & _
                 " AND Emp_Code <= " & enQuoteString(ToCode) & ")"
        End If
        Str = Str & Str2

        DsEmp = GetData(Str)
        If CheckDataSet(DsEmp) Then


            For i = 0 To DsEmp.Tables(0).Rows.Count - 1
                R = dt.NewRow


                Application.DoEvents()
                Dim EmpCode As String
                EmpCode = DbNullToString(DsEmp.Tables(0).Rows(i).Item(0))

                R(C_EmpName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(1))
                '  Debug.WriteLine(i & " " & DbNullToString(DsEmp.Tables(0).Rows(i).Item(1)))

                R(C_Adr1) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(2))
                R(C_Adr2) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(3))
                R(C_Adr3) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(4))
                R(C_PostCode) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(5))
                R(C_EmpTaxID) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(6))
                Dim T As String
                T = DbNullToString(DsEmp.Tables(0).Rows(i).Item(7))
                If T = "" Then
                    R(C_LeaveDate) = ""
                Else
                    Try
                        R(C_LeaveDate) = Format(CDate(T), "dd/MM/yyyy")

                    Catch ex As Exception
                        MsgBox("Error on Employee with Code " & EmpCode & " Leave date is invalid", MsgBoxStyle.Critical)
                        Ds.Tables.Clear()
                        Exit Function

                    End Try
                End If 'DbNullToString(DsEmp.Tables(0).Rows(i).Item(7))
                If DbNullToDate(DsEmp.Tables(0).Rows(i).Item(8)).Year = YearDate.Year() Then
                    R(C_StartDate) = Format(DbNullToDate(DsEmp.Tables(0).Rows(i).Item(8)), "dd/MM/yyyy")
                Else
                    R(C_StartDate) = " "
                End If


                R(C_EmpLastName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(9))
                R(C_EmpFirstName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(10))

                Dim IDType As String = DbNullToString(DsEmp.Tables(0).Rows(i).Item(15))
                Dim Found As Boolean = False
                If IDType = "1" Then
                    Found = True
                    R(C_EmpIDType) = " "
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(6))
                    'ElseIf IDType = "2" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(11))
                ElseIf IDType = "3" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    'R(C_EmpIDType) = ""
                    If DbNullToString(DsEmp.Tables(0).Rows(i).Item(12)) <> "" Then
                        Dim S As String
                        S = DsEmp.Tables(0).Rows(i).Item(12)
                        If S.Substring(0, 1) = "0" Then
                            S = S.Substring(1, S.Length - 1)
                            DsEmp.Tables(0).Rows(i).Item(12) = S
                        End If
                    End If
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(12))
                ElseIf IDType = "4" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(16))
                    'ElseIf IDType = "5" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(14))
                    'ElseIf IDType = "6" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(16))
                ElseIf IDType = "7" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(13))
                End If
                If Not Found Then
                    If ShowMessages Then
                        MsgBox("Employee with Code " & EmpCode & " Does not have a Valid Tax Identification Type, Valid types are 1,3,4 and 7")
                        Ds.Tables.Clear()
                        Exit Function
                    End If
                End If

                R(C_PensionNo) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(17))
                R(C_PensionType) = DbNullToInt(DsEmp.Tables(0).Rows(i).Item(18))
                R(C_SINo) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(19))
                R(C_EmpCode) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(0))
                Dim DsPerPerCom As DataSet
                Dim StrX As String
                StrX = "SELECT PrMsPeriodGroups.PrdGrp_Code " & _
                " FROM PrMsPeriodGroups INNER JOIN " & _
                " PrMsTemplateGroup ON " & _
                " PrMsPeriodGroups.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code " & _
                " INNER JOIN " & _
                " AdMsCompany ON PrMsTemplateGroup.Com_Code = AdMsCompany.Com_Code " & _
                " WHERE (PrMsTemplateGroup.Com_Code = " & enQuoteString(TempGroup.CompanyCode) & ")  " & _
                " AND (PrMsPeriodGroups.PrdGpr_Year = " & PerGrp.Year & ") "
                DsPerPerCom = GetData(StrX)

                Dim f As Integer
                Dim StrPeriodGroupCodes
                Dim StrPeriodGroupCodes2
                Dim TempPer As String
                If CheckDataSet(DsPerPerCom) Then
                    For f = 0 To DsPerPerCom.Tables(0).Rows.Count - 1
                        TempPer = DsPerPerCom.Tables(0).Rows(f).Item(0)
                        If f = 0 Then
                            StrPeriodGroupCodes = " AND ((PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                            StrPeriodGroupCodes2 = " AND ((PrTxTrxnHeader.PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                        Else
                            StrPeriodGroupCodes = StrPeriodGroupCodes & " OR (PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                            StrPeriodGroupCodes2 = StrPeriodGroupCodes2 & " OR (PrTxTrxnHeader.PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                        End If
                    Next
                    StrPeriodGroupCodes = StrPeriodGroupCodes & ")"
                    StrPeriodGroupCodes2 = StrPeriodGroupCodes2 & ")"

                End If

                Dim DsSpecialTaxDed As DataSet
                Dim DsSpecialTaxCon As DataSet
                GetSumsOfEmployeeDeductions("EX", EmpCode, PerGrp.Code)
                Dim StrSP1 As String
                Dim StrSP2 As String

                StrSP1 = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnHeader INNER JOIN" & _
                    " PrTxTrxnLines ON" & _
                    " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
                    " PrMsDeductionCodes ON" & _
                    " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN" & _
                    " PrSsDeductionTypes ON" & _
                    " PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code" & _
                    " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                    " AND (PrSsDeductionTypes.DedTyp_Code = 'EX')"

                StrSP1 = StrSP1 + StrPeriodGroupCodes2

                StrSP2 = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnHeader INNER JOIN" & _
                    " PrTxTrxnLines ON" & _
                    " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
                    " PrMsContributionCodes ON" & _
                    " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code INNER JOIN" & _
                    " PrSsContributionTypes ON" & _
                    " PrMsContributionCodes.ConTyp_Code = PrSsContributionTypes.ConTyp_Code" & _
                    " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
                    " AND (PrSsContributionTypes.ConTyp_Code = 'EX')"

                StrSP2 = StrSP2 + StrPeriodGroupCodes2

                DsSpecialTaxDed = GetData(StrSP1)
                DsSpecialTaxCon = GetData(StrSP2)
                Dim SPTaxDed As Double = 0
                Dim SPTaxCon As Double = 0

                If CheckDataSet(DsSpecialTaxDed) Then
                    SPTaxDed = DbNullToDouble(DsSpecialTaxDed.Tables(0).Rows(0).Item(0))
                End If
                If CheckDataSet(DsSpecialTaxCon) Then
                    SPTaxCon = DbNullToDouble(DsSpecialTaxCon.Tables(0).Rows(0).Item(0))
                End If

                R(C_STDeduction) = SPTaxDed
                R(C_STContribution) = SPTaxCon


                Dim DsGrossEarnings As DataSet
                Dim DsTaxableEarnings As DataSet


                Str = " SELECT SUM(TrxHdr_TotalErnPeriod)" & _
                      " FROM  PrTxTrxnHeader" & _
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                Str = Str & StrPeriodGroupCodes
                DsGrossEarnings = GetData(Str)

                Str = " SELECT SUM(TrxHdr_TaxableIncome)" & _
                      " FROM  PrTxTrxnHeader" & _
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                Str = Str & StrPeriodGroupCodes
                DsTaxableEarnings = GetData(Str)

                Dim NonTaxable As Double
                NonTaxable = FindNonTaxableTotalForTemplateGroupForEmployee(TempGroup.Code, PerGrp.Code, EmpCode)

                Dim DsSILeave As DataSet
                'DsSILeave = Me.FindSILeaveTotalIR632(PerGrp.TemGrpCode, PerGrp.Code, EmpCode)
                DsSILeave = Me.FindSILeaveTotalIR63_2Groups(PerGrp.TemGrpCode, StrPeriodGroupCodes, EmpCode)
                Dim SILeaveValue As Double = 0
                If CheckDataSet(DsSILeave) Then
                    SILeaveValue = DbNullToDouble(DsSILeave.Tables(0).Rows(0).Item(0))
                    If SILeaveValue <> 0 Then
                        ' MsgBox(1)
                    End If
                End If

                Dim DsBenefitsInKind As DataSet
                DsBenefitsInKind = Me.FindBenefitsInKindTotalIR63_2Groups(PerGrp.TemGrpCode, StrPeriodGroupCodes, EmpCode)
                Dim BenefitsInKind As Double = 0
                If CheckDataSet(DsBenefitsInKind) Then
                    BenefitsInKind = DbNullToDouble(DsBenefitsInKind.Tables(0).Rows(0).Item(0))
                    If BenefitsInKind <> 0 Then
                        ' MsgBox(1)
                    End If
                End If



                LocalErn = DbNullToDouble(DsGrossEarnings.Tables(0).Rows(0).Item(0)) - NonTaxable + SILeaveValue + BenefitsInKind

                'LocalErn = RoundMe3(LocalErn, 0)

                R(C_Local) = LocalErn




                AbroadErn = "0.00"
                R(C_Abroad) = AbroadErn
                Allowances = RoundMe3(DbNullToDouble(DsEmp.Tables(0).Rows(i).Item(20)), 2)

                R(C_Allowances) = Allowances

                TotalErn = LocalErn + AbroadErn + Allowances
                R(C_Total456) = TotalErn



                Dim DsSI As DataSet = GetSumsOfEmployeeDeductions_IR7("SI", EmpCode, StrPeriodGroupCodes)
                SI = RoundMe3(DbNullToDouble(DsSI.Tables(0).Rows(0).Item(0)), 0)
                R(C_SI) = SI

                Dim DsPF As DataSet = GetSumsOfEmployeeDeductions_IR7("PF", EmpCode, StrPeriodGroupCodes)
                PF = RoundMe3(DbNullToDouble(DsPF.Tables(0).Rows(0).Item(0)), 0)
                R(C_PF) = PF

                Dim DsMF As DataSet = GetSumsOfEmployeeDeductions_IR7("MF", EmpCode, StrPeriodGroupCodes)
                MF = RoundMe3(DbNullToDouble(DsMF.Tables(0).Rows(0).Item(0)), 0)
                R(C_MF) = MF


                Dim DsU2 As DataSet = GetSumsOfEmployeeDeductions_IR7("U2", EmpCode, StrPeriodGroupCodes)
                Dim DsU3 As DataSet = GetSumsOfEmployeeDeductions_IR7("U3", EmpCode, StrPeriodGroupCodes)
                Dim DsUS As DataSet = GetSumsOfEmployeeDeductions_IR7("US", EmpCode, StrPeriodGroupCodes)
                Dim U As Double = 0
                U = U + DbNullToDouble(DsU2.Tables(0).Rows(0).Item(0))
                U = U + DbNullToDouble(DsU3.Tables(0).Rows(0).Item(0))
                U = U + DbNullToDouble(DsUS.Tables(0).Rows(0).Item(0))
                Union = 0
                Union = RoundMe3(U, 2)

                R(C_UNION) = Union

                'FindEmployeeSalaryPeriods
                Dim NoOfSalary As Integer
                NoOfSalary = Global1.Business.GetNumberOfTotalPeriodsFOREmployee(EmpCode, PerGrp.Year)
                R(C_salaryPeriods) = NoOfSalary

                '
                Life_Other = 0
                OtherDisc = 0

                If Global1.GLB_IR7Discounts = 0 Then
                    '------------------------------------
                    ''''''Discounts from Header''''''''''
                    '------------------------------------
                    Dim DsDiscounts As DataSet
                    Str = " Select SUM(TrxHdr_LifeInsurance)," & _
                          " SUM(TrxHdr_Discounts+TrxHdr_FE)" & _
                          " FROM  PrTxTrxnHeader" & _
                          " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                    Str = Str & StrPeriodGroupCodes

                    DsDiscounts = GetData(Str)
                    LifeInsurance = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(0))
                    OtherDisc = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(1))

                    'Life_Other = RoundMe3(LifeInsurance + OtherDisc, 2)
                    Life_Other = RoundMe3(OtherDisc, 2)
                Else
                    '------------------------------------
                    ''''''Discounts from Header''''''''''
                    '------------------------------------
                    Dim DsDiscounts
                    DsDiscounts = GetSumsOfEmployeeDiscounts_IR7(EmpCode, StrPeriodGroupCodes)
                    If CheckDataSet(DsDiscounts) Then
                        OtherDisc = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(0))
                    End If

                    Life_Other = RoundMe3(OtherDisc, 2)

                End If
                LifeIns = RoundMe3(LifeInsurance, 2)

                '''''''''''''''''''''''''''''''''''''
                '------------------------------------
                '''''''''''''''''''''''''''''''''''''
                Life_Other = Life_Other + SPTaxDed

                R(C_OtherDisc) = Life_Other


                'TotalDisc = SI + PF + MF + Union + Life_Other 
                TotalDisc = SI + PF + MF + Union + Life_Other + LifeIns

                R(C_TotalDisc) = TotalDisc
                R(C_LifeInsurance) = LifeIns

                Dim Taxable As Double
                Taxable = RoundMe3(DbNullToDouble(DsTaxableEarnings.Tables(0).Rows(0).Item(0)), 0)
                'R(C_Taxable) = TotalErn - TotalDisc
                Taxable = Taxable - TotalDisc + Allowances
                ''''''''''''''''''''''''''''''''''''''''''
                'Change Action Pension
                ''''''''''''''''''''''''''''''''''''''''''
                If Taxable <> TotalErn - TotalDisc Then
                    Taxable = TotalErn - TotalDisc
                End If
                ''''''''''''''''''''''''''''''''''''''''''

                R(C_Taxable) = Taxable


                Dim DsIT As DataSet = GetSumsOfEmployeeDeductions_IR7("IT", EmpCode, StrPeriodGroupCodes)
                R(C_IT) = DbNullToDouble(DsIT.Tables(0).Rows(0).Item(0))

                Str = " SELECT count(*)" & _
                      " FROM  PrTxTrxnHeader" & _
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                Str = Str & StrPeriodGroupCodes
                Dim DsCount As DataSet
                DsCount = GetData(Str)
                If CheckDataSet(DsCount) Then
                    If DbNullToInt(DsCount.Tables(0).Rows(0).Item(0)) <> 0 Then
                        dt.Rows.Add(R)
                    End If
                End If
            Next

            Dim DsComp As DataSet
            Str = " SELECT AdMsCompany.Com_Name," & _
                " AdMsCompany.Com_TIC," & _
                " AdMsCompany.Com_Address1," & _
                " AdMsCompany.Com_Address2, " & _
                " AdMsCompany.Com_Address3," & _
                " AdMsCompany.Com_Address4," & _
                " AdMsCompany.Com_AccountantTitle," & _
                " PrMsTemplateGroup.TemGrp_Code" & _
                " FROM AdMsCompany INNER JOIN" & _
                " PrMsTemplateGroup ON " & _
                " AdMsCompany.Com_Code = PrMsTemplateGroup.Com_Code" & _
                " WHERE (PrMsTemplateGroup.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

            DsComp = GetData(Str)
            Ds.Tables.Add(DsComp.Tables(0).Copy)
            Ds.Tables(1).TableName = "CompanyDetails"

            Dim DsYear As DataSet
            Str = " SELECT PrdGpr_Year" & _
                  " FROM PrMsPeriodGroups" & _
                  " where PrdGrp_Code=" & enQuoteString(PerGrp.Code)

            DsYear = GetData(Str)
            Ds.Tables.Add(DsYear.Tables(0).Copy)
            Ds.Tables(2).TableName = "Year"

        End If


        Return Ds
    End Function
    Protected Function REPORT_IR112(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String
        Ds = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, PerGrp.TemGrpCode, PerGrp.Code)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                PerCode = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
                If i = 0 Then
                    Str = Str & " AND ( "
                Else
                    Str = Str & " OR "
                End If
                Str = Str & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)


        '''''
        Dim StrXX
        StrXX = " Select TemGrp_Code from PrMsTemplateGroup" & _
                    " Where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Dim DsT As DataSet
        Dim DsPG As DataSet

        DsT = GetData(StrXX)
        Dim Str2X As String

        If CheckDataSet(DsT) Then
            Dim Code As String
            Dim z As Integer
            Dim PeriodGroupCode As String = ""
            For z = 0 To DsT.Tables(0).Rows.Count - 1
                Code = DbNullToString(DsT.Tables(0).Rows(z).Item(0))
                StrXX = "SELECT PRDGRP_CODE FROM PRMSPERIODGROUPS" & _
                      " WHERE TEMGRP_CODE=" & enQuoteString(Code) & _
                " AND PrdGpr_Year=" & enQuoteString(PerGrp.Year)
                DsPG = GetData(StrXX)
                If CheckDataSet(DsPG) Then
                    PeriodGroupCode = DbNullToString(DsPG.Tables(0).Rows(0).Item(0))
                End If

                If z = 0 Then
                    Str2X = " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
                    'Str3X = " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
                Else
                    Str2X = Str2X & " OR  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
                    'Str3X = Str3X & " OR (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
                End If
            Next
            Str2X = "AND (" & Str2X & ")"
            'Str3X = "AND (" & Str3X & ")"
        End If


        '''''




        StrX = " SELECT SUM( PrTxTrxnLines.TrxLin_PeriodValue)" & _
            " FROM  PrTxTrxnHeader INNER JOIN" & _
            " PrTxTrxnLines ON " & _
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
            " PrMsDeductionCodes ON " & _
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
            " WHERE  (PrMsDeductionCodes.DedTyp_Code = 'DN') "
        '" AND (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

        StrX = StrX & Str2X & Str

        Return GetData(StrX)

    End Function
    Protected Function REPORT_IR61(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String

        '''''''''''''''''''''''''''' NEW PART ''''''''''''''''''''''''''''''''''''''''''''
        Dim strPerGroupCode As String
        Dim strTempGroupCode As String
        Dim strPerCode As String

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)
        Ds = Me.GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(SIPeriod.Code, TemGrp.CompanyCode, PerGrp.Year)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                strTempGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(0)))
                strPerGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(1)))
                strPerCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(2)))
                If i = 0 Then
                    Str = Str & " AND ( "
                Else
                    Str = Str & " OR "
                End If
                Str = Str & "( PrTxTrxnHeader.TemGrp_Code = " & strTempGroupCode & " AND  PrTxTrxnHeader.PrdGrp_Code = " & strPerGroupCode & " AND  PrTxTrxnHeader.PrdCod_Code = " & strPerCode & " )"
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If
        '''''''''''''''''''''''' ENd OF NEW PART ''''''''''''''''''''''''''''''''''''''''''''''''


        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        '''''''''''' OLD ''''''''''''''''''''''''''''''''''''''''''''''''
        ' Ds = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, PerGrp.TemGrpCode, PerGrp.Code)
        'If CheckDataSet(Ds) Then
        '    Last = Ds.Tables(0).Rows.Count - 1
        '    For i = 0 To Ds.Tables(0).Rows.Count - 1
        '        PerCode = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
        '        If i = 0 Then
        '            Str = Str & " AND ( "
        '        Else
        '            Str = Str & " OR "
        '        End If
        '        Str = Str & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
        '        If i = Last Then
        '            Str = Str & " )"
        '        End If

        '    Next
        'End If

        'Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)


        ''''''
        'Dim StrXX
        'StrXX = " Select TemGrp_Code from PrMsTemplateGroup" & _
        '            " Where com_code=" & enQuoteString(TemGrp.CompanyCode)
        'Dim DsT As DataSet
        'Dim DsPG As DataSet

        'DsT = GetData(StrXX)
        'Dim Str2X As String = ""
        'Dim Code As String
        'Dim StrZ As String = ""
        'If CheckDataSet(DsT) Then

        '    Dim z As Integer
        '    Dim PeriodGroupCode As String = ""
        '    For z = 0 To DsT.Tables(0).Rows.Count - 1
        '        Code = DbNullToString(DsT.Tables(0).Rows(z).Item(0))
        '        StrXX = "SELECT PRDGRP_CODE FROM PRMSPERIODGROUPS" & _
        '              " WHERE TEMGRP_CODE=" & enQuoteString(Code) & _
        '        " AND PrdGpr_Year=" & enQuoteString(PerGrp.Year)
        '        DsPG = GetData(StrXX)
        '        If CheckDataSet(DsPG) Then
        '            PeriodGroupCode = DbNullToString(DsPG.Tables(0).Rows(0).Item(0))
        '        End If

        '        If z = 0 Then
        '            Str2X = " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
        '            ' Str3X = " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
        '        Else
        '            Str2X = Str2X & " OR  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
        '            ' Str3X = Str3X & " OR (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
        '        End If
        '    Next
        '    Str2X = "AND (" & Str2X & ")"
        '    ' Str3X = "AND (" & Str3X & ")"
        '    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        '    If CheckDataSet(DsPG) Then
        '        Dim DsZ As DataSet
        '        DsZ = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, Code, PeriodGroupCode)
        '        If CheckDataSet(DsZ) Then
        '            Last = DsZ.Tables(0).Rows.Count - 1
        '            For i = 0 To DsZ.Tables(0).Rows.Count - 1
        '                PerCode = DbNullToString(DsZ.Tables(0).Rows(i).Item(0))
        '                If i = 0 Then
        '                    StrZ = StrZ & " AND ( "
        '                Else
        '                    StrZ = StrZ & " OR "
        '                End If
        '                StrZ = StrZ & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)

        '                If i = Last Then
        '                    StrZ = StrZ & " )"
        '                End If

        '            Next
        '        End If
        '    End If
        '    StrZ = ""
        '    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''




        'End If


        ''''''




        StrX = " SELECT SUM( PrTxTrxnLines.TrxLin_PeriodValue)" &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsDeductionCodes ON " &
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" &
            " WHERE  (PrMsDeductionCodes.DedTyp_Code = 'IT') "
        ' " AND (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

        'StrX = StrX & Str2X & Str & StrZ
        StrX = StrX & Str

        Return GetData(StrX)

    End Function
    Protected Function REPORT_IR61_PerEmployee(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String

        '''''''''''''''''''''''''''' NEW PART ''''''''''''''''''''''''''''''''''''''''''''
        Dim strPerGroupCode As String
        Dim strTempGroupCode As String
        Dim strPerCode As String

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)
        Ds = Me.GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(SIPeriod.Code, TemGrp.CompanyCode, PerGrp.Year)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                strTempGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(0)))
                strPerGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(1)))
                strPerCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(2)))
                If i = 0 Then
                    Str = Str & " AND ( "
                Else
                    Str = Str & " OR "
                End If
                Str = Str & "( PrTxTrxnHeader.TemGrp_Code = " & strTempGroupCode & " AND  PrTxTrxnHeader.PrdGrp_Code = " & strPerGroupCode & " AND  PrTxTrxnHeader.PrdCod_Code = " & strPerCode & " )"
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If



        StrX = " SELECT PrMsEmployees.Emp_Code," &
        " PrMsEmployees.Emp_FirstName," &
        " PrMsEmployees.Emp_LastName," &
        " PrMsEmployees.Emp_TaxID," &
        " PrMsEmployees.Emp_StartDate, " &
        " PrMsEmployees.Emp_TerminateDate," &
        " PrMsEmployees.Emp_IsDirector," &
        " PrMsEmployees.Emp_LWBPen," &
        " PrTxTrxnLines.TrxLin_PeriodValue," &
        " PrMsEmployees.Emp_OtherIncome3 " &
        " FROM PrTxTrxnHeader INNER JOIN" &
        " PrTxTrxnLines ON PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
        " PrMsDeductionCodes ON PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN" &
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" &
        " WHERE  (PrMsDeductionCodes.DedTyp_Code = 'IT')"

        StrX = StrX & Str & " Order by PrTxtrxnHeader.emp_Code ASC"

        Return GetData(StrX)

    End Function
    Protected Function REPORT_IR61_GetTaxableIncome(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String

        '''''''''''''''''''''''''''' NEW PART ''''''''''''''''''''''''''''''''''''''''''''
        Dim strPerGroupCode As String
        Dim strTempGroupCode As String
        Dim strPerCode As String

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)
        Ds = Me.GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(SIPeriod.Code, TemGrp.CompanyCode, PerGrp.Year)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                strTempGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(0)))
                strPerGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(1)))
                strPerCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(2)))
                If i = 0 Then
                    Str = Str & " Where ( "
                Else
                    Str = Str & " Or "
                End If
                Str = Str & "( PrTxTrxnHeader.TemGrp_Code = " & strTempGroupCode & " And  PrTxTrxnHeader.PrdGrp_Code = " & strPerGroupCode & " And  PrTxTrxnHeader.PrdCod_Code = " & strPerCode & " )"
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If




        StrX = " Select SUM( PrTxTrxnheader.Trxhdr_TaxableIncome)," &
        " SUM( PrTxTrxnheader.Trxhdr_NetSalary)" &
            " FROM  PrTxTrxnHeader "
        ' " And (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

        'StrX = StrX & Str2X & Str & StrZ
        StrX = StrX & Str

        Return GetData(StrX)

    End Function
    Protected Function REPORT_IR61_GetTaxableIncome_PerEmployee(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String

        '''''''''''''''''''''''''''' NEW PART ''''''''''''''''''''''''''''''''''''''''''''
        Dim strPerGroupCode As String
        Dim strTempGroupCode As String
        Dim strPerCode As String

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)
        Ds = Me.GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(SIPeriod.Code, TemGrp.CompanyCode, PerGrp.Year)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                strTempGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(0)))
                strPerGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(1)))
                strPerCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(2)))
                If i = 0 Then
                    Str = Str & " Where ( "
                Else
                    Str = Str & " Or "
                End If
                Str = Str & "( PrTxTrxnHeader.TemGrp_Code = " & strTempGroupCode & " And  PrTxTrxnHeader.PrdGrp_Code = " & strPerGroupCode & " And  PrTxTrxnHeader.PrdCod_Code = " & strPerCode & " )"
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If




        StrX = " Select PrTxTrxnheader.Emp_Code," &
            " PrTxTrxnheader.Trxhdr_TaxableIncome ," &
        "  PrTxTrxnheader.Trxhdr_NetSalary " &
            " FROM  PrTxTrxnHeader "
        ' " And (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

        'StrX = StrX & Str2X & Str & StrZ
        StrX = StrX & Str & " Order by PrTxtrxnHeader.emp_Code ASC"

        Return GetData(StrX)

    End Function
    Protected Function REPORT_IR61_ST_DEDUCTION(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String
        Ds = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, PerGrp.TemGrpCode, PerGrp.Code)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                PerCode = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
                If i = 0 Then
                    Str = Str & " And ( "
                Else
                    Str = Str & " Or "
                End If
                Str = Str & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)


        '''''
        Dim StrXX
        StrXX = " Select TemGrp_Code from PrMsTemplateGroup" & _
                    " Where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Dim DsT As DataSet
        Dim DsPG As DataSet

        DsT = GetData(StrXX)
        Dim Str2X As String

        If CheckDataSet(DsT) Then
            Dim Code As String
            Dim z As Integer
            Dim PeriodGroupCode As String = ""
            For z = 0 To DsT.Tables(0).Rows.Count - 1
                Code = DbNullToString(DsT.Tables(0).Rows(z).Item(0))
                StrXX = "Select PRDGRP_CODE FROM PRMSPERIODGROUPS" & _
                      " WHERE TEMGRP_CODE=" & enQuoteString(Code) & _
                " And PrdGpr_Year=" & enQuoteString(PerGrp.Year)
                DsPG = GetData(StrXX)
                If CheckDataSet(DsPG) Then
                    PeriodGroupCode = DbNullToString(DsPG.Tables(0).Rows(0).Item(0))
                End If

                If z = 0 Then
                    Str2X = " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
                    'Str3X = " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
                Else
                    Str2X = Str2X & " Or  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
                    'Str3X = Str3X & " Or (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
                End If
            Next
            Str2X = "And (" & Str2X & ")"
            'Str3X = "And (" & Str3X & ")"
        End If


        '''''




        StrX = " Select SUM( PrTxTrxnLines.TrxLin_PeriodValue)" & _
            " FROM  PrTxTrxnHeader INNER JOIN" & _
            " PrTxTrxnLines On " & _
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
            " PrMsDeductionCodes On " & _
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
            " WHERE  (PrMsDeductionCodes.DedTyp_Code = 'EX') "
        '" AND (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

        StrX = StrX & Str2X & Str

        Return GetData(StrX)

    End Function
    Protected Function REPORT_IR61_ST_CONTRIBUTION(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String
        Ds = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, PerGrp.TemGrpCode, PerGrp.Code)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                PerCode = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
                If i = 0 Then
                    Str = Str & " AND ( "
                Else
                    Str = Str & " OR "
                End If
                Str = Str & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)


        '''''
        Dim StrXX
        StrXX = " Select TemGrp_Code from PrMsTemplateGroup" & _
                    " Where com_code=" & enQuoteString(TemGrp.CompanyCode)
        Dim DsT As DataSet
        Dim DsPG As DataSet

        DsT = GetData(StrXX)
        Dim Str2X As String

        If CheckDataSet(DsT) Then
            Dim Code As String
            Dim z As Integer
            Dim PeriodGroupCode As String = ""
            For z = 0 To DsT.Tables(0).Rows.Count - 1
                Code = DbNullToString(DsT.Tables(0).Rows(z).Item(0))
                StrXX = "SELECT PRDGRP_CODE FROM PRMSPERIODGROUPS" & _
                      " WHERE TEMGRP_CODE=" & enQuoteString(Code) & _
                " AND PrdGpr_Year=" & enQuoteString(PerGrp.Year)
                DsPG = GetData(StrXX)
                If CheckDataSet(DsPG) Then
                    PeriodGroupCode = DbNullToString(DsPG.Tables(0).Rows(0).Item(0))
                End If

                If z = 0 Then
                    Str2X = " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
                    'Str3X = " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
                Else
                    Str2X = Str2X & " OR  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
                    'Str3X = Str3X & " OR (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
                End If
            Next
            Str2X = "AND (" & Str2X & ")"
            'Str3X = "AND (" & Str3X & ")"
        End If


        '''''




        StrX = " SELECT SUM( PrTxTrxnLines.TrxLin_PeriodValue)" & _
            " FROM  PrTxTrxnHeader INNER JOIN" & _
            " PrTxTrxnLines ON " & _
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
            " PrMsContributionCodes ON " & _
            " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code" & _
            " WHERE  (PrMsContributionCodes.ConTyp_Code = 'EX') "
        '" AND (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

        StrX = StrX & Str2X & Str

        Return GetData(StrX)

    End Function

    ''' ''''''
    Protected Function REPORT_IR61_Gesy_DEDUCTION(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String

        '''''''''''''''''''''''''''' NEW PART ''''''''''''''''''''''''''''''''''''''''''''
        Dim strPerGroupCode As String
        Dim strTempGroupCode As String
        Dim strPerCode As String

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)
        Ds = Me.GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(SIPeriod.Code, TemGrp.CompanyCode, PerGrp.Year)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                strTempGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(0)))
                strPerGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(1)))
                strPerCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(2)))
                If i = 0 Then
                    Str = Str & " AND ( "
                Else
                    Str = Str & " OR "
                End If
                Str = Str & "( PrTxTrxnHeader.TemGrp_Code = " & strTempGroupCode & " AND  PrTxTrxnHeader.PrdGrp_Code = " & strPerGroupCode & " AND  PrTxTrxnHeader.PrdCod_Code = " & strPerCode & " )"
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If
        '''''''''''''''''''''''' ENd OF NEW PART ''''''''''''''''''''''''''''''''''''''''''''''''




        ''''''''''''''''' OLD ''''''''''''''''''''''''''''
        'Ds = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, PerGrp.TemGrpCode, PerGrp.Code)
        'If CheckDataSet(Ds) Then
        '    Last = Ds.Tables(0).Rows.Count - 1
        '    For i = 0 To Ds.Tables(0).Rows.Count - 1
        '        PerCode = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
        '        If i = 0 Then
        '            Str = Str & " AND ( "
        '        Else
        '            Str = Str & " OR "
        '        End If
        '        Str = Str & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
        '        If i = Last Then
        '            Str = Str & " )"
        '        End If

        '    Next
        'End If

        'Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)


        ''''''
        'Dim StrXX
        'StrXX = " Select TemGrp_Code from PrMsTemplateGroup" & _
        '            " Where com_code=" & enQuoteString(TemGrp.CompanyCode)
        'Dim DsT As DataSet
        'Dim DsPG As DataSet

        'DsT = GetData(StrXX)
        'Dim Str2X As String
        'Dim StrZ As String
        'Dim Code As String
        'Dim PeriodGroupCode As String = ""

        'If CheckDataSet(DsT) Then

        '    Dim z As Integer

        '    For z = 0 To DsT.Tables(0).Rows.Count - 1
        '        Code = DbNullToString(DsT.Tables(0).Rows(z).Item(0))
        '        StrXX = "SELECT PRDGRP_CODE FROM PRMSPERIODGROUPS" & _
        '              " WHERE TEMGRP_CODE=" & enQuoteString(Code) & _
        '        " AND PrdGpr_Year=" & enQuoteString(PerGrp.Year)
        '        DsPG = GetData(StrXX)
        '        If CheckDataSet(DsPG) Then
        '            PeriodGroupCode = DbNullToString(DsPG.Tables(0).Rows(0).Item(0))
        '        End If

        '        If z = 0 Then
        '            Str2X = " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
        '            'Str3X = " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
        '        Else
        '            Str2X = Str2X & " OR  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
        '            'Str3X = Str3X & " OR (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
        '        End If
        '    Next
        '    Str2X = "AND (" & Str2X & ")"
        '    'Str3X = "AND (" & Str3X & ")"
        'End If

        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        'If CheckDataSet(DsPG) Then
        '    Dim DsZ As DataSet
        '    DsZ = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, Code, PeriodGroupCode)
        '    If CheckDataSet(DsZ) Then
        '        Last = DsZ.Tables(0).Rows.Count - 1
        '        For i = 0 To DsZ.Tables(0).Rows.Count - 1
        '            PerCode = DbNullToString(DsZ.Tables(0).Rows(i).Item(0))
        '            If i = 0 Then
        '                StrZ = StrZ & " AND ( "
        '            Else
        '                StrZ = StrZ & " OR "
        '            End If
        '            StrZ = StrZ & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
        '            If i = Last Then
        '                StrZ = StrZ & " )"
        '            End If

        '        Next
        '    End If
        'End If
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

        'END Of OLD ''''''






        StrX = " SELECT SUM( PrTxTrxnLines.TrxLin_PeriodValue)" &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsDeductionCodes ON " &
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" &
            " WHERE  (PrMsDeductionCodes.DedTyp_Code = 'GT') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_IsDirector <> '1'))"

        '  StrX = StrX & Str2X & Str & StrZ
        StrX = StrX & Str

        Return GetData(StrX)

    End Function
    Protected Function REPORT_IR61_Gesy_DEDUCTION_PerEmployee(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String

        '''''''''''''''''''''''''''' NEW PART ''''''''''''''''''''''''''''''''''''''''''''
        Dim strPerGroupCode As String
        Dim strTempGroupCode As String
        Dim strPerCode As String

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)
        Ds = Me.GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(SIPeriod.Code, TemGrp.CompanyCode, PerGrp.Year)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                strTempGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(0)))
                strPerGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(1)))
                strPerCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(2)))
                If i = 0 Then
                    Str = Str & " AND ( "
                Else
                    Str = Str & " OR "
                End If
                Str = Str & "( PrTxTrxnHeader.TemGrp_Code = " & strTempGroupCode & " AND  PrTxTrxnHeader.PrdGrp_Code = " & strPerGroupCode & " AND  PrTxTrxnHeader.PrdCod_Code = " & strPerCode & " )"
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If

        StrX = " SELECT PrTxTrxnHeader.Emp_Code, " &
            " PrTxTrxnLines.TrxLin_PeriodValue" &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsDeductionCodes ON " &
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" &
            " WHERE  (PrMsDeductionCodes.DedTyp_Code = 'GT') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_IsDirector <> '1'))"

        '  StrX = StrX & Str2X & Str & StrZ
        StrX = StrX & Str & " Order by PrTxtrxnHeader.emp_Code ASC"

        Return GetData(StrX)
    End Function
    Protected Function REPORT_IR61_Gesy_CONTRIBUTION_LWBPen(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String


        '''''''''''''''''''''''''''' NEW PART ''''''''''''''''''''''''''''''''''''''''''''
        Dim strPerGroupCode As String
        Dim strTempGroupCode As String
        Dim strPerCode As String

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)
        Ds = Me.GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(SIPeriod.Code, TemGrp.CompanyCode, PerGrp.Year)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                strTempGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(0)))
                strPerGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(1)))
                strPerCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(2)))
                If i = 0 Then
                    Str = Str & " AND ( "
                Else
                    Str = Str & " OR "
                End If
                Str = Str & "( PrTxTrxnHeader.TemGrp_Code = " & strTempGroupCode & " AND  PrTxTrxnHeader.PrdGrp_Code = " & strPerGroupCode & " AND  PrTxTrxnHeader.PrdCod_Code = " & strPerCode & " )"
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If
        '''''''''''''''''''''''' ENd OF NEW PART ''''''''''''''''''''''''''''''''''''''''''''''''



        ''''''''''''' OLD '''''''''''''''

        'Ds = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, PerGrp.TemGrpCode, PerGrp.Code)
        'If CheckDataSet(Ds) Then
        '    Last = Ds.Tables(0).Rows.Count - 1
        '    For i = 0 To Ds.Tables(0).Rows.Count - 1
        '        PerCode = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
        '        If i = 0 Then
        '            Str = Str & " AND ( "
        '        Else
        '            Str = Str & " OR "
        '        End If
        '        Str = Str & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
        '        If i = Last Then
        '            Str = Str & " )"
        '        End If

        '    Next
        'End If

        'Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)


        ''''''
        'Dim StrXX
        'StrXX = " Select TemGrp_Code from PrMsTemplateGroup" & _
        '            " Where com_code=" & enQuoteString(TemGrp.CompanyCode)
        'Dim DsT As DataSet
        'Dim DsPG As DataSet

        'DsT = GetData(StrXX)
        'Dim Str2X As String
        'Dim StrZ As String = ""
        'Dim Code As String

        'Dim PeriodGroupCode As String = ""
        'If CheckDataSet(DsT) Then

        '    Dim z As Integer

        '    For z = 0 To DsT.Tables(0).Rows.Count - 1
        '        Code = DbNullToString(DsT.Tables(0).Rows(z).Item(0))
        '        StrXX = "SELECT PRDGRP_CODE FROM PRMSPERIODGROUPS" & _
        '              " WHERE TEMGRP_CODE=" & enQuoteString(Code) & _
        '        " AND PrdGpr_Year=" & enQuoteString(PerGrp.Year)
        '        DsPG = GetData(StrXX)
        '        If CheckDataSet(DsPG) Then
        '            PeriodGroupCode = DbNullToString(DsPG.Tables(0).Rows(0).Item(0))
        '        End If

        '        If z = 0 Then
        '            Str2X = " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
        '            'Str3X = " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
        '        Else
        '            Str2X = Str2X & " OR  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
        '            'Str3X = Str3X & " OR (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
        '        End If
        '    Next
        '    Str2X = "AND (" & Str2X & ")"
        '    'Str3X = "AND (" & Str3X & ")"
        'End If


        ''''''
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        'If CheckDataSet(DsPG) Then
        '    Dim DsZ As DataSet
        '    DsZ = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, Code, PeriodGroupCode)
        '    If CheckDataSet(DsZ) Then
        '        Last = DsZ.Tables(0).Rows.Count - 1
        '        For i = 0 To DsZ.Tables(0).Rows.Count - 1
        '            PerCode = DbNullToString(DsZ.Tables(0).Rows(i).Item(0))
        '            If i = 0 Then
        '                StrZ = StrZ & " AND ( "
        '            Else
        '                StrZ = StrZ & " OR "
        '            End If
        '            StrZ = StrZ & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
        '            If i = Last Then
        '                StrZ = StrZ & " )"
        '            End If

        '        Next
        '    End If
        'End If
        '''' END Of OLD




        StrX = " SELECT SUM( PrTxTrxnLines.TrxLin_PeriodValue)" &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsDeductionCodes ON " &
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" &
            " WHERE  (PrMsDeductionCodes.DedTyp_Code = 'GD') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_LWBPen='1'))"

        'StrX = StrX & Str2X & Str & StrZ

        StrX = StrX & Str
        Return GetData(StrX)

    End Function
    Protected Function REPORT_IR61_Gesy_CONTRIBUTION_LWBPen_PerEmployee(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String


        '''''''''''''''''''''''''''' NEW PART ''''''''''''''''''''''''''''''''''''''''''''
        Dim strPerGroupCode As String
        Dim strTempGroupCode As String
        Dim strPerCode As String

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)
        Ds = Me.GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(SIPeriod.Code, TemGrp.CompanyCode, PerGrp.Year)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                strTempGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(0)))
                strPerGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(1)))
                strPerCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(2)))
                If i = 0 Then
                    Str = Str & " AND ( "
                Else
                    Str = Str & " OR "
                End If
                Str = Str & "( PrTxTrxnHeader.TemGrp_Code = " & strTempGroupCode & " AND  PrTxTrxnHeader.PrdGrp_Code = " & strPerGroupCode & " AND  PrTxTrxnHeader.PrdCod_Code = " & strPerCode & " )"
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If


        StrX = " SELECT PrTxTrxnHeader.Emp_Code, " &
            " PrTxTrxnLines.TrxLin_PeriodValue " &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsDeductionCodes ON " &
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" &
            " WHERE  (PrMsDeductionCodes.DedTyp_Code = 'GD') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_LWBPen='1'))"

        'StrX = StrX & Str2X & Str & StrZ

        StrX = StrX & Str & " Order by PrTxtrxnHeader.emp_Code ASC"
        Return GetData(StrX)

    End Function
    Protected Function REPORT_IR61_Gesy_CONTRIBUTION_Directors(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String

        '''''''''''''''''''''''''''' NEW PART ''''''''''''''''''''''''''''''''''''''''''''
        Dim strPerGroupCode As String
        Dim strTempGroupCode As String
        Dim strPerCode As String

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)
        Ds = Me.GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(SIPeriod.Code, TemGrp.CompanyCode, PerGrp.Year)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                strTempGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(0)))
                strPerGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(1)))
                strPerCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(2)))
                If i = 0 Then
                    Str = Str & " AND ( "
                Else
                    Str = Str & " OR "
                End If
                Str = Str & "( PrTxTrxnHeader.TemGrp_Code = " & strTempGroupCode & " AND  PrTxTrxnHeader.PrdGrp_Code = " & strPerGroupCode & " AND  PrTxTrxnHeader.PrdCod_Code = " & strPerCode & " )"
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If
        '''''''''''''''''''''''' ENd OF NEW PART ''''''''''''''''''''''''''''''''''''''''''''''''



        '''' OLD

        'Ds = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, PerGrp.TemGrpCode, PerGrp.Code)
        'If CheckDataSet(Ds) Then
        '    Last = Ds.Tables(0).Rows.Count - 1
        '    For i = 0 To Ds.Tables(0).Rows.Count - 1
        '        PerCode = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
        '        If i = 0 Then
        '            Str = Str & " AND ( "
        '        Else
        '            Str = Str & " OR "
        '        End If
        '        Str = Str & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
        '        If i = Last Then
        '            Str = Str & " )"
        '        End If

        '    Next
        'End If

        'Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)


        ''''''
        'Dim StrXX
        'StrXX = " Select TemGrp_Code from PrMsTemplateGroup" & _
        '            " Where com_code=" & enQuoteString(TemGrp.CompanyCode)
        'Dim DsT As DataSet
        'Dim DsPG As DataSet

        'DsT = GetData(StrXX)
        'Dim Str2X As String
        'Dim StrZ As String = ""
        'Dim Code As String
        'Dim PeriodGroupCode As String = ""

        'If CheckDataSet(DsT) Then

        '    Dim z As Integer

        '    For z = 0 To DsT.Tables(0).Rows.Count - 1
        '        Code = DbNullToString(DsT.Tables(0).Rows(z).Item(0))
        '        StrXX = "SELECT PRDGRP_CODE FROM PRMSPERIODGROUPS" & _
        '              " WHERE TEMGRP_CODE=" & enQuoteString(Code) & _
        '        " AND PrdGpr_Year=" & enQuoteString(PerGrp.Year)
        '        DsPG = GetData(StrXX)
        '        If CheckDataSet(DsPG) Then
        '            PeriodGroupCode = DbNullToString(DsPG.Tables(0).Rows(0).Item(0))
        '        End If

        '        If z = 0 Then
        '            Str2X = " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
        '            'Str3X = " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
        '        Else
        '            Str2X = Str2X & " OR  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
        '            'Str3X = Str3X & " OR (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
        '        End If
        '    Next
        '    Str2X = "AND (" & Str2X & ")"
        '    'Str3X = "AND (" & Str3X & ")"
        'End If

        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        'If CheckDataSet(DsPG) Then
        '    Dim DsZ As DataSet
        '    DsZ = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, Code, PeriodGroupCode)
        '    If CheckDataSet(DsZ) Then
        '        Last = DsZ.Tables(0).Rows.Count - 1
        '        For i = 0 To DsZ.Tables(0).Rows.Count - 1
        '            PerCode = DbNullToString(DsZ.Tables(0).Rows(i).Item(0))
        '            If i = 0 Then
        '                StrZ = StrZ & " AND ( "
        '            Else
        '                StrZ = StrZ & " OR "
        '            End If
        '            StrZ = StrZ & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
        '            If i = Last Then
        '                StrZ = StrZ & " )"
        '            End If

        '        Next
        '    End If
        'End If

        ''''''ODL'




        StrX = " SELECT SUM( PrTxTrxnLines.TrxLin_PeriodValue)" &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsContributionCodes ON " &
            " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code" &
            " WHERE  (PrMsContributionCodes.ConTyp_Code = 'BC') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_IsDirector='1'))"

        'StrX = StrX & Str2X & Str & StrZ

        StrX = StrX & Str
        Return GetData(StrX)

    End Function
    Protected Function REPORT_IR61_Gesy_CONTRIBUTION_Directors_PerEmployee(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String

        '''''''''''''''''''''''''''' NEW PART ''''''''''''''''''''''''''''''''''''''''''''
        Dim strPerGroupCode As String
        Dim strTempGroupCode As String
        Dim strPerCode As String

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)
        Ds = Me.GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(SIPeriod.Code, TemGrp.CompanyCode, PerGrp.Year)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                strTempGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(0)))
                strPerGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(1)))
                strPerCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(2)))
                If i = 0 Then
                    Str = Str & " AND ( "
                Else
                    Str = Str & " OR "
                End If
                Str = Str & "( PrTxTrxnHeader.TemGrp_Code = " & strTempGroupCode & " AND  PrTxTrxnHeader.PrdGrp_Code = " & strPerGroupCode & " AND  PrTxTrxnHeader.PrdCod_Code = " & strPerCode & " )"
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If
        '''''''''''''''''''''''' ENd OF NEW PART ''''''''''''''''''''''''''''''''''''''''''''''''



        StrX = " SELECT PrTxTrxnHeader.Emp_Code, " &
            " PrTxTrxnLines.TrxLin_PeriodValue " &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsContributionCodes ON " &
            " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code" &
            " WHERE  (PrMsContributionCodes.ConTyp_Code = 'BC') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_IsDirector='1'))"

        StrX = StrX & Str & " Order by PrTxtrxnHeader.emp_Code ASC"
        Return GetData(StrX)

    End Function
    Protected Function REPORT_IR61_Gesy_DEDUCTION_Directors(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String


        '''''''''''''''''''''''''''' NEW PART ''''''''''''''''''''''''''''''''''''''''''''
        Dim strPerGroupCode As String
        Dim strTempGroupCode As String
        Dim strPerCode As String

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)
        Ds = Me.GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(SIPeriod.Code, TemGrp.CompanyCode, PerGrp.Year)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                strTempGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(0)))
                strPerGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(1)))
                strPerCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(2)))
                If i = 0 Then
                    Str = Str & " AND ( "
                Else
                    Str = Str & " OR "
                End If
                Str = Str & "( PrTxTrxnHeader.TemGrp_Code = " & strTempGroupCode & " AND  PrTxTrxnHeader.PrdGrp_Code = " & strPerGroupCode & " AND  PrTxTrxnHeader.PrdCod_Code = " & strPerCode & " )"
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If
        '''''''''''''''''''''''' ENd OF NEW PART ''''''''''''''''''''''''''''''''''''''''''''''''



        ''''''''''''''''''''''''''''''''''' OLD

        'Ds = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, PerGrp.TemGrpCode, PerGrp.Code)
        'If CheckDataSet(Ds) Then
        '    Last = Ds.Tables(0).Rows.Count - 1
        '    For i = 0 To Ds.Tables(0).Rows.Count - 1
        '        PerCode = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
        '        If i = 0 Then
        '            Str = Str & " AND ( "
        '        Else
        '            Str = Str & " OR "
        '        End If
        '        Str = Str & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
        '        If i = Last Then
        '            Str = Str & " )"
        '        End If

        '    Next
        'End If

        'Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)


        ''''''
        'Dim StrXX
        'StrXX = " Select TemGrp_Code from PrMsTemplateGroup" & _
        '            " Where com_code=" & enQuoteString(TemGrp.CompanyCode)
        'Dim DsT As DataSet
        'Dim DsPG As DataSet

        'DsT = GetData(StrXX)
        'Dim Str2X As String
        'Dim StrZ As String = ""
        'Dim Code As String
        'Dim PeriodGroupCode As String = ""


        'If CheckDataSet(DsT) Then
        '    Dim z As Integer

        '    For z = 0 To DsT.Tables(0).Rows.Count - 1
        '        Code = DbNullToString(DsT.Tables(0).Rows(z).Item(0))
        '        StrXX = "SELECT PRDGRP_CODE FROM PRMSPERIODGROUPS" & _
        '              " WHERE TEMGRP_CODE=" & enQuoteString(Code) & _
        '        " AND PrdGpr_Year=" & enQuoteString(PerGrp.Year)
        '        DsPG = GetData(StrXX)
        '        If CheckDataSet(DsPG) Then
        '            PeriodGroupCode = DbNullToString(DsPG.Tables(0).Rows(0).Item(0))
        '        End If

        '        If z = 0 Then
        '            Str2X = " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
        '            'Str3X = " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
        '        Else
        '            Str2X = Str2X & " OR  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
        '            'Str3X = Str3X & " OR (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
        '        End If
        '    Next
        '    Str2X = "AND (" & Str2X & ")"
        '    'Str3X = "AND (" & Str3X & ")"
        'End If


        ''''''
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        'If CheckDataSet(DsPG) Then
        '    Dim DsZ As DataSet
        '    DsZ = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, Code, PeriodGroupCode)
        '    If CheckDataSet(DsZ) Then
        '        Last = DsZ.Tables(0).Rows.Count - 1
        '        For i = 0 To DsZ.Tables(0).Rows.Count - 1
        '            PerCode = DbNullToString(DsZ.Tables(0).Rows(i).Item(0))
        '            If i = 0 Then
        '                StrZ = StrZ & " AND ( "
        '            Else
        '                StrZ = StrZ & " OR "
        '            End If
        '            StrZ = StrZ & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
        '            If i = Last Then
        '                StrZ = StrZ & " )"
        '            End If

        '        Next
        '    End If
        'End If
        ''''''' OLD




        StrX = " SELECT SUM( PrTxTrxnLines.TrxLin_PeriodValue)" &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsDeductionCodes ON " &
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" &
            " WHERE  (PrMsDeductionCodes.DedTyp_Code = 'GT') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_IsDirector='1'))"

        'StrX = StrX & Str2X & Str & StrZ
        StrX = StrX & Str
        Return GetData(StrX)

    End Function
    Protected Function REPORT_IR61_Gesy_DEDUCTION_Directors_PerEmployee(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String


        '''''''''''''''''''''''''''' NEW PART ''''''''''''''''''''''''''''''''''''''''''''
        Dim strPerGroupCode As String
        Dim strTempGroupCode As String
        Dim strPerCode As String

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)
        Ds = Me.GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(SIPeriod.Code, TemGrp.CompanyCode, PerGrp.Year)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                strTempGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(0)))
                strPerGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(1)))
                strPerCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(2)))
                If i = 0 Then
                    Str = Str & " AND ( "
                Else
                    Str = Str & " OR "
                End If
                Str = Str & "( PrTxTrxnHeader.TemGrp_Code = " & strTempGroupCode & " AND  PrTxTrxnHeader.PrdGrp_Code = " & strPerGroupCode & " AND  PrTxTrxnHeader.PrdCod_Code = " & strPerCode & " )"
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If



        StrX = " SELECT PrTxTrxnHeader.Emp_Code, " &
            " PrTxTrxnLines.TrxLin_PeriodValue " &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsDeductionCodes ON " &
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" &
            " WHERE  (PrMsDeductionCodes.DedTyp_Code = 'GT') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_IsDirector='1'))"

        'StrX = StrX & Str2X & Str & StrZ
        StrX = StrX & Str & " Order by PrTxtrxnHeader.emp_Code ASC"
        Return GetData(StrX)

    End Function
    Protected Function REPORT_IR61_Gesy_CONTRIBUTION(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String

        '''''''''''''''''''''''''''' NEW PART ''''''''''''''''''''''''''''''''''''''''''''
        Dim strPerGroupCode As String
        Dim strTempGroupCode As String
        Dim strPerCode As String

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)
        Ds = Me.GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(SIPeriod.Code, TemGrp.CompanyCode, PerGrp.Year)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                strTempGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(0)))
                strPerGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(1)))
                strPerCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(2)))
                If i = 0 Then
                    Str = Str & " AND ( "
                Else
                    Str = Str & " OR "
                End If
                Str = Str & "( PrTxTrxnHeader.TemGrp_Code = " & strTempGroupCode & " AND  PrTxTrxnHeader.PrdGrp_Code = " & strPerGroupCode & " AND  PrTxTrxnHeader.PrdCod_Code = " & strPerCode & " )"
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If
        '''''''''''''''''''''''' ENd OF NEW PART ''''''''''''''''''''''''''''''''''''''''''''''''



        ''''''''''''''''''''' OLD ''''''''''''''''''''''''''''''
        'Ds = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, PerGrp.TemGrpCode, PerGrp.Code)
        'If CheckDataSet(Ds) Then
        '    Last = Ds.Tables(0).Rows.Count - 1
        '    For i = 0 To Ds.Tables(0).Rows.Count - 1
        '        PerCode = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
        '        If i = 0 Then
        '            Str = Str & " AND ( "
        '        Else
        '            Str = Str & " OR "
        '        End If
        '        Str = Str & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
        '        If i = Last Then
        '            Str = Str & " )"
        '        End If

        '    Next
        'End If

        'Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)


        ''''''
        'Dim StrXX
        'StrXX = " Select TemGrp_Code from PrMsTemplateGroup" & _
        '            " Where com_code=" & enQuoteString(TemGrp.CompanyCode)
        'Dim DsT As DataSet
        'Dim DsPG As DataSet

        'DsT = GetData(StrXX)
        'Dim Str2X As String
        'Dim StrZ As String = ""
        'Dim Code As String = ""
        'Dim PeriodGroupCode As String = ""

        'If CheckDataSet(DsT) Then

        '    Dim z As Integer

        '    For z = 0 To DsT.Tables(0).Rows.Count - 1
        '        Code = DbNullToString(DsT.Tables(0).Rows(z).Item(0))
        '        StrXX = "SELECT PRDGRP_CODE FROM PRMSPERIODGROUPS" & _
        '              " WHERE TEMGRP_CODE=" & enQuoteString(Code) & _
        '        " AND PrdGpr_Year=" & enQuoteString(PerGrp.Year)
        '        DsPG = GetData(StrXX)
        '        If CheckDataSet(DsPG) Then
        '            PeriodGroupCode = DbNullToString(DsPG.Tables(0).Rows(0).Item(0))
        '        End If

        '        If z = 0 Then
        '            Str2X = " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
        '            'Str3X = " (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
        '        Else
        '            Str2X = Str2X & " OR  (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(Code) & ")"
        '            'Str3X = Str3X & " OR (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"
        '        End If
        '    Next
        '    Str2X = "AND (" & Str2X & ")"
        '    'Str3X = "AND (" & Str3X & ")"
        'End If


        ''''''
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        'If CheckDataSet(DsPG) Then
        '    Dim DsZ As DataSet
        '    DsZ = Me.GetAllPeriodsOF_SIPeriod(SIPeriod.Code, Code, PeriodGroupCode)
        '    If CheckDataSet(DsZ) Then
        '        Last = DsZ.Tables(0).Rows.Count - 1
        '        For i = 0 To DsZ.Tables(0).Rows.Count - 1
        '            PerCode = DbNullToString(DsZ.Tables(0).Rows(i).Item(0))
        '            If i = 0 Then
        '                StrZ = StrZ & " AND ( "
        '            Else
        '                StrZ = StrZ & " OR "
        '            End If
        '            StrZ = StrZ & "PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
        '            If i = Last Then
        '                StrZ = StrZ & " )"
        '            End If

        '        Next
        '    End If
        'End If
        ''''''''''''''''''''''''''OLD ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

        '''''''''''




        StrX = " SELECT SUM( PrTxTrxnLines.TrxLin_PeriodValue)" &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsContributionCodes ON " &
            " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code" &
            " WHERE  (PrMsContributionCodes.ConTyp_Code = 'BC') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_IsDirector<>'1'))"

        ' StrX = StrX & Str2X & Str & StrZ
        StrX = StrX & Str

        Return GetData(StrX)

    End Function
    Protected Function REPORT_IR61_Gesy_CONTRIBUTION_PerEmployee(ByVal PerGrp As cPrMsPeriodGroups, ByVal SIPeriod As cPrSsSocialInsPeriods) As DataSet
        Dim Str As String = ""
        Dim StrX As String
        Dim Last As Integer
        Dim Ds As DataSet
        Dim i As Integer
        Dim PerCode As String

        '''''''''''''''''''''''''''' NEW PART ''''''''''''''''''''''''''''''''''''''''''''
        Dim strPerGroupCode As String
        Dim strTempGroupCode As String
        Dim strPerCode As String

        Dim TemGrp As New cPrMsTemplateGroup(PerGrp.TemGrpCode)
        Ds = Me.GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(SIPeriod.Code, TemGrp.CompanyCode, PerGrp.Year)
        If CheckDataSet(Ds) Then
            Last = Ds.Tables(0).Rows.Count - 1
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                strTempGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(0)))
                strPerGroupCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(1)))
                strPerCode = enQuoteString(DbNullToString(Ds.Tables(0).Rows(i).Item(2)))
                If i = 0 Then
                    Str = Str & " AND ( "
                Else
                    Str = Str & " OR "
                End If
                Str = Str & "( PrTxTrxnHeader.TemGrp_Code = " & strTempGroupCode & " AND  PrTxTrxnHeader.PrdGrp_Code = " & strPerGroupCode & " AND  PrTxTrxnHeader.PrdCod_Code = " & strPerCode & " )"
                If i = Last Then
                    Str = Str & " )"
                End If

            Next
        End If



         StrX = " Select PrTxTrxnHeader.Emp_Code, " & _
            "  PrTxTrxnLines.TrxLin_PeriodValue" &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines On " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsContributionCodes On " &
            " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code" &
            " WHERE  (PrMsContributionCodes.ConTyp_Code = 'BC') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_IsDirector<>'1'))"

        ' StrX = StrX & Str2X & Str & StrZ
        StrX = StrX & Str & " Order by PrTxtrxnHeader.emp_Code ASC"

        Return GetData(StrX)

    End Function

    '''
    Protected Function GetSumsOfEmployeeDeductions_IR7(ByVal DedType As String, ByVal EmpCode As String, ByVal PerGrpString As String) As DataSet
        Dim Str As String
        Str = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            " FROM PrTxTrxnHeader INNER JOIN" & _
            " PrTxTrxnLines ON" & _
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
            " PrMsDeductionCodes ON" & _
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN" & _
            " PrSsDeductionTypes ON" & _
            " PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code" & _
            " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (PrSsDeductionTypes.DedTyp_Code = " & enQuoteString(DedType) & ")"
        Str = Str & PerGrpString

        Return MyBase.GetData(Str)
    End Function
    Protected Function GetEmployeeMF_For_IR7(ByVal EmpCode As String, ByVal PerGrpString As String) As DataSet
        Dim Str As String = ""

        PerGrpString = PerGrpString.Replace("PrdGrp_Code", "PrTxTrxnheader.PrdGrp_Code")

        Str = "SELECT PrTxTrxnHeader.TrxHdr_Medical, PrTxIr59.Act_MFLimit " & _
        " FROM  PrTxTrxnHeader INNER JOIN " & _
        " PrTxIr59 ON PrTxTrxnHeader.TrxHdr_Id = PrTxIr59.Trxhdr_id " & _
        " where PrTxTrxnHeader.Trxhdr_id in " & _
        " (select max(Trxhdr_id) from PrTxTrxnHeader where Emp_Code =" & enQuoteString(EmpCode)
        Str = Str & PerGrpString & ") "

        Return MyBase.GetData(Str)
    End Function
    Protected Function GetSumsOfEmployeeDiscounts_IR7(ByVal EmpCode As String, ByVal PerGrpString As String) As DataSet
        Dim Str As String
        Str = " SELECT EmpDis_Discount1+ " & _
        " EmpDis_Discount2+ " & _
        " EmpDis_Discount3+ " & _
        " EmpDis_Discount4+ " & _
        " EmpDis_Discount5+ " & _
        " EmpDis_Discount6+ " & _
        " EmpDis_Discount7+ " & _
        " EmpDis_Discount8+ " & _
        " EmpDis_Discount9+ " & _
        " EmpDis_Discount10+ " & _
        " EmpDis_LifeInsurance " & _
        " FROM PrTxEmployeeDiscounts " & _
        " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"

        Str = Str & PerGrpString

        Return MyBase.GetData(Str)
    End Function
    Protected Function GetSumsOfEmployeeDeductions(ByVal DedType As String, ByVal EmpCode As String, ByVal PerGrpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            " FROM PrTxTrxnHeader INNER JOIN" & _
            " PrTxTrxnLines ON" & _
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
            " PrMsDeductionCodes ON" & _
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN" & _
            " PrSsDeductionTypes ON" & _
            " PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code" & _
            " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            " AND (PrSsDeductionTypes.DedTyp_Code = " & enQuoteString(DedType) & ")"
        Return MyBase.GetData(Str)
    End Function
    
    Protected Function GetSumsOfEmployeeContributions(ByVal ConType As String, ByVal EmpCode As String, ByVal PerGrpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            " FROM PrTxTrxnHeader INNER JOIN" & _
            " PrTxTrxnLines ON" & _
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
            " PrMsContributionCodes ON" & _
            " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code INNER JOIN" & _
            " PrSsContributionTypes ON" & _
            " PrMsContributionCodes.ConTyp_Code = PrSsContributionTypes.ConTyp_Code" & _
            " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrpCode) & ")" & _
            " AND (PrSsContributionTypes.ConTyp_Code = " & enQuoteString(ConType) & ")"
        Return MyBase.GetData(Str)
    End Function
    Protected Function GetSumsOfEmployeeDeductionsPerString(ByVal DedType As String, ByVal EmpCode As String, ByVal PerGrpString As String) As DataSet
        Dim Str As String
        Str = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            " FROM PrTxTrxnHeader INNER JOIN" & _
            " PrTxTrxnLines ON" & _
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
            " PrMsDeductionCodes ON" & _
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN" & _
            " PrSsDeductionTypes ON" & _
            " PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code" & _
            " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (PrSsDeductionTypes.DedTyp_Code = " & enQuoteString(DedType) & ")"

        Str = Str & PerGrpString
        Return MyBase.GetData(Str)
    End Function

    Protected Function GetSumsOfEmployeeContributionsPerString(ByVal ConType As String, ByVal EmpCode As String, ByVal PerGrpString As String) As DataSet
        Dim Str As String
        Str = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" & _
            " FROM PrTxTrxnHeader INNER JOIN" & _
            " PrTxTrxnLines ON" & _
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
            " PrMsContributionCodes ON" & _
            " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code INNER JOIN" & _
            " PrSsContributionTypes ON" & _
            " PrMsContributionCodes.ConTyp_Code = PrSsContributionTypes.ConTyp_Code" & _
            " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (PrSsContributionTypes.ConTyp_Code = " & enQuoteString(ConType) & ")"

        Str = Str & PerGrpString
        Return MyBase.GetData(Str)
    End Function


    Protected Function GetPeriodDetails(ByVal Per As cPrMsPeriodCodes) As DataSet
        Dim Str As String
        Str = " SELECT" & _
                " PrdCod_Code," & _
                " PrdGrp_Code," & _
                " PrdCod_Status," & _
                " PrdCod_Number," & _
                " PrdCod_DescriptionL," & _
                " PrdCod_DescriptionS," & _
                " PrdCod_Sequence," & _
                " SinPrd_Code," & _
                " PrdCod_DateFrom," & _
                " PrdCod_DateTo," & _
                " PrdCod_PeriodUnits," & _
                " PayCat_Code," & _
                " PrdCod_PeriodUnits2 " & _
            "  FROM PrMsPeriodCodes" & _
            "  WHERE PrdCod_Code = " & enQuoteString(Per.Code) & _
            "  AND PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode)
        Return MyBase.GetData(Str)
    End Function
    Protected Function GetERNFromTrxnLinesFor(ByVal Per As cPrMsPeriodCodes, ByVal EarningType As String) As DataSet
        Dim Str As String

        Str = " SELECT  PrTxTrxnHeader.Emp_Code," & _
            " PrTxTrxnLines.ErnCod_Code," & _
            " PrTxTrxnLines.TrxLin_PeriodValue," & _
            " PrMsEarningCodes.ErnTyp_Code," & _
            " PrTxTrxnHeader.PrdGrp_Code, " & _
            " PrTxTrxnHeader.PrdCod_Code" & _
            " FROM  PrTxTrxnLines INNER JOIN" & _
            " PrTxTrxnHeader ON " & _
            " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            " PrMsEarningCodes ON" & _
            " PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            " WHERE (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(Per.Code) & ")" & _
            " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")" & _
            " AND (PrMsEarningCodes.ErnTyp_Code = " & enQuoteString(EarningType) & ")"

        Return GetData(Str)
    End Function
    Protected Function GetSUM_Of_ERN_FromTrxnLinesFor(ByVal Per As cPrMsPeriodCodes, ByVal EarningType As String, ByVal EmpCode As String) As Double
        Dim Str As String
        Dim D As Double = 0

        Str = " SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue) " & _
            " FROM  PrTxTrxnLines INNER JOIN" & _
            " PrTxTrxnHeader ON " & _
            " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            " PrMsEarningCodes ON" & _
            " PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" & _
            " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")" & _
            " AND (PrMsEarningCodes.ErnTyp_Code = " & enQuoteString(EarningType) & ")"
        Dim Ds As DataSet

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            d = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return d
    End Function
    Protected Function GetSUM_Of_GESIABLE_FromTrxnHeaderFor(ByVal Per As cPrMsPeriodCodes, ByVal EmpCode As String) As Double
        Dim Str As String
        Dim D As Double = 0

        Str = "select SUM(TrxHdr_Gesiableamount) from prtxtrxnheader" & _
        " where (Emp_Code=" & enQuoteString(EmpCode) & ")" & _
        " and (PrdGrp_Code =" & enQuoteString(Per.PrdGrpCode) & ")"

        Dim Ds As DataSet

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            D = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return D
    End Function
    Protected Function GetERNFromTrxnLinesFor_New14(ByVal Per As cPrMsPeriodCodes, ByVal EarningType As String, ByVal SIPeriodCode As String) As DataSet
        Dim Str As String

        Str = " SELECT  PrTxTrxnHeader.Emp_Code," & _
            " PrTxTrxnLines.ErnCod_Code," & _
            " PrTxTrxnLines.TrxLin_PeriodValue," & _
            " PrMsEarningCodes.ErnTyp_Code," & _
            " PrTxTrxnHeader.PrdGrp_Code, " & _
            " PrTxTrxnHeader.PrdCod_Code" & _
            " FROM  PrTxTrxnLines INNER JOIN" & _
            " PrTxTrxnHeader ON " & _
            " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            " PrMsEarningCodes ON" & _
            " PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            " WHERE (PrTxTrxnHeader.PrdCod_Code in " & _
            " (Select PrdCod_Code  from PrMsPeriodCodes where PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & _
            " AND SinPrd_Code  =" & enQuoteString(SIPeriodCode) & "))" & _
            " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")" & _
            " AND (PrMsEarningCodes.ErnTyp_Code = " & enQuoteString(EarningType) & ")"

        Return GetData(Str)
    End Function
    Protected Function GetDEDFromTrxnLinesFor(ByVal Per As cPrMsPeriodCodes, ByVal DeductionType As String) As DataSet
        Dim Str As String

        Str = " SELECT  PrTxTrxnHeader.Emp_Code," & _
            " PrTxTrxnLines.DedCod_Code," & _
            " PrTxTrxnLines.TrxLin_PeriodValue," & _
            " PrMsDeductionCodes.DedTyp_Code," & _
            " PrTxTrxnHeader.PrdGrp_Code, " & _
            " PrTxTrxnHeader.PrdCod_Code" & _
            " FROM  PrTxTrxnLines INNER JOIN" & _
            " PrTxTrxnHeader ON " & _
            " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            " PrMsDeductionCodes ON" & _
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
            " WHERE (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(Per.Code) & ")" & _
            " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")" & _
            " AND (PrMsDeductionCodes.DedTyp_Code = " & enQuoteString(DeductionType) & ")"

        Return GetData(Str)
    End Function
    Protected Function GetCONFromTrxnLinesFor(ByVal Per As cPrMsPeriodCodes, ByVal ContributionType As String) As DataSet
        Dim Str As String
        Str = " SELECT  PrTxTrxnHeader.Emp_Code," & _
            " PrTxTrxnLines.ConCod_Code," & _
            " PrTxTrxnLines.TrxLin_PeriodValue," & _
            " PrMsContributionCodes.ConTyp_Code," & _
            " PrTxTrxnHeader.PrdGrp_Code, " & _
            " PrTxTrxnHeader.PrdCod_Code" & _
            " FROM  PrTxTrxnLines INNER JOIN" & _
            " PrTxTrxnHeader ON " & _
            " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            " PrMsContributionCodes ON" & _
            " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code" & _
            " WHERE (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(Per.Code) & ")" & _
            " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Per.PrdGrpCode) & ")" & _
            " AND (PrMsContributionCodes.ConTyp_Code = " & enQuoteString(ContributionType) & ")"

        Return GetData(Str)
    End Function
    Protected Function GetERNFromTrxnLinesFor(ByVal AllSIPer As String, ByVal AllPeriodGroups As String, ByVal EarningType As String, ByVal SICat As cPrAnSocialInsCategories, ByVal CompanySINo As String) As DataSet
        Dim Str As String

        Str = " SELECT  PrTxTrxnHeader.Emp_Code," & _
            " PrTxTrxnLines.ErnCod_Code," & _
            " PrTxTrxnLines.TrxLin_PeriodValue," & _
            " PrMsEarningCodes.ErnTyp_Code," & _
            " PrTxTrxnHeader.PrdGrp_Code, " & _
            " PrTxTrxnHeader.PrdCod_Code" & _
            " FROM  PrTxTrxnLines INNER JOIN" & _
            " PrTxTrxnHeader ON " & _
            " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            " PrMsEarningCodes ON" & _
            " PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            " INNER JOIN PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
            " WHERE (PrMsEarningCodes.ErnTyp_Code = " & enQuoteString(EarningType) & ")" & _
            " AND (PrTxTrxnHeader.PrdCod_Code IN( " & AllSIPer & ")" & _
            " " & AllPeriodGroups & ")" & _
            " AND (PrMsEmployees.Sic_Code = " & enQuoteString(SICat.Code) & ")" & _
            " AND  (PrMsEmployees.ComSin_EmpSocialInsNo=" & enQuoteString(CompanySINo) & ")"


        Return GetData(Str)
    End Function
    Protected Function GetDEDFromTrxnLinesFor(ByVal AllSIPer As String, ByVal AllPeriodGroups As String, ByVal DeductionType As String, ByVal SICat As cPrAnSocialInsCategories, ByVal CompanySINo As String) As DataSet
        Dim Str As String

        Str = " SELECT  PrTxTrxnHeader.Emp_Code," & _
            " PrTxTrxnLines.DedCod_Code," & _
            " PrTxTrxnLines.TrxLin_PeriodValue," & _
            " PrMsDeductionCodes.DedTyp_Code," & _
            " PrTxTrxnHeader.PrdGrp_Code, " & _
            " PrTxTrxnHeader.PrdCod_Code" & _
            " FROM  PrTxTrxnLines INNER JOIN" & _
            " PrTxTrxnHeader ON " & _
            " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            " PrMsDeductionCodes ON" & _
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
            " INNER JOIN PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
            " WHERE (PrMsDeductionCodes.DedTyp_Code = " & enQuoteString(DeductionType) & ")" & _
            " AND (PrTxTrxnHeader.PrdCod_Code IN( " & AllSIPer & ")" & _
            " " & AllPeriodGroups & ")" & _
            " AND (PrMsEmployees.Sic_Code = " & enQuoteString(SICat.Code) & ")" & _
            " AND  (PrMsEmployees.ComSin_EmpSocialInsNo=" & enQuoteString(CompanySINo) & ")"


        Return GetData(Str)
    End Function
    Protected Function GetGrossANDInsurable_NEW(ByVal AllSIPer As String, ByVal AllPeriodGroups As String, ByVal SICat As cPrAnSocialInsCategories, ByVal CompanySINo As String, ByVal EmpCode As String, ByVal TempGroupCode As String, ByVal PeriodGroupCode As String, ByVal PeriodDS As DataSet) As DataSet
        Dim Str As String
        'savvastoday1

        Str = " SELECT sum(PrTxTrxnHeader.TrxHdr_TotalErnPeriod)," & _
             " sum(PrTxTrxnHeader.TrxHdr_PeriodInsurable)" & _
            " FROM  PrTxTrxnHeader  " & _
            " INNER JOIN PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
            " WHERE PrMsEmployees.Emp_Code=" & enQuoteString(EmpCode) & _
            " AND (PrTxTrxnHeader.PrdCod_Code IN( " & AllSIPer & ")" & _
            " " & AllPeriodGroups & ")" & _
            " AND (PrMsEmployees.Sic_Code = " & enQuoteString(SICat.Code) & ")" & _
            " AND  (PrMsEmployees.ComSin_EmpSocialInsNo=" & enQuoteString(CompanySINo) & ")"
        Dim Ds As DataSet
        Ds = GetData(Str)


        Dim NonInsurable As Double = 0
        If CheckDataSet(PeriodDS) Then
            Dim i As Integer
            Dim CurrentPeriodCode As String
            Dim PeriodGroup As String
            For i = 0 To PeriodDS.Tables(0).Rows.Count - 1
                CurrentPeriodCode = DbNullToString(PeriodDS.Tables(0).Rows(i).Item(0))
                PeriodGroup = DbNullToString(PeriodDS.Tables(0).Rows(i).Item(1))
                If PeriodGroup = PeriodGroupCode Then
                    NonInsurable = NonInsurable + Me.FindNonInsurableTotalForTemplateGroupPeriodEmployee(TempGroupCode, PeriodGroupCode, EmpCode, CurrentPeriodCode)
                End If
            Next

        End If

        If CheckDataSet(Ds) Then
            Ds.Tables(0).Rows(0).Item(0) = Ds.Tables(0).Rows(0).Item(0) - NonInsurable
        End If




        Return Ds
    End Function
    Protected Function Get_EARNING_VALUE_FromTrxnLines_For_HeaderID(ByVal HdrId As Integer, ByVal ErnCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim V As Double

        Str = " SELECT  TrxLin_PeriodValue" & _
            " FROM  PrTxTrxnLines Where " & _
            " TrxHdr_Id=" & HdrId & _
            " AND ErnCod_Code=" & enQuoteString(ErnCode)
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            V = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return V


    End Function
    Protected Function FixGesiable(ByVal GesiableValue As Double, ByVal EmpCode As String, ByVal CurrentPeriod As cPrMsPeriodCodes) As Boolean

        Dim Str As String
        Dim F As Boolean = False
        Str = "Update PrTxTrxnHeader set TrxHdr_GESIableAmount=" & GesiableValue & _
        " Where Emp_Code=" & enQuoteString(EmpCode) & _
        " AND prdcod_code=" & enQuoteString(CurrentPeriod.Code) & _
        " AND prdgrp_code=" & enQuoteString(CurrentPeriod.PrdGrpCode)

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        Else
            f = False
        End If
        Return f

    End Function
    Protected Function SearchForBanks(ByVal Code As String, ByVal Desc As String, ByVal Swift As String) As DataSet
        Dim Str As String
        Dim Str2 As String
        Dim Str3 As String
        Dim Str4 As String

        Dim sCode As String = "%" & Code & "%"
        Dim sDesc As String = "%" & Desc & "%"
        Dim sSwift As String = "%" & Swift & "%"

        Str = "Select Bnk_Code , " & _
        " Bnk_DescriptionL ," & _
        " Bnk_SwiftCode " & _
        " from PrAnBanks " & _
        " Where Bnk_Code Like " & enQuoteString(sCode)

        If Desc <> "" Then
            Str2 = " AND Bnk_DescriptionL Like " & enQuoteString(sDesc)
        End If

        If Swift <> "" Then
            Str3 = " AND Bnk_SwiftCode Like " & enQuoteString(sSwift)
        End If

        str4 = " Order by Bnk_Code Asc"
        Str = Str & Str2 & Str3 & Str4
        Return GetData(Str)

    End Function
    Protected Function GetCONFromTrxnLinesFor(ByVal AllSIPer As String, ByVal AllPeriodGroups As String, ByVal ContributionType As String, ByVal SICat As cPrAnSocialInsCategories, ByVal CompanySINo As String) As DataSet
        Dim Str As String
        Str = " SELECT  PrTxTrxnHeader.Emp_Code," & _
            " PrTxTrxnLines.ConCod_Code," & _
            " PrTxTrxnLines.TrxLin_PeriodValue," & _
            " PrMsContributionCodes.ConTyp_Code," & _
            " PrTxTrxnHeader.PrdGrp_Code, " & _
            " PrTxTrxnHeader.PrdCod_Code" & _
            " FROM  PrTxTrxnLines INNER JOIN" & _
            " PrTxTrxnHeader ON " & _
            " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id INNER JOIN" & _
            " PrMsContributionCodes ON" & _
            " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code" & _
            " INNER JOIN PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
            " WHERE (PrMsContributionCodes.ConTyp_Code = " & enQuoteString(ContributionType) & ")" & _
            " AND (PrTxTrxnHeader.PrdCod_Code IN( " & AllSIPer & ")" & _
            " " & AllPeriodGroups & ")" & _
            " AND (PrMsEmployees.Sic_Code = " & enQuoteString(SICat.Code) & ")" & _
            " AND  (PrMsEmployees.ComSin_EmpSocialInsNo=" & enQuoteString(CompanySINo) & ")"


        Return GetData(Str)
    End Function
    Protected Function GetParameter(ByVal Section As String, ByVal Item As String) As DataSet
        Dim Str As String
        Str = " SELECT Par_Id," & _
        " Par_Section," & _
        " Par_Item," & _
        " Par_Value," & _
        " Par_Description," & _
        " Par_System," & _
        " Par_Type" & _
        " FROM PrSsParameters" & _
        " Where Par_Section=" & enQuoteString(Section) & _
        " And Par_Item=" & enQuoteString(Item)
        Return GetData(Str)
    End Function
    Protected Function DeleteMaskingCodesOfCode(ByVal InterfaceCode As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = True

        Str = "Delete From PrMsCodeMasking " & _
        " Where IntCod_Code=" & enQuoteString(InterfaceCode)

        If MyBase.ExecuteNonQuery(Str) = -1 Then
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function SI_File_GetEmployees(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal SicCode As String, ByRef StatusPrep As Boolean) As DataSet

        Dim DsPrep As DataSet
        Dim Str As String
        Str = " SELECT PrTxTrxnHeader.Emp_Code" & _
             " FROM  PrTxTrxnHeader INNER JOIN" & _
             " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
             " WHERE (PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
             " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
             " AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(Period.Code) & ")" & _
             " AND (PrMsEmployees.Sic_Code = " & enQuoteString(SicCode) & ")" & _
             " AND (PrMsEmployees.ComSin_EmpSocialInsNo <>'')" & _
            " AND (PrTxTrxnHeader.TrxHdr_Status='PREP')"

        DsPrep = GetData(Str)
        If CheckDataSet(DsPrep) Then
            StatusPrep = False
            MsgBox("There are Employees with Payroll Status 'PREPARED', Cannot proceed with S.I. File", MsgBoxStyle.Critical)
            Cursor.Current = Cursors.Default

            Exit Function
        End If

        Str = " SELECT PrTxTrxnHeader.Emp_Code" & _
             " FROM  PrTxTrxnHeader INNER JOIN" & _
             " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
             " WHERE (PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
             " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
             " AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(Period.Code) & ")" & _
             " AND (PrMsEmployees.Sic_Code = " & enQuoteString(SicCode) & ")" & _
             " AND (PrMsEmployees.ComSin_EmpSocialInsNo <>'')"

        'Str = " Select Case PrMsEmployees.Emp_Code" & _
        '      " FROM PrMsEmployees INNER JOIN" & _
        '      " PrTxTrxnHeader ON PrMsEmployees.Emp_Code = PrTxTrxnHeader.Emp_Code INNER JOIN" & _
        '      " PrMsPeriodCodes ON PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
        '      " AND PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code" & _
        '      " WHERE (PrMsEmployees.Sic_Code = " & enQuoteString(SicCode) & ")" & _
        '      " AND (PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
        '      " AND (PrTxTrxnheader.PerGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
        '      " AND (PrTxTrxnheader.PerCod_Code = " & enQuoteString(Period.Code) & ")"
        Return GetData(Str)
    End Function
    Protected Function SI_File_GetEmployees_New14(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal SicCode As String, ByRef StatusPrep As Boolean, ByVal SinPeriodCode As String) As DataSet

        Dim DsPrep As DataSet
        Dim Str As String
        Str = " SELECT PrTxTrxnHeader.Emp_Code" & _
             " FROM  PrTxTrxnHeader INNER JOIN" & _
             " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
             " WHERE (PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
             " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
             " AND (PrTxTrxnHeader.PrdCod_Code in " & _
            " (Select PrdCod_Code  from PrMsPeriodCodes where PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & _
            " AND SinPrd_Code  =" & enQuoteString(SinPeriodCode) & "))" & _
             " AND (PrMsEmployees.Sic_Code = " & enQuoteString(SicCode) & ")" & _
             " AND (PrMsEmployees.ComSin_EmpSocialInsNo <>'')" & _
            " AND (PrTxTrxnHeader.TrxHdr_Status='PREP')"

        DsPrep = GetData(Str)
        If CheckDataSet(DsPrep) Then
            StatusPrep = False
            MsgBox("There are Employees with Payroll Status 'PREPARED', Cannot proceed with S.I. File", MsgBoxStyle.Critical)
            Cursor.Current = Cursors.Default

            Exit Function
        End If

        Str = " SELECT PrTxTrxnHeader.Emp_Code" & _
             " FROM  PrTxTrxnHeader INNER JOIN" & _
             " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
             " WHERE (PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
             " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
             " AND (PrTxTrxnHeader.PrdCod_Code in " & _
             " (Select PrdCod_Code  from PrMsPeriodCodes where PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & _
            " AND SinPrd_Code  =" & enQuoteString(SinPeriodCode) & "))" & _
             " AND (PrMsEmployees.Sic_Code = " & enQuoteString(SicCode) & ")" & _
             " AND (PrMsEmployees.ComSin_EmpSocialInsNo <>'')" & _
             " GROUP BY PrTxTrxnHeader.Emp_Code "
        Return GetData(Str)
    End Function
    Protected Function SI_File_GetEmployees_MultipleTemplates(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal SicCode As String, ByRef StatusPrep As Boolean) As DataSet

        Dim DsPrep As DataSet

        Dim StrX As String = ""
        Dim Str As String = ""
        Dim Str2 As String = ""

        Dim sTG As String = ""
        Dim sPG As String = ""
        Dim sPR As String = ""
        Dim StrSICat As String = " AND (PrMsEmployees.Sic_Code = " & enQuoteString(SicCode) & ") AND (PrMsEmployees.ComSin_EmpSocialInsNo <> '') "

        If CheckDataSet(Global1.DSforSIfile) Then
        
            Dim TmpCode As String = ""
            Dim PrdGrp As String = ""
            Dim Selected As String = "0"
            Dim i As Integer
            Dim k As Integer = 0
            For i = 0 To Global1.DSforSIfile.Tables(0).Rows.Count - 1
                Selected = DbNullToString(Global1.DSforSIfile.Tables(0).Rows(i).Item(0))
                PrdGrp = DbNullToString(Global1.DSforSIfile.Tables(0).Rows(i).Item(1))
                TmpCode = DbNullToString(Global1.DSforSIfile.Tables(0).Rows(i).Item(2))
                If Selected = "1" Then
                    If k = 0 Then
                        k = 1
                        sTG = "  ( PrMsEmployees.TemGrp_Code = " & enQuoteString(TmpCode)
                        sPG = " AND ( PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PrdGrp)
                        sPR = " AND ( PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(Period.Code)
                    Else
                        sTG = sTG & " OR PrMsEmployees.TemGrp_Code = " & enQuoteString(TmpCode)
                        sPG = sPG & " OR PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PrdGrp)
                        sPR = sPR & " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(Period.Code)
                    End If
                End If
            Next
            sTG = sTG & " ) "
            sPG = sPG & " ) "
            sPR = sPR & " ) "

            Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
                       " PrTxTrxnHeader.PrdGrp_Code," & _
                       " PrTxTrxnHeader.TemGrp_Code " & _
                       " FROM  PrTxTrxnHeader INNER JOIN" & _
                       " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
                       " WHERE "


            Str2 = " AND (PrMsEmployees.ComSin_EmpSocialInsNo <>'')" & _
                " AND (PrTxTrxnHeader.TrxHdr_Status='PREP')"

            StrX = Str & sTG & sPG & sPR & StrSICat & Str2

            DsPrep = GetData(StrX)
            If CheckDataSet(DsPrep) Then
                StatusPrep = False
                MsgBox("There are Employees with Payroll Status 'PREPARED', Cannot proceed with S.I. File", MsgBoxStyle.Critical)
                Cursor.Current = Cursors.Default

                Exit Function
            End If


            StrX = Str & sTG & sPG & sPR & StrSICat


            'Else
            '    StrX = "SELECT PrTxTrxnHeader.Emp_Code," & _
            '               " PrTxTrxnHeader.PrdGrp_Code," & _
            '               " PrTxTrxnHeader.TemGrp_Code " & _
            '               " FROM  PrTxTrxnHeader INNER JOIN" & _
            '               " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
            '               " WHERE 1=2"

            '    MsgBox("There are No Employees with Payroll for this period, Cannot proceed with S.I. File", MsgBoxStyle.Critical)
            '    Cursor.Current = Cursors.Default

        End If


        

        Return GetData(Strx)
    End Function
    Protected Function SI_File_GetEmployees_2(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal SicCode As String, ByRef StatusPrep As Boolean, ByVal SI_RegNo As String) As DataSet

        Dim DsPrep As DataSet
        Dim Str As String
        Str = " SELECT PrTxTrxnHeader.Emp_Code" & _
             " FROM  PrTxTrxnHeader INNER JOIN" & _
             " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
             " WHERE (PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
             " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
             " AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(Period.Code) & ")" & _
             " AND (PrMsEmployees.Sic_Code = " & enQuoteString(SicCode) & ")" & _
             " AND (PrMsEmployees.ComSin_EmpSocialInsNo <>'')" & _
            " AND (PrTxTrxnHeader.TrxHdr_Status='PREP')"

        DsPrep = GetData(Str)
        If CheckDataSet(DsPrep) Then
            StatusPrep = False
            MsgBox("There are Employees with Payroll Status 'PREPARED', Cannot proceed with S.I. File", MsgBoxStyle.Critical)
            Cursor.Current = Cursors.Default

            Exit Function
        End If

        Str = " SELECT PrTxTrxnHeader.Emp_Code" & _
             " FROM  PrTxTrxnHeader INNER JOIN" & _
             " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
             " WHERE (PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
             " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
             " AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(Period.Code) & ")" & _
             " AND (PrMsEmployees.Sic_Code = " & enQuoteString(SicCode) & ")" & _
             " AND (PrMsEmployees.ComSin_EmpSocialInsNo =" & enQuoteString(SI_RegNo) & ")"

        'Str = " Select Case PrMsEmployees.Emp_Code" & _
        '      " FROM PrMsEmployees INNER JOIN" & _
        '      " PrTxTrxnHeader ON PrMsEmployees.Emp_Code = PrTxTrxnHeader.Emp_Code INNER JOIN" & _
        '      " PrMsPeriodCodes ON PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
        '      " AND PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code" & _
        '      " WHERE (PrMsEmployees.Sic_Code = " & enQuoteString(SicCode) & ")" & _
        '      " AND (PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
        '      " AND (PrTxTrxnheader.PerGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
        '      " AND (PrTxTrxnheader.PerCod_Code = " & enQuoteString(Period.Code) & ")"
        Return GetData(Str)
    End Function
    Protected Function SI_File_GetEmployees_Company(ByVal DsPeriods As DataSet, ByVal SicCode As String, ByRef StatusPrep As Boolean) As DataSet

        Dim Str1 As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim str4 As String = ""
        If CheckDataSet(DsPeriods) Then
            Dim i As Integer
            Dim PerCode As String
            Dim PerGrp As String
            Dim TemGrpCode As String

            For i = 0 To DsPeriods.Tables(0).Rows.Count - 1
                PerCode = DbNullToString(DsPeriods.Tables(0).Rows(i).Item(0))
                PerGrp = DbNullToString(DsPeriods.Tables(0).Rows(i).Item(1))
                TemGrpCode = DbNullToString(DsPeriods.Tables(0).Rows(i).Item(12))

                If i = 0 Then
                    Str1 = " ((PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrpCode)
                    Str2 = " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrp)
                    Str3 = " AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
                Else
                    Str1 = Str1 & " OR PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrpCode)
                    Str2 = Str2 & " OR PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrp)
                    Str3 = Str3 & " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
                End If
            Next
            Str1 = Str1 & " )"
            Str2 = Str2 & " )"
            Str3 = Str3 & " )"
        End If




        Dim DsPrep As DataSet
        Dim Str As String
        Str = " SELECT PrTxTrxnHeader.Emp_Code" & _
             " FROM  PrTxTrxnHeader INNER JOIN" & _
             " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
             " WHERE "

        str4 = " AND (PrMsEmployees.Sic_Code = " & enQuoteString(SicCode) & ")" & _
             " AND (PrMsEmployees.ComSin_EmpSocialInsNo <>'')" & _
            " AND (PrTxTrxnHeader.TrxHdr_Status='PREP'))"

        Str = Str & Str1 & Str2 & Str3 & str4

        DsPrep = GetData(Str)
        If CheckDataSet(DsPrep) Then
            StatusPrep = False
            MsgBox("There are Employees with Payroll Status 'PREPARED', Cannot proceed with S.I. File", MsgBoxStyle.Critical)
            Cursor.Current = Cursors.Default

            Exit Function
        End If

        Str = " SELECT PrTxTrxnHeader.Emp_Code" & _
             " FROM  PrTxTrxnHeader INNER JOIN" & _
             " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
             " WHERE "

        str4 = " AND (PrMsEmployees.Sic_Code = " & enQuoteString(SicCode) & ")" & _
        " AND (PrMsEmployees.ComSin_EmpSocialInsNo <>''))"

        Str = Str & Str1 & Str2 & Str3 & str4

        'Str = " Select Case PrMsEmployees.Emp_Code" & _
        '      " FROM PrMsEmployees INNER JOIN" & _
        '      " PrTxTrxnHeader ON PrMsEmployees.Emp_Code = PrTxTrxnHeader.Emp_Code INNER JOIN" & _
        '      " PrMsPeriodCodes ON PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" & _
        '      " AND PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code" & _
        '      " WHERE (PrMsEmployees.Sic_Code = " & enQuoteString(SicCode) & ")" & _
        '      " AND (PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
        '      " AND (PrTxTrxnheader.PerGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
        '      " AND (PrTxTrxnheader.PerCod_Code = " & enQuoteString(Period.Code) & ")"
        Return GetData(Str)
    End Function
    Protected Function GetAllPeriodsOF_SIPeriod(ByVal SIPerCode As String, ByVal TempGroupCode As String, ByVal PeriodGroupCode As String) As DataSet
        Dim Str As String
        Str = " SELECT PrMsPeriodCodes.PrdCod_Code," & _
            " PrMsPeriodCodes.PrdGrp_Code," & _
            " PrMsPeriodCodes.PrdCod_Number," & _
            " PrMsPeriodCodes.PrdCod_Status, " & _
            " PrMsPeriodCodes.PrdCod_DescriptionL," & _
            " PrMsPeriodCodes.PrdCod_DescriptionS," & _
            " PrMsPeriodCodes.PrdCod_Sequence, " & _
            " PrMsPeriodCodes.SinPrd_Code," & _
            " PrMsPeriodCodes.PrdCod_DateFrom," & _
            " PrMsPeriodCodes.PrdCod_DateTo," & _
            " PrMsPeriodCodes.PrdCod_PeriodUnits, " & _
            " PrMsPeriodCodes.PayCat_Code, " & _
            " PrMsPeriodCodes.PrdCod_PeriodUnits2 " & _
            " FROM PrMsPeriodCodes INNER JOIN" & _
            " PrMsPeriodGroups ON " & _
            " PrMsPeriodCodes.PrdGrp_Code = PrMsPeriodGroups.PrdGrp_Code INNER JOIN" & _
            " PrMsTemplateGroup ON " & _
            " PrMsPeriodGroups.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN" & _
            " PrSsSocialInsPeriods ON" & _
            " PrMsPeriodCodes.SinPrd_Code = PrSsSocialInsPeriods.SinPrd_Code" & _
            " WHERE (PrSsSocialInsPeriods.SinPrd_Code =" & enQuoteString(SIPerCode) & ")" & _
            " AND (PrMsTemplateGroup.TemGrp_Code = " & enQuoteString(TempGroupCode) & ")" & _
            " AND (PrMsPeriodCodes.PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"

        Return GetData(Str)
    End Function
    Protected Function GetAll_Templates_PeriodGroups_Periods_OfSIPeriod(ByVal SIPeriodCode As String, ByVal CompanyCode As String, ByVal PerGrpCodeYEAR As String) As DataSet
        Dim Str As String
        Str = "SELECT PrMsTemplateGroup.TemGrp_Code, " & _
        " PrMsPeriodGroups.PrdGrp_Code, " & _
        " PrMsPeriodCodes.PrdCod_Code,  " & _
        " PrMsPeriodCodes.SinPrd_Code " & _
        " FROM PrMsTemplateGroup INNER JOIN " & _
        " PrMsPeriodGroups ON PrMsTemplateGroup.TemGrp_Code = PrMsPeriodGroups.TemGrp_Code INNER JOIN " & _
        " PrMsPeriodCodes ON PrMsPeriodGroups.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code " & _
        " WHERE (PrMsTemplateGroup.Com_Code = " & enQuoteString(CompanyCode) & ") AND " & _
        " (PrMsPeriodCodes.SinPrd_Code = " & enQuoteString(SIPeriodCode) & ") " & _
        " AND (PrMsPeriodGroups.PrdGpr_Year = " & enQuoteString(PerGrpCodeYEAR) & ")"

        Return GetData(Str)

    End Function

    Protected Function GetAllPeriodsOF_SIPeriod_Company(ByVal SIPerCode As String, ByVal TempGroupCodeCOMCode As String, ByVal PeriodGroup As cPrMsPeriodGroups) As DataSet
        Dim Str As String

        Dim StrTemGrp As String
        Dim StrPrdGrp As String

        StrTemGrp = " (select TemGrp_Code  from PrMsTemplateGroup where Com_Code=" & enQuoteString(TempGroupCodeCOMCode) & ") "
        StrPrdGrp = " ( select PrdGrp_Code  from PrMsPeriodGroups where PrdGpr_Year =" & enQuoteString(PeriodGroup.Year) & _
                   " and  TemGrp_Code in " & _
                   " ( select TemGrp_Code  from PrMsTemplateGroup where Com_Code=" & enQuoteString(TempGroupCodeCOMCode) & ")) "


        Str = " SELECT PrMsPeriodCodes.PrdCod_Code," & _
            " PrMsPeriodCodes.PrdGrp_Code," & _
            " PrMsPeriodCodes.PrdCod_Number," & _
            " PrMsPeriodCodes.PrdCod_Status, " & _
            " PrMsPeriodCodes.PrdCod_DescriptionL," & _
            " PrMsPeriodCodes.PrdCod_DescriptionS," & _
            " PrMsPeriodCodes.PrdCod_Sequence, " & _
            " PrMsPeriodCodes.SinPrd_Code," & _
            " PrMsPeriodCodes.PrdCod_DateFrom," & _
            " PrMsPeriodCodes.PrdCod_DateTo," & _
            " PrMsPeriodCodes.PrdCod_PeriodUnits, " & _
            " PrMsPeriodCodes.PayCat_Code, " & _
            " PrMsTemplateGroup.TemGrp_Code " & _
            " FROM PrMsPeriodCodes INNER JOIN" & _
            " PrMsPeriodGroups ON " & _
            " PrMsPeriodCodes.PrdGrp_Code = PrMsPeriodGroups.PrdGrp_Code INNER JOIN" & _
            " PrMsTemplateGroup ON " & _
            " PrMsPeriodGroups.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN" & _
            " PrSsSocialInsPeriods ON" & _
            " PrMsPeriodCodes.SinPrd_Code = PrSsSocialInsPeriods.SinPrd_Code" & _
            " WHERE (PrSsSocialInsPeriods.SinPrd_Code =" & enQuoteString(SIPerCode) & ")" & _
            " AND (PrMsTemplateGroup.TemGrp_Code in " & StrTemGrp & ")" & _
            " AND (PrMsPeriodCodes.PrdGrp_Code in " & StrPrdGrp & ")"

        Return GetData(Str)
    End Function
    Protected Function Build_Template_STR_Company(ByVal SIPerCode As String, ByVal TempGroupCodeCOMCode As String, ByVal PeriodGroupCode As String) As String

        Dim StrTemGrp As String
        Dim StrPrdGrp As String

        StrTemGrp = " (select TemGrp_Code  from PrMsTemplateGroup where Com_Code=" & enQuoteString(TempGroupCodeCOMCode) & ") "

        Return StrTemGrp
    End Function
    Protected Function Build_PeriodGroup_STR_Company(ByVal SIPerCode As String, ByVal TempGroupCodeCOMCode As String, ByVal PeriodGroupCode As String) As String

        Dim StrPrdGrp As String

        StrPrdGrp = " ( select PrdGrp_Code  from PrMsPeriodGroups where TemGrp_Code in" & _
                    " ( select TemGrp_Code  from PrMsTemplateGroup where Com_Code=" & enQuoteString(TempGroupCodeCOMCode) & ")) "

        Return StrPrdGrp
    End Function

    Protected Function SI_File_GetEmployees_Gross_Insurable(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal EmpCode As String) As DataSet
        Dim str As String
        Dim Ds As DataSet

        str = " SELECT PrTxTrxnHeader.TrxHdr_TotalErnPeriod," & _
             " PrTxTrxnHeader.TrxHdr_PeriodInsurable," & _
             " PrTxTrxnHeader.TrxHdr_Gesiableamount " & _
             " FROM  PrTxTrxnHeader INNER JOIN" & _
             " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
             " WHERE (PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
             " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
             " AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(Period.Code) & ")" & _
             " AND (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")"

        Ds = GetData(str)
        Dim NonInsurable As Double



        NonInsurable = Me.FindNonInsurableTotalForTemplateGroupPeriodEmployee(TemGrp.Code, Period.PrdGrpCode, EmpCode, Period.Code)

        If CheckDataSet(Ds) Then
            Ds.Tables(0).Rows(0).Item(0) = Ds.Tables(0).Rows(0).Item(0) - NonInsurable
        End If


        Return Ds

    End Function
    Protected Function GetAnnualLeaveValueFromLineFor(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal EmpCode As String) As Double
        Dim Str As String
        Dim RetValue As Double = 0
        Str = "SELECT PrTxTrxnLines.TrxLin_PeriodValue" & _
                   " FROM PrTxTrxnLines INNER JOIN" & _
                   " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                   " WHERE  (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ") AND" & _
                   " (PrTxTrxnHeader.Prdcod_Code = " & enQuoteString(Period.Code) & " )AND " & _
                   " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") AND " & _
                   " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ") AND " & _
                   " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(PARAM_CobaltALCode) & ")"
        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            RetValue = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        End If
        Return RetValue

    End Function
    Protected Function GetBIKWithSCValueFromLineFor(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal EmpCode As String) As Double
        Dim Str As String
        Dim RetValue As Double = 0
        Str = "SELECT PrTxTrxnLines.TrxLin_PeriodValue" & _
                   " FROM PrTxTrxnLines INNER JOIN" & _
                   " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                   " WHERE  (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ") AND" & _
                   " (PrTxTrxnHeader.Prdcod_Code = " & enQuoteString(Period.Code) & " )AND " & _
                   " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") AND " & _
                   " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ") AND " & _
                   " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(PARAM_BIKWithSCCode) & ")"
        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            RetValue = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        End If
        Return RetValue

    End Function
    Protected Function SI_File_GetEmployees_Gross_Insurable_New14(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal EmpCode As String, ByVal SIPeriodCode As String) As DataSet
        Dim str As String
        Dim Ds As DataSet


        str = " SELECT sum(PrTxTrxnHeader.TrxHdr_TotalErnPeriod)," & _
             " sum(PrTxTrxnHeader.TrxHdr_PeriodInsurable)," & _
             " sum(PrTxTrxnHeader.TrxHdr_Gesiableamount) " & _
             " FROM  PrTxTrxnHeader INNER JOIN" & _
             " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
             " WHERE (PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
             " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
             " AND (PrTxTrxnHeader.PrdCod_Code in " & _
             " (Select PrdCod_Code  from PrMsPeriodCodes where PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & _
            " AND SinPrd_Code  =" & enQuoteString(SIPeriodCode) & "))" & _
             " AND (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")"

        Ds = GetData(str)
        Dim NonInsurable As Double
        NonInsurable = Me.FindNonInsurableTotalForTemplateGroupPeriodEmployee_New14(TemGrp.Code, Period.PrdGrpCode, EmpCode, Period.Code, SIPeriodCode)
        Ds.Tables(0).Rows(0).Item(0) = Ds.Tables(0).Rows(0).Item(0) - NonInsurable

        Return Ds

    End Function
    Protected Function SI_File_GetEmployees_Gross_Insurable_Company1(ByVal DsPeriods As DataSet, ByVal EmpCode As String) As DataSet
        Dim str As String
        Dim Ds As DataSet


        Dim Str1 As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim str4 As String = ""
        If CheckDataSet(DsPeriods) Then
            Dim i As Integer
            Dim PerCode As String
            Dim PerGrp As String
            Dim TemGrpCode As String

            For i = 0 To DsPeriods.Tables(0).Rows.Count - 1
                PerCode = DbNullToString(DsPeriods.Tables(0).Rows(i).Item(0))
                PerGrp = DbNullToString(DsPeriods.Tables(0).Rows(i).Item(1))
                TemGrpCode = DbNullToString(DsPeriods.Tables(0).Rows(i).Item(12))

                If i = 0 Then
                    Str1 = " (PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrpCode)
                    Str2 = " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrp)
                    Str3 = " AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
                Else
                    Str1 = Str1 & " OR PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrpCode)
                    Str2 = Str2 & " OR PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrp)
                    Str3 = Str3 & " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
                End If
            Next
            Str1 = Str1 & " )"
            Str2 = Str2 & " )"
            Str3 = Str3 & " )"
        End If

        str = " SELECT PrTxTrxnHeader.TrxHdr_TotalErnPeriod," & _
             " PrTxTrxnHeader.TrxHdr_PeriodInsurable," & _
             " PrTxTrxnHeader.TrxHdr_Gesiableamount " & _
             " FROM  PrTxTrxnHeader INNER JOIN" & _
             " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
             " WHERE "

        str4 = " AND (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")"

        str = str & Str1 & Str2 & Str3 & str4

        Ds = GetData(str)

        Dim NonInsurable As Double

        NonInsurable = Me.FindNonInsurableTotalForTemplateGroupPeriodEmployee_Company(DsPeriods, EmpCode)

        Ds.Tables(0).Rows(0).Item(0) = Ds.Tables(0).Rows(0).Item(0) - NonInsurable

        Return Ds

    End Function
    Protected Function GetPFAmount_A_And_B(ByVal TemGrp As cPrMsTemplateGroup, ByVal Period As cPrMsPeriodCodes, ByVal IncludeInactive As Boolean) As Double()
        Dim StrA As String
        Dim StrB As String
        Dim Str2 As String
        Dim Ds As DataSet
        Dim AmountA As Double
        Dim AmountB As Double
        Dim D(2) As Double

        If Not IncludeInactive Then
            Str2 = " AND PrMsEmployees.Emp_Status='A'"
        End If

        StrA = " SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                " FROM   PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON " & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code INNER JOIN" & _
                " PrAnBanks ON " & _
                " PrMsEmployees.Bnk_Code = PrAnBanks.Bnk_Code INNER JOIN" & _
                " PrTxTrxnLines ON " & _
                " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
                " PrMsDeductionCodes ON " & _
                " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
                " WHERE  (PrMsDeductionCodes.DedTyp_Code = 'PF')" & _
                " AND (PrTxTrxnLines.TrxLin_Type = 'D')" & _
                " AND (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
                " AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(Period.Code) & ")" & _
                " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")"

        StrA = StrA & Str2

        Ds = GetData(StrA)
        AmountA = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))

        StrB = " SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                " FROM   PrTxTrxnHeader INNER JOIN" & _
                " PrMsEmployees ON " & _
                " PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code INNER JOIN" & _
                " PrAnBanks ON " & _
                " PrMsEmployees.Bnk_Code = PrAnBanks.Bnk_Code INNER JOIN" & _
                " PrTxTrxnLines ON " & _
                " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" & _
                " PrMsContributionCodes ON " & _
                " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code" & _
                " WHERE  (PrMsContributionCodes.ConTyp_Code = 'PF')" & _
                " AND (PrTxTrxnLines.TrxLin_Type = 'C')" & _
                " AND (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp.Code) & ")" & _
                " AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(Period.Code) & ")" & _
                " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")"
        StrB = StrB & Str2
        Ds = GetData(StrB)
        AmountB = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        D(0) = AmountA
        D(1) = AmountB
        Return D
    End Function

    Public Shadows Function GetPeriodRange(ByVal PerFrom As cPrMsPeriodCodes, ByVal PerTo As cPrMsPeriodCodes) As DataSet
        Dim Str As String
        Str = "SELECT PrdCod_Code," & _
              " PrdGrp_Code," & _
              " PrdCod_Number," & _
              " PrdCod_Status," & _
              " PrdCod_DescriptionL," & _
              " PrdCod_DescriptionS," & _
              " PrdCod_Sequence," & _
              " SinPrd_Code, " & _
              " PrdCod_DateFrom," & _
              " PrdCod_DateTo," & _
              " PrdCod_PeriodUnits," & _
              " PayCat_Code," & _
              " PrdCod_PeriodUnits2 " & _
              " FROM PrMsPeriodCodes" & _
              " WHERE (PrdCod_Code >= " & enQuoteString(PerFrom.Code) & ")" & _
              " AND (PrdCod_Code <= " & enQuoteString(PerTo.Code) & ")" & _
              " AND (PrdGrp_Code = " & enQuoteString(PerFrom.PrdGrpCode) & ")" & _
              " ORDER BY PrdCod_Sequence asc"
        Return MyBase.GetData(Str)
    End Function
    Protected Function GetNumberOfEmployeesMonthlyHourlyPeriod(ByVal PeriodGroup As String, ByVal PeriodCode As String, ByVal Type As String) As Integer
        Dim str As String
        Dim Ds As DataSet
        Dim N As Integer = 0
        str = "select count(*) " & _
            " FROM PrTxTrxnHeader INNER JOIN " & _
            " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
            " WHERE (PrMsEmployees.PayUni_Code = " & enQuoteString(Type) & ") " & _
            " AND (PrTxTrxnHeader.PrdGrp_Code =  " & enQuoteString(PeriodGroup) & ") " & _
            " AND (PrTxTrxnHeader.PrdCod_Code =  " & enQuoteString(PeriodCode) & ") "
        Ds = GetData(str)
        If CheckDataSet(Ds) Then
            n = DbNullToInt(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return N



    End Function
    Protected Function GetDSOfEmployeesMonthlyHourlyPeriod(ByVal PeriodGroup As String, ByVal PeriodCode As String, ByVal Type As String) As DataSet
        Dim str As String
        Dim Ds As DataSet
        Dim N As Integer = 0
        str = "select count(*), " & _
            " PrMsEmployees.PayUni_Code, " & _
            " PrTxTrxnHeader.TrxHdr_A2, " & _
            " PrAnEmployeeAnalysis2.EmpAn2_DescriptionL " & _
            " FROM PrTxTrxnHeader INNER JOIN " & _
            " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
            " INNER JOIN PrAnEmployeeAnalysis2 ON PrMsEmployees.EmpAn2_Code = PrAnEmployeeAnalysis2.EmpAn2_Code " & _
            " WHERE (PrMsEmployees.PayUni_Code = " & enQuoteString(Type) & ") " & _
            " AND (PrTxTrxnHeader.PrdGrp_Code =  " & enQuoteString(PeriodGroup) & ") " & _
            " AND (PrTxTrxnHeader.PrdCod_Code =  " & enQuoteString(PeriodCode) & ") " & _
            " GROUP By PrMsEmployees.PayUni_Code, PrTxTrxnHeader.TrxHdr_A2, PrAnEmployeeAnalysis2.EmpAn2_DescriptionL "

        Ds = GetData(str)
        Return Ds



    End Function
    Protected Function GetDecuctionCodeForSI() As String
        Dim Str As String
        Dim ds As DataSet
        Dim Code As String = ""

        Str = " select dedcod_code from prmsdeductioncodes" & _
              " where dedtyp_code='SI'"
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Code = DbNullToString(ds.Tables(0).Rows(0).Item(0))
        End If

        Return Code

    End Function
    Public Shadows Function GetContributionCodeForSI() As String
        Dim Str As String
        Dim ds As DataSet
        Dim Code As String = ""
        Str = " select Concod_code from prmscontributioncodes" & _
              " where contyp_code='SI'"
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Code = DbNullToString(ds.Tables(0).Rows(0).Item(0))
        End If

        Return Code

    End Function
    Protected Function GetDecuctionCodeForIT() As String
        Dim Str As String
        Dim ds As DataSet
        Dim Code As String = ""

        Str = " select dedcod_code from prmsdeductioncodes" & _
              " where dedtyp_code='IT'"
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Code = DbNullToString(ds.Tables(0).Rows(0).Item(0))
        End If

        Return Code

    End Function
    Protected Function GetEarningCodeFor13Estimate() As String
        Dim Str As String
        Dim ds As DataSet
        Dim Code As String = ""

        Str = " select Erncod_code from prmsEarningcodes" & _
              " where erntyp_code='3E'"
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Code = DbNullToString(ds.Tables(0).Rows(0).Item(0))
        End If

        Return Code

    End Function
    Protected Function GetAllEmployeesWithTerminationdate(ByVal TemGrp As String) As DataSet
        Dim Str As String
        Str = " SELECT Emp_Code  from PrMsEmployees " & _
             " where Emp_TerminateDate<>''" & _
             " and TemGrp_Code =" & enQuoteString(TemGrp)

        Return MyBase.GetData(Str)
    End Function
    Public Shadows Function GetAllPrTxdiscountsForPeriodGroup(ByVal PeriodGroupCode As String) As DataSet
        Dim Str As String
        Str = " SELECT EmpDis_id," & _
        " Emp_Code," & _
        " PrdGrp_Code," & _
        " EmpDis_Discount1," & _
        " EmpDis_Discount2," & _
        " EmpDis_Discount3," & _
        " EmpDis_Discount4," & _
        " EmpDis_Discount5," & _
        " EmpDis_Discount6," & _
        " EmpDis_Discount7," & _
        " EmpDis_Discount8," & _
        " EmpDis_Discount9," & _
        " EmpDis_Discount10," & _
        " EmpDis_LifeInsurance," & _
        " Usr_Id, " & _
        " EmpDis_CreationDate," & _
        " EmpDis_AmendDate," & _
        " EmpDis_medical, " & _
        " EmpDis_PensionFund " & _
        " FROM PrTxEmployeeDiscounts" & _
        " WHERE (PrdGrp_Code = " & enQuoteString(PeriodGroupCode) & ")"

        Return GetData(Str)

    End Function
    Protected Function GetAllPrSsAnnualLeaveTypes() As DataSet
        Dim Str As String
        Str = " SELECT Lve_Code," & _
                " Lve_DescriptionL," & _
                " Lve_DescriptionS," & _
                " Lve_IsActive," & _
                " Lve_IsPaidPeriod," & _
                " Lve_IsPaidAnnual," & _
                " Lve_UnitOfMeasure," & _
                " Lve_AnnualMax," & _
                " Lve_CarryOverMax" & _
                " FROM PrSsLeaveTypes Order by Lve_Code Asc"
        Return GetData(Str)
    End Function
    Protected Function FindBankAccounts(ByVal Company As cAdMsCompany, ByVal Bank As cPrAnBanks) As DataSet
        Dim Str As String
        Str = " SELECT distinct PrMsEmployees.Emp_BankAccountCo" & _
            " FROM PrMsEmployees INNER JOIN" & _
            " PrAnBanks ON " & _
            " PrMsEmployees.Bnk_CodeCo = PrAnBanks.Bnk_Code INNER JOIN" & _
            " PrMsTemplateGroup ON" & _
            " PrMsEmployees.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code" & _
            " WHERE (PrAnBanks.Bnk_Code = " & enQuoteString(Bank.Code) & ") " & _
            " AND (PrMsTemplateGroup.Com_Code = " & enQuoteString(Company.Code) & ")"

        Return GetData(Str)
    End Function
    Protected Function GetCompanydetailsForPFreport(ByVal companyCode As String) As DataSet
        Dim Str As String
        Str = "SELECT Com_Code," & _
            " Com_Name," & _
            " Com_Address1," & _
            " Com_Address2," & _
            " Com_Address3," & _
            " Com_Address4," & _
            " Com_Tel1," & _
            " Com_Fax1," & _
            " Com_Tel2," & _
            " Com_Fax2," & _
            " 0.00 As TotalAB," & _
            " '' As Analysis," & _
            " Com_GLAnal4," & _
            " Com_GLAnal5 " & _
            " FROM AdMsCompany" & _
            " WHERE (Com_Code = " & enQuoteString(companyCode) & ")"
        Return GetData(Str)
    End Function
    Protected Function GetPeriodDetailsForPFreport(ByVal Period As cPrMsPeriodCodes) As DataSet
        Dim Str As String
        Str = " SELECT PrdCod_DescriptionL," & _
            " PrdCod_DescriptionS," & _
            " PrdCod_Sequence," & _
            " PrdCod_DateFrom," & _
            " PrdCod_DateTo," & _
            " PrdGrp_Code," & _
            " PrdCod_Code" & _
            " FROM PrMsPeriodCodes" & _
            " WHERE (PrdGrp_Code = " & enQuoteString(Period.PrdGrpCode) & ")" & _
            " AND (PrdCod_Code = " & enQuoteString(Period.Code) & ")"
        Return MyBase.GetData(Str)
    End Function


    Protected Function GetAllActivePrAnTaxCardType() As DataSet
        Dim Str As String
        Str = " SELECT " & _
            " TicTyp_Code," & _
            " TicTyp_DescriptionL," & _
            " TicTyp_DescriptionS," & _
            " TicTyp_IsActive " & _
            " FROM PrAnTaxCardType " & _
            " where TicTyp_IsActive='Y'"
        Return GetData(Str)
    End Function
#End Region

#Region "Interface Timesheets"
    Protected Function GetCompanyCostPerEmployee(ByVal PeriodGroup As String, ByVal PeriodCode As String) As DataSet
        Dim Str As String

        Str = " SELECT PrTxTrxnHeader.Emp_Code," & _
        " PrTxTrxnHeader.TrxHdr_TotalErnPeriod + PrTxTrxnHeader.TrxHdr_TotalConPeriod AS Expr1, " & _
        " PrMsEmployees.Emp_GLAnal4," & _
        " PrAnEmployeeAnalysis2.EmpAn2_GLAnal1" & _
        " FROM PrTxTrxnHeader INNER JOIN" & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code" & _
        " INNER JOIN" & _
        " PrAnEmployeeAnalysis2 ON PrMsEmployees.EmpAn2_Code = PrAnEmployeeAnalysis2.EmpAn2_Code" & _
        " WHERE (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ")" & _
        " AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PeriodCode) & ")" & _
        " AND (PrTxTrxnHeader.TrxHdr_Status = 'POST')"

        Return MyBase.GetData(Str)

    End Function
    Protected Function NAV_FindIfItWasInterfacedAgain(ByVal Company As String, ByVal Year As String, ByVal PeriodCode As String) As DataSet
        Dim Str As String


        Str = " SELECT CompanyCode," & _
            " EmployeeCode," & _
            " ResourceCode," & _
            " Year," & _
            " Period," & _
            " Cost," & _
            " WorkHours," & _
            " HourRate" & _
            " FROM  [" & Global1.NAV_GLBCompPrefix & "PayrollCost]" & _
            " WHERE (CompanyCode = " & enQuoteString(Company) & ")" & _
            " AND (Year = " & enQuoteString(Year) & ")" & _
            " AND (Period = " & enQuoteString(PeriodCode) & ")"

        Return GetData(Str)

    End Function
    Protected Function NAV_InsertValuesInNavisionTimesheets(ByVal CompanyCode As String, ByVal EmployeeCode As String, ByVal ResourceCode As String, ByVal Year As String, ByVal Period As String, ByVal CompanyCost As Double, ByVal WorkHours As Double, ByVal HourlyCostRate As Double) As Boolean
        Dim Str As String
        Dim i As Integer
        Str = "INSERT INTO " & _
        " [" & Global1.NAV_GLBCompPrefix & "PayrollCost]" & _
        " (CompanyCode," & _
        " EmployeeCode," & _
        " ResourceCode," & _
        " Year," & _
        " Period," & _
        " Cost," & _
        " WorkHours, " & _
        " HourRate)" & _
        " VALUES (" & _
        enQuoteString(CompanyCode) & "," & _
        enQuoteString(EmployeeCode) & "," & _
        enQuoteString(ResourceCode) & "," & _
        enQuoteString(Year) & "," & _
        enQuoteString(Period) & "," & _
        CompanyCost & "," & _
        WorkHours & "," & _
        HourlyCostRate & ")"

        i = MyBase.ExecuteNonQuery(Str)

    End Function
    Protected Function NAV_DeleteInterfacedTimesheetTransactions(ByVal Company As String, ByVal Year As String, ByVal PeriodCode As String)
        Dim Str As String
        Dim i As Integer
        Str = " Delete FROM  [" & Global1.NAV_GLBCompPrefix & "PayrollCost]" & _
            " WHERE (CompanyCode = " & enQuoteString(Company) & ")" & _
            " AND (Year = " & enQuoteString(Year) & ")" & _
            " AND (Period = " & enQuoteString(PeriodCode) & ")"
        i = MyBase.ExecuteNonQuery(Str)
    End Function
    Protected Function NAV_DeleteInterfacedTimesheetTransactionsFromPerJob(ByVal Company As String, ByVal Year As String, ByVal PeriodCode As String)
        Dim Str As String
        Dim i As Integer
        Str = " Delete FROM  [" & Global1.NAV_GLBCompPrefix & "PayrollCostPerJob]" & _
            " WHERE (CompanyCode = " & enQuoteString(Company) & ")" & _
            " AND (Year = " & enQuoteString(Year) & ")" & _
            " AND (Period = " & enQuoteString(PeriodCode) & ")"
        i = MyBase.ExecuteNonQuery(Str)
    End Function
    Protected Function NAV_GetTotalHoursPerMonthPerResourse(ByVal dateFrom As String, ByVal DateTo As String, ByVal ResourceCode As String) As Double
        Dim Str As String
        Dim ds As DataSet
        Dim TotalHours As Double = 0
        Str = " SELECT SUM([Quantity (Base)])" & _
            " FROM [" & Global1.NAV_GLBCompPrefix & "Job Ledger Entry] " & _
            " WHERE TYPE=0 " & _
            " AND ([Document Date] >=" & enQuoteString(dateFrom) & "" & _
            " AND [Document Date] <=" & enQuoteString(DateTo) & ")" & _
            " AND No_=" & enQuoteString(ResourceCode)
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            TotalHours = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        End If
        Return TotalHours
    End Function
    Protected Function NAV_GetPayrollCostForcompanyYearPeriod(ByVal Company As String, ByVal Year As String, ByVal Period As String) As DataSet
        Dim Str As String
        Str = "SELECT CompanyCode," & _
            " EmployeeCode," & _
            " ResourceCode," & _
            " Year," & _
            " Period," & _
            " Cost," & _
            " WorkHours," & _
            " HourRate" & _
            " FROM [" & Global1.NAV_GLBCompPrefix & "PayrollCost]" & _
            " WHERE (CompanyCode = " & enQuoteString(Company) & ")" & _
            " AND (Year = " & enQuoteString(Year) & ")" & _
            " AND (Period = " & enQuoteString(Period) & ")"


        Return MyBase.GetData(Str)
    End Function
    Protected Function NAV_GetTotalHoursPerMonthPerResoursePerJob(ByVal dateFrom As String, ByVal DateTo As String, ByVal ResourceCode As String) As DataSet
        Dim Str As String
        Dim ds As DataSet
        Dim TotalHours As Double = 0
        Str = " SELECT SUM([Quantity (Base)])," & _
            " [Job No_] " & _
            " FROM [" & Global1.NAV_GLBCompPrefix & "Job Ledger Entry] " & _
            " WHERE TYPE=0 " & _
            " AND ([Document Date] >=" & enQuoteString(dateFrom) & "" & _
            " AND [Document Date] <=" & enQuoteString(DateTo) & ")" & _
            " AND No_=" & enQuoteString(ResourceCode) & _
            " GROUP BY [Job No_]"
        Return GetData(Str)

    End Function
    Protected Function NAV_InsertValuesInNavisionPerJob(ByVal CompanyCode As String, ByVal EmployeeCode As String, ByVal ResourceCode As String, ByVal Year As String, ByVal Period As String, ByVal JobNo As String, ByVal JobQty As Double, ByVal HourlyRate As Double, ByVal PerJobCost As Double) As Boolean
        Dim Str As String
        Dim i As Integer
        Str = "INSERT INTO " & _
        " [" & Global1.NAV_GLBCompPrefix & "PayrollCostPerJob]" & _
        " (CompanyCode," & _
        " EmployeeCode," & _
        " ResourceCode," & _
        " Year," & _
        " Period," & _
        " Job," & _
        " Qty," & _
        " HourlyRate, " & _
        " Total)" & _
        " VALUES (" & _
        enQuoteString(CompanyCode) & "," & _
        enQuoteString(EmployeeCode) & "," & _
        enQuoteString(ResourceCode) & "," & _
        enQuoteString(Year) & "," & _
        enQuoteString(Period) & "," & _
        enQuoteString(JobNo) & "," & _
        JobQty & "," & _
        HourlyRate & "," & _
        PerJobCost & ")"

        i = MyBase.ExecuteNonQuery(Str)
    End Function
    Protected Function NAV_SelectFromPayrollCostPerJob(ByVal Company As String, ByVal Year As String, ByVal Period As String) As DataSet
        Dim Str As String
        Str = "Select " & _
        " CompanyCode," & _
        " EmployeeCode," & _
        " ResourceCode," & _
        " Year," & _
        " Period," & _
        " Job," & _
        " Qty," & _
        " HourlyRate, " & _
        " Total " & _
        " FROM [" & Global1.NAV_GLBCompPrefix & "PayrollCostPerJob]" & _
        " WHERE (CompanyCode = " & enQuoteString(Company) & ")" & _
        " AND (Year = " & enQuoteString(Year) & ")" & _
        " AND (Period = " & enQuoteString(Period) & ")"

        Return GetData(Str)
    End Function

    Protected Function NAV_InsertInto_GenJournalLines(ByVal JournalTemplateName As String, ByVal JournalBachName As String, ByVal LineNo As Integer, ByVal AccountNo As String, ByVal AccDescription As String, ByVal DocumentNo As String, ByVal BalancingAcc As String, ByVal ShortCutDimension2 As String, ByVal SourceCode As String, ByVal Amount As Double, ByVal DocDate As String, ByVal ExternalDocument As String, ByVal PostingNoSeries As String, ByVal ShortcutDimension1 As String) As Boolean
        Dim str As String
        Dim Flag As Boolean
        Dim BalAmount As Double = Amount * (-1)
        str = "INSERT INTO [" & Global1.NAV_GLBCompPrefix & "Gen_ Journal Line]" & _
            "([Journal Template Name]," & _
            "[Journal Batch Name]," & _
            "[Line No_]," & _
            "[Account Type]," & _
            "[Account No_]," & _
            "[Posting Date]," & _
            "[Document Type]," & _
            "[Document No_]," & _
            "Description," & _
            "[VAT %]," & _
            "[Bal_ Account No_]," & _
            "[Currency Code]," & _
            "Amount," & _
            "[Debit Amount]," & _
            "[Credit Amount]," & _
            "[Amount (LCY)]," & _
            "[Balance (LCY)]," & _
            "[Currency Factor]," & _
            "[Sales_Purch_ (LCY)]," & _
            "[Profit (LCY)]," & _
            "[Inv_ Discount (LCY)]," & _
            "[Bill-to_Pay-to No_]," & _
            "[Posting Group]," & _
            "[Shortcut Dimension 1 Code]," & _
            "[Shortcut Dimension 2 Code]," & _
            "[Salespers__Purch_ Code]," & _
            "[Source Code]," & _
            "[System-Created Entry]," & _
            "[On Hold]," & _
            "[Applies-to Doc_ Type]," & _
            "[Applies-to Doc_ No_]," & _
            "[Due Date]," & _
            "[Pmt_ Discount Date]," & _
            "[Payment Discount %]," & _
            "[Job No_]," & _
            "Quantity," & _
            "[VAT Amount]," & _
            "[VAT Posting]," & _
            "[Payment Terms Code]," & _
            "[Applies-to ID]," & _
            "[Business Unit Code]," & _
            "[Reason Code]," & _
            "[Recurring Method]," & _
            "[Expiration Date]," & _
            "[Recurring Frequency]," & _
            "[Gen_ Posting Type]," & _
            "[Gen_ Bus_ Posting Group]," & _
            "[Gen_ Prod_ Posting Group]," & _
            "[VAT Calculation Type]," & _
            "[EU 3-Party Trade]," & _
            "[Allow Application]," & _
            "[Bal_ Account Type]," & _
            "[Bal_ Gen_ Posting Type]," & _
            "[Bal_ Gen_ Bus_ Posting Group]," & _
            "[Bal_ Gen_ Prod_ Posting Group]," & _
            "[Bal_ VAT Calculation Type]," & _
            "[Bal_ VAT %]," & _
            "[Bal_ VAT Amount]," & _
            "[Bank Payment Type]," & _
            "[VAT Base Amount]," & _
            "[Bal_ VAT Base Amount]," & _
            "Correction," & _
            "[Check Printed]," & _
            "[Document Date]," & _
            "[External Document No_]," & _
            "[Source Type]," & _
            "[Source No_]," & _
            "[Posting No_ Series]," & _
            "[Tax Area Code]," & _
            "[Tax Liable]," & _
            "[Tax Group Code]," & _
            "[Use Tax]," & _
            "[Bal_ Tax Area Code]," & _
            "[Bal_ Tax Liable]," & _
            "[Bal_ Tax Group Code]," & _
            "[Bal_ Use Tax]," & _
            "[VAT Bus_ Posting Group]," & _
            "[VAT Prod_ Posting Group]," & _
            "[Bal_ VAT Bus_ Posting Group]," & _
            "[Bal_ VAT Prod_ Posting Group]," & _
            "[Additional-Currency Posting]," & _
            "[FA Add_-Currency Factor]," & _
            "[Source Currency Code]," & _
            "[Source Currency Amount]," & _
            "[Source Curr_ VAT Base Amount]," & _
            "[Source Curr_ VAT Amount]," & _
            "[VAT Base Discount %]," & _
            "[VAT Amount (LCY)]," & _
            "[VAT Base Amount (LCY)]," & _
            "[Bal_ VAT Amount (LCY)]," & _
            "[Bal_ VAT Base Amount (LCY)]," & _
            "[Reversing Entry]," & _
            "[Allow Zero-Amount Posting]," & _
            "[Ship-to_Order Address Code]," & _
            "[VAT Difference]," & _
            "[Bal_ VAT Difference]," & _
            "[IC Partner Code]," & _
            "[IC Direction]," & _
            "[IC Partner G_L Acc_ No_]," & _
            "[IC Partner Transaction No_]," & _
            "[Sell-to_Buy-from No_]," & _
            "[VAT Registration No_]," & _
            "[Country_Region Code]," & _
            "Prepayment," & _
            "[Financial Void]," & _
            "[Job Task No_]," & _
            "[Job Unit Price (LCY)]," & _
            "[Job Total Price (LCY)]," & _
            "[Job Quantity]," & _
            "[Job Unit Cost (LCY)]," & _
            "[Job Line Discount %]," & _
            "[Job Line Disc_ Amount (LCY)]," & _
            "[Job Unit Of Measure Code]," & _
            "[Job Line Type]," & _
            "[Job Unit Price]," & _
            "[Job Total Price]," & _
            "[Job Unit Cost]," & _
            "[Job Total Cost]," & _
            "[Job Line Discount Amount]," & _
            "[Job Line Amount]," & _
            "[Job Total Cost (LCY)]," & _
            "[Job Line Amount (LCY)]," & _
            "[Job Currency Factor]," & _
            "[Job Currency Code]," & _
            "[Campaign No_]," & _
            "[Prod_ Order No_]," & _
            "[FA Posting Date]," & _
            "[FA Posting Type]," & _
            "[Depreciation Book Code]," & _
            "[Salvage Value]," & _
            "[No_ of Depreciation Days]," & _
            "[Depr_ until FA Posting Date]," & _
            "[Depr_ Acquisition Cost]," & _
            "[Maintenance Code]," & _
            "[Insurance No_]," & _
            "[Budgeted FA No_]," & _
            "[Duplicate in Depreciation Book]," & _
            "[Use Duplication List]," & _
            "[FA Reclassification Entry]," & _
            "[FA Error Entry No_]," & _
            "[Index Entry]," & _
            "NotOpenBalance," & _
            "AutoPost)" & _
            "VALUES " & _
            "(" & enQuoteString(JournalTemplateName) & "," & _
            enQuoteString(JournalBachName) & "," & _
            LineNo & "," & _
            "0," & _
            enQuoteString(AccountNo) & "," & _
            enQuoteString(DocDate) & "," & _
            "0," & _
            "'1'," & _
            enQuoteString(AccDescription) & "," & _
            "0.00000000000000000000," & _
            enQuoteString(BalancingAcc) & "," & _
            "''," & _
            Amount & "," & _
            Amount & "," & _
            "0.00000000000000000000," & _
            Amount & "," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "''," & _
            "''," & _
            enQuoteString(ShortcutDimension1) & "," & _
            enQuoteString(ShortCutDimension2) & "," & _
            "''," & _
            enQuoteString(SourceCode) & "," & _
            "0," & _
            "''," & _
            "0," & _
            "''," & _
            "'1753-01-01'," & _
            "'1753-01-01'," & _
            "0.00000000000000000000," & _
            "''," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0," & _
            "''," & _
            "''," & _
            "''," & _
            "''," & _
            "0," & _
            "'1753-01-01'," & _
            "''," & _
            "0," & _
            "''," & _
            "''," & _
            "0," & _
            "0," & _
            "1," & _
            "0," & _
            "0," & _
            "''," & _
            "''," & _
            "0," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0," & _
            Amount & "," & _
            BalAmount & "," & _
            "0," & _
            "0," & _
            enQuoteString(DocDate) & "," & _
            enQuoteString(ExternalDocument) & "," & _
            "0," & _
            "''," & _
            enQuoteString(PostingNoSeries) & "," & _
            "''," & _
            "0," & _
            "''," & _
            "0," & _
            "''," & _
            "0," & _
            "''," & _
            "0," & _
            "''," & _
            "''," & _
            "''," & _
            "''," & _
            "0," & _
            "0.00000000000000000000," & _
            "''," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            Amount & "," & _
            "0.00000000000000000000," & _
            BalAmount & "," & _
            "0," & _
            "0," & _
            "''," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "''," & _
            "0," & _
            "''," & _
            "0," & _
            "''," & _
            "''," & _
            "''," & _
            "0," & _
            "0," & _
            "''," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "''," & _
            "0," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "0.00000000000000000000," & _
            "''," & _
            "''," & _
            "''," & _
            "'1753-01-01'," & _
            "0," & _
            "''," & _
            "0.00000000000000000000," & _
            "0," & _
            "0," & _
            "0," & _
            "''," & _
            "''," & _
            "''," & _
            "''," & _
            "0," & _
            "0," & _
            "0," & _
            "0," & _
            "0," & _
            "0)"

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(str)
        If i > 0 Then
            Flag = True
        Else
            Flag = False
        End If
        Return Flag
    End Function
    Protected Function fixTotalContributiononHeader(ByVal Group As String, ByVal Code As String)
        Dim Str As String
        Dim EmpCode As String
        Str = "select trxhdr_id,Emp_Code from PrTxTrxnHeader where " & _
        "prdgrp_code=" & enQuoteString(Group) & _
        " and PrdCod_Code =" & enQuoteString(Code)
        Dim ds As DataSet
        Dim Ds2 As DataSet
        Dim TotalCon As Double
        Dim YTDTotalCon As Double

        ds = GetData(Str)
        Dim i As Integer
        Dim id As Integer
        For i = 0 To ds.Tables(0).Rows.Count - 1
            id = ds.Tables(0).Rows(i).Item(0)
            EmpCode = ds.Tables(0).Rows(i).Item(1)
            Str = "select SUM(trxlin_periodValue)" & _
            " from PrTxTrxnLines " & _
            " where TrxLin_Type ='C'" & _
            " and TrxHdr_Id=" & id
            Ds2 = GetData(Str)
            TotalCon = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))
            Str = "Update PrTxTrxnHeader set Trxhdr_TotalConPeriod=" & TotalCon & _
            "where TrxHdr_Id=" & id

            ExecuteNonQuery(Str)

            Str = "select sum(Trxhdr_TotalConPeriod) from prtxtrxnheader" & _
            " where emp_code=" & EmpCode & _
            " and trxhdr_Id<=" & id

            Ds2 = GetData(Str)
            YTDTotalCon = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))

            Str = "Update PrTxTrxnHeader set Trxhdr_TotalConYTD=" & YTDTotalCon & _
           " where TrxHdr_Id=" & id
            ExecuteNonQuery(Str)





        Next

    End Function
    Public Function Temp_GenCat(ByVal itemcode As String, ByVal cat9 As String, ByVal cat10 As String)
        Dim ds As DataSet
        Dim Str As String
        Str = "Select * from [NYS$General Categories]" & _
        " where [table no_]=27 and [type]=8 and " & _
        " Code=" & enQuoteString(cat9)

        ds = GetData(Str)
        If Not CheckDataSet(ds) Then
            Str = " insert into [NYS$General Categories]" & _
            " ([table no_]," & _
            " [Type]," & _
            " code," & _
            " description," & _
            " [analysis code])" & _
            " values " & _
            " (27," & _
            " 8," & _
             enQuoteString(cat9) & _
             ",''" & _
             ",'')"
            MyBase.ExecuteNonQuery(Str)
        End If

        Str = " update NYS$item" & _
              " set [Category 9] =" & enQuoteString(cat9) & _
              " ,[Category 10] =" & enQuoteString(cat10) & _
              " where No_ =" & enQuoteString(itemcode)

        MyBase.ExecuteNonQuery(Str)

    End Function
    Protected Function GetWorkedPeriodsUntilNow(ByVal EmpCode As String, ByVal PeriodGroup As String) As Integer
        Dim Str As String
        Dim Ds As DataSet
        Dim Count As Integer = 0
        Str = "select * from prtxtrxnheader" & _
            " where emp_code=" & enQuoteString(EmpCode) & _
            " and PrdGrp_Code=" & enQuoteString(PeriodGroup) & _
            " and trxhdr_status='POST'" & _
            " and Paycat_code='K'"
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Count = Ds.Tables(0).Rows.Count
        Else
            Count = 0
        End If
        Return Count
    End Function
    Protected Function GetWorkedTaxablePeriodsUntilNow(ByVal EmpCode As String, ByVal PeriodGroup As String) As Integer

        Dim Str As String
        Dim Ds As DataSet
        Dim Count As Integer = 0
        Str = "SELECT PrTxTrxnHeader.TrxHdr_Id," & _
        " PrTxTrxnHeader.Emp_Code," & _
        " PrTxTrxnHeader.PrdGrp_Code," & _
        " PrTxTrxnHeader.PrdCod_Code" & _
        " FROM PrTxTrxnHeader INNER JOIN" & _
        " PrMsDeductionCodes INNER JOIN" & _
        " PrMsPeriodDeductions" & _
        " ON PrMsDeductionCodes.DedCod_Code = PrMsPeriodDeductions.DedCod_Code ON " & _
        " PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodDeductions.PrdGrp_Code" & _
        " AND PrTxTrxnHeader.PrdCod_Code = PrMsPeriodDeductions.PrdCod_Code" & _
        " WHERE (PrTxTrxnHeader.Emp_Code =" & enQuoteString(EmpCode) & ") " & _
        " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ") " & _
        " AND (PrTxTrxnHeader.TrxHdr_Status = 'POST')" & _
        " AND (PrMsPeriodDeductions.PrdDed_IsActive = 'Y')" & _
        " AND (PrMsDeductionCodes.DedTyp_Code = 'IT')"
        '" AND (PrTxTrxnHeader.PayCat_Code = 'K')" & _

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Count = Ds.Tables(0).Rows.Count
        Else
            Count = 0
        End If
        Return Count
    End Function
    Protected Function GetWorkedPeriodsUntilNowTaxOrNoTax(ByVal EmpCode As String, ByVal PeriodGroup As String) As Integer
        Dim Str As String
        Dim Ds As DataSet
        Dim Count As Integer = 0
        Str = "select * from prtxtrxnheader" & _
            " where emp_code=" & enQuoteString(EmpCode) & _
            " and PrdGrp_Code=" & enQuoteString(PeriodGroup) & _
            " and trxhdr_status='POST'"
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Count = Ds.Tables(0).Rows.Count
        Else
            Count = 0
        End If
        Return Count
    End Function
    Protected Function FindYTD(ByVal Type As String, ByVal E_Code As String, ByVal D_Code As String, ByVal C_Code As String, ByVal Employee_Code As String, ByVal Period_Code As String, ByVal HdrId As Integer) As DataSet
        Dim Str As String = ""
        Select Case Type
            Case "E"
                Str = "SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue) AS Expr1" & _
                " FROM   PrTxTrxnLines INNER JOIN" & _
                " PrTxTrxnHeader ON" & _
                " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                " WHERE (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(E_Code) & ")" & _
                " AND (PrTxTrxnLines.TrxHdr_Id <" & HdrId & ")" & _
                " AND (PrTxTrxnHeader.Emp_Code = " & enQuoteString(Employee_Code) & ")"

            Case "D"
                Str = "SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue) AS Expr1" & _
               " FROM   PrTxTrxnLines INNER JOIN" & _
               " PrTxTrxnHeader ON" & _
               " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
               " WHERE (PrTxTrxnLines.DedCod_Code = " & enQuoteString(D_Code) & ")" & _
               " AND (PrTxTrxnLines.TrxHdr_Id <" & HdrId & ")" & _
               " AND (PrTxTrxnHeader.Emp_Code = " & enQuoteString(Employee_Code) & ")"

            Case "C"
                Str = "SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue) AS Expr1" & _
               " FROM   PrTxTrxnLines INNER JOIN" & _
               " PrTxTrxnHeader ON" & _
               " PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
               " WHERE (PrTxTrxnLines.ConCod_Code = " & enQuoteString(C_Code) & ")" & _
               " AND (PrTxTrxnLines.TrxHdr_Id <" & HdrId & ")" & _
               " AND (PrTxTrxnHeader.Emp_Code = " & enQuoteString(Employee_Code) & ")"

        End Select

        Return GetData(Str)


    End Function
    Public Function FindHeaderYTD(ByVal EmpCode As String, ByVal PerGrp As String, ByVal TempGrp As String, ByVal Per As String) As DataSet
        Dim Str As String
        Str = " SELECT SUM(TrxHdr_PeriodUnits), " & _
            " SUM(TrxHdr_TotalErnPeriod)," & _
            " SUM(TrxHdr_TotalDedPeriod)," & _
            " SUM(TrxHdr_TotalConPeriod) " & _
            " from PrTxTrxnHeader where TemGrp_Code =" & enQuoteString(TempGrp) & _
            " and PrdGrp_Code=" & enQuoteString(PerGrp) & _
            " and Emp_Code=" & enQuoteString(EmpCode)
        Return GetData(Str)
    End Function
    Protected Function Get14nthPeriodSequence(ByVal Period As cPrMsPeriodCodes) As Integer
        Dim Str As String
        Dim Ds As DataSet
        Dim Sequence As Integer = 999
        Str = " select prdcod_sequence from prmsperiodcodes" & _
            " where PrdGrp_Code=" & enQuoteString(Period.PrdGrpCode) & " and" & _
            " PayCat_Code='4'"
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Sequence = DbNullToInt(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Sequence

    End Function

    Protected Function Get14nthTotalAnnualUnits(ByVal Period As cPrMsPeriodCodes) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim PeriodUnits As Double = 0
        Str = " select prdcod_PeriodUnits from prmsperiodcodes" & _
            " where PrdGrp_Code=" & enQuoteString(Period.PrdGrpCode) & " and" & _
            " PayCat_Code='4'"
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            PeriodUnits = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))

        End If
        Return PeriodUnits

    End Function
    Public Shadows Function FindEmployeeCode(ByVal EmployeeMappCode As String, ByVal GLnumber As Integer) As String
        Dim str As String
        Dim Str2 As String = ""
        Dim Ds As DataSet
        Dim EmpCode As String = ""
        str = "Select Emp_Code from PrMsEmployees where Emp_Code=" & enQuoteString(EmployeeMappCode)

        'Select Case GLnumber
        '    Case 1
        '        Str2 = " Emp_GLanal1=" & enQuoteString(EmployeeMappCode)
        '    Case 2
        '        Str2 = " Emp_GLanal2=" & enQuoteString(EmployeeMappCode)
        '    Case 3
        '        Str2 = " Emp_GLanal3=" & enQuoteString(EmployeeMappCode)
        '    Case 4
        '        Str2 = " Emp_GLanal4=" & enQuoteString(EmployeeMappCode)
        'End Select
        'str = str & Str2

        Ds = GetData(str)
        If CheckDataSet(Ds) Then
            EmpCode = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return EmpCode

    End Function
    Protected Function CalculateEmployeeAdvancesFromTable(ByVal EmpCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Amount As Double = 0

        Str = " select SUM(empadv_amount) from " & _
              " prtxemployeeadvances" & _
              " where Emp_Code=" & enQuoteString(EmpCode)

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Amount = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If

        Return Amount


    End Function
    Protected Function FindAllEmployeesForPension(ByVal PensionAge As Integer, ByVal TempCode As String) As DataSet
        Dim Str As String
        Dim Date1 As String
        Date1 = Utils.ChangeDateFormatForSearch(Format(Now.Date, "yyyy-MM-dd"))
        'Str = "SELECT emp_code,Emp_fullname,Emp_BirthDate,Sic_Code ,SocInc_Code from PrMsEmployees " & _
        '"where datediff(""YEAR"" ,Emp_BirthDate ," & enQuoteString(Date1) & ")>= " & PensionAge & _
        '" and Sic_Code <>'M2'" & _
        '"and Emp_Status ='A'" & _
        '" And TemGrp_Code= " & enQuoteString(TempCode)

        Str = "SELECT emp_code,Emp_fullname,Emp_BirthDate,Sic_Code ,SocInc_Code from PrMsEmployees " & _
       "where datediff(""HOUR"" ,Emp_BirthDate ," & enQuoteString(Date1) & ")/8766.0 >= " & PensionAge & _
       " and Sic_Code <>'M2'" & _
       "and Emp_Status ='A'" & _
       " And TemGrp_Code= " & enQuoteString(TempCode)

        Return GetData(Str)

    End Function
    Protected Function FindAllEmployeesForPF(ByVal PFReminder As Integer, ByVal TempCode As String) As DataSet
        Dim Str As String
        Dim Date1 As String
        Date1 = Utils.ChangeDateFormatForSearch(Format(Now.Date, "yyyy-MM-dd"))
        'Str = "SELECT emp_code,Emp_fullname,Emp_BirthDate,Sic_Code ,SocInc_Code from PrMsEmployees " & _
        '"where datediff(""YEAR"" ,Emp_BirthDate ," & enQuoteString(Date1) & ")>= " & PensionAge & _
        '" and Sic_Code <>'M2'" & _
        '"and Emp_Status ='A'" & _
        '" And TemGrp_Code= " & enQuoteString(TempCode)

        Str = "SELECT emp_code,Emp_fullname,Emp_BirthDate,Sic_Code ,SocInc_Code from PrMsEmployees " & _
       " where abs(datediff(""MONTH"" ,Emp_StartDate ," & enQuoteString(Date1) & ")) = " & PFReminder & _
       " and Emp_Status ='A'" & _
       " And TemGrp_Code= " & enQuoteString(TempCode)

        Return GetData(Str)

    End Function
    Protected Function UpdateAnnualLeaveHeaderId(ByVal EmpCode As String, ByVal HdrId As Integer)
        Dim Str As String
        Str = "Update PrTxEmployeeLeave set Hdr_Id=" & HdrId & _
        " Where Emp_Code=" & enQuoteString(EmpCode) & _
        " AND Hdr_Id =-1"

        MyBase.ExecuteNonQuery(Str)

    End Function
    Public Shadows Function GetUserPermitions(ByVal CompanyCode As String, ByVal User As String, ByVal GetDefaults As Boolean) As DataSet
        Dim Str As String
        If GetDefaults Then
            User = "sa"
            CompanyCode = ""
        End If
        Str = " SELECT UsrAth_Id," & _
       " Com_Code," & _
       " Usr_Code," & _
       " UsrAth_Entity," & _
       " UsrAth_Full," & _
       " UsrAth_ReadOnly," & _
       " UsrAth_No" & _
       " FROM PrSsUserPermition" & _
       " Where Com_Code=" & enQuoteString(CompanyCode) & _
       " AND Usr_Code=" & enQuoteString(User) & _
       " Order by UsrAth_Id "

        Return GetData(Str)
    End Function

    Public Function GetTerminatedEmployeeswithStatusActive(ByVal CurrentPeriod As cPrMsPeriodCodes, ByVal TemplateGroupCode As String) As DataSet



        Dim Str As String
        Dim PerCode As String = ""
        Dim PerGrp As String = ""
        Str = "SELECT TOP (1) PrTxTrxnHeader.PrdCod_Code,PrTxTrxnHeader.PrdGrp_Code," & _
        " PrMsPeriodCodes.PayCat_Code " & _
        " FROM  PrTxTrxnHeader INNER JOIN " & _
        " PrMsPeriodCodes ON PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code " & _
        " AND PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code " & _
        " AND PrMsPeriodCodes.PayCat_Code <> " & enQuoteString(CurrentPeriod.Code) & _
        " WHERE (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemplateGroupCode) & ") " & _
        " ORDER BY PrTxTrxnHeader.TrxHdr_Id DESC"


        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            PerCode = DbNullToString(ds.Tables(0).Rows(0).Item(0))
            PerGrp = DbNullToString(ds.Tables(0).Rows(0).Item(1))
        End If

        Str = "SELECT  " & _
        " PrMsEmployees.Emp_Code AS EmpCode, " & _
        " PrMsEmployees.Emp_LastName as LastName," & _
        " PrMsEmployees.Emp_FirstName as FirstName, " & _
        " PrMsEmployees.Emp_Status as Status, " & _
        " PrMsEmployees.Emp_TerminateDate as TerminationDate" & _
        " FROM PrTxTrxnHeader INNER JOIN " & _
        " PrMsEmployees ON PrTxTrxnHeader.Emp_Code = PrMsEmployees.Emp_Code " & _
        " WHERE PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemplateGroupCode) & _
        " and PrMsEmployees.Emp_TerminateDate <>'' " & _
        " and PrTxTrxnHeader.PrdCod_Code=" & enQuoteString(PerCode) & _
        " and PrTxTrxnHeader.PrdGrp_Code= " & enQuoteString(PerGrp) & _
        " and PrMsEmployees.Emp_Status= 'A'"

        Return GetData(Str)

    End Function
    Public Sub SetEmpStatusToInactive(ByVal EmpCode As String)
        Dim Str As String
        Str = "Update PrMsEmployees set Emp_Status='I' where emp_code=" & enQuoteString(EmpCode)
        MyBase.ExecuteNonQuery(Str)
    End Sub
#End Region
#Region "Navision Payroll Cost"
    Protected Function GetALReportForAllemployees(ByVal PerGroup As cPrMsPeriodGroups, ByVal Per As cPrMsPeriodCodes) As DataSet
        Dim Str As String
        Dim FromDate As String = Utils.ChangeDateFormatForSearch(Format(Per.DateFrom, "yyyy-MM-dd"))
        Dim ToDate As String = Utils.ChangeDateFormatForSearch(Format(Per.DateTo, "yyyy-MM-dd"))

        Str = " SELECT PrTxEmployeeLeave.Emp_Code, " & _
                " PrTxEmployeeLeave.EmpLea_Type, " & _
                " SUM(PrTxEmployeeLeave.EmpLea_Units) AS Expr1 " & _
                " FROM PrTxEmployeeLeave INNER JOIN " & _
                " PrMsEmployees ON PrTxEmployeeLeave.Emp_Code = PrMsEmployees.Emp_Code " & _
                " WHERE (PrTxEmployeeLeave.EmpLea_Status = 'Approved') " & _
                " AND (PrTxEmployeeLeave.EmpLea_Action = 'DE') " & _
                " AND (PrTxEmployeeLeave.EmpLea_FromDate >= " & enQuoteString(FromDate) & ") " & _
                " AND (PrTxEmployeeLeave.EmpLea_FromDate <= " & enQuoteString(ToDate) & ") " & _
                " GROUP BY PrTxEmployeeLeave.EmpLea_Type, " & _
                " PrTxEmployeeLeave.Emp_Code, " & _
                " PrMsEmployees.TemGrp_Code " & _
                " HAVING (PrMsEmployees.TemGrp_Code = " & enQuoteString(PerGroup.TemGrpCode) & ") "

        Return GetData(Str)
    End Function
    Protected Function GetLeaveReportForEmployee(ByVal EmpCode As String, ByVal Per As cPrMsPeriodCodes) As DataSet


    End Function
    Protected Function NAV_FindIfCOSTItWasInterfacedAgain(ByVal PeriodGroup As String, ByVal PeriodCode As String) As DataSet
        Dim Str As String


        Str = " SELECT * " & _
            " FROM  [" & Global1.NAV_GLBCompPrefix & "Dashboard Payroll Entry]" & _
            " WHERE (PeriodGroup = " & enQuoteString(PeriodGroup) & ")" & _
            " AND (PeriodCode = " & enQuoteString(PeriodCode) & ")"

        Return GetData(Str)

    End Function
    Protected Function NAV_InsertValuesInDashboardCost(ByVal EmpCode As String, ByVal EmpName As String, ByVal PostDate As Date, ByVal Cost As Double, ByVal Normal As Double, ByVal SILeave As Double, ByVal Sick As Double, ByVal Army As Double, ByVal Maternity As Double, ByVal Unexcused As Double, ByVal Other As Double, ByVal BALNormal As Double, ByVal BALSILeave As Double, ByVal BALSick As Double, ByVal BALArmy As Double, ByVal BALMaternity As Double, ByVal BALUnexcused As Double, ByVal BALOther As Double, ByVal PeriodCode As String, ByVal PeriodGroup As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = False
        Dim i As Integer
        Dim sPostDate As String
        sPostDate = Format(PostDate, "yyyy-MM-dd")

        Str = "INSERT INTO " & _
        " [" & Global1.NAV_GLBCompPrefix & "Dashboard Payroll Entry]" & _
        " ([Emloyee No]," & _
        " [Emloyee Name]," & _
        " [Posting Date]," & _
        " Cost, " & _
        " [Days Annual]," & _
        " [Days Annual SI]," & _
        " [Days Sick]," & _
        " [Days Army]," & _
        " [Days Maternity], " & _
        " [Days Unexcused], " & _
        " [Days Other], " & _
        " [Balance Annual]," & _
        " [Balance Annual SI]," & _
        " [Balance Sick]," & _
        " [Balance Army]," & _
        " [Balance Maternity], " & _
        " [Balance Unexcused], " & _
        " [Balance Other], " & _
        " PeriodCode, " & _
        " PeriodGroup)" & _
        " VALUES ( " & _
        enQuoteString(EmpCode) & "," & _
        enQuoteString(EmpName) & "," & _
        enQuoteString(sPostDate) & "," & _
        Cost & "," & _
        Normal & "," & _
        SILeave & "," & _
        Sick & "," & _
        Army & "," & _
        Maternity & "," & _
        Unexcused & "," & _
        Other & "," & _
        BALNormal & "," & _
        BALSILeave & "," & _
        BALSick & "," & _
        BALArmy & "," & _
        BALMaternity & "," & _
        BALUnexcused & "," & _
        BALOther & "," & _
        enQuoteString(PeriodCode) & "," & _
        enQuoteString(PeriodGroup) & ")"

        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            Flag = True
        End If
        Return Flag

    End Function
    Protected Function NAV_DeleteInterfacedDashboardValues(ByVal PeriodGroup As String, ByVal PeriodCode As String)
        Dim Str As String
        Dim i As Integer
        Dim Flag As Boolean = False
        Str = " Delete FROM  [" & Global1.NAV_GLBCompPrefix & "Dashboard Payroll Entry]" & _
            " WHERE (PeriodGroup = " & enQuoteString(PeriodGroup) & ")" & _
            " AND (PeriodCode = " & enQuoteString(PeriodCode) & ")"
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            Flag = True
        Else
            Flag = False
        End If
        Return Flag
    End Function

#End Region
    Public Shadows Function FixEmployeeYTD(ByVal EmpCode As String, ByVal PeriodGroup As String) As DataSet
        Dim Ds As DataSet
        Dim Str As String
        Str = "select Trxhdr_id," & _
                " TrxLin_id," & _
                " erncod_code," & _
                " TrxLin_PeriodValue" & _
                " from PrTxTrxnLines " & _
                " where TrxHdr_Id in" & _
                " (Select Trxhdr_id from PrTxTrxnHeader where Emp_Code=" & enQuoteString(EmpCode) & _
                 " And PrdGrp_code=" & enQuoteString(PeriodGroup) & ")" & _
                " and TrxLin_Type ='E'" & _
                " Order by TrxHdr_Id,TrxLin_Id  asc"
        Ds = GetData(Str)
        Dim i As Integer
        Dim k As Integer
        Dim HdrId As Integer
        Dim DsI As DataSet
        Dim LinId As Integer
        Dim Code As String
        Dim Value As Double
        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                HdrId = Ds.Tables(0).Rows(i).Item(0)
                LinId = Ds.Tables(0).Rows(i).Item(1)
                Code = Ds.Tables(0).Rows(i).Item(2)
                Value = Ds.Tables(0).Rows(i).Item(3)
                Str = "select Trxhdr_id," & _
                " TrxLin_id," & _
                " erncod_code," & _
                " TrxLin_PeriodValue" & _
                " from PrTxTrxnLines " & _
                " where TrxHdr_Id in" & _
                " (Select Trxhdr_id from PrTxTrxnHeader where Emp_Code=" & enQuoteString(EmpCode) & _
                " And PrdGrp_code=" & enQuoteString(PeriodGroup) & ")" & _
                " and TrxLin_Type ='E'" & _
                " and ErnCod_Code =" & enQuoteString(Code) & _
                " and TrxHdr_Id < " & HdrId
                DsI = GetData(Str)
                Dim Total As Double = 0
                If CheckDataSet(DsI) Then
                    For k = 0 To DsI.Tables(0).Rows.Count - 1
                        Total = Total + DsI.Tables(0).Rows(k).Item(3)
                    Next
                End If
                Value = Value + Total
                Str = "update PrTxTrxnLines SET " & _
                " TrxLin_YTDValue = " & Value & _
                " where TrxHdr_Id = " & HdrId & _
                " and TrxLin_Id=" & LinId
                MyBase.ExecuteNonQuery(Str)

            Next

        End If

        '''''''''''''''''''''''''''
        'DEDUCTIONS
        '''''''''''''''''''''''''''
        Str = "select Trxhdr_id," & _
                " TrxLin_id," & _
                " dedcod_code," & _
                " TrxLin_PeriodValue" & _
                " from PrTxTrxnLines " & _
                " where TrxHdr_Id in" & _
                " (Select Trxhdr_id from PrTxTrxnHeader where Emp_Code=" & enQuoteString(EmpCode) & _
                " And PrdGrp_code=" & enQuoteString(PeriodGroup) & ")" & _
                " and TrxLin_Type ='D'" & _
                " Order by TrxHdr_Id,TrxLin_Id  asc"
        Ds = GetData(Str)

        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                HdrId = Ds.Tables(0).Rows(i).Item(0)
                LinId = Ds.Tables(0).Rows(i).Item(1)
                Code = Ds.Tables(0).Rows(i).Item(2)
                Value = Ds.Tables(0).Rows(i).Item(3)
                Str = "select Trxhdr_id," & _
                " TrxLin_id," & _
                " dedcod_code," & _
                " TrxLin_PeriodValue" & _
                " from PrTxTrxnLines " & _
                " where TrxHdr_Id in" & _
                " (Select Trxhdr_id from PrTxTrxnHeader where Emp_Code=" & enQuoteString(EmpCode) & _
                " And PrdGrp_code=" & enQuoteString(PeriodGroup) & ")" & _
                " and TrxLin_Type ='D'" & _
                " and DedCod_Code =" & enQuoteString(Code) & _
                " and TrxHdr_Id < " & HdrId
                DsI = GetData(Str)
                Dim Total As Double = 0
                If CheckDataSet(DsI) Then
                    For k = 0 To DsI.Tables(0).Rows.Count - 1
                        Total = Total + DsI.Tables(0).Rows(k).Item(3)
                    Next
                End If
                Value = Value + Total
                Str = "update PrTxTrxnLines SET " & _
                " TrxLin_YTDValue = " & Value & _
                " where TrxHdr_Id = " & HdrId & _
                " and TrxLin_Id=" & LinId
                MyBase.ExecuteNonQuery(Str)

            Next

        End If
        '''''''''''''''''''''''''''''''''
        'Contributions
        '''''''''''''''''''''''''''''''''
        Str = "select Trxhdr_id," & _
             " TrxLin_id," & _
             " concod_code," & _
             " TrxLin_PeriodValue" & _
             " from PrTxTrxnLines " & _
             " where TrxHdr_Id in" & _
             " (Select Trxhdr_id from PrTxTrxnHeader where Emp_Code=" & enQuoteString(EmpCode) & _
             " And PrdGrp_code=" & enQuoteString(PeriodGroup) & ")" & _
             " and TrxLin_Type ='C'" & _
             " Order by TrxHdr_Id,TrxLin_Id  asc"
        Ds = GetData(Str)

        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                HdrId = Ds.Tables(0).Rows(i).Item(0)
                LinId = Ds.Tables(0).Rows(i).Item(1)
                Code = Ds.Tables(0).Rows(i).Item(2)
                Value = Ds.Tables(0).Rows(i).Item(3)
                Str = "select Trxhdr_id," & _
                " TrxLin_id," & _
                " concod_code," & _
                " TrxLin_PeriodValue" & _
                " from PrTxTrxnLines " & _
                " where TrxHdr_Id in" & _
                " (Select Trxhdr_id from PrTxTrxnHeader where Emp_Code=" & enQuoteString(EmpCode) & _
                " And PrdGrp_code=" & enQuoteString(PeriodGroup) & ")" & _
                " and TrxLin_Type ='C'" & _
                " and ConCod_Code =" & enQuoteString(Code) & _
                " and TrxHdr_Id < " & HdrId
                DsI = GetData(Str)
                Dim Total As Double = 0
                If CheckDataSet(DsI) Then
                    For k = 0 To DsI.Tables(0).Rows.Count - 1
                        Total = Total + DsI.Tables(0).Rows(k).Item(3)
                    Next
                End If
                Value = Value + Total
                Str = "update PrTxTrxnLines SET " & _
                " TrxLin_YTDValue = " & Value & _
                " where TrxHdr_Id = " & HdrId & _
                " and TrxLin_Id=" & LinId
                MyBase.ExecuteNonQuery(Str)

            Next

        End If

        Str = "select Trxhdr_id," & _
              " TrxHdr_TotalErnPeriod, " & _
              " TrxHdr_TotaldedPeriod ," & _
              " TrxHdr_TotalConPeriod " & _
              " from PrTxTrxnheader" & _
              " where Emp_Code=" & enQuoteString(EmpCode) & _
             " And PrdGrp_code=" & enQuoteString(PeriodGroup)
        Ds = GetData(Str)
        Dim ValErn As Double
        Dim ValDed As Double
        Dim ValCon As Double

        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                HdrId = Ds.Tables(0).Rows(i).Item(0)
                ValErn = Ds.Tables(0).Rows(i).Item(1)
                ValDed = Ds.Tables(0).Rows(i).Item(2)
                ValCon = Ds.Tables(0).Rows(i).Item(3)
                Str = "select Trxhdr_id," & _
                " TrxHdr_TotalErnPeriod, " & _
                " TrxHdr_TotaldedPeriod ," & _
                " TrxHdr_TotalConPeriod " & _
                " from PrTxTrxnheader" & _
                " where Emp_Code=" & enQuoteString(EmpCode) & _
                " And PrdGrp_code=" & enQuoteString(PeriodGroup) & _
                " and TrxHdr_Id < " & HdrId
                DsI = GetData(Str)
                Dim TotalErn As Double = 0
                Dim TotalDed As Double = 0
                Dim TotalCon As Double = 0
                If CheckDataSet(DsI) Then
                    For k = 0 To DsI.Tables(0).Rows.Count - 1
                        TotalErn = TotalErn + DsI.Tables(0).Rows(k).Item(1)
                        TotalDed = TotalDed + DsI.Tables(0).Rows(k).Item(2)
                        TotalCon = TotalCon + DsI.Tables(0).Rows(k).Item(3)
                    Next
                End If
                ValErn = ValErn + TotalErn
                ValDed = ValDed + TotalDed
                ValCon = ValCon + TotalCon
                Str = "update PrTxTrxnheader SET " & _
                " TrxHdr_TotalernYTD = " & ValErn & _
                " ,TrxHdr_TotaldedYTD = " & ValDed & _
                " ,TrxHdr_TotalConYTD = " & ValCon & _
                " where TrxHdr_Id = " & HdrId

                MyBase.ExecuteNonQuery(Str)

            Next
        End If

    End Function
    Public Function FindNonInsurableTotalForTemplateGroupPeriodEmployee(ByVal TemGrp As String, ByVal PeriodGroup As String, ByVal EmpCode As String, ByVal PeriodCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Formula As String = ""
        Dim i As Integer
        Dim S As String
        Dim k As Integer
        Dim NonInsurable As Double = 0
        Str = " SELECT PrMsTemplateDeductions.TemDed_CalcFormula" & _
                " FROM PrMsTemplateDeductions INNER JOIN" & _
                " PrMsDeductionCodes ON " & _
                " PrMsTemplateDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
                " WHERE (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TemGrp) & ") " & _
                " AND (PrMsDeductionCodes.DedTyp_Code = 'SI')"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Formula = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        'Str = "select TemErn_Sequence," & _
        '" ErnCod_Code ," & _
        '" PrMsEarningCodes.ErnTyp_Code" & _
        '" FROM PrMsTemplateEarnings" & _
        '" WHERE TemGrp_Code=" & enQuoteString(TemGrp)

        Str = " SELECT  PrMsTemplateEarnings.TemErn_Sequence," & _
           " PrMsTemplateEarnings.ErnCod_Code," & _
           " PrMsEarningCodes.ErnTyp_Code" & _
           " FROM PrMsTemplateEarnings INNER JOIN" & _
           " PrMsEarningCodes ON PrMsTemplateEarnings.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
           " WHERE (PrMsTemplateEarnings.TemGrp_Code = " & enQuoteString(TemGrp) & ")"

        Dim DsEarn As DataSet
        Dim Seq As String
        Dim Found As Boolean = False
        Dim StrNonIns As String = ""
        Dim StrNonIns2 As String = ""
        DsEarn = GetData(Str)

        If CheckDataSet(DsEarn) Then
            For k = 0 To DsEarn.Tables(0).Rows.Count - 1
                Seq = DsEarn.Tables(0).Rows(k).Item(0)
                For i = 0 To Formula.Length - 1
                    S = Formula.Substring(i, 1)
                    If S = Seq Then
                        Found = True
                        Exit For
                    End If
                Next
                If Not Found Then
                    If StrNonIns = "" Then
                        StrNonIns = DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = DsEarn.Tables(0).Rows(k).Item(2)
                    Else
                        StrNonIns = StrNonIns & "|" & DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = StrNonIns2 & "|" & DsEarn.Tables(0).Rows(k).Item(2)
                    End If
                End If
                Found = False
            Next
            S = ""
            If StrNonIns <> "" Then
                S = ""
                Dim Ar() As String
                Ar = StrNonIns.Split("|")


                Dim Ar2() As String
                Ar2 = StrNonIns2.Split("|")

                For i = 0 To Ar.Length - 1
                    'change 26/03/2020 added B2
                    If Trim(Ar2(i)) <> "3E" And Trim(Ar2(i)) <> "4E" And Ar2(i) <> "E99" And Trim(Ar2(i)) <> "LP" And Trim(Ar2(i)) <> "BK" And Trim(Ar2(i)) <> "BR" And Trim(Ar2(i)) <> "B2" Then
                        'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E99" And Ar(i) <> "E16" Then
                        If Ar(i) <> Global1.PARAM_CobaltALCode Then
                            If S = "" Then
                                S = " ((PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                            Else

                                S = S & " OR " & " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                            End If
                        End If
                    End If
                Next
            End If
            If S <> "" Then
                S = S & " )"
                Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnLines INNER JOIN" & _
                    " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                    " WHERE  (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ") AND" & _
                    " (PrTxTrxnHeader.Prdcod_Code = " & enQuoteString(PeriodCode) & " )AND " & _
                    " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") AND " & _
                    " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp) & ") AND "

                Str = Str & S


                Dim Ds2 As DataSet
                Ds2 = GetData(Str)
                If CheckDataSet(Ds2) Then
                    NonInsurable = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))
                End If
            End If
        End If

        Return NonInsurable

    End Function
    Public Function FindNonInsurableTotalForTemplateGroupPeriodEmployee_New14(ByVal TemGrp As String, ByVal PeriodGroup As String, ByVal EmpCode As String, ByVal PeriodCode As String, ByVal SIPeriodCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Formula As String = ""
        Dim i As Integer
        Dim S As String
        Dim k As Integer
        Dim NonInsurable As Double = 0
        Str = " SELECT PrMsTemplateDeductions.TemDed_CalcFormula" & _
                " FROM PrMsTemplateDeductions INNER JOIN" & _
                " PrMsDeductionCodes ON " & _
                " PrMsTemplateDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
                " WHERE (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TemGrp) & ") " & _
                " AND (PrMsDeductionCodes.DedTyp_Code = 'SI')"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Formula = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        'Str = "select TemErn_Sequence," & _
        '" ErnCod_Code ," & _
        '" PrMsEarningCodes.ErnTyp_Code" & _
        '" FROM PrMsTemplateEarnings" & _
        '" WHERE TemGrp_Code=" & enQuoteString(TemGrp)

        Str = " SELECT  PrMsTemplateEarnings.TemErn_Sequence," & _
           " PrMsTemplateEarnings.ErnCod_Code," & _
           " PrMsEarningCodes.ErnTyp_Code" & _
           " FROM PrMsTemplateEarnings INNER JOIN" & _
           " PrMsEarningCodes ON PrMsTemplateEarnings.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
           " WHERE (PrMsTemplateEarnings.TemGrp_Code = " & enQuoteString(TemGrp) & ")"

        Dim DsEarn As DataSet
        Dim Seq As String
        Dim Found As Boolean = False
        Dim StrNonIns As String = ""
        Dim StrNonIns2 As String = ""
        DsEarn = GetData(Str)

        If CheckDataSet(DsEarn) Then
            For k = 0 To DsEarn.Tables(0).Rows.Count - 1
                Seq = DsEarn.Tables(0).Rows(k).Item(0)
                For i = 0 To Formula.Length - 1
                    S = Formula.Substring(i, 1)
                    If S = Seq Then
                        Found = True
                        Exit For
                    End If
                Next
                If Not Found Then
                    If StrNonIns = "" Then
                        StrNonIns = DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = DsEarn.Tables(0).Rows(k).Item(2)
                    Else
                        StrNonIns = StrNonIns & "|" & DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = StrNonIns2 & "|" & DsEarn.Tables(0).Rows(k).Item(2)
                    End If
                End If
                Found = False
            Next
            S = ""
            If StrNonIns <> "" Then
                S = ""
                Dim Ar() As String
                Ar = StrNonIns.Split("|")


                Dim Ar2() As String
                Ar2 = StrNonIns2.Split("|")

                For i = 0 To Ar.Length - 1
                    If Trim(Ar2(i)) <> "3E" And Trim(Ar2(i)) <> "4E" And Ar2(i) <> "E99" And Trim(Ar2(i)) <> "LP" And Trim(Ar2(i)) <> "BK" And Trim(Ar2(i)) <> "BR" And Trim(Ar2(i)) <> "B2" Then
                        'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E99" And Ar(i) <> "E16" Then
                        If Ar(i) <> Global1.PARAM_CobaltALCode Then
                            If S = "" Then
                                S = "  ((PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                            Else

                                S = S & " OR " & " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                            End If
                        End If
                    End If
                Next
            End If
            If S <> "" Then
                S = S & " )"
                Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnLines INNER JOIN" & _
                    " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                    " WHERE  (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ") AND" & _
                    " (PrTxTrxnHeader.Prdcod_Code in " & _
                    " ( Select PrdCod_Code  from PrMsPeriodCodes where PrdGrp_Code = " & enQuoteString(PeriodGroup) & _
                    " AND SinPrd_Code  =" & enQuoteString(SIPeriodCode) & ")) AND " & _
                    " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") AND " & _
                    " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp) & ") AND "

                Str = Str & S


                Dim Ds2 As DataSet
                Ds2 = GetData(Str)
                If CheckDataSet(Ds2) Then
                    NonInsurable = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))
                End If
            End If
        End If

        Return NonInsurable
    End Function
    Public Function FindNonInsurableTotalForTemplateGroupPeriodEmployee_Company(ByVal DsPeriods As DataSet, ByVal EmpCode As String) As Double

        Dim Str1 As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim str4 As String = ""
        Dim Str5 As String = ""
        Dim Str6 As String = ""
        Dim i As Integer

        If CheckDataSet(DsPeriods) Then

            Dim PerCode As String
            Dim PerGrp As String
            Dim TemGrpCode As String

            For i = 0 To DsPeriods.Tables(0).Rows.Count - 1
                PerCode = DbNullToString(DsPeriods.Tables(0).Rows(i).Item(0))
                PerGrp = DbNullToString(DsPeriods.Tables(0).Rows(i).Item(1))
                TemGrpCode = DbNullToString(DsPeriods.Tables(0).Rows(i).Item(12))

                If i = 0 Then
                    Str1 = " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode)
                    Str2 = " AND (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrp)
                    Str3 = " AND (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
                    Str5 = " (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TemGrpCode)
                    str6 = " (PrMsTemplateEarnings.TemGrp_Code = " & enQuoteString(TemGrpCode)
                Else
                    Str1 = Str1 & " OR PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrpCode)
                    Str2 = Str2 & " OR PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PerGrp)
                    Str3 = Str3 & " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(PerCode)
                    Str5 = Str5 & " OR PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TemGrpCode)
                    Str6 = Str6 & " OR PrMsTemplateEarnings.TemGrp_Code = " & enQuoteString(TemGrpCode)
                End If
            Next
            Str1 = Str1 & " )"
            Str2 = Str2 & " )"
            Str3 = Str3 & " )"
            Str5 = Str5 & " )"
            Str6 = Str6 & " )"
        End If

        Dim NonInsurable As Double

        'find header
        Dim Hstr As String
        Hstr = " Select * from PrtxtrxnHeader Where Emp_Code=" & enQuoteString(EmpCode)
        Hstr = Hstr & " AND " & Str1 & Str2 & Str3
        Dim Hds As DataSet
        Hds = GetData(Hstr)
        If CheckDataSet(Hds) Then
            Dim TemGrp As String
            Dim PeriodGroup As String
            Dim PeriodCode As String
            PeriodGroup = DbNullToString(Hds.Tables(0).Rows(0).Item(2))
            PeriodCode = DbNullToString(Hds.Tables(0).Rows(0).Item(3))
            TemGrp = DbNullToString(Hds.Tables(0).Rows(0).Item(29))

            NonInsurable = Me.FindNonInsurableTotalForTemplateGroupPeriodEmployee(TemGrp, PeriodGroup, EmpCode, PeriodCode)
        Else
            NonInsurable = 0
        End If


        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''


        'Dim Str As String
        'Dim Ds As DataSet
        'Dim Formula As String = ""
        'Dim S As String
        'Dim k As Integer
        'Dim NonInsurable As Double = 0
        'Str = " SELECT PrMsTemplateDeductions.TemDed_CalcFormula" & _
        '        " FROM PrMsTemplateDeductions INNER JOIN" & _
        '        " PrMsDeductionCodes ON " & _
        '        " PrMsTemplateDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
        '        " WHERE "
        'str4 = " AND (PrMsDeductionCodes.DedTyp_Code = 'SI')"

        'Str = Str & Str5 & str4

        'Ds = GetData(Str)
        'If CheckDataSet(Ds) Then
        '    Formula = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        'End If
        ''Str = "select TemErn_Sequence," & _
        ''" ErnCod_Code ," & _
        ''" PrMsEarningCodes.ErnTyp_Code" & _
        ''" FROM PrMsTemplateEarnings" & _
        ''" WHERE TemGrp_Code=" & enQuoteString(TemGrp)

        'Str = " SELECT  PrMsTemplateEarnings.TemErn_Sequence," & _
        '   " PrMsTemplateEarnings.ErnCod_Code," & _
        '   " PrMsEarningCodes.ErnTyp_Code" & _
        '   " FROM PrMsTemplateEarnings INNER JOIN" & _
        '   " PrMsEarningCodes ON PrMsTemplateEarnings.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
        '   " WHERE "
        'Str = Str & Str6

        'Dim DsEarn As DataSet
        'Dim Seq As String
        'Dim Found As Boolean = False
        'Dim StrNonIns As String = ""
        'Dim StrNonIns2 As String = ""
        'DsEarn = GetData(Str)

        'If CheckDataSet(DsEarn) Then
        '    For k = 0 To DsEarn.Tables(0).Rows.Count - 1
        '        Seq = DsEarn.Tables(0).Rows(k).Item(0)
        '        For i = 0 To Formula.Length - 1
        '            S = Formula.Substring(i, 1)
        '            If S = Seq Then
        '                Found = True
        '                Exit For
        '            End If
        '        Next
        '        If Not Found Then
        '            If StrNonIns = "" Then
        '                StrNonIns = DsEarn.Tables(0).Rows(k).Item(1)
        '                StrNonIns2 = DsEarn.Tables(0).Rows(k).Item(2)
        '            Else
        '                StrNonIns = StrNonIns & "|" & DsEarn.Tables(0).Rows(k).Item(1)
        '                StrNonIns2 = StrNonIns2 & "|" & DsEarn.Tables(0).Rows(k).Item(2)
        '            End If
        '        End If
        '        Found = False
        '    Next
        '    S = ""
        '    If StrNonIns <> "" Then
        '        S = ""
        '        Dim Ar() As String
        'Ar = StrNonIns.Split("|")


        'Dim Ar2() As String
        'Ar2 = StrNonIns2.Split("|")

        'For i = 0 To Ar.Length - 1
        '    If Trim(Ar2(i)) <> "3E" And Trim(Ar2(i)) <> "4E" And Ar2(i) <> "E99" And Trim(Ar2(i)) <> "LP" And Trim(Ar2(i)) <> "BK" And Trim(Ar2(i)) <> "BR" Then
        '        'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E99" And Ar(i) <> "E16" Then

        '        If S = "" Then
        '            S = " ((PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
        '        Else

        '            S = S & " OR " & " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
        '        End If

        '    End If
        'Next
        '    End If
        'If S <> "" Then
        'S = S & " )"
        'Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
        '    " FROM PrTxTrxnLines INNER JOIN" & _
        '    " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
        '    " WHERE  "


        'str4 = " and (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") "


        'Str = Str() & Str1 & Str2 & Str3 & str4 & " and " & S


        'Dim Ds2 As DataSet
        'Ds2 = GetData(Str)
        'If CheckDataSet(Ds2) Then
        '    NonInsurable = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))
        'End If
        'End If
        'End If

        Return NonInsurable
    End Function
    Public Function FindNonTaxableTotalForTemplateGroupPeriodEmployee(ByVal TemGrp As String, ByVal PeriodGroup As String, ByVal EmpCode As String, ByVal PeriodCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Formula As String = ""
        Dim i As Integer
        Dim S As String
        Dim k As Integer
        Dim NonTaxable As Double = 0
        Str = " SELECT PrMsTemplateDeductions.TemDed_CalcFormula" & _
                " FROM PrMsTemplateDeductions INNER JOIN" & _
                " PrMsDeductionCodes ON " & _
                " PrMsTemplateDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
                " WHERE (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TemGrp) & ") " & _
                " AND (PrMsDeductionCodes.DedTyp_Code = 'IT')"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Formula = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        Str = "select TemErn_Sequence," & _
        " ErnCod_Code " & _
        " FROM PrMsTemplateEarnings" & _
        " WHERE TemGrp_Code=" & enQuoteString(TemGrp)
        Dim DsEarn As DataSet
        Dim Seq As String
        Dim Found As Boolean = False
        Dim StrNonIns As String = ""
        DsEarn = GetData(Str)
        If CheckDataSet(DsEarn) Then
            For k = 0 To DsEarn.Tables(0).Rows.Count - 1
                Seq = DsEarn.Tables(0).Rows(k).Item(0)
                For i = 0 To Formula.Length - 1
                    S = Formula.Substring(i, 1)
                    If S = Seq Then
                        Found = True
                        Exit For
                    End If
                Next
                If Not Found Then
                    If StrNonIns = "" Then
                        StrNonIns = DsEarn.Tables(0).Rows(k).Item(1)
                    Else
                        StrNonIns = StrNonIns & "|" & DsEarn.Tables(0).Rows(k).Item(1)
                    End If

                End If
                Found = False
            Next
            If StrNonIns <> "" Then
                S = ""
                Dim Ar() As String
                Ar = StrNonIns.Split("|")
                For i = 0 To Ar.Length - 1
                    If Ar(i) <> "E8" And Ar(i) <> "E9" Then

                        If S = "" Then
                            S = " ((PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        Else

                            S = " OR " & " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        End If

                    End If
                Next
            End If
            If S <> "" Then
                S = S & " )"
                Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnLines INNER JOIN" & _
                    " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                    " WHERE  (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ") AND" & _
                    " (PrTxTrxnHeader.Prdcod_Code = " & enQuoteString(PeriodCode) & " )AND " & _
                    " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") AND " & _
                    " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp) & ") AND "

                Str = Str & S


                Dim Ds2 As DataSet
                Ds2 = GetData(Str)
                If CheckDataSet(Ds2) Then
                    NonTaxable = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))
                End If
            End If
        End If

        Return NonTaxable
    End Function
    Public Function FindNonInsurableTotalForTemplateGroupForEmployee(ByVal TemGrp As String, ByVal PeriodGroup As String, ByVal EmpCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Formula As String = ""
        Dim i As Integer
        Dim S As String
        Dim k As Integer
        Dim NonInsurable As Double = 0
        Str = " SELECT PrMsTemplateDeductions.TemDed_CalcFormula" & _
                " FROM PrMsTemplateDeductions INNER JOIN" & _
                " PrMsDeductionCodes ON " & _
                " PrMsTemplateDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
                " WHERE (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TemGrp) & ") " & _
                " AND (PrMsDeductionCodes.DedTyp_Code = 'SI')"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Formula = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        Str = "select TemErn_Sequence," & _
        " ErnCod_Code " & _
        " FROM PrMsTemplateEarnings" & _
        " WHERE TemGrp_Code=" & enQuoteString(TemGrp)
        Dim DsEarn As DataSet
        Dim Seq As String
        Dim Found As Boolean = False
        Dim StrNonIns As String = ""
        DsEarn = GetData(Str)
        If CheckDataSet(DsEarn) Then
            For k = 0 To DsEarn.Tables(0).Rows.Count - 1
                Seq = DsEarn.Tables(0).Rows(k).Item(0)
                For i = 0 To Formula.Length - 1
                    S = Formula.Substring(i, 1)
                    If S = Seq Then
                        Found = True
                        Exit For
                    End If
                Next
                If Not Found Then
                    If StrNonIns = "" Then
                        StrNonIns = DsEarn.Tables(0).Rows(k).Item(1)
                    Else
                        StrNonIns = StrNonIns & "|" & DsEarn.Tables(0).Rows(k).Item(1)
                    End If

                End If
                Found = False
            Next
            S = ""
            If StrNonIns <> "" Then
                S = ""
                Dim Ar() As String
                Ar = StrNonIns.Split("|")
                For i = 0 To Ar.Length - 1
                    If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E16" And Ar(i) <> "E99" Then


                        If S = "" Then
                            S = " ((PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        Else

                            S = S & " OR " & " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        End If

                    End If
                Next
            End If
            If S <> "" Then
                S = S & " )"
                Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnLines INNER JOIN" & _
                    " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                    " WHERE  (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ") AND" & _
                    " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") AND " & _
                    " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp) & ") AND "

                Str = Str & S


                Dim Ds2 As DataSet
                Ds2 = GetData(Str)
                If CheckDataSet(Ds2) Then
                    NonInsurable = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))
                End If
            End If
        End If

        Return NonInsurable
    End Function
    Public Function FindNonTaxableTotalForTemplateGroupForEmployee(ByVal TemGrp As String, ByVal PeriodGroup As String, ByVal EmpCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Formula As String = ""
        Dim i As Integer
        Dim S As String
        Dim k As Integer
        Dim NonTaxable As Double = 0
        Str = " SELECT PrMsTemplateDeductions.TemDed_CalcFormula" & _
                " FROM PrMsTemplateDeductions INNER JOIN" & _
                " PrMsDeductionCodes ON " & _
                " PrMsTemplateDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
                " WHERE (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TemGrp) & ") " & _
                " AND (PrMsDeductionCodes.DedTyp_Code = 'IT')"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Formula = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        'Str = "select TemErn_Sequence," & _
        '" ErnCod_Code " & _
        '" FROM PrMsTemplateEarnings" & _
        '" WHERE TemGrp_Code=" & enQuoteString(TemGrp)

        Str = " SELECT  PrMsTemplateEarnings.TemErn_Sequence," & _
            " PrMsTemplateEarnings.ErnCod_Code," & _
            " PrMsEarningCodes.ErnTyp_Code" & _
            " FROM PrMsTemplateEarnings INNER JOIN" & _
            " PrMsEarningCodes ON PrMsTemplateEarnings.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            " WHERE (PrMsTemplateEarnings.TemGrp_Code = " & enQuoteString(TemGrp) & ")"

        Dim DsEarn As DataSet
        Dim Seq As String
        Dim Found As Boolean = False
        Dim StrNonIns As String = ""

        Dim StrNonIns2 As String = ""
        DsEarn = GetData(Str)
        If CheckDataSet(DsEarn) Then
            For k = 0 To DsEarn.Tables(0).Rows.Count - 1
                Seq = DsEarn.Tables(0).Rows(k).Item(0)
                For i = 0 To Formula.Length - 1
                    S = Formula.Substring(i, 1)
                    If S = Seq Then
                        Found = True
                        Exit For
                    End If
                Next
                If Not Found Then
                    If StrNonIns = "" Then
                        StrNonIns = DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = DsEarn.Tables(0).Rows(k).Item(2)
                    Else
                        StrNonIns = StrNonIns & "|" & DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = StrNonIns2 & "|" & DsEarn.Tables(0).Rows(k).Item(2)
                    End If

                End If
                Found = False
            Next
            S = ""
            If StrNonIns <> "" Then
                S = ""
                Dim Ar() As String
                Ar = StrNonIns.Split("|")
                Dim Ar2() As String
                Ar2 = StrNonIns2.Split("|")

                For i = 0 To Ar.Length - 1
                    'E16 is Annual leave provision
                    'Dim ErnCod As New cPrMsEarningCodes(Ar(i))
                    'Dim ErnTyp As New cPrSsEarningTypes(ErnCod.ErnTypCode)

                    'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E6" And Ar(i) <> "E7" And Ar(i) <> "E99" And Ar(i) <> "E16" Then
                    'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E99" And Ar(i) <> "E16" Then
                    If Trim(Ar2(i)) <> "3E" And Trim(Ar2(i)) <> "4E" And Ar2(i) <> "E99" And Trim(Ar2(i)) <> "LP" And Trim(Ar2(i)) <> "BK" And Trim(Ar2(i)) <> "BR" And Trim(Ar2(i)) <> "B2" Then

                        If S = "" Then
                            S = " ((PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        Else

                            S = S & " OR " & " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        End If

                    End If
                Next
            End If
            If S <> "" Then
                S = S & " )"
                Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnLines INNER JOIN" & _
                    " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                    " WHERE  (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ") AND" & _
                    " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") AND " & _
                    " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp) & ") AND "

                Str = Str & S


                Dim Ds2 As DataSet
                Ds2 = GetData(Str)
                If CheckDataSet(Ds2) Then
                    NonTaxable = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))
                    If NonTaxable <> 0 Then
                        '        MsgBox(EmpCode)
                    End If
                End If
            End If
        End If

        Return NonTaxable
    End Function
    Public Function FindNonTaxableTotalForTemplateGroupForEmployee_JanAndFeb(ByVal TemGrp As String, ByVal PeriodGroup As String, ByVal EmpCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Formula As String = ""
        Dim i As Integer
        Dim S As String
        Dim k As Integer
        Dim NonTaxable As Double = 0
        Str = " SELECT PrMsTemplateDeductions.TemDed_CalcFormula" & _
                " FROM PrMsTemplateDeductions INNER JOIN" & _
                " PrMsDeductionCodes ON " & _
                " PrMsTemplateDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
                " WHERE (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TemGrp) & ") " & _
                " AND (PrMsDeductionCodes.DedTyp_Code = 'IT')"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Formula = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        'Str = "select TemErn_Sequence," & _
        '" ErnCod_Code " & _
        '" FROM PrMsTemplateEarnings" & _
        '" WHERE TemGrp_Code=" & enQuoteString(TemGrp)

        Str = " SELECT  PrMsTemplateEarnings.TemErn_Sequence," & _
            " PrMsTemplateEarnings.ErnCod_Code," & _
            " PrMsEarningCodes.ErnTyp_Code" & _
            " FROM PrMsTemplateEarnings INNER JOIN" & _
            " PrMsEarningCodes ON PrMsTemplateEarnings.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            " WHERE (PrMsTemplateEarnings.TemGrp_Code = " & enQuoteString(TemGrp) & ")"

        Dim DsEarn As DataSet
        Dim Seq As String
        Dim Found As Boolean = False
        Dim StrNonIns As String = ""

        Dim StrNonIns2 As String = ""
        DsEarn = GetData(Str)
        If CheckDataSet(DsEarn) Then
            For k = 0 To DsEarn.Tables(0).Rows.Count - 1
                Seq = DsEarn.Tables(0).Rows(k).Item(0)
                For i = 0 To Formula.Length - 1
                    S = Formula.Substring(i, 1)
                    If S = Seq Then
                        Found = True
                        Exit For
                    End If
                Next
                If Not Found Then
                    If StrNonIns = "" Then
                        StrNonIns = DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = DsEarn.Tables(0).Rows(k).Item(2)
                    Else
                        StrNonIns = StrNonIns & "|" & DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = StrNonIns2 & "|" & DsEarn.Tables(0).Rows(k).Item(2)
                    End If

                End If
                Found = False
            Next
            S = ""
            If StrNonIns <> "" Then
                S = ""
                Dim Ar() As String
                Ar = StrNonIns.Split("|")
                Dim Ar2() As String
                Ar2 = StrNonIns2.Split("|")

                For i = 0 To Ar.Length - 1
                    'E16 is Annual leave provision
                    'Dim ErnCod As New cPrMsEarningCodes(Ar(i))
                    'Dim ErnTyp As New cPrSsEarningTypes(ErnCod.ErnTypCode)

                    'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E6" And Ar(i) <> "E7" And Ar(i) <> "E99" And Ar(i) <> "E16" Then
                    'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E99" And Ar(i) <> "E16" Then
                    If Trim(Ar2(i)) <> "3E" And Trim(Ar2(i)) <> "4E" And Ar2(i) <> "E99" And Trim(Ar2(i)) <> "LP" And Trim(Ar2(i)) <> "BK" And Trim(Ar2(i)) <> "BR" And Trim(Ar2(i)) <> "B2" Then

                        If S = "" Then
                            S = " AND ((PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        Else

                            S = S & " OR " & " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        End If

                    End If
                Next
            End If
            If S <> "" Then
                S = S & " )"
                Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnLines INNER JOIN" & _
                    " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                    " WHERE  (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ") AND" & _
                    " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") AND " & _
                    " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp) & ") AND " & _
                    " (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(JanPeriod) & " OR " & _
                    " PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(FebPeriod) & ")  "

                Str = Str & S


                Dim Ds2 As DataSet
                Ds2 = GetData(Str)
                If CheckDataSet(Ds2) Then
                    NonTaxable = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))
                    If NonTaxable <> 0 Then
                        '        MsgBox(EmpCode)
                    End If
                End If
            End If
        End If

        Return NonTaxable
    End Function
    Public Function FindNonTaxableTotalForTemplateGroupForEmployee_NOT_JanAndFeb(ByVal TemGrp As String, ByVal PeriodGroup As String, ByVal EmpCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Formula As String = ""
        Dim i As Integer
        Dim S As String
        Dim k As Integer
        Dim NonTaxable As Double = 0
        Str = " SELECT PrMsTemplateDeductions.TemDed_CalcFormula" & _
                " FROM PrMsTemplateDeductions INNER JOIN" & _
                " PrMsDeductionCodes ON " & _
                " PrMsTemplateDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
                " WHERE (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TemGrp) & ") " & _
                " AND (PrMsDeductionCodes.DedTyp_Code = 'IT')"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Formula = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        'Str = "select TemErn_Sequence," & _
        '" ErnCod_Code " & _
        '" FROM PrMsTemplateEarnings" & _
        '" WHERE TemGrp_Code=" & enQuoteString(TemGrp)

        Str = " SELECT  PrMsTemplateEarnings.TemErn_Sequence," & _
            " PrMsTemplateEarnings.ErnCod_Code," & _
            " PrMsEarningCodes.ErnTyp_Code" & _
            " FROM PrMsTemplateEarnings INNER JOIN" & _
            " PrMsEarningCodes ON PrMsTemplateEarnings.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            " WHERE (PrMsTemplateEarnings.TemGrp_Code = " & enQuoteString(TemGrp) & ")"

        Dim DsEarn As DataSet
        Dim Seq As String
        Dim Found As Boolean = False
        Dim StrNonIns As String = ""

        Dim StrNonIns2 As String = ""
        DsEarn = GetData(Str)
        If CheckDataSet(DsEarn) Then
            For k = 0 To DsEarn.Tables(0).Rows.Count - 1
                Seq = DsEarn.Tables(0).Rows(k).Item(0)
                For i = 0 To Formula.Length - 1
                    S = Formula.Substring(i, 1)
                    If S = Seq Then
                        Found = True
                        Exit For
                    End If
                Next
                If Not Found Then
                    If StrNonIns = "" Then
                        StrNonIns = DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = DsEarn.Tables(0).Rows(k).Item(2)
                    Else
                        StrNonIns = StrNonIns & "|" & DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = StrNonIns2 & "|" & DsEarn.Tables(0).Rows(k).Item(2)
                    End If

                End If
                Found = False
            Next
            S = ""
            If StrNonIns <> "" Then
                S = ""
                Dim Ar() As String
                Ar = StrNonIns.Split("|")
                Dim Ar2() As String
                Ar2 = StrNonIns2.Split("|")

                For i = 0 To Ar.Length - 1
                    'E16 is Annual leave provision
                    'Dim ErnCod As New cPrMsEarningCodes(Ar(i))
                    'Dim ErnTyp As New cPrSsEarningTypes(ErnCod.ErnTypCode)

                    'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E6" And Ar(i) <> "E7" And Ar(i) <> "E99" And Ar(i) <> "E16" Then
                    'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E99" And Ar(i) <> "E16" Then
                    If Trim(Ar2(i)) <> "3E" And Trim(Ar2(i)) <> "4E" And Ar2(i) <> "E99" And Trim(Ar2(i)) <> "LP" And Trim(Ar2(i)) <> "BK" And Trim(Ar2(i)) <> "BR" And Trim(Ar2(i)) <> "B2" Then

                        If S = "" Then
                            S = " AND ((PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        Else

                            S = S & " OR " & " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        End If

                    End If
                Next
            End If
            If S <> "" Then
                S = S & " )"
                Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnLines INNER JOIN" & _
                    " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                    " WHERE  (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ") AND" & _
                    " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") AND " & _
                    " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp) & ") AND " & _
                    " (PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(JanPeriod) & " AND " & _
                    " PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(FebPeriod) & ")  "

                Str = Str & S


                Dim Ds2 As DataSet
                Ds2 = GetData(Str)
                If CheckDataSet(Ds2) Then
                    NonTaxable = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))
                    If NonTaxable <> 0 Then
                        '        MsgBox(EmpCode)
                    End If
                End If
            End If
        End If

        Return NonTaxable
    End Function
    Public Function FindNonTaxableTotalForTemplateGroupForEmployee_JanFebAprMayJun(ByVal TemGrp As String, ByVal PeriodGroup As String, ByVal EmpCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String, ByVal AprPeriod As String, ByVal MayPeriod As String, ByVal JunPeriod As String, ByVal t14Period As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Formula As String = ""
        Dim i As Integer
        Dim S As String
        Dim k As Integer
        Dim NonTaxable As Double = 0
        Str = " SELECT PrMsTemplateDeductions.TemDed_CalcFormula" & _
                " FROM PrMsTemplateDeductions INNER JOIN" & _
                " PrMsDeductionCodes ON " & _
                " PrMsTemplateDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
                " WHERE (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TemGrp) & ") " & _
                " AND (PrMsDeductionCodes.DedTyp_Code = 'IT')"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Formula = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        'Str = "select TemErn_Sequence," & _
        '" ErnCod_Code " & _
        '" FROM PrMsTemplateEarnings" & _
        '" WHERE TemGrp_Code=" & enQuoteString(TemGrp)

        Str = " SELECT  PrMsTemplateEarnings.TemErn_Sequence," & _
            " PrMsTemplateEarnings.ErnCod_Code," & _
            " PrMsEarningCodes.ErnTyp_Code" & _
            " FROM PrMsTemplateEarnings INNER JOIN" & _
            " PrMsEarningCodes ON PrMsTemplateEarnings.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            " WHERE (PrMsTemplateEarnings.TemGrp_Code = " & enQuoteString(TemGrp) & ")"

        Dim DsEarn As DataSet
        Dim Seq As String
        Dim Found As Boolean = False
        Dim StrNonIns As String = ""

        Dim StrNonIns2 As String = ""
        DsEarn = GetData(Str)
        If CheckDataSet(DsEarn) Then
            For k = 0 To DsEarn.Tables(0).Rows.Count - 1
                Seq = DsEarn.Tables(0).Rows(k).Item(0)
                For i = 0 To Formula.Length - 1
                    S = Formula.Substring(i, 1)
                    If S = Seq Then
                        Found = True
                        Exit For
                    End If
                Next
                If Not Found Then
                    If StrNonIns = "" Then
                        StrNonIns = DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = DsEarn.Tables(0).Rows(k).Item(2)
                    Else
                        StrNonIns = StrNonIns & "|" & DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = StrNonIns2 & "|" & DsEarn.Tables(0).Rows(k).Item(2)
                    End If

                End If
                Found = False
            Next
            S = ""
            If StrNonIns <> "" Then
                S = ""
                Dim Ar() As String
                Ar = StrNonIns.Split("|")
                Dim Ar2() As String
                Ar2 = StrNonIns2.Split("|")

                For i = 0 To Ar.Length - 1
                    'E16 is Annual leave provision
                    'Dim ErnCod As New cPrMsEarningCodes(Ar(i))
                    'Dim ErnTyp As New cPrSsEarningTypes(ErnCod.ErnTypCode)

                    'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E6" And Ar(i) <> "E7" And Ar(i) <> "E99" And Ar(i) <> "E16" Then
                    'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E99" And Ar(i) <> "E16" Then
                    If Trim(Ar2(i)) <> "3E" And Trim(Ar2(i)) <> "4E" And Ar2(i) <> "E99" And Trim(Ar2(i)) <> "LP" And Trim(Ar2(i)) <> "BK" And Trim(Ar2(i)) <> "BR" And Trim(Ar2(i)) <> "B2" Then

                        If S = "" Then
                            S = " AND ((PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        Else

                            S = S & " OR " & " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        End If

                    End If
                Next
            End If
            If S <> "" Then
                S = S & " )"
                Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnLines INNER JOIN" & _
                    " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                    " WHERE  (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ") AND" & _
                    " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") AND " & _
                    " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp) & ") AND " & _
                    " (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(JanPeriod) & _
                    " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(FebPeriod) & _
                    " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(AprPeriod) & _
                    " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(MayPeriod) & _
                    " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(JunPeriod) & _
                    " OR PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(t14Period) & ")  "

                Str = Str & S


                Dim Ds2 As DataSet
                Ds2 = GetData(Str)
                If CheckDataSet(Ds2) Then
                    NonTaxable = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))
                    If NonTaxable <> 0 Then
                        '        MsgBox(EmpCode)
                    End If
                End If
            End If
        End If

        Return NonTaxable
    End Function
    Public Function FindNonTaxableTotalForTemplateGroupForEmployee_NOT_JanFebAprMayJun(ByVal TemGrp As String, ByVal PeriodGroup As String, ByVal EmpCode As String, ByVal JanPeriod As String, ByVal FebPeriod As String, ByVal AprPeriod As String, ByVal MayPeriod As String, ByVal JunPeriod As String, ByVal t14Period As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Formula As String = ""
        Dim i As Integer
        Dim S As String
        Dim k As Integer
        Dim NonTaxable As Double = 0
        Str = " SELECT PrMsTemplateDeductions.TemDed_CalcFormula" & _
                " FROM PrMsTemplateDeductions INNER JOIN" & _
                " PrMsDeductionCodes ON " & _
                " PrMsTemplateDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
                " WHERE (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TemGrp) & ") " & _
                " AND (PrMsDeductionCodes.DedTyp_Code = 'IT')"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Formula = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        'Str = "select TemErn_Sequence," & _
        '" ErnCod_Code " & _
        '" FROM PrMsTemplateEarnings" & _
        '" WHERE TemGrp_Code=" & enQuoteString(TemGrp)

        Str = " SELECT  PrMsTemplateEarnings.TemErn_Sequence," & _
            " PrMsTemplateEarnings.ErnCod_Code," & _
            " PrMsEarningCodes.ErnTyp_Code" & _
            " FROM PrMsTemplateEarnings INNER JOIN" & _
            " PrMsEarningCodes ON PrMsTemplateEarnings.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            " WHERE (PrMsTemplateEarnings.TemGrp_Code = " & enQuoteString(TemGrp) & ")"

        Dim DsEarn As DataSet
        Dim Seq As String
        Dim Found As Boolean = False
        Dim StrNonIns As String = ""

        Dim StrNonIns2 As String = ""
        DsEarn = GetData(Str)
        If CheckDataSet(DsEarn) Then
            For k = 0 To DsEarn.Tables(0).Rows.Count - 1
                Seq = DsEarn.Tables(0).Rows(k).Item(0)
                For i = 0 To Formula.Length - 1
                    S = Formula.Substring(i, 1)
                    If S = Seq Then
                        Found = True
                        Exit For
                    End If
                Next
                If Not Found Then
                    If StrNonIns = "" Then
                        StrNonIns = DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = DsEarn.Tables(0).Rows(k).Item(2)
                    Else
                        StrNonIns = StrNonIns & "|" & DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = StrNonIns2 & "|" & DsEarn.Tables(0).Rows(k).Item(2)
                    End If

                End If
                Found = False
            Next
            S = ""
            If StrNonIns <> "" Then
                S = ""
                Dim Ar() As String
                Ar = StrNonIns.Split("|")
                Dim Ar2() As String
                Ar2 = StrNonIns2.Split("|")

                For i = 0 To Ar.Length - 1
                    'E16 is Annual leave provision
                    'Dim ErnCod As New cPrMsEarningCodes(Ar(i))
                    'Dim ErnTyp As New cPrSsEarningTypes(ErnCod.ErnTypCode)

                    'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E6" And Ar(i) <> "E7" And Ar(i) <> "E99" And Ar(i) <> "E16" Then
                    'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E99" And Ar(i) <> "E16" Then
                    If Trim(Ar2(i)) <> "3E" And Trim(Ar2(i)) <> "4E" And Ar2(i) <> "E99" And Trim(Ar2(i)) <> "LP" And Trim(Ar2(i)) <> "BK" And Trim(Ar2(i)) <> "BR" And Trim(Ar2(i)) <> "B2" Then

                        If S = "" Then
                            S = " AND ((PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        Else

                            S = S & " OR " & " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        End If

                    End If
                Next
            End If
            If S <> "" Then
                S = S & " )"
                Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnLines INNER JOIN" & _
                    " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                    " WHERE  (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ") AND" & _
                    " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") AND " & _
                    " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp) & ") AND " & _
                    " (PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(JanPeriod) & _
                    " AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(FebPeriod) & _
                    " AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(AprPeriod) & _
                    " AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(MayPeriod) & _
                    " AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(JunPeriod) & _
                    " AND PrTxTrxnHeader.PrdCod_Code <> " & enQuoteString(t14Period) & ")"

                Str = Str & S


                Dim Ds2 As DataSet
                Ds2 = GetData(Str)
                If CheckDataSet(Ds2) Then
                    NonTaxable = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))
                    If NonTaxable <> 0 Then
                        '        MsgBox(EmpCode)
                    End If
                End If
            End If
        End If

        Return NonTaxable
    End Function
    Public Function FindNonTaxableTotalForTemplateGroupForEmployee_ForSpecificPeriod(ByVal TemGrp As String, ByVal PeriodGroup As String, ByVal EmpCode As String, ByVal Period As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Formula As String = ""
        Dim i As Integer
        Dim S As String
        Dim k As Integer
        Dim NonTaxable As Double = 0
        Str = " SELECT PrMsTemplateDeductions.TemDed_CalcFormula" & _
                " FROM PrMsTemplateDeductions INNER JOIN" & _
                " PrMsDeductionCodes ON " & _
                " PrMsTemplateDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
                " WHERE (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TemGrp) & ") " & _
                " AND (PrMsDeductionCodes.DedTyp_Code = 'IT')"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Formula = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        'Str = "select TemErn_Sequence," & _
        '" ErnCod_Code " & _
        '" FROM PrMsTemplateEarnings" & _
        '" WHERE TemGrp_Code=" & enQuoteString(TemGrp)

        Str = " SELECT  PrMsTemplateEarnings.TemErn_Sequence," & _
            " PrMsTemplateEarnings.ErnCod_Code," & _
            " PrMsEarningCodes.ErnTyp_Code" & _
            " FROM PrMsTemplateEarnings INNER JOIN" & _
            " PrMsEarningCodes ON PrMsTemplateEarnings.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            " WHERE (PrMsTemplateEarnings.TemGrp_Code = " & enQuoteString(TemGrp) & ")"

        Dim DsEarn As DataSet
        Dim Seq As String
        Dim Found As Boolean = False
        Dim StrNonIns As String = ""

        Dim StrNonIns2 As String = ""
        DsEarn = GetData(Str)
        If CheckDataSet(DsEarn) Then
            For k = 0 To DsEarn.Tables(0).Rows.Count - 1
                Seq = DsEarn.Tables(0).Rows(k).Item(0)
                For i = 0 To Formula.Length - 1
                    S = Formula.Substring(i, 1)
                    If S = Seq Then
                        Found = True
                        Exit For
                    End If
                Next
                If Not Found Then
                    If StrNonIns = "" Then
                        StrNonIns = DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = DsEarn.Tables(0).Rows(k).Item(2)
                    Else
                        StrNonIns = StrNonIns & "|" & DsEarn.Tables(0).Rows(k).Item(1)
                        StrNonIns2 = StrNonIns2 & "|" & DsEarn.Tables(0).Rows(k).Item(2)
                    End If

                End If
                Found = False
            Next
            S = ""
            If StrNonIns <> "" Then
                S = ""
                Dim Ar() As String
                Ar = StrNonIns.Split("|")
                Dim Ar2() As String
                Ar2 = StrNonIns2.Split("|")

                For i = 0 To Ar.Length - 1
                    'E16 is Annual leave provision
                    'Dim ErnCod As New cPrMsEarningCodes(Ar(i))
                    'Dim ErnTyp As New cPrSsEarningTypes(ErnCod.ErnTypCode)

                    'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E6" And Ar(i) <> "E7" And Ar(i) <> "E99" And Ar(i) <> "E16" Then
                    'If Ar(i) <> "E8" And Ar(i) <> "E9" And Ar(i) <> "E99" And Ar(i) <> "E16" Then
                    If Trim(Ar2(i)) <> "3E" And Trim(Ar2(i)) <> "4E" And Ar2(i) <> "E99" And Trim(Ar2(i)) <> "LP" And Trim(Ar2(i)) <> "BK" And Trim(Ar2(i)) <> "BR" And Trim(Ar2(i)) <> "B2" Then

                        If S = "" Then
                            S = " AND ((PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        Else

                            S = S & " OR " & " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        End If

                    End If
                Next
            End If
            If S <> "" Then
                S = S & " )"
                Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnLines INNER JOIN" & _
                    " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                    " WHERE  (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ") AND" & _
                    " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") AND " & _
                    " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp) & ") AND " & _
                    " (PrTxTrxnHeader.PrdCod_Code = " & enQuoteString(Period) & ")"

                Str = Str & S


                Dim Ds2 As DataSet
                Ds2 = GetData(Str)
                If CheckDataSet(Ds2) Then
                    NonTaxable = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))
                    If NonTaxable <> 0 Then
                        '        MsgBox(EmpCode)
                    End If
                End If
            End If
        End If

        Return NonTaxable
    End Function
    'Public Function FindNonInsurableTotalForTemplateGroupForEmployee(ByVal TemGrp As String, ByVal PeriodGroup As String, ByVal EmpCode As String) As Double
    '    Dim Str As String
    '    Dim Ds As DataSet
    '    Dim Formula As String = ""
    '    Dim i As Integer
    '    Dim S As String
    '    Dim k As Integer
    '    Dim NonTaxable As Double = 0
    '    Str = " SELECT PrMsTemplateDeductions.TemDed_CalcFormula" & _
    '            " FROM PrMsTemplateDeductions INNER JOIN" & _
    '            " PrMsDeductionCodes ON " & _
    '            " PrMsTemplateDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
    '            " WHERE (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TemGrp) & ") " & _
    '            " AND (PrMsDeductionCodes.DedTyp_Code = 'IT')"

    '    Ds = GetData(Str)
    '    If CheckDataSet(Ds) Then
    '        Formula = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
    '    End If
    '    Str = "select TemErn_Sequence," & _
    '    " ErnCod_Code " & _
    '    " FROM PrMsTemplateEarnings" & _
    '    " WHERE TemGrp_Code=" & enQuoteString(TemGrp)
    '    Dim DsEarn As DataSet
    '    Dim Seq As String
    '    Dim Found As Boolean = False
    '    Dim StrNonIns As String = ""
    '    DsEarn = GetData(Str)
    '    If CheckDataSet(DsEarn) Then
    '        For k = 0 To DsEarn.Tables(0).Rows.Count - 1
    '            Seq = DsEarn.Tables(0).Rows(k).Item(0)
    '            For i = 0 To Formula.Length - 1
    '                S = Formula.Substring(i, 1)
    '                If S = Seq Then
    '                    Found = True
    '                    Exit For
    '                End If
    '            Next
    '            If Not Found Then
    '                If StrNonIns = "" Then
    '                    StrNonIns = DsEarn.Tables(0).Rows(k).Item(1)
    '                Else
    '                    StrNonIns = StrNonIns & "|" & DsEarn.Tables(0).Rows(k).Item(1)
    '                End If

    '            End If
    '            Found = False
    '        Next
    '        S = ""
    '        If StrNonIns <> "" Then
    '            S = ""
    '            Dim Ar() As String
    '            Ar = StrNonIns.Split("|")
    '            For i = 0 To Ar.Length - 1
    '                If Ar(i) <> "E8" And Ar(i) <> "E9" Then

    '                    If S = "" Then
    '                        S = " ((PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
    '                    Else

    '                        S = " OR " & " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
    '                    End If

    '                End If
    '            Next
    '        End If
    '        If S <> "" Then
    '            S = S & " )"
    '            Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
    '                " FROM PrTxTrxnLines INNER JOIN" & _
    '                " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
    '                " WHERE  (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ") AND" & _
    '                " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") AND " & _
    '                " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp) & ") AND "

    '            Str = Str & S


    '            Dim Ds2 As DataSet
    '            Ds2 = GetData(Str)
    '            If CheckDataSet(Ds2) Then
    '                NonTaxable = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))
    '            End If
    '        End If
    '    End If

    '    Return NonTaxable
    'End Function
    Public Function FindSILeaveTotalForTemplateGroupPeriodEmployee(ByVal TemGrp As String, ByVal PeriodGroup As String, ByVal EmpCode As String, ByVal PeriodCode As String) As Double
        Dim Str As String
        Dim Ds As DataSet
        Dim Formula As String = ""
        Dim i As Integer
        Dim S As String
        Dim k As Integer
        Dim NonTaxable As Double = 0
        Str = " SELECT PrMsTemplateDeductions.TemDed_CalcFormula" & _
                " FROM PrMsTemplateDeductions INNER JOIN" & _
                " PrMsDeductionCodes ON " & _
                " PrMsTemplateDeductions.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
                " WHERE (PrMsTemplateDeductions.TemGrp_Code = " & enQuoteString(TemGrp) & ") " & _
                " AND (PrMsDeductionCodes.DedTyp_Code = 'IT')"

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Formula = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        Str = "select TemErn_Sequence," & _
        " ErnCod_Code " & _
        " FROM PrMsTemplateEarnings" & _
        " WHERE TemGrp_Code=" & enQuoteString(TemGrp)
        Dim DsEarn As DataSet
        Dim Seq As String
        Dim Found As Boolean = False
        Dim StrNonIns As String = ""
        DsEarn = GetData(Str)
        If CheckDataSet(DsEarn) Then
            For k = 0 To DsEarn.Tables(0).Rows.Count - 1
                Seq = DsEarn.Tables(0).Rows(k).Item(0)
                For i = 0 To Formula.Length - 1
                    S = Formula.Substring(i, 1)
                    If S = Seq Then
                        Found = True
                        Exit For
                    End If
                Next
                If Not Found Then
                    If StrNonIns = "" Then
                        StrNonIns = DsEarn.Tables(0).Rows(k).Item(1)
                    Else
                        StrNonIns = StrNonIns & "|" & DsEarn.Tables(0).Rows(k).Item(1)
                    End If

                End If
                Found = False
            Next
            If StrNonIns <> "" Then
                S = ""
                Dim Ar() As String
                Ar = StrNonIns.Split("|")
                For i = 0 To Ar.Length - 1
                    If Ar(i) <> "E8" And Ar(i) <> "E9" Then

                        If S = "" Then
                            S = " ((PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        Else

                            S = " OR " & " (PrTxTrxnLines.ErnCod_Code = " & enQuoteString(Ar(i)) & ")"
                        End If

                    End If
                Next
            End If
            If S <> "" Then
                S = S & " )"
                Str = "SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                    " FROM PrTxTrxnLines INNER JOIN" & _
                    " PrTxTrxnHeader ON PrTxTrxnLines.TrxHdr_Id = PrTxTrxnHeader.TrxHdr_Id" & _
                    " WHERE  (PrTxTrxnHeader.PrdGrp_Code = " & enQuoteString(PeriodGroup) & ") AND" & _
                    " (PrTxTrxnHeader.Prdcod_Code = " & enQuoteString(PeriodCode) & " )AND " & _
                    " (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ") AND " & _
                    " (PrTxTrxnHeader.TemGrp_Code = " & enQuoteString(TemGrp) & ") AND "

                Str = Str & S


                Dim Ds2 As DataSet
                Ds2 = GetData(Str)
                If CheckDataSet(Ds2) Then
                    NonTaxable = DbNullToDouble(Ds2.Tables(0).Rows(0).Item(0))
                End If
            End If
        End If

        Return NonTaxable
    End Function
    Protected Function FixCarob()
        Dim EXX As New System.Exception
        Try
            BeginTransaction()
            Dim Str As String
            Dim i As Integer
            Str = "select * from prtxtrxnheader where prdcod_code='201113' and PrdGrp_Code='201101'"
            Dim ds As DataSet
            ds = GetData(Str)
            Dim ID As Integer
            Dim YearToDate As Double
            Dim EmpCode As String
            Dim COUNT As Integer
            For i = 0 To ds.Tables(0).Rows.Count - 1
                ID = ds.Tables(0).Rows(i).Item(0)
                EmpCode = ds.Tables(0).Rows(i).Item(1)
                Dim Emp As New cPrMsEmployees(EmpCode)
                Dim Per As New cPrMsPeriodCodes("201113", "201101")
                YearToDate = Global1.Business.FindYTD_EDC(Emp, Per, "E10", "E")
                Dim DS2 As DataSet
                Dim SS As String
                SS = "SELECT COUNT(*) FROM PRTXTRXNLINES WHERE TRXHDR_ID=" & ID
                DS2 = GetData(SS)
                COUNT = DbNullToInt(DS2.Tables(0).Rows(0).Item(0))


                Dim TL As New cPrTxTrxnLines()
                With TL
                    .TrxLin_Id = COUNT + 1
                    .TrxHdr_Id = ID
                    .TrxLin_Type = "E"
                    .ErnCod_Code = "E10"
                    .TrxLin_PeriodValue = 0
                    .TrxLin_YTDValue = YearToDate
                    .TrxLin_EDC = 0
                    .TrxLin_EDCDescription = "TRAVELING"
                    If Not .Save Then
                        Throw EXX
                    End If
                End With
            Next
            CommitTransaction()
            MsgBox("OK")
        Catch ex As Exception
            Rollback()
            Utils.ShowException(ex)
        End Try

    End Function
    Protected Function FixFoodPoint()
        Dim EXX As New System.Exception
        Try
            BeginTransaction()
            Dim Str As String
            Dim i As Integer
            Str = "select * from prtxtrxnheader where prdcod_code='201112' and PrdGrp_Code='201102'"
            Dim ds As DataSet
            ds = GetData(Str)
            Dim ID As Integer
            Dim YearToDate As Double
            Dim EmpCode As String
            Dim COUNT As Integer
            For i = 0 To ds.Tables(0).Rows.Count - 1
                ID = ds.Tables(0).Rows(i).Item(0)
                EmpCode = ds.Tables(0).Rows(i).Item(1)
                Dim Emp As New cPrMsEmployees(EmpCode)
                Dim Per As New cPrMsPeriodCodes("201112", "201102")
                YearToDate = Global1.Business.FindYTD_EDC(Emp, Per, "E8", "E")
                Dim DS2 As DataSet
                Dim SS As String
                SS = "SELECT COUNT(*) FROM PRTXTRXNLINES WHERE TRXHDR_ID=" & ID
                DS2 = GetData(SS)
                COUNT = DbNullToInt(DS2.Tables(0).Rows(0).Item(0))


                Dim TL As New cPrTxTrxnLines()
                With TL
                    .TrxLin_Id = COUNT + 1
                    .TrxHdr_Id = ID
                    .TrxLin_Type = "E"
                    .ErnCod_Code = "E8"
                    .TrxLin_PeriodValue = 0
                    .TrxLin_YTDValue = YearToDate
                    .TrxLin_EDC = 0
                    .TrxLin_EDCDescription = "13 ESTIMATE"
                    If Not .Save Then
                        Throw EXX
                    End If
                End With
            Next
            CommitTransaction()
            MsgBox("OK")
        Catch ex As Exception
            Rollback()
            Utils.ShowException(ex)
        End Try

    End Function
    Protected Function FixFoodExpress()
        Dim EXX As New System.Exception
        Try
            BeginTransaction()
            Dim Str As String
            Dim i As Integer
            Str = "select * from prtxtrxnheader where prdcod_code='201113' and PrdGrp_Code='201103'"
            Dim ds As DataSet
            ds = GetData(Str)
            Dim ID As Integer
            Dim YearToDate As Double
            Dim EmpCode As String
            Dim COUNT As Integer
            For i = 0 To ds.Tables(0).Rows.Count - 1
                ID = ds.Tables(0).Rows(i).Item(0)
                EmpCode = ds.Tables(0).Rows(i).Item(1)
                Dim Emp As New cPrMsEmployees(EmpCode)
                Dim Per As New cPrMsPeriodCodes("201113", "201103")
                YearToDate = Global1.Business.FindYTD_EDC(Emp, Per, "E8", "E")
                Dim DS2 As DataSet
                Dim SS As String
                SS = "SELECT COUNT(*) FROM PRTXTRXNLINES WHERE TRXHDR_ID=" & ID
                DS2 = GetData(SS)
                COUNT = DbNullToInt(DS2.Tables(0).Rows(0).Item(0))


                Dim TL As New cPrTxTrxnLines()
                With TL
                    .TrxLin_Id = COUNT + 1
                    .TrxHdr_Id = ID
                    .TrxLin_Type = "E"
                    .ErnCod_Code = "E8"
                    .TrxLin_PeriodValue = 0
                    .TrxLin_YTDValue = YearToDate
                    .TrxLin_EDC = 0
                    .TrxLin_EDCDescription = "13 ESTIMATE"
                    If Not .Save Then
                        Throw EXX
                    End If
                End With
            Next
            CommitTransaction()
            MsgBox("OK")
        Catch ex As Exception
            Rollback()
            Utils.ShowException(ex)
        End Try

    End Function
    Protected Function IsThisLastPeriod(ByVal Period As cPrMsPeriodCodes) As Boolean
        Dim Str As String
        Dim Flag As Boolean = False
        Dim TotalPeriods As Integer
        Str = "Select count(*) from prmsperiodcodes where PrdGrp_Code= " & enQuoteString(Period.PrdGrpCode)
        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            TotalPeriods = DbNullToInt(Ds.Tables(0).Rows(0).Item(0))
        End If

        If TotalPeriods = Period.Sequence Then
            Flag = True
        End If

        Return Flag

    End Function
    Protected Function GetAnnualInsurableToDateForEmployee(ByVal EmpCode As String, ByVal PeriodGroup As String) As Double
        Dim Str As String
        Dim Total As Double = 0
        Str = " select sum(trxhdr_periodinsurable) from prtxtrxnHeader " & _
              " where emp_code=" & enQuoteString(EmpCode) & _
              " and prdgrp_code=" & enQuoteString(PeriodGroup)
        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Total = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Total
    End Function
    Protected Function GetAllUsersOfCompany(ByVal ComCode As String) As DataSet
        Dim str As String
        str = "SELECT     AaSsUsers.Usr_UserName," & _
        " AaSsUsers.Usr_FullName, " & _
        " PrSsCompanyUsers.Com_Code " & _
        " FROM   AaSsUsers INNER JOIN" & _
        " PrSsCompanyUsers ON AaSsUsers.Usr_UserName = PrSsCompanyUsers.Usr_UserName" & _
        " WHERE (PrSsCompanyUsers.Com_Code = " & enQuoteString(ComCode) & ")"

        Return MyBase.GetData(str)
    End Function
    Protected Function DeleteAllAIMS() As Boolean
        Dim str As String
        str = "Delete from PrTxAIMS "
        Dim i As Integer
        i = MyBase.ExecuteNonQuery(str)

    End Function
    Protected Function GetDataFromAIMS() As DataSet
        Dim str As String
        str = " SELECT No," & _
            " Employee," & _
            " Sectors," & _
            " DutyHours," & _
            " FlightHours  " & _
            " FROM  PrTxAims " & _
            " Order by No Asc"
        Return MyBase.GetData(str)
        Dim i As Integer
        i = MyBase.ExecuteNonQuery(str)

    End Function
    Protected Function GetEmployeeFromAIMSCode(ByVal No As String) As String
        Dim Str As String
        Dim Ds As DataSet
        Dim Code As String = ""
        Str = "Select Emp_Code from PrMsemployees where Emp_GLAnal4=" & enQuoteString(No)
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Code = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return code


    End Function
    Protected Function GetDeductionCodesForLoans() As DataSet
        Dim Str As String
        Str = "SELECT DedCod_Code," & _
            " DedTyp_Code, " & _
            " DedCod_DescriptionL," & _
            " DedCod_DescriptionS," & _
            " DedCod_IsActive" & _
            " FROM PrMsDeductionCodes" & _
            " WHERE (DedTyp_Code = 'PL')" & _
            " OR (DedTyp_Code = 'CL')"
        Return GetData(Str)

    End Function
    Protected Function GetAllPrTxEmployeeLoansByEmpCode(ByVal EmpCode As String, ByVal EmpLoanCode As String) As DataSet
        Dim Str As String
        Str = " SELECT EmpLne_Id, " & _
        " EmpLne_Code," & _
        " Emp_Code ," & _
        " TemGrp_Code ," & _
        " PrdCod_Code ," & _
        " PrdGrp_Code ," & _
        " DedCod_Code ," & _
        " TrxHdr_Id ," & _
        " EmpLne_LoanDate ," & _
        " EmpLne_Amount ," & _
        " EmpLne_Interest ," & _
        " EmpLne_TotalAmount ," & _
        " EmpLne_Description ," & _
        " EmpLne_MonthlyAmount ," & _
        " EmpLne_Type ," & _
        " EmpLne_Payment ," & _
        " Usr_Id," & _
        " EmpLne_Status " & _
        " FROM  PrTxEmployeeLoan" & _
        " WHERE Emp_Code= " & enQuoteString(EmpCode) & _
        " and EmpLne_Code= " & enQuoteString(EmpLoanCode) & _
        " Order by EmpLne_id desc"

        Return MyBase.GetData(Str)
    End Function
    Protected Function GetEmployeeLoans(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT distinct(EmpLne_Code)," & _
        " EmpLne_Description " & _
        " FROM  PrTxEmployeeLoan" & _
        " WHERE Emp_Code= " & enQuoteString(EmpCode)
        Return MyBase.GetData(Str)
    End Function

    Protected Function GetEmployeeLoans1(ByVal EmpCode As String, ByVal Status As String) As DataSet
        Dim Str As String
        Str = " SELECT distinct(EmpLne_Code)" & _
        " FROM  PrTxEmployeeLoan" & _
        " WHERE Emp_code = " & enQuoteString(EmpCode) & _
        " AND EmpLne_Status='OPEN'"

        Return MyBase.GetData(Str)

    End Function
    Protected Function GetEmployeeLoans2(ByVal EmpCode As String, ByVal Status As String, ByVal LoanCode As String) As DataSet
        Dim Str As String
        Str = " SELECT distinct(DedCod_Code)" & _
         " FROM  PrTxEmployeeLoan" & _
        " WHERE Emp_code = " & enQuoteString(EmpCode) & _
        " AND EmpLne_code=" & enQuoteString(LoanCode) & _
        " AND EmpLne_Status='OPEN'"

        Return MyBase.GetData(Str)

    End Function
    Protected Function CheckLoanValue(ByVal EmpCode As String, ByVal DeductionCode As String) As DataSet
        Dim Str As String
        Str = " SELECT * " & _
         " FROM  PrTxEmployeeLoan" & _
        " WHERE Emp_code = " & enQuoteString(EmpCode) & _
        " AND DedCod_Code=" & enQuoteString(DeductionCode) & _
        " AND EmpLne_Status='OPEN'"

        Return MyBase.GetData(Str)

    End Function
    Protected Function GetEmployeeLoans3(ByVal EmpCode As String, ByVal Status As String, ByVal LoanCode As String) As Integer
        Dim Str As String
        Dim id As Integer = 0
        Str = " SELECT EmpLne_Id " & _
         " FROM  PrTxEmployeeLoan" & _
        " WHERE Emp_code = " & enQuoteString(EmpCode) & _
        " AND EmpLne_code=" & enQuoteString(LoanCode) & _
        " AND EmpLne_Status='OPEN'"

        Dim ds As DataSet

        ds = MyBase.GetData(Str)
        If CheckDataSet(ds) Then
            id = DbNullToInt(ds.Tables(0).Rows(0).Item(0))
        End If
        Return id

    End Function
   

    Protected Function GetEmployeeLoanTotal(ByVal EmpCode As String, ByVal LoanCode As String) As Double
        Dim Str As String
        Dim Total As Double = 0
        Dim Payment As Double = 0
        Dim i As Integer
        Str = " SELECT EmpLne_Payment," & _
        " EmpLne_TotalAmount " & _
        " FROM  PrTxEmployeeLoan" & _
        " WHERE Emp_code = " & enQuoteString(EmpCode) & _
        " AND EmpLne_Code= " & enQuoteString(LoanCode)
        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                Payment = Payment + DbNullToDouble(Ds.Tables(0).Rows(i).Item(0))
                If DbNullToDouble(Ds.Tables(0).Rows(i).Item(1)) <> 0 Then
                    Total = DbNullToDouble(Ds.Tables(0).Rows(i).Item(1))
                End If
            Next
        End If
        Total = Total - Payment
        Return Total

    End Function
    Protected Function ChangeStatusOfLoan(ByVal EmpCode As String, ByVal LoanCode As String) As Boolean
        Dim Str As String
        Dim f As Boolean = False
        Str = "Update PrTxEmployeeLoan set EmpLne_Status=" & enQuoteString(Global1.AN_CLOSED) & _
        " WHERE Emp_code = " & enQuoteString(EmpCode) & _
        " AND EmpLne_Code= " & enQuoteString(LoanCode)

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            f = True
        End If

        Return f
    End Function
    Protected Function IsThereAnActiveLoanForThisDeductionCode(ByVal EmpCode As String, ByVal LoanCode As String, ByVal DedCode As String) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Dim Ds As DataSet
        Str = " Select EmpLne_Code " & _
        " FROM  PrTxEmployeeLoan " & _
        " WHERE Emp_Code= " & enQuoteString(EmpCode) & _
        " AND DedCod_Code =" & enQuoteString(DedCode) & _
        " AND EmpLne_Status =" & enQuoteString(Global1.AN_OPEN) & _
        " AND EmpLne_Code <> " & enQuoteString(LoanCode)

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            f = True
        End If
        Return F
    End Function
    Protected Function IsThisTheFirstRecordOfLoan(ByVal EmpCode As String, ByVal LoanCode As String) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Dim Ds As DataSet
        Dim C As Integer = 0
        Str = " Select count(*) " & _
        " FROM  PrTxEmployeeLoan " & _
        " WHERE Emp_Code = " & enQuoteString(EmpCode) & _
        " AND EmpLne_Code = " & enQuoteString(LoanCode)

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            C = Ds.Tables(0).Rows(0).Item(0)
        End If
        If c = 1 Then
            F = True
        End If
        Return F
    End Function
    Protected Function IsThereALoanWithTheSameCode(ByVal EmpCode As String, ByVal LoanCode As String) As Boolean
        Dim Str As String
        Dim f As Boolean = False
        Dim Ds As DataSet

        Str = " Select count(*) " & _
        " FROM  PrTxEmployeeLoan " & _
        " WHERE Emp_Code = " & enQuoteString(EmpCode) & _
        " AND EmpLne_Code = " & enQuoteString(LoanCode) & _
        " AND EmpLne_Status = " & enQuoteString(Global1.AN_Issue)

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            f = True
        End If
       
        Return f

    End Function
    Protected Function Is13nthcalculated(ByVal CurrentPeriod As cPrMsPeriodCodes, ByVal EmpCode As String) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = "SELECT     TrxHdr_Id" & _
        " FROM PrTxTrxnHeader " & _
        " WHERE (PrdGrp_Code = " & enQuoteString(CurrentPeriod.PrdGrpCode) & ")" & _
        " AND (Emp_Code = " & enQuoteString(EmpCode) & ")" & _
        " and PayCat_Code='3'"

        Dim ds As DataSet
        ds = MyBase.GetData(Str)
        If CheckDataSet(ds) Then
            f = True
        Else
            f = False
        End If
        Return f

    End Function
    Protected Function GetNumberOfTotalPeriodsFOREmployee(ByVal EmpCode As String, ByVal Year As String) As Integer
        Dim str As String
        Dim Ds As DataSet
        Dim N As Integer = 0
        str = "select COUNT(*) from PrMsPeriodCodes where PrdGrp_Code in" & _
            " (select PrdGrp_Code  from PrMsPeriodGroups " & _
            " where TemGrp_Code in" & _
            " (select Temgrp_Code  from PrMsEmployees where Emp_Code=" & enQuoteString(EmpCode) & ")" & _
            " and PrdGpr_Year =" & enQuoteString(Year) & ")"
        Ds = GetData(str)
        If CheckDataSet(Ds) Then
            N = DbNullToInt(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return N

    End Function
    Protected Function GetEmployeesForTAforAnalysis(ByVal analysiscode As String, ByVal MyStatus As String) As DataSet
        Dim str As String
        If MyStatus = 1 Then
            str = " SELECT 1," & _
                  " PrMsEmployees.Emp_Code," & _
                  " PrMsEmployees.Emp_FullName" & _
                  " FROM TaTxTrxnLines INNER JOIN" & _
                  " PrMsEmployees ON TaTxTrxnLines.Emp_Code = PrMsEmployees.Emp_Code" & _
                  " WHERE (TaTxTrxnLines.TrxLin_AnalCode = " & enQuoteString(analysiscode) & ")" & _
                  " AND (PrMsEmployees.EmpAn5_Code <> " & enQuoteString(analysiscode) & ")" & _
                  " GROUP BY PrMsEmployees.Emp_Code, PrMsEmployees.Emp_FullName, TaTxTrxnLines.TrxLin_AnalCode" & _
                  " ORDER BY PrMsEmployees.Emp_Code, TaTxTrxnLines.TrxLin_AnalCode"
        Else
            str = " SELECT 1," & _
                  " PrMsEmployees.Emp_Code," & _
                  " PrMsEmployees.Emp_FullName" & _
                  " FROM TaTxTrxnLines2 INNER JOIN" & _
                  " PrMsEmployees ON TaTxTrxnLines2.Emp_Code = PrMsEmployees.Emp_Code" & _
                  " WHERE (TaTxTrxnLines2.TrxLin_AnalCode = " & enQuoteString(analysiscode) & ")" & _
                  " AND (PrMsEmployees.EmpAn5_Code <> " & enQuoteString(analysiscode) & ")" & _
                  " GROUP BY PrMsEmployees.Emp_Code, PrMsEmployees.Emp_FullName, TaTxTrxnLines2.TrxLin_AnalCode" & _
                  " ORDER BY PrMsEmployees.Emp_Code, TaTxTrxnLines2.TrxLin_AnalCode"



        End If
        Return GetData(str)
    End Function
    Protected Function createparameterAverage13()
        Dim Str As String
        Dim F As Boolean
        Str = "INSERT INTO PrSsParameters" & _
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" & _
                "VALUES     ( 'System', 'Average13', '1', 'Average 13 salary', 'Y', 'T')"

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            f = True
        Else
            f = False
        End If

        Str = "INSERT INTO PrSsParameters" & _
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" & _
                "VALUES     ( 'System', 'AvgEarn13', '', 'Average 13 erning', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If



        Return F
    End Function
    Protected Function GetCompanyNextId() As Integer
        Dim Str As String
        Dim Id As Integer = 0
        Str = "Select Max(Com_Id) From AdMsCompany"
        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            Id = DbNullToInt(ds.Tables(0).Rows(0).Item(0))
            Id = Id + 1
        Else
            Id = 1
        End If
        Return Id
    End Function
    Protected Function GetcompanyTemplateGroup(ByVal CompanyCode As String) As DataSet
        Dim Str As String
        Str = "Select TemGrp_Code from PrMsTemplateGroup where com_code=" & enQuoteString(CompanyCode)
        Return GetData(Str)

    End Function
    Protected Function GetPeriodGroupOfTemplateGroup(ByVal TemplateGroup As String) As DataSet
        Dim Str As String
        Str = "Select PrdGrp_Code from PrMsPeriodGroups where TemGrp_code=" & enQuoteString(TemplateGroup) & _
        " Order by Prdgrp_Code Desc"
        Return GetData(Str)

    End Function
    Protected Function GetAllPeriodGroupsOfTemplateGroupCompany(ByVal ComCode As String, ByVal Year As String) As DataSet
        Dim Str As String
        Str = " select 1 as selected, prdgrp_code,Temgrp_code,PrdGrp_DescriptionL from PrMsPeriodGroups " & _
            " where TemGrp_Code in " & _
            " (select temgrp_code from PrMsTemplateGroup where Com_Code =" & enQuoteString(ComCode) & ")" & _
            " and PrdGpr_Year =" & enQuoteString(Year)
        Return GetData(Str)

    End Function

    Protected Function CreateNewPeriod(ByVal OldCode As String, ByVal NewCode As String) As Boolean
        Dim F As Boolean = False
        Dim Str As String
        Str = "INSERT INTO PrMsPeriodCodes" & _
            " (PrdCod_Code, PrdGrp_Code, PrdCod_Number, PrdCod_Status, PrdCod_DescriptionL, PrdCod_DescriptionS, PrdCod_Sequence, SinPrd_Code, PrdCod_DateFrom, " & _
            " PrdCod_DateTo, PrdCod_PeriodUnits, PayCat_Code,PrdCod_PeriodUnits2)" & _
            " SELECT PrdCod_Code, " & enQuoteString(NewCode) & ", PrdCod_Number, PrdCod_Status, PrdCod_DescriptionL, PrdCod_DescriptionS, PrdCod_Sequence, SinPrd_Code, PrdCod_DateFrom, " & _
            " PrdCod_DateTo, PrdCod_PeriodUnits, PayCat_Code,PrdCod_PeriodUnits2" & _
            " FROM PrMsPeriodCodes AS PrMsPeriodCodes_1" & _
            " where  PrdGrp_Code=" & enQuoteString(OldCode)
        If ExecuteNonQuery(Str) >= 0 Then
            f = True
        End If
        Return F
    End Function
    Protected Function CreateNewPeriodEarnings(ByVal OldCode As String, ByVal NewCode As String) As Boolean
        Dim F As Boolean = False
        Dim Str As String
        Str = "INSERT INTO PrMsPeriodEarnings" & _
        " (PrdCod_Code, PrdGrp_Code, ErnCod_Code, PrdErn_IsActive)" & _
        " SELECT PrdCod_Code, " & enQuoteString(NewCode) & ", ErnCod_Code, PrdErn_IsActive" & _
        " FROM PrMsPeriodEarnings AS PrMsPeriodEarnings_1" & _
        " where PrdGrp_Code =" & enQuoteString(OldCode)

        If ExecuteNonQuery(Str) >= 0 Then
            F = True
        End If
        Return F

    End Function
    Protected Function CreateNewPeriodDeductions(ByVal OldCode As String, ByVal NewCode As String) As Boolean
        Dim F As Boolean = False
        Dim Str As String
        Str = "INSERT INTO PrMsPeriodDeductions" & _
        " (PrdCod_Code, PrdGrp_Code, DedCod_Code, PrdDed_IsActive)" & _
        " SELECT PrdCod_Code, " & enQuoteString(NewCode) & " , DedCod_Code, PrdDed_IsActive" & _
        " FROM PrMsPeriodDeductions AS PrMsPeriodDeductions_1" & _
        " where PrdGrp_Code =" & enQuoteString(OldCode)

        If ExecuteNonQuery(Str) >= 0 Then
            F = True
        End If
        Return F


    End Function
    Protected Function CreateNewPeriodContributions(ByVal OldCode As String, ByVal NewCode As String) As Boolean
        Dim F As Boolean = False
        Dim Str As String
        Str = "INSERT INTO PrMsPeriodContributions" & _
        " (PrdCod_Code, PrdGrp_Code, ConCod_Code, PrdCon_IsActive)" & _
        " SELECT PrdCod_Code, " & enQuoteString(NewCode) & ", ConCod_Code, PrdCon_IsActive" & _
        " FROM PrMsPeriodContributions AS PrMsPeriodContributions_1" & _
        " where PrdGrp_Code =" & enQuoteString(OldCode)

        If ExecuteNonQuery(Str) >= 0 Then
            F = True
        End If
        Return F


    End Function


    Protected Function CreateNewTemplateEarnings(ByVal OldCode As String, ByVal NewCode As String) As Boolean
        Dim F As Boolean = False
        Dim Str As String
        Str = "INSERT INTO PrMsTemplateEarnings " & _
            " ( TemGrp_Code, ErnCod_Code, TemErn_DisplayName, TemErn_IsDispalyed, TemErn_Sequence, TemErn_TypeMode, TemErn_FromMode, " & _
            " TemErn_CalcFormula, TemErn_CreationDate, TemErn_CreatedBy, TemErn_AmendDate, TemErn_AmendBy, TemErn_NavCreditAccount, TemErn_NavDebitAccount)" & _
            " SELECT " & enQuoteString(NewCode) & ", ErnCod_Code, TemErn_DisplayName, TemErn_IsDispalyed, TemErn_Sequence, TemErn_TypeMode, TemErn_FromMode, " & _
            " TemErn_CalcFormula, TemErn_CreationDate, TemErn_CreatedBy, TemErn_AmendDate, TemErn_AmendBy, TemErn_NavCreditAccount, " & _
            " TemErn_NavDebitAccount" & _
            " FROM PrMsTemplateEarnings AS PrMsTemplateEarnings_1" & _
            " where PrMsTemplateEarnings_1.TemGrp_Code =" & enQuoteString(OldCode)

        If ExecuteNonQuery(Str) >= 0 Then
            F = True
        End If
        Return F

    End Function
    Protected Function CreateNewTemplateDeductions(ByVal OldCode As String, ByVal NewCode As String) As Boolean
        Dim F As Boolean = False
        Dim Str As String
        Str = "INSERT INTO PrMsTemplateDeductions " & _
            " ( TemGrp_Code, DedCod_Code, TemDed_DisplayName, TemDed_IsDispalyed, TemDed_Sequence, TemDed_TypeMode, TemDed_FromMode, " & _
            " TemDed_CalcFormula, TemDed_CreationDate, TemDed_CreatedBy, TemDed_AmendDate, TemDed_AmendBy, TemDed_NavCreditAccount, TemDed_NavDebitAccount)" & _
            " SELECT " & enQuoteString(NewCode) & ", DedCod_Code, TemDed_DisplayName, TemDed_IsDispalyed, TemDed_Sequence, TemDed_TypeMode, TemDed_FromMode, " & _
            " TemDed_CalcFormula, TemDed_CreationDate, TemDed_CreatedBy, TemDed_AmendDate, TemDed_AmendBy, TemDed_NavCreditAccount, " & _
            " TemDed_NavDebitAccount" & _
            " FROM PrMsTemplateDeductions AS PrMsTemplatedeductions_1" & _
            " where PrMsTemplateDeductions_1.temgrp_Code =" & enQuoteString(OldCode)

        If ExecuteNonQuery(Str) >= 0 Then
            F = True
        End If
        Return F


    End Function
    Protected Function CreateNewTemplateContributions(ByVal OldCode As String, ByVal NewCode As String) As Boolean
        Dim F As Boolean = False
        Dim Str As String
        Str = "INSERT INTO PrMsTemplateContributions " & _
            " ( TemGrp_Code, ConCod_Code, TemCon_DisplayName, TemCon_IsDispalyed, TemCon_Sequence, TemCon_TypeMode, TemCon_FromMode, " & _
            " TemCon_CalcFormula, TemCon_CreationDate, TemCon_CreatedBy, TemCon_AmendDate, TemCon_AmendBy, TemCon_NavCreditAccount, TemCon_NavDebitAccount)" & _
            " SELECT " & enQuoteString(NewCode) & ", ConCod_Code, TemCon_DisplayName, TemCon_IsDispalyed, TemCon_Sequence, TemCon_TypeMode, TemCon_FromMode, " & _
            " TemCon_CalcFormula, TemCon_CreationDate, TemCon_CreatedBy, TemCon_AmendDate, TemCon_AmendBy, TemCon_NavCreditAccount, " & _
            " TemCon_NavDebitAccount" & _
            " FROM PrMsTemplateContributions AS PrMsTemplateContributions_1" & _
            " where PrMsTemplateContributions_1.temgrp_Code =" & enQuoteString(OldCode)

        If ExecuteNonQuery(Str) >= 0 Then
            F = True
        End If
        Return F
    End Function

   



    Protected Function CreateNewInterfaceTemplateEarnings(ByVal OldCode As String, ByVal NewCode As String, ByVal NewTempGrpCode As String, ByVal OldComp As String, ByVal NewComp As String) As Boolean
        Dim F As Boolean = False
        Dim Str As String
        Str = "INSERT INTO PrMsEarningsInterface" & _
              " (IntTem_Code, TemGrp_Code, ErnCod_Code, ErnInt_CreditAcc, ErnInt_CreditConsolLevel, ErnInt_DebitAcc, ErnInt_DebitConsolLevel, ErnInt_CreditAnal, " & _
              " ErnInt_DebitAnal)" & _
              " SELECT " & enQuoteString(NewCode) & _
              "," & enQuoteString(NewTempGrpCode) & _
              ", ErnCod_Code " & _
              ", replace(ErnInt_CreditAcc," & enQuoteString(OldComp & "-") & "," & enQuoteString(NewComp & "-") & ")" & _
              ", ErnInt_CreditConsolLevel" & _
              ", replace(ErnInt_DebitAcc," & enQuoteString(OldComp & "-") & "," & enQuoteString(NewComp & "-") & ")" & _
              ", ErnInt_DebitConsolLevel" & _
              ", ErnInt_CreditAnal, " & _
              " ErnInt_DebitAnal " & _
              " FROM         PrMsEarningsInterface AS PrMsEarningsInterface_1" & _
              " where IntTem_Code =" & enQuoteString(OldCode)
        If ExecuteNonQuery(Str) >= 0 Then
            F = True
        End If
        Return F

    End Function
    Protected Function CreateNewInterfaceTemplateDeductions(ByVal OldCode As String, ByVal NewCode As String, ByVal NewTempGrpCode As String, ByVal OldComp As String, ByVal NewComp As String) As Boolean
        Dim F As Boolean = False
        Dim Str As String
        Str = "INSERT INTO PrMsDeductionsInterface" & _
                " (IntTem_Code, TemGrp_Code, dedCod_Code, dedInt_CreditAcc, dedInt_CreditConsolLevel, dedInt_DebitAcc, dedInt_DebitConsolLevel, dedInt_CreditAnal, " & _
                " dedInt_DebitAnal)" & _
                " SELECT " & enQuoteString(NewCode) & _
                "," & enQuoteString(NewTempGrpCode) & _
                ", dedCod_Code " & _
                ", replace(dedInt_CreditAcc," & enQuoteString(OldComp & "-") & "," & enQuoteString(NewComp & "-") & ")" & _
                ", dedInt_CreditConsolLevel" & _
                ", replace(dedInt_DebitAcc," & enQuoteString(OldComp & "-") & "," & enQuoteString(NewComp & "-") & ")" & _
                ", dedInt_DebitConsolLevel" & _
                ", dedInt_CreditAnal, " & _
                " dedInt_DebitAnal " & _
                " FROM         PrMsDeductionsInterface AS PrMsDeductionsInterface_1" & _
                " where IntTem_Code =" & enQuoteString(OldCode)

        If ExecuteNonQuery(Str) >= 0 Then
            F = True
        End If
        Return F


    End Function
    Protected Function CreateNewInterfaceTemplateContributions(ByVal OldCode As String, ByVal NewCode As String, ByVal NewTempGrpCode As String, ByVal OldComp As String, ByVal NewComp As String) As Boolean
        Dim F As Boolean = False
        Dim Str As String
        Str = "INSERT INTO PrMsContributionsInterface" & _
                " (IntTem_Code, TemGrp_Code, ConCod_Code, ConInt_CreditAcc, ConInt_CreditConsolLevel, ConInt_DebitAcc, ConInt_DebitConsolLevel, ConInt_CreditAnal, " & _
                " ConInt_DebitAnal)" & _
                " SELECT " & enQuoteString(NewCode) & _
                "," & enQuoteString(NewTempGrpCode) & _
                ", ConCod_Code " & _
                ", replace(ConInt_CreditAcc," & enQuoteString(OldComp & "-") & "," & enQuoteString(NewComp & "-") & ")" & _
                ", ConInt_CreditConsolLevel" & _
                ", replace(ConInt_DebitAcc," & enQuoteString(OldComp & "-") & "," & enQuoteString(NewComp & "-") & ")" & _
                ", ConInt_DebitConsolLevel" & _
                ", ConInt_CreditAnal, " & _
                " ConInt_DebitAnal " & _
                " FROM         PrMsContributionsInterface AS PrMsContributionsInterface_1" & _
                " where IntTem_Code =" & enQuoteString(OldCode)

        If ExecuteNonQuery(Str) >= 0 Then
            F = True
        End If
        Return F
    End Function
    Public Shadows Function CreateNewInterfaceCodes(ByVal NewTempGrpCode As String, ByVal OldTempGrpCode As String, ByVal OldComp As String, ByVal NewComp As String)
        Dim Str As String
        Dim F As Boolean = False
        Str = "INSERT INTO PrMsInterfaceCodes" & _
        " (IntCod_Code, TemGrp_Code, IntCod_Description, IntCod_AccountType)" & _
        " SELECT     replace(IntCod_Code," & enQuoteString(OldComp & "-") & "," & enQuoteString(NewComp & "-") & ")," & _
        enQuoteString(NewTempGrpCode) & " ,IntCod_Description, IntCod_AccountType" & _
        " FROM         PrMsInterfaceCodes AS PrMsInterfaceCodes_1" & _
        " WHERE     (TemGrp_Code = " & enQuoteString(OldTempGrpCode) & ")"

        If ExecuteNonQuery(Str) >= 0 Then
            F = True
        End If
        Return F
    End Function
    Public Shadows Function AddUserOnCompany(ByVal UserName As String, ByVal Comp As cAdMsCompany) As Boolean
        Dim F As Boolean = False
        Dim Str As String
        Str = "INSERT INTO PrSsCompanyUsers " & _
            " (Usr_UserName," & _
            " Com_Code," & _
            " Com_Id)" & _
            " Values" & _
            " (" & enQuoteString(UserName) & _
             "," & enQuoteString(Comp.Code) & _
             "," & Comp.Id & ")"

        If ExecuteNonQuery(Str) >= 0 Then
            F = True
        End If
        Return F
    End Function
    Public Shadows Function UserExistInCompany(ByVal UserName As String, ByVal Comp As cAdMsCompany) As Boolean
        Dim F As Boolean = False
        Dim Str As String
        Str = "Select * From PrSsCompanyUsers " & _
            " Where Usr_UserName=" & enQuoteString(UserName) & _
            " AND Com_Code=" & enQuoteString(Comp.Code)
            
        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            F = True
        End If
        Return F
    End Function
    Public Function DeleteUserFromCompany(ByVal UserName As String, ByVal Comp As cAdMsCompany) As Boolean
        Dim F As Boolean = False
        Dim Str As String
        Str = "DELETE From PrSsCompanyUsers " & _
            " Where Usr_UserName=" & enQuoteString(UserName) & _
            " AND Com_code=" & enQuoteString(Comp.Code)

        If ExecuteNonQuery(Str) >= 0 Then
            F = True
        End If
        Return F
    End Function

    Public Function GetUserCompanies(ByVal UserName As String) As DataSet
        Dim Str As String
        Str = "Select Com_Code,Com_Id from PrSsCompanyUsers Where Usr_UserName=" & enQuoteString(UserName)

        Return GetData(Str)

    End Function
    Public Function GetAllUserForAllCompanies(ByVal Year As String) As DataSet
        Dim Str As String
        Str = "SELECT PrSsCompanyUsers.Usr_UserName," & _
            " AaSsUsers.Usr_FullName," & _
            " PrSsCompanyUsers.Com_Code," & _
            " AdMsCompany.Com_Name" & _
            " FROM PrSsCompanyUsers INNER JOIN" & _
            " AdMsCompany ON PrSsCompanyUsers.Com_Id = AdMsCompany.Com_Id INNER JOIN" & _
            " AaSsUsers ON PrSsCompanyUsers.Usr_UserName = AaSsUsers.Usr_UserName" & _
            " Where PrSsCompanyUsers.Usr_UserName <>'nodal'" & _
            " and AdMsCompany.com_code in (Select com_code COLLATE Greek_CI_AS from PrTxTrxnHeader where TrxHdr_Year =" & enQuoteString(Year) & ")" & _
            " order by PrSsCompanyUsers.Usr_UserName"

        Return GetData(Str)

    End Function
    Public Function GetAllPrSsEmployeeSplitByEmpCode(ByVal EmpCode As String) As DataSet
        Dim str As String
        str = " SELECT Spl_id, " & _
        " Emp_Code, " & _
        " Spl_Description, " & _
        " Spl_Value,  " & _
        " Spl_Enabled, " & _
        " Spl_NoOfPeriods, " & _
        " Spl_IsPF,  " & _
        " Spl_IsST, " & _
        " Spl_CreationDate, " & _
        " Spl_CreatedBy, " & _
        " Spl_AmendDate,  " & _
        " Spl_AmendedBy,  " & _
        " Spl_ActivePeriods  " & _
        " FROM PrSsEmployeeSplit " & _
        " WHERE Emp_Code = " & enQuoteString(EmpCode)

        Return GetData(str)

    End Function
    Protected Function GetSplitByEmpCodeForTAX(ByVal EmpCode As String, ByVal PeriodType As String) As Double
        Dim str As String
        Dim Str2 As String
        Dim Value As Double = 0

        str = " SELECT sum(Spl_Value) " & _
        " FROM PrSsEmployeeSplit " & _
        " WHERE Emp_Code = " & enQuoteString(EmpCode) & _
        " and Spl_Enabled='Y' "

        If PeriodType = "K" Then
            Str2 = " and (Spl_NoOfPeriods='12' OR Spl_NoOfPeriods='13') "
        End If
        If PeriodType = "3" Then
            Str2 = " and (Spl_NoOfPeriods='13')"
        End If
        

        str = str & Str2
        Dim Ds As DataSet
        Ds = GetData(str)
        Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))

        Return Value

    End Function
    Protected Function GetSplitByEmpCodeForTAX_TimesPeriods(ByVal EmpCode As String, ByVal PeriodType As String) As Double
        Dim str As String
        Dim Str2 As String
        Dim Value As Double = 0

        str = " SELECT sum(Spl_Value*Spl_ActivePeriods) " & _
        " FROM PrSsEmployeeSplit " & _
        " WHERE Emp_Code = " & enQuoteString(EmpCode) & _
        " and Spl_Enabled='Y' "

        If PeriodType = "K" Then
            Str2 = " and (Spl_NoOfPeriods='12' OR Spl_NoOfPeriods='13') "
        End If
        If PeriodType = "3" Then
            Str2 = " and (Spl_NoOfPeriods='13')"
        End If


        str = str & Str2
        Dim Ds As DataSet
        Ds = GetData(str)
        Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))

        Return Value

    End Function
   
    Protected Function GetSplitByEmpCodeForProvidentFund(ByVal EmpCode As String, ByVal PeriodType As String) As Double
        Dim str As String
        Dim Str2 As String
        Dim Value As Double = 0

        str = " SELECT sum(Spl_Value) " & _
        " FROM PrSsEmployeeSplit " & _
        " WHERE Emp_Code = " & enQuoteString(EmpCode) & _
        " and Spl_Enabled='Y' " & _
        " and Spl_isPF='Y' "

        'If PeriodType = "K" Then
        Str2 = " and (Spl_NoOfPeriods='12' OR Spl_NoOfPeriods='13')"
        'End If
        'If PeriodType = "3" Then
        ' Str2 = " and (Spl_NoOfPeriods='13')"
        ' End If
        ' If PeriodType = "4" Then
        ' Str2 = " and (Spl_NoOfPeriods='14') "
        ' End If

        str = str & Str2
        Dim Ds As DataSet
        Ds = GetData(str)
        Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))

        Return Value

    End Function
    Protected Function GetSplitByEmpCodeForSpecialTAX(ByVal EmpCode As String, ByVal PeriodType As String) As Double
        Dim str As String
        Dim Str2 As String
        Dim Value As Double = 0

        str = " SELECT sum(Spl_Value) " & _
        " FROM PrSsEmployeeSplit " & _
        " WHERE Emp_Code = " & enQuoteString(EmpCode) & _
        " and Spl_Enabled='Y' " & _
        " and Spl_isST='Y' "

        ' If PeriodType = "K" Then
        Str2 = " and (Spl_NoOfPeriods='12' OR Spl_NoOfPeriods='13')"
        ' End If
        ' If PeriodType = "3" Then
        ' Str2 = " and (Spl_NoOfPeriods='13' or Spl_NoOfPeriods='14') "
        ' End If
        'If PeriodType = "4" Then
        ' Str2 = " and (Spl_NoOfPeriods='14') "
        ' End If

        str = str & Str2
        Dim Ds As DataSet
        Ds = GetData(str)
        Value = DbNullToDouble(Ds.Tables(0).Rows(0).Item(0))

        Return Value

    End Function
    Protected Function Upgrade2016()
        Dim Str As String
        Dim i As Integer
        Str = "ALTER TABLE PrTxtrxnheader " & _
        " ADD TrxHdr_NormalDays decimal(18, 2) NULL, " & _
        " TrxHdr_Salary1 decimal(18, 2) NULL, " & _
        " TrxHdr_Salary2 decimal(18, 2) NULL, " & _
        " TrxHdr_Overtime3 decimal(10, 2) NULL "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If


        Str = "ALTER TABLE PrTxEmployeeLeave " & _
        " ADD Hdr_Id Int NULL "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrTxEmployeeLeave", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxEmployeeLeave", MsgBoxStyle.Critical)
        End If



        Str = " CREATE TABLE [dbo].[PrMsPeriodWorkDays]( " & _
        " [PrdNrm_Id] [int] IDENTITY(1,1) NOT NULL, " & _
        " [PrdGrp_Code] [varchar](6) NULL, " & _
        " [PrdCod_Code] [varchar](6) NULL, " & _
        " [PrdNrm_WorkDays] [decimal](18, 2) NULL, " & _
        " CONSTRAINT [PK_PrMsPeriodWorkDays] PRIMARY KEY CLUSTERED " & _
        " (" & _
        " [PrdNrm_Id] ASC " & _
        " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] " & _
        " ) ON [PRIMARY]"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New Table PrMsPeriodWorkDays Added", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New Table PrMsPeriodWorkDays", MsgBoxStyle.Critical)
        End If

        Str = " CREATE TABLE [dbo].[PrSsUserPermition](" & _
        " [UsrAth_Id] [int] IDENTITY(1,1) NOT NULL," & _
        " [Com_Code] [char](8) NOT NULL," & _
        " [Usr_Code] [varchar](30) NOT NULL," & _
        " [UsrAth_Entity] [varchar](50) NOT NULL," & _
        " [UsrAth_Full] [int] NOT NULL," & _
        " [UsrAth_ReadOnly] [int] NOT NULL," & _
        " [UsrAth_No] [int] NOT NULL," & _
        " CONSTRAINT [PK_PrSsUserPermition] PRIMARY KEY CLUSTERED " & _
        "( " & _
        "	[UsrAth_Id] ASC" & _
        " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]" & _
        " ) ON [PRIMARY]"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New Table PrssUserPermitions Added", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New Table PrSsUserPermitions", MsgBoxStyle.Critical)
        End If

        Str = " ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE] " & _
        " @TrxHdr_Id int, " & _
        " @Emp_Code varchar(16), " & _
        " @PrdGrp_Code varchar(6), " & _
        " @PrdCod_Code varchar(6), " & _
        " @PayCat_Code varchar(4), " & _
        " @TrxHdr_Date datetime, " & _
        " @TrxHdr_Status varchar(4), " & _
        " @TrxHdr_TotalErnPeriod decimal(18,2), " & _
        " @TrxHdr_TotalErnYTD decimal(18,2), " & _
        " @TrxHdr_TotalDedPeriod decimal(18,2), " & _
        " @TrxHdr_TotalDedYTD decimal(18,2), " & _
        " @TrxHdr_TotalConPeriod decimal(18,2), " & _
        " @TrxHdr_TotalConYTD decimal(18,2), " & _
        " @TrxHdr_SIIncome decimal(18,2), " & _
        " @TrxHdr_TaxableIncome decimal(18,2), " & _
        " @TrxHdr_PaymentMethod varchar(50), " & _
        " @TrxHdr_PaymentRef varchar(50), " & _
        " @TrxHdr_PeriodUnits decimal(18,2), " & _
        " @TrxHdr_AnnualUnits decimal(18,2), " & _
        " @TrxHdr_AnnualLeave decimal(18,2), " & _
        " @TrxHdr_LifeInsurance decimal(18,2), " & _
        " @TrxHdr_Discounts decimal(18,2), " & _
        " @TrxHdr_Interfacestatus varchar(4), " & _
        " @TrxHdr_Overtime1 decimal(10,2), " & _
        " @TrxHdr_Overtime2 decimal(10,2), " & _
        " @TrxHdr_SIUnits decimal(10,2), " & _
        " @TrxHdr_MonthlySalary decimal(18,2), " & _
        " @TrxHdr_NetSalary decimal(18,2), " & _
        " @TrxHdr_PeriodInsurable decimal(18,2), " & _
        " @TemGrp_Code varchar(6), " & _
        " @TrxHdr_ChequeNo varchar(50), " & _
        " @TrxHdr_TaxableFromOther Decimal(18,2), " & _
        " @TrxHdr_CurrencySymbol varchar(3), " & _
        " @TrxHdr_Rate Decimal(18,10), " & _
        " @TrxHdr_NormalDays Decimal(18,2), " & _
        " @TrxHdr_Salary1 Decimal(18,2), " & _
        " @TrxHdr_Salary2 Decimal(18,2), " & _
        " @TrxHdr_Overtime3 decimal(10,2), " & _
        " @NewId Int OUTPUT " & _
        " AS " & _
        " DECLARE @Result as Int " & _
        " Set @Result = 0 " & _
        " SELECT @Result = Count(*) " & _
        " FROM PrTxTrxnHeader " & _
        " WHERE TrxHdr_Id = @TrxHdr_Id " & _
        " IF(@Result IS NULL) OR (@Result=0) " & _
        " BEGIN " & _
        " INSERT INTO PrTxTrxnHeader " & _
        " (Emp_Code,                                           " & _
        " PrdGrp_Code,                                       " & _
        " PrdCod_Code,                                       " & _
        " PayCat_Code,                                        " & _
        " TrxHdr_Date,                                        " & _
        " TrxHdr_Status,                                      " & _
        " TrxHdr_TotalErnPeriod,                              " & _
        " TrxHdr_TotalErnYTD,                                 " & _
        " TrxHdr_TotalDedPeriod,                              " & _
        " TrxHdr_TotalDedYTD,                                 " & _
        " TrxHdr_TotalConPeriod,                              " & _
        " TrxHdr_TotalConYTD,                                 " & _
        " TrxHdr_SIIncome,                                    " & _
        " TrxHdr_TaxableIncome,                               " & _
        " TrxHdr_PaymentMethod,                               " & _
        " TrxHdr_PaymentRef,                                  " & _
        " TrxHdr_PeriodUnits,                                 " & _
        " TrxHdr_AnnualUnits,                                 " & _
        " TrxHdr_AnnualLeave,                                 " & _
        " TrxHdr_LifeInsurance,                               " & _
        " TrxHdr_Discounts,                                   " & _
        " TrxHdr_InterfaceStatus,                             " & _
        " TrxHdr_Overtime1, " & _
        " TrxHdr_Overtime2, " & _
        " TrxHdr_SIUnits, " & _
        " TrxHdr_MonthlySalary, " & _
        " TrxHdr_NetSalary, " & _
        " TrxHdr_PeriodInsurable, " & _
        " TemGrp_Code, " & _
        " TrxHdr_ChequeNo, " & _
        " TrxHdr_TaxableFromOther, " & _
        " TrxHdr_CurrencySymbol, " & _
        " TrxHdr_Rate, " & _
        " TrxHdr_NormalDays, " & _
        " TrxHdr_Salary1, " & _
        " TrxHdr_Salary2, " & _
        " TrxHdr_Overtime3 " & _
        " ) " & _
        " VALUES ( " & _
        " @Emp_Code,                                           " & _
        " @PrdGrp_Code, " & _
        " @PrdCod_Code,                                        " & _
        " @PayCat_Code,                                        " & _
        " @TrxHdr_Date,                                        " & _
        " @TrxHdr_Status,                                      " & _
        " @TrxHdr_TotalErnPeriod,                              " & _
        " @TrxHdr_TotalErnYTD,                                 " & _
        " @TrxHdr_TotalDedPeriod,                              " & _
        " @TrxHdr_TotalDedYTD,                                 " & _
        " @TrxHdr_TotalConPeriod,                              " & _
        " @TrxHdr_TotalConYTD,                                 " & _
        " @TrxHdr_SIIncome,                                    " & _
        " @TrxHdr_TaxableIncome,                               " & _
        " @TrxHdr_PaymentMethod,                               " & _
        " @TrxHdr_PaymentRef,                                  " & _
        " @TrxHdr_PeriodUnits,                                 " & _
        " @TrxHdr_AnnualUnits,                                 " & _
        " @TrxHdr_AnnualLeave,                                 " & _
        " @TrxHdr_LifeInsurance,                               " & _
        " @TrxHdr_Discounts,                                   " & _
        " @TrxHdr_InterfaceStatus,                             " & _
        " @TrxHdr_Overtime1, " & _
        " @TrxHdr_Overtime2, " & _
        " @TrxHdr_SIUnits, " & _
        " @TrxHdr_MonthlySalary, " & _
        " @TrxHdr_NetSalary, " & _
        " @TrxHdr_PeriodInsurable, " & _
        " @TemGrp_Code,  " & _
        " @TrxHdr_ChequeNo, " & _
        " @TrxHdr_TaxableFromOther, " & _
        " @TrxHdr_CurrencySymbol, " & _
        " @TrxHdr_Rate, " & _
        " @TrxHdr_NormalDays, " & _
        " @TrxHdr_Salary1, " & _
        " @TrxHdr_Salary2," & _
        " @TrxHdr_Overtime2 " & _
        " ) " & _
        " END " & _
        " ELSE " & _
        " BEGIN " & _
        " UPDATE PrTxTrxnHeader " & _
        " SET  " & _
        " Emp_Code=@Emp_Code,                                   " & _
        " PrdGrp_Code=@PrdGrp_Code, " & _
        " PrdCod_Code=@PrdCod_Code,                             " & _
        " PayCat_Code=@PayCat_Code,                             " & _
        " TrxHdr_Date=@TrxHdr_Date,                             " & _
        " TrxHdr_Status=@TrxHdr_Status,                         " & _
        " TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " & _
        " TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " & _
        " TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " & _
        " TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " & _
        " TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " & _
        " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " & _
        " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " & _
        " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " & _
        " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " & _
        " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " & _
        " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " & _
        " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " & _
        " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,               " & _
        " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " & _
        " TrxHdr_Discounts=@TrxHdr_Discounts,                   " & _
        " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,       " & _
        " TrxHdr_Overtime1=@TrxHdr_Overtime1, " & _
        " TrxHdr_Overtime2=@TrxHdr_Overtime2, " & _
        " TrxHdr_SIUnits=@TrxHdr_SIUnits, " & _
        " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary, " & _
        " TrxHdr_NetSalary=@TrxHdr_NetSalary, " & _
        " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable, " & _
        " TemGrp_Code=@TemGrp_Code, " & _
        " TrxHdr_ChequeNo=@TrxHdr_ChequeNo , " & _
        " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther, " & _
        " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol, " & _
        " TrxHdr_Rate=@TrxHdr_Rate, " & _
        " TrxHdr_NormalDays=@TrxHdr_NormalDays, " & _
        " TrxHdr_Salary1=@TrxHdr_Salary1, " & _
        " TrxHdr_Salary2=@TrxHdr_Salary2, " & _
        " TrxHdr_Overtime3=@TrxHdr_Overtime3 " & _
        " WHERE TrxHdr_Id = @TrxHdr_Id " & _
        " END " & _
        " set @NewId=SCOPE_IDENTITY() "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If




        Str = " ALTER PROCEDURE [dbo].[AG_PrTxEmployeeLeave_SAVE_UPDATE] " & _
        " @EmpLea_id int, " & _
        " @EmpLea_Status varchar(20), " & _
        " @Emp_Code varchar(16), " & _
        " @EmpLea_Type varchar(30), " & _
        " @EmpLea_ReqDate smalldatetime, " & _
        " @EmpLea_ProcDate smalldatetime, " & _
        " @EmpLea_ProcBy int, " & _
        " @EmpLea_FromDate smalldatetime, " & _
        " @EmpLea_ToDate smalldatetime, " & _
        " @EmpLea_Units decimal(8,2), " & _
        " @EmpLea_Action varchar(50), " & _
        " @Hdr_Id Int, " & _
        " @NewId Int OUTPUT " & _
        " AS " & _
        " DECLARE @Result as Int " & _
        " Set @Result = 0 " & _
        " SELECT @Result = Count(*) " & _
        " FROM PrTxEmployeeLeave " & _
        " WHERE EmpLea_id = @EmpLea_id " & _
        " IF(@Result IS NULL) OR (@Result=0) " & _
        " BEGIN " & _
        " INSERT INTO PrTxEmployeeLeave " & _
        " (EmpLea_Status, " & _
        " Emp_Code, " & _
        " EmpLea_Type, " & _
        " EmpLea_ReqDate, " & _
        " EmpLea_ProcDate, " & _
        " EmpLea_ProcBy, " & _
        " EmpLea_FromDate, " & _
        " EmpLea_ToDate, " & _
        " EmpLea_Units, " & _
        " EmpLea_Action, " & _
        " Hdr_Id " & _
        " ) " & _
        " VALUES ( " & _
        " @EmpLea_Status, " & _
        " @Emp_Code, " & _
        " @EmpLea_Type, " & _
        " @EmpLea_ReqDate, " & _
        " @EmpLea_ProcDate, " & _
        " @EmpLea_ProcBy, " & _
        " @EmpLea_FromDate, " & _
        " @EmpLea_ToDate, " & _
        " @EmpLea_Units, " & _
        " @EmpLea_Action, " & _
        " @Hdr_Id " & _
        " ) " & _
        " END " & _
        " ELSE " & _
        " BEGIN " & _
        " UPDATE PrTxEmployeeLeave " & _
        " SET  " & _
        " EmpLea_Status=@EmpLea_Status, " & _
        " Emp_Code=@Emp_Code, " & _
        " EmpLea_Type=@EmpLea_Type, " & _
        " EmpLea_ReqDate=@EmpLea_ReqDate, " & _
        " EmpLea_ProcDate=@EmpLea_ProcDate, " & _
        " EmpLea_ProcBy=@EmpLea_ProcBy, " & _
        " EmpLea_FromDate=@EmpLea_FromDate, " & _
        " EmpLea_ToDate=@EmpLea_ToDate, " & _
        " EmpLea_Units=@EmpLea_Units, " & _
        " EmpLea_Action=@EmpLea_Action, " & _
        " Hdr_Id=@Hdr_Id " & _
        " WHERE EmpLea_id =@EmpLea_id " & _
        " END " & _
        " set @NewId=SCOPE_IDENTITY() "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxEmployeeLeave was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrTxEmployeeLeave", MsgBoxStyle.Critical)
        End If

        Return True

    End Function

    Protected Function Upgrade2016_B()
        Dim Str As String
        Dim i As Integer
        Str = "ALTER TABLE PrTxtrxnheader " & _
        " ADD [TrxHdr_Sectors] [decimal](18, 2) NULL," & _
        "[TrxHdr_DutyHours] [decimal](18, 2) NULL," & _
        "[TrxHdr_FlightHours] [decimal](18, 2) NULL," & _
        "[TrxHdr_Commission] [decimal](18, 2) NULL," & _
        "[TrxHdr_PBAmount] [decimal](18, 2) NULL," & _
         "[TrxHdr_PBRate] [decimal](18, 2) NULL"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If


        Str = "ALTER TABLE PrTxTrxnLines " & _
        " ADD [TrxLin_ConsolDesc] [varchar](50) NULL "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrTxTrxnLines", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnLines", MsgBoxStyle.Critical)
        End If


        Str = "ALTER TABLE PrMsEmployees " & _
        " ADD [SecPay_Code] [varchar](4) NULL," & _
        " [ComRat_Code] [varchar](4) NULL," & _
        " [PerBon_Code] [varchar](4) NULL," & _
        " [DutHou_Code] [varchar](4) NULL," & _
        " [FliHou_Code] [varchar](4) NULL," & _
        " [Emp_PassFullName] [varchar](100) NULL," & _
        " [Emp_TravelDocs] [varchar](100) NULL," & _
        " [Emp_FirstEmployment] [char](1) NULL "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        '------------------------------------------
        '               NEW TABLES
        '------------------------------------------


        Str = " CREATE TABLE [dbo].[PrSsCommissionRates] (" & _
        " [ComRat_Code] [varchar](4) NOT NULL," & _
        " [ComRat_Desc] [varchar](40) NOT NULL," & _
        " [ComRat_Value] [decimal](5, 2) NOT NULL," & _
        " CONSTRAINT [PK_PrSsCommissionRates] PRIMARY KEY CLUSTERED " & _
        " (" & _
        " [ComRat_Code] Asc " & _
        " ) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON)" & _
        " ON [PRIMARY]) ON [PRIMARY]"
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New Table PrSsCommissionRates Added", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New Table PrSsCommissionRates", MsgBoxStyle.Critical)
        End If

        Str = "CREATE TABLE [dbo].[PrSsFlightHour] (" & _
        " [FliHou_Code] [varchar](4) NOT NULL," & _
        " [FliHou_Desc] [varchar](40) NOT NULL," & _
        " [FliHou_HourRate] [decimal](18, 2) NOT NULL," & _
        " [FliHou_Limit] [decimal](18, 2) NOT NULL," & _
        " [FliHou_LimitCode] [varchar](4) NOT NULL," & _
        "  CONSTRAINT [PK_PrSsFlightHour] PRIMARY KEY CLUSTERED " & _
        " ( " & _
        " [FliHou_Code] Asc " & _
        " ) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]" & _
        " ) ON [PRIMARY]"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New Table PrssFlightHours", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New Table PrSsFlightHour", MsgBoxStyle.Critical)
        End If

        Str = "CREATE TABLE [dbo].[PrSsDutyHours](" & _
        " [DutHou_Code] [varchar](4) NOT NULL," & _
        " [DutHou_Desc] [varchar](40) NOT NULL," & _
        " [DutHou_HourRate] [decimal](18, 2) NOT NULL," & _
        " CONSTRAINT [PK_PrSsDutyHours] PRIMARY KEY CLUSTERED " & _
        "(" & _
        " [DutHou_Code] ASC" & _
        " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]" & _
        " ) ON [PRIMARY]"


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New Table PrSsDutyHours", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New Table PrSsDutyHours", MsgBoxStyle.Critical)
        End If

        Str = "CREATE TABLE [dbo].[PrSsPerformanceBonus](" & _
        " [PerBon_Code] [varchar](4) NOT NULL," & _
        " [PerBon_Desc] [varchar](40) NOT NULL," & _
        " [PerBon_Value] [decimal](18, 2) NOT NULL," & _
        " [PerBon_Rate] [decimal](5, 2) NOT NULL," & _
        " [PerBon_Type] [char](1) NOT NULL," & _
        " [PerBon_Formula] [char](1) NOT NULL," & _
        "  CONSTRAINT [PK_PrSsPerformanceBonus] PRIMARY KEY CLUSTERED " & _
        "  (" & _
        "   [PerBon_Code] Asc" & _
        "   )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]" & _
        "   ) ON [PRIMARY]"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New Table PrSsPerfomanceBonus", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New Table PrSsPerformanceBonus", MsgBoxStyle.Critical)
        End If

        Str = "CREATE TABLE [dbo].[PrSsSectorPay](" & _
        " [SecPay_Code] [varchar](4) NOT NULL," & _
        " [SecPay_Desc] [varchar](40) NOT NULL," & _
        " [SecPay_HourRate] [decimal](18, 2) NOT NULL," & _
        " CONSTRAINT [PK_PrSsSectorPay] PRIMARY KEY CLUSTERED " & _
        " (" & _
        " [SecPay_Code] Asc" & _
        " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]" & _
        " ) ON [PRIMARY]"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New Table PrSsSectorPay", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New Table PrSsSectorPay", MsgBoxStyle.Critical)
        End If


        '------------------------------------------
        '               NEW STORE PROCEDURES
        '------------------------------------------
        Str = "Create PROCEDURE [dbo].[AG_PrSsPerformanceBonus_SAVE_UPDATE] " & _
        " @PerBon_Code varchar(4), " & _
        " @PerBon_Desc varchar(40), " & _
        " @PerBon_Value decimal(18,2), " & _
        " @PerBon_Rate decimal(5,2), " & _
        " @PerBon_Type varchar(1), " & _
        " @PerBon_Formula varchar(1) " & _
        " AS " & _
        " DECLARE @Result as Int " & _
        " Set @Result = 0 " & _
        " SELECT @Result = Count(*) " & _
        " FROM PrSsPerformanceBonus " & _
        " WHERE PerBon_Code = @PerBon_Code " & _
        " IF(@Result IS NULL) OR (@Result=0) " & _
        "   BEGIN " & _
        "     INSERT INTO PrSsPerformanceBonus " & _
        "    (PerBon_Code,                                        " & _
        "     PerBon_Desc,                                        " & _
        "     PerBon_Value, " & _
        "	  PerBon_Rate, " & _
        "	  PerBon_Type, " & _
        "	  PerBon_Formula " & _
        "     ) " & _
        "     VALUES ( " & _
        "    @PerBon_Code,                                        " & _
        "    @PerBon_Desc,                                        " & _
        "    @PerBon_Value, " & _
        "    @PerBon_Rate, " & _
        "    @PerBon_Type, " & _
        "    @PerBon_Formula " & _
        "     ) " & _
        "  END " & _
        " ELSE " & _
        "  BEGIN " & _
        "   UPDATE PrSsPerformanceBonus " & _
        "   SET  " & _
        " PerBon_Code=@PerBon_Code,                             " & _
        " PerBon_Desc=@PerBon_Desc,                             " & _
        " PerBon_Value=@PerBon_Value, " & _
        " PerBon_Rate=@PerBon_Rate, " & _
        " PerBon_Type=@PerBon_Type, " & _
        " PerBon_Formula=@PerBon_Formula " & _
        " WHERE PerBon_Code = @PerBon_Code " & _
        " END "
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrSsPerformanceBonus is Created", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Create SP PrSsPerformanceBonus ", MsgBoxStyle.Critical)
        End If

        Str = " Create PROCEDURE [dbo].[AG_PrSsCommissionrates_SAVE_UPDATE] " & _
        " @ComRat_Code varchar(4), " & _
        " @ComRat_Desc varchar(40), " & _
        " @ComRat_Value decimal(5,2) " & _
        " AS " & _
        " DECLARE @Result as Int " & _
        " Set @Result = 0 " & _
        " SELECT @Result = Count(*) " & _
        " FROM PrSsCommissionrates " & _
        " WHERE ComRat_Code = @ComRat_Code " & _
        " IF(@Result IS NULL) OR (@Result=0) " & _
        " BEGIN " & _
        " INSERT INTO PrSsCommissionrates " & _
        " (ComRat_Code,                                        " & _
        " ComRat_Desc,                                        " & _
        " ComRat_Value                                    " & _
        " ) " & _
        " VALUES ( " & _
        " @ComRat_Code,                                       " & _
        " @ComRat_Desc,                                       " & _
        " @ComRat_Value                                    " & _
        " ) " & _
        " END " & _
        " ELSE " & _
        " BEGIN " & _
        " UPDATE PrSsCommissionrates " & _
        " SET  " & _
        " ComRat_Code=@ComRat_Code,                            " & _
        " ComRat_Desc=@ComRat_Desc,                            " & _
        " ComRat_Value=@ComRat_Value                     " & _
        " WHERE ComRat_Code = @ComRat_Code " & _
        " END "
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrSscommissionRates is created", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Create SP PrSsCommissionRates ", MsgBoxStyle.Critical)
        End If

        ''''
        Str = " Create PROCEDURE [dbo].[AG_PrSsDutyHours_SAVE_UPDATE] " & _
        " @DutHou_Code varchar(4), " & _
        " @DutHou_Desc varchar(40), " & _
        " @DutHou_HourRate decimal(18,2) " & _
        " AS " & _
        "   DECLARE @Result as Int " & _
        "   Set @Result = 0 " & _
        "   SELECT @Result = Count(*) " & _
        "   FROM PrSsDutyHours " & _
        "   WHERE DutHou_Code = @DutHou_Code " & _
        "   IF(@Result IS NULL) OR (@Result=0) " & _
        "     BEGIN " & _
        "       INSERT INTO PrSsDutyHours " & _
        "      (DutHou_Code,                                       " & _
        "       DutHou_Desc,                                       " & _
        "       DutHou_HourRate                                    " & _
        "       ) " & _
        "       VALUES ( " & _
        "       @DutHou_Code,                                      " & _
        "       @DutHou_Desc,                                      " & _
        "       @DutHou_HourRate                                   " & _
        "       ) " & _
        "     END " & _
        " ELSE " & _
        "     BEGIN " & _
        "       UPDATE PrSsDutyHours " & _
        "       SET  " & _
        "       DutHou_Code=@DutHou_Code,                          " & _
        "       DutHou_Desc=@DutHou_Desc,                          " & _
        "       DutHou_HourRate=@DutHou_HourRate                   " & _
        "       WHERE DutHou_Code = @DutHou_Code " & _
        "   END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrSsDutyHours is created", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Create SP PrSsDutyHours ", MsgBoxStyle.Critical)
        End If


        ''''

        Str = " Create PROCEDURE [dbo].[AG_PrSsFlightHour_SAVE_UPDATE] " & _
        " @FliHou_Code varchar(4), " & _
        " @FliHou_Desc varchar(40), " & _
        " @FliHou_HourRate decimal(18,2), " & _
        " @FliHou_Limit decimal(18,2), " & _
        " @FliHou_LimitCode varchar(4) " & _
        " AS " & _
        "   DECLARE @Result as Int " & _
        "   Set @Result = 0 " & _
        "   SELECT @Result = Count(*) " & _
        "   FROM PrSsFlightHour " & _
        "   WHERE FliHou_Code = @FliHou_Code " & _
        "   IF(@Result IS NULL) OR (@Result=0) " & _
        "     BEGIN " & _
        "       INSERT INTO PrSsFlightHour " & _
        "      (FliHou_Code,                                        " & _
        "       FliHou_Desc,                                        " & _
        "       FliHou_HourRate,                                    " & _
        "       FliHou_Limit, " & _
        "       FliHou_LimitCode " & _
        "       ) " & _
        "       VALUES ( " & _
        "       @FliHou_Code,                                       " & _
        "       @FliHou_Desc,                                       " & _
        "       @FliHou_HourRate,                                   " & _
        "       @FliHou_Limit, " & _
        " 	  @FliHou_LimitCode " & _
        "       ) " & _
        "     END " & _
        "   ELSE " & _
        "     BEGIN " & _
        "       UPDATE PrSsFlightHour " & _
        "       SET  " & _
        "       FliHou_Code=@FliHou_Code,                             " & _
        "       FliHou_Desc=@FliHou_Desc,                             " & _
        "       FliHou_HourRate=@FliHou_HourRate,                     " & _
        "       FliHou_Limit=@FliHou_Limit, " & _
        " 	  FliHou_LimitCode=@FliHou_LimitCode " & _
        "       WHERE FliHou_Code = @FliHou_Code " & _
        "   END "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrSsFlightHours is created", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Create SP PrSsFlightHours ", MsgBoxStyle.Critical)
        End If
        ''''''''''''''''

        Str = " Create PROCEDURE [dbo].[AG_PrSsSectorPay_SAVE_UPDATE] " & _
        " @SecPay_Code varchar(4), " & _
        " @SecPay_Desc varchar(40), " & _
        " @SecPay_HourRate decimal(18,2) " & _
        " AS " & _
        "   DECLARE @Result as Int " & _
        "   Set @Result = 0 " & _
        "   SELECT @Result = Count(*) " & _
        "   FROM PrSsSectorPay " & _
        "   WHERE SecPay_Code = @SecPay_Code " & _
        "   IF(@Result IS NULL) OR (@Result=0) " & _
        "     BEGIN " & _
        "       INSERT INTO PrSsSectorPay " & _
        "      (SecPay_Code,                                        " & _
        "       SecPay_Desc,                                        " & _
        "       SecPay_HourRate                                    " & _
        "       ) " & _
        "       VALUES ( " & _
        "       @SecPay_Code,                                        " & _
        "       @SecPay_Desc,                                        " & _
        "       @SecPay_HourRate                                    " & _
        "       ) " & _
        "     END " & _
        "   ELSE " & _
        "     BEGIN " & _
        "       UPDATE PrSsSectorPay " & _
        "       SET  " & _
        "       SecPay_Code=@SecPay_Code,                             " & _
        "       SecPay_Desc=@SecPay_Desc,                             " & _
        "       SecPay_HourRate=@SecPay_HourRate                     " & _
        "       WHERE SecPay_Code = @SecPay_Code " & _
        "   END "



        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrSsSectorPay is created", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Create SP PrSsSectorPay ", MsgBoxStyle.Critical)
        End If

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" & _
        " @Emp_Code varchar(16)," & _
        " @Emp_Status char(1)," & _
        " @PayTyp_Code varchar(4)," & _
        " @TemGrp_Code varchar(6)," & _
        " @EmpSta_Code char(1)," & _
        " @Emp_Title char(4)," & _
        " @Emp_LastName varchar(30)," & _
        " @Emp_FirstName varchar(30)," & _
        " @Emp_FullName varchar(60)," & _
        " @Emp_Sex char(1)," & _
        " @Emp_BirthDate smalldatetime," & _
        " @MarSta_Code char(1)," & _
        " @Emp_Address1 varchar(30)," & _
        " @Emp_Address2 varchar(30)," & _
        " @Emp_Address3 varchar(30)," & _
        " @Emp_PostCode varchar(30)," & _
        " @Emp_Telephone1 varchar(20)," & _
        " @Emp_Telephone2 varchar(20)," & _
        " @Emp_Email varchar(50)," & _
        " @Emp_SocialInsNumber varchar(20)," & _
        " @ComSin_EmpSocialInsNo varchar(20)," & _
        " @Emp_IdentificationCard varchar(10)," & _
        " @Emp_TaxID varchar(10)," & _
        " @Emp_PassportNumber varchar(10)," & _
        " @Emp_AlienNumber varchar(10)," & _
        " @TicTyp_Code char(1)," & _
        " @EmpAn1_Code varchar(12)," & _
        " @EmpAn2_Code varchar(12)," & _
        " @EmpAn3_Code varchar(12)," & _
        " @EmpAn4_Code varchar(12)," & _
        " @EmpAn5_Code varchar(12)," & _
        " @Uni_Code varchar(12)," & _
        " @Cou_Code char(2)," & _
        " @EmpPos_Code varchar(12)," & _
        " @Sic_Code varchar(4)," & _
        " @EmpCmm_Code varchar(4)," & _
        " @PayUni_Code varchar(4)," & _
        " @Emp_PeriodUnits int," & _
        " @Emp_AnnualUnits int," & _
        " @Cur_Code char(3)," & _
        " @PmtMth_Code varchar(4)," & _
        " @Bnk_Code varchar(12)," & _
        " @Emp_BankAccount varchar(30)," & _
        " @Bnk_CodeCo varchar(12)," & _
        " @Emp_BankAccountCo varchar(30)," & _
        " @Emp_StartDate smalldatetime," & _
        " @Emp_TerminateDate varchar(10)," & _
        " @Emp_OtherIncome1 decimal(8,2)," & _
        " @Emp_OtherIncome2 decimal(8,2)," & _
        " @Emp_OtherIncome3 decimal(8,2)," & _
        " @Emp_PreviousEarnings decimal(8,2)," & _
        " @Emp_PrevSIDeduct decimal(8,2)," & _
        " @Emp_PrevSIContribute decimal(8,2)," & _
        " @Emp_PrevITDeduct decimal(8,2)," & _
        " @Emp_PrevPFDeduct decimal(8,2)," & _
        " @ProFnd_Code varchar(4)," & _
        " @MedFnd_Code varchar(4)," & _
        " @SocInc_Code varchar(4)," & _
        " @Ind_Code varchar(4)," & _
        " @Une_Code varchar(4)," & _
        " @SocCoh_Code varchar(4)," & _
        " @Emp_CreationDate smalldatetime," & _
        " @Emp_CreatedBy int," & _
        " @Emp_AmendDate smalldatetime," & _
        " @Emp_AmendBy int," & _
        " @IntTem_Code varchar(6)," & _
        " @Emp_GLAnal1 varchar(12)," & _
        " @Emp_GLAnal2 varchar(12)," & _
        " @Emp_GLAnal3 varchar(12)," & _
        " @Emp_GLAnal4 varchar(12)," & _
        " @IntTem_PFCode varchar(6)," & _
        " @IntTem_MFCode varchar(6)," & _
        " @Emp_PensionNo varchar(7)," & _
        " @Emp_DrivingLicense varchar(20)," & _
        " @Emp_HasSI int," & _
        " @Emp_Pensiontype int," & _
        " @Emp_MyPayslipReport varchar(50)," & _
        " @Emp_IBAN varchar(40)," & _
        " @Emp_PreviousLifeIns decimal(18,2)," & _
        " @Emp_PreviousDis decimal(18,2)," & _
        " @Emp_PreviousST decimal(18,2)," & _
        " @Emp_OtherIncome4 decimal(18,2)," & _
        " @SecPay_Code varchar(4)," & _
        " @ComRat_Code varchar(4)," & _
        " @PerBon_Code varchar(4)," & _
        " @DutHou_Code varchar(4)," & _
        " @FliHou_Code varchar(4)," & _
        " @Emp_PassFullName varchar(100)," & _
        " @Emp_TravelDocs varchar(100)," & _
        " @Emp_FirstEmployment varchar(1)" & _
        " " & _
        " AS" & _
        " DECLARE @Result as Int" & _
        "   Set @Result = 0" & _
        "   SELECT @Result = Count(*)" & _
        "   FROM PrMsEmployees" & _
        "   WHERE Emp_Code = @Emp_Code" & _
        "   IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        " INSERT INTO PrMsEmployees" & _
        " (Emp_Code,                                           " & _
        " Emp_Status,                                         " & _
        " PayTyp_Code,                                        " & _
        " TemGrp_Code,                                        " & _
        " EmpSta_Code,                                        " & _
        " Emp_Title,                                          " & _
        " Emp_LastName,                                       " & _
        " Emp_FirstName,                                      " & _
        " Emp_FullName,                                       " & _
        " Emp_Sex,                                            " & _
        " Emp_BirthDate,                                      " & _
        " MarSta_Code,                                        " & _
        " Emp_Address1,                                       " & _
        " Emp_Address2,                                       " & _
        " Emp_Address3,                                       " & _
        " Emp_PostCode,                                       " & _
        " Emp_Telephone1,                                     " & _
        " Emp_Telephone2,                                     " & _
        " Emp_Email,                                          " & _
        " Emp_SocialInsNumber,                                " & _
        " ComSin_EmpSocialInsNo,                              " & _
        " Emp_IdentificationCard,                             " & _
        " Emp_TaxID,                                          " & _
        " Emp_PassportNumber,                                 " & _
        " Emp_AlienNumber,                                    " & _
        " TicTyp_Code,                                        " & _
        " EmpAn1_Code,                                        " & _
        " EmpAn2_Code,                                        " & _
        " EmpAn3_Code,                                        " & _
        " EmpAn4_Code,                                        " & _
        " EmpAn5_Code,                                        " & _
        " Uni_Code,                                           " & _
        " Cou_Code,                                           " & _
        " EmpPos_Code,                                        " & _
        " Sic_Code,                                           " & _
        " EmpCmm_Code,                                        " & _
        " PayUni_Code,                                        " & _
        " Emp_PeriodUnits,                                    " & _
        " Emp_AnnualUnits,                                    " & _
        " Cur_Code,                                           " & _
        " PmtMth_Code,                                        " & _
        " Bnk_Code,                                           " & _
        " Emp_BankAccount,                                    " & _
        " Bnk_CodeCo,                                         " & _
        " Emp_BankAccountCo,                                  " & _
        " Emp_StartDate,                                      " & _
        " Emp_TerminateDate,                                  " & _
        " Emp_OtherIncome1,                                   " & _
        " Emp_OtherIncome2,                                   " & _
        " Emp_OtherIncome3,                                   " & _
        " Emp_PreviousEarnings,                               " & _
        " Emp_PrevSIDeduct,                                   " & _
        " Emp_PrevSIContribute,                               " & _
        " Emp_PrevITDeduct,                                   " & _
        " Emp_PrevPFDeduct, " & _
        " ProFnd_Code," & _
        " MedFnd_Code," & _
        " SocInc_Code," & _
        " Ind_Code," & _
        " Une_Code," & _
        " SocCoh_Code," & _
        " Emp_CreationDate,                                   " & _
        " Emp_CreatedBy,                                      " & _
        " Emp_AmendDate,                                      " & _
        " Emp_AmendBy ,                                        " & _
        " IntTem_Code," & _
        " Emp_GLAnal1," & _
        " Emp_GLAnal2," & _
        " Emp_GLAnal3," & _
        " Emp_GLAnal4," & _
        " IntTem_PFCode," & _
        " IntTem_MFCode," & _
        " Emp_PensionNo," & _
        " Emp_DrivingLicense," & _
        " Emp_HasSI," & _
        " Emp_Pensiontype," & _
        " Emp_MyPayslipReport," & _
        " Emp_IBAN," & _
        " Emp_PreviousLifeIns," & _
        " Emp_PreviousDis," & _
        " Emp_PreviousST," & _
        " Emp_OtherIncome4," & _
        " SecPay_Code," & _
        " ComRat_Code," & _
        " PerBon_Code," & _
        " DutHou_Code," & _
        " FliHou_Code," & _
        " Emp_PassFullName," & _
        " Emp_TravelDocs," & _
        " Emp_FirstEmployment" & _
        " " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @Emp_Status,                                         " & _
        " @PayTyp_Code,                                        " & _
        " @TemGrp_Code,                                        " & _
        " @EmpSta_Code,                                        " & _
        " @Emp_Title,                                          " & _
        " @Emp_LastName,                                       " & _
        " @Emp_FirstName,                                      " & _
        " @Emp_FullName,                                       " & _
        " @Emp_Sex,                                            " & _
        " @Emp_BirthDate,                                      " & _
        " @MarSta_Code,                                        " & _
        " @Emp_Address1,                                       " & _
        " @Emp_Address2,                                       " & _
        " @Emp_Address3,                                       " & _
        " @Emp_PostCode,                                       " & _
        " @Emp_Telephone1,                                     " & _
        " @Emp_Telephone2,                                     " & _
        " @Emp_Email,                                          " & _
        " @Emp_SocialInsNumber,                                " & _
        " @ComSin_EmpSocialInsNo,                              " & _
        " @Emp_IdentificationCard,                             " & _
        " @Emp_TaxID,                                          " & _
        " @Emp_PassportNumber,                                 " & _
        " @Emp_AlienNumber,                                    " & _
        " @TicTyp_Code,                                        " & _
        " @EmpAn1_Code,                                        " & _
        " @EmpAn2_Code,                                        " & _
        " @EmpAn3_Code,                                        " & _
        " @EmpAn4_Code,                                        " & _
        " @EmpAn5_Code,                                        " & _
        " @Uni_Code,                                           " & _
        " @Cou_Code,                                           " & _
        " @EmpPos_Code,                                        " & _
        " @Sic_Code,                                           " & _
        " @EmpCmm_Code,                                        " & _
        " @PayUni_Code,                                        " & _
        " @Emp_PeriodUnits,                                    " & _
        " @Emp_AnnualUnits,                                    " & _
        " @Cur_Code,                                           " & _
        " @PmtMth_Code,                                        " & _
        " @Bnk_Code,                                           " & _
        " @Emp_BankAccount,                                    " & _
        " @Bnk_CodeCo,                                         " & _
        " @Emp_BankAccountCo,                                  " & _
        " @Emp_StartDate,                                      " & _
        " @Emp_TerminateDate,                                  " & _
        " @Emp_OtherIncome1,                                   " & _
        " @Emp_OtherIncome2,                                   " & _
        " @Emp_OtherIncome3,                                   " & _
        " @Emp_PreviousEarnings,                               " & _
        " @Emp_PrevSIDeduct,                                   " & _
        " @Emp_PrevSIContribute,                               " & _
        " @Emp_PrevITDeduct,                                   " & _
        " @Emp_PrevPFDeduct,                                   " & _
        " @ProFnd_Code," & _
        " @MedFnd_Code," & _
        " @SocInc_Code," & _
        " @Ind_Code," & _
        " @Une_Code," & _
        " @SocCoh_Code," & _
        " @Emp_CreationDate,                                   " & _
        " @Emp_CreatedBy,                                      " & _
        " @Emp_AmendDate,                                      " & _
        " @Emp_AmendBy,                                         " & _
        " @IntTem_Code," & _
        " @Emp_GLAnal1," & _
        " @Emp_GLAnal2," & _
        " @Emp_GLAnal3," & _
        " @Emp_GLAnal4," & _
        " @IntTem_PFCode," & _
        " @IntTem_MFCode," & _
        " @Emp_PensionNo," & _
        " @Emp_DrivingLicense," & _
        " @Emp_HasSI," & _
        " @Emp_Pensiontype," & _
        " @Emp_MyPayslipReport," & _
        " @Emp_IBAN," & _
        " @Emp_PreviousLifeIns," & _
        " @Emp_PreviousDis," & _
        " @Emp_PreviousST," & _
        " @Emp_OtherIncome4," & _
        " @SecPay_Code," & _
        " @ComRat_Code," & _
        " @PerBon_Code," & _
        " @DutHou_Code," & _
        " @FliHou_Code," & _
        " @Emp_PassFullName," & _
        " @Emp_TravelDocs," & _
        " @Emp_FirstEmployment" & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrMsEmployees" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     Emp_Status=@Emp_Status,                               " & _
        "    PayTyp_Code=@PayTyp_Code,                             " & _
        "    TemGrp_Code=@TemGrp_Code,                             " & _
        "    EmpSta_Code=@EmpSta_Code,                             " & _
        "    Emp_Title=@Emp_Title,                                 " & _
        "    Emp_LastName=@Emp_LastName,                           " & _
        "    Emp_FirstName=@Emp_FirstName,                         " & _
        "    Emp_FullName=@Emp_FullName,                           " & _
        "    Emp_Sex=@Emp_Sex,                                     " & _
        "    Emp_BirthDate=@Emp_BirthDate,                         " & _
        "    MarSta_Code=@MarSta_Code,                             " & _
        "    Emp_Address1=@Emp_Address1,                           " & _
        "    Emp_Address2=@Emp_Address2,                           " & _
        "    Emp_Address3=@Emp_Address3,                           " & _
        "    Emp_PostCode=@Emp_PostCode,                           " & _
        "    Emp_Telephone1=@Emp_Telephone1,                       " & _
        "    Emp_Telephone2=@Emp_Telephone2,                       " & _
        "    Emp_Email=@Emp_Email,                                 " & _
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " & _
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " & _
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " & _
        "   Emp_TaxID=@Emp_TaxID,                                 " & _
        "   Emp_PassportNumber=@Emp_PassportNumber,               " & _
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " & _
        "  TicTyp_Code=@TicTyp_Code,                             " & _
        "  EmpAn1_Code=@EmpAn1_Code,                             " & _
        "  EmpAn2_Code=@EmpAn2_Code,                             " & _
        "  EmpAn3_Code=@EmpAn3_Code,                             " & _
        " EmpAn4_Code=@EmpAn4_Code,                             " & _
        " EmpAn5_Code=@EmpAn5_Code,                             " & _
        " Uni_Code=@Uni_Code,                                   " & _
        " Cou_Code=@Cou_Code,                                   " & _
        " EmpPos_Code=@EmpPos_Code,                             " & _
        " Sic_Code=@Sic_Code,                                   " & _
        " EmpCmm_Code=@EmpCmm_Code,                             " & _
        " PayUni_Code=@PayUni_Code,                             " & _
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " & _
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " & _
        " Cur_Code=@Cur_Code,                                   " & _
        " PmtMth_Code=@PmtMth_Code,                             " & _
        " Bnk_Code=@Bnk_Code,                                   " & _
        " Emp_BankAccount=@Emp_BankAccount,                     " & _
        " Bnk_CodeCo=@Bnk_CodeCo,                               " & _
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " & _
        " Emp_StartDate=@Emp_StartDate,                         " & _
        " Emp_TerminateDate=@Emp_TerminateDate,                 " & _
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " & _
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " & _
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " & _
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " & _
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " & _
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " & _
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " & _
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " & _
        " ProFnd_Code=@ProFnd_Code," & _
        " MedFnd_Code=@MedFnd_Code," & _
        " SocInc_Code=@SocInc_Code," & _
        " Ind_Code=@Ind_Code," & _
        " Une_Code=@Une_Code," & _
        " SocCoh_Code=@SocCoh_Code," & _
        " Emp_CreationDate=@Emp_CreationDate,                   " & _
        " Emp_CreatedBy=@Emp_CreatedBy,                         " & _
        " Emp_AmendDate=@Emp_AmendDate,                         " & _
        " Emp_AmendBy=@Emp_AmendBy,                              " & _
        " IntTem_Code=@IntTem_Code," & _
        " Emp_GLAnal1=@Emp_GLAnal1," & _
        " Emp_GLAnal2=@Emp_GLAnal2," & _
        " Emp_GLAnal3=@Emp_GLAnal3," & _
        " Emp_GLAnal4=@Emp_GLAnal4," & _
        " IntTem_PFCode=@IntTem_PFCode," & _
        " IntTem_MFCode=@IntTem_MFCode," & _
        " Emp_PensionNo=@Emp_PensionNo," & _
        " Emp_DrivingLicense=@Emp_DrivingLicense," & _
        " Emp_HasSI=@Emp_HasSI," & _
        " Emp_Pensiontype=@Emp_Pensiontype," & _
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," & _
        " Emp_IBAN=@Emp_IBAN," & _
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," & _
        " Emp_PreviousDis=@Emp_PreviousDis," & _
        " Emp_PreviousST=@Emp_PreviousST," & _
        " Emp_OtherIncome4=@Emp_OtherIncome4," & _
        " SecPay_Code=@SecPay_Code," & _
        " ComRat_Code=@ComRat_Code," & _
        " PerBon_Code=@PerBon_Code," & _
        " DutHou_Code=@DutHou_Code," & _
        " FliHou_Code=@FliHou_Code," & _
        " Emp_PassFullName=@Emp_PassFullName," & _
        " Emp_TravelDocs=@Emp_TravelDocs," & _
        " Emp_FirstEmployment =@Emp_FirstEmployment" & _
        "      WHERE Emp_Code = @Emp_Code" & _
        "  END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If



        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE]" & _
        " @TrxHdr_Id int," & _
        " @Emp_Code varchar(16)," & _
        " @PrdGrp_Code varchar(6)," & _
        " @PrdCod_Code varchar(6)," & _
        " @PayCat_Code varchar(4)," & _
        " @TrxHdr_Date datetime," & _
        " @TrxHdr_Status varchar(4)," & _
        " @TrxHdr_TotalErnPeriod decimal(18,2)," & _
        " @TrxHdr_TotalErnYTD decimal(18,2)," & _
        " @TrxHdr_TotalDedPeriod decimal(18,2)," & _
        " @TrxHdr_TotalDedYTD decimal(18,2)," & _
        " @TrxHdr_TotalConPeriod decimal(18,2)," & _
        " @TrxHdr_TotalConYTD decimal(18,2)," & _
        " @TrxHdr_SIIncome decimal(18,2)," & _
        " @TrxHdr_TaxableIncome decimal(18,2)," & _
        " @TrxHdr_PaymentMethod varchar(50)," & _
        " @TrxHdr_PaymentRef varchar(50)," & _
        " @TrxHdr_PeriodUnits decimal(18,2)," & _
        " @TrxHdr_AnnualUnits decimal(18,2)," & _
        " @TrxHdr_AnnualLeave decimal(18,2)," & _
        " @TrxHdr_LifeInsurance decimal(18,2)," & _
        " @TrxHdr_Discounts decimal(18,2)," & _
        " @TrxHdr_Interfacestatus varchar(4)," & _
        " @TrxHdr_Overtime1 decimal(10,2)," & _
        " @TrxHdr_Overtime2 decimal(10,2)," & _
        " @TrxHdr_SIUnits decimal(10,2)," & _
        " @TrxHdr_MonthlySalary decimal(18,2)," & _
        " @TrxHdr_NetSalary decimal(18,2)," & _
        " @TrxHdr_PeriodInsurable decimal(18,2)," & _
        " @TemGrp_Code varchar(6)," & _
        " @TrxHdr_ChequeNo varchar(50)," & _
        " @TrxHdr_TaxableFromOther Decimal(18,2)," & _
        " @TrxHdr_CurrencySymbol varchar(3)," & _
        " @TrxHdr_Rate Decimal(18,10)," & _
        " @TrxHdr_NormalDays Decimal(18,2)," & _
        " @TrxHdr_Salary1 Decimal(18,2)," & _
        " @TrxHdr_Salary2 Decimal(18,2)," & _
        " @TrxHdr_Overtime3 decimal(10,2)," & _
        " @TrxHdr_Sectors decimal(18,2)," & _
        " @TrxHdr_Dutyhours decimal(18,2)," & _
        " @TrxHdr_FlightHours decimal(18,2)," & _
        " @TrxHdr_Commission decimal(18,2)," & _
        " @TrxHdr_PBAmount decimal(18,2)," & _
        " @TrxHdr_PBRate decimal(18,2)," & _
        " @NewId Int OUTPUT" & _
        " AS" & _
        " DECLARE @Result as Int" & _
        " Set  @Result = 0" & _
        " SELECT @Result = Count(*)" & _
        " FROM PrTxTrxnHeader" & _
        " WHERE TrxHdr_Id =  @TrxHdr_Id" & _
        " IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        "   INSERT INTO PrTxTrxnHeader" & _
        "   (Emp_Code,                                           " & _
        " PrdGrp_Code," & _
        " PrdCod_Code,                                        " & _
        " PayCat_Code,                                        " & _
        " TrxHdr_Date,                                        " & _
        " TrxHdr_Status,                                      " & _
        " TrxHdr_TotalErnPeriod,                              " & _
        " TrxHdr_TotalErnYTD,                                 " & _
        " TrxHdr_TotalDedPeriod,                              " & _
        " TrxHdr_TotalDedYTD,                                 " & _
        " TrxHdr_TotalConPeriod,                              " & _
        " TrxHdr_TotalConYTD,                                 " & _
        " TrxHdr_SIIncome,                                    " & _
        " TrxHdr_TaxableIncome,                               " & _
        " TrxHdr_PaymentMethod,                               " & _
        " TrxHdr_PaymentRef,                                  " & _
        " TrxHdr_PeriodUnits,                                 " & _
        " TrxHdr_AnnualUnits,                                 " & _
        " TrxHdr_AnnualLeave,                                  " & _
        " TrxHdr_LifeInsurance,                                " & _
        " TrxHdr_Discounts,                                    " & _
        " TrxHdr_InterfaceStatus,                               " & _
        " TrxHdr_Overtime1," & _
        " TrxHdr_Overtime2," & _
        " TrxHdr_SIUnits," & _
        " TrxHdr_MonthlySalary," & _
        " TrxHdr_NetSalary," & _
        " TrxHdr_PeriodInsurable," & _
        " TemGrp_Code," & _
        " TrxHdr_ChequeNo," & _
        " TrxHdr_TaxableFromOther," & _
        " TrxHdr_CurrencySymbol," & _
        " TrxHdr_Rate," & _
        " TrxHdr_NormalDays," & _
        " TrxHdr_Salary1," & _
        " TrxHdr_Salary2," & _
        " TrxHdr_Overtime3," & _
        " TrxHdr_Sectors," & _
        " TrxHdr_Dutyhours," & _
        " TrxHdr_FlightHours," & _
        " TrxHdr_Commission," & _
        " TrxHdr_PBAmount," & _
        " TrxHdr_PBRate" & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @PrdGrp_Code," & _
        " @PrdCod_Code,                                        " & _
        " @PayCat_Code,                                        " & _
        " @TrxHdr_Date,                                        " & _
        " @TrxHdr_Status,                                      " & _
        " @TrxHdr_TotalErnPeriod,                              " & _
        " @TrxHdr_TotalErnYTD,                                 " & _
        " @TrxHdr_TotalDedPeriod,                              " & _
        " @TrxHdr_TotalDedYTD,                                 " & _
        " @TrxHdr_TotalConPeriod,                              " & _
        " @TrxHdr_TotalConYTD,                                 " & _
        " @TrxHdr_SIIncome,                                    " & _
        " @TrxHdr_TaxableIncome,                               " & _
        " @TrxHdr_PaymentMethod,                               " & _
        " @TrxHdr_PaymentRef,                                  " & _
        " @TrxHdr_PeriodUnits,                                 " & _
        " @TrxHdr_AnnualUnits,                                 " & _
        " @TrxHdr_AnnualLeave,                                 " & _
        " @TrxHdr_LifeInsurance,                               " & _
        " @TrxHdr_Discounts,                                   " & _
        " @TrxHdr_InterfaceStatus,                              " & _
        " @TrxHdr_Overtime1," & _
        " @TrxHdr_Overtime2," & _
        " @TrxHdr_SIUnits," & _
        " @TrxHdr_MonthlySalary," & _
        " @TrxHdr_NetSalary," & _
        " @TrxHdr_PeriodInsurable," & _
        " @TemGrp_Code, " & _
        " @TrxHdr_ChequeNo," & _
        " @TrxHdr_TaxableFromOther," & _
        " @TrxHdr_CurrencySymbol," & _
        " @TrxHdr_Rate," & _
        " @TrxHdr_NormalDays," & _
        " @TrxHdr_Salary1," & _
        " @TrxHdr_Salary2," & _
        " @TrxHdr_Overtime3," & _
        " @TrxHdr_Sectors," & _
        " @TrxHdr_Dutyhours," & _
        " @TrxHdr_FlightHours," & _
        " @TrxHdr_Commission," & _
        " @TrxHdr_PBAmount," & _
        " @TrxHdr_PBRate" & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrTxTrxnHeader" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     PrdGrp_Code=@PrdGrp_Code," & _
        "     PrdCod_Code=@PrdCod_Code,                             " & _
        "     PayCat_Code=@PayCat_Code,                             " & _
        "     TrxHdr_Date=@TrxHdr_Date,                             " & _
        "    TrxHdr_Status=@TrxHdr_Status,                         " & _
        "  TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " & _
        "     TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " & _
        "    TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " & _
        "   TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " & _
        "  TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " & _
        " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " & _
        " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " & _
        " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " & _
        " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " & _
        " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " & _
        " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " & _
        " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " & _
        " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,                " & _
        " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " & _
        " TrxHdr_Discounts=@TrxHdr_Discounts,                    " & _
        " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,        " & _
        " TrxHdr_Overtime1=@TrxHdr_Overtime1," & _
        " TrxHdr_Overtime2=@TrxHdr_Overtime2," & _
        " TrxHdr_SIUnits=@TrxHdr_SIUnits," & _
        " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary," & _
        " TrxHdr_NetSalary=@TrxHdr_NetSalary," & _
        " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable," & _
        " TemGrp_Code=@TemGrp_Code," & _
        " TrxHdr_ChequeNo=@TrxHdr_ChequeNo ," & _
        " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther," & _
        " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol," & _
        " TrxHdr_Rate=@TrxHdr_Rate," & _
        " TrxHdr_NormalDays=@TrxHdr_NormalDays ," & _
        " TrxHdr_Salary1=@TrxHdr_Salary1," & _
        " TrxHdr_Salary2=@TrxHdr_Salary2," & _
        " TrxHdr_Overtime3=@TrxHdr_Overtime3," & _
        " TrxHdr_Sectors=@TrxHdr_Sectors," & _
        " TrxHdr_Dutyhours=@TrxHdr_Dutyhours," & _
        " TrxHdr_FlightHours=@TrxHdr_FlightHours," & _
        " TrxHdr_Commission=@TrxHdr_Commission," & _
        " TrxHdr_PBAmount=@TrxHdr_PBAmount," & _
        " TrxHdr_PBRate=@TrxHdr_PBRate" & _
        " WHERE TrxHdr_Id = @TrxHdr_Id" & _
        " END" & _
        " set  @NewId=SCOPE_IDENTITY()"


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If



        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnLines_SAVE_UPDATE]" & _
        " @TrxLin_Id int," & _
        " @TrxHdr_Id int," & _
        " @TrxLin_Type char(1)," & _
        " @ErnCod_Code varchar(6)," & _
        " @DedCod_Code varchar(6)," & _
        " @ConCod_Code varchar(6)," & _
        " @TrxLin_PeriodValue decimal(18,2)," & _
        " @TrxLin_YTDValue decimal(18,2)," & _
        " @TrxLin_EDC decimal(18,2)," & _
        " @TrxLin_EDCDescription varchar(50)," & _
        " @TrxLin_ConsolDesc varchar(50)" & _
        " AS" & _
        " DECLARE @Result as Int" & _
        " Set @Result = 0" & _
        " SELECT @Result = Count(*)" & _
        " FROM PrTxTrxnLines" & _
        " WHERE TrxLin_Id = @TrxLin_Id AND TrxHdr_Id = @TrxHdr_Id" & _
        " IF(@Result IS NULL) OR (@Result=0)" & _
        "    BEGIN" & _
        "      INSERT INTO PrTxTrxnLines" & _
        "     (TrxLin_Id,                                          " & _
        "      TrxHdr_Id,                                          " & _
        "      TrxLin_Type,                                        " & _
        "      ErnCod_Code,                                        " & _
        "      DedCod_Code,                                        " & _
        "      ConCod_Code,                                        " & _
        "      TrxLin_PeriodValue,                                 " & _
        "      TrxLin_YTDValue,                                     " & _
        "	  TrxLin_EDC,                                         " & _
        "	  TrxLin_EDCDescription," & _
        "	  TrxLin_ConsolDesc" & _
        "      )" & _
        "      VALUES (" & _
        "      @TrxLin_Id,                                          " & _
        "      @TrxHdr_Id,                                          " & _
        "      @TrxLin_Type,                                        " & _
        "      @ErnCod_Code,                                        " & _
        "      @DedCod_Code,                                        " & _
        "      @ConCod_Code,                                        " & _
        "      @TrxLin_PeriodValue,                                 " & _
        "      @TrxLin_YTDValue,                                     " & _
        "	  @TrxLin_EDC,                                          " & _
        "	  @TrxLin_EDCDescription," & _
        "	  @TrxLin_ConsolDesc" & _
        "     )" & _
        "   END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrTxTrxnLines" & _
        "     SET " & _
        "     TrxLin_Id=@TrxLin_Id,                                 " & _
        "     TrxHdr_Id=@TrxHdr_Id,                                 " & _
        "     TrxLin_Type=@TrxLin_Type,                             " & _
        "     ErnCod_Code=@ErnCod_Code,                             " & _
        "     DedCod_Code=@DedCod_Code,                             " & _
        "     ConCod_Code=@ConCod_Code,                             " & _
        "     TrxLin_PeriodValue=@TrxLin_PeriodValue,               " & _
        "     TrxLin_YTDValue=@TrxLin_YTDValue,                      " & _
        "	  TrxLin_EDC=@TrxLin_EDC,					           " & _
        "     TrxLin_EDCDescription=@TrxLin_EDCDescription," & _
        "    TrxLin_ConsolDesc=@TrxLin_ConsolDesc" & _
        "   WHERE TrxLin_Id = @TrxLin_Id AND TrxHdr_Id = @TrxHdr_Id " & _
        "END "
     
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnLines was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrTxTrxnLines", MsgBoxStyle.Critical)
        End If

        Return True

    End Function

    Protected Function CreateValuesOnAirlinesTables() As Boolean
        Dim F As Boolean = True

        Dim SecPay As New cPrSsSectorPay("0000")
        If SecPay.Code = "" Then
            With SecPay
                .Code = "0000"
                .Desc = "SECTOR 0.00"
                .HourRate = 0.0
                If Not .Save Then
                    MsgBox("Unable to Create Value for Sectors", MsgBoxStyle.Critical)
                    F = False
                End If
            End With
        End If

        Dim PerBon As New cPrSsPerformanceBonus("0000")
        If PerBon.Code = "" Then
            With PerBon
                .Code = "0000"
                .Desc = "PERF.BONUS 0.00"
                .MyValue = 0.0
                .Rate = 0.0
                .Type = "A"
                .Formula = "P"

                If Not .Save Then
                    MsgBox("Unable to Create Value for Performance Bonus", MsgBoxStyle.Critical)
                    F = False
                End If
            End With
        End If

        Dim DutHour As New cPrSsDutyHours("0000")
        If DutHour.Code = "" Then
            With DutHour
                .Code = "0000"
                .Desc = "DUTY HOURS 0.00"
                .HourRate = 0.0
                If Not .Save Then
                    MsgBox("Unable to Create Value for Duty Hours", MsgBoxStyle.Critical)
                    F = False
                End If
            End With
        End If

        Dim FliHour As New cPrSsFlightHours("0000")
        If FliHour.Code = "" Then
            With FliHour
                .Code = "0000"
                .Desc = "FLIGHT HOURS 0.00"
                .HourRate = 0.0
                .Limit = 0
                .LimitCode = ""
                If Not .Save Then
                    MsgBox("Unable to Create Value for Flight Hours", MsgBoxStyle.Critical)
                    F = False
                End If
            End With
        End If

        Dim ComSal As New cPrSsCommissionRates("0000")
        If ComSal.Code = "" Then
            With ComSal
                .Code = "0000"
                .Desc = "COMM.RATE 0.00"
                .MyValue = 0.0
                If Not .Save Then
                    MsgBox("Unable to Create Value for Commission Rates", MsgBoxStyle.Critical)
                    F = False
                End If
            End With
        End If
        If F Then
            Dim Str As String
            Str = "Update PrMsEmployees set " & _
            " SecPay_Code='0000'," & _
            " PerBon_Code='0000'," & _
            " DutHou_Code='0000'," & _
            " FliHou_Code='0000'," & _
            " ComRat_Code='0000' "
            Dim i As Integer
            i = ExecuteNonQuery(Str)
            If i < 0 Then
                MsgBox("Unable to Update PrMsEmployees", MsgBoxStyle.Critical)
                F = False
            End If
        End If
        Return F


    End Function
    Protected Function GetFirstTransactionPeriod(ByVal EmpCode As String, ByVal PrdGrpCode As String) As DataSet
        Dim Str As String
        Str = "select prdcod_code from PrTxTrxnHeader " & _
            " where PrdGrp_Code =" & enQuoteString(PrdGrpCode) & _
            " and Emp_Code =" & enQuoteString(EmpCode) & _
            " order by TrxHdr_Id asc "
        Return MyBase.GetData(Str)


    End Function
    Protected Function SetTrxnLinesValuestoZero(ByVal HeaderId As Integer) As Boolean
        Dim Str As String
        Dim Flag As Boolean = False
        Str = "Update PrTxTrxnLines set TrxLin_PeriodValue=0,TrxLin_YTDValue=0 where trxhdr_id=" & HEaderId
        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            Flag = True
        End If
        Return Flag
    End Function
    Protected Function SetAirlinesDefault()
        Dim Str As String
        Dim i As Integer
        Str = "Update PrMsEmployees " & _
        "set SecPay_Code='0000'," & _
        "ComRat_Code='0000'," & _
        "perbon_code='0000'," & _
        "DutHou_Code='0000'," & _
        "flihou_code='0000'," & _
        "OveLay_Code='0000'"
        Dim Ans As MsgBoxResult
        Ans = MsgBox("Set Defaults to Airlines", MsgBoxStyle.YesNo)
        If Ans = MsgBoxResult.Yes Then
            i = ExecuteNonQuery(Str)
            If i < 0 Then
                MsgBox("Unable to Update PrMsEmployees", MsgBoxStyle.Critical)
            End If
        End If


    End Function
    Protected Function Upgrade2016_C()
        Dim Str As String
        Dim i As Integer
        Str = "ALTER TABLE PrTxtrxnheader " & _
        " ADD [TrxHdr_OverLay] [decimal](18, 2) NULL," & _
        "[TrxHdr_PeriodSplit] [decimal](18, 2) NULL"
        

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If




        Str = "ALTER TABLE PrMsEmployees " & _
        " ADD [OveLay_Code] [varchar](4) NULL"
        
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        '------------------------------------------
        '               NEW TABLES
        '------------------------------------------


      

        Str = " CREATE TABLE [dbo].[PrSsOverLay]( " & _
        "	[OveLay_Code] [varchar](4) NOT NULL, " & _
        "	[OveLay_Desc] [varchar](40) NOT NULL, " & _
        "	[OveLay_Rate] [decimal](18, 2) NOT NULL, " & _
        " CONSTRAINT [PK_PrSsOverLay] PRIMARY KEY CLUSTERED  " & _
        " ( " & _
        "	[OveLay_Code] ASC " & _
        " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] " & _
        " ) ON [PRIMARY] "



        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New Table PrSsOverLay", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New Table PrSsOverLay", MsgBoxStyle.Critical)
        End If

        Str = " CREATE TABLE [dbo].[PrSsEmployeeSplit]( " & _
        "	[Spl_id] [int] IDENTITY(1,1) NOT NULL, " & _
        "	[Emp_Code] [varchar](16) NOT NULL, " & _
        "	[Spl_Description] [varchar](40) NOT NULL, " & _
        "	[Spl_Value] [decimal](18, 2) NOT NULL, " & _
        "	[Spl_Enabled] [char](1) NOT NULL, " & _
        "	[Spl_NoOfPeriods] [char](2) NOT NULL, " & _
        "	[Spl_IsPF] [char](1) NOT NULL, " & _
        "	[Spl_IsST] [char](1) NOT NULL, " & _
        "	[Spl_CreationDate] [smalldatetime] NOT NULL, " & _
        "	[Spl_CreatedBy] [int] NOT NULL, " & _
        "	[Spl_AmendDate] [smalldatetime] NOT NULL, " & _
        "	[Spl_AmendedBy] [int] NOT NULL, " & _
        " CONSTRAINT [PK_PrSsEmployeeSplit] PRIMARY KEY CLUSTERED  " & _
        " ( " & _
        "	[Spl_id] ASC " & _
        " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] " & _
        " ) ON [PRIMARY] "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New Table PrSsEmployeeSplit", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New Table PrSsEmployeeSplit", MsgBoxStyle.Critical)
        End If



        '------------------------------------------
        '               NEW STORE PROCEDURES
        '------------------------------------------

        Str = " create PROCEDURE [dbo].[AG_PrSsOverLay_SAVE_UPDATE]" & _
        " @OveLay_Code varchar(4)," & _
        " @OveLay_Desc varchar(40)," & _
        " @OveLay_Rate decimal(18,2)" & _
        " AS" & _
        "  DECLARE @Result as Int" & _
        "  Set @Result = 0" & _
        "  SELECT @Result = Count(*)" & _
        "  FROM PrSsOverLay" & _
        "  WHERE OveLay_Code = @OveLay_Code" & _
        "  IF(@Result IS NULL) OR (@Result=0)" & _
        "    BEGIN" & _
        "      INSERT INTO PrSsOverLay" & _
        "     (OveLay_Code,                                       " & _
        "      OveLay_Desc,                                       " & _
        "      OveLay_Rate                                   " & _
        "      )" & _
        "      VALUES (" & _
        "      @OveLay_Code,                                       " & _
        "      @OveLay_Desc,                                       " & _
        "      @OveLay_Rate                                   " & _
        "      )" & _
        "    END" & _
        "  ELSE" & _
        "    BEGIN" & _
        "      UPDATE PrSsOverLay" & _
        "      SET " & _
        "      OveLay_Code=@OveLay_Code,                            " & _
        "      OveLay_Desc=@OveLay_Desc,                            " & _
        "      OveLay_Rate=@OveLay_Rate                    " & _
        "      WHERE OveLay_Code = @OveLay_Code" & _
        "  END"


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrSsOverLay is Created", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Create SP PrSsOverlay ", MsgBoxStyle.Critical)
        End If

        Str = "Create PROCEDURE [dbo].[PrSsEmployeeSplit_SAVE_UPDATE] " & _
        " @Spl_id int, " & _
        " @Emp_Code varchar(16), " & _
        " @Spl_Description varchar(40), " & _
        " @Spl_Value decimal(18,2), " & _
        " @Spl_Enabled varchar(1), " & _
        " @Spl_NoOfPeriods varchar(2), " & _
        " @Spl_IsPF varchar(1), " & _
        " @Spl_IsST varchar(1), " & _
        " @Spl_CreationDate datetime, " & _
        " @Spl_CreatedBy int, " & _
        " @Spl_AmendDate datetime, " & _
        " @Spl_AmendedBy int, " & _
        " @NewId Int OUTPUT " & _
        " AS " & _
        "  DECLARE @Result as Int " & _
        "  Set @Result = 0 " & _
        "  SELECT @Result = Count(*) " & _
        "  FROM PrSsEmployeeSplit " & _
        "  WHERE Spl_id = @Spl_id " & _
        "  IF(@Result IS NULL) OR (@Result=0) " & _
        "    BEGIN " & _
        "      INSERT INTO PrSsEmployeeSplit " & _
        "     (Emp_Code,  " & _
        "	  Spl_Description, " & _
        "	  Spl_Value,  " & _
        "	  Spl_Enabled, " & _
        "	  Spl_NoOfPeriods, " & _
        "	  Spl_IsPF, " & _
        "	  Spl_IsST,  " & _
        "	  Spl_CreationDate, " & _
        "	  Spl_CreatedBy,  " & _
        "	  Spl_AmendDate, " & _
        "	  Spl_AmendedBy  " & _
        "      ) " & _
        "     VALUES ( " & _
        "      @Emp_Code,  " & _
        "	  @Spl_Description, " & _
        "	  @Spl_Value,  " & _
        "	  @Spl_Enabled, " & _
        "	  @Spl_NoOfPeriods, " & _
        "	  @Spl_IsPF,  " & _
        "	  @Spl_IsST, " & _
        "	  @Spl_CreationDate, " & _
        "	  @Spl_CreatedBy,  " & _
        "	  @Spl_AmendDate,  " & _
        "	  @Spl_AmendedBy  " & _
        "     ) " & _
        "  END " & _
        "  ELSE " & _
        "    BEGIN " & _
        "      UPDATE PrSsEmployeeSplit " & _
        "      SET  " & _
        "      Emp_Code=@Emp_Code,  " & _
        "	  Spl_Description=@Spl_Description, " & _
        "	  Spl_Value= @Spl_Value,  " & _
        "	  Spl_Enabled=@Spl_Enabled, " & _
        "	  Spl_NoOfPeriods=@Spl_NoOfPeriods, " & _
        "	  Spl_IsPF=@Spl_IsPF, " & _
        "	  Spl_IsST= @Spl_IsST,  " & _
        "	  Spl_CreationDate=@Spl_CreationDate, " & _
        "	  Spl_CreatedBy= @Spl_CreatedBy,  " & _
        "	  Spl_AmendDate=@Spl_AmendDate, " & _
        "	  Spl_AmendedBy=@Spl_AmendedBy " & _
        "     WHERE Spl_id = @Spl_id " & _
        " END" & _
        " set @NewId=SCOPE_IDENTITY() "




        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrSsEmployeeSplit is created", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Create SP PrSsEmployeeSplit ", MsgBoxStyle.Critical)
        End If

        ' Alter SPs

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" & _
        " @Emp_Code varchar(16)," & _
        " @Emp_Status char(1)," & _
        " @PayTyp_Code varchar(4)," & _
        " @TemGrp_Code varchar(6)," & _
        " @EmpSta_Code char(1)," & _
        " @Emp_Title char(4)," & _
        " @Emp_LastName varchar(30)," & _
        " @Emp_FirstName varchar(30)," & _
        " @Emp_FullName varchar(60)," & _
        " @Emp_Sex char(1)," & _
        " @Emp_BirthDate smalldatetime," & _
        " @MarSta_Code char(1)," & _
        " @Emp_Address1 varchar(30)," & _
        " @Emp_Address2 varchar(30)," & _
        " @Emp_Address3 varchar(30)," & _
        " @Emp_PostCode varchar(30)," & _
        " @Emp_Telephone1 varchar(20)," & _
        " @Emp_Telephone2 varchar(20)," & _
        " @Emp_Email varchar(50)," & _
        " @Emp_SocialInsNumber varchar(20)," & _
        " @ComSin_EmpSocialInsNo varchar(20)," & _
        " @Emp_IdentificationCard varchar(10)," & _
        " @Emp_TaxID varchar(10)," & _
        " @Emp_PassportNumber varchar(10)," & _
        " @Emp_AlienNumber varchar(10)," & _
        " @TicTyp_Code char(1)," & _
        " @EmpAn1_Code varchar(12)," & _
        " @EmpAn2_Code varchar(12)," & _
        " @EmpAn3_Code varchar(12)," & _
        " @EmpAn4_Code varchar(12)," & _
        " @EmpAn5_Code varchar(12)," & _
        " @Uni_Code varchar(12)," & _
        " @Cou_Code char(2)," & _
        " @EmpPos_Code varchar(12)," & _
        " @Sic_Code varchar(4)," & _
        " @EmpCmm_Code varchar(4)," & _
        " @PayUni_Code varchar(4)," & _
        " @Emp_PeriodUnits int," & _
        " @Emp_AnnualUnits int," & _
        " @Cur_Code char(3)," & _
        " @PmtMth_Code varchar(4)," & _
        " @Bnk_Code varchar(12)," & _
        " @Emp_BankAccount varchar(30)," & _
        " @Bnk_CodeCo varchar(12)," & _
        " @Emp_BankAccountCo varchar(30)," & _
        " @Emp_StartDate smalldatetime," & _
        " @Emp_TerminateDate varchar(10)," & _
        " @Emp_OtherIncome1 decimal(8,2)," & _
        " @Emp_OtherIncome2 decimal(8,2)," & _
        " @Emp_OtherIncome3 decimal(8,2)," & _
        " @Emp_PreviousEarnings decimal(8,2)," & _
        " @Emp_PrevSIDeduct decimal(8,2)," & _
        " @Emp_PrevSIContribute decimal(8,2)," & _
        " @Emp_PrevITDeduct decimal(8,2)," & _
        " @Emp_PrevPFDeduct decimal(8,2)," & _
        " @ProFnd_Code varchar(4)," & _
        " @MedFnd_Code varchar(4)," & _
        " @SocInc_Code varchar(4)," & _
        " @Ind_Code varchar(4)," & _
        " @Une_Code varchar(4)," & _
        " @SocCoh_Code varchar(4)," & _
        " @Emp_CreationDate smalldatetime," & _
        " @Emp_CreatedBy int," & _
        " @Emp_AmendDate smalldatetime," & _
        " @Emp_AmendBy int," & _
        " @IntTem_Code varchar(6)," & _
        " @Emp_GLAnal1 varchar(12)," & _
        " @Emp_GLAnal2 varchar(12)," & _
        " @Emp_GLAnal3 varchar(12)," & _
        " @Emp_GLAnal4 varchar(12)," & _
        " @IntTem_PFCode varchar(6)," & _
        " @IntTem_MFCode varchar(6)," & _
        " @Emp_PensionNo varchar(7)," & _
        " @Emp_DrivingLicense varchar(20)," & _
        " @Emp_HasSI int," & _
        " @Emp_Pensiontype int," & _
        " @Emp_MyPayslipReport varchar(50)," & _
        " @Emp_IBAN varchar(40)," & _
        " @Emp_PreviousLifeIns decimal(18,2)," & _
        " @Emp_PreviousDis decimal(18,2)," & _
        " @Emp_PreviousST decimal(18,2)," & _
        " @Emp_OtherIncome4 decimal(18,2)," & _
        " @SecPay_Code varchar(4)," & _
        " @ComRat_Code varchar(4)," & _
        " @PerBon_Code varchar(4)," & _
        " @DutHou_Code varchar(4)," & _
        " @FliHou_Code varchar(4)," & _
        " @Emp_PassFullName varchar(100)," & _
        " @Emp_TravelDocs varchar(100)," & _
        " @Emp_FirstEmployment varchar(1)," & _
        " @OveLay_Code varchar(4)" & _
        " " & _
        " AS" & _
        " DECLARE @Result as Int" & _
        "   Set @Result = 0" & _
        "   SELECT @Result = Count(*)" & _
        "   FROM PrMsEmployees" & _
        "   WHERE Emp_Code = @Emp_Code" & _
        "   IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        " INSERT INTO PrMsEmployees" & _
        " (Emp_Code,                                           " & _
        " Emp_Status,                                         " & _
        " PayTyp_Code,                                        " & _
        " TemGrp_Code,                                        " & _
        " EmpSta_Code,                                        " & _
        " Emp_Title,                                          " & _
        " Emp_LastName,                                       " & _
        " Emp_FirstName,                                      " & _
        " Emp_FullName,                                       " & _
        " Emp_Sex,                                            " & _
        " Emp_BirthDate,                                      " & _
        " MarSta_Code,                                        " & _
        " Emp_Address1,                                       " & _
        " Emp_Address2,                                       " & _
        " Emp_Address3,                                       " & _
        " Emp_PostCode,                                       " & _
        " Emp_Telephone1,                                     " & _
        " Emp_Telephone2,                                     " & _
        " Emp_Email,                                          " & _
        " Emp_SocialInsNumber,                                " & _
        " ComSin_EmpSocialInsNo,                              " & _
        " Emp_IdentificationCard,                             " & _
        " Emp_TaxID,                                          " & _
        " Emp_PassportNumber,                                 " & _
        " Emp_AlienNumber,                                    " & _
        " TicTyp_Code,                                        " & _
        " EmpAn1_Code,                                        " & _
        " EmpAn2_Code,                                        " & _
        " EmpAn3_Code,                                        " & _
        " EmpAn4_Code,                                        " & _
        " EmpAn5_Code,                                        " & _
        " Uni_Code,                                           " & _
        " Cou_Code,                                           " & _
        " EmpPos_Code,                                        " & _
        " Sic_Code,                                           " & _
        " EmpCmm_Code,                                        " & _
        " PayUni_Code,                                        " & _
        " Emp_PeriodUnits,                                    " & _
        " Emp_AnnualUnits,                                    " & _
        " Cur_Code,                                           " & _
        " PmtMth_Code,                                        " & _
        " Bnk_Code,                                           " & _
        " Emp_BankAccount,                                    " & _
        " Bnk_CodeCo,                                         " & _
        " Emp_BankAccountCo,                                  " & _
        " Emp_StartDate,                                      " & _
        " Emp_TerminateDate,                                  " & _
        " Emp_OtherIncome1,                                   " & _
        " Emp_OtherIncome2,                                   " & _
        " Emp_OtherIncome3,                                   " & _
        " Emp_PreviousEarnings,                               " & _
        " Emp_PrevSIDeduct,                                   " & _
        " Emp_PrevSIContribute,                               " & _
        " Emp_PrevITDeduct,                                   " & _
        " Emp_PrevPFDeduct, " & _
        " ProFnd_Code," & _
        " MedFnd_Code," & _
        " SocInc_Code," & _
        " Ind_Code," & _
        " Une_Code," & _
        " SocCoh_Code," & _
        " Emp_CreationDate,                                   " & _
        " Emp_CreatedBy,                                      " & _
        " Emp_AmendDate,                                      " & _
        " Emp_AmendBy ,                                        " & _
        " IntTem_Code," & _
        " Emp_GLAnal1," & _
        " Emp_GLAnal2," & _
        " Emp_GLAnal3," & _
        " Emp_GLAnal4," & _
        " IntTem_PFCode," & _
        " IntTem_MFCode," & _
        " Emp_PensionNo," & _
        " Emp_DrivingLicense," & _
        " Emp_HasSI," & _
        " Emp_Pensiontype," & _
        " Emp_MyPayslipReport," & _
        " Emp_IBAN," & _
        " Emp_PreviousLifeIns," & _
        " Emp_PreviousDis," & _
        " Emp_PreviousST," & _
        " Emp_OtherIncome4," & _
        " SecPay_Code," & _
        " ComRat_Code," & _
        " PerBon_Code," & _
        " DutHou_Code," & _
        " FliHou_Code," & _
        " Emp_PassFullName," & _
        " Emp_TravelDocs," & _
        " Emp_FirstEmployment," & _
        " OveLay_Code " & _
        " " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @Emp_Status,                                         " & _
        " @PayTyp_Code,                                        " & _
        " @TemGrp_Code,                                        " & _
        " @EmpSta_Code,                                        " & _
        " @Emp_Title,                                          " & _
        " @Emp_LastName,                                       " & _
        " @Emp_FirstName,                                      " & _
        " @Emp_FullName,                                       " & _
        " @Emp_Sex,                                            " & _
        " @Emp_BirthDate,                                      " & _
        " @MarSta_Code,                                        " & _
        " @Emp_Address1,                                       " & _
        " @Emp_Address2,                                       " & _
        " @Emp_Address3,                                       " & _
        " @Emp_PostCode,                                       " & _
        " @Emp_Telephone1,                                     " & _
        " @Emp_Telephone2,                                     " & _
        " @Emp_Email,                                          " & _
        " @Emp_SocialInsNumber,                                " & _
        " @ComSin_EmpSocialInsNo,                              " & _
        " @Emp_IdentificationCard,                             " & _
        " @Emp_TaxID,                                          " & _
        " @Emp_PassportNumber,                                 " & _
        " @Emp_AlienNumber,                                    " & _
        " @TicTyp_Code,                                        " & _
        " @EmpAn1_Code,                                        " & _
        " @EmpAn2_Code,                                        " & _
        " @EmpAn3_Code,                                        " & _
        " @EmpAn4_Code,                                        " & _
        " @EmpAn5_Code,                                        " & _
        " @Uni_Code,                                           " & _
        " @Cou_Code,                                           " & _
        " @EmpPos_Code,                                        " & _
        " @Sic_Code,                                           " & _
        " @EmpCmm_Code,                                        " & _
        " @PayUni_Code,                                        " & _
        " @Emp_PeriodUnits,                                    " & _
        " @Emp_AnnualUnits,                                    " & _
        " @Cur_Code,                                           " & _
        " @PmtMth_Code,                                        " & _
        " @Bnk_Code,                                           " & _
        " @Emp_BankAccount,                                    " & _
        " @Bnk_CodeCo,                                         " & _
        " @Emp_BankAccountCo,                                  " & _
        " @Emp_StartDate,                                      " & _
        " @Emp_TerminateDate,                                  " & _
        " @Emp_OtherIncome1,                                   " & _
        " @Emp_OtherIncome2,                                   " & _
        " @Emp_OtherIncome3,                                   " & _
        " @Emp_PreviousEarnings,                               " & _
        " @Emp_PrevSIDeduct,                                   " & _
        " @Emp_PrevSIContribute,                               " & _
        " @Emp_PrevITDeduct,                                   " & _
        " @Emp_PrevPFDeduct,                                   " & _
        " @ProFnd_Code," & _
        " @MedFnd_Code," & _
        " @SocInc_Code," & _
        " @Ind_Code," & _
        " @Une_Code," & _
        " @SocCoh_Code," & _
        " @Emp_CreationDate,                                   " & _
        " @Emp_CreatedBy,                                      " & _
        " @Emp_AmendDate,                                      " & _
        " @Emp_AmendBy,                                         " & _
        " @IntTem_Code," & _
        " @Emp_GLAnal1," & _
        " @Emp_GLAnal2," & _
        " @Emp_GLAnal3," & _
        " @Emp_GLAnal4," & _
        " @IntTem_PFCode," & _
        " @IntTem_MFCode," & _
        " @Emp_PensionNo," & _
        " @Emp_DrivingLicense," & _
        " @Emp_HasSI," & _
        " @Emp_Pensiontype," & _
        " @Emp_MyPayslipReport," & _
        " @Emp_IBAN," & _
        " @Emp_PreviousLifeIns," & _
        " @Emp_PreviousDis," & _
        " @Emp_PreviousST," & _
        " @Emp_OtherIncome4," & _
        " @SecPay_Code," & _
        " @ComRat_Code," & _
        " @PerBon_Code," & _
        " @DutHou_Code," & _
        " @FliHou_Code," & _
        " @Emp_PassFullName," & _
        " @Emp_TravelDocs," & _
        " @Emp_FirstEmployment," & _
        " @OveLay_Code " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrMsEmployees" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     Emp_Status=@Emp_Status,                               " & _
        "    PayTyp_Code=@PayTyp_Code,                             " & _
        "    TemGrp_Code=@TemGrp_Code,                             " & _
        "    EmpSta_Code=@EmpSta_Code,                             " & _
        "    Emp_Title=@Emp_Title,                                 " & _
        "    Emp_LastName=@Emp_LastName,                           " & _
        "    Emp_FirstName=@Emp_FirstName,                         " & _
        "    Emp_FullName=@Emp_FullName,                           " & _
        "    Emp_Sex=@Emp_Sex,                                     " & _
        "    Emp_BirthDate=@Emp_BirthDate,                         " & _
        "    MarSta_Code=@MarSta_Code,                             " & _
        "    Emp_Address1=@Emp_Address1,                           " & _
        "    Emp_Address2=@Emp_Address2,                           " & _
        "    Emp_Address3=@Emp_Address3,                           " & _
        "    Emp_PostCode=@Emp_PostCode,                           " & _
        "    Emp_Telephone1=@Emp_Telephone1,                       " & _
        "    Emp_Telephone2=@Emp_Telephone2,                       " & _
        "    Emp_Email=@Emp_Email,                                 " & _
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " & _
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " & _
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " & _
        "   Emp_TaxID=@Emp_TaxID,                                 " & _
        "   Emp_PassportNumber=@Emp_PassportNumber,               " & _
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " & _
        "  TicTyp_Code=@TicTyp_Code,                             " & _
        "  EmpAn1_Code=@EmpAn1_Code,                             " & _
        "  EmpAn2_Code=@EmpAn2_Code,                             " & _
        "  EmpAn3_Code=@EmpAn3_Code,                             " & _
        " EmpAn4_Code=@EmpAn4_Code,                             " & _
        " EmpAn5_Code=@EmpAn5_Code,                             " & _
        " Uni_Code=@Uni_Code,                                   " & _
        " Cou_Code=@Cou_Code,                                   " & _
        " EmpPos_Code=@EmpPos_Code,                             " & _
        " Sic_Code=@Sic_Code,                                   " & _
        " EmpCmm_Code=@EmpCmm_Code,                             " & _
        " PayUni_Code=@PayUni_Code,                             " & _
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " & _
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " & _
        " Cur_Code=@Cur_Code,                                   " & _
        " PmtMth_Code=@PmtMth_Code,                             " & _
        " Bnk_Code=@Bnk_Code,                                   " & _
        " Emp_BankAccount=@Emp_BankAccount,                     " & _
        " Bnk_CodeCo=@Bnk_CodeCo,                               " & _
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " & _
        " Emp_StartDate=@Emp_StartDate,                         " & _
        " Emp_TerminateDate=@Emp_TerminateDate,                 " & _
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " & _
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " & _
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " & _
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " & _
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " & _
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " & _
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " & _
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " & _
        " ProFnd_Code=@ProFnd_Code," & _
        " MedFnd_Code=@MedFnd_Code," & _
        " SocInc_Code=@SocInc_Code," & _
        " Ind_Code=@Ind_Code," & _
        " Une_Code=@Une_Code," & _
        " SocCoh_Code=@SocCoh_Code," & _
        " Emp_CreationDate=@Emp_CreationDate,                   " & _
        " Emp_CreatedBy=@Emp_CreatedBy,                         " & _
        " Emp_AmendDate=@Emp_AmendDate,                         " & _
        " Emp_AmendBy=@Emp_AmendBy,                              " & _
        " IntTem_Code=@IntTem_Code," & _
        " Emp_GLAnal1=@Emp_GLAnal1," & _
        " Emp_GLAnal2=@Emp_GLAnal2," & _
        " Emp_GLAnal3=@Emp_GLAnal3," & _
        " Emp_GLAnal4=@Emp_GLAnal4," & _
        " IntTem_PFCode=@IntTem_PFCode," & _
        " IntTem_MFCode=@IntTem_MFCode," & _
        " Emp_PensionNo=@Emp_PensionNo," & _
        " Emp_DrivingLicense=@Emp_DrivingLicense," & _
        " Emp_HasSI=@Emp_HasSI," & _
        " Emp_Pensiontype=@Emp_Pensiontype," & _
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," & _
        " Emp_IBAN=@Emp_IBAN," & _
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," & _
        " Emp_PreviousDis=@Emp_PreviousDis," & _
        " Emp_PreviousST=@Emp_PreviousST," & _
        " Emp_OtherIncome4=@Emp_OtherIncome4," & _
        " SecPay_Code=@SecPay_Code," & _
        " ComRat_Code=@ComRat_Code," & _
        " PerBon_Code=@PerBon_Code," & _
        " DutHou_Code=@DutHou_Code," & _
        " FliHou_Code=@FliHou_Code," & _
        " Emp_PassFullName=@Emp_PassFullName," & _
        " Emp_TravelDocs=@Emp_TravelDocs," & _
        " Emp_FirstEmployment =@Emp_FirstEmployment," & _
        " OveLay_Code = @OveLay_Code " & _
        " WHERE Emp_Code = @Emp_Code" & _
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If



        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE]" & _
        " @TrxHdr_Id int," & _
        " @Emp_Code varchar(16)," & _
        " @PrdGrp_Code varchar(6)," & _
        " @PrdCod_Code varchar(6)," & _
        " @PayCat_Code varchar(4)," & _
        " @TrxHdr_Date datetime," & _
        " @TrxHdr_Status varchar(4)," & _
        " @TrxHdr_TotalErnPeriod decimal(18,2)," & _
        " @TrxHdr_TotalErnYTD decimal(18,2)," & _
        " @TrxHdr_TotalDedPeriod decimal(18,2)," & _
        " @TrxHdr_TotalDedYTD decimal(18,2)," & _
        " @TrxHdr_TotalConPeriod decimal(18,2)," & _
        " @TrxHdr_TotalConYTD decimal(18,2)," & _
        " @TrxHdr_SIIncome decimal(18,2)," & _
        " @TrxHdr_TaxableIncome decimal(18,2)," & _
        " @TrxHdr_PaymentMethod varchar(50)," & _
        " @TrxHdr_PaymentRef varchar(50)," & _
        " @TrxHdr_PeriodUnits decimal(18,2)," & _
        " @TrxHdr_AnnualUnits decimal(18,2)," & _
        " @TrxHdr_AnnualLeave decimal(18,2)," & _
        " @TrxHdr_LifeInsurance decimal(18,2)," & _
        " @TrxHdr_Discounts decimal(18,2)," & _
        " @TrxHdr_Interfacestatus varchar(4)," & _
        " @TrxHdr_Overtime1 decimal(10,2)," & _
        " @TrxHdr_Overtime2 decimal(10,2)," & _
        " @TrxHdr_SIUnits decimal(10,2)," & _
        " @TrxHdr_MonthlySalary decimal(18,2)," & _
        " @TrxHdr_NetSalary decimal(18,2)," & _
        " @TrxHdr_PeriodInsurable decimal(18,2)," & _
        " @TemGrp_Code varchar(6)," & _
        " @TrxHdr_ChequeNo varchar(50)," & _
        " @TrxHdr_TaxableFromOther Decimal(18,2)," & _
        " @TrxHdr_CurrencySymbol varchar(3)," & _
        " @TrxHdr_Rate Decimal(18,10)," & _
        " @TrxHdr_NormalDays Decimal(18,2)," & _
        " @TrxHdr_Salary1 Decimal(18,2)," & _
        " @TrxHdr_Salary2 Decimal(18,2)," & _
        " @TrxHdr_Overtime3 decimal(10,2)," & _
        " @TrxHdr_Sectors decimal(18,2)," & _
        " @TrxHdr_Dutyhours decimal(18,2)," & _
        " @TrxHdr_FlightHours decimal(18,2)," & _
        " @TrxHdr_Commission decimal(18,2)," & _
        " @TrxHdr_PBAmount decimal(18,2)," & _
        " @TrxHdr_PBRate decimal(18,2)," & _
        " @TrxHdr_Overlay decimal(18,2)," & _
        " @TrxHdr_PeriodSplit decimal(18,2)," & _
        " @NewId Int OUTPUT" & _
        " AS" & _
        " DECLARE @Result as Int" & _
        " Set  @Result = 0" & _
        " SELECT @Result = Count(*)" & _
        " FROM PrTxTrxnHeader" & _
        " WHERE TrxHdr_Id =  @TrxHdr_Id" & _
        " IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        "   INSERT INTO PrTxTrxnHeader" & _
        "   (Emp_Code,                                           " & _
        " PrdGrp_Code," & _
        " PrdCod_Code,                                        " & _
        " PayCat_Code,                                        " & _
        " TrxHdr_Date,                                        " & _
        " TrxHdr_Status,                                      " & _
        " TrxHdr_TotalErnPeriod,                              " & _
        " TrxHdr_TotalErnYTD,                                 " & _
        " TrxHdr_TotalDedPeriod,                              " & _
        " TrxHdr_TotalDedYTD,                                 " & _
        " TrxHdr_TotalConPeriod,                              " & _
        " TrxHdr_TotalConYTD,                                 " & _
        " TrxHdr_SIIncome,                                    " & _
        " TrxHdr_TaxableIncome,                               " & _
        " TrxHdr_PaymentMethod,                               " & _
        " TrxHdr_PaymentRef,                                  " & _
        " TrxHdr_PeriodUnits,                                 " & _
        " TrxHdr_AnnualUnits,                                 " & _
        " TrxHdr_AnnualLeave,                                  " & _
        " TrxHdr_LifeInsurance,                                " & _
        " TrxHdr_Discounts,                                    " & _
        " TrxHdr_InterfaceStatus,                               " & _
        " TrxHdr_Overtime1," & _
        " TrxHdr_Overtime2," & _
        " TrxHdr_SIUnits," & _
        " TrxHdr_MonthlySalary," & _
        " TrxHdr_NetSalary," & _
        " TrxHdr_PeriodInsurable," & _
        " TemGrp_Code," & _
        " TrxHdr_ChequeNo," & _
        " TrxHdr_TaxableFromOther," & _
        " TrxHdr_CurrencySymbol," & _
        " TrxHdr_Rate," & _
        " TrxHdr_NormalDays," & _
        " TrxHdr_Salary1," & _
        " TrxHdr_Salary2," & _
        " TrxHdr_Overtime3," & _
        " TrxHdr_Sectors," & _
        " TrxHdr_Dutyhours," & _
        " TrxHdr_FlightHours," & _
        " TrxHdr_Commission," & _
        " TrxHdr_PBAmount," & _
        " TrxHdr_PBRate," & _
        " TrxHdr_Overlay," & _
        " TrxHdr_PeriodSplit " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @PrdGrp_Code," & _
        " @PrdCod_Code,                                        " & _
        " @PayCat_Code,                                        " & _
        " @TrxHdr_Date,                                        " & _
        " @TrxHdr_Status,                                      " & _
        " @TrxHdr_TotalErnPeriod,                              " & _
        " @TrxHdr_TotalErnYTD,                                 " & _
        " @TrxHdr_TotalDedPeriod,                              " & _
        " @TrxHdr_TotalDedYTD,                                 " & _
        " @TrxHdr_TotalConPeriod,                              " & _
        " @TrxHdr_TotalConYTD,                                 " & _
        " @TrxHdr_SIIncome,                                    " & _
        " @TrxHdr_TaxableIncome,                               " & _
        " @TrxHdr_PaymentMethod,                               " & _
        " @TrxHdr_PaymentRef,                                  " & _
        " @TrxHdr_PeriodUnits,                                 " & _
        " @TrxHdr_AnnualUnits,                                 " & _
        " @TrxHdr_AnnualLeave,                                 " & _
        " @TrxHdr_LifeInsurance,                               " & _
        " @TrxHdr_Discounts,                                   " & _
        " @TrxHdr_InterfaceStatus,                              " & _
        " @TrxHdr_Overtime1," & _
        " @TrxHdr_Overtime2," & _
        " @TrxHdr_SIUnits," & _
        " @TrxHdr_MonthlySalary," & _
        " @TrxHdr_NetSalary," & _
        " @TrxHdr_PeriodInsurable," & _
        " @TemGrp_Code, " & _
        " @TrxHdr_ChequeNo," & _
        " @TrxHdr_TaxableFromOther," & _
        " @TrxHdr_CurrencySymbol," & _
        " @TrxHdr_Rate," & _
        " @TrxHdr_NormalDays," & _
        " @TrxHdr_Salary1," & _
        " @TrxHdr_Salary2," & _
        " @TrxHdr_Overtime3," & _
        " @TrxHdr_Sectors," & _
        " @TrxHdr_Dutyhours," & _
        " @TrxHdr_FlightHours," & _
        " @TrxHdr_Commission," & _
        " @TrxHdr_PBAmount," & _
        " @TrxHdr_PBRate," & _
        " @TrxHdr_Overlay," & _
        " @TrxHdr_PeriodSplit " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrTxTrxnHeader" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     PrdGrp_Code=@PrdGrp_Code," & _
        "     PrdCod_Code=@PrdCod_Code,                             " & _
        "     PayCat_Code=@PayCat_Code,                             " & _
        "     TrxHdr_Date=@TrxHdr_Date,                             " & _
        "    TrxHdr_Status=@TrxHdr_Status,                         " & _
        "  TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " & _
        "     TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " & _
        "    TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " & _
        "   TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " & _
        "  TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " & _
        " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " & _
        " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " & _
        " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " & _
        " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " & _
        " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " & _
        " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " & _
        " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " & _
        " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,                " & _
        " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " & _
        " TrxHdr_Discounts=@TrxHdr_Discounts,                    " & _
        " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,        " & _
        " TrxHdr_Overtime1=@TrxHdr_Overtime1," & _
        " TrxHdr_Overtime2=@TrxHdr_Overtime2," & _
        " TrxHdr_SIUnits=@TrxHdr_SIUnits," & _
        " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary," & _
        " TrxHdr_NetSalary=@TrxHdr_NetSalary," & _
        " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable," & _
        " TemGrp_Code=@TemGrp_Code," & _
        " TrxHdr_ChequeNo=@TrxHdr_ChequeNo ," & _
        " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther," & _
        " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol," & _
        " TrxHdr_Rate=@TrxHdr_Rate," & _
        " TrxHdr_NormalDays=@TrxHdr_NormalDays ," & _
        " TrxHdr_Salary1=@TrxHdr_Salary1," & _
        " TrxHdr_Salary2=@TrxHdr_Salary2," & _
        " TrxHdr_Overtime3=@TrxHdr_Overtime3," & _
        " TrxHdr_Sectors=@TrxHdr_Sectors," & _
        " TrxHdr_Dutyhours=@TrxHdr_Dutyhours," & _
        " TrxHdr_FlightHours=@TrxHdr_FlightHours," & _
        " TrxHdr_Commission=@TrxHdr_Commission," & _
        " TrxHdr_PBAmount=@TrxHdr_PBAmount," & _
        " TrxHdr_PBRate=@TrxHdr_PBRate," & _
        " TrxHdr_Overlay=@TrxHdr_Overlay," & _
        " TrxHdr_PeriodSplit=@TrxHdr_PeriodSplit " & _
        " WHERE TrxHdr_Id = @TrxHdr_Id" & _
        " END" & _
        " set  @NewId=SCOPE_IDENTITY()"


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If


        Return True

    End Function

    Protected Function CreateValuesOnAirlinesTables2() As Boolean
        Dim F As Boolean = True

        Dim Overlay As New cPrSsOverLay("0000")
        If Overlay.Code = "" Then
            With Overlay
                .Code = "0000"
                .Desc = "OVLAY 0.00"
                .HourRate = 0.0
                If Not .Save Then
                    MsgBox("Unable to Create Value for OVERLAY", MsgBoxStyle.Critical)
                    F = False
                End If
            End With
        End If
        Return F
    End Function

    Public Shadows Function ChangePassword(ByVal User As String, ByVal OldPwd As String, ByVal NewPwd As String) As Boolean
        Dim F As Boolean
        Try

            Dim str As String
            str = "ALTER LOGIN [" & User & "]" & _
            " WITH PASSWORD = " & enQuoteString(NewPwd) & _
            " OLD_PASSWORD = " & enQuoteString(OldPwd)

            If MyBase.ExecuteNonQueryNoMessages(str) < 0 Then
                F = False
                MsgBox("Failed to change Password, possible reason 'Old Password' is incorrect!", MsgBoxStyle.Critical)
            Else
                F = True
            End If

        Catch ex As Exception
            f = False
        End Try
        Return f
    End Function
    Public Function BackupDatabase(ByVal dbName As String, ByVal bDestination As String)
        Dim SQL As String
        Dim ds As DataSet
        Dim Success As Boolean = False
        Dim i As Integer
        Try
            SQL = "BACKUP DATABASE " & dbName & _
                " TO DISK='" & bDestination.Trim & "'"
            i = MyBase.ExecuteNonQuery(SQL)
            If i >= 0 Then
                Success = True
            End If


        Catch ex As Exception
            ShowException(ex)
        End Try

        Return Success

    End Function
    Protected Function Upgrade2017_A()
        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " & _
        " ADD [Emp_Password] [varchar](20) NULL"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If


        ' Alter SPs

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" & _
        " @Emp_Code varchar(16)," & _
        " @Emp_Status char(1)," & _
        " @PayTyp_Code varchar(4)," & _
        " @TemGrp_Code varchar(6)," & _
        " @EmpSta_Code char(1)," & _
        " @Emp_Title char(4)," & _
        " @Emp_LastName varchar(30)," & _
        " @Emp_FirstName varchar(30)," & _
        " @Emp_FullName varchar(60)," & _
        " @Emp_Sex char(1)," & _
        " @Emp_BirthDate smalldatetime," & _
        " @MarSta_Code char(1)," & _
        " @Emp_Address1 varchar(30)," & _
        " @Emp_Address2 varchar(30)," & _
        " @Emp_Address3 varchar(30)," & _
        " @Emp_PostCode varchar(30)," & _
        " @Emp_Telephone1 varchar(20)," & _
        " @Emp_Telephone2 varchar(20)," & _
        " @Emp_Email varchar(50)," & _
        " @Emp_SocialInsNumber varchar(20)," & _
        " @ComSin_EmpSocialInsNo varchar(20)," & _
        " @Emp_IdentificationCard varchar(10)," & _
        " @Emp_TaxID varchar(10)," & _
        " @Emp_PassportNumber varchar(10)," & _
        " @Emp_AlienNumber varchar(10)," & _
        " @TicTyp_Code char(1)," & _
        " @EmpAn1_Code varchar(12)," & _
        " @EmpAn2_Code varchar(12)," & _
        " @EmpAn3_Code varchar(12)," & _
        " @EmpAn4_Code varchar(12)," & _
        " @EmpAn5_Code varchar(12)," & _
        " @Uni_Code varchar(12)," & _
        " @Cou_Code char(2)," & _
        " @EmpPos_Code varchar(12)," & _
        " @Sic_Code varchar(4)," & _
        " @EmpCmm_Code varchar(4)," & _
        " @PayUni_Code varchar(4)," & _
        " @Emp_PeriodUnits int," & _
        " @Emp_AnnualUnits int," & _
        " @Cur_Code char(3)," & _
        " @PmtMth_Code varchar(4)," & _
        " @Bnk_Code varchar(12)," & _
        " @Emp_BankAccount varchar(30)," & _
        " @Bnk_CodeCo varchar(12)," & _
        " @Emp_BankAccountCo varchar(30)," & _
        " @Emp_StartDate smalldatetime," & _
        " @Emp_TerminateDate varchar(10)," & _
        " @Emp_OtherIncome1 decimal(8,2)," & _
        " @Emp_OtherIncome2 decimal(8,2)," & _
        " @Emp_OtherIncome3 decimal(8,2)," & _
        " @Emp_PreviousEarnings decimal(8,2)," & _
        " @Emp_PrevSIDeduct decimal(8,2)," & _
        " @Emp_PrevSIContribute decimal(8,2)," & _
        " @Emp_PrevITDeduct decimal(8,2)," & _
        " @Emp_PrevPFDeduct decimal(8,2)," & _
        " @ProFnd_Code varchar(4)," & _
        " @MedFnd_Code varchar(4)," & _
        " @SocInc_Code varchar(4)," & _
        " @Ind_Code varchar(4)," & _
        " @Une_Code varchar(4)," & _
        " @SocCoh_Code varchar(4)," & _
        " @Emp_CreationDate smalldatetime," & _
        " @Emp_CreatedBy int," & _
        " @Emp_AmendDate smalldatetime," & _
        " @Emp_AmendBy int," & _
        " @IntTem_Code varchar(6)," & _
        " @Emp_GLAnal1 varchar(12)," & _
        " @Emp_GLAnal2 varchar(12)," & _
        " @Emp_GLAnal3 varchar(12)," & _
        " @Emp_GLAnal4 varchar(12)," & _
        " @IntTem_PFCode varchar(6)," & _
        " @IntTem_MFCode varchar(6)," & _
        " @Emp_PensionNo varchar(7)," & _
        " @Emp_DrivingLicense varchar(20)," & _
        " @Emp_HasSI int," & _
        " @Emp_Pensiontype int," & _
        " @Emp_MyPayslipReport varchar(50)," & _
        " @Emp_IBAN varchar(40)," & _
        " @Emp_PreviousLifeIns decimal(18,2)," & _
        " @Emp_PreviousDis decimal(18,2)," & _
        " @Emp_PreviousST decimal(18,2)," & _
        " @Emp_OtherIncome4 decimal(18,2)," & _
        " @SecPay_Code varchar(4)," & _
        " @ComRat_Code varchar(4)," & _
        " @PerBon_Code varchar(4)," & _
        " @DutHou_Code varchar(4)," & _
        " @FliHou_Code varchar(4)," & _
        " @Emp_PassFullName varchar(100)," & _
        " @Emp_TravelDocs varchar(100)," & _
        " @Emp_FirstEmployment varchar(1)," & _
        " @OveLay_Code varchar(4)," & _
        " @Emp_Password varchar(20)" & _
        " " & _
        " AS" & _
        " DECLARE @Result as Int" & _
        "   Set @Result = 0" & _
        "   SELECT @Result = Count(*)" & _
        "   FROM PrMsEmployees" & _
        "   WHERE Emp_Code = @Emp_Code" & _
        "   IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        " INSERT INTO PrMsEmployees" & _
        " (Emp_Code,                                           " & _
        " Emp_Status,                                         " & _
        " PayTyp_Code,                                        " & _
        " TemGrp_Code,                                        " & _
        " EmpSta_Code,                                        " & _
        " Emp_Title,                                          " & _
        " Emp_LastName,                                       " & _
        " Emp_FirstName,                                      " & _
        " Emp_FullName,                                       " & _
        " Emp_Sex,                                            " & _
        " Emp_BirthDate,                                      " & _
        " MarSta_Code,                                        " & _
        " Emp_Address1,                                       " & _
        " Emp_Address2,                                       " & _
        " Emp_Address3,                                       " & _
        " Emp_PostCode,                                       " & _
        " Emp_Telephone1,                                     " & _
        " Emp_Telephone2,                                     " & _
        " Emp_Email,                                          " & _
        " Emp_SocialInsNumber,                                " & _
        " ComSin_EmpSocialInsNo,                              " & _
        " Emp_IdentificationCard,                             " & _
        " Emp_TaxID,                                          " & _
        " Emp_PassportNumber,                                 " & _
        " Emp_AlienNumber,                                    " & _
        " TicTyp_Code,                                        " & _
        " EmpAn1_Code,                                        " & _
        " EmpAn2_Code,                                        " & _
        " EmpAn3_Code,                                        " & _
        " EmpAn4_Code,                                        " & _
        " EmpAn5_Code,                                        " & _
        " Uni_Code,                                           " & _
        " Cou_Code,                                           " & _
        " EmpPos_Code,                                        " & _
        " Sic_Code,                                           " & _
        " EmpCmm_Code,                                        " & _
        " PayUni_Code,                                        " & _
        " Emp_PeriodUnits,                                    " & _
        " Emp_AnnualUnits,                                    " & _
        " Cur_Code,                                           " & _
        " PmtMth_Code,                                        " & _
        " Bnk_Code,                                           " & _
        " Emp_BankAccount,                                    " & _
        " Bnk_CodeCo,                                         " & _
        " Emp_BankAccountCo,                                  " & _
        " Emp_StartDate,                                      " & _
        " Emp_TerminateDate,                                  " & _
        " Emp_OtherIncome1,                                   " & _
        " Emp_OtherIncome2,                                   " & _
        " Emp_OtherIncome3,                                   " & _
        " Emp_PreviousEarnings,                               " & _
        " Emp_PrevSIDeduct,                                   " & _
        " Emp_PrevSIContribute,                               " & _
        " Emp_PrevITDeduct,                                   " & _
        " Emp_PrevPFDeduct, " & _
        " ProFnd_Code," & _
        " MedFnd_Code," & _
        " SocInc_Code," & _
        " Ind_Code," & _
        " Une_Code," & _
        " SocCoh_Code," & _
        " Emp_CreationDate,                                   " & _
        " Emp_CreatedBy,                                      " & _
        " Emp_AmendDate,                                      " & _
        " Emp_AmendBy ,                                        " & _
        " IntTem_Code," & _
        " Emp_GLAnal1," & _
        " Emp_GLAnal2," & _
        " Emp_GLAnal3," & _
        " Emp_GLAnal4," & _
        " IntTem_PFCode," & _
        " IntTem_MFCode," & _
        " Emp_PensionNo," & _
        " Emp_DrivingLicense," & _
        " Emp_HasSI," & _
        " Emp_Pensiontype," & _
        " Emp_MyPayslipReport," & _
        " Emp_IBAN," & _
        " Emp_PreviousLifeIns," & _
        " Emp_PreviousDis," & _
        " Emp_PreviousST," & _
        " Emp_OtherIncome4," & _
        " SecPay_Code," & _
        " ComRat_Code," & _
        " PerBon_Code," & _
        " DutHou_Code," & _
        " FliHou_Code," & _
        " Emp_PassFullName," & _
        " Emp_TravelDocs," & _
        " Emp_FirstEmployment," & _
        " OveLay_Code, " & _
        " Emp_Password " & _
        " " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @Emp_Status,                                         " & _
        " @PayTyp_Code,                                        " & _
        " @TemGrp_Code,                                        " & _
        " @EmpSta_Code,                                        " & _
        " @Emp_Title,                                          " & _
        " @Emp_LastName,                                       " & _
        " @Emp_FirstName,                                      " & _
        " @Emp_FullName,                                       " & _
        " @Emp_Sex,                                            " & _
        " @Emp_BirthDate,                                      " & _
        " @MarSta_Code,                                        " & _
        " @Emp_Address1,                                       " & _
        " @Emp_Address2,                                       " & _
        " @Emp_Address3,                                       " & _
        " @Emp_PostCode,                                       " & _
        " @Emp_Telephone1,                                     " & _
        " @Emp_Telephone2,                                     " & _
        " @Emp_Email,                                          " & _
        " @Emp_SocialInsNumber,                                " & _
        " @ComSin_EmpSocialInsNo,                              " & _
        " @Emp_IdentificationCard,                             " & _
        " @Emp_TaxID,                                          " & _
        " @Emp_PassportNumber,                                 " & _
        " @Emp_AlienNumber,                                    " & _
        " @TicTyp_Code,                                        " & _
        " @EmpAn1_Code,                                        " & _
        " @EmpAn2_Code,                                        " & _
        " @EmpAn3_Code,                                        " & _
        " @EmpAn4_Code,                                        " & _
        " @EmpAn5_Code,                                        " & _
        " @Uni_Code,                                           " & _
        " @Cou_Code,                                           " & _
        " @EmpPos_Code,                                        " & _
        " @Sic_Code,                                           " & _
        " @EmpCmm_Code,                                        " & _
        " @PayUni_Code,                                        " & _
        " @Emp_PeriodUnits,                                    " & _
        " @Emp_AnnualUnits,                                    " & _
        " @Cur_Code,                                           " & _
        " @PmtMth_Code,                                        " & _
        " @Bnk_Code,                                           " & _
        " @Emp_BankAccount,                                    " & _
        " @Bnk_CodeCo,                                         " & _
        " @Emp_BankAccountCo,                                  " & _
        " @Emp_StartDate,                                      " & _
        " @Emp_TerminateDate,                                  " & _
        " @Emp_OtherIncome1,                                   " & _
        " @Emp_OtherIncome2,                                   " & _
        " @Emp_OtherIncome3,                                   " & _
        " @Emp_PreviousEarnings,                               " & _
        " @Emp_PrevSIDeduct,                                   " & _
        " @Emp_PrevSIContribute,                               " & _
        " @Emp_PrevITDeduct,                                   " & _
        " @Emp_PrevPFDeduct,                                   " & _
        " @ProFnd_Code," & _
        " @MedFnd_Code," & _
        " @SocInc_Code," & _
        " @Ind_Code," & _
        " @Une_Code," & _
        " @SocCoh_Code," & _
        " @Emp_CreationDate,                                   " & _
        " @Emp_CreatedBy,                                      " & _
        " @Emp_AmendDate,                                      " & _
        " @Emp_AmendBy,                                         " & _
        " @IntTem_Code," & _
        " @Emp_GLAnal1," & _
        " @Emp_GLAnal2," & _
        " @Emp_GLAnal3," & _
        " @Emp_GLAnal4," & _
        " @IntTem_PFCode," & _
        " @IntTem_MFCode," & _
        " @Emp_PensionNo," & _
        " @Emp_DrivingLicense," & _
        " @Emp_HasSI," & _
        " @Emp_Pensiontype," & _
        " @Emp_MyPayslipReport," & _
        " @Emp_IBAN," & _
        " @Emp_PreviousLifeIns," & _
        " @Emp_PreviousDis," & _
        " @Emp_PreviousST," & _
        " @Emp_OtherIncome4," & _
        " @SecPay_Code," & _
        " @ComRat_Code," & _
        " @PerBon_Code," & _
        " @DutHou_Code," & _
        " @FliHou_Code," & _
        " @Emp_PassFullName," & _
        " @Emp_TravelDocs," & _
        " @Emp_FirstEmployment," & _
        " @OveLay_Code, " & _
        " @Emp_Password " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrMsEmployees" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     Emp_Status=@Emp_Status,                               " & _
        "    PayTyp_Code=@PayTyp_Code,                             " & _
        "    TemGrp_Code=@TemGrp_Code,                             " & _
        "    EmpSta_Code=@EmpSta_Code,                             " & _
        "    Emp_Title=@Emp_Title,                                 " & _
        "    Emp_LastName=@Emp_LastName,                           " & _
        "    Emp_FirstName=@Emp_FirstName,                         " & _
        "    Emp_FullName=@Emp_FullName,                           " & _
        "    Emp_Sex=@Emp_Sex,                                     " & _
        "    Emp_BirthDate=@Emp_BirthDate,                         " & _
        "    MarSta_Code=@MarSta_Code,                             " & _
        "    Emp_Address1=@Emp_Address1,                           " & _
        "    Emp_Address2=@Emp_Address2,                           " & _
        "    Emp_Address3=@Emp_Address3,                           " & _
        "    Emp_PostCode=@Emp_PostCode,                           " & _
        "    Emp_Telephone1=@Emp_Telephone1,                       " & _
        "    Emp_Telephone2=@Emp_Telephone2,                       " & _
        "    Emp_Email=@Emp_Email,                                 " & _
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " & _
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " & _
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " & _
        "   Emp_TaxID=@Emp_TaxID,                                 " & _
        "   Emp_PassportNumber=@Emp_PassportNumber,               " & _
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " & _
        "  TicTyp_Code=@TicTyp_Code,                             " & _
        "  EmpAn1_Code=@EmpAn1_Code,                             " & _
        "  EmpAn2_Code=@EmpAn2_Code,                             " & _
        "  EmpAn3_Code=@EmpAn3_Code,                             " & _
        " EmpAn4_Code=@EmpAn4_Code,                             " & _
        " EmpAn5_Code=@EmpAn5_Code,                             " & _
        " Uni_Code=@Uni_Code,                                   " & _
        " Cou_Code=@Cou_Code,                                   " & _
        " EmpPos_Code=@EmpPos_Code,                             " & _
        " Sic_Code=@Sic_Code,                                   " & _
        " EmpCmm_Code=@EmpCmm_Code,                             " & _
        " PayUni_Code=@PayUni_Code,                             " & _
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " & _
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " & _
        " Cur_Code=@Cur_Code,                                   " & _
        " PmtMth_Code=@PmtMth_Code,                             " & _
        " Bnk_Code=@Bnk_Code,                                   " & _
        " Emp_BankAccount=@Emp_BankAccount,                     " & _
        " Bnk_CodeCo=@Bnk_CodeCo,                               " & _
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " & _
        " Emp_StartDate=@Emp_StartDate,                         " & _
        " Emp_TerminateDate=@Emp_TerminateDate,                 " & _
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " & _
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " & _
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " & _
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " & _
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " & _
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " & _
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " & _
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " & _
        " ProFnd_Code=@ProFnd_Code," & _
        " MedFnd_Code=@MedFnd_Code," & _
        " SocInc_Code=@SocInc_Code," & _
        " Ind_Code=@Ind_Code," & _
        " Une_Code=@Une_Code," & _
        " SocCoh_Code=@SocCoh_Code," & _
        " Emp_CreationDate=@Emp_CreationDate,                   " & _
        " Emp_CreatedBy=@Emp_CreatedBy,                         " & _
        " Emp_AmendDate=@Emp_AmendDate,                         " & _
        " Emp_AmendBy=@Emp_AmendBy,                              " & _
        " IntTem_Code=@IntTem_Code," & _
        " Emp_GLAnal1=@Emp_GLAnal1," & _
        " Emp_GLAnal2=@Emp_GLAnal2," & _
        " Emp_GLAnal3=@Emp_GLAnal3," & _
        " Emp_GLAnal4=@Emp_GLAnal4," & _
        " IntTem_PFCode=@IntTem_PFCode," & _
        " IntTem_MFCode=@IntTem_MFCode," & _
        " Emp_PensionNo=@Emp_PensionNo," & _
        " Emp_DrivingLicense=@Emp_DrivingLicense," & _
        " Emp_HasSI=@Emp_HasSI," & _
        " Emp_Pensiontype=@Emp_Pensiontype," & _
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," & _
        " Emp_IBAN=@Emp_IBAN," & _
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," & _
        " Emp_PreviousDis=@Emp_PreviousDis," & _
        " Emp_PreviousST=@Emp_PreviousST," & _
        " Emp_OtherIncome4=@Emp_OtherIncome4," & _
        " SecPay_Code=@SecPay_Code," & _
        " ComRat_Code=@ComRat_Code," & _
        " PerBon_Code=@PerBon_Code," & _
        " DutHou_Code=@DutHou_Code," & _
        " FliHou_Code=@FliHou_Code," & _
        " Emp_PassFullName=@Emp_PassFullName," & _
        " Emp_TravelDocs=@Emp_TravelDocs," & _
        " Emp_FirstEmployment =@Emp_FirstEmployment," & _
        " OveLay_Code = @OveLay_Code, " & _
        " Emp_Password = @Emp_Password " & _
        " WHERE Emp_Code = @Emp_Code" & _
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True

    End Function
    Protected Function Upgrade2017_C()
        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " & _
        " ADD [Emp_Splitemployement] [char](1) NULL"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        Str = "update PrMsEmployees " & _
               " set Emp_Splitemployement='0'"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("set All Values to zero", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set values to zero", MsgBoxStyle.Critical)
        End If

        ' Alter SPs

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" & _
        " @Emp_Code varchar(16)," & _
        " @Emp_Status char(1)," & _
        " @PayTyp_Code varchar(4)," & _
        " @TemGrp_Code varchar(6)," & _
        " @EmpSta_Code char(1)," & _
        " @Emp_Title char(4)," & _
        " @Emp_LastName varchar(30)," & _
        " @Emp_FirstName varchar(30)," & _
        " @Emp_FullName varchar(60)," & _
        " @Emp_Sex char(1)," & _
        " @Emp_BirthDate smalldatetime," & _
        " @MarSta_Code char(1)," & _
        " @Emp_Address1 varchar(30)," & _
        " @Emp_Address2 varchar(30)," & _
        " @Emp_Address3 varchar(30)," & _
        " @Emp_PostCode varchar(30)," & _
        " @Emp_Telephone1 varchar(20)," & _
        " @Emp_Telephone2 varchar(20)," & _
        " @Emp_Email varchar(50)," & _
        " @Emp_SocialInsNumber varchar(20)," & _
        " @ComSin_EmpSocialInsNo varchar(20)," & _
        " @Emp_IdentificationCard varchar(10)," & _
        " @Emp_TaxID varchar(10)," & _
        " @Emp_PassportNumber varchar(10)," & _
        " @Emp_AlienNumber varchar(10)," & _
        " @TicTyp_Code char(1)," & _
        " @EmpAn1_Code varchar(12)," & _
        " @EmpAn2_Code varchar(12)," & _
        " @EmpAn3_Code varchar(12)," & _
        " @EmpAn4_Code varchar(12)," & _
        " @EmpAn5_Code varchar(12)," & _
        " @Uni_Code varchar(12)," & _
        " @Cou_Code char(2)," & _
        " @EmpPos_Code varchar(12)," & _
        " @Sic_Code varchar(4)," & _
        " @EmpCmm_Code varchar(4)," & _
        " @PayUni_Code varchar(4)," & _
        " @Emp_PeriodUnits int," & _
        " @Emp_AnnualUnits int," & _
        " @Cur_Code char(3)," & _
        " @PmtMth_Code varchar(4)," & _
        " @Bnk_Code varchar(12)," & _
        " @Emp_BankAccount varchar(30)," & _
        " @Bnk_CodeCo varchar(12)," & _
        " @Emp_BankAccountCo varchar(30)," & _
        " @Emp_StartDate smalldatetime," & _
        " @Emp_TerminateDate varchar(10)," & _
        " @Emp_OtherIncome1 decimal(8,2)," & _
        " @Emp_OtherIncome2 decimal(8,2)," & _
        " @Emp_OtherIncome3 decimal(8,2)," & _
        " @Emp_PreviousEarnings decimal(8,2)," & _
        " @Emp_PrevSIDeduct decimal(8,2)," & _
        " @Emp_PrevSIContribute decimal(8,2)," & _
        " @Emp_PrevITDeduct decimal(8,2)," & _
        " @Emp_PrevPFDeduct decimal(8,2)," & _
        " @ProFnd_Code varchar(4)," & _
        " @MedFnd_Code varchar(4)," & _
        " @SocInc_Code varchar(4)," & _
        " @Ind_Code varchar(4)," & _
        " @Une_Code varchar(4)," & _
        " @SocCoh_Code varchar(4)," & _
        " @Emp_CreationDate smalldatetime," & _
        " @Emp_CreatedBy int," & _
        " @Emp_AmendDate smalldatetime," & _
        " @Emp_AmendBy int," & _
        " @IntTem_Code varchar(6)," & _
        " @Emp_GLAnal1 varchar(12)," & _
        " @Emp_GLAnal2 varchar(12)," & _
        " @Emp_GLAnal3 varchar(12)," & _
        " @Emp_GLAnal4 varchar(12)," & _
        " @IntTem_PFCode varchar(6)," & _
        " @IntTem_MFCode varchar(6)," & _
        " @Emp_PensionNo varchar(7)," & _
        " @Emp_DrivingLicense varchar(20)," & _
        " @Emp_HasSI int," & _
        " @Emp_Pensiontype int," & _
        " @Emp_MyPayslipReport varchar(50)," & _
        " @Emp_IBAN varchar(40)," & _
        " @Emp_PreviousLifeIns decimal(18,2)," & _
        " @Emp_PreviousDis decimal(18,2)," & _
        " @Emp_PreviousST decimal(18,2)," & _
        " @Emp_OtherIncome4 decimal(18,2)," & _
        " @SecPay_Code varchar(4)," & _
        " @ComRat_Code varchar(4)," & _
        " @PerBon_Code varchar(4)," & _
        " @DutHou_Code varchar(4)," & _
        " @FliHou_Code varchar(4)," & _
        " @Emp_PassFullName varchar(100)," & _
        " @Emp_TravelDocs varchar(100)," & _
        " @Emp_FirstEmployment varchar(1)," & _
        " @OveLay_Code varchar(4)," & _
        " @Emp_Password varchar(20)," & _
        " @Emp_Splitemployement char(1) " & _
        " " & _
        " AS" & _
        " DECLARE @Result as Int" & _
        "   Set @Result = 0" & _
        "   SELECT @Result = Count(*)" & _
        "   FROM PrMsEmployees" & _
        "   WHERE Emp_Code = @Emp_Code" & _
        "   IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        " INSERT INTO PrMsEmployees" & _
        " (Emp_Code,                                           " & _
        " Emp_Status,                                         " & _
        " PayTyp_Code,                                        " & _
        " TemGrp_Code,                                        " & _
        " EmpSta_Code,                                        " & _
        " Emp_Title,                                          " & _
        " Emp_LastName,                                       " & _
        " Emp_FirstName,                                      " & _
        " Emp_FullName,                                       " & _
        " Emp_Sex,                                            " & _
        " Emp_BirthDate,                                      " & _
        " MarSta_Code,                                        " & _
        " Emp_Address1,                                       " & _
        " Emp_Address2,                                       " & _
        " Emp_Address3,                                       " & _
        " Emp_PostCode,                                       " & _
        " Emp_Telephone1,                                     " & _
        " Emp_Telephone2,                                     " & _
        " Emp_Email,                                          " & _
        " Emp_SocialInsNumber,                                " & _
        " ComSin_EmpSocialInsNo,                              " & _
        " Emp_IdentificationCard,                             " & _
        " Emp_TaxID,                                          " & _
        " Emp_PassportNumber,                                 " & _
        " Emp_AlienNumber,                                    " & _
        " TicTyp_Code,                                        " & _
        " EmpAn1_Code,                                        " & _
        " EmpAn2_Code,                                        " & _
        " EmpAn3_Code,                                        " & _
        " EmpAn4_Code,                                        " & _
        " EmpAn5_Code,                                        " & _
        " Uni_Code,                                           " & _
        " Cou_Code,                                           " & _
        " EmpPos_Code,                                        " & _
        " Sic_Code,                                           " & _
        " EmpCmm_Code,                                        " & _
        " PayUni_Code,                                        " & _
        " Emp_PeriodUnits,                                    " & _
        " Emp_AnnualUnits,                                    " & _
        " Cur_Code,                                           " & _
        " PmtMth_Code,                                        " & _
        " Bnk_Code,                                           " & _
        " Emp_BankAccount,                                    " & _
        " Bnk_CodeCo,                                         " & _
        " Emp_BankAccountCo,                                  " & _
        " Emp_StartDate,                                      " & _
        " Emp_TerminateDate,                                  " & _
        " Emp_OtherIncome1,                                   " & _
        " Emp_OtherIncome2,                                   " & _
        " Emp_OtherIncome3,                                   " & _
        " Emp_PreviousEarnings,                               " & _
        " Emp_PrevSIDeduct,                                   " & _
        " Emp_PrevSIContribute,                               " & _
        " Emp_PrevITDeduct,                                   " & _
        " Emp_PrevPFDeduct, " & _
        " ProFnd_Code," & _
        " MedFnd_Code," & _
        " SocInc_Code," & _
        " Ind_Code," & _
        " Une_Code," & _
        " SocCoh_Code," & _
        " Emp_CreationDate,                                   " & _
        " Emp_CreatedBy,                                      " & _
        " Emp_AmendDate,                                      " & _
        " Emp_AmendBy ,                                        " & _
        " IntTem_Code," & _
        " Emp_GLAnal1," & _
        " Emp_GLAnal2," & _
        " Emp_GLAnal3," & _
        " Emp_GLAnal4," & _
        " IntTem_PFCode," & _
        " IntTem_MFCode," & _
        " Emp_PensionNo," & _
        " Emp_DrivingLicense," & _
        " Emp_HasSI," & _
        " Emp_Pensiontype," & _
        " Emp_MyPayslipReport," & _
        " Emp_IBAN," & _
        " Emp_PreviousLifeIns," & _
        " Emp_PreviousDis," & _
        " Emp_PreviousST," & _
        " Emp_OtherIncome4," & _
        " SecPay_Code," & _
        " ComRat_Code," & _
        " PerBon_Code," & _
        " DutHou_Code," & _
        " FliHou_Code," & _
        " Emp_PassFullName," & _
        " Emp_TravelDocs," & _
        " Emp_FirstEmployment," & _
        " OveLay_Code, " & _
        " Emp_Password, " & _
        " Emp_Splitemployement " & _
        " " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @Emp_Status,                                         " & _
        " @PayTyp_Code,                                        " & _
        " @TemGrp_Code,                                        " & _
        " @EmpSta_Code,                                        " & _
        " @Emp_Title,                                          " & _
        " @Emp_LastName,                                       " & _
        " @Emp_FirstName,                                      " & _
        " @Emp_FullName,                                       " & _
        " @Emp_Sex,                                            " & _
        " @Emp_BirthDate,                                      " & _
        " @MarSta_Code,                                        " & _
        " @Emp_Address1,                                       " & _
        " @Emp_Address2,                                       " & _
        " @Emp_Address3,                                       " & _
        " @Emp_PostCode,                                       " & _
        " @Emp_Telephone1,                                     " & _
        " @Emp_Telephone2,                                     " & _
        " @Emp_Email,                                          " & _
        " @Emp_SocialInsNumber,                                " & _
        " @ComSin_EmpSocialInsNo,                              " & _
        " @Emp_IdentificationCard,                             " & _
        " @Emp_TaxID,                                          " & _
        " @Emp_PassportNumber,                                 " & _
        " @Emp_AlienNumber,                                    " & _
        " @TicTyp_Code,                                        " & _
        " @EmpAn1_Code,                                        " & _
        " @EmpAn2_Code,                                        " & _
        " @EmpAn3_Code,                                        " & _
        " @EmpAn4_Code,                                        " & _
        " @EmpAn5_Code,                                        " & _
        " @Uni_Code,                                           " & _
        " @Cou_Code,                                           " & _
        " @EmpPos_Code,                                        " & _
        " @Sic_Code,                                           " & _
        " @EmpCmm_Code,                                        " & _
        " @PayUni_Code,                                        " & _
        " @Emp_PeriodUnits,                                    " & _
        " @Emp_AnnualUnits,                                    " & _
        " @Cur_Code,                                           " & _
        " @PmtMth_Code,                                        " & _
        " @Bnk_Code,                                           " & _
        " @Emp_BankAccount,                                    " & _
        " @Bnk_CodeCo,                                         " & _
        " @Emp_BankAccountCo,                                  " & _
        " @Emp_StartDate,                                      " & _
        " @Emp_TerminateDate,                                  " & _
        " @Emp_OtherIncome1,                                   " & _
        " @Emp_OtherIncome2,                                   " & _
        " @Emp_OtherIncome3,                                   " & _
        " @Emp_PreviousEarnings,                               " & _
        " @Emp_PrevSIDeduct,                                   " & _
        " @Emp_PrevSIContribute,                               " & _
        " @Emp_PrevITDeduct,                                   " & _
        " @Emp_PrevPFDeduct,                                   " & _
        " @ProFnd_Code," & _
        " @MedFnd_Code," & _
        " @SocInc_Code," & _
        " @Ind_Code," & _
        " @Une_Code," & _
        " @SocCoh_Code," & _
        " @Emp_CreationDate,                                   " & _
        " @Emp_CreatedBy,                                      " & _
        " @Emp_AmendDate,                                      " & _
        " @Emp_AmendBy,                                         " & _
        " @IntTem_Code," & _
        " @Emp_GLAnal1," & _
        " @Emp_GLAnal2," & _
        " @Emp_GLAnal3," & _
        " @Emp_GLAnal4," & _
        " @IntTem_PFCode," & _
        " @IntTem_MFCode," & _
        " @Emp_PensionNo," & _
        " @Emp_DrivingLicense," & _
        " @Emp_HasSI," & _
        " @Emp_Pensiontype," & _
        " @Emp_MyPayslipReport," & _
        " @Emp_IBAN," & _
        " @Emp_PreviousLifeIns," & _
        " @Emp_PreviousDis," & _
        " @Emp_PreviousST," & _
        " @Emp_OtherIncome4," & _
        " @SecPay_Code," & _
        " @ComRat_Code," & _
        " @PerBon_Code," & _
        " @DutHou_Code," & _
        " @FliHou_Code," & _
        " @Emp_PassFullName," & _
        " @Emp_TravelDocs," & _
        " @Emp_FirstEmployment," & _
        " @OveLay_Code, " & _
        " @Emp_Password, " & _
        " @Emp_Splitemployement " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrMsEmployees" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     Emp_Status=@Emp_Status,                               " & _
        "    PayTyp_Code=@PayTyp_Code,                             " & _
        "    TemGrp_Code=@TemGrp_Code,                             " & _
        "    EmpSta_Code=@EmpSta_Code,                             " & _
        "    Emp_Title=@Emp_Title,                                 " & _
        "    Emp_LastName=@Emp_LastName,                           " & _
        "    Emp_FirstName=@Emp_FirstName,                         " & _
        "    Emp_FullName=@Emp_FullName,                           " & _
        "    Emp_Sex=@Emp_Sex,                                     " & _
        "    Emp_BirthDate=@Emp_BirthDate,                         " & _
        "    MarSta_Code=@MarSta_Code,                             " & _
        "    Emp_Address1=@Emp_Address1,                           " & _
        "    Emp_Address2=@Emp_Address2,                           " & _
        "    Emp_Address3=@Emp_Address3,                           " & _
        "    Emp_PostCode=@Emp_PostCode,                           " & _
        "    Emp_Telephone1=@Emp_Telephone1,                       " & _
        "    Emp_Telephone2=@Emp_Telephone2,                       " & _
        "    Emp_Email=@Emp_Email,                                 " & _
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " & _
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " & _
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " & _
        "   Emp_TaxID=@Emp_TaxID,                                 " & _
        "   Emp_PassportNumber=@Emp_PassportNumber,               " & _
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " & _
        "  TicTyp_Code=@TicTyp_Code,                             " & _
        "  EmpAn1_Code=@EmpAn1_Code,                             " & _
        "  EmpAn2_Code=@EmpAn2_Code,                             " & _
        "  EmpAn3_Code=@EmpAn3_Code,                             " & _
        " EmpAn4_Code=@EmpAn4_Code,                             " & _
        " EmpAn5_Code=@EmpAn5_Code,                             " & _
        " Uni_Code=@Uni_Code,                                   " & _
        " Cou_Code=@Cou_Code,                                   " & _
        " EmpPos_Code=@EmpPos_Code,                             " & _
        " Sic_Code=@Sic_Code,                                   " & _
        " EmpCmm_Code=@EmpCmm_Code,                             " & _
        " PayUni_Code=@PayUni_Code,                             " & _
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " & _
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " & _
        " Cur_Code=@Cur_Code,                                   " & _
        " PmtMth_Code=@PmtMth_Code,                             " & _
        " Bnk_Code=@Bnk_Code,                                   " & _
        " Emp_BankAccount=@Emp_BankAccount,                     " & _
        " Bnk_CodeCo=@Bnk_CodeCo,                               " & _
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " & _
        " Emp_StartDate=@Emp_StartDate,                         " & _
        " Emp_TerminateDate=@Emp_TerminateDate,                 " & _
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " & _
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " & _
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " & _
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " & _
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " & _
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " & _
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " & _
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " & _
        " ProFnd_Code=@ProFnd_Code," & _
        " MedFnd_Code=@MedFnd_Code," & _
        " SocInc_Code=@SocInc_Code," & _
        " Ind_Code=@Ind_Code," & _
        " Une_Code=@Une_Code," & _
        " SocCoh_Code=@SocCoh_Code," & _
        " Emp_CreationDate=@Emp_CreationDate,                   " & _
        " Emp_CreatedBy=@Emp_CreatedBy,                         " & _
        " Emp_AmendDate=@Emp_AmendDate,                         " & _
        " Emp_AmendBy=@Emp_AmendBy,                              " & _
        " IntTem_Code=@IntTem_Code," & _
        " Emp_GLAnal1=@Emp_GLAnal1," & _
        " Emp_GLAnal2=@Emp_GLAnal2," & _
        " Emp_GLAnal3=@Emp_GLAnal3," & _
        " Emp_GLAnal4=@Emp_GLAnal4," & _
        " IntTem_PFCode=@IntTem_PFCode," & _
        " IntTem_MFCode=@IntTem_MFCode," & _
        " Emp_PensionNo=@Emp_PensionNo," & _
        " Emp_DrivingLicense=@Emp_DrivingLicense," & _
        " Emp_HasSI=@Emp_HasSI," & _
        " Emp_Pensiontype=@Emp_Pensiontype," & _
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," & _
        " Emp_IBAN=@Emp_IBAN," & _
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," & _
        " Emp_PreviousDis=@Emp_PreviousDis," & _
        " Emp_PreviousST=@Emp_PreviousST," & _
        " Emp_OtherIncome4=@Emp_OtherIncome4," & _
        " SecPay_Code=@SecPay_Code," & _
        " ComRat_Code=@ComRat_Code," & _
        " PerBon_Code=@PerBon_Code," & _
        " DutHou_Code=@DutHou_Code," & _
        " FliHou_Code=@FliHou_Code," & _
        " Emp_PassFullName=@Emp_PassFullName," & _
        " Emp_TravelDocs=@Emp_TravelDocs," & _
        " Emp_FirstEmployment =@Emp_FirstEmployment," & _
        " OveLay_Code = @OveLay_Code, " & _
        " Emp_Password = @Emp_Password, " & _
        " Emp_Splitemployement = @Emp_Splitemployement " & _
        " WHERE Emp_Code = @Emp_Code" & _
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True

    End Function
    Protected Function Upgrade2017_D()
        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " & _
        " ADD [Emp_NewEmployee] [char](1) NULL"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        Str = "update PrMsEmployees " & _
               " set Emp_NewEmployee='0'"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("set All Values to zero", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set values to zero", MsgBoxStyle.Critical)
        End If

        ' Alter SPs

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" & _
        " @Emp_Code varchar(16)," & _
        " @Emp_Status char(1)," & _
        " @PayTyp_Code varchar(4)," & _
        " @TemGrp_Code varchar(6)," & _
        " @EmpSta_Code char(1)," & _
        " @Emp_Title char(4)," & _
        " @Emp_LastName varchar(30)," & _
        " @Emp_FirstName varchar(30)," & _
        " @Emp_FullName varchar(60)," & _
        " @Emp_Sex char(1)," & _
        " @Emp_BirthDate smalldatetime," & _
        " @MarSta_Code char(1)," & _
        " @Emp_Address1 varchar(30)," & _
        " @Emp_Address2 varchar(30)," & _
        " @Emp_Address3 varchar(30)," & _
        " @Emp_PostCode varchar(30)," & _
        " @Emp_Telephone1 varchar(20)," & _
        " @Emp_Telephone2 varchar(20)," & _
        " @Emp_Email varchar(50)," & _
        " @Emp_SocialInsNumber varchar(20)," & _
        " @ComSin_EmpSocialInsNo varchar(20)," & _
        " @Emp_IdentificationCard varchar(10)," & _
        " @Emp_TaxID varchar(10)," & _
        " @Emp_PassportNumber varchar(10)," & _
        " @Emp_AlienNumber varchar(10)," & _
        " @TicTyp_Code char(1)," & _
        " @EmpAn1_Code varchar(12)," & _
        " @EmpAn2_Code varchar(12)," & _
        " @EmpAn3_Code varchar(12)," & _
        " @EmpAn4_Code varchar(12)," & _
        " @EmpAn5_Code varchar(12)," & _
        " @Uni_Code varchar(12)," & _
        " @Cou_Code char(2)," & _
        " @EmpPos_Code varchar(12)," & _
        " @Sic_Code varchar(4)," & _
        " @EmpCmm_Code varchar(4)," & _
        " @PayUni_Code varchar(4)," & _
        " @Emp_PeriodUnits int," & _
        " @Emp_AnnualUnits int," & _
        " @Cur_Code char(3)," & _
        " @PmtMth_Code varchar(4)," & _
        " @Bnk_Code varchar(12)," & _
        " @Emp_BankAccount varchar(30)," & _
        " @Bnk_CodeCo varchar(12)," & _
        " @Emp_BankAccountCo varchar(30)," & _
        " @Emp_StartDate smalldatetime," & _
        " @Emp_TerminateDate varchar(10)," & _
        " @Emp_OtherIncome1 decimal(8,2)," & _
        " @Emp_OtherIncome2 decimal(8,2)," & _
        " @Emp_OtherIncome3 decimal(8,2)," & _
        " @Emp_PreviousEarnings decimal(8,2)," & _
        " @Emp_PrevSIDeduct decimal(8,2)," & _
        " @Emp_PrevSIContribute decimal(8,2)," & _
        " @Emp_PrevITDeduct decimal(8,2)," & _
        " @Emp_PrevPFDeduct decimal(8,2)," & _
        " @ProFnd_Code varchar(4)," & _
        " @MedFnd_Code varchar(4)," & _
        " @SocInc_Code varchar(4)," & _
        " @Ind_Code varchar(4)," & _
        " @Une_Code varchar(4)," & _
        " @SocCoh_Code varchar(4)," & _
        " @Emp_CreationDate smalldatetime," & _
        " @Emp_CreatedBy int," & _
        " @Emp_AmendDate smalldatetime," & _
        " @Emp_AmendBy int," & _
        " @IntTem_Code varchar(6)," & _
        " @Emp_GLAnal1 varchar(12)," & _
        " @Emp_GLAnal2 varchar(12)," & _
        " @Emp_GLAnal3 varchar(12)," & _
        " @Emp_GLAnal4 varchar(12)," & _
        " @IntTem_PFCode varchar(6)," & _
        " @IntTem_MFCode varchar(6)," & _
        " @Emp_PensionNo varchar(7)," & _
        " @Emp_DrivingLicense varchar(20)," & _
        " @Emp_HasSI int," & _
        " @Emp_Pensiontype int," & _
        " @Emp_MyPayslipReport varchar(50)," & _
        " @Emp_IBAN varchar(40)," & _
        " @Emp_PreviousLifeIns decimal(18,2)," & _
        " @Emp_PreviousDis decimal(18,2)," & _
        " @Emp_PreviousST decimal(18,2)," & _
        " @Emp_OtherIncome4 decimal(18,2)," & _
        " @SecPay_Code varchar(4)," & _
        " @ComRat_Code varchar(4)," & _
        " @PerBon_Code varchar(4)," & _
        " @DutHou_Code varchar(4)," & _
        " @FliHou_Code varchar(4)," & _
        " @Emp_PassFullName varchar(100)," & _
        " @Emp_TravelDocs varchar(100)," & _
        " @Emp_FirstEmployment varchar(1)," & _
        " @OveLay_Code varchar(4)," & _
        " @Emp_Password varchar(20)," & _
        " @Emp_Splitemployement char(1), " & _
        " @Emp_NewEmployee char(1) " & _
        " " & _
        " AS" & _
        " DECLARE @Result as Int" & _
        "   Set @Result = 0" & _
        "   SELECT @Result = Count(*)" & _
        "   FROM PrMsEmployees" & _
        "   WHERE Emp_Code = @Emp_Code" & _
        "   IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        " INSERT INTO PrMsEmployees" & _
        " (Emp_Code,                                           " & _
        " Emp_Status,                                         " & _
        " PayTyp_Code,                                        " & _
        " TemGrp_Code,                                        " & _
        " EmpSta_Code,                                        " & _
        " Emp_Title,                                          " & _
        " Emp_LastName,                                       " & _
        " Emp_FirstName,                                      " & _
        " Emp_FullName,                                       " & _
        " Emp_Sex,                                            " & _
        " Emp_BirthDate,                                      " & _
        " MarSta_Code,                                        " & _
        " Emp_Address1,                                       " & _
        " Emp_Address2,                                       " & _
        " Emp_Address3,                                       " & _
        " Emp_PostCode,                                       " & _
        " Emp_Telephone1,                                     " & _
        " Emp_Telephone2,                                     " & _
        " Emp_Email,                                          " & _
        " Emp_SocialInsNumber,                                " & _
        " ComSin_EmpSocialInsNo,                              " & _
        " Emp_IdentificationCard,                             " & _
        " Emp_TaxID,                                          " & _
        " Emp_PassportNumber,                                 " & _
        " Emp_AlienNumber,                                    " & _
        " TicTyp_Code,                                        " & _
        " EmpAn1_Code,                                        " & _
        " EmpAn2_Code,                                        " & _
        " EmpAn3_Code,                                        " & _
        " EmpAn4_Code,                                        " & _
        " EmpAn5_Code,                                        " & _
        " Uni_Code,                                           " & _
        " Cou_Code,                                           " & _
        " EmpPos_Code,                                        " & _
        " Sic_Code,                                           " & _
        " EmpCmm_Code,                                        " & _
        " PayUni_Code,                                        " & _
        " Emp_PeriodUnits,                                    " & _
        " Emp_AnnualUnits,                                    " & _
        " Cur_Code,                                           " & _
        " PmtMth_Code,                                        " & _
        " Bnk_Code,                                           " & _
        " Emp_BankAccount,                                    " & _
        " Bnk_CodeCo,                                         " & _
        " Emp_BankAccountCo,                                  " & _
        " Emp_StartDate,                                      " & _
        " Emp_TerminateDate,                                  " & _
        " Emp_OtherIncome1,                                   " & _
        " Emp_OtherIncome2,                                   " & _
        " Emp_OtherIncome3,                                   " & _
        " Emp_PreviousEarnings,                               " & _
        " Emp_PrevSIDeduct,                                   " & _
        " Emp_PrevSIContribute,                               " & _
        " Emp_PrevITDeduct,                                   " & _
        " Emp_PrevPFDeduct, " & _
        " ProFnd_Code," & _
        " MedFnd_Code," & _
        " SocInc_Code," & _
        " Ind_Code," & _
        " Une_Code," & _
        " SocCoh_Code," & _
        " Emp_CreationDate,                                   " & _
        " Emp_CreatedBy,                                      " & _
        " Emp_AmendDate,                                      " & _
        " Emp_AmendBy ,                                        " & _
        " IntTem_Code," & _
        " Emp_GLAnal1," & _
        " Emp_GLAnal2," & _
        " Emp_GLAnal3," & _
        " Emp_GLAnal4," & _
        " IntTem_PFCode," & _
        " IntTem_MFCode," & _
        " Emp_PensionNo," & _
        " Emp_DrivingLicense," & _
        " Emp_HasSI," & _
        " Emp_Pensiontype," & _
        " Emp_MyPayslipReport," & _
        " Emp_IBAN," & _
        " Emp_PreviousLifeIns," & _
        " Emp_PreviousDis," & _
        " Emp_PreviousST," & _
        " Emp_OtherIncome4," & _
        " SecPay_Code," & _
        " ComRat_Code," & _
        " PerBon_Code," & _
        " DutHou_Code," & _
        " FliHou_Code," & _
        " Emp_PassFullName," & _
        " Emp_TravelDocs," & _
        " Emp_FirstEmployment," & _
        " OveLay_Code, " & _
        " Emp_Password, " & _
        " Emp_Splitemployement, " & _
        " Emp_NewEmployee " & _
        " " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @Emp_Status,                                         " & _
        " @PayTyp_Code,                                        " & _
        " @TemGrp_Code,                                        " & _
        " @EmpSta_Code,                                        " & _
        " @Emp_Title,                                          " & _
        " @Emp_LastName,                                       " & _
        " @Emp_FirstName,                                      " & _
        " @Emp_FullName,                                       " & _
        " @Emp_Sex,                                            " & _
        " @Emp_BirthDate,                                      " & _
        " @MarSta_Code,                                        " & _
        " @Emp_Address1,                                       " & _
        " @Emp_Address2,                                       " & _
        " @Emp_Address3,                                       " & _
        " @Emp_PostCode,                                       " & _
        " @Emp_Telephone1,                                     " & _
        " @Emp_Telephone2,                                     " & _
        " @Emp_Email,                                          " & _
        " @Emp_SocialInsNumber,                                " & _
        " @ComSin_EmpSocialInsNo,                              " & _
        " @Emp_IdentificationCard,                             " & _
        " @Emp_TaxID,                                          " & _
        " @Emp_PassportNumber,                                 " & _
        " @Emp_AlienNumber,                                    " & _
        " @TicTyp_Code,                                        " & _
        " @EmpAn1_Code,                                        " & _
        " @EmpAn2_Code,                                        " & _
        " @EmpAn3_Code,                                        " & _
        " @EmpAn4_Code,                                        " & _
        " @EmpAn5_Code,                                        " & _
        " @Uni_Code,                                           " & _
        " @Cou_Code,                                           " & _
        " @EmpPos_Code,                                        " & _
        " @Sic_Code,                                           " & _
        " @EmpCmm_Code,                                        " & _
        " @PayUni_Code,                                        " & _
        " @Emp_PeriodUnits,                                    " & _
        " @Emp_AnnualUnits,                                    " & _
        " @Cur_Code,                                           " & _
        " @PmtMth_Code,                                        " & _
        " @Bnk_Code,                                           " & _
        " @Emp_BankAccount,                                    " & _
        " @Bnk_CodeCo,                                         " & _
        " @Emp_BankAccountCo,                                  " & _
        " @Emp_StartDate,                                      " & _
        " @Emp_TerminateDate,                                  " & _
        " @Emp_OtherIncome1,                                   " & _
        " @Emp_OtherIncome2,                                   " & _
        " @Emp_OtherIncome3,                                   " & _
        " @Emp_PreviousEarnings,                               " & _
        " @Emp_PrevSIDeduct,                                   " & _
        " @Emp_PrevSIContribute,                               " & _
        " @Emp_PrevITDeduct,                                   " & _
        " @Emp_PrevPFDeduct,                                   " & _
        " @ProFnd_Code," & _
        " @MedFnd_Code," & _
        " @SocInc_Code," & _
        " @Ind_Code," & _
        " @Une_Code," & _
        " @SocCoh_Code," & _
        " @Emp_CreationDate,                                   " & _
        " @Emp_CreatedBy,                                      " & _
        " @Emp_AmendDate,                                      " & _
        " @Emp_AmendBy,                                         " & _
        " @IntTem_Code," & _
        " @Emp_GLAnal1," & _
        " @Emp_GLAnal2," & _
        " @Emp_GLAnal3," & _
        " @Emp_GLAnal4," & _
        " @IntTem_PFCode," & _
        " @IntTem_MFCode," & _
        " @Emp_PensionNo," & _
        " @Emp_DrivingLicense," & _
        " @Emp_HasSI," & _
        " @Emp_Pensiontype," & _
        " @Emp_MyPayslipReport," & _
        " @Emp_IBAN," & _
        " @Emp_PreviousLifeIns," & _
        " @Emp_PreviousDis," & _
        " @Emp_PreviousST," & _
        " @Emp_OtherIncome4," & _
        " @SecPay_Code," & _
        " @ComRat_Code," & _
        " @PerBon_Code," & _
        " @DutHou_Code," & _
        " @FliHou_Code," & _
        " @Emp_PassFullName," & _
        " @Emp_TravelDocs," & _
        " @Emp_FirstEmployment," & _
        " @OveLay_Code, " & _
        " @Emp_Password, " & _
        " @Emp_Splitemployement, " & _
        " @Emp_NewEmployee " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrMsEmployees" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     Emp_Status=@Emp_Status,                               " & _
        "    PayTyp_Code=@PayTyp_Code,                             " & _
        "    TemGrp_Code=@TemGrp_Code,                             " & _
        "    EmpSta_Code=@EmpSta_Code,                             " & _
        "    Emp_Title=@Emp_Title,                                 " & _
        "    Emp_LastName=@Emp_LastName,                           " & _
        "    Emp_FirstName=@Emp_FirstName,                         " & _
        "    Emp_FullName=@Emp_FullName,                           " & _
        "    Emp_Sex=@Emp_Sex,                                     " & _
        "    Emp_BirthDate=@Emp_BirthDate,                         " & _
        "    MarSta_Code=@MarSta_Code,                             " & _
        "    Emp_Address1=@Emp_Address1,                           " & _
        "    Emp_Address2=@Emp_Address2,                           " & _
        "    Emp_Address3=@Emp_Address3,                           " & _
        "    Emp_PostCode=@Emp_PostCode,                           " & _
        "    Emp_Telephone1=@Emp_Telephone1,                       " & _
        "    Emp_Telephone2=@Emp_Telephone2,                       " & _
        "    Emp_Email=@Emp_Email,                                 " & _
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " & _
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " & _
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " & _
        "   Emp_TaxID=@Emp_TaxID,                                 " & _
        "   Emp_PassportNumber=@Emp_PassportNumber,               " & _
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " & _
        "  TicTyp_Code=@TicTyp_Code,                             " & _
        "  EmpAn1_Code=@EmpAn1_Code,                             " & _
        "  EmpAn2_Code=@EmpAn2_Code,                             " & _
        "  EmpAn3_Code=@EmpAn3_Code,                             " & _
        " EmpAn4_Code=@EmpAn4_Code,                             " & _
        " EmpAn5_Code=@EmpAn5_Code,                             " & _
        " Uni_Code=@Uni_Code,                                   " & _
        " Cou_Code=@Cou_Code,                                   " & _
        " EmpPos_Code=@EmpPos_Code,                             " & _
        " Sic_Code=@Sic_Code,                                   " & _
        " EmpCmm_Code=@EmpCmm_Code,                             " & _
        " PayUni_Code=@PayUni_Code,                             " & _
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " & _
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " & _
        " Cur_Code=@Cur_Code,                                   " & _
        " PmtMth_Code=@PmtMth_Code,                             " & _
        " Bnk_Code=@Bnk_Code,                                   " & _
        " Emp_BankAccount=@Emp_BankAccount,                     " & _
        " Bnk_CodeCo=@Bnk_CodeCo,                               " & _
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " & _
        " Emp_StartDate=@Emp_StartDate,                         " & _
        " Emp_TerminateDate=@Emp_TerminateDate,                 " & _
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " & _
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " & _
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " & _
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " & _
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " & _
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " & _
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " & _
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " & _
        " ProFnd_Code=@ProFnd_Code," & _
        " MedFnd_Code=@MedFnd_Code," & _
        " SocInc_Code=@SocInc_Code," & _
        " Ind_Code=@Ind_Code," & _
        " Une_Code=@Une_Code," & _
        " SocCoh_Code=@SocCoh_Code," & _
        " Emp_CreationDate=@Emp_CreationDate,                   " & _
        " Emp_CreatedBy=@Emp_CreatedBy,                         " & _
        " Emp_AmendDate=@Emp_AmendDate,                         " & _
        " Emp_AmendBy=@Emp_AmendBy,                              " & _
        " IntTem_Code=@IntTem_Code," & _
        " Emp_GLAnal1=@Emp_GLAnal1," & _
        " Emp_GLAnal2=@Emp_GLAnal2," & _
        " Emp_GLAnal3=@Emp_GLAnal3," & _
        " Emp_GLAnal4=@Emp_GLAnal4," & _
        " IntTem_PFCode=@IntTem_PFCode," & _
        " IntTem_MFCode=@IntTem_MFCode," & _
        " Emp_PensionNo=@Emp_PensionNo," & _
        " Emp_DrivingLicense=@Emp_DrivingLicense," & _
        " Emp_HasSI=@Emp_HasSI," & _
        " Emp_Pensiontype=@Emp_Pensiontype," & _
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," & _
        " Emp_IBAN=@Emp_IBAN," & _
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," & _
        " Emp_PreviousDis=@Emp_PreviousDis," & _
        " Emp_PreviousST=@Emp_PreviousST," & _
        " Emp_OtherIncome4=@Emp_OtherIncome4," & _
        " SecPay_Code=@SecPay_Code," & _
        " ComRat_Code=@ComRat_Code," & _
        " PerBon_Code=@PerBon_Code," & _
        " DutHou_Code=@DutHou_Code," & _
        " FliHou_Code=@FliHou_Code," & _
        " Emp_PassFullName=@Emp_PassFullName," & _
        " Emp_TravelDocs=@Emp_TravelDocs," & _
        " Emp_FirstEmployment =@Emp_FirstEmployment," & _
        " OveLay_Code = @OveLay_Code, " & _
        " Emp_Password = @Emp_Password, " & _
        " Emp_Splitemployement = @Emp_Splitemployement, " & _
        " Emp_NewEmployee = @Emp_NewEmployee " & _
        " WHERE Emp_Code = @Emp_Code" & _
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True

    End Function
    Protected Function Upgrade2017_G()
        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " & _
        " ADD [Emp_Force50Percent] [char](1) NULL"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        Str = "update PrMsEmployees " & _
               " set Emp_Force50Percent='0'"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("set All Values to zero", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set values to zero", MsgBoxStyle.Critical)
        End If

        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" & _
        " @Emp_Code varchar(16)," & _
        " @Emp_Status char(1)," & _
        " @PayTyp_Code varchar(4)," & _
        " @TemGrp_Code varchar(6)," & _
        " @EmpSta_Code char(1)," & _
        " @Emp_Title char(4)," & _
        " @Emp_LastName nvarchar(30)," & _
        " @Emp_FirstName nvarchar(30)," & _
        " @Emp_FullName nvarchar(60)," & _
        " @Emp_Sex char(1)," & _
        " @Emp_BirthDate smalldatetime," & _
        " @MarSta_Code char(1)," & _
        " @Emp_Address1 varchar(30)," & _
        " @Emp_Address2 varchar(30)," & _
        " @Emp_Address3 varchar(30)," & _
        " @Emp_PostCode varchar(30)," & _
        " @Emp_Telephone1 varchar(20)," & _
        " @Emp_Telephone2 varchar(20)," & _
        " @Emp_Email varchar(50)," & _
        " @Emp_SocialInsNumber varchar(20)," & _
        " @ComSin_EmpSocialInsNo varchar(20)," & _
        " @Emp_IdentificationCard varchar(10)," & _
        " @Emp_TaxID varchar(10)," & _
        " @Emp_PassportNumber varchar(10)," & _
        " @Emp_AlienNumber varchar(10)," & _
        " @TicTyp_Code char(1)," & _
        " @EmpAn1_Code varchar(12)," & _
        " @EmpAn2_Code varchar(12)," & _
        " @EmpAn3_Code varchar(12)," & _
        " @EmpAn4_Code varchar(12)," & _
        " @EmpAn5_Code varchar(12)," & _
        " @Uni_Code varchar(12)," & _
        " @Cou_Code char(2)," & _
        " @EmpPos_Code varchar(12)," & _
        " @Sic_Code varchar(4)," & _
        " @EmpCmm_Code varchar(4)," & _
        " @PayUni_Code varchar(4)," & _
        " @Emp_PeriodUnits int," & _
        " @Emp_AnnualUnits int," & _
        " @Cur_Code char(3)," & _
        " @PmtMth_Code varchar(4)," & _
        " @Bnk_Code varchar(12)," & _
        " @Emp_BankAccount varchar(30)," & _
        " @Bnk_CodeCo varchar(12)," & _
        " @Emp_BankAccountCo varchar(30)," & _
        " @Emp_StartDate smalldatetime," & _
        " @Emp_TerminateDate varchar(10)," & _
        " @Emp_OtherIncome1 decimal(8,2)," & _
        " @Emp_OtherIncome2 decimal(8,2)," & _
        " @Emp_OtherIncome3 decimal(8,2)," & _
        " @Emp_PreviousEarnings decimal(8,2)," & _
        " @Emp_PrevSIDeduct decimal(8,2)," & _
        " @Emp_PrevSIContribute decimal(8,2)," & _
        " @Emp_PrevITDeduct decimal(8,2)," & _
        " @Emp_PrevPFDeduct decimal(8,2)," & _
        " @ProFnd_Code varchar(4)," & _
        " @MedFnd_Code varchar(4)," & _
        " @SocInc_Code varchar(4)," & _
        " @Ind_Code varchar(4)," & _
        " @Une_Code varchar(4)," & _
        " @SocCoh_Code varchar(4)," & _
        " @Emp_CreationDate smalldatetime," & _
        " @Emp_CreatedBy int," & _
        " @Emp_AmendDate smalldatetime," & _
        " @Emp_AmendBy int," & _
        " @IntTem_Code varchar(6)," & _
        " @Emp_GLAnal1 varchar(12)," & _
        " @Emp_GLAnal2 varchar(12)," & _
        " @Emp_GLAnal3 varchar(12)," & _
        " @Emp_GLAnal4 varchar(12)," & _
        " @IntTem_PFCode varchar(6)," & _
        " @IntTem_MFCode varchar(6)," & _
        " @Emp_PensionNo varchar(7)," & _
        " @Emp_DrivingLicense varchar(20)," & _
        " @Emp_HasSI int," & _
        " @Emp_Pensiontype int," & _
        " @Emp_MyPayslipReport varchar(50)," & _
        " @Emp_IBAN varchar(40)," & _
        " @Emp_PreviousLifeIns decimal(18,2)," & _
        " @Emp_PreviousDis decimal(18,2)," & _
        " @Emp_PreviousST decimal(18,2)," & _
        " @Emp_OtherIncome4 decimal(18,2)," & _
        " @SecPay_Code varchar(4)," & _
        " @ComRat_Code varchar(4)," & _
        " @PerBon_Code varchar(4)," & _
        " @DutHou_Code varchar(4)," & _
        " @FliHou_Code varchar(4)," & _
        " @Emp_PassFullName varchar(100)," & _
        " @Emp_TravelDocs varchar(100)," & _
        " @Emp_FirstEmployment varchar(1)," & _
        " @OveLay_Code varchar(4)," & _
        " @Emp_Password varchar(20)," & _
        " @Emp_Splitemployement char(1), " & _
        " @Emp_NewEmployee char(1), " & _
        " @Emp_Force50Percent char(1) " & _
        " " & _
        " AS" & _
        " DECLARE @Result as Int" & _
        "   Set @Result = 0" & _
        "   SELECT @Result = Count(*)" & _
        "   FROM PrMsEmployees" & _
        "   WHERE Emp_Code = @Emp_Code" & _
        "   IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        " INSERT INTO PrMsEmployees" & _
        " (Emp_Code,                                           " & _
        " Emp_Status,                                         " & _
        " PayTyp_Code,                                        " & _
        " TemGrp_Code,                                        " & _
        " EmpSta_Code,                                        " & _
        " Emp_Title,                                          " & _
        " Emp_LastName,                                       " & _
        " Emp_FirstName,                                      " & _
        " Emp_FullName,                                       " & _
        " Emp_Sex,                                            " & _
        " Emp_BirthDate,                                      " & _
        " MarSta_Code,                                        " & _
        " Emp_Address1,                                       " & _
        " Emp_Address2,                                       " & _
        " Emp_Address3,                                       " & _
        " Emp_PostCode,                                       " & _
        " Emp_Telephone1,                                     " & _
        " Emp_Telephone2,                                     " & _
        " Emp_Email,                                          " & _
        " Emp_SocialInsNumber,                                " & _
        " ComSin_EmpSocialInsNo,                              " & _
        " Emp_IdentificationCard,                             " & _
        " Emp_TaxID,                                          " & _
        " Emp_PassportNumber,                                 " & _
        " Emp_AlienNumber,                                    " & _
        " TicTyp_Code,                                        " & _
        " EmpAn1_Code,                                        " & _
        " EmpAn2_Code,                                        " & _
        " EmpAn3_Code,                                        " & _
        " EmpAn4_Code,                                        " & _
        " EmpAn5_Code,                                        " & _
        " Uni_Code,                                           " & _
        " Cou_Code,                                           " & _
        " EmpPos_Code,                                        " & _
        " Sic_Code,                                           " & _
        " EmpCmm_Code,                                        " & _
        " PayUni_Code,                                        " & _
        " Emp_PeriodUnits,                                    " & _
        " Emp_AnnualUnits,                                    " & _
        " Cur_Code,                                           " & _
        " PmtMth_Code,                                        " & _
        " Bnk_Code,                                           " & _
        " Emp_BankAccount,                                    " & _
        " Bnk_CodeCo,                                         " & _
        " Emp_BankAccountCo,                                  " & _
        " Emp_StartDate,                                      " & _
        " Emp_TerminateDate,                                  " & _
        " Emp_OtherIncome1,                                   " & _
        " Emp_OtherIncome2,                                   " & _
        " Emp_OtherIncome3,                                   " & _
        " Emp_PreviousEarnings,                               " & _
        " Emp_PrevSIDeduct,                                   " & _
        " Emp_PrevSIContribute,                               " & _
        " Emp_PrevITDeduct,                                   " & _
        " Emp_PrevPFDeduct, " & _
        " ProFnd_Code," & _
        " MedFnd_Code," & _
        " SocInc_Code," & _
        " Ind_Code," & _
        " Une_Code," & _
        " SocCoh_Code," & _
        " Emp_CreationDate,                                   " & _
        " Emp_CreatedBy,                                      " & _
        " Emp_AmendDate,                                      " & _
        " Emp_AmendBy ,                                        " & _
        " IntTem_Code," & _
        " Emp_GLAnal1," & _
        " Emp_GLAnal2," & _
        " Emp_GLAnal3," & _
        " Emp_GLAnal4," & _
        " IntTem_PFCode," & _
        " IntTem_MFCode," & _
        " Emp_PensionNo," & _
        " Emp_DrivingLicense," & _
        " Emp_HasSI," & _
        " Emp_Pensiontype," & _
        " Emp_MyPayslipReport," & _
        " Emp_IBAN," & _
        " Emp_PreviousLifeIns," & _
        " Emp_PreviousDis," & _
        " Emp_PreviousST," & _
        " Emp_OtherIncome4," & _
        " SecPay_Code," & _
        " ComRat_Code," & _
        " PerBon_Code," & _
        " DutHou_Code," & _
        " FliHou_Code," & _
        " Emp_PassFullName," & _
        " Emp_TravelDocs," & _
        " Emp_FirstEmployment," & _
        " OveLay_Code, " & _
        " Emp_Password, " & _
        " Emp_Splitemployement, " & _
        " Emp_NewEmployee, " & _
        " Emp_Force50Percent " & _
        " " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @Emp_Status,                                         " & _
        " @PayTyp_Code,                                        " & _
        " @TemGrp_Code,                                        " & _
        " @EmpSta_Code,                                        " & _
        " @Emp_Title,                                          " & _
        " @Emp_LastName,                                       " & _
        " @Emp_FirstName,                                      " & _
        " @Emp_FullName,                                       " & _
        " @Emp_Sex,                                            " & _
        " @Emp_BirthDate,                                      " & _
        " @MarSta_Code,                                        " & _
        " @Emp_Address1,                                       " & _
        " @Emp_Address2,                                       " & _
        " @Emp_Address3,                                       " & _
        " @Emp_PostCode,                                       " & _
        " @Emp_Telephone1,                                     " & _
        " @Emp_Telephone2,                                     " & _
        " @Emp_Email,                                          " & _
        " @Emp_SocialInsNumber,                                " & _
        " @ComSin_EmpSocialInsNo,                              " & _
        " @Emp_IdentificationCard,                             " & _
        " @Emp_TaxID,                                          " & _
        " @Emp_PassportNumber,                                 " & _
        " @Emp_AlienNumber,                                    " & _
        " @TicTyp_Code,                                        " & _
        " @EmpAn1_Code,                                        " & _
        " @EmpAn2_Code,                                        " & _
        " @EmpAn3_Code,                                        " & _
        " @EmpAn4_Code,                                        " & _
        " @EmpAn5_Code,                                        " & _
        " @Uni_Code,                                           " & _
        " @Cou_Code,                                           " & _
        " @EmpPos_Code,                                        " & _
        " @Sic_Code,                                           " & _
        " @EmpCmm_Code,                                        " & _
        " @PayUni_Code,                                        " & _
        " @Emp_PeriodUnits,                                    " & _
        " @Emp_AnnualUnits,                                    " & _
        " @Cur_Code,                                           " & _
        " @PmtMth_Code,                                        " & _
        " @Bnk_Code,                                           " & _
        " @Emp_BankAccount,                                    " & _
        " @Bnk_CodeCo,                                         " & _
        " @Emp_BankAccountCo,                                  " & _
        " @Emp_StartDate,                                      " & _
        " @Emp_TerminateDate,                                  " & _
        " @Emp_OtherIncome1,                                   " & _
        " @Emp_OtherIncome2,                                   " & _
        " @Emp_OtherIncome3,                                   " & _
        " @Emp_PreviousEarnings,                               " & _
        " @Emp_PrevSIDeduct,                                   " & _
        " @Emp_PrevSIContribute,                               " & _
        " @Emp_PrevITDeduct,                                   " & _
        " @Emp_PrevPFDeduct,                                   " & _
        " @ProFnd_Code," & _
        " @MedFnd_Code," & _
        " @SocInc_Code," & _
        " @Ind_Code," & _
        " @Une_Code," & _
        " @SocCoh_Code," & _
        " @Emp_CreationDate,                                   " & _
        " @Emp_CreatedBy,                                      " & _
        " @Emp_AmendDate,                                      " & _
        " @Emp_AmendBy,                                         " & _
        " @IntTem_Code," & _
        " @Emp_GLAnal1," & _
        " @Emp_GLAnal2," & _
        " @Emp_GLAnal3," & _
        " @Emp_GLAnal4," & _
        " @IntTem_PFCode," & _
        " @IntTem_MFCode," & _
        " @Emp_PensionNo," & _
        " @Emp_DrivingLicense," & _
        " @Emp_HasSI," & _
        " @Emp_Pensiontype," & _
        " @Emp_MyPayslipReport," & _
        " @Emp_IBAN," & _
        " @Emp_PreviousLifeIns," & _
        " @Emp_PreviousDis," & _
        " @Emp_PreviousST," & _
        " @Emp_OtherIncome4," & _
        " @SecPay_Code," & _
        " @ComRat_Code," & _
        " @PerBon_Code," & _
        " @DutHou_Code," & _
        " @FliHou_Code," & _
        " @Emp_PassFullName," & _
        " @Emp_TravelDocs," & _
        " @Emp_FirstEmployment," & _
        " @OveLay_Code, " & _
        " @Emp_Password, " & _
        " @Emp_Splitemployement, " & _
        " @Emp_NewEmployee, " & _
        " @Emp_Force50Percent " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrMsEmployees" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     Emp_Status=@Emp_Status,                               " & _
        "    PayTyp_Code=@PayTyp_Code,                             " & _
        "    TemGrp_Code=@TemGrp_Code,                             " & _
        "    EmpSta_Code=@EmpSta_Code,                             " & _
        "    Emp_Title=@Emp_Title,                                 " & _
        "    Emp_LastName=@Emp_LastName,                           " & _
        "    Emp_FirstName=@Emp_FirstName,                         " & _
        "    Emp_FullName=@Emp_FullName,                           " & _
        "    Emp_Sex=@Emp_Sex,                                     " & _
        "    Emp_BirthDate=@Emp_BirthDate,                         " & _
        "    MarSta_Code=@MarSta_Code,                             " & _
        "    Emp_Address1=@Emp_Address1,                           " & _
        "    Emp_Address2=@Emp_Address2,                           " & _
        "    Emp_Address3=@Emp_Address3,                           " & _
        "    Emp_PostCode=@Emp_PostCode,                           " & _
        "    Emp_Telephone1=@Emp_Telephone1,                       " & _
        "    Emp_Telephone2=@Emp_Telephone2,                       " & _
        "    Emp_Email=@Emp_Email,                                 " & _
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " & _
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " & _
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " & _
        "   Emp_TaxID=@Emp_TaxID,                                 " & _
        "   Emp_PassportNumber=@Emp_PassportNumber,               " & _
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " & _
        "  TicTyp_Code=@TicTyp_Code,                             " & _
        "  EmpAn1_Code=@EmpAn1_Code,                             " & _
        "  EmpAn2_Code=@EmpAn2_Code,                             " & _
        "  EmpAn3_Code=@EmpAn3_Code,                             " & _
        " EmpAn4_Code=@EmpAn4_Code,                             " & _
        " EmpAn5_Code=@EmpAn5_Code,                             " & _
        " Uni_Code=@Uni_Code,                                   " & _
        " Cou_Code=@Cou_Code,                                   " & _
        " EmpPos_Code=@EmpPos_Code,                             " & _
        " Sic_Code=@Sic_Code,                                   " & _
        " EmpCmm_Code=@EmpCmm_Code,                             " & _
        " PayUni_Code=@PayUni_Code,                             " & _
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " & _
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " & _
        " Cur_Code=@Cur_Code,                                   " & _
        " PmtMth_Code=@PmtMth_Code,                             " & _
        " Bnk_Code=@Bnk_Code,                                   " & _
        " Emp_BankAccount=@Emp_BankAccount,                     " & _
        " Bnk_CodeCo=@Bnk_CodeCo,                               " & _
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " & _
        " Emp_StartDate=@Emp_StartDate,                         " & _
        " Emp_TerminateDate=@Emp_TerminateDate,                 " & _
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " & _
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " & _
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " & _
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " & _
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " & _
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " & _
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " & _
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " & _
        " ProFnd_Code=@ProFnd_Code," & _
        " MedFnd_Code=@MedFnd_Code," & _
        " SocInc_Code=@SocInc_Code," & _
        " Ind_Code=@Ind_Code," & _
        " Une_Code=@Une_Code," & _
        " SocCoh_Code=@SocCoh_Code," & _
        " Emp_CreationDate=@Emp_CreationDate,                   " & _
        " Emp_CreatedBy=@Emp_CreatedBy,                         " & _
        " Emp_AmendDate=@Emp_AmendDate,                         " & _
        " Emp_AmendBy=@Emp_AmendBy,                              " & _
        " IntTem_Code=@IntTem_Code," & _
        " Emp_GLAnal1=@Emp_GLAnal1," & _
        " Emp_GLAnal2=@Emp_GLAnal2," & _
        " Emp_GLAnal3=@Emp_GLAnal3," & _
        " Emp_GLAnal4=@Emp_GLAnal4," & _
        " IntTem_PFCode=@IntTem_PFCode," & _
        " IntTem_MFCode=@IntTem_MFCode," & _
        " Emp_PensionNo=@Emp_PensionNo," & _
        " Emp_DrivingLicense=@Emp_DrivingLicense," & _
        " Emp_HasSI=@Emp_HasSI," & _
        " Emp_Pensiontype=@Emp_Pensiontype," & _
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," & _
        " Emp_IBAN=@Emp_IBAN," & _
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," & _
        " Emp_PreviousDis=@Emp_PreviousDis," & _
        " Emp_PreviousST=@Emp_PreviousST," & _
        " Emp_OtherIncome4=@Emp_OtherIncome4," & _
        " SecPay_Code=@SecPay_Code," & _
        " ComRat_Code=@ComRat_Code," & _
        " PerBon_Code=@PerBon_Code," & _
        " DutHou_Code=@DutHou_Code," & _
        " FliHou_Code=@FliHou_Code," & _
        " Emp_PassFullName=@Emp_PassFullName," & _
        " Emp_TravelDocs=@Emp_TravelDocs," & _
        " Emp_FirstEmployment =@Emp_FirstEmployment," & _
        " OveLay_Code = @OveLay_Code, " & _
        " Emp_Password = @Emp_Password, " & _
        " Emp_Splitemployement = @Emp_Splitemployement, " & _
        " Emp_NewEmployee = @Emp_NewEmployee, " & _
        " Emp_Force50Percent = @Emp_Force50Percent " & _
        " WHERE Emp_Code = @Emp_Code" & _
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True

    End Function
    Protected Function Upgrade2017_H()

        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " & _
        " ADD [Emp_Notes] [nvarchar](200) NULL"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        Str = "update PrMsEmployees " & _
               " set Emp_Notes=''"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("set All Values to ''", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set values to ''", MsgBoxStyle.Critical)
        End If

        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" & _
        " @Emp_Code varchar(16)," & _
        " @Emp_Status char(1)," & _
        " @PayTyp_Code varchar(4)," & _
        " @TemGrp_Code varchar(6)," & _
        " @EmpSta_Code char(1)," & _
        " @Emp_Title char(4)," & _
        " @Emp_LastName nvarchar(30)," & _
        " @Emp_FirstName nvarchar(30)," & _
        " @Emp_FullName nvarchar(60)," & _
        " @Emp_Sex char(1)," & _
        " @Emp_BirthDate smalldatetime," & _
        " @MarSta_Code char(1)," & _
        " @Emp_Address1 nvarchar(30)," & _
        " @Emp_Address2 nvarchar(30)," & _
        " @Emp_Address3 nvarchar(30)," & _
        " @Emp_PostCode varchar(30)," & _
        " @Emp_Telephone1 varchar(20)," & _
        " @Emp_Telephone2 varchar(20)," & _
        " @Emp_Email varchar(50)," & _
        " @Emp_SocialInsNumber varchar(20)," & _
        " @ComSin_EmpSocialInsNo varchar(20)," & _
        " @Emp_IdentificationCard varchar(10)," & _
        " @Emp_TaxID varchar(10)," & _
        " @Emp_PassportNumber varchar(10)," & _
        " @Emp_AlienNumber varchar(10)," & _
        " @TicTyp_Code char(1)," & _
        " @EmpAn1_Code varchar(12)," & _
        " @EmpAn2_Code varchar(12)," & _
        " @EmpAn3_Code varchar(12)," & _
        " @EmpAn4_Code varchar(12)," & _
        " @EmpAn5_Code varchar(12)," & _
        " @Uni_Code varchar(12)," & _
        " @Cou_Code char(2)," & _
        " @EmpPos_Code varchar(12)," & _
        " @Sic_Code varchar(4)," & _
        " @EmpCmm_Code varchar(4)," & _
        " @PayUni_Code varchar(4)," & _
        " @Emp_PeriodUnits int," & _
        " @Emp_AnnualUnits int," & _
        " @Cur_Code char(3)," & _
        " @PmtMth_Code varchar(4)," & _
        " @Bnk_Code varchar(12)," & _
        " @Emp_BankAccount varchar(30)," & _
        " @Bnk_CodeCo varchar(12)," & _
        " @Emp_BankAccountCo varchar(30)," & _
        " @Emp_StartDate smalldatetime," & _
        " @Emp_TerminateDate varchar(10)," & _
        " @Emp_OtherIncome1 decimal(8,2)," & _
        " @Emp_OtherIncome2 decimal(8,2)," & _
        " @Emp_OtherIncome3 decimal(8,2)," & _
        " @Emp_PreviousEarnings decimal(8,2)," & _
        " @Emp_PrevSIDeduct decimal(8,2)," & _
        " @Emp_PrevSIContribute decimal(8,2)," & _
        " @Emp_PrevITDeduct decimal(8,2)," & _
        " @Emp_PrevPFDeduct decimal(8,2)," & _
        " @ProFnd_Code varchar(4)," & _
        " @MedFnd_Code varchar(4)," & _
        " @SocInc_Code varchar(4)," & _
        " @Ind_Code varchar(4)," & _
        " @Une_Code varchar(4)," & _
        " @SocCoh_Code varchar(4)," & _
        " @Emp_CreationDate smalldatetime," & _
        " @Emp_CreatedBy int," & _
        " @Emp_AmendDate smalldatetime," & _
        " @Emp_AmendBy int," & _
        " @IntTem_Code varchar(6)," & _
        " @Emp_GLAnal1 varchar(12)," & _
        " @Emp_GLAnal2 varchar(12)," & _
        " @Emp_GLAnal3 varchar(12)," & _
        " @Emp_GLAnal4 varchar(12)," & _
        " @IntTem_PFCode varchar(6)," & _
        " @IntTem_MFCode varchar(6)," & _
        " @Emp_PensionNo varchar(7)," & _
        " @Emp_DrivingLicense varchar(20)," & _
        " @Emp_HasSI int," & _
        " @Emp_Pensiontype int," & _
        " @Emp_MyPayslipReport varchar(50)," & _
        " @Emp_IBAN varchar(40)," & _
        " @Emp_PreviousLifeIns decimal(18,2)," & _
        " @Emp_PreviousDis decimal(18,2)," & _
        " @Emp_PreviousST decimal(18,2)," & _
        " @Emp_OtherIncome4 decimal(18,2)," & _
        " @SecPay_Code varchar(4)," & _
        " @ComRat_Code varchar(4)," & _
        " @PerBon_Code varchar(4)," & _
        " @DutHou_Code varchar(4)," & _
        " @FliHou_Code varchar(4)," & _
        " @Emp_PassFullName varchar(100)," & _
        " @Emp_TravelDocs varchar(100)," & _
        " @Emp_FirstEmployment varchar(1)," & _
        " @OveLay_Code varchar(4)," & _
        " @Emp_Password varchar(20)," & _
        " @Emp_Splitemployement char(1), " & _
        " @Emp_NewEmployee char(1), " & _
        " @Emp_Force50Percent char(1), " & _
        " @Emp_Notes nvarchar(200) " & _
        " " & _
        " AS" & _
        " DECLARE @Result as Int" & _
        "   Set @Result = 0" & _
        "   SELECT @Result = Count(*)" & _
        "   FROM PrMsEmployees" & _
        "   WHERE Emp_Code = @Emp_Code" & _
        "   IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        " INSERT INTO PrMsEmployees" & _
        " (Emp_Code,                                           " & _
        " Emp_Status,                                         " & _
        " PayTyp_Code,                                        " & _
        " TemGrp_Code,                                        " & _
        " EmpSta_Code,                                        " & _
        " Emp_Title,                                          " & _
        " Emp_LastName,                                       " & _
        " Emp_FirstName,                                      " & _
        " Emp_FullName,                                       " & _
        " Emp_Sex,                                            " & _
        " Emp_BirthDate,                                      " & _
        " MarSta_Code,                                        " & _
        " Emp_Address1,                                       " & _
        " Emp_Address2,                                       " & _
        " Emp_Address3,                                       " & _
        " Emp_PostCode,                                       " & _
        " Emp_Telephone1,                                     " & _
        " Emp_Telephone2,                                     " & _
        " Emp_Email,                                          " & _
        " Emp_SocialInsNumber,                                " & _
        " ComSin_EmpSocialInsNo,                              " & _
        " Emp_IdentificationCard,                             " & _
        " Emp_TaxID,                                          " & _
        " Emp_PassportNumber,                                 " & _
        " Emp_AlienNumber,                                    " & _
        " TicTyp_Code,                                        " & _
        " EmpAn1_Code,                                        " & _
        " EmpAn2_Code,                                        " & _
        " EmpAn3_Code,                                        " & _
        " EmpAn4_Code,                                        " & _
        " EmpAn5_Code,                                        " & _
        " Uni_Code,                                           " & _
        " Cou_Code,                                           " & _
        " EmpPos_Code,                                        " & _
        " Sic_Code,                                           " & _
        " EmpCmm_Code,                                        " & _
        " PayUni_Code,                                        " & _
        " Emp_PeriodUnits,                                    " & _
        " Emp_AnnualUnits,                                    " & _
        " Cur_Code,                                           " & _
        " PmtMth_Code,                                        " & _
        " Bnk_Code,                                           " & _
        " Emp_BankAccount,                                    " & _
        " Bnk_CodeCo,                                         " & _
        " Emp_BankAccountCo,                                  " & _
        " Emp_StartDate,                                      " & _
        " Emp_TerminateDate,                                  " & _
        " Emp_OtherIncome1,                                   " & _
        " Emp_OtherIncome2,                                   " & _
        " Emp_OtherIncome3,                                   " & _
        " Emp_PreviousEarnings,                               " & _
        " Emp_PrevSIDeduct,                                   " & _
        " Emp_PrevSIContribute,                               " & _
        " Emp_PrevITDeduct,                                   " & _
        " Emp_PrevPFDeduct, " & _
        " ProFnd_Code," & _
        " MedFnd_Code," & _
        " SocInc_Code," & _
        " Ind_Code," & _
        " Une_Code," & _
        " SocCoh_Code," & _
        " Emp_CreationDate,                                   " & _
        " Emp_CreatedBy,                                      " & _
        " Emp_AmendDate,                                      " & _
        " Emp_AmendBy ,                                        " & _
        " IntTem_Code," & _
        " Emp_GLAnal1," & _
        " Emp_GLAnal2," & _
        " Emp_GLAnal3," & _
        " Emp_GLAnal4," & _
        " IntTem_PFCode," & _
        " IntTem_MFCode," & _
        " Emp_PensionNo," & _
        " Emp_DrivingLicense," & _
        " Emp_HasSI," & _
        " Emp_Pensiontype," & _
        " Emp_MyPayslipReport," & _
        " Emp_IBAN," & _
        " Emp_PreviousLifeIns," & _
        " Emp_PreviousDis," & _
        " Emp_PreviousST," & _
        " Emp_OtherIncome4," & _
        " SecPay_Code," & _
        " ComRat_Code," & _
        " PerBon_Code," & _
        " DutHou_Code," & _
        " FliHou_Code," & _
        " Emp_PassFullName," & _
        " Emp_TravelDocs," & _
        " Emp_FirstEmployment," & _
        " OveLay_Code, " & _
        " Emp_Password, " & _
        " Emp_Splitemployement, " & _
        " Emp_NewEmployee, " & _
        " Emp_Force50Percent, " & _
        " Emp_Notes " & _
        " " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @Emp_Status,                                         " & _
        " @PayTyp_Code,                                        " & _
        " @TemGrp_Code,                                        " & _
        " @EmpSta_Code,                                        " & _
        " @Emp_Title,                                          " & _
        " @Emp_LastName,                                       " & _
        " @Emp_FirstName,                                      " & _
        " @Emp_FullName,                                       " & _
        " @Emp_Sex,                                            " & _
        " @Emp_BirthDate,                                      " & _
        " @MarSta_Code,                                        " & _
        " @Emp_Address1,                                       " & _
        " @Emp_Address2,                                       " & _
        " @Emp_Address3,                                       " & _
        " @Emp_PostCode,                                       " & _
        " @Emp_Telephone1,                                     " & _
        " @Emp_Telephone2,                                     " & _
        " @Emp_Email,                                          " & _
        " @Emp_SocialInsNumber,                                " & _
        " @ComSin_EmpSocialInsNo,                              " & _
        " @Emp_IdentificationCard,                             " & _
        " @Emp_TaxID,                                          " & _
        " @Emp_PassportNumber,                                 " & _
        " @Emp_AlienNumber,                                    " & _
        " @TicTyp_Code,                                        " & _
        " @EmpAn1_Code,                                        " & _
        " @EmpAn2_Code,                                        " & _
        " @EmpAn3_Code,                                        " & _
        " @EmpAn4_Code,                                        " & _
        " @EmpAn5_Code,                                        " & _
        " @Uni_Code,                                           " & _
        " @Cou_Code,                                           " & _
        " @EmpPos_Code,                                        " & _
        " @Sic_Code,                                           " & _
        " @EmpCmm_Code,                                        " & _
        " @PayUni_Code,                                        " & _
        " @Emp_PeriodUnits,                                    " & _
        " @Emp_AnnualUnits,                                    " & _
        " @Cur_Code,                                           " & _
        " @PmtMth_Code,                                        " & _
        " @Bnk_Code,                                           " & _
        " @Emp_BankAccount,                                    " & _
        " @Bnk_CodeCo,                                         " & _
        " @Emp_BankAccountCo,                                  " & _
        " @Emp_StartDate,                                      " & _
        " @Emp_TerminateDate,                                  " & _
        " @Emp_OtherIncome1,                                   " & _
        " @Emp_OtherIncome2,                                   " & _
        " @Emp_OtherIncome3,                                   " & _
        " @Emp_PreviousEarnings,                               " & _
        " @Emp_PrevSIDeduct,                                   " & _
        " @Emp_PrevSIContribute,                               " & _
        " @Emp_PrevITDeduct,                                   " & _
        " @Emp_PrevPFDeduct,                                   " & _
        " @ProFnd_Code," & _
        " @MedFnd_Code," & _
        " @SocInc_Code," & _
        " @Ind_Code," & _
        " @Une_Code," & _
        " @SocCoh_Code," & _
        " @Emp_CreationDate,                                   " & _
        " @Emp_CreatedBy,                                      " & _
        " @Emp_AmendDate,                                      " & _
        " @Emp_AmendBy,                                         " & _
        " @IntTem_Code," & _
        " @Emp_GLAnal1," & _
        " @Emp_GLAnal2," & _
        " @Emp_GLAnal3," & _
        " @Emp_GLAnal4," & _
        " @IntTem_PFCode," & _
        " @IntTem_MFCode," & _
        " @Emp_PensionNo," & _
        " @Emp_DrivingLicense," & _
        " @Emp_HasSI," & _
        " @Emp_Pensiontype," & _
        " @Emp_MyPayslipReport," & _
        " @Emp_IBAN," & _
        " @Emp_PreviousLifeIns," & _
        " @Emp_PreviousDis," & _
        " @Emp_PreviousST," & _
        " @Emp_OtherIncome4," & _
        " @SecPay_Code," & _
        " @ComRat_Code," & _
        " @PerBon_Code," & _
        " @DutHou_Code," & _
        " @FliHou_Code," & _
        " @Emp_PassFullName," & _
        " @Emp_TravelDocs," & _
        " @Emp_FirstEmployment," & _
        " @OveLay_Code, " & _
        " @Emp_Password, " & _
        " @Emp_Splitemployement, " & _
        " @Emp_NewEmployee, " & _
        " @Emp_Force50Percent, " & _
        " @Emp_Notes " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrMsEmployees" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     Emp_Status=@Emp_Status,                               " & _
        "    PayTyp_Code=@PayTyp_Code,                             " & _
        "    TemGrp_Code=@TemGrp_Code,                             " & _
        "    EmpSta_Code=@EmpSta_Code,                             " & _
        "    Emp_Title=@Emp_Title,                                 " & _
        "    Emp_LastName=@Emp_LastName,                           " & _
        "    Emp_FirstName=@Emp_FirstName,                         " & _
        "    Emp_FullName=@Emp_FullName,                           " & _
        "    Emp_Sex=@Emp_Sex,                                     " & _
        "    Emp_BirthDate=@Emp_BirthDate,                         " & _
        "    MarSta_Code=@MarSta_Code,                             " & _
        "    Emp_Address1=@Emp_Address1,                           " & _
        "    Emp_Address2=@Emp_Address2,                           " & _
        "    Emp_Address3=@Emp_Address3,                           " & _
        "    Emp_PostCode=@Emp_PostCode,                           " & _
        "    Emp_Telephone1=@Emp_Telephone1,                       " & _
        "    Emp_Telephone2=@Emp_Telephone2,                       " & _
        "    Emp_Email=@Emp_Email,                                 " & _
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " & _
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " & _
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " & _
        "   Emp_TaxID=@Emp_TaxID,                                 " & _
        "   Emp_PassportNumber=@Emp_PassportNumber,               " & _
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " & _
        "  TicTyp_Code=@TicTyp_Code,                             " & _
        "  EmpAn1_Code=@EmpAn1_Code,                             " & _
        "  EmpAn2_Code=@EmpAn2_Code,                             " & _
        "  EmpAn3_Code=@EmpAn3_Code,                             " & _
        " EmpAn4_Code=@EmpAn4_Code,                             " & _
        " EmpAn5_Code=@EmpAn5_Code,                             " & _
        " Uni_Code=@Uni_Code,                                   " & _
        " Cou_Code=@Cou_Code,                                   " & _
        " EmpPos_Code=@EmpPos_Code,                             " & _
        " Sic_Code=@Sic_Code,                                   " & _
        " EmpCmm_Code=@EmpCmm_Code,                             " & _
        " PayUni_Code=@PayUni_Code,                             " & _
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " & _
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " & _
        " Cur_Code=@Cur_Code,                                   " & _
        " PmtMth_Code=@PmtMth_Code,                             " & _
        " Bnk_Code=@Bnk_Code,                                   " & _
        " Emp_BankAccount=@Emp_BankAccount,                     " & _
        " Bnk_CodeCo=@Bnk_CodeCo,                               " & _
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " & _
        " Emp_StartDate=@Emp_StartDate,                         " & _
        " Emp_TerminateDate=@Emp_TerminateDate,                 " & _
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " & _
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " & _
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " & _
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " & _
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " & _
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " & _
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " & _
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " & _
        " ProFnd_Code=@ProFnd_Code," & _
        " MedFnd_Code=@MedFnd_Code," & _
        " SocInc_Code=@SocInc_Code," & _
        " Ind_Code=@Ind_Code," & _
        " Une_Code=@Une_Code," & _
        " SocCoh_Code=@SocCoh_Code," & _
        " Emp_CreationDate=@Emp_CreationDate,                   " & _
        " Emp_CreatedBy=@Emp_CreatedBy,                         " & _
        " Emp_AmendDate=@Emp_AmendDate,                         " & _
        " Emp_AmendBy=@Emp_AmendBy,                              " & _
        " IntTem_Code=@IntTem_Code," & _
        " Emp_GLAnal1=@Emp_GLAnal1," & _
        " Emp_GLAnal2=@Emp_GLAnal2," & _
        " Emp_GLAnal3=@Emp_GLAnal3," & _
        " Emp_GLAnal4=@Emp_GLAnal4," & _
        " IntTem_PFCode=@IntTem_PFCode," & _
        " IntTem_MFCode=@IntTem_MFCode," & _
        " Emp_PensionNo=@Emp_PensionNo," & _
        " Emp_DrivingLicense=@Emp_DrivingLicense," & _
        " Emp_HasSI=@Emp_HasSI," & _
        " Emp_Pensiontype=@Emp_Pensiontype," & _
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," & _
        " Emp_IBAN=@Emp_IBAN," & _
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," & _
        " Emp_PreviousDis=@Emp_PreviousDis," & _
        " Emp_PreviousST=@Emp_PreviousST," & _
        " Emp_OtherIncome4=@Emp_OtherIncome4," & _
        " SecPay_Code=@SecPay_Code," & _
        " ComRat_Code=@ComRat_Code," & _
        " PerBon_Code=@PerBon_Code," & _
        " DutHou_Code=@DutHou_Code," & _
        " FliHou_Code=@FliHou_Code," & _
        " Emp_PassFullName=@Emp_PassFullName," & _
        " Emp_TravelDocs=@Emp_TravelDocs," & _
        " Emp_FirstEmployment =@Emp_FirstEmployment," & _
        " OveLay_Code = @OveLay_Code, " & _
        " Emp_Password = @Emp_Password, " & _
        " Emp_Splitemployement = @Emp_Splitemployement, " & _
        " Emp_NewEmployee = @Emp_NewEmployee, " & _
        " Emp_Force50Percent = @Emp_Force50Percent, " & _
        " Emp_Notes = @Emp_Notes " & _
        " WHERE Emp_Code = @Emp_Code" & _
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True

    End Function
    Protected Function Upgrade2017_K()

        Dim Str As String
        Dim i As Integer
        Str = " ALTER TABLE PrTxEmployeeSalary " & _
        " ADD [EmpSal_Rate] decimal(18, 4) "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrTxEmployeeSalary", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxEmployeeSalary", MsgBoxStyle.Critical)
        End If


        Str = " ALTER PROCEDURE [dbo].[AG_PrTxEmployeeSalary_SAVE_UPDATE] " & _
        " @EmpSal_id int, " & _
        " @Emp_Code varchar(16), " & _
        " @EmpSal_Date smalldatetime, " & _
        " @EmpSal_Value decimal(10,2), " & _
        " @EmpSal_Basic decimal(10,2), " & _
        " @EmpSal_EffPayDate smalldatetime, " & _
        " @EmpSal_EffArrearsDate smalldatetime, " & _
        " @EmpSal_Cola decimal(10,2), " & _
        " @Usr_Id int, " & _
        " @EmpSal_IsCola char(1), " & _
        " @EmpSal_Dif decimal(10,2), " & _
        " @EmpSal_Rate decimal(18,4), " & _
        " @NewId Int OUTPUT " & _
        " AS " & _
        "  DECLARE @Result as Int " & _
        "  Set @Result = 0 " & _
        "  SELECT @Result = Count(*) " & _
        "  FROM PrTxEmployeeSalary " & _
        "  WHERE EmpSal_id = @EmpSal_id " & _
        "  IF(@Result IS NULL) OR (@Result=0) " & _
        "    BEGIN " & _
        "      INSERT INTO PrTxEmployeeSalary " & _
        "     (Emp_Code,  " & _
        "      EmpSal_Date,  " & _
        "      EmpSal_Value,  " & _
        "      EmpSal_Basic,   " & _
        "      EmpSal_EffPayDate,  " & _
        "      EmpSal_EffArrearsDate,  " & _
        "      EmpSal_Cola,  " & _
        "      Usr_Id,  " & _
        "      EmpSal_IsCola,  " & _
        "      EmpSal_Dif,  " & _
        "      EmpSal_Rate " & _
        "      ) " & _
        "      VALUES (  " & _
        "      @Emp_Code,  " & _
        "      @EmpSal_Date,  " & _
        "      @EmpSal_Value,   " & _
        "      @EmpSal_Basic,    " & _
        "      @EmpSal_EffPayDate, " & _
        "      @EmpSal_EffArrearsDate,  " & _
        "      @EmpSal_Cola,   " & _
        "      @Usr_Id,  " & _
        "      @EmpSal_IsCola,  " & _
        "      @EmpSal_Dif,  " & _
        "      @EmpSal_Rate " & _
        "      )  " & _
        "    END  " & _
        "  ELSE  " & _
        "    BEGIN  " & _
        "      UPDATE PrTxEmployeeSalary " & _
        "      SET  " & _
        "      Emp_Code=@Emp_Code,  " & _
        "      EmpSal_Date=@EmpSal_Date,  " & _
        "      EmpSal_Value=@EmpSal_Value,  " & _
        "      EmpSal_Basic=@EmpSal_Basic,   " & _
        "      EmpSal_EffPayDate=@EmpSal_EffPayDate,  " & _
        "      EmpSal_EffArrearsDate=@EmpSal_EffArrearsDate,  " & _
        "      EmpSal_Cola=@EmpSal_Cola,  " & _
        "      Usr_Id=@Usr_Id,  " & _
        "      EmpSal_IsCola=@EmpSal_IsCola,  " & _
        "      EmpSal_Dif=@EmpSal_Dif,  " & _
        "      EmpSal_Rate=@EmpSal_Rate  " & _
        "      WHERE EmpSal_id = @EmpSal_id " & _
        "  END " & _
        " set @NewId=SCOPE_IDENTITY() "

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If

        Str = "CREATE TABLE [dbo].[PrTxIr59]( " & _
        " [Pay_Id] [int] IDENTITY(1,1) NOT NULL," & _
        " [Trxhdr_id] [int] NULL, " & _
        " [TemGrp_Code] [varchar](6) NULL, " & _
        " [PrdGrp_Code] [varchar](6) NULL, " & _
        " [PrdCod_Code] [varchar](6) NULL, " & _
        " [Emp_Code] [varchar](16) NULL, " & _
        " [Rec_GrossIncome] [decimal](18, 2) NULL, " & _
        " [Act_GrossIncome] [decimal](18, 2) NULL, " & _
        " [Rec_Discounts] [decimal](18, 2) NULL, " & _
        " [Act_Discounts] [decimal](18, 2) NULL, " & _
        " [Rec_FirstEmployeement] [decimal](18, 2) NULL, " & _
        " [Act_FirstEmployeement] [decimal](18, 2) NULL, " & _
        " [Rec_SalDecrease] [decimal](18, 2) NULL, " & _
        " [Act_Saldecrease] [decimal](18, 2) NULL, " & _
        " [Rec_PenFund] [decimal](18, 2) NULL, " & _
        " [Act_PenFund] [decimal](18, 2) NULL, " & _
        " [Rec_WOFund] [decimal](18, 2) NULL, " & _
        " [Act_WOFund] [decimal](18, 2) NULL, " & _
        " [Rec_Union] [decimal](18, 2) NULL, " & _
        " [Act_Union] [decimal](18, 2) NULL, " & _
        " [Rec_LifeIns] [decimal](18, 2) NULL, " & _
        " [Act_LifeIns] [decimal](18, 2) NULL, " & _
        " [Rec_PF] [decimal](18, 2) NULL, " & _
        " [Act_PF] [decimal](18, 2) NULL, " & _
        " [Rec_PFLimit] [decimal](18, 2) NULL, " & _
        " [Act_PFLimit] [decimal](18, 2) NULL, " & _
        " [Rec_SI] [decimal](18, 2) NULL, " & _
        " [Act_SI] [decimal](18, 2) NULL, " & _
        " [Rec_MF] [decimal](18, 2) NULL, " & _
        " [Act_MF] [decimal](18, 2) NULL, " & _
        " [Rec_MFLimit] [decimal](18, 2) NULL, " & _
        " [Act_MFLimit] [decimal](18, 2) NULL, " & _
        " [Rec_Total] [decimal](18, 2) NULL, " & _
        " [Act_Total] [decimal](18, 2) NULL, " & _
        " [Rec_OneSixth] [decimal](18, 2) NULL, " & _
        " [Act_OneSixth] [decimal](18, 2) NULL, " & _
        " [Rec_Taxable] [decimal](18, 2) NULL, " & _
        " [Act_Taxable] [decimal](18, 2) NULL, " & _
        " [Rec_TotalTax] [decimal](18, 2) NULL, " & _
        " [Act_TotalTax] [decimal](18, 2) NULL, " & _
        " [Rec_PaidTax] [decimal](18, 2) NULL, " & _
        " [Act_PaidTax] [decimal](18, 2) NULL, " & _
        " [Rec_RemTax] [decimal](18, 2) NULL, " & _
        " [Act_RemTax] [decimal](18, 2) NULL, " & _
        " [Rec_RemDivTaxableP] [decimal](18, 2) NULL, " & _
        " [Act_RemDivTaxableP] [decimal](18, 2) NULL, " & _
        " [Pay_RemTaxablePeriods] [int] NULL, " & _
        " [Pay_ActualDivNormal] [decimal](18, 2) NULL, " & _
        " [Pay_Dif] [decimal](18, 2) NULL, " & _
        " [Pay_PeriodTax] [decimal](18, 2) NULL " & _
        " ) ON [PRIMARY] "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox(" PrTxIR59 was Created", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Create PrTxIr59", MsgBoxStyle.Critical)
        End If
        Return Proceed

    End Function
    Protected Function Upgrade2017_I()
        Dim Str As String
        Dim i As Integer


        Str = " CREATE TABLE [dbo].[PrTxPositionsHistory](" & _
            "	[PosHis_Id] [int] IDENTITY(1,1) NOT NULL," & _
            "	[Emp_Code] [varchar](16) NOT NULL," & _
            "	[Pos_Code] [varchar](12) NOT NULL," & _
            "	[Pos_Desc] [nvarchar](50) NOT NULL," & _
            "	[Pos_Date] [datetime] NOT NULL" & _
            ") ON [PRIMARY]"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Position History Table Created", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Create Position History Table", MsgBoxStyle.Critical)
        End If

        Str = " CREATE TABLE [dbo].[PrTxEmploymentHistory](" & _
        "   [EmpHis_Id] [int] IDENTITY(1,1) NOT NULL," & _
        "	[Emp_code] [varchar](16) NOT NULL," & _
        "	[Emp_StartDate] [datetime] NOT NULL," & _
        "	[Emp_EndDate] [datetime] NOT NULL" & _
        " ) ON [PRIMARY] "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Employement History Table Created", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Create Employment History Table", MsgBoxStyle.Critical)
        End If

     

        ' Alter SPs                                     

        Str = " CREATE PROCEDURE [dbo].[PrTxEmploymentHistory_Save_Update] " & _
        " @EmpHis_Id int, " & _
        " @Emp_Code varchar(16), " & _
        " @Emp_StartDate smalldatetime, " & _
        " @Emp_EndDate smalldatetime, " & _
        " " & _
        " @NewId Int OUTPUT " & _
        " AS " & _
        "  DECLARE @Result as Int " & _
        "  Set @Result = 0 " & _
        "  SELECT @Result = Count(*) " & _
        "  FROM PrTxEmploymentHistory " & _
        "  WHERE EmpHis_Id = @EmpHis_Id " & _
        "  IF(@Result IS NULL) OR (@Result=0) " & _
        "    BEGIN " & _
        "      INSERT INTO PrTxEmploymentHistory " & _
        "     (Emp_Code,  " & _
        "	  Emp_startdate,  " & _
        "	  Emp_Enddate  " & _
        "	  ) " & _
        "      VALUES ( " & _
        "      @Emp_Code,  " & _
        "	  @Emp_startdate,  " & _
        "	  @Emp_Enddate " & _
        "      ) " & _
        "    END " & _
        "  ELSE " & _
        "    BEGIN " & _
        "      UPDATE PrTxEmploymentHistory " & _
        "      SET  " & _
        "    Emp_Code=@Emp_Code, " & _
        "	  Emp_startdate=@Emp_startdate, " & _
        "	  Emp_Enddate=@Emp_Enddate " & _
        "      WHERE EmpHis_Id = @EmpHis_Id " & _
        "  END " & _
        " set @NewId=SCOPE_IDENTITY() "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("EmploymentHistory was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update EmploymentHistory", MsgBoxStyle.Critical)
        End If

        Str = " CREATE PROCEDURE [dbo].[PrTxPositionHistory_Save_Update] " & _
            " @PosHis_Id int, " & _
            " @Emp_Code varchar(16), " & _
            " @Pos_Code varchar(12), " & _
            " @Pos_Desc varchar(50), " & _
            " @Pos_Date smalldatetime, " & _
            " " & _
            " @NewId Int OUTPUT " & _
            " AS " & _
            "  DECLARE @Result as Int " & _
            "  Set @Result = 0 " & _
            "  SELECT @Result = Count(*) " & _
            "  FROM PrTxPositionsHistory " & _
            "  WHERE PosHis_Id = @PosHis_Id " & _
            "  IF(@Result IS NULL) OR (@Result=0) " & _
            "    BEGIN " & _
            "      INSERT INTO PrTxPositionsHistory " & _
            "     (Emp_Code,  " & _
            "	  Pos_Code,  " & _
            "	  Pos_Desc,  " & _
            "	  Pos_Date  " & _
            "      ) " & _
            "      VALUES ( " & _
            "      @Emp_Code, " & _
            "	  @Pos_Code, " & _
            "	  @Pos_Desc, " & _
            "	  @Pos_Date " & _
            "      ) " & _
            "    END " & _
            "  ELSE " & _
            "    BEGIN " & _
            "      UPDATE PrTxPositionsHistory " & _
            "      SET  " & _
            "     Emp_Code=@Emp_Code, " & _
            "	  Pos_Code=@Pos_Code,  " & _
            "	  Pos_Desc=@Pos_Desc,  " & _
            "	  Pos_Date=@Pos_Date  " & _
            "      WHERE PosHis_Id = @PosHis_Id " & _
            "  END " & _
            " set @NewId=SCOPE_IDENTITY() "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("PositionHistory was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update PositionHistory", MsgBoxStyle.Critical)
        End If


        Str = " ALTER PROCEDURE [dbo].[AG_PrAnEmployeePositions_SAVE_UPDATE] " & _
        " @EmpPos_Code varchar(12), " & _
        " @EmpPos_DescriptionL nvarchar(40), " & _
        " @EmpPos_DescriptionS nvarchar(15), " & _
        " @EmpPos_IsActive char(1) " & _
        " AS " & _
        "  DECLARE @Result as Int " & _
        "  Set @Result = 0 " & _
        "  SELECT @Result = Count(*) " & _
        "  FROM PrAnEmployeePositions " & _
        "  WHERE EmpPos_Code = @EmpPos_Code " & _
        "  IF(@Result IS NULL) OR (@Result=0) " & _
        "    BEGIN " & _
        "      INSERT INTO PrAnEmployeePositions " & _
        "     (EmpPos_Code,                                       " & _
        "      EmpPos_DescriptionL,                               " & _
        "      EmpPos_DescriptionS,                               " & _
        "      EmpPos_IsActive                                    " & _
        "      ) " & _
        "      VALUES ( " & _
        "      @EmpPos_Code,                                      " & _
        "      @EmpPos_DescriptionL,                              " & _
        "      @EmpPos_DescriptionS,                              " & _
        "      @EmpPos_IsActive                                   " & _
        "      ) " & _
        "    END " & _
        "  ELSE " & _
        "    BEGIN " & _
        "      UPDATE PrAnEmployeePositions " & _
        "      SET  " & _
        "      EmpPos_Code=@EmpPos_Code,                            " & _
        "      EmpPos_DescriptionL=@EmpPos_DescriptionL,            " & _
        "      EmpPos_DescriptionS=@EmpPos_DescriptionS,            " & _
        "      EmpPos_IsActive=@EmpPos_IsActive                     " & _
        "      WHERE EmpPos_Code = @EmpPos_Code " & _
        "  END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Update Position SP", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update Position SP", MsgBoxStyle.Critical)
        End If
        Return True

    End Function
    Protected Function Upgrade2017_E()

        Dim Str As String
        Dim i As Integer
        Str = " ALTER TABLE PrTxtrxnheader " & _
        " ADD [TrxHdr_A1] [varchar](12) NULL, " & _
        "  [TrxHdr_A2] [varchar](12) NULL, " & _
        "  [TrxHdr_A3] [varchar](12) NULL, " & _
        "  [TrxHdr_A4] [varchar](12) NULL, " & _
        "  [TrxHdr_A5] [varchar](12) NULL, " & _
        "  [TrxHdr_Union] [varchar](12) NULL, " & _
        "  [TrxHdr_Position] [varchar](12) NULL, " & _
        "  [TrxHdr_COLA] [decimal](18, 2) NULL," & _
        "  [TrxHdr_MyRate] [decimal](18, 4) NULL "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If







        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE]" & _
        " @TrxHdr_Id int," & _
        " @Emp_Code varchar(16)," & _
        " @PrdGrp_Code varchar(6)," & _
        " @PrdCod_Code varchar(6)," & _
        " @PayCat_Code varchar(4)," & _
        " @TrxHdr_Date datetime," & _
        " @TrxHdr_Status varchar(4)," & _
        " @TrxHdr_TotalErnPeriod decimal(18,2)," & _
        " @TrxHdr_TotalErnYTD decimal(18,2)," & _
        " @TrxHdr_TotalDedPeriod decimal(18,2)," & _
        " @TrxHdr_TotalDedYTD decimal(18,2)," & _
        " @TrxHdr_TotalConPeriod decimal(18,2)," & _
        " @TrxHdr_TotalConYTD decimal(18,2)," & _
        " @TrxHdr_SIIncome decimal(18,2)," & _
        " @TrxHdr_TaxableIncome decimal(18,2)," & _
        " @TrxHdr_PaymentMethod varchar(50)," & _
        " @TrxHdr_PaymentRef varchar(50)," & _
        " @TrxHdr_PeriodUnits decimal(18,2)," & _
        " @TrxHdr_AnnualUnits decimal(18,2)," & _
        " @TrxHdr_AnnualLeave decimal(18,2)," & _
        " @TrxHdr_LifeInsurance decimal(18,2)," & _
        " @TrxHdr_Discounts decimal(18,2)," & _
        " @TrxHdr_Interfacestatus varchar(4)," & _
        " @TrxHdr_Overtime1 decimal(10,2)," & _
        " @TrxHdr_Overtime2 decimal(10,2)," & _
        " @TrxHdr_SIUnits decimal(10,2)," & _
        " @TrxHdr_MonthlySalary decimal(18,2)," & _
        " @TrxHdr_NetSalary decimal(18,2)," & _
        " @TrxHdr_PeriodInsurable decimal(18,2)," & _
        " @TemGrp_Code varchar(6)," & _
        " @TrxHdr_ChequeNo varchar(50)," & _
        " @TrxHdr_TaxableFromOther Decimal(18,2)," & _
        " @TrxHdr_CurrencySymbol varchar(3)," & _
        " @TrxHdr_Rate Decimal(18,10)," & _
        " @TrxHdr_NormalDays Decimal(18,2)," & _
        " @TrxHdr_Salary1 Decimal(18,2)," & _
        " @TrxHdr_Salary2 Decimal(18,2)," & _
        " @TrxHdr_Overtime3 decimal(10,2)," & _
        " @TrxHdr_Sectors decimal(18,2)," & _
        " @TrxHdr_Dutyhours decimal(18,2)," & _
        " @TrxHdr_FlightHours decimal(18,2)," & _
        " @TrxHdr_Commission decimal(18,2)," & _
        " @TrxHdr_PBAmount decimal(18,2)," & _
        " @TrxHdr_PBRate decimal(18,2)," & _
        " @TrxHdr_Overlay decimal(18,2)," & _
        " @TrxHdr_PeriodSplit decimal(18,2)," & _
        " @TrxHdr_PeriodSplitSI decimal(18,2)," & _
        " @TrxHdr_A1 varchar(12), " & _
        " @TrxHdr_A2 varchar(12), " & _
        " @TrxHdr_A3 varchar(12), " & _
        " @TrxHdr_A4 varchar(12), " & _
        " @TrxHdr_A5 varchar(12), " & _
        " @TrxHdr_Union varchar(12), " & _
        " @TrxHdr_Position varchar(12), " & _
        " @TrxHdr_COLA decimal(18, 2)," & _
        " @TrxHdr_MyRate decimal(18, 4)," & _
        " @NewId Int OUTPUT" & _
        " AS" & _
        " DECLARE @Result as Int" & _
        " Set  @Result = 0" & _
        " SELECT @Result = Count(*)" & _
        " FROM PrTxTrxnHeader" & _
        " WHERE TrxHdr_Id =  @TrxHdr_Id" & _
        " IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        "   INSERT INTO PrTxTrxnHeader" & _
        "   (Emp_Code,                                           " & _
        " PrdGrp_Code," & _
        " PrdCod_Code,                                        " & _
        " PayCat_Code,                                        " & _
        " TrxHdr_Date,                                        " & _
        " TrxHdr_Status,                                      " & _
        " TrxHdr_TotalErnPeriod,                              " & _
        " TrxHdr_TotalErnYTD,                                 " & _
        " TrxHdr_TotalDedPeriod,                              " & _
        " TrxHdr_TotalDedYTD,                                 " & _
        " TrxHdr_TotalConPeriod,                              " & _
        " TrxHdr_TotalConYTD,                                 " & _
        " TrxHdr_SIIncome,                                    " & _
        " TrxHdr_TaxableIncome,                               " & _
        " TrxHdr_PaymentMethod,                               " & _
        " TrxHdr_PaymentRef,                                  " & _
        " TrxHdr_PeriodUnits,                                 " & _
        " TrxHdr_AnnualUnits,                                 " & _
        " TrxHdr_AnnualLeave,                                  " & _
        " TrxHdr_LifeInsurance,                                " & _
        " TrxHdr_Discounts,                                    " & _
        " TrxHdr_InterfaceStatus,                               " & _
        " TrxHdr_Overtime1," & _
        " TrxHdr_Overtime2," & _
        " TrxHdr_SIUnits," & _
        " TrxHdr_MonthlySalary," & _
        " TrxHdr_NetSalary," & _
        " TrxHdr_PeriodInsurable," & _
        " TemGrp_Code," & _
        " TrxHdr_ChequeNo," & _
        " TrxHdr_TaxableFromOther," & _
        " TrxHdr_CurrencySymbol," & _
        " TrxHdr_Rate," & _
        " TrxHdr_NormalDays," & _
        " TrxHdr_Salary1," & _
        " TrxHdr_Salary2," & _
        " TrxHdr_Overtime3," & _
        " TrxHdr_Sectors," & _
        " TrxHdr_Dutyhours," & _
        " TrxHdr_FlightHours," & _
        " TrxHdr_Commission," & _
        " TrxHdr_PBAmount," & _
        " TrxHdr_PBRate," & _
        " TrxHdr_Overlay," & _
        " TrxHdr_PeriodSplit, " & _
        " TrxHdr_PeriodSplitSI, " & _
        " TrxHdr_A1, " & _
        " TrxHdr_A2, " & _
        " TrxHdr_A3, " & _
        " TrxHdr_A4, " & _
        " TrxHdr_A5, " & _
        " TrxHdr_Union, " & _
        " TrxHdr_Position, " & _
        " TrxHdr_COLA," & _
        " TrxHdr_MyRate " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @PrdGrp_Code," & _
        " @PrdCod_Code,                                        " & _
        " @PayCat_Code,                                        " & _
        " @TrxHdr_Date,                                        " & _
        " @TrxHdr_Status,                                      " & _
        " @TrxHdr_TotalErnPeriod,                              " & _
        " @TrxHdr_TotalErnYTD,                                 " & _
        " @TrxHdr_TotalDedPeriod,                              " & _
        " @TrxHdr_TotalDedYTD,                                 " & _
        " @TrxHdr_TotalConPeriod,                              " & _
        " @TrxHdr_TotalConYTD,                                 " & _
        " @TrxHdr_SIIncome,                                    " & _
        " @TrxHdr_TaxableIncome,                               " & _
        " @TrxHdr_PaymentMethod,                               " & _
        " @TrxHdr_PaymentRef,                                  " & _
        " @TrxHdr_PeriodUnits,                                 " & _
        " @TrxHdr_AnnualUnits,                                 " & _
        " @TrxHdr_AnnualLeave,                                 " & _
        " @TrxHdr_LifeInsurance,                               " & _
        " @TrxHdr_Discounts,                                   " & _
        " @TrxHdr_InterfaceStatus,                              " & _
        " @TrxHdr_Overtime1," & _
        " @TrxHdr_Overtime2," & _
        " @TrxHdr_SIUnits," & _
        " @TrxHdr_MonthlySalary," & _
        " @TrxHdr_NetSalary," & _
        " @TrxHdr_PeriodInsurable," & _
        " @TemGrp_Code, " & _
        " @TrxHdr_ChequeNo," & _
        " @TrxHdr_TaxableFromOther," & _
        " @TrxHdr_CurrencySymbol," & _
        " @TrxHdr_Rate," & _
        " @TrxHdr_NormalDays," & _
        " @TrxHdr_Salary1," & _
        " @TrxHdr_Salary2," & _
        " @TrxHdr_Overtime3," & _
        " @TrxHdr_Sectors," & _
        " @TrxHdr_Dutyhours," & _
        " @TrxHdr_FlightHours," & _
        " @TrxHdr_Commission," & _
        " @TrxHdr_PBAmount," & _
        " @TrxHdr_PBRate," & _
        " @TrxHdr_Overlay," & _
        " @TrxHdr_PeriodSplit, " & _
        " @TrxHdr_PeriodSplitSI, " & _
        " @TrxHdr_A1, " & _
        " @TrxHdr_A2, " & _
        " @TrxHdr_A3, " & _
        " @TrxHdr_A4, " & _
        " @TrxHdr_A5, " & _
        " @TrxHdr_Union, " & _
        " @TrxHdr_Position, " & _
        " @TrxHdr_COLA," & _
        " @TrxHdr_MyRate " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrTxTrxnHeader" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     PrdGrp_Code=@PrdGrp_Code," & _
        "     PrdCod_Code=@PrdCod_Code,                             " & _
        "     PayCat_Code=@PayCat_Code,                             " & _
        "     TrxHdr_Date=@TrxHdr_Date,                             " & _
        "    TrxHdr_Status=@TrxHdr_Status,                         " & _
        "  TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " & _
        "     TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " & _
        "    TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " & _
        "   TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " & _
        "  TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " & _
        " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " & _
        " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " & _
        " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " & _
        " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " & _
        " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " & _
        " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " & _
        " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " & _
        " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,                " & _
        " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " & _
        " TrxHdr_Discounts=@TrxHdr_Discounts,                    " & _
        " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,        " & _
        " TrxHdr_Overtime1=@TrxHdr_Overtime1," & _
        " TrxHdr_Overtime2=@TrxHdr_Overtime2," & _
        " TrxHdr_SIUnits=@TrxHdr_SIUnits," & _
        " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary," & _
        " TrxHdr_NetSalary=@TrxHdr_NetSalary," & _
        " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable," & _
        " TemGrp_Code=@TemGrp_Code," & _
        " TrxHdr_ChequeNo=@TrxHdr_ChequeNo ," & _
        " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther," & _
        " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol," & _
        " TrxHdr_Rate=@TrxHdr_Rate," & _
        " TrxHdr_NormalDays=@TrxHdr_NormalDays ," & _
        " TrxHdr_Salary1=@TrxHdr_Salary1," & _
        " TrxHdr_Salary2=@TrxHdr_Salary2," & _
        " TrxHdr_Overtime3=@TrxHdr_Overtime3," & _
        " TrxHdr_Sectors=@TrxHdr_Sectors," & _
        " TrxHdr_Dutyhours=@TrxHdr_Dutyhours," & _
        " TrxHdr_FlightHours=@TrxHdr_FlightHours," & _
        " TrxHdr_Commission=@TrxHdr_Commission," & _
        " TrxHdr_PBAmount=@TrxHdr_PBAmount," & _
        " TrxHdr_PBRate=@TrxHdr_PBRate," & _
        " TrxHdr_Overlay=@TrxHdr_Overlay," & _
        " TrxHdr_PeriodSplit=@TrxHdr_PeriodSplit, " & _
        " TrxHdr_PeriodSplitSI=@TrxHdr_PeriodSplitSI," & _
        " TrxHdr_A1=@TrxHdr_A1, " & _
        " TrxHdr_A2=@TrxHdr_A2, " & _
        " TrxHdr_A3=@TrxHdr_A3, " & _
        " TrxHdr_A4=@TrxHdr_A4, " & _
        " TrxHdr_A5=@TrxHdr_A5, " & _
        " TrxHdr_Union=@TrxHdr_Union, " & _
        " TrxHdr_Position=@TrxHdr_Position, " & _
        " TrxHdr_COLA=@TrxHdr_COLA," & _
        " TrxHdr_MyRate=@TrxHdr_MyRate " & _
        " WHERE TrxHdr_Id = @TrxHdr_Id" & _
        " END" & _
        " set  @NewId=SCOPE_IDENTITY()"

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
            proceed = True
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If

        If Proceed Then


            Dim Str2 As String
            Str2 = " select Emp_Code," & _
                " EmpAn1_Code ," & _
                " EmpAn2_Code ," & _
                " EmpAn3_Code ," & _
                " EmpAn4_Code ," & _
                " EmpAn5_Code ," & _
                " Uni_Code ," & _
                " EmpPos_Code " & _
                " from PrMsEmployees "
            Dim Ds As DataSet
            Ds = GetData(Str2)

            If CheckDataSet(Ds) Then
                Dim Emp_Code As String
                Dim EmpAn1_Code As String
                Dim EmpAn2_Code As String
                Dim EmpAn3_Code As String
                Dim EmpAn4_Code As String
                Dim EmpAn5_Code As String
                Dim Uni_Code As String
                Dim EmpPos_Code As String
                Dim k As Integer
                For i = 0 To Ds.Tables(0).Rows.Count - 1
                    Emp_Code = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
                    EmpAn1_Code = DbNullToString(Ds.Tables(0).Rows(i).Item(1))
                    EmpAn2_Code = DbNullToString(Ds.Tables(0).Rows(i).Item(2))
                    EmpAn3_Code = DbNullToString(Ds.Tables(0).Rows(i).Item(3))
                    EmpAn4_Code = DbNullToString(Ds.Tables(0).Rows(i).Item(4))
                    EmpAn5_Code = DbNullToString(Ds.Tables(0).Rows(i).Item(5))
                    Uni_Code = DbNullToString(Ds.Tables(0).Rows(i).Item(6))
                    EmpPos_Code = DbNullToString(Ds.Tables(0).Rows(i).Item(7))

                    Str2 = "Update PrtxTrxnHeader Set " & _
                    " TrxHdr_A1 = " & enQuoteString(EmpAn1_Code) & " , " & _
                    " TrxHdr_A2 = " & enQuoteString(EmpAn2_Code) & " , " & _
                    " TrxHdr_A3 = " & enQuoteString(EmpAn3_Code) & " , " & _
                    " TrxHdr_A4 = " & enQuoteString(EmpAn4_Code) & " , " & _
                    " TrxHdr_A5 = " & enQuoteString(EmpAn5_Code) & " , " & _
                    " TrxHdr_Union = " & enQuoteString(Uni_Code) & " , " & _
                    " TrxHdr_Position = " & enQuoteString(EmpPos_Code) & " , " & _
                    " TrxHdr_COLA = 0," & _
                    " TrxHdr_MyRate = 0 " & _
                    " Where Emp_Code = " & enQuoteString(Emp_Code)

                    k = ExecuteNonQuery(Str2)
                    If k < 0 Then
                        MsgBox("Unable to Update Employee With Code " & Emp_Code, MsgBoxStyle.Critical)
                    End If

                Next
                MsgBox("Finish updating Employees", MsgBoxStyle.Information)
            End If

        End If



        Return True

    End Function
    Protected Function Upgrade2017_F()

        Dim Str As String
        Dim i As Integer
        Dim Seq As Integer = 0

        Str = "Select max(ErnTyp_TableSequence) from PrSsEarningTypes "
        Dim ds As DataSet
        ds = GetData(Str)

        If CheckDataSet(ds) Then
            Seq = DbNullToInt(ds.Tables(0).Rows(0).Item(0))
        End If
        Seq = Seq + 1

        Str = "INSERT INTO PrSsEarningTypes " & _
            " (ErnTyp_Code, " & _
            " ErnTyp_DescriptionL, " & _
            " ErnTyp_DescriptionS, " & _
            " ErnTyp_TableSequence) " & _
            " VALUES     ('O1', " & _
            " 'OVERTIME 1', " & _
            " 'OVERTIME 1',  " & _
             Seq & ") "
        i = ExecuteNonQuery(Str)

        Seq = Seq + 1
        Str = "INSERT INTO PrSsEarningTypes " & _
            " (ErnTyp_Code, " & _
            " ErnTyp_DescriptionL, " & _
            " ErnTyp_DescriptionS, " & _
            " ErnTyp_TableSequence) " & _
            " VALUES     ('O2', " & _
            " 'OVERTIME 2', " & _
            " 'OVERTIME 2',  " & _
            Seq & ") "
        i = ExecuteNonQuery(Str)

        Seq = Seq + 1
        Str = "INSERT INTO PrSsEarningTypes " & _
            " (ErnTyp_Code, " & _
            " ErnTyp_DescriptionL, " & _
            " ErnTyp_DescriptionS, " & _
            " ErnTyp_TableSequence) " & _
            " VALUES     ('O3', " & _
            " 'OVERTIME 3', " & _
            " 'OVERTIME 3',  " & _
            Seq & ") "
        i = ExecuteNonQuery(Str)

        Seq = Seq + 1
        Str = "INSERT INTO PrSsEarningTypes " & _
            " (ErnTyp_Code, " & _
            " ErnTyp_DescriptionL, " & _
            " ErnTyp_DescriptionS, " & _
            " ErnTyp_TableSequence) " & _
            " VALUES     ('CL', " & _
            " 'COLA', " & _
            " 'COLA',  " & _
            Seq & ") "

        i = ExecuteNonQuery(Str)

        Seq = Seq + 1
        Str = "INSERT INTO PrSsEarningTypes " & _
            " (ErnTyp_Code, " & _
            " ErnTyp_DescriptionL, " & _
            " ErnTyp_DescriptionS, " & _
            " ErnTyp_TableSequence) " & _
            " VALUES     ('RE', " & _
            " 'RECURRING', " & _
            " 'RECURRING',  " & _
            Seq & ") "

        i = ExecuteNonQuery(Str)

        Seq = Seq + 1
        Str = "INSERT INTO PrSsEarningTypes " & _
            " (ErnTyp_Code, " & _
            " ErnTyp_DescriptionL, " & _
            " ErnTyp_DescriptionS, " & _
            " ErnTyp_TableSequence) " & _
            " VALUES     ('BK', " & _
            " 'BENEFITS', " & _
            " 'BENEFITS',  " & _
            Seq & ") "

        i = ExecuteNonQuery(Str)


        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        '                       Earning Codes
        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''


        Str = "select MAX(ErnCod_Code) from PrMsEarningCodes where len(ErnCod_Code)=3"
        ds = GetData(Str)
        Dim CodeSeq As Integer = 0

        If CheckDataSet(ds) Then
            Dim Code As String
            Code = DbNullToString(ds.Tables(0).Rows(0).Item(0))
            Code = Replace(Code, "E", "")
            CodeSeq = CInt(Code)
        End If

        Dim ErnCode As String

        CodeSeq = CodeSeq + 1
        ErnCode = "E" & CodeSeq
        Str = "INSERT INTO PrMsEarningCodes " & _
        "(ErnCod_Code, " & _
        "ErnTyp_Code, " & _
        "ErnCod_DescriptionL, " & _
        "ErnCod_DescriptionS, " & _
        "ErnCod_IsActive) " & _
        "VALUES (" & enQuoteString(ErnCode) & ", " & _
        "'O1', " & _
        "'OVERTIME 1', " & _
        "'OVERTIME 1', " & _
        "'Y') "

        i = ExecuteNonQuery(Str)

        CodeSeq = CodeSeq + 1
        ErnCode = "E" & CodeSeq
        Str = "INSERT INTO PrMsEarningCodes " & _
        "(ErnCod_Code, " & _
        "ErnTyp_Code, " & _
        "ErnCod_DescriptionL, " & _
        "ErnCod_DescriptionS, " & _
        "ErnCod_IsActive) " & _
        "VALUES (" & enQuoteString(ErnCode) & ", " & _
        "'O2', " & _
        "'OVERTIME 2', " & _
        "'OVERTIME 2', " & _
        "'Y') "

        i = ExecuteNonQuery(Str)

        CodeSeq = CodeSeq + 1
        ErnCode = "E" & CodeSeq
        Str = "INSERT INTO PrMsEarningCodes " & _
        "(ErnCod_Code, " & _
        "ErnTyp_Code, " & _
        "ErnCod_DescriptionL, " & _
        "ErnCod_DescriptionS, " & _
        "ErnCod_IsActive) " & _
        "VALUES (" & enQuoteString(ErnCode) & ", " & _
        "'O3', " & _
        "'OVERTIME 3', " & _
        "'OVERTIME 3', " & _
        "'Y') "

        i = ExecuteNonQuery(Str)

        CodeSeq = CodeSeq + 1
        ErnCode = "E" & CodeSeq
        Str = "INSERT INTO PrMsEarningCodes " & _
        "(ErnCod_Code, " & _
        "ErnTyp_Code, " & _
        "ErnCod_DescriptionL, " & _
        "ErnCod_DescriptionS, " & _
        "ErnCod_IsActive) " & _
        "VALUES (" & enQuoteString(ErnCode) & ", " & _
        "'CL', " & _
        "'COLA', " & _
        "'COLA', " & _
        "'Y') "

        i = ExecuteNonQuery(Str)

        CodeSeq = CodeSeq + 1
        ErnCode = "E" & CodeSeq
        Str = "INSERT INTO PrMsEarningCodes " & _
        "(ErnCod_Code, " & _
        "ErnTyp_Code, " & _
        "ErnCod_DescriptionL, " & _
        "ErnCod_DescriptionS, " & _
        "ErnCod_IsActive) " & _
        "VALUES (" & enQuoteString(ErnCode) & ", " & _
        "'RE', " & _
        "'RECCURING', " & _
        "'RECCURING', " & _
        "'Y') "

        i = ExecuteNonQuery(Str)

        CodeSeq = CodeSeq + 1
        ErnCode = "E" & CodeSeq
        Str = "INSERT INTO PrMsEarningCodes " & _
        "(ErnCod_Code, " & _
        "ErnTyp_Code, " & _
        "ErnCod_DescriptionL, " & _
        "ErnCod_DescriptionS, " & _
        "ErnCod_IsActive) " & _
        "VALUES (" & enQuoteString(ErnCode) & ", " & _
        "'BK', " & _
        "'BENEFITS', " & _
        "'BENEFITS', " & _
        "'Y') "

        i = ExecuteNonQuery(Str)








        Return True

    End Function
    Protected Function Upgrade2017_F_2()

        Dim Str As String
        Dim i As Integer
        Dim Seq As Integer = 0

        Str = "Select max(ErnTyp_TableSequence) from PrSsEarningTypes "
        Dim ds As DataSet
        ds = GetData(Str)

        If CheckDataSet(ds) Then
            Seq = DbNullToInt(ds.Tables(0).Rows(0).Item(0))
        End If
        Seq = Seq + 1


        Str = "INSERT INTO PrSsEarningTypes " & _
            " (ErnTyp_Code, " & _
            " ErnTyp_DescriptionL, " & _
            " ErnTyp_DescriptionS, " & _
            " ErnTyp_TableSequence) " & _
            " VALUES     ('BR', " & _
            " 'BEN.RECCURING', " & _
            " 'BEN. REC.',  " & _
            Seq & ") "

        i = ExecuteNonQuery(Str)


        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        '                       Earning Codes
        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''


        Str = "select MAX(ErnCod_Code) from PrMsEarningCodes where len(ErnCod_Code)=3"
        ds = GetData(Str)
        Dim CodeSeq As Integer = 0

        If CheckDataSet(ds) Then
            Dim Code As String
            Code = DbNullToString(ds.Tables(0).Rows(0).Item(0))
            Code = Replace(Code, "E", "")
            CodeSeq = CInt(Code)
        End If

        Dim ErnCode As String

        CodeSeq = CodeSeq + 1
        ErnCode = "E" & CodeSeq
        Str = "INSERT INTO PrMsEarningCodes " & _
        "(ErnCod_Code, " & _
        "ErnTyp_Code, " & _
        "ErnCod_DescriptionL, " & _
        "ErnCod_DescriptionS, " & _
        "ErnCod_IsActive) " & _
        "VALUES (" & enQuoteString(ErnCode) & ", " & _
        "'BR', " & _
        "'REC.BENEFITS', " & _
        "'REC.BENEFITS', " & _
        "'Y') "

        i = ExecuteNonQuery(Str)


        Return True

    End Function
    Protected Function Upgrade2017_F_3() As Boolean
        Dim Str As String
        Dim i As Integer
        Str = " ALTER TABLE PrTxtrxnheader " & _
        " ADD [TrxHdr_FE] [decimal](18, 2) NULL "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If


        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE]" & _
        " @TrxHdr_Id int," & _
        " @Emp_Code varchar(16)," & _
        " @PrdGrp_Code varchar(6)," & _
        " @PrdCod_Code varchar(6)," & _
        " @PayCat_Code varchar(4)," & _
        " @TrxHdr_Date datetime," & _
        " @TrxHdr_Status varchar(4)," & _
        " @TrxHdr_TotalErnPeriod decimal(18,2)," & _
        " @TrxHdr_TotalErnYTD decimal(18,2)," & _
        " @TrxHdr_TotalDedPeriod decimal(18,2)," & _
        " @TrxHdr_TotalDedYTD decimal(18,2)," & _
        " @TrxHdr_TotalConPeriod decimal(18,2)," & _
        " @TrxHdr_TotalConYTD decimal(18,2)," & _
        " @TrxHdr_SIIncome decimal(18,2)," & _
        " @TrxHdr_TaxableIncome decimal(18,2)," & _
        " @TrxHdr_PaymentMethod varchar(50)," & _
        " @TrxHdr_PaymentRef varchar(50)," & _
        " @TrxHdr_PeriodUnits decimal(18,2)," & _
        " @TrxHdr_AnnualUnits decimal(18,2)," & _
        " @TrxHdr_AnnualLeave decimal(18,2)," & _
        " @TrxHdr_LifeInsurance decimal(18,2)," & _
        " @TrxHdr_Discounts decimal(18,2)," & _
        " @TrxHdr_Interfacestatus varchar(4)," & _
        " @TrxHdr_Overtime1 decimal(10,2)," & _
        " @TrxHdr_Overtime2 decimal(10,2)," & _
        " @TrxHdr_SIUnits decimal(10,2)," & _
        " @TrxHdr_MonthlySalary decimal(18,2)," & _
        " @TrxHdr_NetSalary decimal(18,2)," & _
        " @TrxHdr_PeriodInsurable decimal(18,2)," & _
        " @TemGrp_Code varchar(6)," & _
        " @TrxHdr_ChequeNo varchar(50)," & _
        " @TrxHdr_TaxableFromOther Decimal(18,2)," & _
        " @TrxHdr_CurrencySymbol varchar(3)," & _
        " @TrxHdr_Rate Decimal(18,10)," & _
        " @TrxHdr_NormalDays Decimal(18,2)," & _
        " @TrxHdr_Salary1 Decimal(18,2)," & _
        " @TrxHdr_Salary2 Decimal(18,2)," & _
        " @TrxHdr_Overtime3 decimal(10,2)," & _
        " @TrxHdr_Sectors decimal(18,2)," & _
        " @TrxHdr_Dutyhours decimal(18,2)," & _
        " @TrxHdr_FlightHours decimal(18,2)," & _
        " @TrxHdr_Commission decimal(18,2)," & _
        " @TrxHdr_PBAmount decimal(18,2)," & _
        " @TrxHdr_PBRate decimal(18,2)," & _
        " @TrxHdr_Overlay decimal(18,2)," & _
        " @TrxHdr_PeriodSplit decimal(18,2)," & _
        " @TrxHdr_PeriodSplitSI decimal(18,2)," & _
        " @TrxHdr_A1 varchar(12), " & _
        " @TrxHdr_A2 varchar(12), " & _
        " @TrxHdr_A3 varchar(12), " & _
        " @TrxHdr_A4 varchar(12), " & _
        " @TrxHdr_A5 varchar(12), " & _
        " @TrxHdr_Union varchar(12), " & _
        " @TrxHdr_Position varchar(12), " & _
        " @TrxHdr_COLA decimal(18, 2)," & _
        " @TrxHdr_MyRate decimal(18, 4)," & _
        " @TrxHdr_FE decimal(18, 2)," & _
        " @NewId Int OUTPUT" & _
        " AS" & _
        " DECLARE @Result as Int" & _
        " Set  @Result = 0" & _
        " SELECT @Result = Count(*)" & _
        " FROM PrTxTrxnHeader" & _
        " WHERE TrxHdr_Id =  @TrxHdr_Id" & _
        " IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        "   INSERT INTO PrTxTrxnHeader" & _
        "   (Emp_Code,                                           " & _
        " PrdGrp_Code," & _
        " PrdCod_Code,                                        " & _
        " PayCat_Code,                                        " & _
        " TrxHdr_Date,                                        " & _
        " TrxHdr_Status,                                      " & _
        " TrxHdr_TotalErnPeriod,                              " & _
        " TrxHdr_TotalErnYTD,                                 " & _
        " TrxHdr_TotalDedPeriod,                              " & _
        " TrxHdr_TotalDedYTD,                                 " & _
        " TrxHdr_TotalConPeriod,                              " & _
        " TrxHdr_TotalConYTD,                                 " & _
        " TrxHdr_SIIncome,                                    " & _
        " TrxHdr_TaxableIncome,                               " & _
        " TrxHdr_PaymentMethod,                               " & _
        " TrxHdr_PaymentRef,                                  " & _
        " TrxHdr_PeriodUnits,                                 " & _
        " TrxHdr_AnnualUnits,                                 " & _
        " TrxHdr_AnnualLeave,                                  " & _
        " TrxHdr_LifeInsurance,                                " & _
        " TrxHdr_Discounts,                                    " & _
        " TrxHdr_InterfaceStatus,                               " & _
        " TrxHdr_Overtime1," & _
        " TrxHdr_Overtime2," & _
        " TrxHdr_SIUnits," & _
        " TrxHdr_MonthlySalary," & _
        " TrxHdr_NetSalary," & _
        " TrxHdr_PeriodInsurable," & _
        " TemGrp_Code," & _
        " TrxHdr_ChequeNo," & _
        " TrxHdr_TaxableFromOther," & _
        " TrxHdr_CurrencySymbol," & _
        " TrxHdr_Rate," & _
        " TrxHdr_NormalDays," & _
        " TrxHdr_Salary1," & _
        " TrxHdr_Salary2," & _
        " TrxHdr_Overtime3," & _
        " TrxHdr_Sectors," & _
        " TrxHdr_Dutyhours," & _
        " TrxHdr_FlightHours," & _
        " TrxHdr_Commission," & _
        " TrxHdr_PBAmount," & _
        " TrxHdr_PBRate," & _
        " TrxHdr_Overlay," & _
        " TrxHdr_PeriodSplit, " & _
        " TrxHdr_PeriodSplitSI, " & _
        " TrxHdr_A1, " & _
        " TrxHdr_A2, " & _
        " TrxHdr_A3, " & _
        " TrxHdr_A4, " & _
        " TrxHdr_A5, " & _
        " TrxHdr_Union, " & _
        " TrxHdr_Position, " & _
        " TrxHdr_COLA," & _
        " TrxHdr_MyRate, " & _
        " TrxHdr_FE " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @PrdGrp_Code," & _
        " @PrdCod_Code,                                        " & _
        " @PayCat_Code,                                        " & _
        " @TrxHdr_Date,                                        " & _
        " @TrxHdr_Status,                                      " & _
        " @TrxHdr_TotalErnPeriod,                              " & _
        " @TrxHdr_TotalErnYTD,                                 " & _
        " @TrxHdr_TotalDedPeriod,                              " & _
        " @TrxHdr_TotalDedYTD,                                 " & _
        " @TrxHdr_TotalConPeriod,                              " & _
        " @TrxHdr_TotalConYTD,                                 " & _
        " @TrxHdr_SIIncome,                                    " & _
        " @TrxHdr_TaxableIncome,                               " & _
        " @TrxHdr_PaymentMethod,                               " & _
        " @TrxHdr_PaymentRef,                                  " & _
        " @TrxHdr_PeriodUnits,                                 " & _
        " @TrxHdr_AnnualUnits,                                 " & _
        " @TrxHdr_AnnualLeave,                                 " & _
        " @TrxHdr_LifeInsurance,                               " & _
        " @TrxHdr_Discounts,                                   " & _
        " @TrxHdr_InterfaceStatus,                              " & _
        " @TrxHdr_Overtime1," & _
        " @TrxHdr_Overtime2," & _
        " @TrxHdr_SIUnits," & _
        " @TrxHdr_MonthlySalary," & _
        " @TrxHdr_NetSalary," & _
        " @TrxHdr_PeriodInsurable," & _
        " @TemGrp_Code, " & _
        " @TrxHdr_ChequeNo," & _
        " @TrxHdr_TaxableFromOther," & _
        " @TrxHdr_CurrencySymbol," & _
        " @TrxHdr_Rate," & _
        " @TrxHdr_NormalDays," & _
        " @TrxHdr_Salary1," & _
        " @TrxHdr_Salary2," & _
        " @TrxHdr_Overtime3," & _
        " @TrxHdr_Sectors," & _
        " @TrxHdr_Dutyhours," & _
        " @TrxHdr_FlightHours," & _
        " @TrxHdr_Commission," & _
        " @TrxHdr_PBAmount," & _
        " @TrxHdr_PBRate," & _
        " @TrxHdr_Overlay," & _
        " @TrxHdr_PeriodSplit, " & _
        " @TrxHdr_PeriodSplitSI, " & _
        " @TrxHdr_A1, " & _
        " @TrxHdr_A2, " & _
        " @TrxHdr_A3, " & _
        " @TrxHdr_A4, " & _
        " @TrxHdr_A5, " & _
        " @TrxHdr_Union, " & _
        " @TrxHdr_Position, " & _
        " @TrxHdr_COLA," & _
        " @TrxHdr_MyRate," & _
        " @TrxHdr_FE " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrTxTrxnHeader" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     PrdGrp_Code=@PrdGrp_Code," & _
        "     PrdCod_Code=@PrdCod_Code,                             " & _
        "     PayCat_Code=@PayCat_Code,                             " & _
        "     TrxHdr_Date=@TrxHdr_Date,                             " & _
        "    TrxHdr_Status=@TrxHdr_Status,                         " & _
        "  TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " & _
        "     TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " & _
        "    TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " & _
        "   TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " & _
        "  TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " & _
        " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " & _
        " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " & _
        " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " & _
        " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " & _
        " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " & _
        " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " & _
        " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " & _
        " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,                " & _
        " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " & _
        " TrxHdr_Discounts=@TrxHdr_Discounts,                    " & _
        " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,        " & _
        " TrxHdr_Overtime1=@TrxHdr_Overtime1," & _
        " TrxHdr_Overtime2=@TrxHdr_Overtime2," & _
        " TrxHdr_SIUnits=@TrxHdr_SIUnits," & _
        " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary," & _
        " TrxHdr_NetSalary=@TrxHdr_NetSalary," & _
        " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable," & _
        " TemGrp_Code=@TemGrp_Code," & _
        " TrxHdr_ChequeNo=@TrxHdr_ChequeNo ," & _
        " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther," & _
        " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol," & _
        " TrxHdr_Rate=@TrxHdr_Rate," & _
        " TrxHdr_NormalDays=@TrxHdr_NormalDays ," & _
        " TrxHdr_Salary1=@TrxHdr_Salary1," & _
        " TrxHdr_Salary2=@TrxHdr_Salary2," & _
        " TrxHdr_Overtime3=@TrxHdr_Overtime3," & _
        " TrxHdr_Sectors=@TrxHdr_Sectors," & _
        " TrxHdr_Dutyhours=@TrxHdr_Dutyhours," & _
        " TrxHdr_FlightHours=@TrxHdr_FlightHours," & _
        " TrxHdr_Commission=@TrxHdr_Commission," & _
        " TrxHdr_PBAmount=@TrxHdr_PBAmount," & _
        " TrxHdr_PBRate=@TrxHdr_PBRate," & _
        " TrxHdr_Overlay=@TrxHdr_Overlay," & _
        " TrxHdr_PeriodSplit=@TrxHdr_PeriodSplit, " & _
        " TrxHdr_PeriodSplitSI=@TrxHdr_PeriodSplitSI," & _
        " TrxHdr_A1=@TrxHdr_A1, " & _
        " TrxHdr_A2=@TrxHdr_A2, " & _
        " TrxHdr_A3=@TrxHdr_A3, " & _
        " TrxHdr_A4=@TrxHdr_A4, " & _
        " TrxHdr_A5=@TrxHdr_A5, " & _
        " TrxHdr_Union=@TrxHdr_Union, " & _
        " TrxHdr_Position=@TrxHdr_Position, " & _
        " TrxHdr_COLA=@TrxHdr_COLA," & _
        " TrxHdr_MyRate=@TrxHdr_MyRate, " & _
        " TrxHdr_FE=@TrxHdr_FE " & _
        " WHERE TrxHdr_Id = @TrxHdr_Id" & _
        " END" & _
        " set  @NewId=SCOPE_IDENTITY()"

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If


        Str = " CREATE TABLE [dbo].[PrTxAIMS](" & _
         " [No] [varchar](10) NULL," & _
        " [Employee] [varchar](100) NULL," & _
        " [Sectors] [varchar](10) NULL," & _
        " [DutyHours] [varchar](10) NULL," & _
        " [FlightHours] [varchar](10) NULL" & _
        " ) ON [PRIMARY]"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New Table was created", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable Create New Table", MsgBoxStyle.Critical)
        End If

        Return Proceed

    End Function
    Protected Function Upgrade2018_1() As Boolean
        Dim Str As String
        Dim i As Integer
        Str = " ALTER TABLE PrTxtrxnheader " & _
        " ADD [TrxHdr_NetYTD] [decimal](18, 2) NULL "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If


        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE]" & _
        " @TrxHdr_Id int," & _
        " @Emp_Code varchar(16)," & _
        " @PrdGrp_Code varchar(6)," & _
        " @PrdCod_Code varchar(6)," & _
        " @PayCat_Code varchar(4)," & _
        " @TrxHdr_Date datetime," & _
        " @TrxHdr_Status varchar(4)," & _
        " @TrxHdr_TotalErnPeriod decimal(18,2)," & _
        " @TrxHdr_TotalErnYTD decimal(18,2)," & _
        " @TrxHdr_TotalDedPeriod decimal(18,2)," & _
        " @TrxHdr_TotalDedYTD decimal(18,2)," & _
        " @TrxHdr_TotalConPeriod decimal(18,2)," & _
        " @TrxHdr_TotalConYTD decimal(18,2)," & _
        " @TrxHdr_SIIncome decimal(18,2)," & _
        " @TrxHdr_TaxableIncome decimal(18,2)," & _
        " @TrxHdr_PaymentMethod varchar(50)," & _
        " @TrxHdr_PaymentRef varchar(50)," & _
        " @TrxHdr_PeriodUnits decimal(18,2)," & _
        " @TrxHdr_AnnualUnits decimal(18,2)," & _
        " @TrxHdr_AnnualLeave decimal(18,2)," & _
        " @TrxHdr_LifeInsurance decimal(18,2)," & _
        " @TrxHdr_Discounts decimal(18,2)," & _
        " @TrxHdr_Interfacestatus varchar(4)," & _
        " @TrxHdr_Overtime1 decimal(10,2)," & _
        " @TrxHdr_Overtime2 decimal(10,2)," & _
        " @TrxHdr_SIUnits decimal(10,2)," & _
        " @TrxHdr_MonthlySalary decimal(18,2)," & _
        " @TrxHdr_NetSalary decimal(18,2)," & _
        " @TrxHdr_PeriodInsurable decimal(18,2)," & _
        " @TemGrp_Code varchar(6)," & _
        " @TrxHdr_ChequeNo varchar(50)," & _
        " @TrxHdr_TaxableFromOther Decimal(18,2)," & _
        " @TrxHdr_CurrencySymbol varchar(3)," & _
        " @TrxHdr_Rate Decimal(18,10)," & _
        " @TrxHdr_NormalDays Decimal(18,2)," & _
        " @TrxHdr_Salary1 Decimal(18,2)," & _
        " @TrxHdr_Salary2 Decimal(18,2)," & _
        " @TrxHdr_Overtime3 decimal(10,2)," & _
        " @TrxHdr_Sectors decimal(18,2)," & _
        " @TrxHdr_Dutyhours decimal(18,2)," & _
        " @TrxHdr_FlightHours decimal(18,2)," & _
        " @TrxHdr_Commission decimal(18,2)," & _
        " @TrxHdr_PBAmount decimal(18,2)," & _
        " @TrxHdr_PBRate decimal(18,2)," & _
        " @TrxHdr_Overlay decimal(18,2)," & _
        " @TrxHdr_PeriodSplit decimal(18,2)," & _
        " @TrxHdr_PeriodSplitSI decimal(18,2)," & _
        " @TrxHdr_A1 varchar(12), " & _
        " @TrxHdr_A2 varchar(12), " & _
        " @TrxHdr_A3 varchar(12), " & _
        " @TrxHdr_A4 varchar(12), " & _
        " @TrxHdr_A5 varchar(12), " & _
        " @TrxHdr_Union varchar(12), " & _
        " @TrxHdr_Position varchar(12), " & _
        " @TrxHdr_COLA decimal(18, 2)," & _
        " @TrxHdr_MyRate decimal(18, 4)," & _
        " @TrxHdr_FE decimal(18, 2)," & _
        " @TrxHdr_NetYTD decimal(18, 2)," & _
        " @NewId Int OUTPUT" & _
        " AS" & _
        " DECLARE @Result as Int" & _
        " Set  @Result = 0" & _
        " SELECT @Result = Count(*)" & _
        " FROM PrTxTrxnHeader" & _
        " WHERE TrxHdr_Id =  @TrxHdr_Id" & _
        " IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        "   INSERT INTO PrTxTrxnHeader" & _
        "   (Emp_Code,                                           " & _
        " PrdGrp_Code," & _
        " PrdCod_Code,                                        " & _
        " PayCat_Code,                                        " & _
        " TrxHdr_Date,                                        " & _
        " TrxHdr_Status,                                      " & _
        " TrxHdr_TotalErnPeriod,                              " & _
        " TrxHdr_TotalErnYTD,                                 " & _
        " TrxHdr_TotalDedPeriod,                              " & _
        " TrxHdr_TotalDedYTD,                                 " & _
        " TrxHdr_TotalConPeriod,                              " & _
        " TrxHdr_TotalConYTD,                                 " & _
        " TrxHdr_SIIncome,                                    " & _
        " TrxHdr_TaxableIncome,                               " & _
        " TrxHdr_PaymentMethod,                               " & _
        " TrxHdr_PaymentRef,                                  " & _
        " TrxHdr_PeriodUnits,                                 " & _
        " TrxHdr_AnnualUnits,                                 " & _
        " TrxHdr_AnnualLeave,                                  " & _
        " TrxHdr_LifeInsurance,                                " & _
        " TrxHdr_Discounts,                                    " & _
        " TrxHdr_InterfaceStatus,                               " & _
        " TrxHdr_Overtime1," & _
        " TrxHdr_Overtime2," & _
        " TrxHdr_SIUnits," & _
        " TrxHdr_MonthlySalary," & _
        " TrxHdr_NetSalary," & _
        " TrxHdr_PeriodInsurable," & _
        " TemGrp_Code," & _
        " TrxHdr_ChequeNo," & _
        " TrxHdr_TaxableFromOther," & _
        " TrxHdr_CurrencySymbol," & _
        " TrxHdr_Rate," & _
        " TrxHdr_NormalDays," & _
        " TrxHdr_Salary1," & _
        " TrxHdr_Salary2," & _
        " TrxHdr_Overtime3," & _
        " TrxHdr_Sectors," & _
        " TrxHdr_Dutyhours," & _
        " TrxHdr_FlightHours," & _
        " TrxHdr_Commission," & _
        " TrxHdr_PBAmount," & _
        " TrxHdr_PBRate," & _
        " TrxHdr_Overlay," & _
        " TrxHdr_PeriodSplit, " & _
        " TrxHdr_PeriodSplitSI, " & _
        " TrxHdr_A1, " & _
        " TrxHdr_A2, " & _
        " TrxHdr_A3, " & _
        " TrxHdr_A4, " & _
        " TrxHdr_A5, " & _
        " TrxHdr_Union, " & _
        " TrxHdr_Position, " & _
        " TrxHdr_COLA," & _
        " TrxHdr_MyRate, " & _
        " TrxHdr_FE, " & _
        " TrxHdr_NetYTD " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @PrdGrp_Code," & _
        " @PrdCod_Code,                                        " & _
        " @PayCat_Code,                                        " & _
        " @TrxHdr_Date,                                        " & _
        " @TrxHdr_Status,                                      " & _
        " @TrxHdr_TotalErnPeriod,                              " & _
        " @TrxHdr_TotalErnYTD,                                 " & _
        " @TrxHdr_TotalDedPeriod,                              " & _
        " @TrxHdr_TotalDedYTD,                                 " & _
        " @TrxHdr_TotalConPeriod,                              " & _
        " @TrxHdr_TotalConYTD,                                 " & _
        " @TrxHdr_SIIncome,                                    " & _
        " @TrxHdr_TaxableIncome,                               " & _
        " @TrxHdr_PaymentMethod,                               " & _
        " @TrxHdr_PaymentRef,                                  " & _
        " @TrxHdr_PeriodUnits,                                 " & _
        " @TrxHdr_AnnualUnits,                                 " & _
        " @TrxHdr_AnnualLeave,                                 " & _
        " @TrxHdr_LifeInsurance,                               " & _
        " @TrxHdr_Discounts,                                   " & _
        " @TrxHdr_InterfaceStatus,                              " & _
        " @TrxHdr_Overtime1," & _
        " @TrxHdr_Overtime2," & _
        " @TrxHdr_SIUnits," & _
        " @TrxHdr_MonthlySalary," & _
        " @TrxHdr_NetSalary," & _
        " @TrxHdr_PeriodInsurable," & _
        " @TemGrp_Code, " & _
        " @TrxHdr_ChequeNo," & _
        " @TrxHdr_TaxableFromOther," & _
        " @TrxHdr_CurrencySymbol," & _
        " @TrxHdr_Rate," & _
        " @TrxHdr_NormalDays," & _
        " @TrxHdr_Salary1," & _
        " @TrxHdr_Salary2," & _
        " @TrxHdr_Overtime3," & _
        " @TrxHdr_Sectors," & _
        " @TrxHdr_Dutyhours," & _
        " @TrxHdr_FlightHours," & _
        " @TrxHdr_Commission," & _
        " @TrxHdr_PBAmount," & _
        " @TrxHdr_PBRate," & _
        " @TrxHdr_Overlay," & _
        " @TrxHdr_PeriodSplit, " & _
        " @TrxHdr_PeriodSplitSI, " & _
        " @TrxHdr_A1, " & _
        " @TrxHdr_A2, " & _
        " @TrxHdr_A3, " & _
        " @TrxHdr_A4, " & _
        " @TrxHdr_A5, " & _
        " @TrxHdr_Union, " & _
        " @TrxHdr_Position, " & _
        " @TrxHdr_COLA," & _
        " @TrxHdr_MyRate," & _
        " @TrxHdr_FE, " & _
        " @TrxHdr_NetYTD " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrTxTrxnHeader" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     PrdGrp_Code=@PrdGrp_Code," & _
        "     PrdCod_Code=@PrdCod_Code,                             " & _
        "     PayCat_Code=@PayCat_Code,                             " & _
        "     TrxHdr_Date=@TrxHdr_Date,                             " & _
        "    TrxHdr_Status=@TrxHdr_Status,                         " & _
        "  TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " & _
        "     TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " & _
        "    TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " & _
        "   TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " & _
        "  TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " & _
        " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " & _
        " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " & _
        " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " & _
        " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " & _
        " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " & _
        " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " & _
        " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " & _
        " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,                " & _
        " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " & _
        " TrxHdr_Discounts=@TrxHdr_Discounts,                    " & _
        " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,        " & _
        " TrxHdr_Overtime1=@TrxHdr_Overtime1," & _
        " TrxHdr_Overtime2=@TrxHdr_Overtime2," & _
        " TrxHdr_SIUnits=@TrxHdr_SIUnits," & _
        " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary," & _
        " TrxHdr_NetSalary=@TrxHdr_NetSalary," & _
        " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable," & _
        " TemGrp_Code=@TemGrp_Code," & _
        " TrxHdr_ChequeNo=@TrxHdr_ChequeNo ," & _
        " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther," & _
        " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol," & _
        " TrxHdr_Rate=@TrxHdr_Rate," & _
        " TrxHdr_NormalDays=@TrxHdr_NormalDays ," & _
        " TrxHdr_Salary1=@TrxHdr_Salary1," & _
        " TrxHdr_Salary2=@TrxHdr_Salary2," & _
        " TrxHdr_Overtime3=@TrxHdr_Overtime3," & _
        " TrxHdr_Sectors=@TrxHdr_Sectors," & _
        " TrxHdr_Dutyhours=@TrxHdr_Dutyhours," & _
        " TrxHdr_FlightHours=@TrxHdr_FlightHours," & _
        " TrxHdr_Commission=@TrxHdr_Commission," & _
        " TrxHdr_PBAmount=@TrxHdr_PBAmount," & _
        " TrxHdr_PBRate=@TrxHdr_PBRate," & _
        " TrxHdr_Overlay=@TrxHdr_Overlay," & _
        " TrxHdr_PeriodSplit=@TrxHdr_PeriodSplit, " & _
        " TrxHdr_PeriodSplitSI=@TrxHdr_PeriodSplitSI," & _
        " TrxHdr_A1=@TrxHdr_A1, " & _
        " TrxHdr_A2=@TrxHdr_A2, " & _
        " TrxHdr_A3=@TrxHdr_A3, " & _
        " TrxHdr_A4=@TrxHdr_A4, " & _
        " TrxHdr_A5=@TrxHdr_A5, " & _
        " TrxHdr_Union=@TrxHdr_Union, " & _
        " TrxHdr_Position=@TrxHdr_Position, " & _
        " TrxHdr_COLA=@TrxHdr_COLA," & _
        " TrxHdr_MyRate=@TrxHdr_MyRate, " & _
        " TrxHdr_FE=@TrxHdr_FE, " & _
        " TrxHdr_NetYTD=@TrxHdr_NetYTD " & _
        " WHERE TrxHdr_Id = @TrxHdr_Id" & _
        " END" & _
        " set  @NewId=SCOPE_IDENTITY()"

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If




        Return Proceed

    End Function
    Protected Function Upgrade_2018_2()

        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " & _
        " ADD [Emp_BankBenName] [nvarchar](60) NULL"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        Str = "update PrMsEmployees " & _
               " set Emp_BankBenName=''"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("set All Values to ''", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set values to ''", MsgBoxStyle.Critical)
        End If

        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" & _
        " @Emp_Code varchar(16)," & _
        " @Emp_Status char(1)," & _
        " @PayTyp_Code varchar(4)," & _
        " @TemGrp_Code varchar(6)," & _
        " @EmpSta_Code char(1)," & _
        " @Emp_Title char(4)," & _
        " @Emp_LastName nvarchar(30)," & _
        " @Emp_FirstName nvarchar(30)," & _
        " @Emp_FullName nvarchar(60)," & _
        " @Emp_Sex char(1)," & _
        " @Emp_BirthDate smalldatetime," & _
        " @MarSta_Code char(1)," & _
        " @Emp_Address1 nvarchar(30)," & _
        " @Emp_Address2 nvarchar(30)," & _
        " @Emp_Address3 nvarchar(30)," & _
        " @Emp_PostCode varchar(30)," & _
        " @Emp_Telephone1 varchar(20)," & _
        " @Emp_Telephone2 varchar(20)," & _
        " @Emp_Email varchar(50)," & _
        " @Emp_SocialInsNumber varchar(20)," & _
        " @ComSin_EmpSocialInsNo varchar(20)," & _
        " @Emp_IdentificationCard varchar(10)," & _
        " @Emp_TaxID varchar(10)," & _
        " @Emp_PassportNumber varchar(10)," & _
        " @Emp_AlienNumber varchar(10)," & _
        " @TicTyp_Code char(1)," & _
        " @EmpAn1_Code varchar(12)," & _
        " @EmpAn2_Code varchar(12)," & _
        " @EmpAn3_Code varchar(12)," & _
        " @EmpAn4_Code varchar(12)," & _
        " @EmpAn5_Code varchar(12)," & _
        " @Uni_Code varchar(12)," & _
        " @Cou_Code char(2)," & _
        " @EmpPos_Code varchar(12)," & _
        " @Sic_Code varchar(4)," & _
        " @EmpCmm_Code varchar(4)," & _
        " @PayUni_Code varchar(4)," & _
        " @Emp_PeriodUnits int," & _
        " @Emp_AnnualUnits int," & _
        " @Cur_Code char(3)," & _
        " @PmtMth_Code varchar(4)," & _
        " @Bnk_Code varchar(12)," & _
        " @Emp_BankAccount varchar(30)," & _
        " @Bnk_CodeCo varchar(12)," & _
        " @Emp_BankAccountCo varchar(30)," & _
        " @Emp_StartDate smalldatetime," & _
        " @Emp_TerminateDate varchar(10)," & _
        " @Emp_OtherIncome1 decimal(8,2)," & _
        " @Emp_OtherIncome2 decimal(8,2)," & _
        " @Emp_OtherIncome3 decimal(8,2)," & _
        " @Emp_PreviousEarnings decimal(8,2)," & _
        " @Emp_PrevSIDeduct decimal(8,2)," & _
        " @Emp_PrevSIContribute decimal(8,2)," & _
        " @Emp_PrevITDeduct decimal(8,2)," & _
        " @Emp_PrevPFDeduct decimal(8,2)," & _
        " @ProFnd_Code varchar(4)," & _
        " @MedFnd_Code varchar(4)," & _
        " @SocInc_Code varchar(4)," & _
        " @Ind_Code varchar(4)," & _
        " @Une_Code varchar(4)," & _
        " @SocCoh_Code varchar(4)," & _
        " @Emp_CreationDate smalldatetime," & _
        " @Emp_CreatedBy int," & _
        " @Emp_AmendDate smalldatetime," & _
        " @Emp_AmendBy int," & _
        " @IntTem_Code varchar(6)," & _
        " @Emp_GLAnal1 varchar(12)," & _
        " @Emp_GLAnal2 varchar(12)," & _
        " @Emp_GLAnal3 varchar(12)," & _
        " @Emp_GLAnal4 varchar(12)," & _
        " @IntTem_PFCode varchar(6)," & _
        " @IntTem_MFCode varchar(6)," & _
        " @Emp_PensionNo varchar(7)," & _
        " @Emp_DrivingLicense varchar(20)," & _
        " @Emp_HasSI int," & _
        " @Emp_Pensiontype int," & _
        " @Emp_MyPayslipReport varchar(50)," & _
        " @Emp_IBAN varchar(40)," & _
        " @Emp_PreviousLifeIns decimal(18,2)," & _
        " @Emp_PreviousDis decimal(18,2)," & _
        " @Emp_PreviousST decimal(18,2)," & _
        " @Emp_OtherIncome4 decimal(18,2)," & _
        " @SecPay_Code varchar(4)," & _
        " @ComRat_Code varchar(4)," & _
        " @PerBon_Code varchar(4)," & _
        " @DutHou_Code varchar(4)," & _
        " @FliHou_Code varchar(4)," & _
        " @Emp_PassFullName varchar(100)," & _
        " @Emp_TravelDocs varchar(100)," & _
        " @Emp_FirstEmployment varchar(1)," & _
        " @OveLay_Code varchar(4)," & _
        " @Emp_Password varchar(20)," & _
        " @Emp_Splitemployement char(1), " & _
        " @Emp_NewEmployee char(1), " & _
        " @Emp_Force50Percent char(1), " & _
        " @Emp_Notes nvarchar(200), " & _
        " @Emp_BankBenName nvarchar(80) " & _
        " " & _
        " AS" & _
        " DECLARE @Result as Int" & _
        "   Set @Result = 0" & _
        "   SELECT @Result = Count(*)" & _
        "   FROM PrMsEmployees" & _
        "   WHERE Emp_Code = @Emp_Code" & _
        "   IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        " INSERT INTO PrMsEmployees" & _
        " (Emp_Code,                                           " & _
        " Emp_Status,                                         " & _
        " PayTyp_Code,                                        " & _
        " TemGrp_Code,                                        " & _
        " EmpSta_Code,                                        " & _
        " Emp_Title,                                          " & _
        " Emp_LastName,                                       " & _
        " Emp_FirstName,                                      " & _
        " Emp_FullName,                                       " & _
        " Emp_Sex,                                            " & _
        " Emp_BirthDate,                                      " & _
        " MarSta_Code,                                        " & _
        " Emp_Address1,                                       " & _
        " Emp_Address2,                                       " & _
        " Emp_Address3,                                       " & _
        " Emp_PostCode,                                       " & _
        " Emp_Telephone1,                                     " & _
        " Emp_Telephone2,                                     " & _
        " Emp_Email,                                          " & _
        " Emp_SocialInsNumber,                                " & _
        " ComSin_EmpSocialInsNo,                              " & _
        " Emp_IdentificationCard,                             " & _
        " Emp_TaxID,                                          " & _
        " Emp_PassportNumber,                                 " & _
        " Emp_AlienNumber,                                    " & _
        " TicTyp_Code,                                        " & _
        " EmpAn1_Code,                                        " & _
        " EmpAn2_Code,                                        " & _
        " EmpAn3_Code,                                        " & _
        " EmpAn4_Code,                                        " & _
        " EmpAn5_Code,                                        " & _
        " Uni_Code,                                           " & _
        " Cou_Code,                                           " & _
        " EmpPos_Code,                                        " & _
        " Sic_Code,                                           " & _
        " EmpCmm_Code,                                        " & _
        " PayUni_Code,                                        " & _
        " Emp_PeriodUnits,                                    " & _
        " Emp_AnnualUnits,                                    " & _
        " Cur_Code,                                           " & _
        " PmtMth_Code,                                        " & _
        " Bnk_Code,                                           " & _
        " Emp_BankAccount,                                    " & _
        " Bnk_CodeCo,                                         " & _
        " Emp_BankAccountCo,                                  " & _
        " Emp_StartDate,                                      " & _
        " Emp_TerminateDate,                                  " & _
        " Emp_OtherIncome1,                                   " & _
        " Emp_OtherIncome2,                                   " & _
        " Emp_OtherIncome3,                                   " & _
        " Emp_PreviousEarnings,                               " & _
        " Emp_PrevSIDeduct,                                   " & _
        " Emp_PrevSIContribute,                               " & _
        " Emp_PrevITDeduct,                                   " & _
        " Emp_PrevPFDeduct, " & _
        " ProFnd_Code," & _
        " MedFnd_Code," & _
        " SocInc_Code," & _
        " Ind_Code," & _
        " Une_Code," & _
        " SocCoh_Code," & _
        " Emp_CreationDate,                                   " & _
        " Emp_CreatedBy,                                      " & _
        " Emp_AmendDate,                                      " & _
        " Emp_AmendBy ,                                        " & _
        " IntTem_Code," & _
        " Emp_GLAnal1," & _
        " Emp_GLAnal2," & _
        " Emp_GLAnal3," & _
        " Emp_GLAnal4," & _
        " IntTem_PFCode," & _
        " IntTem_MFCode," & _
        " Emp_PensionNo," & _
        " Emp_DrivingLicense," & _
        " Emp_HasSI," & _
        " Emp_Pensiontype," & _
        " Emp_MyPayslipReport," & _
        " Emp_IBAN," & _
        " Emp_PreviousLifeIns," & _
        " Emp_PreviousDis," & _
        " Emp_PreviousST," & _
        " Emp_OtherIncome4," & _
        " SecPay_Code," & _
        " ComRat_Code," & _
        " PerBon_Code," & _
        " DutHou_Code," & _
        " FliHou_Code," & _
        " Emp_PassFullName," & _
        " Emp_TravelDocs," & _
        " Emp_FirstEmployment," & _
        " OveLay_Code, " & _
        " Emp_Password, " & _
        " Emp_Splitemployement, " & _
        " Emp_NewEmployee, " & _
        " Emp_Force50Percent, " & _
        " Emp_Notes, " & _
        " Emp_BankBenName " & _
        " " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @Emp_Status,                                         " & _
        " @PayTyp_Code,                                        " & _
        " @TemGrp_Code,                                        " & _
        " @EmpSta_Code,                                        " & _
        " @Emp_Title,                                          " & _
        " @Emp_LastName,                                       " & _
        " @Emp_FirstName,                                      " & _
        " @Emp_FullName,                                       " & _
        " @Emp_Sex,                                            " & _
        " @Emp_BirthDate,                                      " & _
        " @MarSta_Code,                                        " & _
        " @Emp_Address1,                                       " & _
        " @Emp_Address2,                                       " & _
        " @Emp_Address3,                                       " & _
        " @Emp_PostCode,                                       " & _
        " @Emp_Telephone1,                                     " & _
        " @Emp_Telephone2,                                     " & _
        " @Emp_Email,                                          " & _
        " @Emp_SocialInsNumber,                                " & _
        " @ComSin_EmpSocialInsNo,                              " & _
        " @Emp_IdentificationCard,                             " & _
        " @Emp_TaxID,                                          " & _
        " @Emp_PassportNumber,                                 " & _
        " @Emp_AlienNumber,                                    " & _
        " @TicTyp_Code,                                        " & _
        " @EmpAn1_Code,                                        " & _
        " @EmpAn2_Code,                                        " & _
        " @EmpAn3_Code,                                        " & _
        " @EmpAn4_Code,                                        " & _
        " @EmpAn5_Code,                                        " & _
        " @Uni_Code,                                           " & _
        " @Cou_Code,                                           " & _
        " @EmpPos_Code,                                        " & _
        " @Sic_Code,                                           " & _
        " @EmpCmm_Code,                                        " & _
        " @PayUni_Code,                                        " & _
        " @Emp_PeriodUnits,                                    " & _
        " @Emp_AnnualUnits,                                    " & _
        " @Cur_Code,                                           " & _
        " @PmtMth_Code,                                        " & _
        " @Bnk_Code,                                           " & _
        " @Emp_BankAccount,                                    " & _
        " @Bnk_CodeCo,                                         " & _
        " @Emp_BankAccountCo,                                  " & _
        " @Emp_StartDate,                                      " & _
        " @Emp_TerminateDate,                                  " & _
        " @Emp_OtherIncome1,                                   " & _
        " @Emp_OtherIncome2,                                   " & _
        " @Emp_OtherIncome3,                                   " & _
        " @Emp_PreviousEarnings,                               " & _
        " @Emp_PrevSIDeduct,                                   " & _
        " @Emp_PrevSIContribute,                               " & _
        " @Emp_PrevITDeduct,                                   " & _
        " @Emp_PrevPFDeduct,                                   " & _
        " @ProFnd_Code," & _
        " @MedFnd_Code," & _
        " @SocInc_Code," & _
        " @Ind_Code," & _
        " @Une_Code," & _
        " @SocCoh_Code," & _
        " @Emp_CreationDate,                                   " & _
        " @Emp_CreatedBy,                                      " & _
        " @Emp_AmendDate,                                      " & _
        " @Emp_AmendBy,                                         " & _
        " @IntTem_Code," & _
        " @Emp_GLAnal1," & _
        " @Emp_GLAnal2," & _
        " @Emp_GLAnal3," & _
        " @Emp_GLAnal4," & _
        " @IntTem_PFCode," & _
        " @IntTem_MFCode," & _
        " @Emp_PensionNo," & _
        " @Emp_DrivingLicense," & _
        " @Emp_HasSI," & _
        " @Emp_Pensiontype," & _
        " @Emp_MyPayslipReport," & _
        " @Emp_IBAN," & _
        " @Emp_PreviousLifeIns," & _
        " @Emp_PreviousDis," & _
        " @Emp_PreviousST," & _
        " @Emp_OtherIncome4," & _
        " @SecPay_Code," & _
        " @ComRat_Code," & _
        " @PerBon_Code," & _
        " @DutHou_Code," & _
        " @FliHou_Code," & _
        " @Emp_PassFullName," & _
        " @Emp_TravelDocs," & _
        " @Emp_FirstEmployment," & _
        " @OveLay_Code, " & _
        " @Emp_Password, " & _
        " @Emp_Splitemployement, " & _
        " @Emp_NewEmployee, " & _
        " @Emp_Force50Percent, " & _
        " @Emp_Notes, " & _
        " @Emp_BankBenName " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrMsEmployees" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     Emp_Status=@Emp_Status,                               " & _
        "    PayTyp_Code=@PayTyp_Code,                             " & _
        "    TemGrp_Code=@TemGrp_Code,                             " & _
        "    EmpSta_Code=@EmpSta_Code,                             " & _
        "    Emp_Title=@Emp_Title,                                 " & _
        "    Emp_LastName=@Emp_LastName,                           " & _
        "    Emp_FirstName=@Emp_FirstName,                         " & _
        "    Emp_FullName=@Emp_FullName,                           " & _
        "    Emp_Sex=@Emp_Sex,                                     " & _
        "    Emp_BirthDate=@Emp_BirthDate,                         " & _
        "    MarSta_Code=@MarSta_Code,                             " & _
        "    Emp_Address1=@Emp_Address1,                           " & _
        "    Emp_Address2=@Emp_Address2,                           " & _
        "    Emp_Address3=@Emp_Address3,                           " & _
        "    Emp_PostCode=@Emp_PostCode,                           " & _
        "    Emp_Telephone1=@Emp_Telephone1,                       " & _
        "    Emp_Telephone2=@Emp_Telephone2,                       " & _
        "    Emp_Email=@Emp_Email,                                 " & _
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " & _
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " & _
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " & _
        "   Emp_TaxID=@Emp_TaxID,                                 " & _
        "   Emp_PassportNumber=@Emp_PassportNumber,               " & _
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " & _
        "  TicTyp_Code=@TicTyp_Code,                             " & _
        "  EmpAn1_Code=@EmpAn1_Code,                             " & _
        "  EmpAn2_Code=@EmpAn2_Code,                             " & _
        "  EmpAn3_Code=@EmpAn3_Code,                             " & _
        " EmpAn4_Code=@EmpAn4_Code,                             " & _
        " EmpAn5_Code=@EmpAn5_Code,                             " & _
        " Uni_Code=@Uni_Code,                                   " & _
        " Cou_Code=@Cou_Code,                                   " & _
        " EmpPos_Code=@EmpPos_Code,                             " & _
        " Sic_Code=@Sic_Code,                                   " & _
        " EmpCmm_Code=@EmpCmm_Code,                             " & _
        " PayUni_Code=@PayUni_Code,                             " & _
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " & _
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " & _
        " Cur_Code=@Cur_Code,                                   " & _
        " PmtMth_Code=@PmtMth_Code,                             " & _
        " Bnk_Code=@Bnk_Code,                                   " & _
        " Emp_BankAccount=@Emp_BankAccount,                     " & _
        " Bnk_CodeCo=@Bnk_CodeCo,                               " & _
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " & _
        " Emp_StartDate=@Emp_StartDate,                         " & _
        " Emp_TerminateDate=@Emp_TerminateDate,                 " & _
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " & _
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " & _
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " & _
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " & _
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " & _
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " & _
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " & _
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " & _
        " ProFnd_Code=@ProFnd_Code," & _
        " MedFnd_Code=@MedFnd_Code," & _
        " SocInc_Code=@SocInc_Code," & _
        " Ind_Code=@Ind_Code," & _
        " Une_Code=@Une_Code," & _
        " SocCoh_Code=@SocCoh_Code," & _
        " Emp_CreationDate=@Emp_CreationDate,                   " & _
        " Emp_CreatedBy=@Emp_CreatedBy,                         " & _
        " Emp_AmendDate=@Emp_AmendDate,                         " & _
        " Emp_AmendBy=@Emp_AmendBy,                              " & _
        " IntTem_Code=@IntTem_Code," & _
        " Emp_GLAnal1=@Emp_GLAnal1," & _
        " Emp_GLAnal2=@Emp_GLAnal2," & _
        " Emp_GLAnal3=@Emp_GLAnal3," & _
        " Emp_GLAnal4=@Emp_GLAnal4," & _
        " IntTem_PFCode=@IntTem_PFCode," & _
        " IntTem_MFCode=@IntTem_MFCode," & _
        " Emp_PensionNo=@Emp_PensionNo," & _
        " Emp_DrivingLicense=@Emp_DrivingLicense," & _
        " Emp_HasSI=@Emp_HasSI," & _
        " Emp_Pensiontype=@Emp_Pensiontype," & _
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," & _
        " Emp_IBAN=@Emp_IBAN," & _
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," & _
        " Emp_PreviousDis=@Emp_PreviousDis," & _
        " Emp_PreviousST=@Emp_PreviousST," & _
        " Emp_OtherIncome4=@Emp_OtherIncome4," & _
        " SecPay_Code=@SecPay_Code," & _
        " ComRat_Code=@ComRat_Code," & _
        " PerBon_Code=@PerBon_Code," & _
        " DutHou_Code=@DutHou_Code," & _
        " FliHou_Code=@FliHou_Code," & _
        " Emp_PassFullName=@Emp_PassFullName," & _
        " Emp_TravelDocs=@Emp_TravelDocs," & _
        " Emp_FirstEmployment =@Emp_FirstEmployment," & _
        " OveLay_Code = @OveLay_Code, " & _
        " Emp_Password = @Emp_Password, " & _
        " Emp_Splitemployement = @Emp_Splitemployement, " & _
        " Emp_NewEmployee = @Emp_NewEmployee, " & _
        " Emp_Force50Percent = @Emp_Force50Percent, " & _
        " Emp_Notes = @Emp_Notes, " & _
        " Emp_BankBenName = @Emp_BankBenName " & _
        " WHERE Emp_Code = @Emp_Code" & _
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True


    End Function
    Protected Function Upgrade_2018_3()

        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " & _
        " ADD [Emp_AgreedSalary] [Decimal](18,2) NULL"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        Str = "update PrMsEmployees " & _
               " set Emp_AgreedSalary=0"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("set All Values to ''", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set values to ''", MsgBoxStyle.Critical)
        End If

        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" & _
        " @Emp_Code varchar(16)," & _
        " @Emp_Status char(1)," & _
        " @PayTyp_Code varchar(4)," & _
        " @TemGrp_Code varchar(6)," & _
        " @EmpSta_Code char(1)," & _
        " @Emp_Title char(4)," & _
        " @Emp_LastName nvarchar(30)," & _
        " @Emp_FirstName nvarchar(30)," & _
        " @Emp_FullName nvarchar(60)," & _
        " @Emp_Sex char(1)," & _
        " @Emp_BirthDate smalldatetime," & _
        " @MarSta_Code char(1)," & _
        " @Emp_Address1 nvarchar(30)," & _
        " @Emp_Address2 nvarchar(30)," & _
        " @Emp_Address3 nvarchar(30)," & _
        " @Emp_PostCode varchar(30)," & _
        " @Emp_Telephone1 varchar(20)," & _
        " @Emp_Telephone2 varchar(20)," & _
        " @Emp_Email varchar(50)," & _
        " @Emp_SocialInsNumber varchar(20)," & _
        " @ComSin_EmpSocialInsNo varchar(20)," & _
        " @Emp_IdentificationCard varchar(10)," & _
        " @Emp_TaxID varchar(10)," & _
        " @Emp_PassportNumber varchar(10)," & _
        " @Emp_AlienNumber varchar(10)," & _
        " @TicTyp_Code char(1)," & _
        " @EmpAn1_Code varchar(12)," & _
        " @EmpAn2_Code varchar(12)," & _
        " @EmpAn3_Code varchar(12)," & _
        " @EmpAn4_Code varchar(12)," & _
        " @EmpAn5_Code varchar(12)," & _
        " @Uni_Code varchar(12)," & _
        " @Cou_Code char(2)," & _
        " @EmpPos_Code varchar(12)," & _
        " @Sic_Code varchar(4)," & _
        " @EmpCmm_Code varchar(4)," & _
        " @PayUni_Code varchar(4)," & _
        " @Emp_PeriodUnits int," & _
        " @Emp_AnnualUnits int," & _
        " @Cur_Code char(3)," & _
        " @PmtMth_Code varchar(4)," & _
        " @Bnk_Code varchar(12)," & _
        " @Emp_BankAccount varchar(30)," & _
        " @Bnk_CodeCo varchar(12)," & _
        " @Emp_BankAccountCo varchar(30)," & _
        " @Emp_StartDate smalldatetime," & _
        " @Emp_TerminateDate varchar(10)," & _
        " @Emp_OtherIncome1 decimal(8,2)," & _
        " @Emp_OtherIncome2 decimal(8,2)," & _
        " @Emp_OtherIncome3 decimal(8,2)," & _
        " @Emp_PreviousEarnings decimal(8,2)," & _
        " @Emp_PrevSIDeduct decimal(8,2)," & _
        " @Emp_PrevSIContribute decimal(8,2)," & _
        " @Emp_PrevITDeduct decimal(8,2)," & _
        " @Emp_PrevPFDeduct decimal(8,2)," & _
        " @ProFnd_Code varchar(4)," & _
        " @MedFnd_Code varchar(4)," & _
        " @SocInc_Code varchar(4)," & _
        " @Ind_Code varchar(4)," & _
        " @Une_Code varchar(4)," & _
        " @SocCoh_Code varchar(4)," & _
        " @Emp_CreationDate smalldatetime," & _
        " @Emp_CreatedBy int," & _
        " @Emp_AmendDate smalldatetime," & _
        " @Emp_AmendBy int," & _
        " @IntTem_Code varchar(6)," & _
        " @Emp_GLAnal1 varchar(12)," & _
        " @Emp_GLAnal2 varchar(12)," & _
        " @Emp_GLAnal3 varchar(12)," & _
        " @Emp_GLAnal4 varchar(12)," & _
        " @IntTem_PFCode varchar(6)," & _
        " @IntTem_MFCode varchar(6)," & _
        " @Emp_PensionNo varchar(7)," & _
        " @Emp_DrivingLicense varchar(20)," & _
        " @Emp_HasSI int," & _
        " @Emp_Pensiontype int," & _
        " @Emp_MyPayslipReport varchar(50)," & _
        " @Emp_IBAN varchar(40)," & _
        " @Emp_PreviousLifeIns decimal(18,2)," & _
        " @Emp_PreviousDis decimal(18,2)," & _
        " @Emp_PreviousST decimal(18,2)," & _
        " @Emp_OtherIncome4 decimal(18,2)," & _
        " @SecPay_Code varchar(4)," & _
        " @ComRat_Code varchar(4)," & _
        " @PerBon_Code varchar(4)," & _
        " @DutHou_Code varchar(4)," & _
        " @FliHou_Code varchar(4)," & _
        " @Emp_PassFullName varchar(100)," & _
        " @Emp_TravelDocs varchar(100)," & _
        " @Emp_FirstEmployment varchar(1)," & _
        " @OveLay_Code varchar(4)," & _
        " @Emp_Password varchar(20)," & _
        " @Emp_Splitemployement char(1), " & _
        " @Emp_NewEmployee char(1), " & _
        " @Emp_Force50Percent char(1), " & _
        " @Emp_Notes nvarchar(200), " & _
        " @Emp_BankBenName nvarchar(80), " & _
        " @Emp_AgreedSalary decimal(18,2) " & _
        " " & _
        " AS" & _
        " DECLARE @Result as Int" & _
        "   Set @Result = 0" & _
        "   SELECT @Result = Count(*)" & _
        "   FROM PrMsEmployees" & _
        "   WHERE Emp_Code = @Emp_Code" & _
        "   IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        " INSERT INTO PrMsEmployees" & _
        " (Emp_Code,                                           " & _
        " Emp_Status,                                         " & _
        " PayTyp_Code,                                        " & _
        " TemGrp_Code,                                        " & _
        " EmpSta_Code,                                        " & _
        " Emp_Title,                                          " & _
        " Emp_LastName,                                       " & _
        " Emp_FirstName,                                      " & _
        " Emp_FullName,                                       " & _
        " Emp_Sex,                                            " & _
        " Emp_BirthDate,                                      " & _
        " MarSta_Code,                                        " & _
        " Emp_Address1,                                       " & _
        " Emp_Address2,                                       " & _
        " Emp_Address3,                                       " & _
        " Emp_PostCode,                                       " & _
        " Emp_Telephone1,                                     " & _
        " Emp_Telephone2,                                     " & _
        " Emp_Email,                                          " & _
        " Emp_SocialInsNumber,                                " & _
        " ComSin_EmpSocialInsNo,                              " & _
        " Emp_IdentificationCard,                             " & _
        " Emp_TaxID,                                          " & _
        " Emp_PassportNumber,                                 " & _
        " Emp_AlienNumber,                                    " & _
        " TicTyp_Code,                                        " & _
        " EmpAn1_Code,                                        " & _
        " EmpAn2_Code,                                        " & _
        " EmpAn3_Code,                                        " & _
        " EmpAn4_Code,                                        " & _
        " EmpAn5_Code,                                        " & _
        " Uni_Code,                                           " & _
        " Cou_Code,                                           " & _
        " EmpPos_Code,                                        " & _
        " Sic_Code,                                           " & _
        " EmpCmm_Code,                                        " & _
        " PayUni_Code,                                        " & _
        " Emp_PeriodUnits,                                    " & _
        " Emp_AnnualUnits,                                    " & _
        " Cur_Code,                                           " & _
        " PmtMth_Code,                                        " & _
        " Bnk_Code,                                           " & _
        " Emp_BankAccount,                                    " & _
        " Bnk_CodeCo,                                         " & _
        " Emp_BankAccountCo,                                  " & _
        " Emp_StartDate,                                      " & _
        " Emp_TerminateDate,                                  " & _
        " Emp_OtherIncome1,                                   " & _
        " Emp_OtherIncome2,                                   " & _
        " Emp_OtherIncome3,                                   " & _
        " Emp_PreviousEarnings,                               " & _
        " Emp_PrevSIDeduct,                                   " & _
        " Emp_PrevSIContribute,                               " & _
        " Emp_PrevITDeduct,                                   " & _
        " Emp_PrevPFDeduct, " & _
        " ProFnd_Code," & _
        " MedFnd_Code," & _
        " SocInc_Code," & _
        " Ind_Code," & _
        " Une_Code," & _
        " SocCoh_Code," & _
        " Emp_CreationDate,                                   " & _
        " Emp_CreatedBy,                                      " & _
        " Emp_AmendDate,                                      " & _
        " Emp_AmendBy ,                                        " & _
        " IntTem_Code," & _
        " Emp_GLAnal1," & _
        " Emp_GLAnal2," & _
        " Emp_GLAnal3," & _
        " Emp_GLAnal4," & _
        " IntTem_PFCode," & _
        " IntTem_MFCode," & _
        " Emp_PensionNo," & _
        " Emp_DrivingLicense," & _
        " Emp_HasSI," & _
        " Emp_Pensiontype," & _
        " Emp_MyPayslipReport," & _
        " Emp_IBAN," & _
        " Emp_PreviousLifeIns," & _
        " Emp_PreviousDis," & _
        " Emp_PreviousST," & _
        " Emp_OtherIncome4," & _
        " SecPay_Code," & _
        " ComRat_Code," & _
        " PerBon_Code," & _
        " DutHou_Code," & _
        " FliHou_Code," & _
        " Emp_PassFullName," & _
        " Emp_TravelDocs," & _
        " Emp_FirstEmployment," & _
        " OveLay_Code, " & _
        " Emp_Password, " & _
        " Emp_Splitemployement, " & _
        " Emp_NewEmployee, " & _
        " Emp_Force50Percent, " & _
        " Emp_Notes, " & _
        " Emp_BankBenName, " & _
        " Emp_AgreedSalary " & _
        " " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @Emp_Status,                                         " & _
        " @PayTyp_Code,                                        " & _
        " @TemGrp_Code,                                        " & _
        " @EmpSta_Code,                                        " & _
        " @Emp_Title,                                          " & _
        " @Emp_LastName,                                       " & _
        " @Emp_FirstName,                                      " & _
        " @Emp_FullName,                                       " & _
        " @Emp_Sex,                                            " & _
        " @Emp_BirthDate,                                      " & _
        " @MarSta_Code,                                        " & _
        " @Emp_Address1,                                       " & _
        " @Emp_Address2,                                       " & _
        " @Emp_Address3,                                       " & _
        " @Emp_PostCode,                                       " & _
        " @Emp_Telephone1,                                     " & _
        " @Emp_Telephone2,                                     " & _
        " @Emp_Email,                                          " & _
        " @Emp_SocialInsNumber,                                " & _
        " @ComSin_EmpSocialInsNo,                              " & _
        " @Emp_IdentificationCard,                             " & _
        " @Emp_TaxID,                                          " & _
        " @Emp_PassportNumber,                                 " & _
        " @Emp_AlienNumber,                                    " & _
        " @TicTyp_Code,                                        " & _
        " @EmpAn1_Code,                                        " & _
        " @EmpAn2_Code,                                        " & _
        " @EmpAn3_Code,                                        " & _
        " @EmpAn4_Code,                                        " & _
        " @EmpAn5_Code,                                        " & _
        " @Uni_Code,                                           " & _
        " @Cou_Code,                                           " & _
        " @EmpPos_Code,                                        " & _
        " @Sic_Code,                                           " & _
        " @EmpCmm_Code,                                        " & _
        " @PayUni_Code,                                        " & _
        " @Emp_PeriodUnits,                                    " & _
        " @Emp_AnnualUnits,                                    " & _
        " @Cur_Code,                                           " & _
        " @PmtMth_Code,                                        " & _
        " @Bnk_Code,                                           " & _
        " @Emp_BankAccount,                                    " & _
        " @Bnk_CodeCo,                                         " & _
        " @Emp_BankAccountCo,                                  " & _
        " @Emp_StartDate,                                      " & _
        " @Emp_TerminateDate,                                  " & _
        " @Emp_OtherIncome1,                                   " & _
        " @Emp_OtherIncome2,                                   " & _
        " @Emp_OtherIncome3,                                   " & _
        " @Emp_PreviousEarnings,                               " & _
        " @Emp_PrevSIDeduct,                                   " & _
        " @Emp_PrevSIContribute,                               " & _
        " @Emp_PrevITDeduct,                                   " & _
        " @Emp_PrevPFDeduct,                                   " & _
        " @ProFnd_Code," & _
        " @MedFnd_Code," & _
        " @SocInc_Code," & _
        " @Ind_Code," & _
        " @Une_Code," & _
        " @SocCoh_Code," & _
        " @Emp_CreationDate,                                   " & _
        " @Emp_CreatedBy,                                      " & _
        " @Emp_AmendDate,                                      " & _
        " @Emp_AmendBy,                                         " & _
        " @IntTem_Code," & _
        " @Emp_GLAnal1," & _
        " @Emp_GLAnal2," & _
        " @Emp_GLAnal3," & _
        " @Emp_GLAnal4," & _
        " @IntTem_PFCode," & _
        " @IntTem_MFCode," & _
        " @Emp_PensionNo," & _
        " @Emp_DrivingLicense," & _
        " @Emp_HasSI," & _
        " @Emp_Pensiontype," & _
        " @Emp_MyPayslipReport," & _
        " @Emp_IBAN," & _
        " @Emp_PreviousLifeIns," & _
        " @Emp_PreviousDis," & _
        " @Emp_PreviousST," & _
        " @Emp_OtherIncome4," & _
        " @SecPay_Code," & _
        " @ComRat_Code," & _
        " @PerBon_Code," & _
        " @DutHou_Code," & _
        " @FliHou_Code," & _
        " @Emp_PassFullName," & _
        " @Emp_TravelDocs," & _
        " @Emp_FirstEmployment," & _
        " @OveLay_Code, " & _
        " @Emp_Password, " & _
        " @Emp_Splitemployement, " & _
        " @Emp_NewEmployee, " & _
        " @Emp_Force50Percent, " & _
        " @Emp_Notes, " & _
        " @Emp_BankBenName, " & _
        " @Emp_AgreedSalary " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrMsEmployees" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     Emp_Status=@Emp_Status,                               " & _
        "    PayTyp_Code=@PayTyp_Code,                             " & _
        "    TemGrp_Code=@TemGrp_Code,                             " & _
        "    EmpSta_Code=@EmpSta_Code,                             " & _
        "    Emp_Title=@Emp_Title,                                 " & _
        "    Emp_LastName=@Emp_LastName,                           " & _
        "    Emp_FirstName=@Emp_FirstName,                         " & _
        "    Emp_FullName=@Emp_FullName,                           " & _
        "    Emp_Sex=@Emp_Sex,                                     " & _
        "    Emp_BirthDate=@Emp_BirthDate,                         " & _
        "    MarSta_Code=@MarSta_Code,                             " & _
        "    Emp_Address1=@Emp_Address1,                           " & _
        "    Emp_Address2=@Emp_Address2,                           " & _
        "    Emp_Address3=@Emp_Address3,                           " & _
        "    Emp_PostCode=@Emp_PostCode,                           " & _
        "    Emp_Telephone1=@Emp_Telephone1,                       " & _
        "    Emp_Telephone2=@Emp_Telephone2,                       " & _
        "    Emp_Email=@Emp_Email,                                 " & _
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " & _
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " & _
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " & _
        "   Emp_TaxID=@Emp_TaxID,                                 " & _
        "   Emp_PassportNumber=@Emp_PassportNumber,               " & _
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " & _
        "  TicTyp_Code=@TicTyp_Code,                             " & _
        "  EmpAn1_Code=@EmpAn1_Code,                             " & _
        "  EmpAn2_Code=@EmpAn2_Code,                             " & _
        "  EmpAn3_Code=@EmpAn3_Code,                             " & _
        " EmpAn4_Code=@EmpAn4_Code,                             " & _
        " EmpAn5_Code=@EmpAn5_Code,                             " & _
        " Uni_Code=@Uni_Code,                                   " & _
        " Cou_Code=@Cou_Code,                                   " & _
        " EmpPos_Code=@EmpPos_Code,                             " & _
        " Sic_Code=@Sic_Code,                                   " & _
        " EmpCmm_Code=@EmpCmm_Code,                             " & _
        " PayUni_Code=@PayUni_Code,                             " & _
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " & _
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " & _
        " Cur_Code=@Cur_Code,                                   " & _
        " PmtMth_Code=@PmtMth_Code,                             " & _
        " Bnk_Code=@Bnk_Code,                                   " & _
        " Emp_BankAccount=@Emp_BankAccount,                     " & _
        " Bnk_CodeCo=@Bnk_CodeCo,                               " & _
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " & _
        " Emp_StartDate=@Emp_StartDate,                         " & _
        " Emp_TerminateDate=@Emp_TerminateDate,                 " & _
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " & _
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " & _
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " & _
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " & _
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " & _
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " & _
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " & _
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " & _
        " ProFnd_Code=@ProFnd_Code," & _
        " MedFnd_Code=@MedFnd_Code," & _
        " SocInc_Code=@SocInc_Code," & _
        " Ind_Code=@Ind_Code," & _
        " Une_Code=@Une_Code," & _
        " SocCoh_Code=@SocCoh_Code," & _
        " Emp_CreationDate=@Emp_CreationDate,                   " & _
        " Emp_CreatedBy=@Emp_CreatedBy,                         " & _
        " Emp_AmendDate=@Emp_AmendDate,                         " & _
        " Emp_AmendBy=@Emp_AmendBy,                              " & _
        " IntTem_Code=@IntTem_Code," & _
        " Emp_GLAnal1=@Emp_GLAnal1," & _
        " Emp_GLAnal2=@Emp_GLAnal2," & _
        " Emp_GLAnal3=@Emp_GLAnal3," & _
        " Emp_GLAnal4=@Emp_GLAnal4," & _
        " IntTem_PFCode=@IntTem_PFCode," & _
        " IntTem_MFCode=@IntTem_MFCode," & _
        " Emp_PensionNo=@Emp_PensionNo," & _
        " Emp_DrivingLicense=@Emp_DrivingLicense," & _
        " Emp_HasSI=@Emp_HasSI," & _
        " Emp_Pensiontype=@Emp_Pensiontype," & _
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," & _
        " Emp_IBAN=@Emp_IBAN," & _
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," & _
        " Emp_PreviousDis=@Emp_PreviousDis," & _
        " Emp_PreviousST=@Emp_PreviousST," & _
        " Emp_OtherIncome4=@Emp_OtherIncome4," & _
        " SecPay_Code=@SecPay_Code," & _
        " ComRat_Code=@ComRat_Code," & _
        " PerBon_Code=@PerBon_Code," & _
        " DutHou_Code=@DutHou_Code," & _
        " FliHou_Code=@FliHou_Code," & _
        " Emp_PassFullName=@Emp_PassFullName," & _
        " Emp_TravelDocs=@Emp_TravelDocs," & _
        " Emp_FirstEmployment =@Emp_FirstEmployment," & _
        " OveLay_Code = @OveLay_Code, " & _
        " Emp_Password = @Emp_Password, " & _
        " Emp_Splitemployement = @Emp_Splitemployement, " & _
        " Emp_NewEmployee = @Emp_NewEmployee, " & _
        " Emp_Force50Percent = @Emp_Force50Percent, " & _
        " Emp_Notes = @Emp_Notes, " & _
        " Emp_BankBenName = @Emp_BankBenName, " & _
        " Emp_AgreedSalary = @Emp_AgreedSalary " & _
        " WHERE Emp_Code = @Emp_Code" & _
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True


    End Function
    Protected Function Upgrade_2018_4()

        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " & _
        " ADD [Emp_BonusOnSalary] [Decimal](18,2) NULL"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        Str = "update PrMsEmployees " & _
               " set Emp_BonusOnSalary=0"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("set All Values to ''", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set values to ''", MsgBoxStyle.Critical)
        End If

        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" & _
        " @Emp_Code varchar(16)," & _
        " @Emp_Status char(1)," & _
        " @PayTyp_Code varchar(4)," & _
        " @TemGrp_Code varchar(6)," & _
        " @EmpSta_Code char(1)," & _
        " @Emp_Title char(4)," & _
        " @Emp_LastName nvarchar(30)," & _
        " @Emp_FirstName nvarchar(30)," & _
        " @Emp_FullName nvarchar(60)," & _
        " @Emp_Sex char(1)," & _
        " @Emp_BirthDate smalldatetime," & _
        " @MarSta_Code char(1)," & _
        " @Emp_Address1 nvarchar(30)," & _
        " @Emp_Address2 nvarchar(30)," & _
        " @Emp_Address3 nvarchar(30)," & _
        " @Emp_PostCode varchar(30)," & _
        " @Emp_Telephone1 varchar(20)," & _
        " @Emp_Telephone2 varchar(20)," & _
        " @Emp_Email varchar(50)," & _
        " @Emp_SocialInsNumber varchar(20)," & _
        " @ComSin_EmpSocialInsNo varchar(20)," & _
        " @Emp_IdentificationCard varchar(10)," & _
        " @Emp_TaxID varchar(10)," & _
        " @Emp_PassportNumber varchar(10)," & _
        " @Emp_AlienNumber varchar(10)," & _
        " @TicTyp_Code char(1)," & _
        " @EmpAn1_Code varchar(12)," & _
        " @EmpAn2_Code varchar(12)," & _
        " @EmpAn3_Code varchar(12)," & _
        " @EmpAn4_Code varchar(12)," & _
        " @EmpAn5_Code varchar(12)," & _
        " @Uni_Code varchar(12)," & _
        " @Cou_Code char(2)," & _
        " @EmpPos_Code varchar(12)," & _
        " @Sic_Code varchar(4)," & _
        " @EmpCmm_Code varchar(4)," & _
        " @PayUni_Code varchar(4)," & _
        " @Emp_PeriodUnits int," & _
        " @Emp_AnnualUnits int," & _
        " @Cur_Code char(3)," & _
        " @PmtMth_Code varchar(4)," & _
        " @Bnk_Code varchar(12)," & _
        " @Emp_BankAccount varchar(30)," & _
        " @Bnk_CodeCo varchar(12)," & _
        " @Emp_BankAccountCo varchar(30)," & _
        " @Emp_StartDate smalldatetime," & _
        " @Emp_TerminateDate varchar(10)," & _
        " @Emp_OtherIncome1 decimal(8,2)," & _
        " @Emp_OtherIncome2 decimal(8,2)," & _
        " @Emp_OtherIncome3 decimal(8,2)," & _
        " @Emp_PreviousEarnings decimal(8,2)," & _
        " @Emp_PrevSIDeduct decimal(8,2)," & _
        " @Emp_PrevSIContribute decimal(8,2)," & _
        " @Emp_PrevITDeduct decimal(8,2)," & _
        " @Emp_PrevPFDeduct decimal(8,2)," & _
        " @ProFnd_Code varchar(4)," & _
        " @MedFnd_Code varchar(4)," & _
        " @SocInc_Code varchar(4)," & _
        " @Ind_Code varchar(4)," & _
        " @Une_Code varchar(4)," & _
        " @SocCoh_Code varchar(4)," & _
        " @Emp_CreationDate smalldatetime," & _
        " @Emp_CreatedBy int," & _
        " @Emp_AmendDate smalldatetime," & _
        " @Emp_AmendBy int," & _
        " @IntTem_Code varchar(6)," & _
        " @Emp_GLAnal1 varchar(12)," & _
        " @Emp_GLAnal2 varchar(12)," & _
        " @Emp_GLAnal3 varchar(12)," & _
        " @Emp_GLAnal4 varchar(12)," & _
        " @IntTem_PFCode varchar(6)," & _
        " @IntTem_MFCode varchar(6)," & _
        " @Emp_PensionNo varchar(7)," & _
        " @Emp_DrivingLicense varchar(20)," & _
        " @Emp_HasSI int," & _
        " @Emp_Pensiontype int," & _
        " @Emp_MyPayslipReport varchar(50)," & _
        " @Emp_IBAN varchar(40)," & _
        " @Emp_PreviousLifeIns decimal(18,2)," & _
        " @Emp_PreviousDis decimal(18,2)," & _
        " @Emp_PreviousST decimal(18,2)," & _
        " @Emp_OtherIncome4 decimal(18,2)," & _
        " @SecPay_Code varchar(4)," & _
        " @ComRat_Code varchar(4)," & _
        " @PerBon_Code varchar(4)," & _
        " @DutHou_Code varchar(4)," & _
        " @FliHou_Code varchar(4)," & _
        " @Emp_PassFullName varchar(100)," & _
        " @Emp_TravelDocs varchar(100)," & _
        " @Emp_FirstEmployment varchar(1)," & _
        " @OveLay_Code varchar(4)," & _
        " @Emp_Password varchar(20)," & _
        " @Emp_Splitemployement char(1), " & _
        " @Emp_NewEmployee char(1), " & _
        " @Emp_Force50Percent char(1), " & _
        " @Emp_Notes nvarchar(200), " & _
        " @Emp_BankBenName nvarchar(80), " & _
        " @Emp_AgreedSalary decimal(18,2), " & _
        " @Emp_BonusOnSalary decimal(18,2) " & _
        " " & _
        " AS" & _
        " DECLARE @Result as Int" & _
        "   Set @Result = 0" & _
        "   SELECT @Result = Count(*)" & _
        "   FROM PrMsEmployees" & _
        "   WHERE Emp_Code = @Emp_Code" & _
        "   IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        " INSERT INTO PrMsEmployees" & _
        " (Emp_Code,                                           " & _
        " Emp_Status,                                         " & _
        " PayTyp_Code,                                        " & _
        " TemGrp_Code,                                        " & _
        " EmpSta_Code,                                        " & _
        " Emp_Title,                                          " & _
        " Emp_LastName,                                       " & _
        " Emp_FirstName,                                      " & _
        " Emp_FullName,                                       " & _
        " Emp_Sex,                                            " & _
        " Emp_BirthDate,                                      " & _
        " MarSta_Code,                                        " & _
        " Emp_Address1,                                       " & _
        " Emp_Address2,                                       " & _
        " Emp_Address3,                                       " & _
        " Emp_PostCode,                                       " & _
        " Emp_Telephone1,                                     " & _
        " Emp_Telephone2,                                     " & _
        " Emp_Email,                                          " & _
        " Emp_SocialInsNumber,                                " & _
        " ComSin_EmpSocialInsNo,                              " & _
        " Emp_IdentificationCard,                             " & _
        " Emp_TaxID,                                          " & _
        " Emp_PassportNumber,                                 " & _
        " Emp_AlienNumber,                                    " & _
        " TicTyp_Code,                                        " & _
        " EmpAn1_Code,                                        " & _
        " EmpAn2_Code,                                        " & _
        " EmpAn3_Code,                                        " & _
        " EmpAn4_Code,                                        " & _
        " EmpAn5_Code,                                        " & _
        " Uni_Code,                                           " & _
        " Cou_Code,                                           " & _
        " EmpPos_Code,                                        " & _
        " Sic_Code,                                           " & _
        " EmpCmm_Code,                                        " & _
        " PayUni_Code,                                        " & _
        " Emp_PeriodUnits,                                    " & _
        " Emp_AnnualUnits,                                    " & _
        " Cur_Code,                                           " & _
        " PmtMth_Code,                                        " & _
        " Bnk_Code,                                           " & _
        " Emp_BankAccount,                                    " & _
        " Bnk_CodeCo,                                         " & _
        " Emp_BankAccountCo,                                  " & _
        " Emp_StartDate,                                      " & _
        " Emp_TerminateDate,                                  " & _
        " Emp_OtherIncome1,                                   " & _
        " Emp_OtherIncome2,                                   " & _
        " Emp_OtherIncome3,                                   " & _
        " Emp_PreviousEarnings,                               " & _
        " Emp_PrevSIDeduct,                                   " & _
        " Emp_PrevSIContribute,                               " & _
        " Emp_PrevITDeduct,                                   " & _
        " Emp_PrevPFDeduct, " & _
        " ProFnd_Code," & _
        " MedFnd_Code," & _
        " SocInc_Code," & _
        " Ind_Code," & _
        " Une_Code," & _
        " SocCoh_Code," & _
        " Emp_CreationDate,                                   " & _
        " Emp_CreatedBy,                                      " & _
        " Emp_AmendDate,                                      " & _
        " Emp_AmendBy ,                                        " & _
        " IntTem_Code," & _
        " Emp_GLAnal1," & _
        " Emp_GLAnal2," & _
        " Emp_GLAnal3," & _
        " Emp_GLAnal4," & _
        " IntTem_PFCode," & _
        " IntTem_MFCode," & _
        " Emp_PensionNo," & _
        " Emp_DrivingLicense," & _
        " Emp_HasSI," & _
        " Emp_Pensiontype," & _
        " Emp_MyPayslipReport," & _
        " Emp_IBAN," & _
        " Emp_PreviousLifeIns," & _
        " Emp_PreviousDis," & _
        " Emp_PreviousST," & _
        " Emp_OtherIncome4," & _
        " SecPay_Code," & _
        " ComRat_Code," & _
        " PerBon_Code," & _
        " DutHou_Code," & _
        " FliHou_Code," & _
        " Emp_PassFullName," & _
        " Emp_TravelDocs," & _
        " Emp_FirstEmployment," & _
        " OveLay_Code, " & _
        " Emp_Password, " & _
        " Emp_Splitemployement, " & _
        " Emp_NewEmployee, " & _
        " Emp_Force50Percent, " & _
        " Emp_Notes, " & _
        " Emp_BankBenName, " & _
        " Emp_AgreedSalary, " & _
        " Emp_BonusOnsalary " & _
        " " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @Emp_Status,                                         " & _
        " @PayTyp_Code,                                        " & _
        " @TemGrp_Code,                                        " & _
        " @EmpSta_Code,                                        " & _
        " @Emp_Title,                                          " & _
        " @Emp_LastName,                                       " & _
        " @Emp_FirstName,                                      " & _
        " @Emp_FullName,                                       " & _
        " @Emp_Sex,                                            " & _
        " @Emp_BirthDate,                                      " & _
        " @MarSta_Code,                                        " & _
        " @Emp_Address1,                                       " & _
        " @Emp_Address2,                                       " & _
        " @Emp_Address3,                                       " & _
        " @Emp_PostCode,                                       " & _
        " @Emp_Telephone1,                                     " & _
        " @Emp_Telephone2,                                     " & _
        " @Emp_Email,                                          " & _
        " @Emp_SocialInsNumber,                                " & _
        " @ComSin_EmpSocialInsNo,                              " & _
        " @Emp_IdentificationCard,                             " & _
        " @Emp_TaxID,                                          " & _
        " @Emp_PassportNumber,                                 " & _
        " @Emp_AlienNumber,                                    " & _
        " @TicTyp_Code,                                        " & _
        " @EmpAn1_Code,                                        " & _
        " @EmpAn2_Code,                                        " & _
        " @EmpAn3_Code,                                        " & _
        " @EmpAn4_Code,                                        " & _
        " @EmpAn5_Code,                                        " & _
        " @Uni_Code,                                           " & _
        " @Cou_Code,                                           " & _
        " @EmpPos_Code,                                        " & _
        " @Sic_Code,                                           " & _
        " @EmpCmm_Code,                                        " & _
        " @PayUni_Code,                                        " & _
        " @Emp_PeriodUnits,                                    " & _
        " @Emp_AnnualUnits,                                    " & _
        " @Cur_Code,                                           " & _
        " @PmtMth_Code,                                        " & _
        " @Bnk_Code,                                           " & _
        " @Emp_BankAccount,                                    " & _
        " @Bnk_CodeCo,                                         " & _
        " @Emp_BankAccountCo,                                  " & _
        " @Emp_StartDate,                                      " & _
        " @Emp_TerminateDate,                                  " & _
        " @Emp_OtherIncome1,                                   " & _
        " @Emp_OtherIncome2,                                   " & _
        " @Emp_OtherIncome3,                                   " & _
        " @Emp_PreviousEarnings,                               " & _
        " @Emp_PrevSIDeduct,                                   " & _
        " @Emp_PrevSIContribute,                               " & _
        " @Emp_PrevITDeduct,                                   " & _
        " @Emp_PrevPFDeduct,                                   " & _
        " @ProFnd_Code," & _
        " @MedFnd_Code," & _
        " @SocInc_Code," & _
        " @Ind_Code," & _
        " @Une_Code," & _
        " @SocCoh_Code," & _
        " @Emp_CreationDate,                                   " & _
        " @Emp_CreatedBy,                                      " & _
        " @Emp_AmendDate,                                      " & _
        " @Emp_AmendBy,                                         " & _
        " @IntTem_Code," & _
        " @Emp_GLAnal1," & _
        " @Emp_GLAnal2," & _
        " @Emp_GLAnal3," & _
        " @Emp_GLAnal4," & _
        " @IntTem_PFCode," & _
        " @IntTem_MFCode," & _
        " @Emp_PensionNo," & _
        " @Emp_DrivingLicense," & _
        " @Emp_HasSI," & _
        " @Emp_Pensiontype," & _
        " @Emp_MyPayslipReport," & _
        " @Emp_IBAN," & _
        " @Emp_PreviousLifeIns," & _
        " @Emp_PreviousDis," & _
        " @Emp_PreviousST," & _
        " @Emp_OtherIncome4," & _
        " @SecPay_Code," & _
        " @ComRat_Code," & _
        " @PerBon_Code," & _
        " @DutHou_Code," & _
        " @FliHou_Code," & _
        " @Emp_PassFullName," & _
        " @Emp_TravelDocs," & _
        " @Emp_FirstEmployment," & _
        " @OveLay_Code, " & _
        " @Emp_Password, " & _
        " @Emp_Splitemployement, " & _
        " @Emp_NewEmployee, " & _
        " @Emp_Force50Percent, " & _
        " @Emp_Notes, " & _
        " @Emp_BankBenName, " & _
        " @Emp_AgreedSalary, " & _
        " @Emp_BonusOnSalary " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrMsEmployees" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     Emp_Status=@Emp_Status,                               " & _
        "    PayTyp_Code=@PayTyp_Code,                             " & _
        "    TemGrp_Code=@TemGrp_Code,                             " & _
        "    EmpSta_Code=@EmpSta_Code,                             " & _
        "    Emp_Title=@Emp_Title,                                 " & _
        "    Emp_LastName=@Emp_LastName,                           " & _
        "    Emp_FirstName=@Emp_FirstName,                         " & _
        "    Emp_FullName=@Emp_FullName,                           " & _
        "    Emp_Sex=@Emp_Sex,                                     " & _
        "    Emp_BirthDate=@Emp_BirthDate,                         " & _
        "    MarSta_Code=@MarSta_Code,                             " & _
        "    Emp_Address1=@Emp_Address1,                           " & _
        "    Emp_Address2=@Emp_Address2,                           " & _
        "    Emp_Address3=@Emp_Address3,                           " & _
        "    Emp_PostCode=@Emp_PostCode,                           " & _
        "    Emp_Telephone1=@Emp_Telephone1,                       " & _
        "    Emp_Telephone2=@Emp_Telephone2,                       " & _
        "    Emp_Email=@Emp_Email,                                 " & _
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " & _
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " & _
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " & _
        "   Emp_TaxID=@Emp_TaxID,                                 " & _
        "   Emp_PassportNumber=@Emp_PassportNumber,               " & _
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " & _
        "  TicTyp_Code=@TicTyp_Code,                             " & _
        "  EmpAn1_Code=@EmpAn1_Code,                             " & _
        "  EmpAn2_Code=@EmpAn2_Code,                             " & _
        "  EmpAn3_Code=@EmpAn3_Code,                             " & _
        " EmpAn4_Code=@EmpAn4_Code,                             " & _
        " EmpAn5_Code=@EmpAn5_Code,                             " & _
        " Uni_Code=@Uni_Code,                                   " & _
        " Cou_Code=@Cou_Code,                                   " & _
        " EmpPos_Code=@EmpPos_Code,                             " & _
        " Sic_Code=@Sic_Code,                                   " & _
        " EmpCmm_Code=@EmpCmm_Code,                             " & _
        " PayUni_Code=@PayUni_Code,                             " & _
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " & _
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " & _
        " Cur_Code=@Cur_Code,                                   " & _
        " PmtMth_Code=@PmtMth_Code,                             " & _
        " Bnk_Code=@Bnk_Code,                                   " & _
        " Emp_BankAccount=@Emp_BankAccount,                     " & _
        " Bnk_CodeCo=@Bnk_CodeCo,                               " & _
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " & _
        " Emp_StartDate=@Emp_StartDate,                         " & _
        " Emp_TerminateDate=@Emp_TerminateDate,                 " & _
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " & _
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " & _
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " & _
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " & _
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " & _
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " & _
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " & _
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " & _
        " ProFnd_Code=@ProFnd_Code," & _
        " MedFnd_Code=@MedFnd_Code," & _
        " SocInc_Code=@SocInc_Code," & _
        " Ind_Code=@Ind_Code," & _
        " Une_Code=@Une_Code," & _
        " SocCoh_Code=@SocCoh_Code," & _
        " Emp_CreationDate=@Emp_CreationDate,                   " & _
        " Emp_CreatedBy=@Emp_CreatedBy,                         " & _
        " Emp_AmendDate=@Emp_AmendDate,                         " & _
        " Emp_AmendBy=@Emp_AmendBy,                              " & _
        " IntTem_Code=@IntTem_Code," & _
        " Emp_GLAnal1=@Emp_GLAnal1," & _
        " Emp_GLAnal2=@Emp_GLAnal2," & _
        " Emp_GLAnal3=@Emp_GLAnal3," & _
        " Emp_GLAnal4=@Emp_GLAnal4," & _
        " IntTem_PFCode=@IntTem_PFCode," & _
        " IntTem_MFCode=@IntTem_MFCode," & _
        " Emp_PensionNo=@Emp_PensionNo," & _
        " Emp_DrivingLicense=@Emp_DrivingLicense," & _
        " Emp_HasSI=@Emp_HasSI," & _
        " Emp_Pensiontype=@Emp_Pensiontype," & _
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," & _
        " Emp_IBAN=@Emp_IBAN," & _
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," & _
        " Emp_PreviousDis=@Emp_PreviousDis," & _
        " Emp_PreviousST=@Emp_PreviousST," & _
        " Emp_OtherIncome4=@Emp_OtherIncome4," & _
        " SecPay_Code=@SecPay_Code," & _
        " ComRat_Code=@ComRat_Code," & _
        " PerBon_Code=@PerBon_Code," & _
        " DutHou_Code=@DutHou_Code," & _
        " FliHou_Code=@FliHou_Code," & _
        " Emp_PassFullName=@Emp_PassFullName," & _
        " Emp_TravelDocs=@Emp_TravelDocs," & _
        " Emp_FirstEmployment =@Emp_FirstEmployment," & _
        " OveLay_Code = @OveLay_Code, " & _
        " Emp_Password = @Emp_Password, " & _
        " Emp_Splitemployement = @Emp_Splitemployement, " & _
        " Emp_NewEmployee = @Emp_NewEmployee, " & _
        " Emp_Force50Percent = @Emp_Force50Percent, " & _
        " Emp_Notes = @Emp_Notes, " & _
        " Emp_BankBenName = @Emp_BankBenName, " & _
        " Emp_AgreedSalary = @Emp_AgreedSalary, " & _
        " Emp_BonusOnSalary = @Emp_BonusOnSalary " & _
        " WHERE Emp_Code = @Emp_Code" & _
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True


    End Function


    Protected Function Temp()
        Dim Str As String

        Str = "Update PrTxTrxnHeader set TrxHdr_Discounts =0 where Emp_Code='1001'"
        ExecuteNonQuery(Str)

        Str = "Update PrTxTrxnHeader set TrxHdr_Discounts =102.67 where Emp_Code='1004'"
        ExecuteNonQuery(Str)
       
        Str = "Update PrTxTrxnHeader set TrxHdr_Discounts =128.84 where Emp_Code='1005'"
        ExecuteNonQuery(Str)

        MsgBox("done")

    End Function
    Protected Function Upgrade2017_B()
        Dim Str As String
        Dim i As Integer
        Str = "ALTER TABLE PrTxtrxnheader " & _
        " ADD [TrxHdr_PeriodSplitSI] [decimal](18, 2) NULL"


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If







        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE]" & _
        " @TrxHdr_Id int," & _
        " @Emp_Code varchar(16)," & _
        " @PrdGrp_Code varchar(6)," & _
        " @PrdCod_Code varchar(6)," & _
        " @PayCat_Code varchar(4)," & _
        " @TrxHdr_Date datetime," & _
        " @TrxHdr_Status varchar(4)," & _
        " @TrxHdr_TotalErnPeriod decimal(18,2)," & _
        " @TrxHdr_TotalErnYTD decimal(18,2)," & _
        " @TrxHdr_TotalDedPeriod decimal(18,2)," & _
        " @TrxHdr_TotalDedYTD decimal(18,2)," & _
        " @TrxHdr_TotalConPeriod decimal(18,2)," & _
        " @TrxHdr_TotalConYTD decimal(18,2)," & _
        " @TrxHdr_SIIncome decimal(18,2)," & _
        " @TrxHdr_TaxableIncome decimal(18,2)," & _
        " @TrxHdr_PaymentMethod varchar(50)," & _
        " @TrxHdr_PaymentRef varchar(50)," & _
        " @TrxHdr_PeriodUnits decimal(18,2)," & _
        " @TrxHdr_AnnualUnits decimal(18,2)," & _
        " @TrxHdr_AnnualLeave decimal(18,2)," & _
        " @TrxHdr_LifeInsurance decimal(18,2)," & _
        " @TrxHdr_Discounts decimal(18,2)," & _
        " @TrxHdr_Interfacestatus varchar(4)," & _
        " @TrxHdr_Overtime1 decimal(10,2)," & _
        " @TrxHdr_Overtime2 decimal(10,2)," & _
        " @TrxHdr_SIUnits decimal(10,2)," & _
        " @TrxHdr_MonthlySalary decimal(18,2)," & _
        " @TrxHdr_NetSalary decimal(18,2)," & _
        " @TrxHdr_PeriodInsurable decimal(18,2)," & _
        " @TemGrp_Code varchar(6)," & _
        " @TrxHdr_ChequeNo varchar(50)," & _
        " @TrxHdr_TaxableFromOther Decimal(18,2)," & _
        " @TrxHdr_CurrencySymbol varchar(3)," & _
        " @TrxHdr_Rate Decimal(18,10)," & _
        " @TrxHdr_NormalDays Decimal(18,2)," & _
        " @TrxHdr_Salary1 Decimal(18,2)," & _
        " @TrxHdr_Salary2 Decimal(18,2)," & _
        " @TrxHdr_Overtime3 decimal(10,2)," & _
        " @TrxHdr_Sectors decimal(18,2)," & _
        " @TrxHdr_Dutyhours decimal(18,2)," & _
        " @TrxHdr_FlightHours decimal(18,2)," & _
        " @TrxHdr_Commission decimal(18,2)," & _
        " @TrxHdr_PBAmount decimal(18,2)," & _
        " @TrxHdr_PBRate decimal(18,2)," & _
        " @TrxHdr_Overlay decimal(18,2)," & _
        " @TrxHdr_PeriodSplit decimal(18,2)," & _
        " @TrxHdr_PeriodSplitSI decimal(18,2)," & _
        " @NewId Int OUTPUT" & _
        " AS" & _
        " DECLARE @Result as Int" & _
        " Set  @Result = 0" & _
        " SELECT @Result = Count(*)" & _
        " FROM PrTxTrxnHeader" & _
        " WHERE TrxHdr_Id =  @TrxHdr_Id" & _
        " IF(@Result IS NULL) OR (@Result=0)" & _
        " BEGIN" & _
        "   INSERT INTO PrTxTrxnHeader" & _
        "   (Emp_Code,                                           " & _
        " PrdGrp_Code," & _
        " PrdCod_Code,                                        " & _
        " PayCat_Code,                                        " & _
        " TrxHdr_Date,                                        " & _
        " TrxHdr_Status,                                      " & _
        " TrxHdr_TotalErnPeriod,                              " & _
        " TrxHdr_TotalErnYTD,                                 " & _
        " TrxHdr_TotalDedPeriod,                              " & _
        " TrxHdr_TotalDedYTD,                                 " & _
        " TrxHdr_TotalConPeriod,                              " & _
        " TrxHdr_TotalConYTD,                                 " & _
        " TrxHdr_SIIncome,                                    " & _
        " TrxHdr_TaxableIncome,                               " & _
        " TrxHdr_PaymentMethod,                               " & _
        " TrxHdr_PaymentRef,                                  " & _
        " TrxHdr_PeriodUnits,                                 " & _
        " TrxHdr_AnnualUnits,                                 " & _
        " TrxHdr_AnnualLeave,                                  " & _
        " TrxHdr_LifeInsurance,                                " & _
        " TrxHdr_Discounts,                                    " & _
        " TrxHdr_InterfaceStatus,                               " & _
        " TrxHdr_Overtime1," & _
        " TrxHdr_Overtime2," & _
        " TrxHdr_SIUnits," & _
        " TrxHdr_MonthlySalary," & _
        " TrxHdr_NetSalary," & _
        " TrxHdr_PeriodInsurable," & _
        " TemGrp_Code," & _
        " TrxHdr_ChequeNo," & _
        " TrxHdr_TaxableFromOther," & _
        " TrxHdr_CurrencySymbol," & _
        " TrxHdr_Rate," & _
        " TrxHdr_NormalDays," & _
        " TrxHdr_Salary1," & _
        " TrxHdr_Salary2," & _
        " TrxHdr_Overtime3," & _
        " TrxHdr_Sectors," & _
        " TrxHdr_Dutyhours," & _
        " TrxHdr_FlightHours," & _
        " TrxHdr_Commission," & _
        " TrxHdr_PBAmount," & _
        " TrxHdr_PBRate," & _
        " TrxHdr_Overlay," & _
        " TrxHdr_PeriodSplit, " & _
        " TrxHdr_PeriodSplitSI " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @PrdGrp_Code," & _
        " @PrdCod_Code,                                        " & _
        " @PayCat_Code,                                        " & _
        " @TrxHdr_Date,                                        " & _
        " @TrxHdr_Status,                                      " & _
        " @TrxHdr_TotalErnPeriod,                              " & _
        " @TrxHdr_TotalErnYTD,                                 " & _
        " @TrxHdr_TotalDedPeriod,                              " & _
        " @TrxHdr_TotalDedYTD,                                 " & _
        " @TrxHdr_TotalConPeriod,                              " & _
        " @TrxHdr_TotalConYTD,                                 " & _
        " @TrxHdr_SIIncome,                                    " & _
        " @TrxHdr_TaxableIncome,                               " & _
        " @TrxHdr_PaymentMethod,                               " & _
        " @TrxHdr_PaymentRef,                                  " & _
        " @TrxHdr_PeriodUnits,                                 " & _
        " @TrxHdr_AnnualUnits,                                 " & _
        " @TrxHdr_AnnualLeave,                                 " & _
        " @TrxHdr_LifeInsurance,                               " & _
        " @TrxHdr_Discounts,                                   " & _
        " @TrxHdr_InterfaceStatus,                              " & _
        " @TrxHdr_Overtime1," & _
        " @TrxHdr_Overtime2," & _
        " @TrxHdr_SIUnits," & _
        " @TrxHdr_MonthlySalary," & _
        " @TrxHdr_NetSalary," & _
        " @TrxHdr_PeriodInsurable," & _
        " @TemGrp_Code, " & _
        " @TrxHdr_ChequeNo," & _
        " @TrxHdr_TaxableFromOther," & _
        " @TrxHdr_CurrencySymbol," & _
        " @TrxHdr_Rate," & _
        " @TrxHdr_NormalDays," & _
        " @TrxHdr_Salary1," & _
        " @TrxHdr_Salary2," & _
        " @TrxHdr_Overtime3," & _
        " @TrxHdr_Sectors," & _
        " @TrxHdr_Dutyhours," & _
        " @TrxHdr_FlightHours," & _
        " @TrxHdr_Commission," & _
        " @TrxHdr_PBAmount," & _
        " @TrxHdr_PBRate," & _
        " @TrxHdr_Overlay," & _
        " @TrxHdr_PeriodSplit, " & _
        " @TrxHdr_PeriodSplitSI " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrTxTrxnHeader" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     PrdGrp_Code=@PrdGrp_Code," & _
        "     PrdCod_Code=@PrdCod_Code,                             " & _
        "     PayCat_Code=@PayCat_Code,                             " & _
        "     TrxHdr_Date=@TrxHdr_Date,                             " & _
        "    TrxHdr_Status=@TrxHdr_Status,                         " & _
        "  TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " & _
        "     TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " & _
        "    TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " & _
        "   TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " & _
        "  TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " & _
        " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " & _
        " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " & _
        " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " & _
        " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " & _
        " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " & _
        " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " & _
        " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " & _
        " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,                " & _
        " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " & _
        " TrxHdr_Discounts=@TrxHdr_Discounts,                    " & _
        " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,        " & _
        " TrxHdr_Overtime1=@TrxHdr_Overtime1," & _
        " TrxHdr_Overtime2=@TrxHdr_Overtime2," & _
        " TrxHdr_SIUnits=@TrxHdr_SIUnits," & _
        " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary," & _
        " TrxHdr_NetSalary=@TrxHdr_NetSalary," & _
        " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable," & _
        " TemGrp_Code=@TemGrp_Code," & _
        " TrxHdr_ChequeNo=@TrxHdr_ChequeNo ," & _
        " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther," & _
        " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol," & _
        " TrxHdr_Rate=@TrxHdr_Rate," & _
        " TrxHdr_NormalDays=@TrxHdr_NormalDays ," & _
        " TrxHdr_Salary1=@TrxHdr_Salary1," & _
        " TrxHdr_Salary2=@TrxHdr_Salary2," & _
        " TrxHdr_Overtime3=@TrxHdr_Overtime3," & _
        " TrxHdr_Sectors=@TrxHdr_Sectors," & _
        " TrxHdr_Dutyhours=@TrxHdr_Dutyhours," & _
        " TrxHdr_FlightHours=@TrxHdr_FlightHours," & _
        " TrxHdr_Commission=@TrxHdr_Commission," & _
        " TrxHdr_PBAmount=@TrxHdr_PBAmount," & _
        " TrxHdr_PBRate=@TrxHdr_PBRate," & _
        " TrxHdr_Overlay=@TrxHdr_Overlay," & _
        " TrxHdr_PeriodSplit=@TrxHdr_PeriodSplit, " & _
        " TrxHdr_PeriodSplitSI=@TrxHdr_PeriodSplitSI " & _
        " WHERE TrxHdr_Id = @TrxHdr_Id" & _
        " END" & _
        " set  @NewId=SCOPE_IDENTITY()"


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If


        Return True

    End Function
    Protected Function GetTrxLineEarningOfTYPE(ByVal ErnType As String, ByVal HDRId As Integer) As Double
        Dim Str As String
        Dim RetVal As Double
        Str = "SELECT sum(TrxLin_PeriodValue)" & _
            " FROM PrTxTrxnLines INNER JOIN" & _
            " PrMsEarningCodes ON PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
            " WHERE (PrMsEarningCodes.ErnTyp_Code = " & enQuoteString(ErnType) & ")" & _
            " and (PrTxTrxnLines.TrxHdr_Id = " & HDRId & ")"

        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            RetVal = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        End If
        Return RetVal

    End Function
    Protected Function GetTrxLineEarningOfCODE(ByVal ErnCODE As String, ByVal HDRId As Integer) As Double
        Dim Str As String
        Dim RetVal As Double
        Str = "SELECT sum(TrxLin_PeriodValue)" & _
            " FROM PrTxTrxnLines " & _
            " WHERE PrTxTrxnLines.ErnCod_Code = " & enQuoteString(ErnCODE) & _
            " and (TrxHdr_Id = " & HDRId & ")"

        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            RetVal = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        End If
        Return RetVal

    End Function
    Protected Function GetTrxLineDeductionOfCODE(ByVal DedCODE As String, ByVal HDRId As Integer) As Double
        Dim Str As String
        Dim RetVal As Double
        Str = "SELECT sum(TrxLin_PeriodValue)" & _
            " FROM PrTxTrxnLines " & _
            " WHERE PrTxTrxnLines.DedCod_Code = " & enQuoteString(DedCODE) & _
            " and (TrxHdr_Id = " & HDRId & ")"

        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            RetVal = DbNullToDouble(ds.Tables(0).Rows(0).Item(0))
        End If
        Return RetVal

    End Function
    Public Shadows Function GetDiscountLifeInsuranceFirstEmployeemnt(ByVal EmpCode As String, ByVal PeriodGroup As String) As DataSet
        Dim Str As String
        Str = "Select prdcod_code," & _
        " TrxHdr_Discounts ," & _
        " TrxHdr_LifeInsurance ," & _
        " TrxHdr_FE,  " & _
        " TrxHdr_TaxableIncome,  " & _
        " TrxHdr_PeriodSplit,  " & _
        " TrxHdr_PeriodSplitSI,  " & _
        " TrxHdr_TaxableFromOther,  " & _
        " TrxHdr_AnnualUnits,  " & _
        " TrxHdr_Medical  " & _
        " from PrTxTrxnHeader " & _
        " where emp_code=" & enQuoteString(EmpCode) & _
        " and PrdGrp_Code =" & enQuoteString(PeriodGroup) & _
        " order by PrdCod_Code asc"

        Return MyBase.GetData(Str)

    End Function
    Public Function UpdateDiscountLifeInsuranceFirstEmployement(ByVal EmpCode As String, ByVal PeriodGroup As String, ByVal PeriodCode As String, ByVal D As Double, ByVal LI As Double, ByVal FE As Double) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = "Update PrTxTrxnHeader" & _
        " Set TrxHdr_Discounts = " & D & _
        " ,TrxHdr_LifeInsurance = " & LI & _
        " ,TrxHdr_FE  = " & FE & _
        " where emp_code=" & enQuoteString(EmpCode) & _
        " and PrdGrp_Code =" & enQuoteString(PeriodGroup) & _
        " and PrdCod_Code =" & enQuoteString(PeriodCode)


        If MyBase.ExecuteNonQuery(Str) > 0 Then
            F = True
        Else
            F = False
        End If

        Return F
    End Function
    Public Function UpdateDiscountLifeInsuranceFirstEmployementTaxableIncome(ByVal EmpCode As String, ByVal PeriodGroup As String, ByVal PeriodCode As String, ByVal D As Double, ByVal LI As Double, ByVal FE As Double, ByVal TI As Double) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = "Update PrTxTrxnHeader" & _
        " Set TrxHdr_Discounts = " & D & _
        " ,TrxHdr_LifeInsurance = " & LI & _
        " ,TrxHdr_FE  = " & FE & _
        " ,TrxHdr_TaxableIncome  = " & TI & _
        " where emp_code=" & enQuoteString(EmpCode) & _
        " and PrdGrp_Code =" & enQuoteString(PeriodGroup) & _
        " and PrdCod_Code =" & enQuoteString(PeriodCode)


        If MyBase.ExecuteNonQuery(Str) > 0 Then
            F = True
        Else
            F = False
        End If

        Return F
    End Function
    Public Function UpdateAnnualUnits(ByVal EmpCode As String, ByVal PeriodGroup As String, ByVal PeriodCode As String, ByVal AnnualUnits As Double) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = "Update PrTxTrxnHeader" & _
        " Set TrxHdr_AnnualUnits = " & AnnualUnits & _
        " where emp_code=" & enQuoteString(EmpCode) & _
        " and PrdGrp_Code =" & enQuoteString(PeriodGroup) & _
        " and PrdCod_Code =" & enQuoteString(PeriodCode)


        If MyBase.ExecuteNonQuery(Str) > 0 Then
            F = True
        Else
            F = False
        End If

        Return F
    End Function
    Public Function UpdatePeriodsplit_SIonPeriodSplit_TaxableFromOther(ByVal EmpCode As String, ByVal PeriodGroup As String, ByVal PeriodCode As String, ByVal PeriodSplit As Double, ByVal SIonPeriodSplit As Double, ByVal TaxableFromOther As Double) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = "Update PrTxTrxnHeader" & _
        " Set TrxHdr_PeriodSplit = " & PeriodSplit & _
        " ,TrxHdr_PeriodSplitSI = " & SIonPeriodSplit & _
        " ,TrxHdr_TaxableFromOther  = " & TaxableFromOther & _
        " where emp_code=" & enQuoteString(EmpCode) & _
        " and PrdGrp_Code =" & enQuoteString(PeriodGroup) & _
        " and PrdCod_Code =" & enQuoteString(PeriodCode)


        If MyBase.ExecuteNonQuery(Str) > 0 Then
            F = True
        Else
            F = False
        End If

        Return F
    End Function
    Public Function GetEmployeeEmploymentHistory(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT " & _
        " Emp_StartDate as StartDate," & _
        " Emp_EndDate as EndDate" & _
        " FROM PrTxEmploymentHistory " & _
        " Where Emp_Code=" & enQuoteString(EmpCode)
        Return MyBase.GetData(Str)
    End Function
    Public Function GetEmployeePositionHistory(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT " & _
        " Pos_Code as Code," & _
        " Pos_Desc as Description," & _
        " Pos_Date as PositionDate" & _
        " FROM PrTxPositionsHistory " & _
        " Where Emp_Code=" & enQuoteString(EmpCode)
        Return MyBase.GetData(Str)
    End Function
    Protected Function GetIr59ForPrinting(ByVal HeaderID As Integer) As DataSet
        Dim Str As String
        Str = "SELECT PrTxIr59.Pay_Id, " &
        " PrTxIr59.Trxhdr_id, " &
        " PrTxIr59.TemGrp_Code,  " &
        " PrTxIr59.PrdGrp_Code, " &
        " PrTxIr59.PrdCod_Code, " &
        " PrTxIr59.Emp_Code,  " &
        " PrTxIr59.Rec_GrossIncome, " &
        " PrTxIr59.Act_GrossIncome, " &
        " PrTxIr59.Rec_Discounts, " &
        " PrTxIr59.Act_Discounts, " &
        " PrTxIr59.Rec_FirstEmployeement, " &
        " PrTxIr59.Act_FirstEmployeement,  " &
        " PrTxIr59.Rec_SalDecrease,  " &
        " PrTxIr59.Act_Saldecrease, " &
        " PrTxIr59.Rec_PenFund, " &
        " PrTxIr59.Act_PenFund, " &
        " PrTxIr59.Rec_WOFund, " &
        " PrTxIr59.Act_WOFund,  " &
        " PrTxIr59.Rec_Union,  " &
        " PrTxIr59.Act_Union,  " &
        " PrTxIr59.Rec_LifeIns, " &
        " PrTxIr59.Act_LifeIns,  " &
        " PrTxIr59.Rec_PF, " &
        " PrTxIr59.Act_PF,  " &
        " PrTxIr59.Rec_PFLimit,  " &
        " PrTxIr59.Act_PFLimit,  " &
        " PrTxIr59.Rec_SI,  " &
        " PrTxIr59.Act_SI, " &
        " PrTxIr59.Rec_MF, " &
        " PrTxIr59.Act_MF,  " &
        " PrTxIr59.Rec_MFLimit, " &
        " PrTxIr59.Act_MFLimit, " &
        " PrTxIr59.Rec_Total, " &
        " PrTxIr59.Act_Total,  " &
        " PrTxIr59.Rec_OneSixth,  " &
        " PrTxIr59.Act_OneSixth,  " &
        " PrTxIr59.Rec_Taxable,  " &
        " PrTxIr59.Act_Taxable,  " &
        " PrTxIr59.Rec_TotalTax, " &
        " PrTxIr59.Act_TotalTax, " &
        " PrTxIr59.Rec_PaidTax,  " &
        " PrTxIr59.Act_PaidTax, " &
        " PrTxIr59.Rec_RemTax,  " &
        " PrTxIr59.Act_RemTax,  " &
        " PrTxIr59.Rec_RemDivTaxableP, " &
        " PrTxIr59.Act_RemDivTaxableP,  " &
        " PrTxIr59.Pay_RemTaxablePeriods, " &
        " PrTxIr59.Pay_ActualDivNormal,  " &
        " PrTxIr59.Pay_Dif, " &
        " PrTxIr59.Pay_PeriodTax,  " &
        " PrTxIr59.Rec_Gesi, " &
        " PrTxIr59.Act_Gesi,  " &
        " PrTxIr59.Rec_Gesi_BIK, " &
        " PrTxIr59.Act_Gesi_BIK, " &
        " PrTxIr59.Rec_Gesi_Limit, " &
        " PrTxIr59.Act_Gesi_Limit, " &
        " AdMsCompany.Com_Name,  " &
        " PrMsEmployees.Emp_FullName,  " &
        " PrMsEmployees.Emp_Address1, " &
        " PrMsEmployees.Emp_Address2, " &
        " PrMsEmployees.Emp_Address3, " &
        " PrMsEmployees.Emp_PostCode, " &
        " PrMsEmployees.Emp_Email,  " &
        " PrMsEmployees.Emp_SocialInsNumber, " &
        " PrMsEmployees.Emp_IdentificationCard, " &
        " PrMsEmployees.Emp_TaxID, " &
        " PrMsEmployees.Emp_PassportNumber,  " &
        " PrMsEmployees.Emp_AlienNumber " &
        " FROM PrTxIr59 INNER JOIN " &
        " PrMsEmployees ON PrTxIr59.Emp_Code COLLATE Greek_CI_AS = PrMsEmployees.Emp_Code INNER JOIN " &
        " PrMsTemplateGroup ON PrMsEmployees.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code INNER JOIN " &
        " AdMsCompany ON PrMsTemplateGroup.Com_Code = AdMsCompany.Com_Code " &
        " WHERE (PrTxIr59.Trxhdr_id = " & HeaderID & ") "

        Return MyBase.GetData(Str)
    End Function
    Protected Function FindLastPayslipOfEmployee(ByVal EmpCode As String) As Integer
        Dim Str As String
        Dim HeaderId As Integer = 0
        Str = "select max(trxhdr_id) from PrTxTrxnHeader" &
        " where emp_code =" & enQuoteString(EmpCode) &
        " group by PrdCod_Code" &
        " order by PrdCod_Code desc "

        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            HeaderId = DbNullToInt(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return HeaderId
    End Function
    Protected Function UpdateTrxnHeaderAnalysis(ByVal Analysis As String, ByVal HeaderID As Integer, ByVal Index As Integer)
        Dim Str As String
        Select Case Index
            Case 1
                Str = "Update PrTxTrxnHeader set TrxHdr_A1=" & enQuoteString(Analysis) &
                    " where trxhdr_id=" & HeaderID
            Case 2
                Str = "Update PrTxTrxnHeader set TrxHdr_A2=" & enQuoteString(Analysis) &
                    " where trxhdr_id=" & HeaderID
            Case 3
                Str = "Update PrTxTrxnHeader set TrxHdr_A3=" & enQuoteString(Analysis) &
                    " where trxhdr_id=" & HeaderID
            Case 4
                Str = "Update PrTxTrxnHeader set TrxHdr_A4=" & enQuoteString(Analysis) &
                    " where trxhdr_id=" & HeaderID
            Case 5
                Str = "Update PrTxTrxnHeader set TrxHdr_A5=" & enQuoteString(Analysis) &
                    " where trxhdr_id=" & HeaderID
            Case 6
                Str = "Update PrTxTrxnHeader set TrxHdr_Union=" & enQuoteString(Analysis) &
                    " where trxhdr_id=" & HeaderID

        End Select


        Dim i As Integer = MyBase.ExecuteNonQuery(Str)

    End Function
    Public Function UpdateTrxnHeaderYTDNet(ByVal HeaderID As Integer)
        Dim Str As String
        
        Str = "Update PrTxTrxnHeader set TrxHdr_NetYTD=TrxHdr_NetSalary " & _
        " where trxhdr_id=" & HeaderID

        Dim i As Integer = MyBase.ExecuteNonQuery(Str)
    End Function
    Public Function ChangeEmployeeCode(ByVal OldCode As String, ByVal NewCode As String) As Boolean
        Dim Flag As Boolean = True
        Dim Str1 As String
        Dim Str2 As String
        Dim Str3 As String
        Dim Str4 As String
        Dim Str5 As String
        Dim Str6 As String
        Dim Str7 As String
        Dim Str8 As String
        Dim Str9 As String
        Dim Str10 As String
        Dim Str11 As String
        Dim Str12 As String
        Dim Str13 As String
        Dim Str14 As String
        Dim Str15 As String
        Dim Str16 As String
        Dim Str17 As String

        Dim StrG As String

        StrG = " set Emp_Code=" & enQuoteString(NewCode) & " where Emp_Code=" & enQuoteString(OldCode)

        Str1 = "update PrMsEmployeeEarnings " & StrG
        Str2 = "update PrMsEmployeeDeductions " & StrG
        Str3 = "update PrMsEmployeecontributions " & StrG
        Str4 = "update PrTxEmployeesalary " & StrG
        Str5 = "update PrTxEmployeeleave " & StrG
        Str6 = "update PrTxEmployeeloan " & StrG
        Str7 = "update PrTxEmployeeDiscounts  " & StrG
        Str8 = "update PrTxEmployeeHiring  " & StrG
        Str9 = "update PrTxEmployeeAdvances  " & StrG
        Str10 = "update PrTxEmploymentHistory  " & StrG
        Str11 = "update PrTxIr59  " & StrG
        Str12 = "update PrTxPositionsHistory  " & StrG
        Str13 = "update PrTxTrxnHeader  " & StrG
        Str14 = "Update PrSsEmployeeSplit " & StrG
        Str15 = "Update PrMsReminders " & StrG
        Str16 = "Update PrTxLoanComments " & StrG






        Str17 = "delete from PrMsemployees Where emp_Code=" & enQuoteString(OldCode)
        Try


            MyBase.ExecuteNonQuery(Str1)
            MyBase.ExecuteNonQuery(Str2)
            MyBase.ExecuteNonQuery(Str3)
            MyBase.ExecuteNonQuery(Str4)
            MyBase.ExecuteNonQuery(Str5)
            MyBase.ExecuteNonQuery(Str6)
            MyBase.ExecuteNonQuery(Str7)
            MyBase.ExecuteNonQuery(Str8)
            MyBase.ExecuteNonQuery(Str9)
            MyBase.ExecuteNonQuery(Str10)
            MyBase.ExecuteNonQuery(Str11)
            MyBase.ExecuteNonQuery(Str12)
            MyBase.ExecuteNonQuery(Str13)
            MyBase.ExecuteNonQuery(Str14)
            MyBase.ExecuteNonQuery(Str15)
            MyBase.ExecuteNonQuery(Str16)

            MyBase.ExecuteNonQuery(Str17)

        Catch ex As Exception
            Flag = False
        End Try

        Return Flag




    End Function
    Protected Function UpdateEmployeeBonusOnSalary(ByVal EmpCode As String, ByVal BonusOnSalary As Double) As Boolean
        Dim Flag As Boolean = True
        Dim Str As String
        Try

            Str = "Update PrMsEmployees set Emp_BonusOnSalary=" & BonusOnSalary & " where Emp_Code=" & enQuoteString(EmpCode)
            Dim i As Integer
            i = MyBase.ExecuteNonQuery(Str)

            If i < 0 Then
                Flag = False
            End If
        Catch ex As Exception
            Flag = False
        End Try

        Return Flag

    End Function
    Protected Function Upgrade_2018_5() As Boolean
        Dim Str As String
        Dim i As Integer
        Str = " ALTER TABLE PrTxtrxnheader " & _
        " ADD [TrxHdr_PFonAgreedSalary] [decimal](18, 2) NULL "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("1 New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If



        Str = " ALTER TABLE PrTxtrxnheader " & _
        " ADD [TrxHdr_BasisOnSalary] [decimal](18, 2) NULL "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("2 New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If




        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE]" & _
        " @TrxHdr_Id int," & _
        " @Emp_Code varchar(16)," & _
        " @PrdGrp_Code varchar(6)," & _
        " @PrdCod_Code varchar(6)," & _
        " @PayCat_Code varchar(4)," & _
        " @TrxHdr_Date datetime," & _
        " @TrxHdr_Status varchar(4)," & _
        " @TrxHdr_TotalErnPeriod decimal(18,2)," & _
        " @TrxHdr_TotalErnYTD decimal(18,2)," & _
        " @TrxHdr_TotalDedPeriod decimal(18,2)," & _
        " @TrxHdr_TotalDedYTD decimal(18,2)," & _
        " @TrxHdr_TotalConPeriod decimal(18,2)," & _
        " @TrxHdr_TotalConYTD decimal(18,2)," & _
        " @TrxHdr_SIIncome decimal(18,2)," & _
        " @TrxHdr_TaxableIncome decimal(18,2)," & _
        " @TrxHdr_PaymentMethod varchar(50)," & _
        " @TrxHdr_PaymentRef varchar(50)," & _
        " @TrxHdr_PeriodUnits decimal(18,2)," & _
        " @TrxHdr_AnnualUnits decimal(18,2)," & _
        " @TrxHdr_AnnualLeave decimal(18,2)," & _
        " @TrxHdr_LifeInsurance decimal(18,2)," & _
        " @TrxHdr_Discounts decimal(18,2)," & _
        " @TrxHdr_Interfacestatus varchar(4)," & _
        " @TrxHdr_Overtime1 decimal(10,2)," & _
        " @TrxHdr_Overtime2 decimal(10,2)," & _
        " @TrxHdr_SIUnits decimal(10,2)," & _
        " @TrxHdr_MonthlySalary decimal(18,2)," & _
        " @TrxHdr_NetSalary decimal(18,2)," & _
        " @TrxHdr_PeriodInsurable decimal(18,2)," & _
        " @TemGrp_Code varchar(6)," & _
        " @TrxHdr_ChequeNo varchar(50)," & _
        " @TrxHdr_TaxableFromOther Decimal(18,2)," & _
        " @TrxHdr_CurrencySymbol varchar(3)," & _
        " @TrxHdr_Rate Decimal(18,10)," & _
        " @TrxHdr_NormalDays Decimal(18,2)," & _
        " @TrxHdr_Salary1 Decimal(18,2)," & _
        " @TrxHdr_Salary2 Decimal(18,2)," & _
        " @TrxHdr_Overtime3 decimal(10,2)," & _
        " @TrxHdr_Sectors decimal(18,2)," & _
        " @TrxHdr_Dutyhours decimal(18,2)," & _
        " @TrxHdr_FlightHours decimal(18,2)," & _
        " @TrxHdr_Commission decimal(18,2)," & _
        " @TrxHdr_PBAmount decimal(18,2)," & _
        " @TrxHdr_PBRate decimal(18,2)," & _
        " @TrxHdr_Overlay decimal(18,2)," & _
        " @TrxHdr_PeriodSplit decimal(18,2)," & _
        " @TrxHdr_PeriodSplitSI decimal(18,2)," & _
        " @TrxHdr_A1 varchar(12), " & _
        " @TrxHdr_A2 varchar(12), " & _
        " @TrxHdr_A3 varchar(12), " & _
        " @TrxHdr_A4 varchar(12), " & _
        " @TrxHdr_A5 varchar(12), " & _
        " @TrxHdr_Union varchar(12), " & _
        " @TrxHdr_Position varchar(12), " & _
        " @TrxHdr_COLA decimal(18, 2)," & _
        " @TrxHdr_MyRate decimal(18, 4)," & _
        " @TrxHdr_FE decimal(18, 2)," & _
        " @TrxHdr_NetYTD decimal(18, 2)," & _
        " @TrxHdr_PFOnAgreedSalary decimal(18, 2)," & _
        " @TrxHdr_BasisOnSalary decimal(18, 2)," & _
        " @NewId Int OUTPUT" & _
        " AS" & _
        " DECLARE @Result as Int" & _
        " Set  @Result = 0" & _
        " SELECT @Result = Count(*)" & _
        " FROM PrTxTrxnHeader" & _
        " WHERE TrxHdr_Id =  @TrxHdr_Id" & _
        " IF(@Result Is NULL) Or (@Result=0)" & _
        " BEGIN" & _
        "   INSERT INTO PrTxTrxnHeader" & _
        "   (Emp_Code,                                           " & _
        " PrdGrp_Code," & _
        " PrdCod_Code,                                        " & _
        " PayCat_Code,                                        " & _
        " TrxHdr_Date,                                        " & _
        " TrxHdr_Status,                                      " & _
        " TrxHdr_TotalErnPeriod,                              " & _
        " TrxHdr_TotalErnYTD,                                 " & _
        " TrxHdr_TotalDedPeriod,                              " & _
        " TrxHdr_TotalDedYTD,                                 " & _
        " TrxHdr_TotalConPeriod,                              " & _
        " TrxHdr_TotalConYTD,                                 " & _
        " TrxHdr_SIIncome,                                    " & _
        " TrxHdr_TaxableIncome,                               " & _
        " TrxHdr_PaymentMethod,                               " & _
        " TrxHdr_PaymentRef,                                  " & _
        " TrxHdr_PeriodUnits,                                 " & _
        " TrxHdr_AnnualUnits,                                 " & _
        " TrxHdr_AnnualLeave,                                  " & _
        " TrxHdr_LifeInsurance,                                " & _
        " TrxHdr_Discounts,                                    " & _
        " TrxHdr_InterfaceStatus,                               " & _
        " TrxHdr_Overtime1," & _
        " TrxHdr_Overtime2," & _
        " TrxHdr_SIUnits," & _
        " TrxHdr_MonthlySalary," & _
        " TrxHdr_NetSalary," & _
        " TrxHdr_PeriodInsurable," & _
        " TemGrp_Code," & _
        " TrxHdr_ChequeNo," & _
        " TrxHdr_TaxableFromOther," & _
        " TrxHdr_CurrencySymbol," & _
        " TrxHdr_Rate," & _
        " TrxHdr_NormalDays," & _
        " TrxHdr_Salary1," & _
        " TrxHdr_Salary2," & _
        " TrxHdr_Overtime3," & _
        " TrxHdr_Sectors," & _
        " TrxHdr_Dutyhours," & _
        " TrxHdr_FlightHours," & _
        " TrxHdr_Commission," & _
        " TrxHdr_PBAmount," & _
        " TrxHdr_PBRate," & _
        " TrxHdr_Overlay," & _
        " TrxHdr_PeriodSplit, " & _
        " TrxHdr_PeriodSplitSI, " & _
        " TrxHdr_A1, " & _
        " TrxHdr_A2, " & _
        " TrxHdr_A3, " & _
        " TrxHdr_A4, " & _
        " TrxHdr_A5, " & _
        " TrxHdr_Union, " & _
        " TrxHdr_Position, " & _
        " TrxHdr_COLA," & _
        " TrxHdr_MyRate, " & _
        " TrxHdr_FE, " & _
        " TrxHdr_NetYTD, " & _
        " TrxHdr_PFOnAgreedSalary, " & _
        " TrxHdr_BasisOnSalary " & _
        " )" & _
        " VALUES (" & _
        " @Emp_Code,                                           " & _
        " @PrdGrp_Code," & _
        " @PrdCod_Code,                                        " & _
        " @PayCat_Code,                                        " & _
        " @TrxHdr_Date,                                        " & _
        " @TrxHdr_Status,                                      " & _
        " @TrxHdr_TotalErnPeriod,                              " & _
        " @TrxHdr_TotalErnYTD,                                 " & _
        " @TrxHdr_TotalDedPeriod,                              " & _
        " @TrxHdr_TotalDedYTD,                                 " & _
        " @TrxHdr_TotalConPeriod,                              " & _
        " @TrxHdr_TotalConYTD,                                 " & _
        " @TrxHdr_SIIncome,                                    " & _
        " @TrxHdr_TaxableIncome,                               " & _
        " @TrxHdr_PaymentMethod,                               " & _
        " @TrxHdr_PaymentRef,                                  " & _
        " @TrxHdr_PeriodUnits,                                 " & _
        " @TrxHdr_AnnualUnits,                                 " & _
        " @TrxHdr_AnnualLeave,                                 " & _
        " @TrxHdr_LifeInsurance,                               " & _
        " @TrxHdr_Discounts,                                   " & _
        " @TrxHdr_InterfaceStatus,                              " & _
        " @TrxHdr_Overtime1," & _
        " @TrxHdr_Overtime2," & _
        " @TrxHdr_SIUnits," & _
        " @TrxHdr_MonthlySalary," & _
        " @TrxHdr_NetSalary," & _
        " @TrxHdr_PeriodInsurable," & _
        " @TemGrp_Code, " & _
        " @TrxHdr_ChequeNo," & _
        " @TrxHdr_TaxableFromOther," & _
        " @TrxHdr_CurrencySymbol," & _
        " @TrxHdr_Rate," & _
        " @TrxHdr_NormalDays," & _
        " @TrxHdr_Salary1," & _
        " @TrxHdr_Salary2," & _
        " @TrxHdr_Overtime3," & _
        " @TrxHdr_Sectors," & _
        " @TrxHdr_Dutyhours," & _
        " @TrxHdr_FlightHours," & _
        " @TrxHdr_Commission," & _
        " @TrxHdr_PBAmount," & _
        " @TrxHdr_PBRate," & _
        " @TrxHdr_Overlay," & _
        " @TrxHdr_PeriodSplit, " & _
        " @TrxHdr_PeriodSplitSI, " & _
        " @TrxHdr_A1, " & _
        " @TrxHdr_A2, " & _
        " @TrxHdr_A3, " & _
        " @TrxHdr_A4, " & _
        " @TrxHdr_A5, " & _
        " @TrxHdr_Union, " & _
        " @TrxHdr_Position, " & _
        " @TrxHdr_COLA," & _
        " @TrxHdr_MyRate," & _
        " @TrxHdr_FE, " & _
        " @TrxHdr_NetYTD, " & _
        " @TrxHdr_PFOnAgreedSalary, " & _
        " @TrxHdr_BasisOnSalary " & _
        " )" & _
        " END" & _
        " ELSE" & _
        "   BEGIN" & _
        "     UPDATE PrTxTrxnHeader" & _
        "     SET " & _
        "     Emp_Code=@Emp_Code,                                   " & _
        "     PrdGrp_Code=@PrdGrp_Code," & _
        "     PrdCod_Code=@PrdCod_Code,                             " & _
        "     PayCat_Code=@PayCat_Code,                             " & _
        "     TrxHdr_Date=@TrxHdr_Date,                             " & _
        "    TrxHdr_Status=@TrxHdr_Status,                         " & _
        "  TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " & _
        "     TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " & _
        "    TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " & _
        "   TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " & _
        "  TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " & _
        " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " & _
        " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " & _
        " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " & _
        " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " & _
        " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " & _
        " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " & _
        " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " & _
        " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,                " & _
        " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " & _
        " TrxHdr_Discounts=@TrxHdr_Discounts,                    " & _
        " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,        " & _
        " TrxHdr_Overtime1=@TrxHdr_Overtime1," & _
        " TrxHdr_Overtime2=@TrxHdr_Overtime2," & _
        " TrxHdr_SIUnits=@TrxHdr_SIUnits," & _
        " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary," & _
        " TrxHdr_NetSalary=@TrxHdr_NetSalary," & _
        " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable," & _
        " TemGrp_Code=@TemGrp_Code," & _
        " TrxHdr_ChequeNo=@TrxHdr_ChequeNo ," & _
        " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther," & _
        " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol," & _
        " TrxHdr_Rate=@TrxHdr_Rate," & _
        " TrxHdr_NormalDays=@TrxHdr_NormalDays ," & _
        " TrxHdr_Salary1=@TrxHdr_Salary1," & _
        " TrxHdr_Salary2=@TrxHdr_Salary2," & _
        " TrxHdr_Overtime3=@TrxHdr_Overtime3," & _
        " TrxHdr_Sectors=@TrxHdr_Sectors," & _
        " TrxHdr_Dutyhours=@TrxHdr_Dutyhours," & _
        " TrxHdr_FlightHours=@TrxHdr_FlightHours," & _
        " TrxHdr_Commission=@TrxHdr_Commission," & _
        " TrxHdr_PBAmount=@TrxHdr_PBAmount," & _
        " TrxHdr_PBRate=@TrxHdr_PBRate," & _
        " TrxHdr_Overlay=@TrxHdr_Overlay," & _
        " TrxHdr_PeriodSplit=@TrxHdr_PeriodSplit, " & _
        " TrxHdr_PeriodSplitSI=@TrxHdr_PeriodSplitSI," & _
        " TrxHdr_A1=@TrxHdr_A1, " & _
        " TrxHdr_A2=@TrxHdr_A2, " & _
        " TrxHdr_A3=@TrxHdr_A3, " & _
        " TrxHdr_A4=@TrxHdr_A4, " & _
        " TrxHdr_A5=@TrxHdr_A5, " & _
        " TrxHdr_Union=@TrxHdr_Union, " & _
        " TrxHdr_Position=@TrxHdr_Position, " & _
        " TrxHdr_COLA=@TrxHdr_COLA," & _
        " TrxHdr_MyRate=@TrxHdr_MyRate, " & _
        " TrxHdr_FE=@TrxHdr_FE, " & _
        " TrxHdr_NetYTD=@TrxHdr_NetYTD, " & _
        " TrxHdr_PFOnAgreedSalary=@TrxHdr_PFOnAgreedSalary, " & _
        " TrxHdr_BasisOnSalary=@TrxHdr_BasisOnSalary " & _
        " WHERE TrxHdr_Id = @TrxHdr_Id" & _
        " END" & _
        " set  @NewId=SCOPE_IDENTITY()"

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If




        Return Proceed

    End Function
    Protected Function Upgrade_2019_4() As Boolean
        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True
        Str = " ALTER TABLE PrTxIr59 " & _
        " ADD [Rec_Gesi] [decimal](18, 2) NULL, " & _
        " [Act_Gesi] [decimal](18, 2) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrTxIr59", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxIr59", MsgBoxStyle.Critical)
            F = False
        End If

        Return F

    End Function
    Protected Function Upgrade_2019_11() As Boolean
        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True
        Str = " ALTER TABLE PrTxIr59 " & _
        " ADD [Rec_Gesi_BIK] [decimal](18, 2) NULL, " & _
        " [Act_Gesi_BIK] [decimal](18, 2) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrTxIr59", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxIr59", MsgBoxStyle.Critical)
            F = False
        End If

        Return F

    End Function
    Public Shadows Function GetEDCValueofHeaderId(ByVal HeaderID As Integer, ByVal Type As String, ByVal EDCTypeCode As String) As Double
        Dim Str As String = ""
        Dim Value As Double = 0

        If Type = "E" Then
            Str = " SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                  " FROM PrTxTrxnLines INNER JOIN" & _
                  " PrMsEarningCodes ON PrTxTrxnLines.ErnCod_Code = PrMsEarningCodes.ErnCod_Code" & _
                  " where ErnTyp_Code =" & enQuoteString(EDCTypeCode) & _
                  " And PrTxTrxnLines .TrxHdr_Id =" & HeaderID
        ElseIf Type = "D" Then
            Str = " SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                  " FROM PrTxTrxnLines INNER JOIN" & _
                  " PrMsDeductionCodes ON PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" & _
                  " where DedTyp_Code =" & enQuoteString(EDCTypeCode) & _
                  " And PrTxTrxnLines .TrxHdr_Id =" & HeaderID
        ElseIf Type = "C" Then
            Str = " SELECT sum(PrTxTrxnLines.TrxLin_PeriodValue)" & _
                  " FROM PrTxTrxnLines INNER JOIN" & _
                  " PrMsContributionCodes ON PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code" & _
                  " where ConTyp_Code =" & enQuoteString(EDCTypeCode) & _
                  " And PrTxTrxnLines .TrxHdr_Id =" & HeaderID
        End If
        Dim ds As DataSet
        ds = GetData(Str)
        If CheckDataSet(ds) Then
            value = DbNullToDouble(ds.tables(0).rows(0).item(0))
        End If
        Return Value
    End Function
    Protected Function GetCurrentAnalysisAndPosition(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT     PrMsEmployees.Emp_Code, " & _
        " PrAnEmployeePositions.EmpPos_DescriptionL, PrAnEmployeeAnalysis2.EmpAn2_DescriptionL " & _
        " FROM         PrMsEmployees INNER JOIN " & _
        " PrAnEmployeeAnalysis2 ON PrMsEmployees.EmpAn2_Code = PrAnEmployeeAnalysis2.EmpAn2_Code INNER JOIN " & _
        " PrAnEmployeePositions ON PrMsEmployees.EmpPos_Code = PrAnEmployeePositions.EmpPos_Code " & _
        " where  PrMsEmployees.Emp_Code = " & enQuoteString(EmpCode)

        Dim ds As DataSet
        ds = GetData(Str)
        Return ds



    End Function
    Protected Function Upgrade_2019_12() As Boolean
        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True
        Str = " Select TrxHdr_id from prtxtrxnheader where trxhdr_year='2019' order by prdgrp_code, emp_code asc"
        Dim ds As DataSet
        ds = GetData(Str)

        If CheckDataSet(ds) Then
            For i = 0 To ds.Tables(0).Rows.Count - 1
                Dim HdrId As Integer = 0
                Dim GESYDValue As Double = 0
                Dim GESYCValue As Double = 0
                Dim GESYable As Double = 0
                Dim GESY_BIKD As Double = 0
                Dim GESYableBIK As Double = 0

                HdrId = DbNullToInt(ds.Tables(0).Rows(i).Item(0))
                GESYDValue = GetEDCValueofHeaderId(HdrId, "D", "GD")
                GESYCValue = GetEDCValueofHeaderId(HdrId, "C", "GC")

                GESYable = RoundMe2(GESYDValue * 100 / 1.7, 2)
                GESYable = RoundMeUp(GESYable)

                GESY_BIKD = GetEDCValueofHeaderId(HdrId, "D", "GT")

                GESYableBIK = RoundMe2(GESY_BIKD * 100 / 1.7, 2)
                GESYableBIK = RoundMeUp(GESYableBIK)
                Dim str2 As String = ""
                str2 = "Update PrTxTrxnHeader set " & _
                " TrxHdr_GESID = " & GESYDValue & " ," & _
                " TrxHdr_GESIC  = " & GESYCValue & " ," & _
                " TrxHdr_GESIableAmount = " & GESYable & " ," & _
                " TrxHdr_BIK_GESID = " & GESY_BIKD & " ," & _
                " TrxHdr_BIK_GESIable = " & GESYableBIK & _
                " Where TrxHdr_Id=" & HdrId
                Dim k As Integer
                k = MyBase.ExecuteNonQuery(str2)
                If k < 0 Then
                    MsgBox("Unable to update header " & HdrId)
                End If
            Next
        End If


        Return True

    End Function
    Protected Function Upgrade_2019_13() As Boolean
        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True
        Str = "ALTER TABLE PrMsCodeMasking alter column intcod_code  varchar(50)"
       

       
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            MsgBox("Unable to Update PrMsCodeMasking")
            F = False
        End If

        Str = " ALTER PROCEDURE [dbo].[AG_PrMsCodeMasking_Save_Update] " &
        " @CodMsk_Id int, " &
        " @IntCod_Code varchar(50), " &
        " @CodMsk_Position int, " &
        " @CodMsk_Type varchar(1), " &
        " @CodMsk_Value varchar(4), " &
        " @NewId int OUTPUT " &
        "  " &
        " AS " &
        " DECLARE @Result as Int " &
        " Set @Result = 0 " &
        " SELECT @Result = Count(*) " &
        " FROM PrMsCodeMasking " &
        " WHERE CodMsk_Id = @CodMsk_Id " &
        "  " &
        " IF(@Result IS NULL) OR (@Result=0) " &
        " BEGIN " &
        " INSERT INTO PrMsCodeMasking " &
        " (IntCod_Code,  " &
        " CodMsk_Position, " &
        " CodMsk_Type, " &
        " CodMsk_Value  " &
        " ) " &
        " VALUES ( " &
        " @IntCod_Code,  " &
        " @CodMsk_Position, " &
        " @CodMsk_Type, " &
        " @CodMsk_Value " &
        " ) " &
        " END " &
        " ELSE " &
        " BEGIN " &
        " UPDATE PrMsCodeMasking " &
        " SET  " &
        " IntCod_Code=@IntCod_Code,  " &
        " CodMsk_Position=@CodMsk_Position, " &
        " CodMsk_Type=@CodMsk_Type, " &
        " CodMsk_Value=@CodMsk_Value " &
        " WHERE CodMsk_Id = @CodMsk_Id " &
        " END " &
        " set @NewId=SCOPE_IDENTITY() "

        i = ExecuteNonQuery(Str)
        If i < 0 Then
            MsgBox("Unable to Update PrMsCodeMasking SP")
            F = False
        End If

        Str = " ALTER PROCEDURE [dbo].[AG_PrMsInterfaceCodes_Save_Update] " &
        " @IntCod_Code varchar(50), " &
        " @TemGrp_Code varchar(6), " &
        " @IntCod_Description varchar(20), " &
        " @IntCod_AccountType char(1) " &
        " AS " &
        "  DECLARE @Result as Int " &
        "  Set @Result = 0 " &
        "  SELECT @Result = Count(*) " &
        "  FROM PrMsInterfaceCodes " &
        "  WHERE IntCod_Code = @IntCod_Code " &
        "  IF(@Result IS NULL) OR (@Result=0) " &
        "    BEGIN " &
        "      INSERT INTO PrMsInterfaceCodes " &
        "     (IntCod_Code, " &
        "	  TemGrp_Code, " &
        "	  IntCod_Description, " &
        "	  IntCod_AccountType " &
        "	  ) " &
        "      VALUES ( " &
        "      @IntCod_Code, " &
        "	  @TemGrp_Code, " &
        "	  @IntCod_Description, " &
        "      @IntCod_AccountType " &
        "      ) " &
        "    END " &
        "  ELSE " &
        "    BEGIN " &
          "    UPDATE PrMsInterfaceCodes " &
         "     SET  " &
        "      IntCod_Code=@IntCod_Code, " &
        "	  TemGrp_Code=@TemGrp_Code, " &
         "     IntCod_Description=@IntCod_Description, " &
         "     IntCod_AccountType=@IntCod_AccountType " &
         "     WHERE IntCod_Code = @IntCod_Code " &
         " END "

        i = ExecuteNonQuery(Str)
        If i < 0 Then
            MsgBox("Unable to Update PrMsInterfaceCodes SP")
            F = False
        End If


        Return F

    End Function
    Protected Function Upgrade_2019_14() As Boolean
        Dim Str As String
        Dim Ds As DataSet
        Dim Seq As Integer
        Dim i As Integer
        Dim Flag As Boolean = True

        Str = "Select max(ErnTyp_TableSequence) from PrSsEarningTypes "

        Ds = GetData(Str)

        If CheckDataSet(Ds) Then
            Seq = DbNullToInt(Ds.Tables(0).Rows(0).Item(0))
        End If
        Seq = Seq + 1


        Seq = Seq + 1
        Str = "INSERT INTO PrSsEarningTypes " &
            " (ErnTyp_Code, " &
            " ErnTyp_DescriptionL, " &
            " ErnTyp_DescriptionS, " &
            " ErnTyp_TableSequence) " &
            " VALUES     ('FN', " &
            " 'FINE', " &
            " 'FINE',  " &
            Seq & ") "

        i = ExecuteNonQuery(Str)
        If i < 0 Then
            Flag = False
        End If


        Return Flag
    End Function
    Protected Function Upgrade_2019_5() As Boolean
        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True
        Str = " select temgrp_code,Com_Code from PrMsTemplateGroup  "

        Dim Ds As DataSet
        Ds = GetData(Str)
        Dim k As Integer
        If CheckDataSet(Ds) Then
            Dim TemGrp As String
            Dim ComCode As String
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                Application.DoEvents()
                Cursor.Current = Cursors.WaitCursor
                TemGrp = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
                ComCode = DbNullToString(Ds.Tables(0).Rows(i).Item(1))
                Str = "Update prtxtrxnheader set com_code=" & enQuoteString(ComCode) & " Where TemGrp_Code=" & enQuoteString(TemGrp)
                k = ExecuteNonQuery(Str)
                If k < 0 Then
                    MsgBox("Fail to update Company Code for Template " & TemGrp, MsgBoxStyle.Critical)
                    F = False
                End If
            Next
        End If

        Str = " select prdgrp_code,PrdGpr_Year  from PrMsPeriodGroups "


        Ds = GetData(Str)

        If CheckDataSet(Ds) Then
            Dim PrdGrpCode As String
            Dim YearCode As String
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                Application.DoEvents()
                Cursor.Current = Cursors.WaitCursor
                PrdGrpCode = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
                YearCode = DbNullToString(Ds.Tables(0).Rows(i).Item(1))
                Str = "Update prtxtrxnheader set TrxHdr_Year=" & enQuoteString(YearCode) & " Where PrdGrp_Code=" & enQuoteString(PrdGrpCode)
                k = ExecuteNonQuery(Str)
                If k < 0 Then
                    MsgBox("Fail to update Year for Period Group " & PrdGrpCode, MsgBoxStyle.Critical)
                    F = False
                End If
            Next
        End If





        Cursor.Current = Cursors.Default
        Application.DoEvents()

        Return F

    End Function
    Protected Function Upgrade_2019_6()

        Dim Str As String
        Dim i As Integer
        Dim Seq As Integer = 0

        Str = "Select max(ConTyp_TableSequence) from PrSsContributionTypes "
        Dim ds As DataSet
        ds = GetData(Str)

        If CheckDataSet(ds) Then
            Seq = DbNullToInt(ds.Tables(0).Rows(0).Item(0))
        End If
        Seq = Seq + 1

        Str = "INSERT INTO PrSsContributionTypes " &
            " (ConTyp_Code, " &
            " ConTyp_DescriptionL, " &
            " ConTyp_DescriptionS, " &
            " ConTyp_TableSequence) " &
            " VALUES     ('GC', " &
            " 'GESY', " &
            " 'GESY',  " &
             Seq & ") "
        i = ExecuteNonQuery(Str)

        Str = "Select max(DedTyp_TableSequence) from PrSsDeductionTypes "

        ds = GetData(Str)

        If CheckDataSet(ds) Then
            Seq = DbNullToInt(ds.Tables(0).Rows(0).Item(0))
        End If
        Seq = Seq + 1


        Seq = Seq + 1
        Str = "INSERT INTO PrSsDeductionTypes " &
            " (DedTyp_Code, " &
            " DedTyp_DescriptionL, " &
            " DedTyp_DescriptionS, " &
            " DedTyp_TableSequence) " &
            " VALUES     ('GD', " &
            " 'GESY', " &
            " 'GESY',  " &
            Seq & ") "
        i = ExecuteNonQuery(Str)




        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        '                       Contribution
        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''


        Str = "select MAX(ConCod_Code) from PrMsContributionCodes where len(ConCod_Code)=3"
        ds = GetData(Str)
        Dim CodeSeq As Integer = 0

        If CheckDataSet(ds) Then
            Dim Code As String
            Code = DbNullToString(ds.Tables(0).Rows(0).Item(0))
            Code = Replace(Code, "C", "")
            CodeSeq = CInt(Code)
        End If

        Dim ConCode As String

        CodeSeq = CodeSeq + 1
        ConCode = "C" & CodeSeq
        Str = "INSERT INTO PrMsContributionCodes " &
        "(ConCod_Code, " &
        "ConTyp_Code, " &
        "ConCod_DescriptionL, " &
        "ConCod_DescriptionS, " &
        "ConCod_IsActive) " &
        "VALUES (" & enQuoteString(ConCode) & ", " &
        "'GC', " &
        "'GESY', " &
        "'GESY', " &
        "'Y') "

        i = ExecuteNonQuery(Str)


        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        '                       Deduction
        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''


        Str = "select MAX(DedCod_Code) from PrMsDeductionCodes where len(DedCod_Code)=3"
        ds = GetData(Str)


        If CheckDataSet(ds) Then
            Dim Code As String
            Code = DbNullToString(ds.Tables(0).Rows(0).Item(0))
            Code = Replace(Code, "D", "")
            CodeSeq = CInt(Code)
        End If

        Dim DedCode As String

        CodeSeq = CodeSeq + 1
        DedCode = "D" & CodeSeq
        Str = "INSERT INTO PrMsDeductionCodes " &
        "(DedCod_Code, " &
        "DedTyp_Code, " &
        "DedCod_DescriptionL, " &
        "DedCod_DescriptionS, " &
        "DedCod_IsActive) " &
        "VALUES (" & enQuoteString(DedCode) & ", " &
        "'GD', " &
        "'GESY', " &
        "'GESY', " &
        "'Y') "

        i = ExecuteNonQuery(Str)






        Return True

    End Function
    Protected Function Upgrade_2019_7() As Boolean
        Dim Str As String
        Dim Ds As DataSet
        Dim Seq As Integer
        Dim i As Integer
        Dim Flag As Boolean = True

        Str = "Select max(ErnTyp_TableSequence) from PrSsEarningTypes "

        Ds = GetData(Str)

        If CheckDataSet(Ds) Then
            Seq = DbNullToInt(Ds.Tables(0).Rows(0).Item(0))
        End If
        Seq = Seq + 1


        Seq = Seq + 1
        Str = "INSERT INTO PrSsEarningTypes " &
            " (ErnTyp_Code, " &
            " ErnTyp_DescriptionL, " &
            " ErnTyp_DescriptionS, " &
            " ErnTyp_TableSequence) " &
            " VALUES     ('R2', " &
            " 'RECURING EARNING 14', " &
            " 'REC ERN 14',  " &
            Seq & ") "

        i = ExecuteNonQuery(Str)
        If i < 0 Then
            Flag = False
        End If

        Seq = Seq + 1
        Str = "INSERT INTO PrSsEarningTypes " &
            " (ErnTyp_Code, " &
            " ErnTyp_DescriptionL, " &
            " ErnTyp_DescriptionS, " &
            " ErnTyp_TableSequence) " &
            " VALUES     ('B2', " &
            " 'RECURING BE 14', " &
            " 'REC BE 14',  " &
            Seq & ") "

        i = ExecuteNonQuery(Str)
        If i < 0 Then
            Flag = False
        End If

        Return Flag
    End Function
    Protected Function Upgrade_2019_8() As Boolean
        Dim Str As String
        Dim i As Integer
        Str = " ALTER TABLE PrTxtrxnheader " &
        " ADD [TrxHdr_GESIableAmount] [decimal](18, 2) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("1 New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If



        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE]" &
        " @TrxHdr_Id int," &
        " @Emp_Code varchar(16)," &
        " @PrdGrp_Code varchar(6)," &
        " @PrdCod_Code varchar(6)," &
        " @PayCat_Code varchar(4)," &
        " @TrxHdr_Date datetime," &
        " @TrxHdr_Status varchar(4)," &
        " @TrxHdr_TotalErnPeriod decimal(18,2)," &
        " @TrxHdr_TotalErnYTD decimal(18,2)," &
        " @TrxHdr_TotalDedPeriod decimal(18,2)," &
        " @TrxHdr_TotalDedYTD decimal(18,2)," &
        " @TrxHdr_TotalConPeriod decimal(18,2)," &
        " @TrxHdr_TotalConYTD decimal(18,2)," &
        " @TrxHdr_SIIncome decimal(18,2)," &
        " @TrxHdr_TaxableIncome decimal(18,2)," &
        " @TrxHdr_PaymentMethod varchar(50)," &
        " @TrxHdr_PaymentRef varchar(50)," &
        " @TrxHdr_PeriodUnits decimal(18,2)," &
        " @TrxHdr_AnnualUnits decimal(18,2)," &
        " @TrxHdr_AnnualLeave decimal(18,2)," &
        " @TrxHdr_LifeInsurance decimal(18,2)," &
        " @TrxHdr_Discounts decimal(18,2)," &
        " @TrxHdr_Interfacestatus varchar(4)," &
        " @TrxHdr_Overtime1 decimal(10,2)," &
        " @TrxHdr_Overtime2 decimal(10,2)," &
        " @TrxHdr_SIUnits decimal(10,2)," &
        " @TrxHdr_MonthlySalary decimal(18,2)," &
        " @TrxHdr_NetSalary decimal(18,2)," &
        " @TrxHdr_PeriodInsurable decimal(18,2)," &
        " @TemGrp_Code varchar(6)," &
        " @TrxHdr_ChequeNo varchar(50)," &
        " @TrxHdr_TaxableFromOther Decimal(18,2)," &
        " @TrxHdr_CurrencySymbol varchar(3)," &
        " @TrxHdr_Rate Decimal(18,10)," &
        " @TrxHdr_NormalDays Decimal(18,2)," &
        " @TrxHdr_Salary1 Decimal(18,2)," &
        " @TrxHdr_Salary2 Decimal(18,2)," &
        " @TrxHdr_Overtime3 decimal(10,2)," &
        " @TrxHdr_Sectors decimal(18,2)," &
        " @TrxHdr_Dutyhours decimal(18,2)," &
        " @TrxHdr_FlightHours decimal(18,2)," &
        " @TrxHdr_Commission decimal(18,2)," &
        " @TrxHdr_PBAmount decimal(18,2)," &
        " @TrxHdr_PBRate decimal(18,2)," &
        " @TrxHdr_Overlay decimal(18,2)," &
        " @TrxHdr_PeriodSplit decimal(18,2)," &
        " @TrxHdr_PeriodSplitSI decimal(18,2)," &
        " @TrxHdr_A1 varchar(12), " &
        " @TrxHdr_A2 varchar(12), " &
        " @TrxHdr_A3 varchar(12), " &
        " @TrxHdr_A4 varchar(12), " &
        " @TrxHdr_A5 varchar(12), " &
        " @TrxHdr_Union varchar(12), " &
        " @TrxHdr_Position varchar(12), " &
        " @TrxHdr_COLA decimal(18, 2)," &
        " @TrxHdr_MyRate decimal(18, 4)," &
        " @TrxHdr_FE decimal(18, 2)," &
        " @TrxHdr_NetYTD decimal(18, 2)," &
        " @TrxHdr_PFOnAgreedSalary decimal(18, 2)," &
        " @TrxHdr_BasisOnSalary decimal(18, 2)," &
        " @TrxHdr_GesiD decimal(18, 2)," &
        " @TrxHdr_GesiC decimal(18, 2)," &
        " @TrxHdr_Medical decimal(18, 2)," &
        " @Com_Code varchar(10)," &
        " @TrxHdr_Year varchar(4), " &
        " @TrxHdr_GESIableAmount decimal(18, 2)," &
        " @NewId Int OUTPUT " &
        " AS" &
        " DECLARE @Result as Int" &
        " Set  @Result = 0" &
        " SELECT @Result = Count(*)" &
        " FROM PrTxTrxnHeader" &
        " WHERE TrxHdr_Id =  @TrxHdr_Id" &
        " IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        "   INSERT INTO PrTxTrxnHeader" &
        "   (Emp_Code,                                           " &
        " PrdGrp_Code," &
        " PrdCod_Code,                                        " &
        " PayCat_Code,                                        " &
        " TrxHdr_Date,                                        " &
        " TrxHdr_Status,                                      " &
        " TrxHdr_TotalErnPeriod,                              " &
        " TrxHdr_TotalErnYTD,                                 " &
        " TrxHdr_TotalDedPeriod,                              " &
        " TrxHdr_TotalDedYTD,                                 " &
        " TrxHdr_TotalConPeriod,                              " &
        " TrxHdr_TotalConYTD,                                 " &
        " TrxHdr_SIIncome,                                    " &
        " TrxHdr_TaxableIncome,                               " &
        " TrxHdr_PaymentMethod,                               " &
        " TrxHdr_PaymentRef,                                  " &
        " TrxHdr_PeriodUnits,                                 " &
        " TrxHdr_AnnualUnits,                                 " &
        " TrxHdr_AnnualLeave,                                  " &
        " TrxHdr_LifeInsurance,                                " &
        " TrxHdr_Discounts,                                    " &
        " TrxHdr_InterfaceStatus,                               " &
        " TrxHdr_Overtime1," &
        " TrxHdr_Overtime2," &
        " TrxHdr_SIUnits," &
        " TrxHdr_MonthlySalary," &
        " TrxHdr_NetSalary," &
        " TrxHdr_PeriodInsurable," &
        " TemGrp_Code," &
        " TrxHdr_ChequeNo," &
        " TrxHdr_TaxableFromOther," &
        " TrxHdr_CurrencySymbol," &
        " TrxHdr_Rate," &
        " TrxHdr_NormalDays," &
        " TrxHdr_Salary1," &
        " TrxHdr_Salary2," &
        " TrxHdr_Overtime3," &
        " TrxHdr_Sectors," &
        " TrxHdr_Dutyhours," &
        " TrxHdr_FlightHours," &
        " TrxHdr_Commission," &
        " TrxHdr_PBAmount," &
        " TrxHdr_PBRate," &
        " TrxHdr_Overlay," &
        " TrxHdr_PeriodSplit, " &
        " TrxHdr_PeriodSplitSI, " &
        " TrxHdr_A1, " &
        " TrxHdr_A2, " &
        " TrxHdr_A3, " &
        " TrxHdr_A4, " &
        " TrxHdr_A5, " &
        " TrxHdr_Union, " &
        " TrxHdr_Position, " &
        " TrxHdr_COLA," &
        " TrxHdr_MyRate, " &
        " TrxHdr_FE, " &
        " TrxHdr_NetYTD, " &
        " TrxHdr_PFOnAgreedSalary, " &
        " TrxHdr_BasisOnSalary, " &
        " TrxHdr_GesiD, " &
        " TrxHdr_GesiC, " &
        " TrxHdr_Medical, " &
        " Com_Code, " &
        " TrxHdr_Year, " &
        " TrxHdr_GESIableAmount " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @PrdGrp_Code," &
        " @PrdCod_Code,                                        " &
        " @PayCat_Code,                                        " &
        " @TrxHdr_Date,                                        " &
        " @TrxHdr_Status,                                      " &
        " @TrxHdr_TotalErnPeriod,                              " &
        " @TrxHdr_TotalErnYTD,                                 " &
        " @TrxHdr_TotalDedPeriod,                              " &
        " @TrxHdr_TotalDedYTD,                                 " &
        " @TrxHdr_TotalConPeriod,                              " &
        " @TrxHdr_TotalConYTD,                                 " &
        " @TrxHdr_SIIncome,                                    " &
        " @TrxHdr_TaxableIncome,                               " &
        " @TrxHdr_PaymentMethod,                               " &
        " @TrxHdr_PaymentRef,                                  " &
        " @TrxHdr_PeriodUnits,                                 " &
        " @TrxHdr_AnnualUnits,                                 " &
        " @TrxHdr_AnnualLeave,                                 " &
        " @TrxHdr_LifeInsurance,                               " &
        " @TrxHdr_Discounts,                                   " &
        " @TrxHdr_InterfaceStatus,                              " &
        " @TrxHdr_Overtime1," &
        " @TrxHdr_Overtime2," &
        " @TrxHdr_SIUnits," &
        " @TrxHdr_MonthlySalary," &
        " @TrxHdr_NetSalary," &
        " @TrxHdr_PeriodInsurable," &
        " @TemGrp_Code, " &
        " @TrxHdr_ChequeNo," &
        " @TrxHdr_TaxableFromOther," &
        " @TrxHdr_CurrencySymbol," &
        " @TrxHdr_Rate," &
        " @TrxHdr_NormalDays," &
        " @TrxHdr_Salary1," &
        " @TrxHdr_Salary2," &
        " @TrxHdr_Overtime3," &
        " @TrxHdr_Sectors," &
        " @TrxHdr_Dutyhours," &
        " @TrxHdr_FlightHours," &
        " @TrxHdr_Commission," &
        " @TrxHdr_PBAmount," &
        " @TrxHdr_PBRate," &
        " @TrxHdr_Overlay," &
        " @TrxHdr_PeriodSplit, " &
        " @TrxHdr_PeriodSplitSI, " &
        " @TrxHdr_A1, " &
        " @TrxHdr_A2, " &
        " @TrxHdr_A3, " &
        " @TrxHdr_A4, " &
        " @TrxHdr_A5, " &
        " @TrxHdr_Union, " &
        " @TrxHdr_Position, " &
        " @TrxHdr_COLA," &
        " @TrxHdr_MyRate," &
        " @TrxHdr_FE, " &
        " @TrxHdr_NetYTD, " &
        " @TrxHdr_PFOnAgreedSalary, " &
        " @TrxHdr_BasisOnSalary, " &
        " @TrxHdr_GesiD, " &
        " @TrxHdr_GesiC, " &
        " @TrxHdr_Medical, " &
        " @Com_Code, " &
        " @TrxHdr_Year, " &
        " @TrxHdr_GESIableAmount " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrTxTrxnHeader" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     PrdGrp_Code=@PrdGrp_Code," &
        "     PrdCod_Code=@PrdCod_Code,                             " &
        "     PayCat_Code=@PayCat_Code,                             " &
        "     TrxHdr_Date=@TrxHdr_Date,                             " &
        "    TrxHdr_Status=@TrxHdr_Status,                         " &
        "  TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " &
        "     TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " &
        "    TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " &
        "   TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " &
        "  TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " &
        " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " &
        " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " &
        " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " &
        " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " &
        " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " &
        " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " &
        " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " &
        " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,                " &
        " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " &
        " TrxHdr_Discounts=@TrxHdr_Discounts,                    " &
        " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,        " &
        " TrxHdr_Overtime1=@TrxHdr_Overtime1," &
        " TrxHdr_Overtime2=@TrxHdr_Overtime2," &
        " TrxHdr_SIUnits=@TrxHdr_SIUnits," &
        " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary," &
        " TrxHdr_NetSalary=@TrxHdr_NetSalary," &
        " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable," &
        " TemGrp_Code=@TemGrp_Code," &
        " TrxHdr_ChequeNo=@TrxHdr_ChequeNo ," &
        " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther," &
        " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol," &
        " TrxHdr_Rate=@TrxHdr_Rate," &
        " TrxHdr_NormalDays=@TrxHdr_NormalDays ," &
        " TrxHdr_Salary1=@TrxHdr_Salary1," &
        " TrxHdr_Salary2=@TrxHdr_Salary2," &
        " TrxHdr_Overtime3=@TrxHdr_Overtime3," &
        " TrxHdr_Sectors=@TrxHdr_Sectors," &
        " TrxHdr_Dutyhours=@TrxHdr_Dutyhours," &
        " TrxHdr_FlightHours=@TrxHdr_FlightHours," &
        " TrxHdr_Commission=@TrxHdr_Commission," &
        " TrxHdr_PBAmount=@TrxHdr_PBAmount," &
        " TrxHdr_PBRate=@TrxHdr_PBRate," &
        " TrxHdr_Overlay=@TrxHdr_Overlay," &
        " TrxHdr_PeriodSplit=@TrxHdr_PeriodSplit, " &
        " TrxHdr_PeriodSplitSI=@TrxHdr_PeriodSplitSI," &
        " TrxHdr_A1=@TrxHdr_A1, " &
        " TrxHdr_A2=@TrxHdr_A2, " &
        " TrxHdr_A3=@TrxHdr_A3, " &
        " TrxHdr_A4=@TrxHdr_A4, " &
        " TrxHdr_A5=@TrxHdr_A5, " &
        " TrxHdr_Union=@TrxHdr_Union, " &
        " TrxHdr_Position=@TrxHdr_Position, " &
        " TrxHdr_COLA=@TrxHdr_COLA," &
        " TrxHdr_MyRate=@TrxHdr_MyRate, " &
        " TrxHdr_FE=@TrxHdr_FE, " &
        " TrxHdr_NetYTD=@TrxHdr_NetYTD, " &
        " TrxHdr_PFOnAgreedSalary=@TrxHdr_PFOnAgreedSalary, " &
        " TrxHdr_BasisOnSalary=@TrxHdr_BasisOnSalary, " &
        " TrxHdr_GesiD=@TrxHdr_GesiD, " &
        " TrxHdr_GesiC=@TrxHdr_GesiC, " &
        " TrxHdr_Medical=@TrxHdr_Medical, " &
        " Com_Code=@Com_Code, " &
        " TrxHdr_Year=@TrxHdr_Year, " &
        " TrxHdr_GESIableAmount =@TrxHdr_GESIableAmount " &
        " WHERE TrxHdr_Id = @TrxHdr_Id" &
        " END " &
        " set  @NewId=SCOPE_IDENTITY()"

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If




        Return Proceed

    End Function
    Protected Function Upgrade_2019_9() As Boolean
        Dim Str As String
        Dim i As Integer
        Str = " ALTER TABLE PrTxtrxnheader " &
        " ADD [TrxHdr_BIK_GesiD] [decimal](18, 2) NULL, " &
        " [TrxHdr_BIK_GesiC] [decimal](18, 2) NULL, " &
        " [TrxHdr_BIK_Gesiable] [decimal](18, 2) NULL "



        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("3 New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If

        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE]" &
               " @TrxHdr_Id int," &
               " @Emp_Code varchar(16)," &
               " @PrdGrp_Code varchar(6)," &
               " @PrdCod_Code varchar(6)," &
               " @PayCat_Code varchar(4)," &
               " @TrxHdr_Date datetime," &
               " @TrxHdr_Status varchar(4)," &
               " @TrxHdr_TotalErnPeriod decimal(18,2)," &
               " @TrxHdr_TotalErnYTD decimal(18,2)," &
               " @TrxHdr_TotalDedPeriod decimal(18,2)," &
               " @TrxHdr_TotalDedYTD decimal(18,2)," &
               " @TrxHdr_TotalConPeriod decimal(18,2)," &
               " @TrxHdr_TotalConYTD decimal(18,2)," &
               " @TrxHdr_SIIncome decimal(18,2)," &
               " @TrxHdr_TaxableIncome decimal(18,2)," &
               " @TrxHdr_PaymentMethod varchar(50)," &
               " @TrxHdr_PaymentRef varchar(50)," &
               " @TrxHdr_PeriodUnits decimal(18,2)," &
               " @TrxHdr_AnnualUnits decimal(18,2)," &
               " @TrxHdr_AnnualLeave decimal(18,2)," &
               " @TrxHdr_LifeInsurance decimal(18,2)," &
               " @TrxHdr_Discounts decimal(18,2)," &
               " @TrxHdr_Interfacestatus varchar(4)," &
               " @TrxHdr_Overtime1 decimal(10,2)," &
               " @TrxHdr_Overtime2 decimal(10,2)," &
               " @TrxHdr_SIUnits decimal(10,2)," &
               " @TrxHdr_MonthlySalary decimal(18,2)," &
               " @TrxHdr_NetSalary decimal(18,2)," &
               " @TrxHdr_PeriodInsurable decimal(18,2)," &
               " @TemGrp_Code varchar(6)," &
               " @TrxHdr_ChequeNo varchar(50)," &
               " @TrxHdr_TaxableFromOther Decimal(18,2)," &
               " @TrxHdr_CurrencySymbol varchar(3)," &
               " @TrxHdr_Rate Decimal(18,10)," &
               " @TrxHdr_NormalDays Decimal(18,2)," &
               " @TrxHdr_Salary1 Decimal(18,2)," &
               " @TrxHdr_Salary2 Decimal(18,2)," &
               " @TrxHdr_Overtime3 decimal(10,2)," &
               " @TrxHdr_Sectors decimal(18,2)," &
               " @TrxHdr_Dutyhours decimal(18,2)," &
               " @TrxHdr_FlightHours decimal(18,2)," &
               " @TrxHdr_Commission decimal(18,2)," &
               " @TrxHdr_PBAmount decimal(18,2)," &
               " @TrxHdr_PBRate decimal(18,2)," &
               " @TrxHdr_Overlay decimal(18,2)," &
               " @TrxHdr_PeriodSplit decimal(18,2)," &
               " @TrxHdr_PeriodSplitSI decimal(18,2)," &
               " @TrxHdr_A1 varchar(12), " &
               " @TrxHdr_A2 varchar(12), " &
               " @TrxHdr_A3 varchar(12), " &
               " @TrxHdr_A4 varchar(12), " &
               " @TrxHdr_A5 varchar(12), " &
               " @TrxHdr_Union varchar(12), " &
               " @TrxHdr_Position varchar(12), " &
               " @TrxHdr_COLA decimal(18, 2)," &
               " @TrxHdr_MyRate decimal(18, 4)," &
               " @TrxHdr_FE decimal(18, 2)," &
               " @TrxHdr_NetYTD decimal(18, 2)," &
               " @TrxHdr_PFOnAgreedSalary decimal(18, 2)," &
               " @TrxHdr_BasisOnSalary decimal(18, 2)," &
               " @TrxHdr_GesiD decimal(18, 2)," &
               " @TrxHdr_GesiC decimal(18, 2)," &
               " @TrxHdr_Medical decimal(18, 2)," &
               " @Com_Code varchar(10)," &
               " @TrxHdr_Year varchar(4), " &
               " @TrxHdr_GESIableAmount decimal(18, 2)," &
               " @TrxHdr_BIK_GesiD decimal(18, 2)," &
               " @TrxHdr_BIK_GesiC decimal(18, 2)," &
               " @TrxHdr_BIK_Gesiable decimal(18, 2)," &
               " @NewId Int OUTPUT " &
               " AS" &
               " DECLARE @Result as Int" &
               " Set  @Result = 0" &
               " SELECT @Result = Count(*)" &
               " FROM PrTxTrxnHeader" &
               " WHERE TrxHdr_Id =  @TrxHdr_Id" &
               " IF(@Result IS NULL) OR (@Result=0)" &
               " BEGIN" &
               "   INSERT INTO PrTxTrxnHeader" &
               "   (Emp_Code,                                           " &
               " PrdGrp_Code," &
               " PrdCod_Code,                                        " &
               " PayCat_Code,                                        " &
               " TrxHdr_Date,                                        " &
               " TrxHdr_Status,                                      " &
               " TrxHdr_TotalErnPeriod,                              " &
               " TrxHdr_TotalErnYTD,                                 " &
               " TrxHdr_TotalDedPeriod,                              " &
               " TrxHdr_TotalDedYTD,                                 " &
               " TrxHdr_TotalConPeriod,                              " &
               " TrxHdr_TotalConYTD,                                 " &
               " TrxHdr_SIIncome,                                    " &
               " TrxHdr_TaxableIncome,                               " &
               " TrxHdr_PaymentMethod,                               " &
               " TrxHdr_PaymentRef,                                  " &
               " TrxHdr_PeriodUnits,                                 " &
               " TrxHdr_AnnualUnits,                                 " &
               " TrxHdr_AnnualLeave,                                  " &
               " TrxHdr_LifeInsurance,                                " &
               " TrxHdr_Discounts,                                    " &
               " TrxHdr_InterfaceStatus,                               " &
               " TrxHdr_Overtime1," &
               " TrxHdr_Overtime2," &
               " TrxHdr_SIUnits," &
               " TrxHdr_MonthlySalary," &
               " TrxHdr_NetSalary," &
               " TrxHdr_PeriodInsurable," &
               " TemGrp_Code," &
               " TrxHdr_ChequeNo," &
               " TrxHdr_TaxableFromOther," &
               " TrxHdr_CurrencySymbol," &
               " TrxHdr_Rate," &
               " TrxHdr_NormalDays," &
               " TrxHdr_Salary1," &
               " TrxHdr_Salary2," &
               " TrxHdr_Overtime3," &
               " TrxHdr_Sectors," &
               " TrxHdr_Dutyhours," &
               " TrxHdr_FlightHours," &
               " TrxHdr_Commission," &
               " TrxHdr_PBAmount," &
               " TrxHdr_PBRate," &
               " TrxHdr_Overlay," &
               " TrxHdr_PeriodSplit, " &
               " TrxHdr_PeriodSplitSI, " &
               " TrxHdr_A1, " &
               " TrxHdr_A2, " &
               " TrxHdr_A3, " &
               " TrxHdr_A4, " &
               " TrxHdr_A5, " &
               " TrxHdr_Union, " &
               " TrxHdr_Position, " &
               " TrxHdr_COLA," &
               " TrxHdr_MyRate, " &
               " TrxHdr_FE, " &
               " TrxHdr_NetYTD, " &
               " TrxHdr_PFOnAgreedSalary, " &
               " TrxHdr_BasisOnSalary, " &
               " TrxHdr_GesiD, " &
               " TrxHdr_GesiC, " &
               " TrxHdr_Medical, " &
               " Com_Code, " &
               " TrxHdr_Year, " &
               " TrxHdr_GESIableAmount, " &
               " TrxHdr_BIK_GesiD, " &
               " TrxHdr_BIK_GesiC, " &
               " TrxHdr_BIK_Gesiable " &
               " )" &
               " VALUES (" &
               " @Emp_Code,                                           " &
               " @PrdGrp_Code," &
               " @PrdCod_Code,                                        " &
               " @PayCat_Code,                                        " &
               " @TrxHdr_Date,                                        " &
               " @TrxHdr_Status,                                      " &
               " @TrxHdr_TotalErnPeriod,                              " &
               " @TrxHdr_TotalErnYTD,                                 " &
               " @TrxHdr_TotalDedPeriod,                              " &
               " @TrxHdr_TotalDedYTD,                                 " &
               " @TrxHdr_TotalConPeriod,                              " &
               " @TrxHdr_TotalConYTD,                                 " &
               " @TrxHdr_SIIncome,                                    " &
               " @TrxHdr_TaxableIncome,                               " &
               " @TrxHdr_PaymentMethod,                               " &
               " @TrxHdr_PaymentRef,                                  " &
               " @TrxHdr_PeriodUnits,                                 " &
               " @TrxHdr_AnnualUnits,                                 " &
               " @TrxHdr_AnnualLeave,                                 " &
               " @TrxHdr_LifeInsurance,                               " &
               " @TrxHdr_Discounts,                                   " &
               " @TrxHdr_InterfaceStatus,                              " &
               " @TrxHdr_Overtime1," &
               " @TrxHdr_Overtime2," &
               " @TrxHdr_SIUnits," &
               " @TrxHdr_MonthlySalary," &
               " @TrxHdr_NetSalary," &
               " @TrxHdr_PeriodInsurable," &
               " @TemGrp_Code, " &
               " @TrxHdr_ChequeNo," &
               " @TrxHdr_TaxableFromOther," &
               " @TrxHdr_CurrencySymbol," &
               " @TrxHdr_Rate," &
               " @TrxHdr_NormalDays," &
               " @TrxHdr_Salary1," &
               " @TrxHdr_Salary2," &
               " @TrxHdr_Overtime3," &
               " @TrxHdr_Sectors," &
               " @TrxHdr_Dutyhours," &
               " @TrxHdr_FlightHours," &
               " @TrxHdr_Commission," &
               " @TrxHdr_PBAmount," &
               " @TrxHdr_PBRate," &
               " @TrxHdr_Overlay," &
               " @TrxHdr_PeriodSplit, " &
               " @TrxHdr_PeriodSplitSI, " &
               " @TrxHdr_A1, " &
               " @TrxHdr_A2, " &
               " @TrxHdr_A3, " &
               " @TrxHdr_A4, " &
               " @TrxHdr_A5, " &
               " @TrxHdr_Union, " &
               " @TrxHdr_Position, " &
               " @TrxHdr_COLA," &
               " @TrxHdr_MyRate," &
               " @TrxHdr_FE, " &
               " @TrxHdr_NetYTD, " &
               " @TrxHdr_PFOnAgreedSalary, " &
               " @TrxHdr_BasisOnSalary, " &
               " @TrxHdr_GesiD, " &
               " @TrxHdr_GesiC, " &
               " @TrxHdr_Medical, " &
               " @Com_Code, " &
               " @TrxHdr_Year, " &
               " @TrxHdr_GESIableAmount, " &
               " @TrxHdr_BIK_GesiD, " &
               " @TrxHdr_BIK_GesiC, " &
               " @TrxHdr_BIK_Gesiable " &
               " )" &
               " END" &
               " ELSE" &
               "   BEGIN" &
               "     UPDATE PrTxTrxnHeader" &
               "     SET " &
               "     Emp_Code=@Emp_Code,                                   " &
               "     PrdGrp_Code=@PrdGrp_Code," &
               "     PrdCod_Code=@PrdCod_Code,                             " &
               "     PayCat_Code=@PayCat_Code,                             " &
               "     TrxHdr_Date=@TrxHdr_Date,                             " &
               "    TrxHdr_Status=@TrxHdr_Status,                         " &
               "  TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " &
               "     TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " &
               "    TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " &
               "   TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " &
               "  TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " &
               " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " &
               " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " &
               " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " &
               " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " &
               " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " &
               " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " &
               " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " &
               " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,                " &
               " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " &
               " TrxHdr_Discounts=@TrxHdr_Discounts,                    " &
               " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,        " &
               " TrxHdr_Overtime1=@TrxHdr_Overtime1," &
               " TrxHdr_Overtime2=@TrxHdr_Overtime2," &
               " TrxHdr_SIUnits=@TrxHdr_SIUnits," &
               " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary," &
               " TrxHdr_NetSalary=@TrxHdr_NetSalary," &
               " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable," &
               " TemGrp_Code=@TemGrp_Code," &
               " TrxHdr_ChequeNo=@TrxHdr_ChequeNo ," &
               " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther," &
               " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol," &
               " TrxHdr_Rate=@TrxHdr_Rate," &
               " TrxHdr_NormalDays=@TrxHdr_NormalDays ," &
               " TrxHdr_Salary1=@TrxHdr_Salary1," &
               " TrxHdr_Salary2=@TrxHdr_Salary2," &
               " TrxHdr_Overtime3=@TrxHdr_Overtime3," &
               " TrxHdr_Sectors=@TrxHdr_Sectors," &
               " TrxHdr_Dutyhours=@TrxHdr_Dutyhours," &
               " TrxHdr_FlightHours=@TrxHdr_FlightHours," &
               " TrxHdr_Commission=@TrxHdr_Commission," &
               " TrxHdr_PBAmount=@TrxHdr_PBAmount," &
               " TrxHdr_PBRate=@TrxHdr_PBRate," &
               " TrxHdr_Overlay=@TrxHdr_Overlay," &
               " TrxHdr_PeriodSplit=@TrxHdr_PeriodSplit, " &
               " TrxHdr_PeriodSplitSI=@TrxHdr_PeriodSplitSI," &
               " TrxHdr_A1=@TrxHdr_A1, " &
               " TrxHdr_A2=@TrxHdr_A2, " &
               " TrxHdr_A3=@TrxHdr_A3, " &
               " TrxHdr_A4=@TrxHdr_A4, " &
               " TrxHdr_A5=@TrxHdr_A5, " &
               " TrxHdr_Union=@TrxHdr_Union, " &
               " TrxHdr_Position=@TrxHdr_Position, " &
               " TrxHdr_COLA=@TrxHdr_COLA," &
               " TrxHdr_MyRate=@TrxHdr_MyRate, " &
               " TrxHdr_FE=@TrxHdr_FE, " &
               " TrxHdr_NetYTD=@TrxHdr_NetYTD, " &
               " TrxHdr_PFOnAgreedSalary=@TrxHdr_PFOnAgreedSalary, " &
               " TrxHdr_BasisOnSalary=@TrxHdr_BasisOnSalary, " &
               " TrxHdr_GesiD=@TrxHdr_GesiD, " &
               " TrxHdr_GesiC=@TrxHdr_GesiC, " &
               " TrxHdr_Medical=@TrxHdr_Medical, " &
               " Com_Code=@Com_Code, " &
               " TrxHdr_Year=@TrxHdr_Year, " &
               " TrxHdr_GESIableAmount =@TrxHdr_GESIableAmount, " &
                " TrxHdr_BIK_GesiD = TrxHdr_BIK_GesiD, " &
               " TrxHdr_BIK_GesiC = TrxHdr_BIK_GesiC, " &
               " TrxHdr_BIK_Gesiable = TrxHdr_BIK_Gesiable " &
               " WHERE TrxHdr_Id = @TrxHdr_Id" &
               " END " &
               " set  @NewId=SCOPE_IDENTITY()"

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If




        Return Proceed



    End Function
    Protected Function Upgrade_2019_10()

        Dim Str As String
        Dim i As Integer
        Dim Seq As Integer = 0

        Str = "Select max(ConTyp_TableSequence) from PrSsContributionTypes "
        Dim ds As DataSet
        ds = GetData(Str)

        If CheckDataSet(ds) Then
            Seq = DbNullToInt(ds.Tables(0).Rows(0).Item(0))
        End If
        Seq = Seq + 1

        Str = "INSERT INTO PrSsContributionTypes " &
            " (ConTyp_Code, " &
            " ConTyp_DescriptionL, " &
            " ConTyp_DescriptionS, " &
            " ConTyp_TableSequence) " &
            " VALUES     ('BC', " &
            " 'BIK GESY', " &
            " 'BIK GESY',  " &
             Seq & ") "
        i = ExecuteNonQuery(Str)

        Str = "Select max(DedTyp_TableSequence) from PrSsDeductionTypes "

        ds = GetData(Str)

        If CheckDataSet(ds) Then
            Seq = DbNullToInt(ds.Tables(0).Rows(0).Item(0))
        End If
        Seq = Seq + 1


        Seq = Seq + 1
        Str = "INSERT INTO PrSsDeductionTypes " &
            " (DedTyp_Code, " &
            " DedTyp_DescriptionL, " &
            " DedTyp_DescriptionS, " &
            " DedTyp_TableSequence) " &
            " VALUES     ('GT', " &
            " 'GESY BIK', " &
            " 'GESY BIK',  " &
            Seq & ") "
        i = ExecuteNonQuery(Str)




        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        '                       Contribution
        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''


        Str = "select MAX(ConCod_Code) from PrMsContributionCodes where len(ConCod_Code)=3"
        ds = GetData(Str)
        Dim CodeSeq As Integer = 0

        If CheckDataSet(ds) Then
            Dim Code As String
            Code = DbNullToString(ds.Tables(0).Rows(0).Item(0))
            Code = Replace(Code, "C", "")
            CodeSeq = CInt(Code)
        End If

        Dim ConCode As String

        CodeSeq = CodeSeq + 1
        ConCode = "C" & CodeSeq
        Str = "INSERT INTO PrMsContributionCodes " &
        "(ConCod_Code, " &
        "ConTyp_Code, " &
        "ConCod_DescriptionL, " &
        "ConCod_DescriptionS, " &
        "ConCod_IsActive) " &
        "VALUES (" & enQuoteString(ConCode) & ", " &
        "'BC', " &
        "'GESY BIK', " &
        "'GESY BIK', " &
        "'Y') "

        i = ExecuteNonQuery(Str)


        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        '                       Deduction
        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''


        Str = "select MAX(DedCod_Code) from PrMsDeductionCodes where len(DedCod_Code)=3"
        ds = GetData(Str)


        If CheckDataSet(ds) Then
            Dim Code As String
            Code = DbNullToString(ds.Tables(0).Rows(0).Item(0))
            Code = Replace(Code, "D", "")
            CodeSeq = CInt(Code)
        End If

        Dim DedCode As String

        CodeSeq = CodeSeq + 1
        DedCode = "D" & CodeSeq
        Str = "INSERT INTO PrMsDeductionCodes " &
        "(DedCod_Code, " &
        "DedTyp_Code, " &
        "DedCod_DescriptionL, " &
        "DedCod_DescriptionS, " &
        "DedCod_IsActive) " &
        "VALUES (" & enQuoteString(DedCode) & ", " &
        "'GT', " &
        "'BIK GESY', " &
        "'BIK GESY', " &
        "'Y') "

        i = ExecuteNonQuery(Str)






        Return True

    End Function
    Protected Function Upgrade_2019_1() As Boolean
        Dim Str As String
        Dim i As Integer
        Str = " ALTER TABLE PrTxtrxnheader " &
        " ADD [TrxHdr_GesiD] [decimal](18, 2) NULL, " &
        " [TrxHdr_GesiC] [decimal](18, 2) NULL, " &
        " [TrxHdr_Medical] [decimal](18, 2) NULL, " &
        " [Com_Code] [nvarchar](10) NULL, " &
        " [TrxHdr_Year] [nvarchar](4) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("6 New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If



        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE]" &
        " @TrxHdr_Id int," &
        " @Emp_Code varchar(16)," &
        " @PrdGrp_Code varchar(6)," &
        " @PrdCod_Code varchar(6)," &
        " @PayCat_Code varchar(4)," &
        " @TrxHdr_Date datetime," &
        " @TrxHdr_Status varchar(4)," &
        " @TrxHdr_TotalErnPeriod decimal(18,2)," &
        " @TrxHdr_TotalErnYTD decimal(18,2)," &
        " @TrxHdr_TotalDedPeriod decimal(18,2)," &
        " @TrxHdr_TotalDedYTD decimal(18,2)," &
        " @TrxHdr_TotalConPeriod decimal(18,2)," &
        " @TrxHdr_TotalConYTD decimal(18,2)," &
        " @TrxHdr_SIIncome decimal(18,2)," &
        " @TrxHdr_TaxableIncome decimal(18,2)," &
        " @TrxHdr_PaymentMethod varchar(50)," &
        " @TrxHdr_PaymentRef varchar(50)," &
        " @TrxHdr_PeriodUnits decimal(18,2)," &
        " @TrxHdr_AnnualUnits decimal(18,2)," &
        " @TrxHdr_AnnualLeave decimal(18,2)," &
        " @TrxHdr_LifeInsurance decimal(18,2)," &
        " @TrxHdr_Discounts decimal(18,2)," &
        " @TrxHdr_Interfacestatus varchar(4)," &
        " @TrxHdr_Overtime1 decimal(10,2)," &
        " @TrxHdr_Overtime2 decimal(10,2)," &
        " @TrxHdr_SIUnits decimal(10,2)," &
        " @TrxHdr_MonthlySalary decimal(18,2)," &
        " @TrxHdr_NetSalary decimal(18,2)," &
        " @TrxHdr_PeriodInsurable decimal(18,2)," &
        " @TemGrp_Code varchar(6)," &
        " @TrxHdr_ChequeNo varchar(50)," &
        " @TrxHdr_TaxableFromOther Decimal(18,2)," &
        " @TrxHdr_CurrencySymbol varchar(3)," &
        " @TrxHdr_Rate Decimal(18,10)," &
        " @TrxHdr_NormalDays Decimal(18,2)," &
        " @TrxHdr_Salary1 Decimal(18,2)," &
        " @TrxHdr_Salary2 Decimal(18,2)," &
        " @TrxHdr_Overtime3 decimal(10,2)," &
        " @TrxHdr_Sectors decimal(18,2)," &
        " @TrxHdr_Dutyhours decimal(18,2)," &
        " @TrxHdr_FlightHours decimal(18,2)," &
        " @TrxHdr_Commission decimal(18,2)," &
        " @TrxHdr_PBAmount decimal(18,2)," &
        " @TrxHdr_PBRate decimal(18,2)," &
        " @TrxHdr_Overlay decimal(18,2)," &
        " @TrxHdr_PeriodSplit decimal(18,2)," &
        " @TrxHdr_PeriodSplitSI decimal(18,2)," &
        " @TrxHdr_A1 varchar(12), " &
        " @TrxHdr_A2 varchar(12), " &
        " @TrxHdr_A3 varchar(12), " &
        " @TrxHdr_A4 varchar(12), " &
        " @TrxHdr_A5 varchar(12), " &
        " @TrxHdr_Union varchar(12), " &
        " @TrxHdr_Position varchar(12), " &
        " @TrxHdr_COLA decimal(18, 2)," &
        " @TrxHdr_MyRate decimal(18, 4)," &
        " @TrxHdr_FE decimal(18, 2)," &
        " @TrxHdr_NetYTD decimal(18, 2)," &
        " @TrxHdr_PFOnAgreedSalary decimal(18, 2)," &
        " @TrxHdr_BasisOnSalary decimal(18, 2)," &
        " @TrxHdr_GesiD decimal(18, 2)," &
        " @TrxHdr_GesiC decimal(18, 2)," &
        " @TrxHdr_Medical decimal(18, 2)," &
        " @Com_Code varchar(10)," &
        " @TrxHdr_Year varchar(4), " &
        " @NewId Int OUTPUT " &
        " AS" &
        " DECLARE @Result as Int" &
        " Set  @Result = 0" &
        " SELECT @Result = Count(*)" &
        " FROM PrTxTrxnHeader" &
        " WHERE TrxHdr_Id =  @TrxHdr_Id" &
        " IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        "   INSERT INTO PrTxTrxnHeader" &
        "   (Emp_Code,                                           " &
        " PrdGrp_Code," &
        " PrdCod_Code,                                        " &
        " PayCat_Code,                                        " &
        " TrxHdr_Date,                                        " &
        " TrxHdr_Status,                                      " &
        " TrxHdr_TotalErnPeriod,                              " &
        " TrxHdr_TotalErnYTD,                                 " &
        " TrxHdr_TotalDedPeriod,                              " &
        " TrxHdr_TotalDedYTD,                                 " &
        " TrxHdr_TotalConPeriod,                              " &
        " TrxHdr_TotalConYTD,                                 " &
        " TrxHdr_SIIncome,                                    " &
        " TrxHdr_TaxableIncome,                               " &
        " TrxHdr_PaymentMethod,                               " &
        " TrxHdr_PaymentRef,                                  " &
        " TrxHdr_PeriodUnits,                                 " &
        " TrxHdr_AnnualUnits,                                 " &
        " TrxHdr_AnnualLeave,                                  " &
        " TrxHdr_LifeInsurance,                                " &
        " TrxHdr_Discounts,                                    " &
        " TrxHdr_InterfaceStatus,                               " &
        " TrxHdr_Overtime1," &
        " TrxHdr_Overtime2," &
        " TrxHdr_SIUnits," &
        " TrxHdr_MonthlySalary," &
        " TrxHdr_NetSalary," &
        " TrxHdr_PeriodInsurable," &
        " TemGrp_Code," &
        " TrxHdr_ChequeNo," &
        " TrxHdr_TaxableFromOther," &
        " TrxHdr_CurrencySymbol," &
        " TrxHdr_Rate," &
        " TrxHdr_NormalDays," &
        " TrxHdr_Salary1," &
        " TrxHdr_Salary2," &
        " TrxHdr_Overtime3," &
        " TrxHdr_Sectors," &
        " TrxHdr_Dutyhours," &
        " TrxHdr_FlightHours," &
        " TrxHdr_Commission," &
        " TrxHdr_PBAmount," &
        " TrxHdr_PBRate," &
        " TrxHdr_Overlay," &
        " TrxHdr_PeriodSplit, " &
        " TrxHdr_PeriodSplitSI, " &
        " TrxHdr_A1, " &
        " TrxHdr_A2, " &
        " TrxHdr_A3, " &
        " TrxHdr_A4, " &
        " TrxHdr_A5, " &
        " TrxHdr_Union, " &
        " TrxHdr_Position, " &
        " TrxHdr_COLA," &
        " TrxHdr_MyRate, " &
        " TrxHdr_FE, " &
        " TrxHdr_NetYTD, " &
        " TrxHdr_PFOnAgreedSalary, " &
        " TrxHdr_BasisOnSalary, " &
        " TrxHdr_GesiD, " &
        " TrxHdr_GesiC, " &
        " TrxHdr_Medical, " &
        " Com_Code, " &
        " TrxHdr_Year " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @PrdGrp_Code," &
        " @PrdCod_Code,                                        " &
        " @PayCat_Code,                                        " &
        " @TrxHdr_Date,                                        " &
        " @TrxHdr_Status,                                      " &
        " @TrxHdr_TotalErnPeriod,                              " &
        " @TrxHdr_TotalErnYTD,                                 " &
        " @TrxHdr_TotalDedPeriod,                              " &
        " @TrxHdr_TotalDedYTD,                                 " &
        " @TrxHdr_TotalConPeriod,                              " &
        " @TrxHdr_TotalConYTD,                                 " &
        " @TrxHdr_SIIncome,                                    " &
        " @TrxHdr_TaxableIncome,                               " &
        " @TrxHdr_PaymentMethod,                               " &
        " @TrxHdr_PaymentRef,                                  " &
        " @TrxHdr_PeriodUnits,                                 " &
        " @TrxHdr_AnnualUnits,                                 " &
        " @TrxHdr_AnnualLeave,                                 " &
        " @TrxHdr_LifeInsurance,                               " &
        " @TrxHdr_Discounts,                                   " &
        " @TrxHdr_InterfaceStatus,                              " &
        " @TrxHdr_Overtime1," &
        " @TrxHdr_Overtime2," &
        " @TrxHdr_SIUnits," &
        " @TrxHdr_MonthlySalary," &
        " @TrxHdr_NetSalary," &
        " @TrxHdr_PeriodInsurable," &
        " @TemGrp_Code, " &
        " @TrxHdr_ChequeNo," &
        " @TrxHdr_TaxableFromOther," &
        " @TrxHdr_CurrencySymbol," &
        " @TrxHdr_Rate," &
        " @TrxHdr_NormalDays," &
        " @TrxHdr_Salary1," &
        " @TrxHdr_Salary2," &
        " @TrxHdr_Overtime3," &
        " @TrxHdr_Sectors," &
        " @TrxHdr_Dutyhours," &
        " @TrxHdr_FlightHours," &
        " @TrxHdr_Commission," &
        " @TrxHdr_PBAmount," &
        " @TrxHdr_PBRate," &
        " @TrxHdr_Overlay," &
        " @TrxHdr_PeriodSplit, " &
        " @TrxHdr_PeriodSplitSI, " &
        " @TrxHdr_A1, " &
        " @TrxHdr_A2, " &
        " @TrxHdr_A3, " &
        " @TrxHdr_A4, " &
        " @TrxHdr_A5, " &
        " @TrxHdr_Union, " &
        " @TrxHdr_Position, " &
        " @TrxHdr_COLA," &
        " @TrxHdr_MyRate," &
        " @TrxHdr_FE, " &
        " @TrxHdr_NetYTD, " &
        " @TrxHdr_PFOnAgreedSalary, " &
        " @TrxHdr_BasisOnSalary, " &
        " @TrxHdr_GesiD, " &
        " @TrxHdr_GesiC, " &
        " @TrxHdr_Medical, " &
        " @Com_Code, " &
        " @TrxHdr_Year " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrTxTrxnHeader" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     PrdGrp_Code=@PrdGrp_Code," &
        "     PrdCod_Code=@PrdCod_Code,                             " &
        "     PayCat_Code=@PayCat_Code,                             " &
        "     TrxHdr_Date=@TrxHdr_Date,                             " &
        "    TrxHdr_Status=@TrxHdr_Status,                         " &
        "  TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " &
        "     TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " &
        "    TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " &
        "   TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " &
        "  TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " &
        " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " &
        " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " &
        " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " &
        " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " &
        " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " &
        " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " &
        " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " &
        " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,                " &
        " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " &
        " TrxHdr_Discounts=@TrxHdr_Discounts,                    " &
        " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,        " &
        " TrxHdr_Overtime1=@TrxHdr_Overtime1," &
        " TrxHdr_Overtime2=@TrxHdr_Overtime2," &
        " TrxHdr_SIUnits=@TrxHdr_SIUnits," &
        " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary," &
        " TrxHdr_NetSalary=@TrxHdr_NetSalary," &
        " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable," &
        " TemGrp_Code=@TemGrp_Code," &
        " TrxHdr_ChequeNo=@TrxHdr_ChequeNo ," &
        " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther," &
        " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol," &
        " TrxHdr_Rate=@TrxHdr_Rate," &
        " TrxHdr_NormalDays=@TrxHdr_NormalDays ," &
        " TrxHdr_Salary1=@TrxHdr_Salary1," &
        " TrxHdr_Salary2=@TrxHdr_Salary2," &
        " TrxHdr_Overtime3=@TrxHdr_Overtime3," &
        " TrxHdr_Sectors=@TrxHdr_Sectors," &
        " TrxHdr_Dutyhours=@TrxHdr_Dutyhours," &
        " TrxHdr_FlightHours=@TrxHdr_FlightHours," &
        " TrxHdr_Commission=@TrxHdr_Commission," &
        " TrxHdr_PBAmount=@TrxHdr_PBAmount," &
        " TrxHdr_PBRate=@TrxHdr_PBRate," &
        " TrxHdr_Overlay=@TrxHdr_Overlay," &
        " TrxHdr_PeriodSplit=@TrxHdr_PeriodSplit, " &
        " TrxHdr_PeriodSplitSI=@TrxHdr_PeriodSplitSI," &
        " TrxHdr_A1=@TrxHdr_A1, " &
        " TrxHdr_A2=@TrxHdr_A2, " &
        " TrxHdr_A3=@TrxHdr_A3, " &
        " TrxHdr_A4=@TrxHdr_A4, " &
        " TrxHdr_A5=@TrxHdr_A5, " &
        " TrxHdr_Union=@TrxHdr_Union, " &
        " TrxHdr_Position=@TrxHdr_Position, " &
        " TrxHdr_COLA=@TrxHdr_COLA," &
        " TrxHdr_MyRate=@TrxHdr_MyRate, " &
        " TrxHdr_FE=@TrxHdr_FE, " &
        " TrxHdr_NetYTD=@TrxHdr_NetYTD, " &
        " TrxHdr_PFOnAgreedSalary=@TrxHdr_PFOnAgreedSalary, " &
        " TrxHdr_BasisOnSalary=@TrxHdr_BasisOnSalary, " &
        " TrxHdr_GesiD=@TrxHdr_GesiD, " &
        " TrxHdr_GesiC=@TrxHdr_GesiC, " &
        " TrxHdr_Medical=@TrxHdr_Medical, " &
        " Com_Code=@Com_Code, " &
        " TrxHdr_Year=@TrxHdr_Year " &
        " WHERE TrxHdr_Id = @TrxHdr_Id" &
        " END " &
        " set  @NewId=SCOPE_IDENTITY()"

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If




        Return Proceed

    End Function
    Protected Function Upgrade_2019_2()

        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Ges_Code] [varchar](4) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        Str = "ALTER TABLE PrMsEmployees " &
     " ADD [Emp_PrevGesiD] [Decimal] (18,2) NULL, " &
     " [Emp_PrevGesiC] [Decimal] (18,2) NULL "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If


        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits int," &
        " @Emp_AnnualUnits int," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If



        Str = " CREATE TABLE [dbo].[PrSsGESI]( " &
        "	[Ges_Code] [varchar](4) NOT NULL, " &
        "	[Ges_Desc] [varchar](40) NOT NULL, " &
        "	[Ges_DedValue] [decimal](18, 2) NOT NULL, " &
        "	[Ges_ConValue] [decimal](18, 2) NOT NULL, " &
        " CONSTRAINT [PK_PrSsGESI] PRIMARY KEY CLUSTERED " &
        "( " &
        "	[Ges_Code] ASC " &
        " ) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] " &
        " ) ON [PRIMARY]"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New Table is added", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to add new table", MsgBoxStyle.Critical)
        End If


        Str = "create PROCEDURE [dbo].[PrSsGesi_SAVE_UPDATE] " &
        "@Ges_Code varchar(4), " &
        "@Ges_Desc varchar(40), " &
        "@Ges_DedValue decimal(18,2), " &
        "@Ges_ConValue decimal(18,2) " &
        "AS " &
        "  DECLARE @Result as Int " &
        "  Set @Result = 0 " &
        "  SELECT @Result = Count(*) " &
        "  FROM PrSsGesi " &
        "  WHERE Ges_Code = @Ges_Code " &
        "  IF(@Result IS NULL) OR (@Result=0) " &
        "    BEGIN " &
        "      INSERT INTO PrSsGesi " &
        "     (Ges_Code,  " &
        "      Ges_Desc, " &
        "      Ges_DedValue, " &
        "      Ges_ConValue  " &
        "      ) " &
        "      VALUES ( " &
        "      @Ges_Code, " &
        "      @Ges_Desc,   " &
        "      @Ges_DedValue,  " &
        "      @Ges_ConValue   " &
        "      ) " &
        "    END " &
        "  ELSE " &
        "    BEGIN " &
        "      UPDATE PrSsGesi " &
        "      SET  " &
        "      Ges_Code=@Ges_Code,  " &
        "     Ges_Desc=@Ges_Desc,  " &
        "     Ges_DedValue=@Ges_DedValue,  " &
        "     Ges_ConValue=@Ges_ConValue  " &
        "      WHERE Ges_Code = @Ges_Code " &
        "  END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PsSsGesi was updated ", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PsSsGesi ", MsgBoxStyle.Critical)
        End If


        Dim GESI As New cPrSsGesi("0000")
        If GESI.Code = "" Then
            With GESI
                .Code = "0000"
                .Desc = "GESI 0.00"
                .DedValue = 0.0
                .ConValue = 0.0
                If Not .Save Then
                    MsgBox("Unable to Create Value for GESI", MsgBoxStyle.Critical)
                End If
            End With
        End If

        Str = "Update PrMsEmployees set Ges_code='0000'," &
        " Emp_PrevGesiD=0, " &
        " Emp_PrevGesiC=0 "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Gesi on Employee is updated ", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update Gesi on Employee ", MsgBoxStyle.Critical)
        End If

        Str = "ALTER TABLE PrSsLimits " &
        " ADD [Lmt_GesiD] [Decimal](18,2) NULL, " &
        " [Lmt_GesiC] [Decimal](18,2) NULL"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Gesi on Limits is updated ", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update Gesi on Limits ", MsgBoxStyle.Critical)
        End If


        Str = "ALTER PROCEDURE [dbo].[AG_PrSsLimits_SAVE_UPDATE]" &
        " @Lmt_Id int," &
        " @Lmt_Cola decimal(10,2)," &
        " @Lmt_InsurableWk decimal(10,2)," &
        " @Lmt_InsurableMth decimal(10,2)," &
        " @Lmt_InsurableAnnual decimal(10,2)," &
        " @Lmt_DedContrAnnual decimal(10,2)," &
        " @Lmt_IndAnnual decimal(10,2)," &
        " @Lmt_EffectiveDate smalldatetime," &
        " @Lmt_UnemAnnual decimal(10,2)," &
        " @Lmt_GesiD decimal(18,2)," &
        " @Lmt_GesiC decimal(18,2)," &
        " @NewId Int OUTPUT" &
        " AS" &
        " DECLARE @Result as Int" &
        " Set @Result = 0" &
        " SELECT @Result = Count(*)" &
        " FROM PrSsLimits" &
        " WHERE Lmt_Id = @Lmt_Id" &
        " IF (@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrSsLimits" &
         " (Lmt_Cola, " &
         "   Lmt_InsurableWk," &
         "   Lmt_InsurableMth, " &
         "   Lmt_InsurableAnnual," &
         "   Lmt_DedContrAnnual," &
         "   Lmt_IndAnnual," &
         "   Lmt_EffectiveDate," &
         "   Lmt_UnemAnnual, " &
         " Lmt_GesiD ," &
         " Lmt_GesiC " &
         " )" &
         " VALUES (" &
         " @Lmt_Cola,     " &
         " @Lmt_InsurableWk," &
         " @Lmt_InsurableMth, " &
         " @Lmt_InsurableAnnual, " &
         " @Lmt_DedContrAnnual," &
         " @Lmt_IndAnnual,    " &
         " @Lmt_EffectiveDate,  " &
         " @Lmt_UnemAnnual,    " &
          " @Lmt_GesiD ," &
         " @Lmt_GesiC " &
         " )" &
         "   End" &
         "   Else" &
         "       BEGIN " &
         "       UPDATE PrSsLimits" &
         " SET " &
         " Lmt_Cola=@Lmt_Cola," &
         " Lmt_InsurableWk=@Lmt_InsurableWk," &
         " Lmt_InsurableMth=@Lmt_InsurableMth," &
         " Lmt_InsurableAnnual=@Lmt_InsurableAnnual," &
         " Lmt_DedContrAnnual=@Lmt_DedContrAnnual," &
         " Lmt_IndAnnual=@Lmt_IndAnnual," &
         " Lmt_EffectiveDate=@Lmt_EffectiveDate," &
         " Lmt_UnemAnnual=@Lmt_UnemAnnual," &
          " Lmt_GesiD = @Lmt_GesiD," &
         " Lmt_GesiC =Lmt_Gesic " &
         " WHERE Lmt_Id = @Lmt_Id" &
         "       End " &
        "set @NewId=SCOPE_IDENTITY()"



        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox(" Limits SP is updated ", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update Limits SP ", MsgBoxStyle.Critical)
        End If

        Str = "Update PrSsLimits " &
     " set Lmt_GesiD=3060, " &
     " Lmt_GesiC=3330 "
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Gesi on Limits is updated ", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update Gesi on Limits ", MsgBoxStyle.Critical)
        End If


        Return True
    End Function
    Protected Function Upgrade_2019_15()


        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_LWBPen] [varchar](1) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits int," &
        " @Emp_AnnualUnits int," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If






        Return True
    End Function
    Protected Function Upgrade_2019_18()


        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_GESYFromSplit] [Decimal](18,2) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        Str = "Update PrMsEmployees " &
        " set Emp_GESYFromSplit = 0 "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Value set to Zero", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set value to zero", MsgBoxStyle.Critical)
        End If



        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1), " &
        " @Emp_GESYFromSplit decimal(18,2) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen, " &
        " Emp_GESYFromSplit " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen, " &
        " @Emp_GESYFromSplit " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen, " &
        " Emp_GESYFromSplit= @Emp_GESYFromSplit " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If






        Return True
    End Function
    Protected Function Upgrade_2019_19()


        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_AnalGen1] varchar(20) NULL, " &
        " [Emp_NameDay] varchar(10) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        Str = "Update PrMsEmployees " &
        " set Emp_AnalGen1 = '' " &
        ", Emp_Nameday = '' "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Value set to Zero", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set value to zero", MsgBoxStyle.Critical)
        End If



        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1), " &
        " @Emp_GESYFromSplit decimal(18,2), " &
        " @Emp_AnalGen1 varchar(20), " &
        " @Emp_Nameday varchar(10) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen, " &
        " Emp_GESYFromSplit, " &
        " Emp_AnalGen1, " &
        " Emp_NameDay " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen, " &
        " @Emp_GESYFromSplit, " &
        " @Emp_AnalGen1," &
        " @Emp_Nameday " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen, " &
        " Emp_GESYFromSplit= @Emp_GESYFromSplit, " &
        " Emp_AnalGen1 = @Emp_AnalGen1," &
        " Emp_Nameday = @Emp_NameDay " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If






        Return True
    End Function
    Protected Function Upgrade_2019_16()


        Dim Str As String
        Dim i As Integer


        Str = " CREATE TABLE [dbo].[PrRpIr7](" &
            " [Ir7_Id] [int] IDENTITY(1,1) NOT NULL," &
            " [Ir7_Type] [varchar](1) NOT NULL," &
            " [Ir7_Year] [varchar](50) NOT NULL," &
            " [Ir7_ComCode] [varchar](50) NOT NULL," &
            " [Ir7_EmpCode] [varchar](50) NOT NULL," &
            " [Ir7_TICNumber] [varchar](50) NOT NULL," &
            " [Ir7_ArithmosTaftopoiisis] [varchar](50) NOT NULL," &
            " [Ir7_OtherCountryTIC] [varchar](50) NOT NULL," &
            " [Ir7_SINumber] [varchar](50) NOT NULL," &
            " [Ir7_Surname] [varchar](50) NOT NULL," &
            " [Ir7_Name] [varchar](50) NOT NULL," &
            " [Ir7_Street] [varchar](50) NOT NULL," &
            " [Ir7_Village] [varchar](50) NOT NULL," &
            " [Ir7_PostCode] [varchar](50) NOT NULL," &
            " [Ir7_EmailAddress] [varchar](50) NOT NULL," &
            " [Ir7_EmployeeType] [varchar](50) NOT NULL," &
            " [Ir7_Gross] [decimal](18, 2) NULL," &
            " [Ir7_GrossOut] [decimal](18, 2) NULL," &
            " [Ir7_BIKWithSI] [decimal](18, 2) NULL," &
            " [Ir7_BIKWithoutSI] [decimal](18, 2) NULL," &
            " [Ir7_Total1234] [decimal](18, 2) NULL," &
            " [Ir7_SIFund] [decimal](18, 2) NULL," &
            " [Ir7_PensionFund] [decimal](18, 2) NULL," &
            " [Ir7_MedicalFund] [decimal](18, 2) NULL," &
            " [Ir7_Unions] [decimal](18, 2) NULL," &
            " [Ir7_LifeInsurance] [decimal](18, 2) NULL," &
            " [Ir7_NonTaxable] [decimal](18, 2) NULL," &
            " [Ir7_OtherDiscs] [decimal](18, 2) NULL," &
            " [Ir7_TotalDiscs] [decimal](18, 2) NULL," &
            " [Ir7_TaxableIncome] [decimal](18, 2) NULL," &
            " [Ir7_IncomeTAX] [decimal](18, 2) NULL," &
            " [Ir7_SyntaksiodotikaOfelimata] [decimal](18, 2) NULL," &
            " [Ir7_MeiosiApolavon] [decimal](18, 2) NULL," &
            " [Ir7_GESYtoSI] [decimal](18, 2) NULL," &
            " [Ir7_GESYtoBIKDed] [decimal](18, 2) NULL," &
            " [Ir7_GESYtoBIKCon] [decimal](18, 2) NULL," &
            " [Ir7_StartDate] [varchar](50) NOT NULL," &
            " [Ir7_TermDate] [varchar](50) NOT NULL," &
            " [Ir7_PensionNo] [varchar](50) NOT NULL," &
            " [Ir7_EmpType] [varchar](50) NOT NULL," &
            " CONSTRAINT [PK_PrRpIr7] PRIMARY KEY CLUSTERED " &
            " ( " &
            "	[Ir7_Id] ASC " &
            " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] " &
            " ) ON [PRIMARY] "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New Table Ir7 Created", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to Create New Ir7 Table", MsgBoxStyle.Critical)
        End If






        Return True
    End Function
    Protected Function Upgrade_2019_17()


        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE [PrMsEmployees] ALTER COLUMN [Emp_PeriodUnits] Decimal(18,2)"
        i = ExecuteNonQuery(Str)
        If i < 0 Then
            MsgBox("Fail to change Period Units Type", MsgBoxStyle.Critical)
        End If

        Str = "ALTER TABLE [PrMsEmployees] ALTER COLUMN [Emp_AnnualUnits] Decimal(18,2)"


        If i < 0 Then
            MsgBox("Fail to change Annual Units Type", MsgBoxStyle.Critical)
        End If

        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If






        Return True
    End Function
    Protected Function Upgrade_2018_6()

        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_TaxForSplit] [Decimal](18,2) NULL"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        Str = "update PrMsEmployees " &
               " set Emp_TaxForSplit=0"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("set All Values to ''", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set values to ''", MsgBoxStyle.Critical)
        End If

        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits int," &
        " @Emp_AnnualUnits int," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True
    End Function
    Protected Function Upgrade_2018_7()

        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrAnEmployeePositions " &
        " ADD [EmpPos_Units] [nvarchar](10) NULL"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrAnEmployeePositions", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrAnEmployeePositions", MsgBoxStyle.Critical)
        End If

        Str = "update PrAnEmployeePositions " &
               " set EmpPos_Units=''"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("set All Values to ''", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set values to ''", MsgBoxStyle.Critical)
        End If

        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[AG_PrAnEmployeePositions_SAVE_UPDATE]  " &
        " @EmpPos_Code varchar(12), " &
        " @EmpPos_DescriptionL nvarchar(40), " &
        " @EmpPos_DescriptionS nvarchar(15),  " &
        " @EmpPos_IsActive char(1), " &
        " @EmpPos_Units nvarchar(10) " &
        " AS   DECLARE @Result as Int   " &
        " Set @Result = 0   " &
        " SELECT @Result = Count(*)   " &
        " FROM PrAnEmployeePositions   " &
        " WHERE EmpPos_Code = @EmpPos_Code  " &
        " IF(@Result IS NULL) OR (@Result=0) " &
        " BEGIN   " &
        " INSERT INTO PrAnEmployeePositions  " &
        " (EmpPos_Code,            " &
        " EmpPos_DescriptionL,   " &
        " EmpPos_DescriptionS,    " &
        " EmpPos_IsActive,   " &
        " EmpPos_Units " &
        " )    " &
        " VALUES " &
        "  (       @EmpPos_Code,     " &
        " @EmpPos_DescriptionL,     " &
        " @EmpPos_DescriptionS,     " &
        " @EmpPos_IsActive,   " &
        " @EmpPos_Units " &
        " )     " &
        " END " &
        " ELSE  " &
        " BEGIN    " &
        " UPDATE PrAnEmployeePositions      " &
        " SET        EmpPos_Code=@EmpPos_Code,   " &
        " EmpPos_DescriptionL=@EmpPos_DescriptionL,  " &
        " EmpPos_DescriptionS=@EmpPos_DescriptionS,             " &
        " EmpPos_IsActive=@EmpPos_IsActive, " &
        " EmpPos_Units=@EmpPos_Units           " &
        " WHERE EmpPos_Code = @EmpPos_Code   " &
        " END "
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True
    End Function
    Protected Function Upgrade_2019_3()
        Dim Str As String
        Dim F As Boolean
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'IR63', 'ShowSep1', '0', 'showSep1', 'Y', 'T')"

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnCode1', '', 'SepErnCode1', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnDesc1', '', 'SepErnDesc1', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'IR63', 'ShowSep2', '0', 'showSep2', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnCode2', '', 'SepErnCode2', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnDesc2', '', 'SepErnDesc2', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'IR63', 'ShowSep3', '0', 'showSep3', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnCode3', '', 'SepErnCode3', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnDesc3', '', 'SepErnDesc3', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'IR63', 'ShowSep4', '0', 'showSep4', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnCode4', '', 'SepErnCode4', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnDesc4', '', 'SepErnDesc4', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'IR63', 'ShowSep5', '0', 'showSep5', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnCode5', '', 'SepErnCode5', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnDesc5', '', 'SepErnDesc5', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'IR63', 'ShowSep6', '0', 'showSep6', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnCode6', '', 'SepErnCode6', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnDesc6', '', 'SepErnDesc6', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'IR63', 'ShowSep7', '0', 'showSep7', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnCode7', '', 'SepErnCode7', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnDesc7', '', 'SepErnDesc7', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'IR63', 'ShowSep8', '0', 'showSep8', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnCode8', '', 'SepErnCode8', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnDesc8', '', 'SepErnDesc8', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'IR63', 'ShowSep9', '0', 'showSep9', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnCode9', '', 'SepErnCode9', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnDesc9', '', 'SepErnDesc9', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'IR63', 'ShowSep10', '0', 'showSep10', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnCode10', '', 'SepErnCode10', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
               " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
               "VALUES     ( 'IR63', 'SepErnDesc10', '', 'SepErnDesc10', 'Y', 'T')"

        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If
    End Function
    Protected Function Upgrade_2018_8()

        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_PrevMF] [Decimal](18,2) NULL, " &
        " [Emp_PrevPenF] [Decimal](18,2) NULL"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        Str = "update PrMsEmployees " &
               " set Emp_PrevMF=0,Emp_PrevPenF=0"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("set All Values to '0'", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set values to '0'", MsgBoxStyle.Critical)
        End If

        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits int," &
        " @Emp_AnnualUnits int," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True
    End Function
    Protected Function Upgrade_2018_9()

        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_50PerOff] [char](1) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        Str = "update PrMsEmployees " &
               " set Emp_50PerOff=0"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("set All Values to '0'", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set values to '0'", MsgBoxStyle.Critical)
        End If

        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits int," &
        " @Emp_AnnualUnits int," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True
    End Function
    Protected Function Upgrade_2018_10()

        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrSsEmployeeSplit " &
        " ADD [Spl_ActivePeriods] [int] NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrSsEmployeeSplit", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrSsEmployeeSplit", MsgBoxStyle.Critical)
        End If

        Str = "update PrSsEmployeeSplit " &
               " set Spl_ActivePeriods=Spl_NoOfPeriods"

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("set All Values to NoOfPeriods", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set values to NoOfPeriods", MsgBoxStyle.Critical)
        End If

        ' Alter SPs    


        Str = " ALTER PROCEDURE [dbo].[PrSsEmployeeSplit_SAVE_UPDATE]  " &
        " @Spl_id int,  @Emp_Code varchar(16),   " &
        " @Spl_Description varchar(40),   " &
        " @Spl_Value decimal(18,2),  " &
        " @Spl_Enabled varchar(1),  " &
        " @Spl_NoOfPeriods varchar(2),  " &
        " @Spl_IsPF varchar(1),   " &
        " @Spl_IsST varchar(1),  " &
        " @Spl_CreationDate smalldatetime,   " &
        " @Spl_CreatedBy int,   " &
        " @Spl_AmendDate smalldatetime,   " &
        " @Spl_AmendedBy int,   " &
        " @Spl_ActivePeriods int, " &
        " @NewId Int OUTPUT  AS    " &
        " DECLARE @Result as Int    " &
        " Set @Result = 0    " &
        " SELECT @Result = Count(*)  " &
        " FROM PrSsEmployeeSplit    " &
        " WHERE Spl_id = @Spl_id    " &
        " IF(@Result IS NULL) OR (@Result=0)   " &
        " BEGIN     " &
        " INSERT INTO PrSsEmployeeSplit    " &
        " (Emp_Code,    " &
        " Spl_Description,  " &
        " Spl_Value,  	  " &
        " Spl_Enabled,  " &
        " Spl_NoOfPeriods, 	  " &
        " Spl_IsPF,   " &
        " Spl_IsST,   " &
        " Spl_CreationDate,   " &
        " Spl_CreatedBy,    " &
        " Spl_AmendDate, 	  " &
        " Spl_AmendedBy, " &
        " Spl_ActivePeriods )    " &
        " VALUES (        " &
        " @Emp_Code,    " &
        " @Spl_Description,   " &
        " @Spl_Value,  	  " &
        " @Spl_Enabled,   " &
        " @Spl_NoOfPeriods,   " &
        " @Spl_IsPF,    " &
        " @Spl_IsST, 	  " &
        " @Spl_CreationDate, 	  " &
        " @Spl_CreatedBy,  	  " &
        " @Spl_AmendDate,    " &
        " @Spl_AmendedBy,      " &
        " @Spl_ActivePeriods )    " &
        " END   " &
        " ELSE    " &
        " BEGIN        " &
        " UPDATE PrSsEmployeeSplit     " &
        " SET        Emp_Code=@Emp_Code,    " &
        " Spl_Description=@Spl_Description,   " &
        " Spl_Value= @Spl_Value,  	  " &
        " Spl_Enabled=@Spl_Enabled,   " &
        " Spl_NoOfPeriods=@Spl_NoOfPeriods, 	   " &
        " Spl_IsPF=@Spl_IsPF, 	  " &
        " Spl_IsST= @Spl_IsST,    " &
        " Spl_CreationDate=@Spl_CreationDate,  " &
        " Spl_CreatedBy= @Spl_CreatedBy,  	  " &
        " Spl_AmendDate=@Spl_AmendDate,   " &
        " Spl_AmendedBy=@Spl_AmendedBy,      " &
        " Spl_ActivePeriods=@Spl_ActivePeriods " &
        " WHERE Spl_id = @Spl_id    " &
        " END set @NewId=SCOPE_IDENTITY()   "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrSsEmployeeSplit was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrSsEmployeeSplit", MsgBoxStyle.Critical)
        End If


        Return True
    End Function
    Protected Function Upgrade_2018_11()

        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrAnBanks " &
        " ADD [Bnk_SwiftCode] [nvarchar](15) NULL"


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrAnBansk", MsgBoxStyle.Information)
            Str = "update PrAnBanks " &
               " set Bnk_SwiftCode=''"
            i = ExecuteNonQuery(Str)
            If i >= 0 Then
                MsgBox("set All Values to ''", MsgBoxStyle.Information)
            Else
                MsgBox("Fail to set values to ''", MsgBoxStyle.Critical)
            End If
        Else
            MsgBox("Fail to add New columns in PrAnBanks", MsgBoxStyle.Critical)
        End If


        ' Alter SPs    


        Str = " ALTER PROCEDURE [dbo].[AG_PrAnBanks_SAVE_UPDATE] " &
        " @Bnk_Code varchar(12), " &
        " @Bnk_DescriptionL varchar(40), " &
        " @Bnk_DescriptionS varchar(15), " &
        " @Bnk_IsActive char(1), " &
        " @Bnk_TransferCode varchar(20), " &
        " @Bnk_SwiftCode varchar(15) " &
        " AS " &
        "  DECLARE @Result as Int " &
        "  Set @Result = 0 " &
        "  SELECT @Result = Count(*) " &
        "  FROM PrAnBanks " &
        "  WHERE Bnk_Code = @Bnk_Code " &
        "  IF(@Result IS NULL) OR (@Result=0) " &
        "    BEGIN " &
        "      INSERT INTO PrAnBanks " &
        "     (Bnk_Code,                                           " &
        "      Bnk_DescriptionL,                                   " &
        "      Bnk_DescriptionS,                                   " &
        "      Bnk_IsActive,                                       " &
        "      Bnk_TransferCode,                                   " &
        "      Bnk_SwiftCode                                       " &
        "      ) " &
        "      VALUES ( " &
        "      @Bnk_Code,                                          " &
        "      @Bnk_DescriptionL,                                  " &
        "      @Bnk_DescriptionS,                                  " &
        "      @Bnk_IsActive,                                      " &
        "      @Bnk_TransferCode,                                  " &
        "      @Bnk_SwiftCode                                      " &
        "      ) " &
        "    END " &
        "  ELSE " &
        "    BEGIN " &
        "      UPDATE PrAnBanks " &
        "      SET  " &
        "      Bnk_Code=@Bnk_Code,                                 " &
        "      Bnk_DescriptionL=@Bnk_DescriptionL,                 " &
        "      Bnk_DescriptionS=@Bnk_DescriptionS,                 " &
        "      Bnk_IsActive=@Bnk_IsActive,                         " &
        "      Bnk_TransferCode=@Bnk_TransferCode,                 " &
        "      Bnk_SwiftCode=@Bnk_SwiftCode                        " &
        "      WHERE Bnk_Code = @Bnk_Code " &
        "  END "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrAnBanks was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrAnBanks", MsgBoxStyle.Critical)
        End If


        Return True
    End Function

    Protected Function Upgrade_2018_12()
        Dim Str As String
        Str = " CREATE TABLE [dbo].[PrTxTimeSheets]( " &
"	[Tms_Id] [int] IDENTITY(1,1) NOT NULL, " &
"	[Emp_Code] [varchar](16) NOT NULL, " &
"	[TemGrp_Code] [varchar](6) NOT NULL, " &
"	[PrdGrp_Code] [varchar](6) NOT NULL, " &
"	[PrdCod_Code] [varchar](6) NOT NULL, " &
"	[Tms_Date] [date] NOT NULL, " &
"	[Tms_In1] [varchar](8) NOT NULL, " &
"	[Tms_Out1] [varchar](8) NOT NULL, " &
"	[Tms_In2] [varchar](8) NOT NULL, " &
"	[Tms_Out2] [varchar](8) NOT NULL, " &
"	[Tms_In3] [varchar](8) NOT NULL, " &
"	[Tms_Out3] [varchar](8) NOT NULL, " &
"	[Tms_TotalWorkPerDay] [varchar](8) NOT NULL, " &
"	[Tms_TotalWorkPerWeek] [varchar](10) NOT NULL, " &
"	[Tms_TotalWorkPerMonth] [varchar](10) NOT NULL, " &
"	[Tms_ALHours] [decimal](18, 2) NOT NULL, " &
"	[Tms_SickHours] [decimal](18, 2) NOT NULL, " &
"	[Tms_ArmyHours] [decimal](18, 2) NOT NULL, " &
"	[Tms_MaterHours] [decimal](18, 2) NOT NULL, " &
"	[Tms_NormalDayHours] [varchar](8) NOT NULL, " &
"	[Tms_DayDiff] [varchar](8) NOT NULL, " &
"	[Tms_MonthDiff] [varchar](10) NOT NULL, " &
"	[Tms_TotalMonthNormal] [varchar](10) NOT NULL, " &
"	[Tms_FromFile] [int] NOT NULL " &
" ) ON [PRIMARY]"


        Dim i As Integer
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Timesheets table is added", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to add timesheets table", MsgBoxStyle.Critical)
        End If

        Str = " Create PROCEDURE [dbo].[PrTxTimesheets_SAVE_UPDATE] " &
            " @Id Int, " &
            " @EmpCode varchar(16), " &
            " @TemGroup varchar(6), " &
            " @PeriodGroup varchar(6), " &
            " @PeriodCode varchar(6), " &
            " @TransDate smalldatetime, " &
            " @In1  varchar(8), " &
            " @Out1  varchar(8), " &
            " @In2  varchar(8), " &
            " @Out2  varchar(8), " &
            " @In3  varchar(8), " &
            " @Out3  varchar(8), " &
            " @TotalWorkPerDay  varchar(8), " &
            " @TotalWorkPerWeek  varchar(10), " &
            " @TotalWorkPerMonth  varchar(10), " &
            " @ALHours decimal(18,2), " &
            " @SickHours decimal(18,2), " &
            " @ArmyHours  decimal(18,2), " &
            " @MaterHours  decimal(18,2), " &
            " @NormaldayHours  varchar(8), " &
            " @DayDiff  varchar(8), " &
            " @MonthDiff  varchar(10), " &
            " @TotalMonthNormal  varchar(10), " &
            " @FromFile  int, " &
            " @NewID int OUTPUT " &
            " " &
            " AS " &
            "  DECLARE @Result as Int " &
            "  Set @Result = 0 " &
            "  SELECT @Result = Count(*) " &
            "  FROM PrTxTimesheets " &
            "  WHERE Tms_id = @id " &
            "   " &
            "  IF(@Result IS NULL) OR (@Result=0) " &
            "    BEGIN " &
            "      Insert Into PrTxTimeSheets (  " &
            "                     Emp_Code,   " &
            "                     TemGrp_Code,   " &
            "                     PrdGrp_Code,   " &
            "                     PrdCod_Code,   " &
            "                     Tms_Date,   " &
            "                     Tms_In1,   " &
            "                     Tms_Out1,   " &
            "                     Tms_In2,   " &
            "                     Tms_Out2,    " &
            "                     Tms_In3,   " &
             "                    Tms_Out3,    " &
             "                    Tms_TotalWorkPerDay,    " &
             "                    Tms_TotalWorkPerWeek,   " &
             "                    Tms_TotalWorkPerMonth,   " &
             "                    Tms_ALHours,   " &
             "                    Tms_SickHours,   " &
             "                    Tms_ArmyHours,   " &
             "                    Tms_MaterHours,   " &
            "                     Tms_NormalDayHours,   " &
            "	                  Tms_DayDiff,   " &
            "	                  Tms_MonthDiff,   " &
            "	                  Tms_TotalMonthNormal,   " &
            "	                  Tms_FromFile    " &
             "                    )  " &
             "                    Values ( @EmpCode,  " &
             "                   @TemGroup,  " &
             "                   @PeriodGroup ,  " &
             "                   @PeriodCode ,  " &
             "                   @TransDate ,  " &
             "                   @In1  ,  " &
             "                   @Out1 ,  " &
             "                   @In2 ,  " &
             "                   @Out2 ,  " &
             "                   @In3 ,  " &
             "                   @Out3 ,  " &
             "                   @TotalWorkPerDay ,  " &
             "                   @TotalWorkPerWeek ,  " &
            "                    @TotalWorkPerMonth ,  " &
            "                    @ALHours ,  " &
            "                    @SickHours ,  " &
            "                    @ArmyHours ,  " &
            "                    @MaterHours,  " &
            "                    @NormalDayHours, " &
            "	                 @DayDiff,   " &
            "	                 @MonthDiff,   " &
            "	                 @TotalMonthNormal,   " &
            "	                 @FromFile    " &
            " ) " &
            "         END " &
            "  ELSE " &
            "    BEGIN " &
            "       Update PrTxTimeSheets  " &
            "             set Emp_Code = @EmpCode, " &
            "             TemGrp_Code = @TemGroup, " &
            "             PrdGrp_Code = @PeriodGroup, " &
            "             PrdCod_Code = @PeriodCode, " &
            "             Tms_Date = @TransDate, " &
            "             Tms_In1 =  @In1, " &
            "             Tms_Out1 = @Out1, " &
            "             Tms_In2 =  @In2, " &
            "             Tms_Out2 = @Out2, " &
            "             Tms_In3 =  @In3, " &
            "             Tms_Out3 = @Out3, " &
            "             Tms_TotalWorkPerDay = @TotalWorkPerDay, " &
            "             Tms_TotalWorkPerWeek = @TotalWorkPerWeek, " &
            "             Tms_TotalWorkPerMonth = @TotalWorkPerMonth, " &
            "             Tms_ALHours = @ALHours, " &
            "             Tms_SickHours = @SickHours, " &
            "             Tms_ArmyHours = @ArmyHours,  " &
            "             Tms_MaterHours = @MaterHours,  " &
            "             Tms_NormalDayHours=@NormalDayHours,   " &
            "             Tms_DayDiff=@DayDiff,   " &
            "             Tms_MonthDiff=@MonthDiff,   " &
            "             Tms_TotalMonthNormal=@TotalMonthNormal,   " &
            "             Tms_FromFile=@FromFile    " &
            "             FROM PrTxTimeSheets  " &
            "             WHERE Tms_id = @Id " &
            "  END " &
            "  set  @NewId=SCOPE_IDENTITY() "



        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Timesheets SP is added", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to add timesheets SP", MsgBoxStyle.Critical)
        End If



        Return True
    End Function
    Protected Function Upgrade_2018_13()
        Dim Str As String
        Dim i As Integer

        Str = "ALTER TABLE PrMsPeriodCodes " &
      " ADD [PrdCod_PeriodUnits2] [decimal](8, 2) NULL"


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsPeriodCodes", MsgBoxStyle.Information)
            Str = "update PrMsPeriodCodes " &
               " set PrdCod_PeriodUnits2=PrdCod_PeriodUnits"
            i = ExecuteNonQuery(Str)
            If i >= 0 Then
                MsgBox("set All Values to PeriodUnits", MsgBoxStyle.Information)
            Else
                MsgBox("Fail to set values to PeriodUnits", MsgBoxStyle.Critical)
            End If
        Else
            MsgBox("Fail to add New columns in PeriodUnits", MsgBoxStyle.Critical)
        End If


        ' Alter SPs    
        Str = " ALTER PROCEDURE [dbo].[AG_PrMsPeriodCodes_SELECT_ALL] " &
            " AS " &
            " BEGIN " &
            " SELECT  " &
            " PrdCod_Code, " &
            " PrdGrp_Code, " &
            " PrdCod_Status, " &
            " PrdCod_Number, " &
            " PrdCod_DescriptionL, " &
            " PrdCod_DescriptionS, " &
            " PrdCod_Sequence, " &
            " SinPrd_Code, " &
            " PrdCod_DateFrom, " &
            " PrdCod_DateTo, " &
            " PrdCod_PeriodUnits, " &
            " PayCat_Code, " &
            " PrdCod_PeriodUnits2 " &
            " FROM PrMsPeriodCodes " &
            " END "



        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP1 is updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to update SP1", MsgBoxStyle.Critical)
        End If



        Str = " ALTER PROCEDURE [dbo].[AG_PrMsPeriodCodes_SAVE_UPDATE] " &
" @PrdCod_Code varchar(6), " &
" @PrdGrp_Code varchar(6), " &
" @PrdCod_Status char(1), " &
" @PrdCod_Number char(2), " &
" @PrdCod_DescriptionL varchar(40), " &
" @PrdCod_DescriptionS varchar(15), " &
" @PrdCod_Sequence tinyint, " &
" @SinPrd_Code tinyint, " &
" @PrdCod_DateFrom smalldatetime, " &
" @PrdCod_DateTo smalldatetime, " &
" @PrdCod_PeriodUnits decimal(8,2), " &
" @PayCat_Code varchar(4), " &
" @PrdCod_PeriodUnits2 decimal(8,2) " &
" AS " &
"  DECLARE @Result as Int " &
"  Set @Result = 0 " &
"  SELECT @Result = Count(*) " &
"  FROM PrMsPeriodCodes " &
"  WHERE PrdCod_Code = @PrdCod_Code " &
"  AND PrdGrp_Code = @PrdGrp_Code " &
"  IF(@Result IS NULL) OR (@Result=0) " &
"    BEGIN " &
"      INSERT INTO PrMsPeriodCodes " &
"     (PrdCod_Code,                      " &
"      PrdGrp_Code,                            " &
"      PrdCod_Status,                     " &
"      PrdCod_Number,                      " &
"      PrdCod_DescriptionL,                " &
"      PrdCod_DescriptionS,                 " &
"      PrdCod_Sequence,                    " &
"      SinPrd_Code,                        " &
"      PrdCod_DateFrom,                    " &
"      PrdCod_DateTo,                       " &
"      PrdCod_PeriodUnits,                     " &
"      PayCat_Code,                            " &
"      PrdCod_PeriodUnits2                    " &
"      )   " &
"      VALUES (   " &
"      @PrdCod_Code,                   " &
"      @PrdGrp_Code,                      " &
"      @PrdCod_Status,                    " &
"      @PrdCod_Number,                     " &
"      @PrdCod_DescriptionL,               " &
"      @PrdCod_DescriptionS,                 " &
"      @PrdCod_Sequence,                 " &
"      @SinPrd_Code,                      " &
"      @PrdCod_DateFrom,                    " &
"      @PrdCod_DateTo,                       " &
"      @PrdCod_PeriodUnits,                   " &
"      @PayCat_Code,             " &
"      @PrdCod_PeriodUnits2          " &
"      )   " &
"    END   " &
"  ELSE   " &
"    BEGIN   " &
"      UPDATE PrMsPeriodCodes   " &
"      SET    " &
"      PrdCod_Code=@PrdCod_Code,                               " &
"      PrdGrp_Code=@PrdGrp_Code,                               " &
"      PrdCod_Status=@PrdCod_Status,                          " &
"      PrdCod_Number=@PrdCod_Number,                          " &
"      PrdCod_DescriptionL=@PrdCod_DescriptionL,              " &
"      PrdCod_DescriptionS=@PrdCod_DescriptionS,              " &
"      PrdCod_Sequence=@PrdCod_Sequence,                      " &
"      SinPrd_Code=@SinPrd_Code,                              " &
"      PrdCod_DateFrom=@PrdCod_DateFrom,                      " &
"      PrdCod_DateTo=@PrdCod_DateTo,                          " &
"      PrdCod_PeriodUnits=@PrdCod_PeriodUnits,                " &
"      PayCat_Code=@PayCat_Code,   " &
"      PrdCod_PeriodUnits2=@PrdCod_PeriodUnits2        " &
"      WHERE PrdCod_Code = @PrdCod_Code   " &
"      AND PrdGrp_Code = @PrdGrp_Code   " &
"  END   "



        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP2 is updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to update SP2", MsgBoxStyle.Critical)
        End If





        Return True
    End Function
    Protected Function Upgrade_2018_14()
        Dim Str As String
        Str = " Alter TABLE [dbo].[PrTxTimeSheets] " &
        "	ADD [Tms_BusTrip] [decimal](18, 2) NULL, " &
        "	[Tms_FamDeath] [decimal](18, 2) NULL, " &
        "	[Tms_Study] [decimal](18, 2) NULL, " &
        "	[Tms_WFH] [decimal](18, 2) NULL "



        Dim i As Integer
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Timesheets table is modified", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to modify timesheets table", MsgBoxStyle.Critical)
        End If

        Str = " Alter PROCEDURE [dbo].[PrTxTimesheets_SAVE_UPDATE] " &
            " @Id Int, " &
            " @EmpCode varchar(16), " &
            " @TemGroup varchar(6), " &
            " @PeriodGroup varchar(6), " &
            " @PeriodCode varchar(6), " &
            " @TransDate smalldatetime, " &
            " @In1  varchar(8), " &
            " @Out1  varchar(8), " &
            " @In2  varchar(8), " &
            " @Out2  varchar(8), " &
            " @In3  varchar(8), " &
            " @Out3  varchar(8), " &
            " @TotalWorkPerDay  varchar(8), " &
            " @TotalWorkPerWeek  varchar(10), " &
            " @TotalWorkPerMonth  varchar(10), " &
            " @ALHours decimal(18,2), " &
            " @SickHours decimal(18,2), " &
            " @ArmyHours  decimal(18,2), " &
            " @MaterHours  decimal(18,2), " &
            " @NormaldayHours  varchar(8), " &
            " @DayDiff  varchar(8), " &
            " @MonthDiff  varchar(10), " &
            " @TotalMonthNormal  varchar(10), " &
            " @FromFile  int, " &
            " @BusTrip decimal(18, 2), " &
            " @FamDeath decimal(18, 2), " &
            " @Study decimal(18, 2), " &
            " @WFH decimal(18, 2), " &
            " @NewID int OUTPUT " &
            " " &
            " AS " &
            "  DECLARE @Result as Int " &
            "  Set @Result = 0 " &
            "  SELECT @Result = Count(*) " &
            "  FROM PrTxTimesheets " &
            "  WHERE Tms_id = @id " &
            "   " &
            "  IF(@Result IS NULL) OR (@Result=0) " &
            "    BEGIN " &
            "      Insert Into PrTxTimeSheets (  " &
            "                     Emp_Code,   " &
            "                     TemGrp_Code,   " &
            "                     PrdGrp_Code,   " &
            "                     PrdCod_Code,   " &
            "                     Tms_Date,   " &
            "                     Tms_In1,   " &
            "                     Tms_Out1,   " &
            "                     Tms_In2,   " &
            "                     Tms_Out2,    " &
            "                     Tms_In3,   " &
             "                    Tms_Out3,    " &
             "                    Tms_TotalWorkPerDay,    " &
             "                    Tms_TotalWorkPerWeek,   " &
             "                    Tms_TotalWorkPerMonth,   " &
             "                    Tms_ALHours,   " &
             "                    Tms_SickHours,   " &
             "                    Tms_ArmyHours,   " &
             "                    Tms_MaterHours,   " &
            "                     Tms_NormalDayHours,   " &
            "	                  Tms_DayDiff,   " &
            "	                  Tms_MonthDiff,   " &
            "	                  Tms_TotalMonthNormal,   " &
            "	                  Tms_FromFile,    " &
             "                    Tms_BusTrip, " &
            "                     Tms_FamDeath, " &
            "                     Tms_Study, " &
            "                     Tms_WFH  " &
             "                    )  " &
             "                    Values ( @EmpCode,  " &
             "                   @TemGroup,  " &
             "                   @PeriodGroup ,  " &
             "                   @PeriodCode ,  " &
             "                   @TransDate ,  " &
             "                   @In1  ,  " &
             "                   @Out1 ,  " &
             "                   @In2 ,  " &
             "                   @Out2 ,  " &
             "                   @In3 ,  " &
             "                   @Out3 ,  " &
             "                   @TotalWorkPerDay ,  " &
             "                   @TotalWorkPerWeek ,  " &
            "                    @TotalWorkPerMonth ,  " &
            "                    @ALHours ,  " &
            "                    @SickHours ,  " &
            "                    @ArmyHours ,  " &
            "                    @MaterHours,  " &
            "                    @NormalDayHours, " &
            "	                 @DayDiff,   " &
            "	                 @MonthDiff,   " &
            "	                 @TotalMonthNormal,   " &
            "	                 @FromFile,    " &
            "                    @BusTrip, " &
            "                    @FamDeath, " &
            "                    @Study, " &
            "                    @WFH  " &
            " ) " &
            "         END " &
            "  ELSE " &
            "    BEGIN " &
            "       Update PrTxTimeSheets  " &
            "             set Emp_Code = @EmpCode, " &
            "             TemGrp_Code = @TemGroup, " &
            "             PrdGrp_Code = @PeriodGroup, " &
            "             PrdCod_Code = @PeriodCode, " &
            "             Tms_Date = @TransDate, " &
            "             Tms_In1 =  @In1, " &
            "             Tms_Out1 = @Out1, " &
            "             Tms_In2 =  @In2, " &
            "             Tms_Out2 = @Out2, " &
            "             Tms_In3 =  @In3, " &
            "             Tms_Out3 = @Out3, " &
            "             Tms_TotalWorkPerDay = @TotalWorkPerDay, " &
            "             Tms_TotalWorkPerWeek = @TotalWorkPerWeek, " &
            "             Tms_TotalWorkPerMonth = @TotalWorkPerMonth, " &
            "             Tms_ALHours = @ALHours, " &
            "             Tms_SickHours = @SickHours, " &
            "             Tms_ArmyHours = @ArmyHours,  " &
            "             Tms_MaterHours = @MaterHours,  " &
            "             Tms_NormalDayHours=@NormalDayHours,   " &
            "             Tms_DayDiff=@DayDiff,   " &
            "             Tms_MonthDiff=@MonthDiff,   " &
            "             Tms_TotalMonthNormal=@TotalMonthNormal,   " &
            "             Tms_FromFile=@FromFile,    " &
            "             Tms_BusTrip=@BusTrip, " &
            "             Tms_FamDeath=@FamDeath, " &
            "             Tms_Study=@Study, " &
            "             Tms_WFH=@WFH  " &
            "             FROM PrTxTimeSheets  " &
            "             WHERE Tms_id = @Id " &
            "  END " &
            "  set  @NewId=SCOPE_IDENTITY() "



        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Timesheets SP is added", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to add timesheets SP", MsgBoxStyle.Critical)
        End If



        Return True
    End Function
    Protected Function Upgrade_2018_15()
        Dim Str As String
        Str = " Alter TABLE [dbo].[PrTxTimeSheets] " &
        "	ADD [Tms_TotalMAL] [varchar](10) NULL, " &
        "	[Tms_TotalMSic] [varchar](10) NULL, " &
        "	[Tms_TotalMArmy] [varchar](10) NULL, " &
        "	[Tms_TotalMMat] [varchar](10) NULL "



        Dim i As Integer
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Timesheets table is modified", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to modify timesheets table", MsgBoxStyle.Critical)
        End If

        Str = " Alter PROCEDURE [dbo].[PrTxTimesheets_SAVE_UPDATE] " &
            " @Id Int, " &
            " @EmpCode varchar(16), " &
            " @TemGroup varchar(6), " &
            " @PeriodGroup varchar(6), " &
            " @PeriodCode varchar(6), " &
            " @TransDate smalldatetime, " &
            " @In1  varchar(8), " &
            " @Out1  varchar(8), " &
            " @In2  varchar(8), " &
            " @Out2  varchar(8), " &
            " @In3  varchar(8), " &
            " @Out3  varchar(8), " &
            " @TotalWorkPerDay  varchar(8), " &
            " @TotalWorkPerWeek  varchar(10), " &
            " @TotalWorkPerMonth  varchar(10), " &
            " @ALHours decimal(18,2), " &
            " @SickHours decimal(18,2), " &
            " @ArmyHours  decimal(18,2), " &
            " @MaterHours  decimal(18,2), " &
            " @NormaldayHours  varchar(8), " &
            " @DayDiff  varchar(8), " &
            " @MonthDiff  varchar(10), " &
            " @TotalMonthNormal  varchar(10), " &
            " @FromFile  int, " &
            " @BusTrip decimal(18, 2), " &
            " @FamDeath decimal(18, 2), " &
            " @Study decimal(18, 2), " &
            " @WFH decimal(18, 2), " &
            " @TotalMAL varchar(10), " &
            " @TotalMSic varchar(10), " &
            " @TotalMArmy varchar(10), " &
            " @TotalMMat varchar(10), " &
            " @NewID int OUTPUT " &
            " " &
            " AS " &
            "  DECLARE @Result as Int " &
            "  Set @Result = 0 " &
            "  SELECT @Result = Count(*) " &
            "  FROM PrTxTimesheets " &
            "  WHERE Tms_id = @id " &
            "   " &
            "  IF(@Result IS NULL) OR (@Result=0) " &
            "    BEGIN " &
            "      Insert Into PrTxTimeSheets (  " &
            "                     Emp_Code,   " &
            "                     TemGrp_Code,   " &
            "                     PrdGrp_Code,   " &
            "                     PrdCod_Code,   " &
            "                     Tms_Date,   " &
            "                     Tms_In1,   " &
            "                     Tms_Out1,   " &
            "                     Tms_In2,   " &
            "                     Tms_Out2,    " &
            "                     Tms_In3,   " &
             "                    Tms_Out3,    " &
             "                    Tms_TotalWorkPerDay,    " &
             "                    Tms_TotalWorkPerWeek,   " &
             "                    Tms_TotalWorkPerMonth,   " &
             "                    Tms_ALHours,   " &
             "                    Tms_SickHours,   " &
             "                    Tms_ArmyHours,   " &
             "                    Tms_MaterHours,   " &
            "                     Tms_NormalDayHours,   " &
            "	                  Tms_DayDiff,   " &
            "	                  Tms_MonthDiff,   " &
            "	                  Tms_TotalMonthNormal,   " &
            "	                  Tms_FromFile,    " &
             "                    Tms_BusTrip, " &
            "                     Tms_FamDeath, " &
            "                     Tms_Study, " &
            "                     Tms_WFH,  " &
             "                    Tms_TotalMAL,  " &
            "                     Tms_TotalMSic, " &
            "                     Tms_TotalMArmy, " &
            "                     Tms_TotalMMat  " &
             "                    )  " &
             "                    Values ( @EmpCode,  " &
             "                   @TemGroup,  " &
             "                   @PeriodGroup ,  " &
             "                   @PeriodCode ,  " &
             "                   @TransDate ,  " &
             "                   @In1  ,  " &
             "                   @Out1 ,  " &
             "                   @In2 ,  " &
             "                   @Out2 ,  " &
             "                   @In3 ,  " &
             "                   @Out3 ,  " &
             "                   @TotalWorkPerDay ,  " &
             "                   @TotalWorkPerWeek ,  " &
            "                    @TotalWorkPerMonth ,  " &
            "                    @ALHours ,  " &
            "                    @SickHours ,  " &
            "                    @ArmyHours ,  " &
            "                    @MaterHours,  " &
            "                    @NormalDayHours, " &
            "	                 @DayDiff,   " &
            "	                 @MonthDiff,   " &
            "	                 @TotalMonthNormal,   " &
            "	                 @FromFile,    " &
            "                    @BusTrip, " &
            "                    @FamDeath, " &
            "                    @Study, " &
            "                    @WFH,  " &
            "                    @TotalMAL,  " &
            "                    @TotalMSic, " &
            "                    @TotalMArmy, " &
            "                    @TotalMMat  " &
            " ) " &
            "         END " &
            "  ELSE " &
            "    BEGIN " &
            "       Update PrTxTimeSheets  " &
            "             set Emp_Code = @EmpCode, " &
            "             TemGrp_Code = @TemGroup, " &
            "             PrdGrp_Code = @PeriodGroup, " &
            "             PrdCod_Code = @PeriodCode, " &
            "             Tms_Date = @TransDate, " &
            "             Tms_In1 =  @In1, " &
            "             Tms_Out1 = @Out1, " &
            "             Tms_In2 =  @In2, " &
            "             Tms_Out2 = @Out2, " &
            "             Tms_In3 =  @In3, " &
            "             Tms_Out3 = @Out3, " &
            "             Tms_TotalWorkPerDay = @TotalWorkPerDay, " &
            "             Tms_TotalWorkPerWeek = @TotalWorkPerWeek, " &
            "             Tms_TotalWorkPerMonth = @TotalWorkPerMonth, " &
            "             Tms_ALHours = @ALHours, " &
            "             Tms_SickHours = @SickHours, " &
            "             Tms_ArmyHours = @ArmyHours,  " &
            "             Tms_MaterHours = @MaterHours,  " &
            "             Tms_NormalDayHours=@NormalDayHours,   " &
            "             Tms_DayDiff=@DayDiff,   " &
            "             Tms_MonthDiff=@MonthDiff,   " &
            "             Tms_TotalMonthNormal=@TotalMonthNormal,   " &
            "             Tms_FromFile=@FromFile,    " &
            "             Tms_BusTrip=@BusTrip, " &
            "             Tms_FamDeath=@FamDeath, " &
            "             Tms_Study=@Study, " &
            "             Tms_WFH=@WFH,  " &
            "             Tms_TotalMAL=@TotalMAL,  " &
            "             Tms_TotalMSic=@TotalMSic, " &
            "             Tms_TotalMArmy=@TotalMArmy, " &
            "             Tms_TotalMMat=@TotalMMat  " &
            "             FROM PrTxTimeSheets  " &
            "             WHERE Tms_id = @Id " &
            "  END " &
            "  set  @NewId=SCOPE_IDENTITY() "



        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Timesheets SP is added", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to add timesheets SP", MsgBoxStyle.Critical)
        End If



        Return True
    End Function
    Protected Function TrytoCreateDataBaseUser(ByVal DBUser As String, ByVal DBPass As String) As Boolean
        Dim str As String
        Dim F As Boolean = True

        str = "IF NOT EXISTS (SELECT * FROM sys.server_principals WHERE name = N'" & DBUser & "') CREATE LOGIN [" & DBUser & "] WITH PASSWORD=N'" & DBPass & "', DEFAULT_LANGUAGE=[us_english], CHECK_EXPIRATION=OFF, CHECK_POLICY=OFF"

        If MyBase.ExecuteNonQuery(str) >= 0 Then
            MsgBox("User is Created in SQL", MsgBoxStyle.Information)

            str = "USE [" & Global1.DbaseName & "]" & vbCrLf & "exec sp_adduser '" & DBUser & "' , '" & DBUser & "' , 'db_owner'"
            If MyBase.ExecuteNonQuery(str) >= 0 Then
                MsgBox("User is Added to Database successfully", MsgBoxStyle.Information)
            Else
                F = False
                MsgBox("Unable to Add User in  Database", MsgBoxStyle.Information)
            End If

        Else
            F = False
            MsgBox("Unable to Create User in  SQL", MsgBoxStyle.Information)
        End If
        Return F


    End Function
    Protected Function TrytoAddDataBaseUser(ByVal DBUser As String) As Boolean
        Dim str As String
        Dim F As Boolean = True


        str = "USE [" & Global1.DbaseName & "]" & vbCrLf & "exec sp_adduser '" & DBUser & "' , '" & DBUser & "' , 'db_owner'"
        If MyBase.ExecuteNonQuery(str) > 0 Then
            MsgBox("User is Added to Database successfully", MsgBoxStyle.Information)
        Else
            F = False
            MsgBox("Unable to Add User in  Database", MsgBoxStyle.Information)
        End If


        Return F


    End Function
    Protected Function GetAllPrSsGESI() As DataSet
        Dim Str As String
        Str = " SELECT " &
            " Ges_Code," &
            " Ges_Desc," &
            " Ges_DedValue," &
            " Ges_ConValue" &
            " FROM PrSsGesi"
        Return GetData(Str)
    End Function
    Protected Function GetEarningsForExcelTemplate(ByVal TemGrp_Code As String) As DataSet
        Dim Str As String
        Str = "select TemGrp_Code, " &
            " '' as Interface_Code," &
            " ErnCod_Code," &
            " TemErn_DisplayName," &
            " '' as DebitAccount," &
            " '' as CreditAccount," &
            " '' as Prefix" &
            " from PrMsTemplateEarnings" &
            " where TemGrp_Code =" & enQuoteString(TemGrp_Code)

        Return MyBase.GetData(Str)

    End Function
    Protected Function GetDeductionsForExcelTemplate(ByVal TemGrp_Code As String) As DataSet
        Dim Str As String
        Str = "select TemGrp_Code, " &
            " '' as Interface_Code," &
            " DedCod_Code," &
            " TemDEd_DisplayName," &
            " '' as DebitAccount," &
            " '' as CreditAccount," &
            " '' as Prefix" &
            " from PrMsTemplateDeductions" &
            " where TemGrp_Code =" & enQuoteString(TemGrp_Code)

        Return MyBase.GetData(Str)

    End Function
    Protected Function GetContributionsForExcelTemplate(ByVal TemGrp_Code As String) As DataSet
        Dim Str As String
        Str = "select TemGrp_Code, " &
            " '' as Interface_Code," &
            " ConCod_Code," &
            " TemCon_DisplayName," &
            " '' as DebitAccount," &
            " '' as CreditAccount," &
            " '' as Prefix" &
            " from PrMsTemplateContributions" &
            " where TemGrp_Code =" & enQuoteString(TemGrp_Code)

        Return MyBase.GetData(Str)

    End Function
    Protected Function ReplaceEarningsFromLines(ByVal EDCFrom As cPrMsEarningCodes, ByVal EDCTo As cPrMsEarningCodes, ByVal PerGrp As cPrMsPeriodGroups, ByVal TemGroup As cPrMsTemplateGroup) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = " update PrTxTrxnLines " &
            " set ErnCod_Code =" & enQuoteString(EDCTo.Code) & "," &
            " TrxLin_EDCDescription= " & enQuoteString(EDCTo.DescriptionL) &
            " where ErnCod_Code = " & enQuoteString(EDCFrom.Code) &
            " and trxhdr_id in  " &
            " (Select trxhdr_id from prtxtrxnheader where prdgrp_code= " & enQuoteString(PerGrp.Code) &
            " and temgrp_Code= " & enQuoteString(TemGroup.Code) & ")"
        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        End If
        Return F

    End Function
    Protected Function ReplaceDeductionsFromLines(ByVal EDCFrom As cPrMsDeductionCodes, ByVal EDCTo As cPrMsDeductionCodes, ByVal PerGrp As cPrMsPeriodGroups, ByVal TemGroup As cPrMsTemplateGroup) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = " update PrTxTrxnLines " &
            " set DedCod_Code =" & enQuoteString(EDCTo.Code) & "," &
            " TrxLin_EDCDescription= " & enQuoteString(EDCTo.DescriptionL) &
            " where DedCod_Code = " & enQuoteString(EDCFrom.Code) &
            " and trxhdr_id in  " &
            " (Select trxhdr_id from prtxtrxnheader where prdgrp_code= " & enQuoteString(PerGrp.Code) &
            " and temgrp_Code= " & enQuoteString(TemGroup.Code) & ")"
        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        End If
        Return F
    End Function
    Protected Function ReplaceContributionsFromLines(ByVal EDCFrom As cPrMsContributionCodes, ByVal EDCTo As cPrMsContributionCodes, ByVal PerGrp As cPrMsPeriodGroups, ByVal TemGroup As cPrMsTemplateGroup) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = " update PrTxTrxnLines " &
            " set ConCod_Code =" & enQuoteString(EDCTo.Code) & "," &
            " TrxLin_EDCDescription= " & enQuoteString(EDCTo.DescriptionL) &
            " where ConCod_Code = " & enQuoteString(EDCFrom.Code) &
            " and trxhdr_id in  " &
            " (Select trxhdr_id from prtxtrxnheader where prdgrp_code= " & enQuoteString(PerGrp.Code) &
            " and temgrp_Code= " & enQuoteString(TemGroup.Code) & ")"
        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        End If
        Return F
    End Function

    Public Function ReplaceIBANno(ByVal Oldiban As String, ByVal Newiban As String) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = " update PrMsEmployees " &
            " set Emp_BankAccountCo = " & enQuoteString(Newiban) &
            " where Emp_BankAccountCo = " & enQuoteString(Oldiban)

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        End If
        Return F

    End Function
    Public Function ReplaceCompanyBankCode(ByVal OldBank As String, ByVal NewBank As String, ByVal TempGrpCode As String) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = " update PrMsEmployees " &
            " set Bnk_CodeCo = " & enQuoteString(NewBank) &
            " where Bnk_CodeCo = " & enQuoteString(OldBank) &
            " And TemGrp_Code = " & enQuoteString(TempGrpCode)

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        End If
        Return F

    End Function
    Public Shadows Function ChangeCompanyBankCodeAndIBAN(ByVal EmpBank As String, ByVal ComBank As String, ByVal IBAN As String, ByVal TemGrpCode As String) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = " update PrMsEmployees " &
            " set Bnk_CodeCo = " & enQuoteString(ComBank) &
            ", emp_BankAccountCo=" & enQuoteString(IBAN) &
            " where Bnk_Code = " & enQuoteString(EmpBank) &
            " And TemGrp_Code = " & enQuoteString(TemGrpCode)


        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        End If
        Return F
    End Function
    Public Shadows Function ReplacePayslipReport(ByVal OldPayslip As String, ByVal NewPayslip As String) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = " update PrMsEmployees " &
            " set Emp_MyPayslipREPort = " & enQuoteString(NewPayslip) &
            " where Emp_MyPayslipREPort = " & enQuoteString(OldPayslip)

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        End If
        Return F

    End Function

    Protected Function CreateNodalInterfaceParameters()
        Dim Str As String
        Dim F As Boolean

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Nodal', 'FTP', '1', 'FTP to Nodal', 'Y', 'T')"

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Nodal', 'RemHost', '', 'Remote Host IP', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If



        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Nodal', 'RemPath', '/Text', 'Remote Path', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If




        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Nodal', 'user', 'root', 'User', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If




        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Nodal', 'pwd', 'root', 'Password', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i > 0 Then
            F = True
        Else
            F = False
        End If




        Return F
    End Function
    Protected Function ReplaceEmployeeEDCValue(ByVal TemGroupCode, ByVal EDCType, ByVal EDCCode, ByVal OldValue, ByVal NewValue) As Integer
        Dim Str As String
        Select Case EDCType
            Case "E"
                Str = "update PrMsEmployeeEarnings set EmpErn_Value =" & NewValue &
                        "where EmpErn_Value =" & OldValue &
                        "and ErnCod_Code =" & enQuoteString(EDCCode) &
                        "and TemGrp_Code =" & enQuoteString(TemGroupCode)
            Case "D"
                Str = "update PrMsEmployeeDeductions set EmpDed_Value =" & NewValue &
                        "where EmpDed_Value =" & OldValue &
                        "and DedCod_Code =" & enQuoteString(EDCCode) &
                        "and TemGrp_Code =" & enQuoteString(TemGroupCode)

            Case "C"
                Str = "update PrMsEmployeeContributions set EmpCon_Value =" & NewValue &
                        "where EmpCon_Value =" & OldValue &
                        "and ConCod_Code =" & enQuoteString(EDCCode) &
                        "and TemGrp_Code =" & enQuoteString(TemGroupCode)

        End Select

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)

        Return i

    End Function
    Protected Function ExecuteWithResults(ByVal Str As String) As DataSet
        Return MyBase.GetData(Str)
    End Function
    Protected Function ExecuteWithOUTResults(ByVal Str As String) As Integer
        Return MyBase.ExecuteNonQuery(Str)
    End Function
    Protected Function GetDepartment1CodeFromDesc(ByVal Desc As String) As String
        Dim Str As String
        Dim Code As String = ""
        Dim Ds As DataSet
        Str = "select empan1_code from PrAnEmployeeAnalysis1 where EmpAn1_DescriptionL = " & enQuoteString(Desc)
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Code = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Code

    End Function
    Protected Function GetDepartment2CodeFromDesc(ByVal Desc As String) As String
        Dim Str As String
        Dim Code As String = ""
        Dim Ds As DataSet
        Str = "select empan2_code from PrAnEmployeeAnalysis2 where EmpAn2_DescriptionL = " & enQuoteString(Desc)
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Code = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Code

    End Function
    Protected Function GetDepartment3CodeFromDesc(ByVal Desc As String) As String
        Dim Str As String
        Dim Code As String = ""
        Dim Ds As DataSet
        Str = "select empan3_code from PrAnEmployeeAnalysis3 where EmpAn3_DescriptionL = " & enQuoteString(Desc)
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Code = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Code

    End Function
    Protected Function GetDepartment4CodeFromDesc(ByVal Desc As String) As String
        Dim Str As String
        Dim Code As String = ""
        Dim Ds As DataSet
        Str = "select empan4_code from PrAnEmployeeAnalysis4 where EmpAn4_DescriptionL = " & enQuoteString(Desc)
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Code = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Code

    End Function
    Protected Function GetDepartment5CodeFromDesc(ByVal Desc As String) As String
        Dim Str As String
        Dim Code As String = ""
        Dim Ds As DataSet
        Str = "select empan5_code from PrAnEmployeeAnalysis5 where EmpAn5_DescriptionL = " & enQuoteString(Desc)
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Code = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Code

    End Function
    Protected Function GetPositionCodeFromDesc(ByVal Desc As String) As String
        Dim Str As String
        Dim Code As String = ""
        Dim Ds As DataSet
        Str = "select EmpPos_Code from PrAnEmployeepositions where EmpPos_DescriptionL = " & enQuoteString(Desc)
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Code = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Code

    End Function
    Protected Function GetLastEmployeeCode(ByVal TempCode As String) As String
        Dim Str As String
        Dim Code As String = 0
        Dim Ds As DataSet
        Str = "Select max(Emp_Code) From PrmsEmployees where TemGrp_Code = " & enQuoteString(TempCode)
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Code = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return Code

    End Function
    Protected Function GetLastEmployeePositionCode() As String
        Dim Str As String
        Dim Code As String = 0
        Dim CodeLen As Integer
        Dim CodeInt As Integer
        Dim Ds As DataSet
        ''Str = "select max(EmpPos_Code) from PrAnEmployeePositions "
        Str = "select MAX(CAST(emppos_code as int)) from PrAnEmployeePositions"
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Code = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        Else
            Code = "000"
        End If
        CodeLen = Code.Length
        Try
            CodeInt = CInt(Code)
            CodeInt = CodeInt + 1
            Code = CodeInt.ToString.PadLeft(CodeLen, "0")
        Catch ex As Exception

        End Try


        Return Code
    End Function
    Protected Function Upgrade_2019_20() As Boolean
        Dim Str As String
        Dim i As Integer
        Str = " ALTER TABLE PrTxtrxnheader " &
        " ADD [TrxHdr_AnalGen1] varchar(20) "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("1 New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If

        Str = " Update PrTxtrxnheader " &
       " set TrxHdr_AnalGen1 = '' "

        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE]" &
               " @TrxHdr_Id int," &
               " @Emp_Code varchar(16)," &
               " @PrdGrp_Code varchar(6)," &
               " @PrdCod_Code varchar(6)," &
               " @PayCat_Code varchar(4)," &
               " @TrxHdr_Date datetime," &
               " @TrxHdr_Status varchar(4)," &
               " @TrxHdr_TotalErnPeriod decimal(18,2)," &
               " @TrxHdr_TotalErnYTD decimal(18,2)," &
               " @TrxHdr_TotalDedPeriod decimal(18,2)," &
               " @TrxHdr_TotalDedYTD decimal(18,2)," &
               " @TrxHdr_TotalConPeriod decimal(18,2)," &
               " @TrxHdr_TotalConYTD decimal(18,2)," &
               " @TrxHdr_SIIncome decimal(18,2)," &
               " @TrxHdr_TaxableIncome decimal(18,2)," &
               " @TrxHdr_PaymentMethod varchar(50)," &
               " @TrxHdr_PaymentRef varchar(50)," &
               " @TrxHdr_PeriodUnits decimal(18,2)," &
               " @TrxHdr_AnnualUnits decimal(18,2)," &
               " @TrxHdr_AnnualLeave decimal(18,2)," &
               " @TrxHdr_LifeInsurance decimal(18,2)," &
               " @TrxHdr_Discounts decimal(18,2)," &
               " @TrxHdr_Interfacestatus varchar(4)," &
               " @TrxHdr_Overtime1 decimal(10,2)," &
               " @TrxHdr_Overtime2 decimal(10,2)," &
               " @TrxHdr_SIUnits decimal(10,2)," &
               " @TrxHdr_MonthlySalary decimal(18,2)," &
               " @TrxHdr_NetSalary decimal(18,2)," &
               " @TrxHdr_PeriodInsurable decimal(18,2)," &
               " @TemGrp_Code varchar(6)," &
               " @TrxHdr_ChequeNo varchar(50)," &
               " @TrxHdr_TaxableFromOther Decimal(18,2)," &
               " @TrxHdr_CurrencySymbol varchar(3)," &
               " @TrxHdr_Rate Decimal(18,10)," &
               " @TrxHdr_NormalDays Decimal(18,2)," &
               " @TrxHdr_Salary1 Decimal(18,2)," &
               " @TrxHdr_Salary2 Decimal(18,2)," &
               " @TrxHdr_Overtime3 decimal(10,2)," &
               " @TrxHdr_Sectors decimal(18,2)," &
               " @TrxHdr_Dutyhours decimal(18,2)," &
               " @TrxHdr_FlightHours decimal(18,2)," &
               " @TrxHdr_Commission decimal(18,2)," &
               " @TrxHdr_PBAmount decimal(18,2)," &
               " @TrxHdr_PBRate decimal(18,2)," &
               " @TrxHdr_Overlay decimal(18,2)," &
               " @TrxHdr_PeriodSplit decimal(18,2)," &
               " @TrxHdr_PeriodSplitSI decimal(18,2)," &
               " @TrxHdr_A1 varchar(12), " &
               " @TrxHdr_A2 varchar(12), " &
               " @TrxHdr_A3 varchar(12), " &
               " @TrxHdr_A4 varchar(12), " &
               " @TrxHdr_A5 varchar(12), " &
               " @TrxHdr_Union varchar(12), " &
               " @TrxHdr_Position varchar(12), " &
               " @TrxHdr_COLA decimal(18, 2)," &
               " @TrxHdr_MyRate decimal(18, 4)," &
               " @TrxHdr_FE decimal(18, 2)," &
               " @TrxHdr_NetYTD decimal(18, 2)," &
               " @TrxHdr_PFOnAgreedSalary decimal(18, 2)," &
               " @TrxHdr_BasisOnSalary decimal(18, 2)," &
               " @TrxHdr_GesiD decimal(18, 2)," &
               " @TrxHdr_GesiC decimal(18, 2)," &
               " @TrxHdr_Medical decimal(18, 2)," &
               " @Com_Code varchar(10)," &
               " @TrxHdr_Year varchar(4), " &
               " @TrxHdr_GESIableAmount decimal(18, 2)," &
               " @TrxHdr_BIK_GesiD decimal(18, 2)," &
               " @TrxHdr_BIK_GesiC decimal(18, 2)," &
               " @TrxHdr_BIK_Gesiable decimal(18, 2)," &
               " @TrxHdr_AnalGen1 varchar(20)," &
               " @NewId Int OUTPUT " &
               " AS" &
               " DECLARE @Result as Int" &
               " Set  @Result = 0" &
               " SELECT @Result = Count(*)" &
               " FROM PrTxTrxnHeader" &
               " WHERE TrxHdr_Id =  @TrxHdr_Id" &
               " IF(@Result IS NULL) OR (@Result=0)" &
               " BEGIN" &
               "   INSERT INTO PrTxTrxnHeader" &
               "   (Emp_Code,                                           " &
               " PrdGrp_Code," &
               " PrdCod_Code,                                        " &
               " PayCat_Code,                                        " &
               " TrxHdr_Date,                                        " &
               " TrxHdr_Status,                                      " &
               " TrxHdr_TotalErnPeriod,                              " &
               " TrxHdr_TotalErnYTD,                                 " &
               " TrxHdr_TotalDedPeriod,                              " &
               " TrxHdr_TotalDedYTD,                                 " &
               " TrxHdr_TotalConPeriod,                              " &
               " TrxHdr_TotalConYTD,                                 " &
               " TrxHdr_SIIncome,                                    " &
               " TrxHdr_TaxableIncome,                               " &
               " TrxHdr_PaymentMethod,                               " &
               " TrxHdr_PaymentRef,                                  " &
               " TrxHdr_PeriodUnits,                                 " &
               " TrxHdr_AnnualUnits,                                 " &
               " TrxHdr_AnnualLeave,                                  " &
               " TrxHdr_LifeInsurance,                                " &
               " TrxHdr_Discounts,                                    " &
               " TrxHdr_InterfaceStatus,                               " &
               " TrxHdr_Overtime1," &
               " TrxHdr_Overtime2," &
               " TrxHdr_SIUnits," &
               " TrxHdr_MonthlySalary," &
               " TrxHdr_NetSalary," &
               " TrxHdr_PeriodInsurable," &
               " TemGrp_Code," &
               " TrxHdr_ChequeNo," &
               " TrxHdr_TaxableFromOther," &
               " TrxHdr_CurrencySymbol," &
               " TrxHdr_Rate," &
               " TrxHdr_NormalDays," &
               " TrxHdr_Salary1," &
               " TrxHdr_Salary2," &
               " TrxHdr_Overtime3," &
               " TrxHdr_Sectors," &
               " TrxHdr_Dutyhours," &
               " TrxHdr_FlightHours," &
               " TrxHdr_Commission," &
               " TrxHdr_PBAmount," &
               " TrxHdr_PBRate," &
               " TrxHdr_Overlay," &
               " TrxHdr_PeriodSplit, " &
               " TrxHdr_PeriodSplitSI, " &
               " TrxHdr_A1, " &
               " TrxHdr_A2, " &
               " TrxHdr_A3, " &
               " TrxHdr_A4, " &
               " TrxHdr_A5, " &
               " TrxHdr_Union, " &
               " TrxHdr_Position, " &
               " TrxHdr_COLA," &
               " TrxHdr_MyRate, " &
               " TrxHdr_FE, " &
               " TrxHdr_NetYTD, " &
               " TrxHdr_PFOnAgreedSalary, " &
               " TrxHdr_BasisOnSalary, " &
               " TrxHdr_GesiD, " &
               " TrxHdr_GesiC, " &
               " TrxHdr_Medical, " &
               " Com_Code, " &
               " TrxHdr_Year, " &
               " TrxHdr_GESIableAmount, " &
               " TrxHdr_BIK_GesiD, " &
               " TrxHdr_BIK_GesiC, " &
               " TrxHdr_BIK_Gesiable, " &
               " TrxHdr_AnalGen1 " &
               " )" &
               " VALUES (" &
               " @Emp_Code,                                           " &
               " @PrdGrp_Code,                                        " &
               " @PrdCod_Code,                                        " &
               " @PayCat_Code,                                        " &
               " @TrxHdr_Date,                                        " &
               " @TrxHdr_Status,                                      " &
               " @TrxHdr_TotalErnPeriod,                              " &
               " @TrxHdr_TotalErnYTD,                                 " &
               " @TrxHdr_TotalDedPeriod,                              " &
               " @TrxHdr_TotalDedYTD,                                 " &
               " @TrxHdr_TotalConPeriod,                              " &
               " @TrxHdr_TotalConYTD,                                 " &
               " @TrxHdr_SIIncome,                                    " &
               " @TrxHdr_TaxableIncome,                               " &
               " @TrxHdr_PaymentMethod,                               " &
               " @TrxHdr_PaymentRef,                                  " &
               " @TrxHdr_PeriodUnits,                                 " &
               " @TrxHdr_AnnualUnits,                                 " &
               " @TrxHdr_AnnualLeave,                                 " &
               " @TrxHdr_LifeInsurance,                               " &
               " @TrxHdr_Discounts,                                   " &
               " @TrxHdr_InterfaceStatus,                              " &
               " @TrxHdr_Overtime1," &
               " @TrxHdr_Overtime2," &
               " @TrxHdr_SIUnits," &
               " @TrxHdr_MonthlySalary," &
               " @TrxHdr_NetSalary," &
               " @TrxHdr_PeriodInsurable," &
               " @TemGrp_Code, " &
               " @TrxHdr_ChequeNo," &
               " @TrxHdr_TaxableFromOther," &
               " @TrxHdr_CurrencySymbol," &
               " @TrxHdr_Rate," &
               " @TrxHdr_NormalDays," &
               " @TrxHdr_Salary1," &
               " @TrxHdr_Salary2," &
               " @TrxHdr_Overtime3," &
               " @TrxHdr_Sectors," &
               " @TrxHdr_Dutyhours," &
               " @TrxHdr_FlightHours," &
               " @TrxHdr_Commission," &
               " @TrxHdr_PBAmount," &
               " @TrxHdr_PBRate," &
               " @TrxHdr_Overlay," &
               " @TrxHdr_PeriodSplit, " &
               " @TrxHdr_PeriodSplitSI, " &
               " @TrxHdr_A1, " &
               " @TrxHdr_A2, " &
               " @TrxHdr_A3, " &
               " @TrxHdr_A4, " &
               " @TrxHdr_A5, " &
               " @TrxHdr_Union, " &
               " @TrxHdr_Position, " &
               " @TrxHdr_COLA," &
               " @TrxHdr_MyRate," &
               " @TrxHdr_FE, " &
               " @TrxHdr_NetYTD, " &
               " @TrxHdr_PFOnAgreedSalary, " &
               " @TrxHdr_BasisOnSalary, " &
               " @TrxHdr_GesiD, " &
               " @TrxHdr_GesiC, " &
               " @TrxHdr_Medical, " &
               " @Com_Code, " &
               " @TrxHdr_Year, " &
               " @TrxHdr_GESIableAmount, " &
               " @TrxHdr_BIK_GesiD, " &
               " @TrxHdr_BIK_GesiC, " &
               " @TrxHdr_BIK_Gesiable, " &
               " @TrxHdr_AnalGen1 " &
               " )" &
               " END" &
               " ELSE" &
               "   BEGIN" &
               "     UPDATE PrTxTrxnHeader" &
               "     SET " &
               "     Emp_Code=@Emp_Code,                                   " &
               "     PrdGrp_Code=@PrdGrp_Code," &
               "     PrdCod_Code=@PrdCod_Code,                             " &
               "     PayCat_Code=@PayCat_Code,                             " &
               "     TrxHdr_Date=@TrxHdr_Date,                             " &
               "    TrxHdr_Status=@TrxHdr_Status,                         " &
               "  TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " &
               "     TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " &
               "    TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " &
               "   TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " &
               "  TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " &
               " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " &
               " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " &
               " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " &
               " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " &
               " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " &
               " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " &
               " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " &
               " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,                " &
               " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " &
               " TrxHdr_Discounts=@TrxHdr_Discounts,                    " &
               " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,        " &
               " TrxHdr_Overtime1=@TrxHdr_Overtime1," &
               " TrxHdr_Overtime2=@TrxHdr_Overtime2," &
               " TrxHdr_SIUnits=@TrxHdr_SIUnits," &
               " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary," &
               " TrxHdr_NetSalary=@TrxHdr_NetSalary," &
               " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable," &
               " TemGrp_Code=@TemGrp_Code," &
               " TrxHdr_ChequeNo=@TrxHdr_ChequeNo ," &
               " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther," &
               " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol," &
               " TrxHdr_Rate=@TrxHdr_Rate," &
               " TrxHdr_NormalDays=@TrxHdr_NormalDays ," &
               " TrxHdr_Salary1=@TrxHdr_Salary1," &
               " TrxHdr_Salary2=@TrxHdr_Salary2," &
               " TrxHdr_Overtime3=@TrxHdr_Overtime3," &
               " TrxHdr_Sectors=@TrxHdr_Sectors," &
               " TrxHdr_Dutyhours=@TrxHdr_Dutyhours," &
               " TrxHdr_FlightHours=@TrxHdr_FlightHours," &
               " TrxHdr_Commission=@TrxHdr_Commission," &
               " TrxHdr_PBAmount=@TrxHdr_PBAmount," &
               " TrxHdr_PBRate=@TrxHdr_PBRate," &
               " TrxHdr_Overlay=@TrxHdr_Overlay," &
               " TrxHdr_PeriodSplit=@TrxHdr_PeriodSplit, " &
               " TrxHdr_PeriodSplitSI=@TrxHdr_PeriodSplitSI," &
               " TrxHdr_A1=@TrxHdr_A1, " &
               " TrxHdr_A2=@TrxHdr_A2, " &
               " TrxHdr_A3=@TrxHdr_A3, " &
               " TrxHdr_A4=@TrxHdr_A4, " &
               " TrxHdr_A5=@TrxHdr_A5, " &
               " TrxHdr_Union=@TrxHdr_Union, " &
               " TrxHdr_Position=@TrxHdr_Position, " &
               " TrxHdr_COLA=@TrxHdr_COLA," &
               " TrxHdr_MyRate=@TrxHdr_MyRate, " &
               " TrxHdr_FE=@TrxHdr_FE, " &
               " TrxHdr_NetYTD=@TrxHdr_NetYTD, " &
               " TrxHdr_PFOnAgreedSalary=@TrxHdr_PFOnAgreedSalary, " &
               " TrxHdr_BasisOnSalary=@TrxHdr_BasisOnSalary, " &
               " TrxHdr_GesiD=@TrxHdr_GesiD, " &
               " TrxHdr_GesiC=@TrxHdr_GesiC, " &
               " TrxHdr_Medical=@TrxHdr_Medical, " &
               " Com_Code=@Com_Code, " &
               " TrxHdr_Year=@TrxHdr_Year, " &
               " TrxHdr_GESIableAmount =@TrxHdr_GESIableAmount, " &
               " TrxHdr_BIK_GesiD = @TrxHdr_BIK_GesiD, " &
               " TrxHdr_BIK_GesiC = @TrxHdr_BIK_GesiC, " &
               " TrxHdr_BIK_Gesiable = @TrxHdr_BIK_Gesiable, " &
               " TrxHdr_AnalGen1 = @TrxHdr_AnalGen1 " &
               " WHERE TrxHdr_Id = @TrxHdr_Id" &
               " END " &
               " set  @NewId=SCOPE_IDENTITY()"

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If




        Return Proceed



    End Function
    Protected Function Upgrade_2020_01()


        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_IsDirector] varchar(1) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
            Str = "Update PrMsEmployees set Emp_IsDirector = '0' "
            i = ExecuteNonQuery(Str)
            If i >= 0 Then
                MsgBox("Value set to Zero", MsgBoxStyle.Information)
            Else
                MsgBox("Fail to set value to zero", MsgBoxStyle.Critical)
            End If

        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Value set to Zero", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to set value to zero", MsgBoxStyle.Critical)
        End If



        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1), " &
        " @Emp_GESYFromSplit decimal(18,2), " &
        " @Emp_AnalGen1 varchar(20), " &
        " @Emp_Nameday varchar(10), " &
        " @Emp_IsDirector varchar(1) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen, " &
        " Emp_GESYFromSplit, " &
        " Emp_AnalGen1, " &
        " Emp_NameDay, " &
        " Emp_IsDirector " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen, " &
        " @Emp_GESYFromSplit, " &
        " @Emp_AnalGen1," &
        " @Emp_Nameday, " &
        " @Emp_IsDirector " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen, " &
        " Emp_GESYFromSplit= @Emp_GESYFromSplit, " &
        " Emp_AnalGen1 = @Emp_AnalGen1," &
        " Emp_Nameday = @Emp_NameDay, " &
        " Emp_Isdirector = @Emp_Isdirector " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If






        Return True
    End Function
    Protected Function Upgrade_2020_02()


        Dim Str As String
        Dim i As Integer


        Str = "CREATE TABLE [dbo].[PrMsReminders]( " &
        " [Rem_Id] [int] IDENTITY(1,1) NOT NULL, " &
        " [Emp_Code] [varchar](10) NOT NULL, " &
        " [Rem_Description] [nvarchar](300) NOT NULL, " &
        " [Rem_ReminderDate] [date] NOT NULL, " &
        " [Rem_IsActive] [char](1) NOT NULL, " &
        " [Rem_CreatedBy] [varchar](30) NOT NULL, " &
        " [Rem_CreatedAt] [date] NOT NULL, " &
        " [Rem_DeactivatedBy] [varchar](30) NULL, " &
        " [Rem_DeactivatedAt] [date] NULL " &
        " ) ON [PRIMARY] "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New Table Created", MsgBoxStyle.Information)

        End If




        ' Alter SPs                                     

        Str = " CREATE PROCEDURE [dbo].[AG_PrMsReminders_SAVE_UPDATE] " &
            " @Rem_Id int, " &
            " @Emp_Code varchar(10), " &
            " @Rem_Description nvarchar(300), " &
            " @Rem_ReminderDate smalldatetime, " &
            " @Rem_IsActive char(1), " &
            " @Rem_CreatedBy varchar(30), " &
            " @Rem_CreatedAt smalldatetime, " &
            " @Rem_DeactivatedBy varchar(30), " &
            " @Rem_DeactivatedAt smalldatetime,  " &
            " @NewId Int OUTPUT " &
            " AS " &
            " DECLARE @Result as Int " &
            " Set @Result = 0 " &
            " SELECT @Result = Count(*) " &
            " FROM PrMsReminders " &
            " WHERE Rem_id = @Rem_id " &
            " IF(@Result IS NULL) OR (@Result=0) " &
            "   BEGIN " &
            "      INSERT INTO PrMsReminders " &
            "     (Emp_Code," &
            "	  Rem_Description, " &
            "	  Rem_ReminderDate, " &
            "	  Rem_IsActive, " &
            "	  Rem_CreatedBy, " &
            "	  Rem_CreatedAt, " &
            "	  Rem_DeactivatedBy, " &
            "	  Rem_DeactivatedAt " &
            "    ) " &
            "    VALUES ( " &
            "     @Emp_Code, " &
            "	  @Rem_Description, " &
            "	  @Rem_ReminderDate, " &
            "	  @Rem_IsActive, " &
            "	  @Rem_CreatedBy, " &
            "	  @Rem_CreatedAt, " &
            "	  @Rem_DeactivatedBy, " &
            "	  @Rem_DeactivatedAt " &
            "    ) " &
            "  END " &
            "ELSE " &
            "BEGIN " &
            "UPDATE PrMsReminders " &
            "SET  " &
            "Emp_Code=@Emp_Code, " &
            "Rem_Description=@Rem_Description, " &
            "Rem_ReminderDate=@Rem_ReminderDate, " &
            "Rem_IsActive=@Rem_IsActive," &
            "Rem_CreatedBy=@Rem_CreatedBy, " &
            "Rem_CreatedAt=@Rem_CreatedAt, " &
            "Rem_DeactivatedBy=@Rem_DeactivatedBy, " &
            "Rem_DeactivatedAt=@Rem_DeactivatedAt " &
            "      WHERE Rem_id = @Rem_id " &
            "  END " &
            "set @NewId=SCOPE_IDENTITY() "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If






        Return True
    End Function
    Protected Function Upgrade_2020_03()


        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_Rehire] varchar(16) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
            Str = "Update PrMsEmployees set Emp_Rehire = '' "
            i = ExecuteNonQuery(Str)
            If i >= 0 Then
                MsgBox("Value set to ''", MsgBoxStyle.Information)
            Else
                MsgBox("Fail to set value to ''", MsgBoxStyle.Critical)
            End If

        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If


        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1), " &
        " @Emp_GESYFromSplit decimal(18,2), " &
        " @Emp_AnalGen1 varchar(20), " &
        " @Emp_Nameday varchar(10), " &
        " @Emp_IsDirector varchar(1), " &
        " @Emp_Rehire varchar(16) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen, " &
        " Emp_GESYFromSplit, " &
        " Emp_AnalGen1, " &
        " Emp_NameDay, " &
        " Emp_IsDirector, " &
        " Emp_Rehire " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen, " &
        " @Emp_GESYFromSplit, " &
        " @Emp_AnalGen1," &
        " @Emp_Nameday, " &
        " @Emp_IsDirector, " &
        " @Emp_Rehire " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen, " &
        " Emp_GESYFromSplit= @Emp_GESYFromSplit, " &
        " Emp_AnalGen1 = @Emp_AnalGen1," &
        " Emp_Nameday = @Emp_NameDay, " &
        " Emp_Isdirector = @Emp_Isdirector, " &
        " Emp_Rehire = @Emp_Rehire " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If






        Return True
    End Function
    Protected Function Upgrade_2020_04()


        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_PreviousInsGesy] decimal(18,2) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
            Str = "Update PrMsEmployees set Emp_PreviousInsGesy= (Emp_PrevGesiD / 1.7 * 100) "
            i = ExecuteNonQuery(Str)
            If i >= 0 Then
                MsgBox("Value set to ''", MsgBoxStyle.Information)
            Else
                MsgBox("Fail to set value to ''", MsgBoxStyle.Critical)
            End If

        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If


        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1), " &
        " @Emp_GESYFromSplit decimal(18,2), " &
        " @Emp_AnalGen1 varchar(20), " &
        " @Emp_Nameday varchar(10), " &
        " @Emp_IsDirector varchar(1), " &
        " @Emp_Rehire varchar(16), " &
        " @Emp_PreviousInsGesy decimal(18,2)" &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen, " &
        " Emp_GESYFromSplit, " &
        " Emp_AnalGen1, " &
        " Emp_NameDay, " &
        " Emp_IsDirector, " &
        " Emp_Rehire, " &
        " Emp_PreviousInsGesy " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen, " &
        " @Emp_GESYFromSplit, " &
        " @Emp_AnalGen1," &
        " @Emp_Nameday, " &
        " @Emp_IsDirector, " &
        " @Emp_Rehire, " &
        " @Emp_PreviousInsGesy " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen, " &
        " Emp_GESYFromSplit= @Emp_GESYFromSplit, " &
        " Emp_AnalGen1 = @Emp_AnalGen1," &
        " Emp_Nameday = @Emp_NameDay, " &
        " Emp_Isdirector = @Emp_Isdirector, " &
        " Emp_Rehire = @Emp_Rehire, " &
        " Emp_PreviousInsGesy = @Emp_PreviousInsGesy " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If






        Return True
    End Function


    Protected Function Upgrade_2020_05()


        Dim Str As String
        Dim i As Integer


        Str = "CREATE TABLE [dbo].[PrTxLoanComments]( " &
            "[Lne_Id] [int] IDENTITY(1,1) NOT NULL, " &
            "[Emp_Code] [varchar](16) NOT NULL, " &
            "[Lne_Code] [varchar](10) NOT NULL, " &
            "[Lne_Date] [datetime] NOT NULL, " &
            "[Lne_Amount] [decimal](18, 2) NOT NULL, " &
            "[Lne_Comment] [varchar](200) NOT NULL, " &
            "[Lne_Type] [char](1) NOT NULL, " &
            "[Lne_ChequeNo] [varchar](20) NOT NULL " &
            ") ON [PRIMARY] "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("PrTxLoanComments was Created", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Create PrTxLoanComments ", MsgBoxStyle.Critical)
        End If


        ' Alter SPs                                     

        Str = "Create PROCEDURE [dbo].[AG_PrTxLoanComments_SAVE_UPDATE] " &
            " @Lne_Id	int, " &
            " @Emp_Code varchar(16), " &
            " @Lne_Code varchar(10), " &
            " @Lne_Date datetime, " &
            " @Lne_Amount decimal(18,2), " &
            " @Lne_Comment varchar(200), " &
            " @Lne_Type varchar(1), " &
            " @Lne_ChequeNo varchar(20), " &
            " @NewId Int OUTPUT " &
            " AS " &
            " DECLARE @Result as Int " &
            " Set @Result = 0 " &
            " SELECT @Result = Count(*) " &
            " FROM PrTxLoanComments " &
            " WHERE Lne_id = @Lne_id " &
            " IF(@Result IS NULL) OR (@Result=0) " &
            " BEGIN " &
            " INSERT INTO PrTxLoanComments " &
            "     ( Emp_Code, " &
            "		Lne_Code, " &
            "		Lne_Date, " &
            "		Lne_Amount, " &
            "		Lne_Comment, " &
            "		Lne_Type, " &
            "		Lne_ChequeNo) " &
            "     VALUES ( " &
            "       @Emp_Code, " &
            "		@Lne_Code, " &
            "		@Lne_Date, " &
            "		@Lne_Amount, " &
            "		@Lne_Comment, " &
            "		@Lne_Type, " &
            "		@Lne_ChequeNo " &
            "     ) " &
            "   END " &
            "  ELSE " &
            "   BEGIN " &
            "     UPDATE PrTxLoanComments      SET  " &
            "       Emp_Code= @Emp_Code, " &
            "		Lne_Code=@Lne_Code, " &
            "		Lne_Date=@Lne_Date, " &
            "		Lne_Amount=@Lne_Amount, " &
            "		Lne_Comment=@Lne_Comment, " &
            "		Lne_Type=@Lne_Type, " &
            "		Lne_ChequeNo=@Lne_ChequeNo " &
            "     WHERE Lne_id =@Lne_id " &
            " END " &
            " set @NewId=SCOPE_IDENTITY()"




        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxLoanComments was Created", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Create PrTxLoanComments SP", MsgBoxStyle.Critical)
        End If






        Return True
    End Function





    Protected Function GetAllIBANSOfTemplateGroupCode(ByVal TempGroupCode As String) As DataSet
        Dim Str As String
        Str = " Select distinct(Emp_BankAccountCo) from PrmsEmployees where TemGrp_Code = " & enQuoteString(TempGroupCode)
        Return MyBase.GetData(Str)

    End Function
    Protected Function GetAllPayslipsOfTemplateGroupCode(ByVal TempGroupCode As String) As DataSet
        Dim Str As String
        Str = " Select distinct(Emp_MyPayslipReport) from PrmsEmployees where TemGrp_Code = " & enQuoteString(TempGroupCode)
        Return MyBase.GetData(Str)
    End Function
    Protected Function CreateEmailPayslipWording() As Boolean
        Dim F As Boolean = True
        Dim i As Integer
        Dim Str As String

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Email', 'Payslip1', '', 'Line 1', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If
        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Email', 'Payslip2', '', 'Line 2', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If
        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Email', 'Payslip3', '', 'Line 3', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If
        Str = "INSERT INTO PrSsParameters" &
                        " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                        "VALUES     ( 'Email', 'Payslip4', '', 'Line 4', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If
        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Email', 'Payslip5', '', 'Line 5', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Email', 'Payslip6', '', 'Line 6', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Email', 'Payslip7', '', 'Line 7', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Email', 'Payslip8', '', 'Line 8', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Email', 'Payslip9', '', 'Line 9', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Email', 'Payslip10', '', 'Line 10', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Email', 'WordingMsg', '1', 'Wording Enable', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If

        Return F
    End Function
    Protected Function FixNVARcharOnAnalysis() As Boolean
        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True

        Str = "ALTER TABLE PrAnEmployeeAnalysis1 " &
        " ALTER COLUMN EmpAn1_DescriptionL nvarchar(40) collate Greek_CI_AS null"
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If
        Str = "ALTER TABLE PrAnEmployeeAnalysis2 " &
        " ALTER COLUMN EmpAn2_DescriptionL nvarchar(40) collate Greek_CI_AS  null"
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If
        Str = "ALTER TABLE PrAnEmployeeAnalysis3 " &
        " ALTER COLUMN EmpAn3_DescriptionL nvarchar(40) collate Greek_CI_AS  null"
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If
        Str = "ALTER TABLE PrAnEmployeeAnalysis4 " &
        " ALTER COLUMN EmpAn4_DescriptionL nvarchar(40) collate Greek_CI_AS  null"
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If
        Str = "ALTER TABLE PrAnEmployeeAnalysis5 " &
        " ALTER COLUMN EmpAn5_DescriptionL nvarchar(40) collate Greek_CI_AS  null"
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If
        Str = "ALTER TABLE PrAnEmployeeAnalysis1 " &
        " ALTER COLUMN EmpAn1_DescriptionS nvarchar(15) collate Greek_CI_AS  null"
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If
        Str = "ALTER TABLE PrAnEmployeeAnalysis2 " &
        " ALTER COLUMN EmpAn2_DescriptionS nvarchar(15) collate Greek_CI_AS  null"
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If
        Str = "ALTER TABLE PrAnEmployeeAnalysis3 " &
        " ALTER COLUMN EmpAn3_DescriptionS nvarchar(15) collate Greek_CI_AS  null"
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If
        Str = "ALTER TABLE PrAnEmployeeAnalysis4 " &
        " ALTER COLUMN EmpAn4_DescriptionS nvarchar(15) collate Greek_CI_AS  null"
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If
        Str = "ALTER TABLE PrAnEmployeeAnalysis5 " &
        " ALTER COLUMN EmpAn5_DescriptionS nvarchar(15) collate Greek_CI_AS  null"
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If



        Str = " ALTER PROCEDURE [dbo].[AG_PrAnEmployeeAnalysis1_SAVE_UPDATE] " &
        " @EmpAn1_Code varchar(12), " &
        " @EmpAn1_DescriptionL nvarchar(40), " &
        " @EmpAn1_DescriptionS nvarchar(15), " &
        " @EmpAn1_IsActive char(1), " &
        " @EmpAn1_GLAnal1 varchar(12), " &
        " @EmpAn1_GLAnal2 varchar(12), " &
        " @EmpAn1_CreationDate smalldatetime, " &
        " @EmpAn1_AmendDate smalldatetime " &
        " AS " &
        "  DECLARE @Result as Int " &
        "  Set @Result = 0 " &
        "  SELECT @Result = Count(*) " &
        "  FROM PrAnEmployeeAnalysis1 " &
        "  WHERE EmpAn1_Code = @EmpAn1_Code " &
        "  IF(@Result IS NULL) OR (@Result=0) " &
        "    BEGIN " &
        "      INSERT INTO PrAnEmployeeAnalysis1 " &
        "     (EmpAn1_Code,                                         " &
        "      EmpAn1_DescriptionL,                                 " &
        "      EmpAn1_DescriptionS,                                 " &
        "      EmpAn1_IsActive,                                     " &
        "      EmpAn1_GLAnal1,                                      " &
        "      EmpAn1_GLAnal2,                                      " &
        "      EmpAn1_CreationDate,                                 " &
        "      EmpAn1_AmendDate                                     " &
        "      ) " &
        "      VALUES ( " &
        "      @EmpAn1_Code,                                         " &
        "      @EmpAn1_DescriptionL,                                 " &
        "      @EmpAn1_DescriptionS,                                 " &
        "      @EmpAn1_IsActive,                                     " &
        "      @EmpAn1_GLAnal1,                                      " &
        "      @EmpAn1_GLAnal2,                                      " &
        "      @EmpAn1_CreationDate,                                 " &
        "      @EmpAn1_AmendDate                                     " &
        "      ) " &
        "    END " &
        "  ELSE " &
        "    BEGIN " &
        "      UPDATE PrAnEmployeeAnalysis1 " &
        "      SET  " &
        "      EmpAn1_Code=@EmpAn1_Code,                              " &
        "      EmpAn1_DescriptionL=@EmpAn1_DescriptionL,              " &
        "      EmpAn1_DescriptionS=@EmpAn1_DescriptionS,              " &
        "      EmpAn1_IsActive=@EmpAn1_IsActive,                      " &
        "      EmpAn1_GLAnal1=@EmpAn1_GLAnal1,                        " &
        "      EmpAn1_GLAnal2=@EmpAn1_GLAnal2,                        " &
        "      EmpAn1_CreationDate=@EmpAn1_CreationDate,              " &
        "      EmpAn1_AmendDate=@EmpAn1_AmendDate                     " &
        "      WHERE EmpAn1_Code = @EmpAn1_Code " &
        "  END "
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If


        Str = " ALTER PROCEDURE [dbo].[AG_PrAnEmployeeAnalysis2_SAVE_UPDATE] " &
       " @EmpAn2_Code varchar(12), " &
       " @EmpAn2_DescriptionL nvarchar(40), " &
       " @EmpAn2_DescriptionS nvarchar(15), " &
       " @EmpAn2_IsActive char(1), " &
       " @EmpAn2_GLAnal1 varchar(12), " &
       " @EmpAn2_GLAnal2 varchar(12), " &
       " @EmpAn2_CreationDate smalldatetime, " &
       " @EmpAn2_AmendDate smalldatetime " &
       " AS " &
       "  DECLARE @Result as Int " &
       "  Set @Result = 0 " &
       "  SELECT @Result = Count(*) " &
       "  FROM PrAnEmployeeAnalysis2 " &
       "  WHERE EmpAn2_Code = @EmpAn2_Code " &
       "  IF(@Result IS NULL) OR (@Result=0) " &
       "    BEGIN " &
       "      INSERT INTO PrAnEmployeeAnalysis2 " &
       "     (EmpAn2_Code,                                        " &
       "      EmpAn2_DescriptionL,                                " &
       "      EmpAn2_DescriptionS,                                " &
       "      EmpAn2_IsActive,                                    " &
       "      EmpAn2_GLAnal1,                                     " &
       "      EmpAn2_GLAnal2,                                     " &
       "      EmpAn2_CreationDate,                                " &
       "      EmpAn2_AmendDate                                    " &
       "      ) " &
       "      VALUES ( " &
       "      @EmpAn2_Code,                                       " &
       "      @EmpAn2_DescriptionL,                               " &
       "      @EmpAn2_DescriptionS,                               " &
       "      @EmpAn2_IsActive,                                   " &
       "      @EmpAn2_GLAnal1,                                    " &
       "      @EmpAn2_GLAnal2,                                    " &
       "      @EmpAn2_CreationDate,                               " &
       "      @EmpAn2_AmendDate                                   " &
       "      ) " &
       "    END " &
       "  ELSE " &
       "    BEGIN " &
       "      UPDATE PrAnEmployeeAnalysis2 " &
       "      SET  " &
       "      EmpAn2_Code=@EmpAn2_Code,                             " &
       "      EmpAn2_DescriptionL=@EmpAn2_DescriptionL,             " &
       "      EmpAn2_DescriptionS=@EmpAn2_DescriptionS,             " &
       "      EmpAn2_IsActive=@EmpAn2_IsActive,                     " &
       "      EmpAn2_GLAnal1=@EmpAn2_GLAnal1,                       " &
       "      EmpAn2_GLAnal2=@EmpAn2_GLAnal2,                       " &
       "      EmpAn2_CreationDate=@EmpAn2_CreationDate,             " &
       "      EmpAn2_AmendDate=@EmpAn2_AmendDate                    " &
       "      WHERE EmpAn2_Code = @EmpAn2_Code " &
       "  END "

        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If

        Str = " ALTER PROCEDURE [dbo].[AG_PrAnEmployeeAnalysis3_SAVE_UPDATE] " &
       " @EmpAn3_Code varchar(12), " &
       " @EmpAn3_DescriptionL nvarchar(40), " &
       " @EmpAn3_DescriptionS nvarchar(15), " &
       " @EmpAn3_IsActive char(1), " &
       " @EmpAn3_GLAnal1 varchar(12), " &
       " @EmpAn3_GLAnal2 varchar(12), " &
       " @EmpAn3_CreationDate smalldatetime, " &
       " @EmpAn3_AmendDate smalldatetime " &
       " AS " &
       "  DECLARE @Result as Int " &
       "  Set @Result = 0 " &
       "  SELECT @Result = Count(*) " &
       "  FROM PrAnEmployeeAnalysis3 " &
       "  WHERE EmpAn3_Code = @EmpAn3_Code " &
       "  IF(@Result IS NULL) OR (@Result=0) " &
       "    BEGIN " &
       "      INSERT INTO PrAnEmployeeAnalysis3 " &
       "     (EmpAn3_Code,                                         " &
       "      EmpAn3_DescriptionL,                                 " &
       "      EmpAn3_DescriptionS,                                 " &
       "      EmpAn3_IsActive,                                     " &
       "      EmpAn3_GLAnal1,                                      " &
       "      EmpAn3_GLAnal2,                                      " &
       "      EmpAn3_CreationDate,                                 " &
       "      EmpAn3_AmendDate                                     " &
       "      ) " &
       "      VALUES ( " &
       "      @EmpAn3_Code,                                         " &
       "      @EmpAn3_DescriptionL,                                 " &
       "      @EmpAn3_DescriptionS,                                 " &
       "      @EmpAn3_IsActive,                                     " &
       "      @EmpAn3_GLAnal1,                                      " &
       "      @EmpAn3_GLAnal2,                                      " &
       "      @EmpAn3_CreationDate,                                 " &
       "      @EmpAn3_AmendDate                                     " &
       "      ) " &
       "    END " &
       "  ELSE " &
       "    BEGIN " &
       "      UPDATE PrAnEmployeeAnalysis3 " &
       "      SET  " &
       "      EmpAn3_Code=@EmpAn3_Code,                              " &
       "      EmpAn3_DescriptionL=@EmpAn3_DescriptionL,              " &
       "      EmpAn3_DescriptionS=@EmpAn3_DescriptionS,              " &
       "      EmpAn3_IsActive=@EmpAn3_IsActive,                      " &
       "      EmpAn3_GLAnal1=@EmpAn3_GLAnal1,                        " &
       "      EmpAn3_GLAnal2=@EmpAn3_GLAnal2,                        " &
       "      EmpAn3_CreationDate=@EmpAn3_CreationDate,              " &
       "      EmpAn3_AmendDate=@EmpAn3_AmendDate                     " &
       "      WHERE EmpAn3_Code = @EmpAn3_Code " &
       "  END "
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If


        Str = " ALTER PROCEDURE [dbo].[AG_PrAnEmployeeAnalysis4_SAVE_UPDATE] " &
       " @EmpAn4_Code varchar(12), " &
       " @EmpAn4_DescriptionL nvarchar(40), " &
       " @EmpAn4_DescriptionS nvarchar(15), " &
       " @EmpAn4_IsActive char(1), " &
       " @EmpAn4_GLAnal1 varchar(12), " &
       " @EmpAn4_GLAnal2 varchar(12), " &
       " @EmpAn4_CreationDate smalldatetime, " &
       " @EmpAn4_AmendDate smalldatetime " &
       " AS " &
       "  DECLARE @Result as Int " &
       "  Set @Result = 0 " &
       "  SELECT @Result = Count(*) " &
       "  FROM PrAnEmployeeAnalysis4 " &
       "  WHERE EmpAn4_Code = @EmpAn4_Code " &
       "  IF(@Result IS NULL) OR (@Result=0) " &
       "    BEGIN " &
       "      INSERT INTO PrAnEmployeeAnalysis4 " &
       "     (EmpAn4_Code,                                         " &
       "      EmpAn4_DescriptionL,                                 " &
       "      EmpAn4_DescriptionS,                                 " &
       "      EmpAn4_IsActive,                                     " &
       "      EmpAn4_GLAnal1,                                      " &
       "      EmpAn4_GLAnal2,                                      " &
       "      EmpAn4_CreationDate,                                 " &
       "      EmpAn4_AmendDate                                     " &
       "      ) " &
       "      VALUES ( " &
       "      @EmpAn4_Code,                                         " &
       "      @EmpAn4_DescriptionL,                                 " &
       "      @EmpAn4_DescriptionS,                                 " &
       "      @EmpAn4_IsActive,                                     " &
       "      @EmpAn4_GLAnal1,                                      " &
       "      @EmpAn4_GLAnal2,                                      " &
       "      @EmpAn4_CreationDate,                                 " &
       "      @EmpAn4_AmendDate                                     " &
       "      ) " &
       "    END " &
       "  ELSE " &
       "    BEGIN " &
       "      UPDATE PrAnEmployeeAnalysis4 " &
       "      SET  " &
       "      EmpAn4_Code=@EmpAn4_Code,                              " &
       "      EmpAn4_DescriptionL=@EmpAn4_DescriptionL,              " &
       "      EmpAn4_DescriptionS=@EmpAn4_DescriptionS,              " &
       "      EmpAn4_IsActive=@EmpAn4_IsActive,                      " &
       "      EmpAn4_GLAnal1=@EmpAn4_GLAnal1,                        " &
       "      EmpAn4_GLAnal2=@EmpAn4_GLAnal2,                        " &
       "      EmpAn4_CreationDate=@EmpAn4_CreationDate,              " &
       "      EmpAn4_AmendDate=@EmpAn4_AmendDate                     " &
       "      WHERE EmpAn4_Code = @EmpAn4_Code " &
       "  END "
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If


        Str = " ALTER PROCEDURE [dbo].[AG_PrAnEmployeeAnalysis5_SAVE_UPDATE] " &
             " @EmpAn5_Code varchar(12), " &
             " @EmpAn5_DescriptionL nvarchar(40), " &
             " @EmpAn5_DescriptionS nvarchar(15), " &
             " @EmpAn5_IsActive char(1), " &
             " @EmpAn5_GLAnal1 varchar(12), " &
             " @EmpAn5_GLAnal2 varchar(12), " &
             " @EmpAn5_CreationDate smalldatetime, " &
             " @EmpAn5_AmendDate smalldatetime " &
             " AS " &
             "  DECLARE @Result as Int " &
             "  Set @Result = 0 " &
             "  SELECT @Result = Count(*) " &
             "  FROM PrAnEmployeeAnalysis5 " &
             "  WHERE EmpAn5_Code = @EmpAn5_Code " &
             "  IF(@Result IS NULL) OR (@Result=0) " &
             "    BEGIN " &
             "      INSERT INTO PrAnEmployeeAnalysis5 " &
             "     (EmpAn5_Code,                                         " &
             "      EmpAn5_DescriptionL,                                 " &
             "      EmpAn5_DescriptionS,                                 " &
             "      EmpAn5_IsActive,                                     " &
             "      EmpAn5_GLAnal1,                                      " &
             "      EmpAn5_GLAnal2,                                      " &
             "      EmpAn5_CreationDate,                                 " &
             "      EmpAn5_AmendDate                                     " &
             "      ) " &
             "      VALUES ( " &
             "      @EmpAn5_Code,                                         " &
             "      @EmpAn5_DescriptionL,                                 " &
             "      @EmpAn5_DescriptionS,                                 " &
             "      @EmpAn5_IsActive,                                     " &
             "      @EmpAn5_GLAnal1,                                      " &
             "      @EmpAn5_GLAnal2,                                      " &
             "      @EmpAn5_CreationDate,                                 " &
             "      @EmpAn5_AmendDate                                     " &
             "      ) " &
             "    END " &
             "  ELSE " &
             "    BEGIN " &
             "      UPDATE PrAnEmployeeAnalysis5 " &
             "      SET  " &
             "      EmpAn5_Code=@EmpAn5_Code,                              " &
             "      EmpAn5_DescriptionL=@EmpAn5_DescriptionL,              " &
             "      EmpAn5_DescriptionS=@EmpAn5_DescriptionS,              " &
             "      EmpAn5_IsActive=@EmpAn5_IsActive,                      " &
             "      EmpAn5_GLAnal1=@EmpAn5_GLAnal1,                        " &
             "      EmpAn5_GLAnal2=@EmpAn5_GLAnal2,                        " &
             "      EmpAn5_CreationDate=@EmpAn5_CreationDate,              " &
             "      EmpAn5_AmendDate=@EmpAn5_AmendDate                     " &
             "      WHERE EmpAn5_Code = @EmpAn5_Code " &
             "  END "
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If




        Return F

    End Function
    Protected Function AddTaxRuleAsParameter() As Boolean
        Dim F As Boolean = True
        Dim i As Integer
        Dim Str As String

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'IT', 'TAXRule', '16.67', 'Tax Rule', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If
        Return F
    End Function
    Protected Function AddDefRowCount() As Boolean
        Dim F As Boolean = True
        Dim i As Integer
        Dim Str As String

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'System', 'DefRowCount', '3', 'Default Row Count', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If
        Return F
    End Function
    Protected Function AddIndexes() As Boolean
        Dim F As Boolean = True
        Dim i As Integer
        Dim Str As String

        'EmpCode,ErnCode,TemGroup on Employee Earnings Uniquekey and EmpCode, TempCode index

        Str = " ALTER TABLE [dbo].[PrMsEmployeeEarnings] ADD  CONSTRAINT [IX_EmpErnTemp] UNIQUE NONCLUSTERED " &
        " ( " &
        "	[Emp_Code] ASC, " &
        "	[ErnCod_Code] ASC, " &
        "	[TemGrp_Code] ASC " &
        " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] " &
        "  " &
        " CREATE NONCLUSTERED INDEX [IX_EmpCode] ON [dbo].[PrMsEmployeeEarnings]  " &
        " ( " &
        "	[Emp_Code] ASC " &
        " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] " &
        " " &
        " CREATE NONCLUSTERED INDEX [IX_TempGroup] ON [dbo].[PrMsEmployeeEarnings]  " &
        " ( " &
        "	[TemGrp_Code] ASC " &
        " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] "


        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If

        Str = " ALTER TABLE [dbo].[PrMsEmployeeDeductions] ADD  CONSTRAINT [IX_EmpDedTemp] UNIQUE NONCLUSTERED " &
       " ( " &
       "	[Emp_Code] ASC, " &
       "	[DedCod_Code] ASC, " &
       "	[TemGrp_Code] ASC " &
       " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] " &
       "  " &
       " CREATE NONCLUSTERED INDEX [IX_EmpCode] ON [dbo].[PrMsEmployeeDeductions]  " &
       " ( " &
       "	[Emp_Code] ASC " &
       " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] " &
       " " &
       " CREATE NONCLUSTERED INDEX [IX_TempGroup] ON [dbo].[PrMsEmployeeDeductions]  " &
       " ( " &
       "	[TemGrp_Code] ASC " &
       " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] "


        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If

        Str = " ALTER TABLE [dbo].[PrMsEmployeeContributions] ADD  CONSTRAINT [IX_EmpConTemp] UNIQUE NONCLUSTERED " &
      " ( " &
      "	[Emp_Code] ASC, " &
      "	[ConCod_Code] ASC, " &
      "	[TemGrp_Code] ASC " &
      " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] " &
      "  " &
      " CREATE NONCLUSTERED INDEX [IX_EmpCode] ON [dbo].[PrMsEmployeeContributions]  " &
      " ( " &
      "	[Emp_Code] ASC " &
      " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] " &
      " " &
      " CREATE NONCLUSTERED INDEX [IX_TempGroup] ON [dbo].[PrMsEmployeeContributions]  " &
      " ( " &
      "	[TemGrp_Code] ASC " &
      " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] "


        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If

        'TempGroup and ErnCode  Unique Index on Template Earnings

        Str = " ALTER TABLE [dbo].[PrMsTemplateEarnings] ADD  CONSTRAINT [IX_ErnTem_UK] UNIQUE NONCLUSTERED " &
        " ( " &
        "	[ErnCod_Code] ASC, " &
        "	[TemGrp_Code] ASC " &
        " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] "
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If

        Str = " ALTER TABLE [dbo].[PrMsTemplateDeductions] ADD  CONSTRAINT [IX_DedTem_UK] UNIQUE NONCLUSTERED " &
       " ( " &
       "	[DedCod_Code] ASC, " &
       "	[TemGrp_Code] ASC " &
       " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] "
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If

        Str = " ALTER TABLE [dbo].[PrMsTemplateContributions] ADD  CONSTRAINT [IX_ConTem_UK] UNIQUE NONCLUSTERED " &
       " ( " &
       "	[ConCod_Code] ASC, " &
       "	[TemGrp_Code] ASC " &
       " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] "
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If

        'TempGroup Index on Template Earnings
        Str = " CREATE NONCLUSTERED INDEX [IX_TemGrp_Code] ON [dbo].[PrMsTemplateEarnings] " &
        " ( " &
        "	[TemGrp_Code] ASC " &
        " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] "
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If

        Str = " CREATE NONCLUSTERED INDEX [IX_TemGrp_Code] ON [dbo].[PrMsTemplateDeductions] " &
       " ( " &
       "	[TemGrp_Code] ASC " &
       " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] "
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If

        Str = " CREATE NONCLUSTERED INDEX [IX_TemGrp_Code] ON [dbo].[PrMsTemplateContributions] " &
       " ( " &
       "	[TemGrp_Code] ASC " &
       " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] "
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If


        'Period Earnings 

        Str = " ALTER TABLE [dbo].[PrMsPeriodEarnings] ADD  CONSTRAINT [IX_ErnCod_PerCod_PerGrpCod] UNIQUE NONCLUSTERED " &
        " ( " &
        "	[ErnCod_Code] ASC, " &
        "	[PrdCod_Code] ASC, " &
        "	[PrdGrp_Code] ASC " &
        " ) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] " &
        " " &
        " CREATE NONCLUSTERED INDEX [IX_PerGroup] ON [dbo].[PrMsPeriodEarnings]  " &
        " ( " &
        "	[PrdGrp_Code] ASC " &
        " ) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] "
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If

        Str = " ALTER TABLE [dbo].[PrMsPeriodDeductions] ADD  CONSTRAINT [IX_DedCod_PerCod_PerGrpCod] UNIQUE NONCLUSTERED " &
        " ( " &
        "	[DedCod_Code] ASC, " &
        "	[PrdCod_Code] ASC, " &
        "	[PrdGrp_Code] ASC " &
        " ) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] " &
        " " &
        " CREATE NONCLUSTERED INDEX [IX_PerGroup] ON [dbo].[PrMsPeriodDeductions]  " &
        " ( " &
        "	[PrdGrp_Code] ASC " &
        " ) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] "
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If

        Str = " ALTER TABLE [dbo].[PrMsPeriodContributions] ADD  CONSTRAINT [IX_ConCod_PerCod_PerGrpCod] UNIQUE NONCLUSTERED " &
        " ( " &
        "	[ConCod_Code] ASC, " &
        "	[PrdCod_Code] ASC, " &
        "	[PrdGrp_Code] ASC " &
        " ) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] " &
        " " &
        " CREATE NONCLUSTERED INDEX [IX_PerGroup] ON [dbo].[PrMsPeriodContributions]  " &
        " ( " &
        "	[PrdGrp_Code] ASC " &
        " ) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY] "
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If


        'Emp_code and ErnCode as EmployeeEarning
        Str = " CREATE NONCLUSTERED INDEX [IX_EmpCode_ErnCode] ON [dbo].[PrMsEmployeeEarnings] " &
        " (" &
        "	[Emp_Code] ASC," &
        "	[ErnCod_Code] ASC" &
        " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]"
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If

        'Emp_code and ErnCode as EmployeeEarning
        Str = " CREATE NONCLUSTERED INDEX [IX_EmpCode_DedCode] ON [dbo].[PrMsEmployeeDeductions] " &
        " (" &
        "	[Emp_Code] ASC," &
        "	[DedCod_Code] ASC" &
        " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]"
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If

        'Emp_code and ErnCode as EmployeeEarning
        Str = " CREATE NONCLUSTERED INDEX [IX_EmpCode_ConCode] ON [dbo].[PrMsEmployeeContributions] " &
        " (" &
        "	[Emp_Code] ASC," &
        "	[ConCod_Code] ASC" &
        " )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]"
        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If



        Return F
    End Function
    Protected Function AddOvertimeParameters() As Boolean
        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Overtime', 'BasedOnDays', '0', 'Calc on month days', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'Overtime', 'MonthDays', '0', 'Month days', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If

        Return F

    End Function
    Protected Function GetEmployeesWithManualTax(ByVal TempGroupCode As String) As DataSet
        Dim Str As String
        Str = "SELECT PrMsEmployeeDeductions.Emp_Code as EmpCode, " &
            " PrMsEmployees.Emp_FullName as FullName,  " &
            " PrMsEmployeeDeductions.DedCod_Code as DedCode, " &
            " PrMsEmployeeDeductions.EmpDed_Value as Value " &
            " FROM PrMsEmployeeDeductions INNER JOIN " &
            " PrMsEmployees ON PrMsEmployeeDeductions.Emp_Code = PrMsEmployees.Emp_Code " &
            " WHERE (PrMsEmployeeDeductions.TemGrp_Code = " & enQuoteString(TempGroupCode) & " ) " &
            " AND (PrMsEmployees.Emp_Status = 'A') " &
            " and PrMsEmployeeDeductions.DedCod_Code='D3' " &
            " and PrMsEmployeeDeductions.empDed_value<>0 "

        Return GetData(Str)
    End Function
    Public Function GetEployeeInfoForLabels(ByVal EmpCode As String) As DataSet
        Dim str As String
        str = "SELECT PrMsEmployees.Emp_Code," &
        " PrMsEmployees.Emp_FullName, " &
        " PrAnEmployeeAnalysis2.EmpAn2_code," &
        " PrAnEmployeeAnalysis2.EmpAn2_DescriptionL " &
        " FROM  PrMsEmployees INNER JOIN" &
        " PrAnEmployeeAnalysis2 ON PrMsEmployees.EmpAn2_Code = PrAnEmployeeAnalysis2.EmpAn2_Code" &
        " where Emp_Code=" & enQuoteString(EmpCode)

        Return GetData(str)

    End Function




    Public Function Upgrade_AddMFOndiscounts_30() As Boolean
        Dim Str As String
        Dim i As Integer
        Str = " ALTER TABLE PrTxEmployeeDiscounts  " &
        " ADD [EmpDis_Medical] decimal(18,2) "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("1 New columns Added in PrTxEmployeeDiscounts", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxEmployeeDiscounts", MsgBoxStyle.Critical)
        End If

        Str = " Update PrTxEmployeeDiscounts " &
       " set EmpDis_Medical=0 "
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Values Set To Zero", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Set Values to Zero", MsgBoxStyle.Critical)
        End If

        Str = " ALTER PROCEDURE [dbo].[AG_PrTxEmployeeDiscounts_SAVE_UPDATE] " &
        " @EmpDis_id int, " &
        " @Emp_Code varchar(16), " &
        " @PrdGrp_Code varchar(6), " &
        " @EmpDis_Discount1 decimal(10,2), " &
        " @EmpDis_Discount2 decimal(10,2), " &
        " @EmpDis_Discount3 decimal(10,2), " &
        " @EmpDis_Discount4 decimal(10,2), " &
        " @EmpDis_Discount5 decimal(10,2), " &
        " @EmpDis_Discount6 decimal(10,2), " &
        " @EmpDis_Discount7 decimal(10,2), " &
        " @EmpDis_Discount8 decimal(10,2), " &
        " @EmpDis_Discount9 decimal(10,2), " &
        " @EmpDis_Discount10 decimal(10,2), " &
        " @EmpDis_LifeInsurance decimal(10,2), " &
        " @Usr_Id int, " &
        " @EmpDis_CreationDate smalldatetime, " &
        " @EmpDis_AmendDate smalldatetime, " &
        " @EmpDis_Medical  decimal(18,2), " &
        " @NewId Int OUTPUT " &
        " AS " &
        "  DECLARE @Result as Int " &
        "  Set @Result = 0 " &
        "  SELECT @Result = Count(*) " &
        "  FROM PrTxEmployeeDiscounts " &
        "  WHERE EmpDis_id = @EmpDis_id " &
        "  IF(@Result IS NULL) OR (@Result=0) " &
        "  BEGIN " &
        "  INSERT INTO PrTxEmployeeDiscounts " &
        "  (Emp_Code,       " &
        "  PrdGrp_Code,     " &
        "  EmpDis_Discount1,  " &
        "  EmpDis_Discount2,   " &
        "  EmpDis_Discount3,   " &
        "  EmpDis_Discount4,    " &
        "  EmpDis_Discount5,   " &
        "  EmpDis_Discount6,   " &
        "  EmpDis_Discount7,   " &
        "  EmpDis_Discount8,    " &
        "  EmpDis_Discount9,     " &
        "  EmpDis_Discount10,     " &
        "  EmpDis_LifeInsurance,    " &
        "  Usr_Id,                  " &
        "  EmpDis_CreationDate,      " &
        "  EmpDis_AmendDate,      " &
        "  EmpDis_Medical      " &
        "  ) " &
        "  VALUES ( " &
        "  @Emp_Code,     " &
        "  @PrdGrp_Code,        " &
        "  @EmpDis_Discount1,         " &
        "  @EmpDis_Discount2,     " &
        "  @EmpDis_Discount3,      " &
        "  @EmpDis_Discount4,       " &
        "  @EmpDis_Discount5,       " &
        "  @EmpDis_Discount6,        " &
        "  @EmpDis_Discount7,        " &
        "  @EmpDis_Discount8,        " &
        "  @EmpDis_Discount9,         " &
        "  @EmpDis_Discount10,          " &
        "  @EmpDis_LifeInsurance,         " &
        "  @Usr_Id,                        " &
        "  @EmpDis_CreationDate,         " &
        "  @EmpDis_AmendDate,             " &
        "  @EmpDis_Medical             " &
        "  ) " &
        "  END " &
        "  ELSE " &
        "  BEGIN " &
        "  UPDATE PrTxEmployeeDiscounts " &
        "  SET  " &
        "  Emp_Code=@Emp_Code,          " &
        "  PrdGrp_Code=@PrdGrp_Code,      " &
        "  EmpDis_Discount1=@EmpDis_Discount1,  " &
        "  EmpDis_Discount2=@EmpDis_Discount2,    " &
        "  EmpDis_Discount3=@EmpDis_Discount3,     " &
        "  EmpDis_Discount4=@EmpDis_Discount4,     " &
        "  EmpDis_Discount5=@EmpDis_Discount5,      " &
        "  EmpDis_Discount6=@EmpDis_Discount6,      " &
        "  EmpDis_Discount7=@EmpDis_Discount7,       " &
        "  EmpDis_Discount8=@EmpDis_Discount8,       " &
        "  EmpDis_Discount9=@EmpDis_Discount9,       " &
        "  EmpDis_Discount10=@EmpDis_Discount10,       " &
        "  EmpDis_LifeInsurance=@EmpDis_LifeInsurance,     " &
        "  Usr_Id=@Usr_Id,     " &
        "  EmpDis_CreationDate=@EmpDis_CreationDate,  " &
        "  EmpDis_AmendDate=@EmpDis_AmendDate,      " &
        "  EmpDis_Medical=@EmpDis_Medical      " &
        "  WHERE EmpDis_id = @EmpDis_id  " &
        "  END " &
        " set @NewId=SCOPE_IDENTITY() "

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployeesDiscount was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Update SP PrMsEmployeeDiscount", MsgBoxStyle.Critical)
        End If




        Return Proceed



    End Function
    Public Function GetCompanyPayslipsPerPeriod(ByVal MyYear As String, ByVal CompanyCode As String) As DataSet
        Dim Str As String
        Str = "SELECT     PrTxTrxnHeader.PrdCod_Code PeriodCode," &
        " PrMsPeriodCodes.PrdCod_DescriptionL as Period," &
        " COUNT(*) AS Total" &
        " FROM PrTxTrxnHeader INNER JOIN" &
        " PrMsPeriodCodes ON PrTxTrxnHeader.PrdCod_Code = PrMsPeriodCodes.PrdCod_Code AND PrTxTrxnHeader.PrdGrp_Code = PrMsPeriodCodes.PrdGrp_Code" &
        " WHERE (PrTxTrxnHeader.Com_Code = " & enQuoteString(CompanyCode) & ") " &
        " AND (PrTxTrxnHeader.TrxHdr_Year = " & enQuoteString(MyYear) & ")" &
        " GROUP BY PrTxTrxnHeader.PrdCod_Code, PrMsPeriodCodes.PrdCod_DescriptionL" &
        " ORDER BY PrTxTrxnHeader.PrdCod_Code"

        Return GetData(Str)
    End Function
    Public Function GetCompanyPayslipsTotalPerCompany(ByVal MyYear As String, ByVal CompanyCode As String) As DataSet
        Dim Str As String
        If CompanyCode = "All" Then
            Str = "SELECT AdMsCompany.Com_Name as Company," &
            " COUNT(*) AS YearTotals" &
            " FROM PrTxTrxnHeader INNER JOIN" &
            " AdMsCompany ON PrTxTrxnHeader.Com_Code = AdMsCompany.Com_Code COLLATE SQL_Latin1_General_CP1_CI_AI" &
            " WHERE (PrTxTrxnHeader.TrxHdr_Year = " & enQuoteString(MyYear) & ")" &
            " GROUP BY AdMsCompany.Com_Name"
        Else
            Str = "SELECT AdMsCompany.Com_Name as Company," &
           " COUNT(*) AS YearTotals" &
           " FROM PrTxTrxnHeader INNER JOIN" &
           " AdMsCompany ON PrTxTrxnHeader.Com_Code = AdMsCompany.Com_Code COLLATE SQL_Latin1_General_CP1_CI_AI" &
           " WHERE (PrTxTrxnHeader.Com_Code = " & enQuoteString(CompanyCode) & ")" &
           " AND (PrTxTrxnHeader.TrxHdr_Year = " & enQuoteString(MyYear) & ")" &
           " GROUP BY AdMsCompany.Com_Name"
        End If
        Return GetData(Str)


    End Function
    Public Function GetAllPrMsRemindersByEmpCode(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT Rem_Id, " &
            " Emp_Code, " &
            " Rem_Description, " &
            " Rem_ReminderDate, " &
            " Rem_IsActive, " &
            " Rem_CreatedBy, " &
            " Rem_CreatedAt, " &
            " Rem_DeactivatedBy,  " &
            " Rem_DeactivatedAt " &
            " FROM PrMsReminders " &
            "  WHERE Emp_code= " & enQuoteString(EmpCode) &
            " Order by rem_id desc "

        Return GetData(Str)
    End Function
    Public Function GetRemindersForPeriodForTemGroup(ByVal TempGroup As String, ByVal FromDate As Date, ByVal ToDate As Date, ByVal OnlyActive As Boolean) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim sFrom As String = Format(FromDate, "yyyy-MM-dd")
        sFrom = Utils.ChangeDateFormatForSearch(sFrom)

        Dim sTo As String = Format(ToDate, "yyyy-MM-dd")
        sTo = Utils.ChangeDateFormatForSearch(sTo)



        Str = " SELECT PrMsReminders.Rem_Id, " &
        " PrMsReminders.Emp_Code, " &
        " PrMsReminders.Rem_Description,  " &
        " PrMsReminders.Rem_ReminderDate, " &
        " PrMsReminders.Rem_IsActive,  " &
        " PrMsReminders.Rem_CreatedBy, " &
        " PrMsReminders.Rem_CreatedAt, " &
        " PrMsReminders.Rem_DeactivatedBy, " &
        " PrMsReminders.Rem_DeactivatedAt,  " &
        " PrMsEmployees.TemGrp_Code " &
        " FROM PrMsReminders INNER JOIN " &
        " PrMsEmployees ON PrMsReminders.Emp_Code COLLATE Greek_CI_AS = PrMsEmployees.Emp_Code " &
        " WHERE     (PrMsEmployees.TemGrp_Code =" & enQuoteString(TempGroup) & ") " &
        " AND (Rem_ReminderDate >= " & enQuoteString(sFrom) & " " &
        " AND Rem_ReminderDate <= " & enQuoteString(sTo) & ") "

        If OnlyActive Then
            Str2 = " AND PrMsReminders.Rem_IsActive='Y' "
        End If

        Str3 = " ORDER BY Rem_ReminderDate Asc "

        Str = Str & Str2 & Str3

        Return GetData(Str)
    End Function
    Public Function CountRemindersForPeriodForTemGroup(ByVal TempGroup As String, ByVal FromDate As Date, ByVal ToDate As Date) As Integer
        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim sFrom As String = Format(FromDate, "yyyy-MM-dd")
        sFrom = Utils.ChangeDateFormatForSearch(sFrom)

        Dim sTo As String = Format(ToDate, "yyyy-MM-dd")
        sTo = Utils.ChangeDateFormatForSearch(sTo)



        Str = " Select count(*) " &
        " FROM PrMsReminders INNER JOIN " &
        " PrMsEmployees ON PrMsReminders.Emp_Code COLLATE Greek_CI_AS = PrMsEmployees.Emp_Code " &
        " WHERE     (PrMsEmployees.TemGrp_Code =" & enQuoteString(TempGroup) & ") " &
        " AND (Rem_ReminderDate >= " & enQuoteString(sFrom) & " " &
        " AND Rem_ReminderDate <= " & enQuoteString(sTo) & ") " &
        " AND PrMsReminders.Rem_IsActive='Y' "




        Str = Str & Str2
        Dim ds As DataSet
        ds = GetData(Str)
        Dim C As Integer = 0
        If CheckDataSet(ds) Then
            C = DbNullToInt(ds.Tables(0).Rows(0).Item(0))
        End If
        Return C
    End Function
    Public Function GetTrxnHeaderOfEmployeeGroupByPeriodGroup(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = "select distinct(PrdGrp_Code ),Com_Code ,TemGrp_Code  from PrTxTrxnHeader where Emp_Code = " & enQuoteString(EmpCode)
        Return GetData(Str)
    End Function
    Public Function ChangeTemplateGroupCodeOfEmployee(ByVal EmpCode As String, ByVal FromTemp As String, ByVal toTemp As String) As Boolean
        Dim Str As String
        Dim F As Boolean
        Str = "update PrTxTrxnHeader set TemGrp_Code =" & enQuoteString(toTemp) &
        " where TemGrp_Code = " & enQuoteString(FromTemp) &
        " And emp_code = " & enQuoteString(EmpCode)
        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        Else
            F = False
        End If
        Return F

    End Function
    Public Function ChangePeriodGroupCodeOfEmployee(ByVal EmpCode As String, ByVal FromPerGroup As String, ByVal ToPerGroup As String) As Boolean
        Dim Str As String
        Dim F As Boolean
        Str = "update PrTxTrxnHeader set PrdGrp_Code=" & enQuoteString(ToPerGroup) &
        " where PrdGrp_Code = " & enQuoteString(FromPerGroup) &
        " And emp_code = " & enQuoteString(EmpCode)
        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        Else
            F = False
        End If
        Return F

    End Function

    '---------------------------     IR7 GESY     -------------------------
    Protected Function REPORT_IR7_Gesy_DEDUCTION(ByVal EmpCode As String, ByVal PeriodGroupsString As String) As DataSet
        Dim Str As String = ""


        Str = " SELECT SUM( PrTxTrxnLines.TrxLin_PeriodValue)" &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsDeductionCodes ON " &
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" &
            " WHERE  (PrMsDeductionCodes.DedTyp_Code = 'GT') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_IsDirector <> '1'))" &
            " AND PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode)

        Str = Str & PeriodGroupsString

        Return GetData(Str)

    End Function
    Protected Function REPORT_IR7_Gesy_CONTRIBUTION_LWBPen(ByVal EmpCode As String, ByVal PeriodGroupsString As String) As DataSet
        Dim Str As String = ""





        Str = " SELECT SUM( PrTxTrxnLines.TrxLin_PeriodValue)" &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsDeductionCodes ON " &
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" &
            " WHERE  (PrMsDeductionCodes.DedTyp_Code = 'GD') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_LWBPen='1'))" &
            " AND PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode)

        Str = Str & PeriodGroupsString

        Return GetData(Str)

    End Function
    Protected Function REPORT_IR7_Gesy_CONTRIBUTION_Directors(ByVal EmpCode As String, ByVal PeriodGroupsString As String) As DataSet
        Dim Str As String = ""

        Str = " SELECT SUM( PrTxTrxnLines.TrxLin_PeriodValue)" &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsContributionCodes ON " &
            " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code" &
            " WHERE  (PrMsContributionCodes.ConTyp_Code = 'BC') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_IsDirector='1'))" &
            " AND PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode)

        Str = Str & PeriodGroupsString

        Return GetData(Str)

    End Function
    Protected Function REPORT_IR7_Gesy_DEDUCTION_Directors(ByVal EmpCode As String, ByVal PeriodGroupsString As String) As DataSet
        Dim Str As String = ""


        Str = " SELECT SUM( PrTxTrxnLines.TrxLin_PeriodValue)" &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsDeductionCodes ON " &
            " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code" &
            " WHERE  (PrMsDeductionCodes.DedTyp_Code = 'GT') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_IsDirector='1'))" &
            " AND PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode)

        Str = Str & PeriodGroupsString

        Return GetData(Str)


    End Function
    Protected Function REPORT_IR7_Gesy_CONTRIBUTION(ByVal EmpCode As String, ByVal PeriodGroupsString As String) As DataSet

        ''''''''''
        Dim Str As String
        Str = " SELECT SUM( PrTxTrxnLines.TrxLin_PeriodValue)" &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsContributionCodes ON " &
            " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code" &
            " WHERE  (PrMsContributionCodes.ConTyp_Code = 'BC') " &
            " AND (PrTxTrxnHeader.Emp_Code in (Select Emp_Code from PrMsEmployees where Emp_IsDirector<>'1'))" &
            " AND PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode)

        Str = Str & PeriodGroupsString

        Return GetData(Str)

    End Function
    Protected Function REPORT_IR7_OtherContributions_CONTRIBUTION(ByVal EmpCode As String, ByVal PeriodGroupsString As String) As DataSet

        ''''''''''
        Dim Str As String
        Str = " SELECT SUM( PrTxTrxnLines.TrxLin_PeriodValue)" &
            " FROM  PrTxTrxnHeader INNER JOIN" &
            " PrTxTrxnLines ON " &
            " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
            " PrMsContributionCodes ON " &
            " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code" &
            " WHERE  (PrMsContributionCodes.ConTyp_Code = 'OC') " &
            " AND PrTxTrxnHeader.Emp_Code=" & enQuoteString(EmpCode)

        Str = Str & PeriodGroupsString

        Return GetData(Str)

    End Function


    Protected Function AddURLParameters() As Boolean
        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'URL', 'SI', 'https://www.pay.sid.mlsi.gov.cy/', 'SI URL', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'URL', 'TaxisNet', 'https://taxisnet.mof.gov.cy/login.jsp', 'SI URL', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If


        Str = "INSERT INTO PrSsParameters" &
                       " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                       "VALUES     ( 'URL', 'JCC', 'https://www.jccsmart.com', 'SI URL', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If



        Return F

    End Function
    Protected Function AddURLParameters2() As Boolean
        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'URL', 'TaxPortal', 'https://taxportal.mof.gov.cy/', 'Tax Portal URL', 'Y', 'T')"


        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If





        Return F

    End Function
    Protected Function AlterCompanyName() As Boolean
        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True

        Str = "ALTER TABLE admscompany ALTER COLUMN Com_name varchar(100) NOT NULL"

        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If



        Str = "ALTER PROCEDURE [dbo].[AG_AdMsCompany_SAVE_UPDATE] " &
            "@Com_Id integer, " &
            "@Com_Code char(8), " &
            "@Com_Name varchar(100), " &
            "@Com_NameS varchar(30), " &
            "@Com_TIC varchar(12), " &
            "@Com_TaxCard  varchar(50), " &
            "@Com_SIRegNo  varchar(50), " &
            "@Com_CurSymbol  varchar(5), " &
            "@Com_Address1  varchar(100), " &
            "@Com_Address2  varchar(100), " &
            "@Com_Address3  varchar(100), " &
            "@Com_Address4  varchar(100), " &
            "@Com_Tel1  varchar(20), " &
            "@Com_Tel2  varchar(20), " &
            "@Com_Fax1  varchar(20), " &
            "@Com_Fax2  varchar(20), " &
            "@Com_AccountantPostCode  varchar(50), " &
            "@Com_AccountantPOBox  varchar(50), " &
            "@Com_AccountantTitle  varchar(50), " &
            "@Com_AccTIC  varchar(9), " &
            "@Com_AccIdentity int, " &
            "@Com_TICCategory int, " &
            "@Com_TICType  int, " &
            "@Com_BankCode varchar(3), " &
            "@Com_GLAnal1 varchar(20), " &
            "@Com_GLAnal2 varchar(20), " &
            "@Com_GLAnal3 varchar(20), " &
            "@Com_GLAnal4 varchar(20), " &
            "@Com_GLAnal5 varchar(20), " &
            "@Com_TSAccount varchar(50), " &
            "@Com_TSAccountType varchar(2), " &
            "@Com_TSBalAccount varchar(50), " &
            "@Com_TSBalAccountType varchar(2), " &
            "@Com_TSDefaultJob varchar(50), " &
            "@Com_SI2 varchar(50), " &
            "@Com_SI3 varchar(50), " &
            "@Com_SI4 varchar(50), " &
            "@Com_SI5 varchar(50), " &
            "@Com_BankCode2 varchar(50), " &
            "@Com_BankCode3 varchar(50), " &
            "@Com_BankCode4 varchar(50) " &
            " " &
            "AS " &
            "DECLARE @Result as Int " &
            "  Set @Result = 0 " &
            "  SELECT @Result = Count(*) " &
            "  FROM AdMsCompany " &
            "  WHERE Com_Id = @Com_Id " &
            "  IF(@Result IS NULL) OR (@Result=0) " &
            "    BEGIN " &
            "      INSERT INTO AdMsCompany " &
            "      (Com_Id,   " &
            "	    Com_Code, " &
            "		Com_Name, " &
            "		Com_NameS, " &
            "		Com_TIC, " &
            "		Com_TaxCard, " &
            "		Com_SIRegNo, " &
            "		Com_CurSymbol, " &
            "		Com_Address1, " &
            "		Com_Address2, " &
            "		Com_Address3, " &
            "		Com_Address4, " &
            "		Com_Tel1, " &
            "		Com_Tel2, " &
            "		Com_Fax1, " &
            "		Com_Fax2, " &
            "		Com_AccountantPostCode, " &
            "		Com_AccountantPOBox, " &
            "		Com_AccountantTitle, " &
            "       Com_AccTIC, " &
            "		Com_AccIdentity, " &
            "		Com_TICCategory, " &
            "		Com_TICType, " &
            "		Com_BankCode, " &
            "        Com_GLAnal1,  " &
            "		Com_GLAnal2,  " &
            "		Com_GLAnal3,  " &
            "		Com_GLAnal4,   " &
            "		Com_GLAnal5, " &
            "		Com_TSAccount, " &
            "		Com_TSAccountType, " &
            "		Com_TSBalAccount, " &
            "		Com_TSBalAccountType, " &
            "		Com_TSDefaultJob, " &
            "		Com_SI2, " &
            "		Com_SI3, " &
            "		Com_SI4, " &
            "		Com_SI5, " &
            "		Com_BankCode2, " &
            "       		Com_BankCode3, " &
            "               Com_BankCode4 " &
            "     ) " &
            "    VALUES ( " &
            "		@Com_Id, " &
            "		@Com_Code, " &
            "		@Com_Name, " &
            "		@Com_NameS, " &
            "		@Com_TIC, " &
            "		@Com_TaxCard, " &
            "		@Com_SIRegNo, " &
            "		@Com_CurSymbol, " &
            "		@Com_Address1, " &
            "		@Com_Address2, " &
            "		@Com_Address3, " &
            "		@Com_Address4, " &
            "		@Com_Tel1, " &
            "		@Com_Tel2, " &
            "		@Com_Fax1, " &
            "		@Com_Fax2, " &
            "		@Com_AccountantPostCode, " &
            "		@Com_AccountantPOBox, " &
            "		@Com_AccountantTitle, " &
            "		@Com_AccTIC, " &
            "		@Com_AccIdentity, " &
            "		@Com_TICCategory, " &
            "		@Com_TICType, " &
            "		@Com_BankCode, " &
            "		@Com_GLAnal1,  " &
            "		@Com_GLAnal2,  " &
            "		@Com_GLAnal3,  " &
            "		@Com_GLAnal4,  " &
            "		@Com_GLAnal5, " &
            "		@Com_TSAccount, " &
            "		@Com_TSAccountType, " &
            "		@Com_TSBalAccount, " &
            "		@Com_TSBalAccountType, " &
            "		@Com_TSDefaultJob, " &
            "		@Com_SI2, " &
            "		@Com_SI3, " &
            "		@Com_SI4, " &
            "		@Com_SI5, " &
            "		@Com_BankCode2, " &
            "		@Com_BankCode3, " &
            "		@Com_BankCode4 " &
            "     ) " &
            "      End " &
            " ELSE " &
            "       BEGIN " &
            "       UPDATE AdMsCompany " &
            "    SET  " &
            "	    Com_Code=@Com_Code, " &
            "		Com_Name=@Com_Name, " &
            "		Com_NameS=@Com_NameS, " &
            "		Com_TIC=@Com_TIC, " &
            "		Com_TaxCard=@Com_TaxCard, " &
            "		Com_SIRegNo=@Com_SIRegNo, " &
            "		Com_CurSymbol=@Com_CurSymbol, " &
            "		Com_Address1=@Com_Address1, " &
            "		Com_Address2=@Com_Address2, " &
            "		Com_Address3=@Com_Address3, " &
            "		Com_Address4=@Com_Address4, " &
            "		Com_Tel1=@Com_Tel1, " &
            "		Com_Tel2=@Com_Tel2, " &
            "		Com_Fax1=@Com_Fax1, " &
            "		Com_Fax2=@Com_Fax2, " &
            "		Com_AccountantPostCode=@Com_AccountantPostCode, " &
            "		Com_AccountantPOBox=@Com_AccountantPOBox, " &
            "		Com_AccountantTitle=@Com_AccountantTitle, " &
            "       Com_AccTIC=@Com_AccTIC, " &
            "		Com_AccIdentity=@Com_AccIdentity, " &
            "		Com_TICCategory=@Com_TICCategory, " &
            "		Com_TICType=@Com_TICType, " &
            "		Com_BankCode=@Com_BankCode, " &
            "		Com_GLAnal1=@Com_GLAnal1,  " &
            "		Com_GLAnal2=@Com_GLAnal2,  " &
            "		Com_GLAnal3=@Com_GLAnal3,  " &
            "		Com_GLAnal4=@Com_GLAnal4,  " &
            "		Com_GLAnal5=@Com_GLAnal5, " &
            "		Com_TSAccount=@Com_TSAccount, " &
            "		Com_TSAccountType=@Com_TSAccountType, " &
            "		Com_TSBalAccount=@Com_TSBalAccount, " &
            "		Com_TSBalAccountType=@Com_TSBalAccountType, " &
            "		Com_TSDefaultJob=@Com_TSDefaultJob, " &
            "		Com_SI2=@Com_SI2, " &
            "		Com_SI3=@Com_SI3, " &
            "		Com_SI4=@Com_SI4, " &
            "		Com_SI5=@Com_SI5, " &
            "		Com_BankCode2=@Com_BankCode2, " &
            "		Com_BankCode3=@Com_BankCode3, " &
            "		Com_BankCode4=@Com_BankCode4 " &
            "     WHERE Com_Id = @Com_Id " &
            "      End "

        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If


        Return F

    End Function
    Protected Function Upgrade_2020_06()


        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_CNP] varchar(16) NULL, " &
        " [Emp_TACode] varchar(16) NULL, " &
        " [Emp_HRCode] varchar(16) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
            Str = "Update PrMsEmployees set Emp_CNP = '', " &
             "Emp_TACode = '', " &
             "Emp_HRCode = '' "

            i = ExecuteNonQuery(Str)
            If i >= 0 Then
                MsgBox("Value set to ''", MsgBoxStyle.Information)
            Else
                MsgBox("Fail to set value to ''", MsgBoxStyle.Critical)
            End If

        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If


        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1), " &
        " @Emp_GESYFromSplit decimal(18,2), " &
        " @Emp_AnalGen1 varchar(20), " &
        " @Emp_Nameday varchar(10), " &
        " @Emp_IsDirector varchar(1), " &
        " @Emp_Rehire varchar(16), " &
        " @Emp_CNP varchar(16), " &
        " @Emp_TACode varchar(16), " &
        " @Emp_HRCode varchar(16) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen, " &
        " Emp_GESYFromSplit, " &
        " Emp_AnalGen1, " &
        " Emp_NameDay, " &
        " Emp_IsDirector, " &
        " Emp_Rehire, " &
        " Emp_CNP,  " &
        " Emp_TACode,  " &
        " Emp_HRCode  " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen, " &
        " @Emp_GESYFromSplit, " &
        " @Emp_AnalGen1," &
        " @Emp_Nameday, " &
        " @Emp_IsDirector, " &
        " @Emp_Rehire, " &
        " @Emp_CNP,  " &
        " @Emp_TACode,  " &
        " @Emp_HRCode  " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen, " &
        " Emp_GESYFromSplit= @Emp_GESYFromSplit, " &
        " Emp_AnalGen1 = @Emp_AnalGen1," &
        " Emp_Nameday = @Emp_NameDay, " &
        " Emp_Isdirector = @Emp_Isdirector, " &
        " Emp_Rehire = @Emp_Rehire, " &
        " Emp_CNP = @Emp_CNP,  " &
        " Emp_TACode = @Emp_TACode,  " &
        " Emp_HRCode = @Emp_HRCode  " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If






        Return True
    End Function
    Protected Function Upgrade_2020_07() As Boolean


        Dim Str As String
        Dim i As Integer
        Dim f As Boolean = True

        Str = "ALTER TABLE PrTxIr59 " &
        " ADD Rec_Gesi_Limit Decimal(18,2)," &
         " Act_Gesi_Limit Decimal(18,2)"


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrTxIr59", MsgBoxStyle.Information)
            Str = "Update PrTxIr59 set " &
             " Rec_Gesi_Limit=0," &
             " Act_Gesi_Limit=0"

            i = ExecuteNonQuery(Str)
            If i >= 0 Then
                MsgBox("Value set to '0'", MsgBoxStyle.Information)
            Else
                MsgBox("Fail to set value to '0'", MsgBoxStyle.Critical)
                f = False
            End If

        Else
            MsgBox("Fail to add New columns in PrTxIr59", MsgBoxStyle.Critical)
            f = False
        End If
        Return f
    End Function
    Protected Function Upgrade_2020_08() As Boolean


        Dim Str As String
        Dim i As Integer
        Dim f As Boolean = True

        Str = "ALTER TABLE PrMsTemplateEarnings " &
        " ADD TemErn_ReportingSequence int"
        i = ExecuteNonQuery(Str)

        Str = "ALTER TABLE PrMsTemplateDeductions " &
        " ADD TemDed_ReportingSequence int"
        i = ExecuteNonQuery(Str)

        Str = "ALTER TABLE PrMsTemplateContributions " &
        " ADD TemCon_ReportingSequence int"
        i = ExecuteNonQuery(Str)

        Str = "Update PrmsTemplateEarnings set TemErn_ReportingSequence=0"
        i = ExecuteNonQuery(Str)
        Str = "Update PrmsTemplateDeductions set TemDed_ReportingSequence=0"
        i = ExecuteNonQuery(Str)
        Str = "Update PrmsTemplateContributions set TemCon_ReportingSequence=0"
        i = ExecuteNonQuery(Str)



        Str = " ALTER PROCEDURE [dbo].[AG_PrMsTemplateContributions_SAVE_UPDATE] " &
        " @TemCon_id int, " &
        " @TemGrp_Code varchar(6), " &
        " @ConCod_Code varchar(6), " &
        " @TemCon_DisplayName nvarchar(20), " &
        " @TemCon_IsDispalyed char(1), " &
        " @TemCon_Sequence char(1), " &
        " @TemCon_TypeMode char(1), " &
        " @TemCon_FromMode char(1), " &
        " @TemCon_CreationDate smalldatetime, " &
        " @TemCon_CalcFormula varchar(20), " &
        " @TemCon_CreatedBy int, " &
        " @TemCon_AmendDate smalldatetime, " &
        " @TemCon_AmendBy int, " &
        " @TemCon_NavCreditAccount Varchar(20), " &
        " @TemCon_NavDebitAccount Varchar(20), " &
        " @TemCon_ReportingSequence int, " &
        " @NewId Int OUTPUT " &
        " AS " &
        "  DECLARE @Result as Int " &
        "  Set @Result = 0 " &
        "  SELECT @Result = Count(*) " &
        "  FROM PrMsTemplateContributions " &
        "  WHERE TemCon_id = @TemCon_id " &
        "  IF(@Result IS NULL) OR (@Result=0) " &
        "    BEGIN " &
        "      INSERT INTO PrMsTemplateContributions " &
        "     (TemGrp_Code,                                        " &
        "      ConCod_Code,                                        " &
        "      TemCon_DisplayName,                                 " &
        "      TemCon_IsDispalyed,                                 " &
        "      TemCon_Sequence,                                    " &
        "      TemCon_TypeMode,                                    " &
        "      TemCon_FromMode,                                    " &
        "      TemCon_CreationDate,                                " &
        "      TemCon_CalcFormula,                                 " &
        "      TemCon_CreatedBy,                                   " &
        "      TemCon_AmendDate,                                   " &
        "      TemCon_AmendBy, " &
        "	  TemCon_NavCreditAccount, " &
        "	  TemCon_NavDebitAccount, " &
        "      TemCon_ReportingSequence " &
        "      ) " &
        "      VALUES (  " &
        "      @TemGrp_Code,                                        " &
        "      @ConCod_Code,                                        " &
        "      @TemCon_DisplayName,                                 " &
        "      @TemCon_IsDispalyed,                                 " &
        "      @TemCon_Sequence,                                    " &
        "      @TemCon_TypeMode,                                    " &
        "      @TemCon_FromMode,                                    " &
        "      @TemCon_CreationDate,                                " &
        "      @TemCon_CalcFormula,                                 " &
        "      @TemCon_CreatedBy,                                   " &
        "      @TemCon_AmendDate,                                   " &
        "      @TemCon_AmendBy,                                       " &
        "      @TemCon_NavCreditAccount, " &
        "	  @TemCon_NavDebitAccount, " &
        "	  @TemCon_ReportingSequence " &
        "      ) " &
        "    END " &
        "  ELSE " &
        "    BEGIN " &
        "      UPDATE PrMsTemplateContributions " &
        "      SET  " &
        "      TemGrp_Code=@TemGrp_Code,                              " &
        "      ConCod_Code=@ConCod_Code,                              " &
        "      TemCon_DisplayName=@TemCon_DisplayName,                " &
        "      TemCon_IsDispalyed=@TemCon_IsDispalyed,                " &
        "      TemCon_Sequence=@TemCon_Sequence,                      " &
        "      TemCon_TypeMode=@TemCon_TypeMode,                      " &
        "      TemCon_FromMode=@TemCon_FromMode,                      " &
        "      TemCon_CreationDate=@TemCon_CreationDate,              " &
        "      TemCon_CalcFormula=@TemCon_CalcFormula,                " &
        "      TemCon_CreatedBy=@TemCon_CreatedBy,                    " &
        "     TemCon_AmendDate=@TemCon_AmendDate,                    " &
        "      TemCon_AmendBy=@TemCon_AmendBy, " &
        "      TemCon_NavCreditAccount=@TemCon_NavCreditAccount, " &
        "	  TemCon_NavDebitAccount=@TemCon_NavDebitAccount, " &
        "	  TemCon_ReportingSequence=@TemCon_ReportingSequence " &
        "      WHERE TemCon_id = @TemCon_id " &
        "  END " &
        " set @NewId=SCOPE_IDENTITY() "

        i = ExecuteNonQuery(Str)


        Str = " ALTER PROCEDURE [dbo].[AG_PrMsTemplateDeductions_SAVE_UPDATE] " &
        " @TemDed_id int, " &
        " @TemGrp_Code varchar(6), " &
        " @DedCod_Code varchar(6), " &
        " @TemDed_DisplayName nvarchar(20), " &
        " @TemDed_IsDispalyed char(1), " &
        " @TemDed_Sequence char(1), " &
        " @TemDed_TypeMode char(1), " &
        " @TemDed_FromMode char(1), " &
        " @TemDed_CreationDate smalldatetime, " &
        " @TemDed_CalcFormula varchar(20), " &
        " @TemDed_CreatedBy int, " &
        " @TemDed_AmendDate smalldatetime, " &
        " @TemDed_AmendBy int, " &
        " @TemDed_NavCreditAccount varchar(20), " &
        " @TemDed_NavDebitAccount varchar(20), " &
        " @TemDed_ReportingSequence int, " &
        " @NewId Int OUTPUT " &
        " AS " &
        "  DECLARE @Result as Int " &
        "  Set @Result = 0 " &
        "  SELECT @Result = Count(*) " &
        "  FROM PrMsTemplateDeductions " &
        "  WHERE TemDed_id = @TemDed_id " &
        "  IF(@Result IS NULL) OR (@Result=0) " &
        "    BEGIN " &
        "      INSERT INTO PrMsTemplateDeductions " &
        "     (TemGrp_Code,                                         " &
        "      DedCod_Code,                                         " &
        "      TemDed_DisplayName,                                  " &
        "      TemDed_IsDispalyed,                                  " &
        "      TemDed_Sequence,                                     " &
        "      TemDed_TypeMode,                                     " &
        "      TemDed_FromMode,                                     " &
        "      TemDed_CreationDate,                                 " &
        "      TemDed_CalcFormula,                                  " &
        "      TemDed_CreatedBy,                                    " &
        "      TemDed_AmendDate,                                    " &
        "      TemDed_AmendBy, " &
        "	  TemDed_NavCreditAccount, " &
        "	  TemDed_NavDebitAccount, " &
        "	  TemDed_ReportingSequence  " &
        "      ) " &
        "      VALUES ( " &
        "      @TemGrp_Code,                                         " &
        "      @DedCod_Code,                                         " &
        "      @TemDed_DisplayName,                                  " &
        "      @TemDed_IsDispalyed,                                  " &
        "      @TemDed_Sequence,                                     " &
        "      @TemDed_TypeMode,                                     " &
        "      @TemDed_FromMode,                                     " &
        "      @TemDed_CreationDate,                                 " &
        "      @TemDed_CalcFormula,                                  " &
        "      @TemDed_CreatedBy,                                    " &
        "      @TemDed_AmendDate,                                    " &
        "      @TemDed_AmendBy,                                       " &
        "      @TemDed_NavCreditAccount, " &
        "      @TemDed_NavDebitAccount, " &
        "      @TemDed_ReportingSequence  " &
        "      ) " &
        "    END " &
        "  ELSE " &
        "    BEGIN " &
        "      UPDATE PrMsTemplateDeductions " &
        "      SET  " &
        "      TemGrp_Code=@TemGrp_Code,                              " &
        "      DedCod_Code=@DedCod_Code,                              " &
        "      TemDed_DisplayName=@TemDed_DisplayName,                " &
        "      TemDed_IsDispalyed=@TemDed_IsDispalyed,                " &
        "      TemDed_Sequence=@TemDed_Sequence,                      " &
        "      TemDed_TypeMode=@TemDed_TypeMode,                      " &
        "      TemDed_FromMode=@TemDed_FromMode,                      " &
        "      TemDed_CreationDate=@TemDed_CreationDate,              " &
        "      TemDed_CalcFormula=@TemDed_CalcFormula,                " &
        "      TemDed_CreatedBy=@TemDed_CreatedBy,                    " &
        "      TemDed_AmendDate=@TemDed_AmendDate,                    " &
        "      TemDed_AmendBy=@TemDed_AmendBy,                         " &
        "      TemDed_NavCreditAccount=@TemDed_NavCreditAccount, " &
        "      TemDed_NavDebitAccount=@TemDed_NavDebitAccount, " &
        "      TemDed_ReportingSequence =@TemDed_ReportingSequence                         " &
        "      WHERE TemDed_id = @TemDed_id " &
        "  END " &
        "set @NewId=SCOPE_IDENTITY() "
        i = ExecuteNonQuery(Str)


        Str = " ALTER PROCEDURE [dbo].[AG_PrMsTemplateEarnings_SAVE_UPDATE] " &
    " @TemErn_id int, " &
    " @TemGrp_Code varchar(6), " &
    " @ErnCod_Code varchar(6), " &
    " @TemErn_DisplayName nvarchar(20), " &
    " @TemErn_IsDispalyed char(1), " &
    " @TemErn_Sequence char(1), " &
    " @TemErn_TypeMode char(1), " &
    " @TemErn_FromMode char(1), " &
    " @TemErn_CalcFormula varchar(20), " &
    " @TemErn_CreationDate smalldatetime, " &
    " @TemErn_CreatedBy int, " &
    " @TemErn_AmendDate smalldatetime, " &
    " @TemErn_AmendBy int, " &
    " @TemErn_NavCreditAccount varchar(20), " &
    " @TemErn_NavDebitAccount varchar(20), " &
    " @TemErn_ReportingSequence int, " &
    " @NewId Int OUTPUT " &
    " AS " &
    "  DECLARE @Result as Int " &
    "  Set @Result = 0 " &
    "  SELECT @Result = Count(*) " &
    "  FROM PrMsTemplateEarnings " &
    "  WHERE TemErn_id = @TemErn_id " &
    "  IF(@Result IS NULL) OR (@Result=0) " &
    "    BEGIN " &
    "      INSERT INTO PrMsTemplateEarnings " &
    "     (TemGrp_Code,                                         " &
    "      ErnCod_Code,                                         " &
    "      TemErn_DisplayName,                                  " &
    "      TemErn_IsDispalyed,                                  " &
    "      TemErn_Sequence,                                     " &
    "      TemErn_TypeMode,                                     " &
    "      TemErn_FromMode,                                     " &
    "      TemErn_CalcFormula,                                  " &
    "      TemErn_CreationDate,                                 " &
    "     TemErn_CreatedBy,                                    " &
    "     TemErn_AmendDate,                                    " &
    "     TemErn_AmendBy, " &
    "	  TemErn_NavCreditAccount, " &
    "	  TemErn_NavDebitAccount, " &
    "     TemErn_ReportingSequence " &
    "    ) " &
    "    VALUES ( " &
    "    @TemGrp_Code,                                         " &
    "    @ErnCod_Code,                                         " &
    "    @TemErn_DisplayName,                                  " &
    "    @TemErn_IsDispalyed,                                  " &
    "    @TemErn_Sequence,                                     " &
    "    @TemErn_TypeMode,                                     " &
    "    @TemErn_FromMode,                                     " &
    "    @TemErn_CalcFormula,                                  " &
    "    @TemErn_CreationDate,                                 " &
    "     @TemErn_CreatedBy,                                    " &
    "     @TemErn_AmendDate,                                    " &
    "     @TemErn_AmendBy,                                       " &
    "	  @TemErn_NavCreditAccount, " &
    "	  @TemErn_NavDebitAccount, " &
    "	  @TemErn_ReportingSequence " &
    "      ) " &
    "    END " &
    "  ELSE " &
    "    BEGIN " &
    "      UPDATE PrMsTemplateEarnings " &
    "      SET  " &
    "      TemGrp_Code=@TemGrp_Code,                              " &
    "      ErnCod_Code=@ErnCod_Code,                              " &
    "      TemErn_DisplayName=@TemErn_DisplayName,                " &
    "      TemErn_IsDispalyed=@TemErn_IsDispalyed,                " &
    "     TemErn_Sequence=@TemErn_Sequence,                      " &
    "     TemErn_TypeMode=@TemErn_TypeMode,                      " &
    "     TemErn_FromMode=@TemErn_FromMode,                      " &
    "     TemErn_CalcFormula=@TemErn_CalcFormula,                " &
    "     TemErn_CreationDate=@TemErn_CreationDate,              " &
    "     TemErn_CreatedBy=@TemErn_CreatedBy,                    " &
    "     TemErn_AmendDate=@TemErn_AmendDate,                    " &
    "     TemErn_AmendBy=@TemErn_AmendBy,                         " &
    "     TemErn_NavCreditAccount=@TemErn_NavCreditAccount, " &
    "	  TemErn_NavDebitAccount=@TemErn_NavDebitAccount, " &
    "	  TemErn_ReportingSequence=@TemErn_ReportingSequence                         " &
    "      WHERE TemErn_id = @TemErn_id " &
    "  END " &
    "set @NewId=SCOPE_IDENTITY() "
        i = ExecuteNonQuery(Str)


        Return True


    End Function
    Protected Function Upgrade_2020_09() As Boolean


        Dim Str As String
        Dim i As Integer
        Dim f As Boolean = True

        Str = " CREATE TABLE [dbo].[PrMsCovidTest]( " &
    "	[Cov_Id] [int] IDENTITY(1,1) NOT NULL,  " &
    "	[Emp_Code] [varchar](16) NULL, " &
    "   [TemGrp_Code] [varchar](6) NULL, " &
    "	[Com_Code] [varchar](8) NULL, " &
    "	[Cov_Date] [datetime] NULL, " &
    "	[Cov_Week] [int] NULL, " &
    "	[Cov_Month] [int] NULL, " &
    "	[Cov_Result] [varchar](20) NULL, " &
    "	[Emp_Anl1] [varchar](12) NULL, " &
    "	[Emp_Anl2] [varchar](12) NULL, " &
    "	[Emp_Anl3] [varchar](12) NULL, " &
    "	[Emp_Anl4] [varchar](12) NULL, " &
    "	[Emp_Anl5] [varchar](12) NULL, " &
    "	[Emp_GenAnal1] [varchar](20) NULL " &
    ") ON [PRIMARY] "
        i = ExecuteNonQuery(Str)

        Str = "Create PROCEDURE [dbo].[PrMsCovidTest_SAVE_UPDATE]  " &
  "@Cov_id int,   " &
  "@Emp_Code varchar(16), " &
  "@TemGrp_Code varchar(6), " &
  "@Com_Code varchar(8), " &
  "@Cov_Date datetime, " &
  "@Cov_Week int, " &
  "@Cov_Month int, " &
  "@Cov_Result varchar(20), " &
  "@Emp_Anl1 varchar(12), " &
  "@Emp_Anl2 varchar(12), " &
  "@Emp_Anl3 varchar(12), " &
  "@Emp_Anl4 varchar(12), " &
  "@Emp_Anl5 varchar(12), " &
  "@Emp_GenAnal1 varchar(20), " &
  "@NewId Int OUTPUT  AS " &
  "DECLARE @Result as Int  " &
  "Set @Result = 0    " &
  "SELECT @Result = Count(*)  " &
  "FROM PrMsCovidTest " &
  "WHERE Cov_id = @Cov_id      " &
  "IF(@Result IS NULL) OR (@Result=0)  " &
  "BEGIN      " &
  "INSERT INTO [PrMsCovidTest] " &
  "           ([Emp_Code] " &
  "           ,[TemGrp_Code] " &
  "           ,[Com_Code] " &
  "           ,[Cov_Date] " &
  "           ,[Cov_Week] " &
  "           ,[Cov_Month] " &
  "           ,[Cov_Result] " &
  "           ,[Emp_Anl1] " &
  "           ,[Emp_Anl2] " &
  "           ,[Emp_Anl3] " &
  "           ,[Emp_Anl4] " &
  "           ,[Emp_Anl5] " &
  "           ,[Emp_GenAnal1]) " &
  "     VALUES " &
  "           (@Emp_Code, " &
  "           @TemGrp_Code, " &
  "           @Com_Code, " &
  "           @Cov_Date, " &
  "           @Cov_Week, " &
  "           @Cov_Month, " &
  "           @Cov_Result, " &
  "           @Emp_Anl1, " &
  "           @Emp_Anl2, " &
  "           @Emp_Anl3, " &
  "           @Emp_Anl4, " &
  "           @Emp_Anl5, " &
  "           @Emp_GenAnal1) " &
  "END  " &
  "ELSE " &
  "BEGIN " &
  "UPDATE [PrMsCovidTest] " &
  "   SET [Emp_Code] = @Emp_Code, " &
  "      [TemGrp_Code] = @TemGrp_Code, " &
  "      [Com_Code] = @Com_Code,  " &
  "      [Cov_Date] = @Cov_Date, " &
  "      [Cov_Week] = @Cov_Week, " &
  "      [Cov_Month] = @Cov_Month,  " &
  "      [Cov_Result] = @Cov_Result, " &
  "      [Emp_Anl1] = @Emp_Anl1,  " &
  "      [Emp_Anl2] = @Emp_Anl2,  " &
  "      [Emp_Anl3] = @Emp_Anl3,  " &
  "      [Emp_Anl4] = @Emp_Anl4,  " &
  "      [Emp_Anl5] = @Emp_Anl5,  " &
  "      [Emp_GenAnal1] = @Emp_GenAnal1  " &
  " WHERE Cov_Id=@Cov_id " &
  "END set @NewId=SCOPE_IDENTITY()   "


        i = ExecuteNonQuery(Str)





        Return True


    End Function
    Protected Function Upgrade_2021_10()


        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_TermReason] varchar(2) NULL, " &
        " [Emp_HireReason] varchar(2) NULL "



        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
            Str = "Update PrMsEmployees set Emp_TermReason = '', " &
             "Emp_HireReason = '' "


            i = ExecuteNonQuery(Str)
            If i >= 0 Then
                MsgBox("Value set to ''", MsgBoxStyle.Information)
            Else
                MsgBox("Fail to set value to ''", MsgBoxStyle.Critical)
            End If

        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If


        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1), " &
        " @Emp_GESYFromSplit decimal(18,2), " &
        " @Emp_AnalGen1 varchar(20), " &
        " @Emp_Nameday varchar(10), " &
        " @Emp_IsDirector varchar(1), " &
        " @Emp_Rehire varchar(16), " &
        " @Emp_CNP varchar(16), " &
        " @Emp_TACode varchar(16), " &
        " @Emp_HRCode varchar(16), " &
        " @Emp_TermReason varchar(2), " &
        " @Emp_HireReason varchar(2) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen, " &
        " Emp_GESYFromSplit, " &
        " Emp_AnalGen1, " &
        " Emp_NameDay, " &
        " Emp_IsDirector, " &
        " Emp_Rehire, " &
        " Emp_CNP,  " &
        " Emp_TACode,  " &
        " Emp_HRCode,  " &
        " Emp_TermReason,  " &
        " Emp_HireReason  " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen, " &
        " @Emp_GESYFromSplit, " &
        " @Emp_AnalGen1," &
        " @Emp_Nameday, " &
        " @Emp_IsDirector, " &
        " @Emp_Rehire, " &
        " @Emp_CNP,  " &
        " @Emp_TACode,  " &
        " @Emp_HRCode,  " &
        " @Emp_TermReason,  " &
        " @Emp_HireReason  " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen, " &
        " Emp_GESYFromSplit= @Emp_GESYFromSplit, " &
        " Emp_AnalGen1 = @Emp_AnalGen1," &
        " Emp_Nameday = @Emp_NameDay, " &
        " Emp_Isdirector = @Emp_Isdirector, " &
        " Emp_Rehire = @Emp_Rehire, " &
        " Emp_CNP = @Emp_CNP,  " &
        " Emp_TACode = @Emp_TACode,  " &
        " Emp_HRCode = @Emp_HRCode,  " &
        " Emp_TermReason = @Emp_TermReason,  " &
        " Emp_HireReason = @Emp_HireReason  " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If






        Return True
    End Function
    Protected Function Upgrade2021_11() As Boolean

        Dim Str As String
        Dim i As Integer
        Str = " ALTER TABLE PrTxEmployeeSalary " &
        " ADD [EmpSal_RateSalary] decimal(18, 2) "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrTxEmployeeSalary", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxEmployeeSalary", MsgBoxStyle.Critical)
        End If


        Str = " ALTER PROCEDURE [dbo].[AG_PrTxEmployeeSalary_SAVE_UPDATE] " &
        " @EmpSal_id int, " &
        " @Emp_Code varchar(16), " &
        " @EmpSal_Date smalldatetime, " &
        " @EmpSal_Value decimal(10,2), " &
        " @EmpSal_Basic decimal(10,2), " &
        " @EmpSal_EffPayDate smalldatetime, " &
        " @EmpSal_EffArrearsDate smalldatetime, " &
        " @EmpSal_Cola decimal(10,2), " &
        " @Usr_Id int, " &
        " @EmpSal_IsCola char(1), " &
        " @EmpSal_Dif decimal(10,2), " &
        " @EmpSal_Rate decimal(18,4), " &
        " @EmpSal_RateSalary decimal(18,2), " &
        " @NewId Int OUTPUT " &
        " AS " &
        "  DECLARE @Result as Int " &
        "  Set @Result = 0 " &
        "  SELECT @Result = Count(*) " &
        "  FROM PrTxEmployeeSalary " &
        "  WHERE EmpSal_id = @EmpSal_id " &
        "  IF(@Result IS NULL) OR (@Result=0) " &
        "    BEGIN " &
        "      INSERT INTO PrTxEmployeeSalary " &
        "     (Emp_Code,  " &
        "      EmpSal_Date,  " &
        "      EmpSal_Value,  " &
        "      EmpSal_Basic,   " &
        "      EmpSal_EffPayDate,  " &
        "      EmpSal_EffArrearsDate,  " &
        "      EmpSal_Cola,  " &
        "      Usr_Id,  " &
        "      EmpSal_IsCola,  " &
        "      EmpSal_Dif,  " &
        "      EmpSal_Rate, " &
        "      EmpSal_RateSalary " &
        "      ) " &
        "      VALUES (  " &
        "      @Emp_Code,  " &
        "      @EmpSal_Date,  " &
        "      @EmpSal_Value,   " &
        "      @EmpSal_Basic,    " &
        "      @EmpSal_EffPayDate, " &
        "      @EmpSal_EffArrearsDate,  " &
        "      @EmpSal_Cola,   " &
        "      @Usr_Id,  " &
        "      @EmpSal_IsCola,  " &
        "      @EmpSal_Dif,  " &
        "      @EmpSal_Rate, " &
        "      @EmpSal_RateSalary " &
        "      )  " &
        "    END  " &
        "  ELSE  " &
        "    BEGIN  " &
        "      UPDATE PrTxEmployeeSalary " &
        "      SET  " &
        "      Emp_Code=@Emp_Code,  " &
        "      EmpSal_Date=@EmpSal_Date,  " &
        "      EmpSal_Value=@EmpSal_Value,  " &
        "      EmpSal_Basic=@EmpSal_Basic,   " &
        "      EmpSal_EffPayDate=@EmpSal_EffPayDate,  " &
        "      EmpSal_EffArrearsDate=@EmpSal_EffArrearsDate,  " &
        "      EmpSal_Cola=@EmpSal_Cola,  " &
        "      Usr_Id=@Usr_Id,  " &
        "      EmpSal_IsCola=@EmpSal_IsCola,  " &
        "      EmpSal_Dif=@EmpSal_Dif,  " &
        "      EmpSal_Rate=@EmpSal_Rate,  " &
        "      EmpSal_RateSalary=@EmpSal_RateSalary  " &
        "      WHERE EmpSal_id = @EmpSal_id " &
        "  END " &
        " set @NewId=SCOPE_IDENTITY() "

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxEmployeeSalary was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Update SP PrTxEmployeeSalary", MsgBoxStyle.Critical)
        End If
        Return Proceed
    End Function

    Protected Function GetLoanComments(ByVal LoanCode As String) As DataSet
        Dim Str As String
        Str = " SELECT Lne_Id, " &
        " Emp_Code,  " &
        " Lne_Code, " &
        " Lne_Date, " &
        " Lne_Amount, " &
        " Lne_Comment, " &
        " Lne_Type,  " &
        " Lne_ChequeNo " &
        " FROM PrTxLoanComments " &
        " Where Lne_Code= " & enQuoteString(LoanCode) &
        " Order by Lne_Date Desc"

        Return GetData(Str)

    End Function
    Protected Function SearchForAnnualLeaveOfHeaderId(ByVal HdrId As Integer) As Boolean
        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = False
        Str = "Select * FROM PrTxEmployeeLeave WHERE Hdr_id=" & HdrId
        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            F = True
        End If


        Return F

    End Function
    Protected Function GetEmployeeIBANS(ByVal TemplateGroup As String, ByVal OnlyActive As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String

        Str = "SELECT Emp_Code," &
            " Emp_FullName, " &
            " Emp_Status, " &
            " Bnk_Code," &
            " Emp_BankAccount," &
            " Emp_IBAN," &
            " Bnk_CodeCo," &
            " Emp_BankAccountCo" &
            " FROM PrMsEmployees" &
            " WHERE (TemGrp_Code = " & enQuoteString(TemplateGroup) & ")"
        If OnlyActive Then
            Str2 = " AND (Emp_Status ='A')"
        End If

        Str = Str & Str2


        Return GetData(Str)
    End Function
    Protected Function GetLastPeriodGroupOfTemplateGroup(ByVal TempGrpCode As String) As String
        Dim Str As String
        Dim PerGroup As String = ""
        Str = " SELECT " &
            " PrdGrp_Code," &
            " PrdGrp_Status," &
            " PrdGpr_Year," &
            " TemGrp_Code," &
            " PrdGrp_DescriptionL" &
            " FROM PrMsPeriodGroups " &
        " Where TemGrp_Code=" & enQuoteString(TempGrpCode) &
        " AND PrdGpr_Year = " &
        "(SELECT max(PrdGpr_Year)" &
        " FROM PrMsPeriodGroups " &
        " Where TemGrp_Code=" & enQuoteString(TempGrpCode) & ")"
        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            PerGroup = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
        End If
        Return PerGroup
    End Function
    Protected Function GetNextAnalysisCode(ByVal Analysis As String) As String
        Dim Str As String
        Dim Code As String = 0
        Dim CodeLen As Integer
        Dim CodeInt As Integer
        Dim Ds As DataSet
        Select Case Analysis
            Case 1
                Str = "select MAX(EmpAn1_code) from PrAnEmployeeAnalysis1"
            Case 2
                Str = "select MAX(EmpAn2_code) from PrAnEmployeeAnalysis2"
            Case 3
                Str = "select MAX(EmpAn3_code) from PrAnEmployeeAnalysis3"
            Case 4
                Str = "select MAX(EmpAn4_code) from PrAnEmployeeAnalysis4"
            Case 5
                Str = "select MAX(EmpAn5_code) from PrAnEmployeeAnalysis5"

        End Select

        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Code = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
            CodeLen = 4
            Try
                Dim S As Integer = CInt(Code)
            Catch ex As Exception
                Code = "0000"
            End Try
        Else
            Code = "0000"
        End If

        Try
            CodeInt = CInt(Code)
            CodeInt = CodeInt + 1
            Code = CodeInt.ToString
            Code = Code.PadLeft(CodeLen, "0")
        Catch ex As Exception

        End Try


        Return Code
    End Function
    Public Function GetNextAvailableCode(ByVal Prefix As String, ByVal TemplateGroup As String) As String
        Dim Str As String
        Dim N As String
        Str = "select max(Emp_Code) from prmsEmployees where temGrp_Code=" & enQuoteString(TemplateGroup)
        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Dim S As String

            S = DbNullToString(Ds.Tables(0).Rows(0).Item(0))
            If Prefix <> "" Then
                S = S.Replace(Prefix, "")
            End If

            If IsNumeric(S) Then
                N = CInt(S) + 1
                N = N.PadLeft(S.Length, "0")
                N = Prefix & N
            Else
                N = "00001"
            End If
        Else
            N = "00001"
        End If
        Return N

    End Function
    Public Shadows Function CheckForLicence(ByVal EncryptedSerialNo As String) As DataSet
        Dim Str As String

        Str = "Select Prlc_Desc," &
        " PrLc_Lc " &
        " from PrLcValues " &
        " Where PrLc_Lc =" & enQuoteString(EncryptedSerialNo)

        Dim Ds As DataSet
        Ds = GetData(Str)
        Return Ds
    End Function

    Protected Function DeletePeriodCode(ByVal Per As cPrMsPeriodCodes) As Boolean
        Dim F As Boolean = False
        Dim Str As String
        Str = "Select * from PrTxtrxnheader where prdcod_code=" & enQuoteString(Per.Code) &
        " and prdgrp_code=" & enQuoteString(Per.PrdGrpCode)
        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            MsgBox("There are Transactions for this Period, Cannot Delete Period with Transactions/Payslips", MsgBoxStyle.Critical)
        Else
            Try
                Str = "delete from PrMsPeriodEarnings " &
               " where PrdCod_Code =" & enQuoteString(Per.Code) &
                " and PrdGrp_Code =" & enQuoteString(Per.PrdGrpCode)
                MyBase.ExecuteNonQuery(Str)
                Str = "delete from PrMsPeriodDeductions " &
                " where PrdCod_Code =" & enQuoteString(Per.Code) &
                " and PrdGrp_Code =" & enQuoteString(Per.PrdGrpCode)
                MyBase.ExecuteNonQuery(Str)
                Str = "delete from PrMsPeriodcontributions " &
                " where PrdCod_Code =" & enQuoteString(Per.Code) &
                " and PrdGrp_Code =" & enQuoteString(Per.PrdGrpCode)
                MyBase.ExecuteNonQuery(Str)
                Str = "delete from PrMsPeriodCodes " &
                " where PrdCod_Code =" & enQuoteString(Per.Code) &
                " and PrdGrp_Code =" & enQuoteString(Per.PrdGrpCode)
                MyBase.ExecuteNonQuery(Str)
            Catch ex As Exception
                Utils.ShowException(ex)
                F = False
            End Try

            F = True
        End If
        Return F
    End Function
    Protected Function GetAllPrMsEmployeeCovidTestByEmpCode(ByVal EmpCode As String) As DataSet
        Dim Str As String
        Str = " SELECT Cov_Id, " &
        " Emp_Code, " &
        " TemGrp_Code, " &
        " Com_Code, " &
        " Cov_Date,  " &
        " Cov_Week,  " &
        " Cov_Month, " &
        " Cov_Result,  " &
        " Emp_Anl1,  " &
        " Emp_Anl2, " &
        " Emp_Anl3, " &
        " Emp_Anl4,  " &
        " Emp_Anl5,  " &
        " Emp_GenAnal1 " &
        " FROM PrMsCovidTest " &
        " Where Emp_code= " & enQuoteString(EmpCode) &
        " Order by Cov_Date Desc"

        Return GetData(Str)
    End Function
    Protected Function GetEmployeeCovidTestResult(ByVal TempGroup As String, ByVal DateFrom As Date, ByVal DateTo As Date, ByVal onlyactive As Boolean) As DataSet
        Dim Str As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""


        Dim Dfrom As String = Format(DateFrom, "yyyy-MM-dd")
        Dfrom = Utils.ChangeDateFormatForSearch(Dfrom)
        Dim DTo As String = Format(DateTo, "yyyy-MM-dd")
        DTo = Utils.ChangeDateFormatForSearch(DTo)





        Str = " SELECT     " &
        " PrMsCovidTest.Cov_Date, " &
        " PrMsCovidTest.Emp_Code,  " &
        " PrMsEmployees.Emp_FullName, " &
        " CASE WHEN  PrMsCovidTest.Cov_Result=1 then 'YES' ELSE 'NO' END AS isNegative," &
        " PrMsCovidTest.TemGrp_Code, " &
        " PrMsCovidTest.Com_Code, " &
        " PrMsCovidTest.Cov_Week,  " &
        " PrMsCovidTest.Cov_Month, " &
        " PrMsCovidTest.Emp_Anl1, " &
        " PrAnEmployeeAnalysis1.EmpAn1_DescriptionL,  " &
        " PrMsCovidTest.Emp_Anl2, " &
        " PrAnEmployeeAnalysis2.EmpAn2_DescriptionL, " &
        " PrMsCovidTest.Emp_Anl3, " &
        " PrAnEmployeeAnalysis3.EmpAn3_DescriptionL,  " &
        " PrMsCovidTest.Emp_Anl4,  " &
        " PrAnEmployeeAnalysis4.EmpAn4_DescriptionL,  " &
        " PrMsCovidTest.Emp_Anl5, " &
        " PrAnEmployeeAnalysis5.EmpAn5_DescriptionL, " &
        " PrMsCovidTest.Emp_GenAnal1 " &
        " FROM PrMsCovidTest INNER JOIN " &
        " PrMsEmployees ON PrMsCovidTest.Emp_Code COLLATE Greek_CI_AS = PrMsEmployees.Emp_Code INNER JOIN " &
        " PrAnEmployeeAnalysis1 ON PrMsEmployees.EmpAn1_Code = PrAnEmployeeAnalysis1.EmpAn1_Code INNER JOIN " &
        " PrAnEmployeeAnalysis2 ON PrMsEmployees.EmpAn2_Code = PrAnEmployeeAnalysis2.EmpAn2_Code INNER JOIN " &
        " PrAnEmployeeAnalysis3 ON PrMsEmployees.EmpAn3_Code = PrAnEmployeeAnalysis3.EmpAn3_Code INNER JOIN " &
        " PrAnEmployeeAnalysis4 ON PrMsEmployees.EmpAn4_Code = PrAnEmployeeAnalysis4.EmpAn4_Code INNER JOIN " &
        " PrAnEmployeeAnalysis5 ON PrMsEmployees.EmpAn5_Code = PrAnEmployeeAnalysis5.EmpAn5_Code  " &
        " Where PrMsCovidTest.TemGrp_Code=" & enQuoteString(TempGroup) &
        " AND PrMsCovidTest.Cov_Date >=" & enQuoteString(Dfrom) &
        " AND PrMsCovidTest.Cov_Date <=" & enQuoteString(DTo)

        If onlyactive Then
            Str2 = " AND   PrMsEmployees.Emp_Status='A' "
        End If

        Str3 = " Order by PrMsCovidTest.Cov_Date Asc"

        Str = Str & Str2 & Str3


        Return GetData(Str)
    End Function
    Protected Function SetNewEmployeeToFalse() As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = "Update prMsemployees set Emp_NewEmployee=0 where Emp_NewEmployee=1"
        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        End If
        Return F
    End Function
    Protected Function SetGeneralAnalysis1ValueToAnaysis2() As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = "Update prMsemployees set Emp_analgen1=empan2_code"
        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        End If
        Return F
    End Function
    Protected Function ChangeEarningDescriptionOnLines(ByVal ErnCode As String, ByVal TempCode As String, ByVal NewDescription As String) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = "UPDATE PrTxTrxnLines set TrxLin_EDCdescription=" & enQuoteString(NewDescription) &
        " where TrxHdr_Id in " &
        " (Select TrxHdr_Id from PrTxTrxnHeader where TemGrp_Code =" & enQuoteString(TempCode) &
        " AND (TrxHdr_Status ='CALC' or TrxHdr_Status ='PREP'))" &
        " AND ErnCod_Code =" & enQuoteString(ErnCode) &
        " AND TrxLin_Type ='E'"

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        End If
        Return F
    End Function
    Protected Function ChangeDeductionDescriptionOnLines(ByVal DedCode As String, ByVal TempCode As String, ByVal NewDescription As String) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = "UPDATE PrTxTrxnLines set TrxLin_EDCdescription=" & enQuoteString(NewDescription) &
        " where TrxHdr_Id in " &
        " (Select TrxHdr_Id from PrTxTrxnHeader where TemGrp_Code =" & enQuoteString(TempCode) &
        " AND (TrxHdr_Status ='CALC' or TrxHdr_Status ='PREP'))" &
        " AND DedCod_Code =" & enQuoteString(DedCode) &
        " AND TrxLin_Type ='D'"

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        End If
        Return F
    End Function
    Protected Function ChangeContributionDescriptionOnLines(ByVal ConCode As String, ByVal TempCode As String, ByVal NewDescription As String) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = "UPDATE PrTxTrxnLines set TrxLin_EDCdescription=" & enQuoteString(NewDescription) &
        " where TrxHdr_Id in " &
        " (Select TrxHdr_Id from PrTxTrxnHeader where TemGrp_Code =" & enQuoteString(TempCode) &
        " AND (TrxHdr_Status ='CALC' or TrxHdr_Status ='PREP'))" &
        " AND ConCod_Code =" & enQuoteString(ConCode) &
        " AND TrxLin_Type ='C'"

        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            F = True
        End If
        Return F
    End Function
    Protected Function CheckforCalcPayslipsForEmployee(ByVal EmpCode As String) As Boolean
        Dim Str As String
        Dim F As Boolean = False
        Str = "Select * from prtxtrxnheader where emp_code=" & enQuoteString(EmpCode) & " And TrxHdr_Status='CALC'"
        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            F = True
        End If
        Return F
    End Function
    Public Shadows Function FindnumberofPeriodsOnCompanyLevelForThisPeriodGroup(ByVal PerGroup As cPrMsPeriodGroups, ByVal TempGroup As cPrMsTemplateGroup) As Integer
        Dim Str As String
        Dim MaxPeriods As Integer
        Str = "select COUNT(*) from PrMsPeriodCodes " &
        " where PrdGrp_Code in " &
        "(select prdgrp_code from PrMsPeriodGroups where TemGrp_Code in (" &
        " select TemGrp_Code  from PrMsTemplateGroup where Com_Code =" & enQuoteString(TempGroup.CompanyCode) &
        " ) and PrdGpr_Year = " & enQuoteString(PerGroup.Year) & ")" &
        " group by Prdgrp_Code "

        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Dim i As Integer
            Dim k As Integer = 0
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                k = DbNullToInt(Ds.Tables(0).Rows(i).Item(0))
                If k > MaxPeriods Then
                    MaxPeriods = k
                End If
            Next
        End If
        If MaxPeriods > 13 Then
            MaxPeriods = 13
        End If
        Return MaxPeriods
    End Function
    Public Shadows Function Set50PercAmountto55000() As Boolean
        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True

        Str = "INSERT INTO PrSsParameters" &
                " ( Par_Section, Par_Item, Par_Value, Par_Description, Par_System, Par_Type)" &
                "VALUES     ( 'System', '50PercAmount', '55000', '50% rule Amount', 'Y', 'T')"
        i = MyBase.ExecuteNonQuery(Str)
        If i <= 0 Then
            F = False
        End If
        Return F
    End Function
    Protected Function GetEmployeeDetailsForPrinting1(ByVal OnlyActive As Boolean, ByVal SelectedEmployeeCode As String) As DataSet
        Dim Str2 As String
        Dim Str3 As String
        Dim Str4 As String
        Dim Ds As DataSet
        Ds = GetAllPrMsTemplateGroupOfUser(Global1.UserName)
        If CheckDataSet(Ds) Then
            Dim i As Integer
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                If i = 0 Then
                    Str2 = " where (TemGrp_Code =" & enQuoteString(Ds.Tables(0).Rows(i).Item(0))
                Else
                    Str2 = Str2 & " or TemGrp_Code =" & enQuoteString(Ds.Tables(0).Rows(i).Item(0))
                End If

            Next

            Str2 = Str2 & " )"

        End If
        If OnlyActive Then
            If Str2 = "" Then
                Str3 = " Where Emp_status = 'A'"
            Else
                Str3 = " AND Emp_status = 'A'"
            End If
        End If
        If SelectedEmployeeCode <> "" Then
            If Str2 = "" And Str3 = "" Then
                Str4 = " Where Emp_Code = " & enQuoteString(SelectedEmployeeCode)
            Else
                Str4 = " AND Emp_Code = " & enQuoteString(SelectedEmployeeCode)
            End If
        End If

        Dim Str As String
        Str = " SELECT PrMsEmployees.Emp_Code,   " &
       " Emp_Status,   " &
       " PayTyp_Code,   " &
       " TemGrp_Code,   " &
       " EmpSta_Code,    " &
       " Emp_Title,   " &
       " Emp_LastName,    " &
       " Emp_FirstName,   " &
       " Emp_FullName,   " &
       " Emp_Sex,   " &
       " Emp_BirthDate,    " &
       " MarSta_Code,   " &
       " Emp_Address1,   " &
       " Emp_Address2,    " &
       " Emp_Address3,   " &
       " Emp_PostCode,   " &
       " Emp_Telephone1,   " &
       " Emp_Telephone2,   " &
       " Emp_Email,   " &
       " Emp_SocialInsNumber,    " &
       " ComSin_EmpSocialInsNo,   " &
       " Emp_IdentificationCard,    " &
       " Emp_TaxID,   " &
       " Emp_PassportNumber,   " &
       " Emp_AlienNumber,   " &
       " TicTyp_Code,    " &
       " EmpAn1_Code,   " &
       " EmpAn2_Code,    " &
       " EmpAn3_Code,    " &
       " EmpAn4_Code,   " &
       " EmpAn5_Code,   " &
       " Uni_Code,    " &
       " Cou_Code,    " &
       " EmpPos_Code,    " &
       " Sic_Code,    " &
       " EmpCmm_Code,    " &
       " PayUni_Code,    " &
       " Emp_PeriodUnits,   " &
       " Emp_AnnualUnits,    " &
       " Cur_Code,   " &
       " PmtMth_Code,    " &
       " Bnk_Code,    " &
       " Emp_BankAccount,   " &
       " Bnk_CodeCo,   " &
       " Emp_BankAccountCo,   " &
       " Emp_StartDate,   " &
       " Emp_TerminateDate,   " &
       " Emp_OtherIncome1,    " &
       " Emp_OtherIncome2,   " &
       " Emp_OtherIncome3,   " &
       " Emp_PreviousEarnings,   " &
       " Emp_PrevSIDeduct,   " &
       " Emp_PrevSIContribute,   " &
       " Emp_PrevITDeduct,   " &
       " Emp_PrevPFDeduct,    " &
       " Emp_PrevGesiD,    " &
       " Emp_PrevGesiC,    " &
       " ProFnd_Code,    " &
       " MedFnd_Code,   " &
       " SocInc_Code,   " &
       " Ind_Code,   " &
       " Une_Code,   " &
       " SocCoh_Code,   " &
       " Emp_CreationDate,   " &
       " Emp_CreatedBy,    " &
       " Emp_AmendDate,   " &
       " Emp_AmendBy,    " &
       " IntTem_Code,    " &
       " Emp_GLAnal1,    " &
       " Emp_GLAnal2,   " &
       " Emp_GLAnal3,   " &
       " Emp_GLAnal4,    " &
       " IntTem_PFCode,   " &
       " IntTem_MFCode,   " &
       " Emp_PensionNo,   " &
       " Emp_DrivingLicense,   " &
       " Emp_HasSI,    " &
       " Emp_PensionType,   " &
       " Emp_MyPayslipREPort,   " &
       " Emp_IBAN,   " &
       " Emp_PreviousLifeIns,    " &
       " EMp_PreviousDis,   " &
       " Emp_PreviousST,   " &
       " Emp_OtherIncome4,    " &
       " SecPay_Code,    " &
       " ComRat_Code,    " &
       " PerBon_Code,    " &
       " DutHou_Code,   " &
       " FliHou_Code,    " &
       " Emp_PassFullName,    " &
       " Emp_TravelDocs,    " &
       " Emp_FirstEmployment,   " &
       " OveLay_Code,   " &
       " Emp_Password,    " &
       " Emp_Splitemployement,   " &
       " Emp_NewEmployee,   " &
       " Emp_Force50Percent,    " &
       " Emp_Notes,    " &
       " Emp_BankBenName,    " &
       " Emp_AgreedSalary,    " &
       " Emp_BonusOnSalary,    " &
       " Emp_TaxForSplit,    " &
       " Emp_50PerOff,   " &
       " Emp_PrevMF,    " &
       " Emp_PrevPenF,   " &
       " Emp_50PerOff, " &
       " Ges_Code, " &
       " Emp_PrevGesiD," &
       " Emp_PrevGesiC, " &
       " Emp_LWBPen, " &
       " Emp_GESYFromSplit, " &
       " Emp_AnalGen1, " &
       " Emp_NameDay, " &
       " Emp_IsDirector, " &
       " Emp_Rehire, " &
       " Emp_CNP, " &
       " Emp_TACode, " &
       " Emp_HRCode, " &
       " Emp_TermReason, " &
       " Emp_HireReason, " &
       " 0.00 as Salary, " &
       " '' as Birthdate1, " &
       " '' as StartDate1 " &
       " FROM PrMsEmployees "


        Str = Str & Str2 & Str3 & Str4


        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            Dim i As Integer
            Dim EmpCode As String = ""
            Dim Date1 As Date = Now.Date
            Dim Sal As cPrTxEmployeeSalary
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                EmpCode = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
                Sal = GetCurrentSalary(EmpCode, Date1)
                If Sal.Id <> 0 Then
                    Ds.Tables(0).Rows(i).Item(120) = Sal.SalaryValue
                End If
                If DbNullToString(Ds.Tables(0).Rows(i).Item(9)) = "M" Then
                    Ds.Tables(0).Rows(i).Item(9) = "MALE"
                Else
                    Ds.Tables(0).Rows(i).Item(9) = "FEMALE"
                End If
                If DbNullToString(Ds.Tables(0).Rows(i).Item(40)) = "1" Then
                    Ds.Tables(0).Rows(i).Item(40) = "CASH"
                ElseIf DbNullToString(Ds.Tables(0).Rows(i).Item(40)) = "2" Then
                    Ds.Tables(0).Rows(i).Item(40) = "CHEQUE"
                ElseIf DbNullToString(Ds.Tables(0).Rows(i).Item(40)) = "3" Then
                    Ds.Tables(0).Rows(i).Item(40) = "BANK TRANSFER"
                Else
                    Ds.Tables(0).Rows(i).Item(40) = "E-WALLET"
                End If
                Dim TermDate As String
                TermDate = DbNullToString(Ds.Tables(0).Rows(i).Item(46))
                If TermDate <> "" Then
                    TermDate = Replace(TermDate, "/", "-")
                    Ds.Tables(0).Rows(i).Item(46) = TermDate
                End If
                Dim S As String
                Dim dd As Date
                S = DbNullToDate(Ds.Tables(0).Rows(i).Item(10))
                dd = DbNullToDate(Ds.Tables(0).Rows(i).Item(10))
                S = Format(dd, "yyyy/MM/dd")
                Ds.Tables(0).Rows(i).Item(121) = S

                S = DbNullToDate(Ds.Tables(0).Rows(i).Item(45))
                dd = DbNullToDate(Ds.Tables(0).Rows(i).Item(45))
                S = Format(dd, "yyyy/MM/dd")
                Ds.Tables(0).Rows(i).Item(122) = S

                Dim Pos As String
                Pos = DbNullToString(Ds.Tables(0).Rows(i).Item(33))
                Dim Poss As New cPrAnEmployeePositions(Pos)
                Ds.Tables(0).Rows(i).Item(33) = Poss.DescriptionL

            Next
        End If



        Return Ds
    End Function
    Protected Function Upgrade_2022_01()


        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_Photo] image NULL "




        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If


        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1), " &
        " @Emp_GESYFromSplit decimal(18,2), " &
        " @Emp_AnalGen1 varchar(20), " &
        " @Emp_Nameday varchar(10), " &
        " @Emp_IsDirector varchar(1), " &
        " @Emp_Rehire varchar(16), " &
        " @Emp_CNP varchar(16), " &
        " @Emp_TACode varchar(16), " &
        " @Emp_HRCode varchar(16), " &
        " @Emp_TermReason varchar(2), " &
        " @Emp_HireReason varchar(2), " &
        " @Emp_Photo image " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen, " &
        " Emp_GESYFromSplit, " &
        " Emp_AnalGen1, " &
        " Emp_NameDay, " &
        " Emp_IsDirector, " &
        " Emp_Rehire, " &
        " Emp_CNP,  " &
        " Emp_TACode,  " &
        " Emp_HRCode,  " &
        " Emp_TermReason,  " &
        " Emp_HireReason,  " &
        " Emp_Photo  " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen, " &
        " @Emp_GESYFromSplit, " &
        " @Emp_AnalGen1," &
        " @Emp_Nameday, " &
        " @Emp_IsDirector, " &
        " @Emp_Rehire, " &
        " @Emp_CNP,  " &
        " @Emp_TACode,  " &
        " @Emp_HRCode,  " &
        " @Emp_TermReason,  " &
        " @Emp_HireReason,  " &
        " @Emp_Photo  " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen, " &
        " Emp_GESYFromSplit= @Emp_GESYFromSplit, " &
        " Emp_AnalGen1 = @Emp_AnalGen1," &
        " Emp_Nameday = @Emp_NameDay, " &
        " Emp_Isdirector = @Emp_Isdirector, " &
        " Emp_Rehire = @Emp_Rehire, " &
        " Emp_CNP = @Emp_CNP,  " &
        " Emp_TACode = @Emp_TACode,  " &
        " Emp_HRCode = @Emp_HRCode,  " &
        " Emp_TermReason = @Emp_TermReason,  " &
        " Emp_HireReason = @Emp_HireReason,  " &
        " Emp_Photo = @Emp_Photo  " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If






        Return True
    End Function
    Protected Function Upgrade2022_02() As Boolean

        Dim Str As String
        Dim i As Integer
        Str = " ALTER TABLE PrTxEmployeeLeave " &
        " ADD [EmpLea_Comment] Varchar(100) "

        i = ExecuteNonQuery(Str)
        If i < 0 Then
            MsgBox("Fail to add New columns in PrTxEmployeeLeave", MsgBoxStyle.Critical)
        End If

        Str = " ALTER TABLE PrTxEmployeeLeave " &
        " ADD [EmpLea_ApprovedBy] Varchar(50) "

        i = ExecuteNonQuery(Str)
        If i < 0 Then
            MsgBox("Fail to add New columns in PrTxEmployeeLeave", MsgBoxStyle.Critical)
        End If


        Str = " ALTER PROCEDURE [dbo].[AG_PrTxEmployeeLeave_SAVE_UPDATE] " &
        " @EmpLea_id int,   " &
        " @EmpLea_Status varchar(20),  " &
        " @Emp_Code varchar(16),  " &
        " @EmpLea_Type varchar(30), " &
        " @EmpLea_ReqDate smalldatetime,  " &
        " @EmpLea_ProcDate smalldatetime, " &
        " @EmpLea_ProcBy int,  " &
        " @EmpLea_FromDate smalldatetime, " &
        " @EmpLea_ToDate smalldatetime, " &
        " @EmpLea_Units decimal(8,2),  " &
        " @EmpLea_Action varchar(50), " &
        " @Hdr_Id Int,  " &
        " @EmpLea_Comment varchar(100), " &
        " @EmpLea_ApprovedBy varchar(50), " &
        " @NewId Int OUTPUT  " &
        " AS  DECLARE @Result as Int  Set @Result = 0  " &
        " SELECT @Result = Count(*) " &
        " FROM PrTxEmployeeLeave  " &
        " WHERE EmpLea_id = @EmpLea_id  " &
        " IF(@Result IS NULL) OR (@Result=0) " &
        " BEGIN  " &
        " INSERT INTO PrTxEmployeeLeave   " &
        " (EmpLea_Status, " &
        " Emp_Code, " &
        " EmpLea_Type, " &
        " EmpLea_ReqDate, " &
        " EmpLea_ProcDate, " &
        " EmpLea_ProcBy,  " &
        " EmpLea_FromDate, " &
        " EmpLea_ToDate,  " &
        " EmpLea_Units,  " &
        " EmpLea_Action, " &
        " Hdr_Id,  " &
        " EmpLea_Comment, " &
        " EmpLea_ApprovedBy " &
        " )  " &
        " VALUES (  @EmpLea_Status, " &
        " @Emp_Code, " &
        " @EmpLea_Type,  " &
        " @EmpLea_ReqDate, " &
        " @EmpLea_ProcDate,  " &
        " @EmpLea_ProcBy, " &
        " @EmpLea_FromDate, " &
        " @EmpLea_ToDate,  " &
        " @EmpLea_Units, " &
        " @EmpLea_Action, " &
        " @Hdr_Id," &
        " @EmpLea_Comment, " &
        " @EmpLea_ApprovedBy " &
        " ) " &
        " END  " &
        " ELSE  " &
        " BEGIN  " &
        " UPDATE PrTxEmployeeLeave  " &
        " SET   EmpLea_Status=@EmpLea_Status,  " &
        " Emp_Code=@Emp_Code, " &
        " EmpLea_Type=@EmpLea_Type, " &
        " EmpLea_ReqDate=@EmpLea_ReqDate, " &
        " EmpLea_ProcDate=@EmpLea_ProcDate,  " &
        " EmpLea_ProcBy=@EmpLea_ProcBy,  " &
        " EmpLea_FromDate=@EmpLea_FromDate, " &
        " EmpLea_ToDate=@EmpLea_ToDate, " &
        " EmpLea_Units=@EmpLea_Units, " &
        " EmpLea_Action=@EmpLea_Action, " &
        " Hdr_Id=@Hdr_Id,  " &
        " EmpLea_Comment=@EmpLea_Comment, " &
        " EmpLea_ApprovedBy=@EmpLea_ApprovedBy " &
        " WHERE EmpLea_id =@EmpLea_id  " &
        " END  set @NewId=SCOPE_IDENTITY()  "

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxEmployeeLeave was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Update SP PrTxEmployeeLeave", MsgBoxStyle.Critical)
        End If
        Return Proceed
    End Function
    Protected Function Upgrade_2022_03()


        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True


        Str = "ALTER TABLE AdMsCompany " &
        " ADD [Com_Logo] image NULL "




        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in AdMsCompany", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in AdMsCompany", MsgBoxStyle.Critical)
        End If


        ' Alter SPs                                     

        Str = "ALTER PROCEDURE [dbo].[AG_AdMsCompany_SAVE_UPDATE] " &
             "@Com_Id integer, " &
             "@Com_Code char(8), " &
             "@Com_Name varchar(100), " &
             "@Com_NameS varchar(30), " &
             "@Com_TIC varchar(12), " &
             "@Com_TaxCard  varchar(50), " &
             "@Com_SIRegNo  varchar(50), " &
             "@Com_CurSymbol  varchar(5), " &
             "@Com_Address1  varchar(100), " &
             "@Com_Address2  varchar(100), " &
             "@Com_Address3  varchar(100), " &
             "@Com_Address4  varchar(100), " &
             "@Com_Tel1  varchar(20), " &
             "@Com_Tel2  varchar(20), " &
             "@Com_Fax1  varchar(20), " &
             "@Com_Fax2  varchar(20), " &
             "@Com_AccountantPostCode  varchar(50), " &
             "@Com_AccountantPOBox  varchar(50), " &
             "@Com_AccountantTitle  varchar(50), " &
             "@Com_AccTIC  varchar(9), " &
             "@Com_AccIdentity int, " &
             "@Com_TICCategory int, " &
             "@Com_TICType  int, " &
             "@Com_BankCode varchar(3), " &
             "@Com_GLAnal1 varchar(20), " &
             "@Com_GLAnal2 varchar(20), " &
             "@Com_GLAnal3 varchar(20), " &
             "@Com_GLAnal4 varchar(20), " &
             "@Com_GLAnal5 varchar(20), " &
             "@Com_TSAccount varchar(50), " &
             "@Com_TSAccountType varchar(2), " &
             "@Com_TSBalAccount varchar(50), " &
             "@Com_TSBalAccountType varchar(2), " &
             "@Com_TSDefaultJob varchar(50), " &
             "@Com_SI2 varchar(50), " &
             "@Com_SI3 varchar(50), " &
             "@Com_SI4 varchar(50), " &
             "@Com_SI5 varchar(50), " &
             "@Com_BankCode2 varchar(50), " &
             "@Com_BankCode3 varchar(50), " &
             "@Com_BankCode4 varchar(50), " &
             "@Com_Logo image " &
             " " &
             "AS " &
             "DECLARE @Result as Int " &
             "  Set @Result = 0 " &
             "  SELECT @Result = Count(*) " &
             "  FROM AdMsCompany " &
             "  WHERE Com_Id = @Com_Id " &
             "  IF(@Result IS NULL) OR (@Result=0) " &
             "    BEGIN " &
             "      INSERT INTO AdMsCompany " &
             "      (Com_Id,   " &
             "	    Com_Code, " &
             "		Com_Name, " &
             "		Com_NameS, " &
             "		Com_TIC, " &
             "		Com_TaxCard, " &
             "		Com_SIRegNo, " &
             "		Com_CurSymbol, " &
             "		Com_Address1, " &
             "		Com_Address2, " &
             "		Com_Address3, " &
             "		Com_Address4, " &
             "		Com_Tel1, " &
             "		Com_Tel2, " &
             "		Com_Fax1, " &
             "		Com_Fax2, " &
             "		Com_AccountantPostCode, " &
             "		Com_AccountantPOBox, " &
             "		Com_AccountantTitle, " &
             "       Com_AccTIC, " &
             "		Com_AccIdentity, " &
             "		Com_TICCategory, " &
             "		Com_TICType, " &
             "		Com_BankCode, " &
             "        Com_GLAnal1,  " &
             "		Com_GLAnal2,  " &
             "		Com_GLAnal3,  " &
             "		Com_GLAnal4,   " &
             "		Com_GLAnal5, " &
             "		Com_TSAccount, " &
             "		Com_TSAccountType, " &
             "		Com_TSBalAccount, " &
             "		Com_TSBalAccountType, " &
             "		Com_TSDefaultJob, " &
             "		Com_SI2, " &
             "		Com_SI3, " &
             "		Com_SI4, " &
             "		Com_SI5, " &
             "		Com_BankCode2, " &
             " 		Com_BankCode3, " &
             "      Com_BankCode4, " &
             "      Com_Logo " &
             "     ) " &
             "    VALUES ( " &
             "		@Com_Id, " &
             "		@Com_Code, " &
             "		@Com_Name, " &
             "		@Com_NameS, " &
             "		@Com_TIC, " &
             "		@Com_TaxCard, " &
             "		@Com_SIRegNo, " &
             "		@Com_CurSymbol, " &
             "		@Com_Address1, " &
             "		@Com_Address2, " &
             "		@Com_Address3, " &
             "		@Com_Address4, " &
             "		@Com_Tel1, " &
             "		@Com_Tel2, " &
             "		@Com_Fax1, " &
             "		@Com_Fax2, " &
             "		@Com_AccountantPostCode, " &
             "		@Com_AccountantPOBox, " &
             "		@Com_AccountantTitle, " &
             "		@Com_AccTIC, " &
             "		@Com_AccIdentity, " &
             "		@Com_TICCategory, " &
             "		@Com_TICType, " &
             "		@Com_BankCode, " &
             "		@Com_GLAnal1,  " &
             "		@Com_GLAnal2,  " &
             "		@Com_GLAnal3,  " &
             "		@Com_GLAnal4,  " &
             "		@Com_GLAnal5, " &
             "		@Com_TSAccount, " &
             "		@Com_TSAccountType, " &
             "		@Com_TSBalAccount, " &
             "		@Com_TSBalAccountType, " &
             "		@Com_TSDefaultJob, " &
             "		@Com_SI2, " &
             "		@Com_SI3, " &
             "		@Com_SI4, " &
             "		@Com_SI5, " &
             "		@Com_BankCode2, " &
             "		@Com_BankCode3, " &
             "		@Com_BankCode4, " &
             "		@Com_Logo " &
             "     ) " &
             "      End " &
             " ELSE " &
             "       BEGIN " &
             "       UPDATE AdMsCompany " &
             "    SET  " &
             "	    Com_Code=@Com_Code, " &
             "		Com_Name=@Com_Name, " &
             "		Com_NameS=@Com_NameS, " &
             "		Com_TIC=@Com_TIC, " &
             "		Com_TaxCard=@Com_TaxCard, " &
             "		Com_SIRegNo=@Com_SIRegNo, " &
             "		Com_CurSymbol=@Com_CurSymbol, " &
             "		Com_Address1=@Com_Address1, " &
             "		Com_Address2=@Com_Address2, " &
             "		Com_Address3=@Com_Address3, " &
             "		Com_Address4=@Com_Address4, " &
             "		Com_Tel1=@Com_Tel1, " &
             "		Com_Tel2=@Com_Tel2, " &
             "		Com_Fax1=@Com_Fax1, " &
             "		Com_Fax2=@Com_Fax2, " &
             "		Com_AccountantPostCode=@Com_AccountantPostCode, " &
             "		Com_AccountantPOBox=@Com_AccountantPOBox, " &
             "		Com_AccountantTitle=@Com_AccountantTitle, " &
             "       Com_AccTIC=@Com_AccTIC, " &
             "		Com_AccIdentity=@Com_AccIdentity, " &
             "		Com_TICCategory=@Com_TICCategory, " &
             "		Com_TICType=@Com_TICType, " &
             "		Com_BankCode=@Com_BankCode, " &
             "		Com_GLAnal1=@Com_GLAnal1,  " &
             "		Com_GLAnal2=@Com_GLAnal2,  " &
             "		Com_GLAnal3=@Com_GLAnal3,  " &
             "		Com_GLAnal4=@Com_GLAnal4,  " &
             "		Com_GLAnal5=@Com_GLAnal5, " &
             "		Com_TSAccount=@Com_TSAccount, " &
             "		Com_TSAccountType=@Com_TSAccountType, " &
             "		Com_TSBalAccount=@Com_TSBalAccount, " &
             "		Com_TSBalAccountType=@Com_TSBalAccountType, " &
             "		Com_TSDefaultJob=@Com_TSDefaultJob, " &
             "		Com_SI2=@Com_SI2, " &
             "		Com_SI3=@Com_SI3, " &
             "		Com_SI4=@Com_SI4, " &
             "		Com_SI5=@Com_SI5, " &
             "		Com_BankCode2=@Com_BankCode2, " &
             "		Com_BankCode3=@Com_BankCode3, " &
             "		Com_BankCode4=@Com_BankCode4, " &
             "		Com_Logo=@Com_Logo " &
             "     WHERE Com_Id = @Com_Id " &
             "      End "

        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If


        Return F




    End Function
    Protected Function GetMaximumYearOfPeriodGroups() As DataSet
        Dim Str As String
        Str = "Select max(PrMsPeriodGroups.PrdGpr_Year)" &
        " FROM  PrMsPeriodGroups INNER JOIN PrMsTemplateGroup" &
        " ON PrMsPeriodGroups.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code " &
        " INNER JOIN PrSsCompanyUsers ON PrMsTemplateGroup.Com_Code = PrSsCompanyUsers.Com_Code" &
        " WHERE (PrSsCompanyUsers.Usr_UserName = " & enQuoteString(Global1.GLBUserCode) & ")" &
        " AND PrMsTemplateGroup.TemGrp_IsActive ='Y'"

        Return GetData(Str)
    End Function

#Region "Locii"
    Protected Function LociiExport_PrAnBanks() As DataSet
        Dim Str As String
        Str = "SELECT " &
        " Bnk_Code," &
        " Bnk_DescriptionL " &
        " FROM" &
        " PrAnBanks"

        Return GetData(Str)
    End Function
    Protected Function LociiExport_PrAnEmployeeAnalysis1() As DataSet
        Dim Str As String
        Str = "SELECT " &
        " EmpAn1_Code " &
        ",EmpAn1_DescriptionL " &
        ",EmpAn1_GLAnal1 " &
        ",EmpAn1_GLAnal2     " &
        " FROM " &
        " PrAnEmployeeAnalysis1 "

        Return GetData(Str)
    End Function
    Protected Function LociiExport_PrAnEmployeeAnalysis2() As DataSet
        Dim Str As String
        Str = " Select " &
     " EmpAn2_Code " &
     " ,EmpAn2_DescriptionL     " &
     " ,EmpAn2_GLAnal1 " &
     " ,EmpAn2_GLAnal2     " &
     " FROM  " &
    " PrAnEmployeeAnalysis2 "

        Return GetData(Str)
    End Function
    Protected Function LociiExport_PrAnEmployeeAnalysis3() As DataSet
        Dim Str As String
        Str = " Select " &
     " EmpAn3_Code " &
     ",EmpAn3_DescriptionL " &
     ",EmpAn3_GLAnal1 " &
     ",EmpAn3_GLAnal2       " &
     " FROM  " &
    "PrAnEmployeeAnalysis3 "
        Return GetData(Str)
    End Function
    Protected Function LociiExport_PrAnEmployeeAnalysis4() As DataSet
        Dim Str As String
        Str = " Select " &
         " EmpAn4_Code " &
         ",EmpAn4_DescriptionL     " &
         ",EmpAn4_GLAnal1 " &
         ",EmpAn4_GLAnal2     " &
         " FROM  " &
         "PrAnEmployeeAnalysis4 "

        Return GetData(Str)
    End Function
    'Protected Function LociiExport_PrAnEmployeeAnalysis5() As DataSet
    '    Dim Str As String
    '    Str = " Select " & _
    '       " EmpAn5_Code " & _
    '       ",EmpAn5_DescriptionL     " & _
    '       ",EmpAn5_GLAnal1 " & _
    '       ",EmpAn5_GLAnal2     " & _
    '       " FROM  " & _
    '       "PrAnEmployeeAnalysis5 "
    '    Return GetData(Str)
    'End Function
    Protected Function LociiExport_PrAnEmployeeCommunity() As DataSet
        Dim Str As String
        Str = " Select " &
     "EmpCmm_Code " &
    ",EmpCmm_DescriptionL     " &
    " FROM PrAnEmployeeCommunity "

        Return GetData(Str)
    End Function
    Protected Function LociiExport_PrAnEmployeePositions() As DataSet
        Dim Str As String
        Str = " Select " &
     "EmpPos_Code " &
    ",EmpPos_DescriptionL     " &
    " FROM  " &
    "PrAnEmployeePositions "

        Return GetData(Str)
    End Function

    Protected Function LociiExport_PrAnMarritalStatus() As DataSet
        Dim Str As String
        Str = " Select " &
    "MarSta_Code " &
    ",MarSta_DescriptionL     " &
    " FROM  " &
    "PrAnMarritalStatus "

        Return GetData(Str)
    End Function
    Protected Function LociiExport_PrMsEmployees(ByVal TemGrpCode As String) As DataSet
        Dim Str As String
        Str = " Select " &
    "Emp_Code " &
    ",Emp_Status " &
    ",PayTyp_Code      " &
    ",EmpSta_Code       " &
    ",Emp_FullName " &
    ",Emp_Sex " &
    ",Emp_BirthDate " &
    ",MarSta_Code      " &
    ",Emp_SocialInsNumber    " &
    ",Emp_IdentificationCard " &
    ",Emp_TaxID " &
    ",Emp_PassportNumber " &
    ",Emp_AlienNumber " &
    ",TicTyp_Code " &
    ",EmpAn1_Code " &
    ",EmpAn2_Code " &
    ",EmpAn3_Code " &
    ",EmpAn4_Code " &
    ",EmpAn5_Code       " &
    ",EmpPos_Code       " &
    ",EmpCmm_Code             " &
    ",Bnk_Code       " &
    ",Emp_IBAN " &
    ",Bnk_CodeCo     " &
    ",Emp_StartDate " &
    ",Emp_TerminateDate " &
    ",Emp_AnalGen1 " &
    ",Emp_TermReason  " &
    ",Emp_HireReason  " &
    " FROM  " &
    " PrMsEmployees " &
    " Where TemGrp_Code=" & Utils.enQuoteString(TemGrpCode)
        Return GetData(Str)
    End Function
    Protected Function LociiExport_PrMsTemplateContributions(ByVal TemGrpCode As String) As DataSet
        Dim Str As String
        Str = " Select " &
    "TemCon_id " &
    ",TemGrp_Code    " &
    ",ConCod_Code " &
    ",TemCon_DisplayName " &
    ",TemCon_AmendDate   " &
    ",TemCon_ReportingSequence    " &
    " FROM  " &
    "PrMsTemplateContributions" &
        " Where TemGrp_Code=" & Utils.enQuoteString(TemGrpCode)

        Return GetData(Str)
    End Function
    Protected Function LociiExport_PrMsTemplateDeductions(ByVal TemGrpCode As String) As DataSet
        Dim Str As String
        Str = " Select " &
    "TemDed_id " &
    ",TemGrp_Code  " &
    ",DedCod_Code " &
    ",TemDed_DisplayName " &
    ",TemDed_AmendDate " &
    ",TemDed_ReportingSequence       " &
    " FROM  " &
    "PrMsTemplateDeductions " &
        " Where TemGrp_Code=" & Utils.enQuoteString(TemGrpCode)

        Return GetData(Str)
    End Function
    Protected Function LociiExport_PrMsTemplateEarnings(ByVal TemGrpCode As String) As DataSet
        Dim Str As String
        Str = " Select " &
    "TemErn_id " &
    ",TemGrp_Code " &
    ",ErnCod_Code " &
    ",TemErn_DisplayName  " &
    ",TemErn_AmendDate " &
    ",TemErn_ReportingSequence     " &
    " FROM  " &
    "PrMsTemplateEarnings " &
        " Where TemGrp_Code=" & Utils.enQuoteString(TemGrpCode)

        Return GetData(Str)
    End Function
    Protected Function LociiExport_PrTxTrxnHeader(ByVal TemGrpCode As String, ByVal PrdCode As String, ByVal PrdGrpCode As String) As DataSet
        Dim Str As String
        Str = " Select " &
    "TrxHdr_Status " &
    ",TrxHdr_Id " &
    ",Emp_Code " &
    ",PrdGrp_Code " &
    ",PrdCod_Code " &
    ",PayCat_Code " &
    ",TrxHdr_PaymentMethod " &
    ",TrxHdr_PeriodUnits " &
    ",TrxHdr_AnnualUnits " &
    ",TrxHdr_Overtime1 " &
    ",TrxHdr_Overtime2 " &
    ",TrxHdr_Overtime3  " &
    ",TemGrp_Code  " &
    ",TrxHdr_A1 " &
    ",TrxHdr_A2 " &
    ",TrxHdr_A3 " &
    ",TrxHdr_A4 " &
    ",TrxHdr_A5 " &
    ",TrxHdr_Position " &
    ",TrxHdr_AnalGen1  " &
    ",TrxHdr_Maternity  " &
    ",TrxHdr_FEPercent  " &
    ",Trxhdr_FEControlAmount " &
    " FROM  " &
    " PrTxTrxnHeader " &
    " WHERE " &
    " TemGrp_Code=" & Utils.enQuoteString(TemGrpCode) &
    " AND PrdGrp_Code=" & Utils.enQuoteString(PrdGrpCode) &
    " AND PrdCod_Code >= " & Utils.enQuoteString(PrdCode) &
    " AND (Trxhdr_Status='CALC' OR Trxhdr_Status='POST')"

        Return GetData(Str)

    End Function
    Protected Function LociiExport_PrTxTrxnLines(ByVal TemGrpCode As String, ByVal PrdCode As String, ByVal PrdGrpCode As String) As DataSet
        Dim Str As String
        Str = " Select " &
    "L.TrxLin_Id " &
    ",L.TrxHdr_Id " &
    ",L.TrxLin_Type " &
    ",L.ErnCod_Code " &
    ",L.DedCod_Code " &
    ",L.ConCod_Code " &
    ",L.TrxLin_PeriodValue   " &
    " FROM  " &
    "PrTxTrxnLines AS L " &
    "INNER JOIN dbo.PrTxTrxnHeader AS H " &
    "ON  L.TrxHdr_Id = H.TrxHdr_Id " &
     " WHERE " &
    " H.TemGrp_Code=" & Utils.enQuoteString(TemGrpCode) &
    " AND H.PrdGrp_Code=" & Utils.enQuoteString(PrdGrpCode) &
    " AND H.PrdCod_Code >= " & Utils.enQuoteString(PrdCode) &
    " AND (H.Trxhdr_Status='CALC' OR H.Trxhdr_Status='POST')"

        Return GetData(Str)
    End Function
    Protected Function LociiExport_PrTxEmployeeLeave(ByVal TemGrpCode As String, ByVal PrdCode As cPrMsPeriodCodes, ByVal PrdGrpCode As String) As DataSet




        Dim sFrom As String = Format(PrdCode.DateFrom, "yyyy-MM-dd")
        Dim sTo As String = Format(PrdCode.DateTo, "yyyy-MM-dd")

        sFrom = Utils.ChangeDateFormatForSearch(sFrom)
        sTo = Utils.ChangeDateFormatForSearch(sTo)

        Dim Str As String
        Str = "SELECT PrTxEmployeeLeave.Emp_Code, " &
        " PrTxEmployeeLeave.EmpLea_Action," &
        " PrTxEmployeeLeave.EmpLea_FromDate," &
        " PrTxEmployeeLeave.EmpLea_ToDate " &
        " FROM PrTxEmployeeLeave INNER JOIN" &
        " PrMsEmployees ON PrTxEmployeeLeave.Emp_Code = PrMsEmployees.Emp_Code " &
        " WHERE (PrTxEmployeeLeave.EmpLea_Status = 'Approved') " &
        " AND (PrTxEmployeeLeave.EmpLea_Type = 5)" &
        " AND (PrMsEmployees.TemGrp_Code = " & enQuoteString(TemGrpCode) & ")" &
        " AND (PrTxEmployeeLeave.EmpLea_toDate>=" & enQuoteString(sFrom) & ")"



        Return GetData(Str)
    End Function
    Protected Function Upgrade_2022_04()


        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_Email2] varchar(70) NULL "




        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If


        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1), " &
        " @Emp_GESYFromSplit decimal(18,2), " &
        " @Emp_AnalGen1 varchar(20), " &
        " @Emp_Nameday varchar(10), " &
        " @Emp_IsDirector varchar(1), " &
        " @Emp_Rehire varchar(16), " &
        " @Emp_CNP varchar(16), " &
        " @Emp_TACode varchar(16), " &
        " @Emp_HRCode varchar(16), " &
        " @Emp_TermReason varchar(2), " &
        " @Emp_HireReason varchar(2), " &
        " @Emp_Photo image, " &
        " @Emp_Email2 Varchar(70) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen, " &
        " Emp_GESYFromSplit, " &
        " Emp_AnalGen1, " &
        " Emp_NameDay, " &
        " Emp_IsDirector, " &
        " Emp_Rehire, " &
        " Emp_CNP,  " &
        " Emp_TACode,  " &
        " Emp_HRCode,  " &
        " Emp_TermReason,  " &
        " Emp_HireReason,  " &
        " Emp_Photo,  " &
        " Emp_Email2  " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen, " &
        " @Emp_GESYFromSplit, " &
        " @Emp_AnalGen1," &
        " @Emp_Nameday, " &
        " @Emp_IsDirector, " &
        " @Emp_Rehire, " &
        " @Emp_CNP,  " &
        " @Emp_TACode,  " &
        " @Emp_HRCode,  " &
        " @Emp_TermReason,  " &
        " @Emp_HireReason,  " &
        " @Emp_Photo,  " &
        " @Emp_Email2  " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen, " &
        " Emp_GESYFromSplit= @Emp_GESYFromSplit, " &
        " Emp_AnalGen1 = @Emp_AnalGen1," &
        " Emp_Nameday = @Emp_NameDay, " &
        " Emp_Isdirector = @Emp_Isdirector, " &
        " Emp_Rehire = @Emp_Rehire, " &
        " Emp_CNP = @Emp_CNP,  " &
        " Emp_TACode = @Emp_TACode,  " &
        " Emp_HRCode = @Emp_HRCode,  " &
        " Emp_TermReason = @Emp_TermReason,  " &
        " Emp_HireReason = @Emp_HireReason,  " &
        " Emp_Photo = @Emp_Photo,  " &
        " Emp_Email2 = @Emp_Email2  " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If






        Return True
    End Function


    Protected Function Upgrade_2022_05()


        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_Maternity] varchar(1) NULL "




        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If


        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1), " &
        " @Emp_GESYFromSplit decimal(18,2), " &
        " @Emp_AnalGen1 varchar(20), " &
        " @Emp_Nameday varchar(10), " &
        " @Emp_IsDirector varchar(1), " &
        " @Emp_Rehire varchar(16), " &
        " @Emp_CNP varchar(16), " &
        " @Emp_TACode varchar(16), " &
        " @Emp_HRCode varchar(16), " &
        " @Emp_TermReason varchar(2), " &
        " @Emp_HireReason varchar(2), " &
        " @Emp_Photo image, " &
        " @Emp_Email2 Varchar(70), " &
        " @Emp_Maternity Varchar(1) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen, " &
        " Emp_GESYFromSplit, " &
        " Emp_AnalGen1, " &
        " Emp_NameDay, " &
        " Emp_IsDirector, " &
        " Emp_Rehire, " &
        " Emp_CNP,  " &
        " Emp_TACode,  " &
        " Emp_HRCode,  " &
        " Emp_TermReason,  " &
        " Emp_HireReason,  " &
        " Emp_Photo,  " &
        " Emp_Email2,  " &
        " Emp_Maternity " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen, " &
        " @Emp_GESYFromSplit, " &
        " @Emp_AnalGen1," &
        " @Emp_Nameday, " &
        " @Emp_IsDirector, " &
        " @Emp_Rehire, " &
        " @Emp_CNP,  " &
        " @Emp_TACode,  " &
        " @Emp_HRCode,  " &
        " @Emp_TermReason,  " &
        " @Emp_HireReason,  " &
        " @Emp_Photo,  " &
        " @Emp_Email2,  " &
        " @Emp_Maternity " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen, " &
        " Emp_GESYFromSplit= @Emp_GESYFromSplit, " &
        " Emp_AnalGen1 = @Emp_AnalGen1," &
        " Emp_Nameday = @Emp_NameDay, " &
        " Emp_Isdirector = @Emp_Isdirector, " &
        " Emp_Rehire = @Emp_Rehire, " &
        " Emp_CNP = @Emp_CNP,  " &
        " Emp_TACode = @Emp_TACode,  " &
        " Emp_HRCode = @Emp_HRCode,  " &
        " Emp_TermReason = @Emp_TermReason,  " &
        " Emp_HireReason = @Emp_HireReason,  " &
        " Emp_Photo = @Emp_Photo,  " &
        " Emp_Email2 = @Emp_Email2,  " &
        " Emp_Maternity = @Emp_Maternity " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If

        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

        Str = " ALTER TABLE PrTxtrxnheader " &
        " ADD [TrxHdr_Maternity] varchar(1) NULL, " &
        " [TrxHdr_FEPercent] varchar(4) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("2 New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If

        Str = " Update PrTxtrxnheader " &
       " set TrxHdr_Maternity = '0',TrxHdr_FEPercent = '0' "
        i = ExecuteNonQuery(Str)


        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE]" &
               " @TrxHdr_Id int," &
               " @Emp_Code varchar(16)," &
               " @PrdGrp_Code varchar(6)," &
               " @PrdCod_Code varchar(6)," &
               " @PayCat_Code varchar(4)," &
               " @TrxHdr_Date datetime," &
               " @TrxHdr_Status varchar(4)," &
               " @TrxHdr_TotalErnPeriod decimal(18,2)," &
               " @TrxHdr_TotalErnYTD decimal(18,2)," &
               " @TrxHdr_TotalDedPeriod decimal(18,2)," &
               " @TrxHdr_TotalDedYTD decimal(18,2)," &
               " @TrxHdr_TotalConPeriod decimal(18,2)," &
               " @TrxHdr_TotalConYTD decimal(18,2)," &
               " @TrxHdr_SIIncome decimal(18,2)," &
               " @TrxHdr_TaxableIncome decimal(18,2)," &
               " @TrxHdr_PaymentMethod varchar(50)," &
               " @TrxHdr_PaymentRef varchar(50)," &
               " @TrxHdr_PeriodUnits decimal(18,2)," &
               " @TrxHdr_AnnualUnits decimal(18,2)," &
               " @TrxHdr_AnnualLeave decimal(18,2)," &
               " @TrxHdr_LifeInsurance decimal(18,2)," &
               " @TrxHdr_Discounts decimal(18,2)," &
               " @TrxHdr_Interfacestatus varchar(4)," &
               " @TrxHdr_Overtime1 decimal(10,2)," &
               " @TrxHdr_Overtime2 decimal(10,2)," &
               " @TrxHdr_SIUnits decimal(10,2)," &
               " @TrxHdr_MonthlySalary decimal(18,2)," &
               " @TrxHdr_NetSalary decimal(18,2)," &
               " @TrxHdr_PeriodInsurable decimal(18,2)," &
               " @TemGrp_Code varchar(6)," &
               " @TrxHdr_ChequeNo varchar(50)," &
               " @TrxHdr_TaxableFromOther Decimal(18,2)," &
               " @TrxHdr_CurrencySymbol varchar(3)," &
               " @TrxHdr_Rate Decimal(18,10)," &
               " @TrxHdr_NormalDays Decimal(18,2)," &
               " @TrxHdr_Salary1 Decimal(18,2)," &
               " @TrxHdr_Salary2 Decimal(18,2)," &
               " @TrxHdr_Overtime3 decimal(10,2)," &
               " @TrxHdr_Sectors decimal(18,2)," &
               " @TrxHdr_Dutyhours decimal(18,2)," &
               " @TrxHdr_FlightHours decimal(18,2)," &
               " @TrxHdr_Commission decimal(18,2)," &
               " @TrxHdr_PBAmount decimal(18,2)," &
               " @TrxHdr_PBRate decimal(18,2)," &
               " @TrxHdr_Overlay decimal(18,2)," &
               " @TrxHdr_PeriodSplit decimal(18,2)," &
               " @TrxHdr_PeriodSplitSI decimal(18,2)," &
               " @TrxHdr_A1 varchar(12), " &
               " @TrxHdr_A2 varchar(12), " &
               " @TrxHdr_A3 varchar(12), " &
               " @TrxHdr_A4 varchar(12), " &
               " @TrxHdr_A5 varchar(12), " &
               " @TrxHdr_Union varchar(12), " &
               " @TrxHdr_Position varchar(12), " &
               " @TrxHdr_COLA decimal(18, 2)," &
               " @TrxHdr_MyRate decimal(18, 4)," &
               " @TrxHdr_FE decimal(18, 2)," &
               " @TrxHdr_NetYTD decimal(18, 2)," &
               " @TrxHdr_PFOnAgreedSalary decimal(18, 2)," &
               " @TrxHdr_BasisOnSalary decimal(18, 2)," &
               " @TrxHdr_GesiD decimal(18, 2)," &
               " @TrxHdr_GesiC decimal(18, 2)," &
               " @TrxHdr_Medical decimal(18, 2)," &
               " @Com_Code varchar(10)," &
               " @TrxHdr_Year varchar(4), " &
               " @TrxHdr_GESIableAmount decimal(18, 2)," &
               " @TrxHdr_BIK_GesiD decimal(18, 2)," &
               " @TrxHdr_BIK_GesiC decimal(18, 2)," &
               " @TrxHdr_BIK_Gesiable decimal(18, 2)," &
               " @TrxHdr_AnalGen1 varchar(20)," &
               " @TrxHdr_Maternity varchar(1)," &
               " @TrxHdr_FEPercent varchar(4)," &
               " @NewId Int OUTPUT " &
               " AS" &
               " DECLARE @Result as Int" &
               " Set  @Result = 0" &
               " SELECT @Result = Count(*)" &
               " FROM PrTxTrxnHeader" &
               " WHERE TrxHdr_Id =  @TrxHdr_Id" &
               " IF(@Result IS NULL) OR (@Result=0)" &
               " BEGIN" &
               "   INSERT INTO PrTxTrxnHeader" &
               "   (Emp_Code,                                           " &
               " PrdGrp_Code," &
               " PrdCod_Code,                                        " &
               " PayCat_Code,                                        " &
               " TrxHdr_Date,                                        " &
               " TrxHdr_Status,                                      " &
               " TrxHdr_TotalErnPeriod,                              " &
               " TrxHdr_TotalErnYTD,                                 " &
               " TrxHdr_TotalDedPeriod,                              " &
               " TrxHdr_TotalDedYTD,                                 " &
               " TrxHdr_TotalConPeriod,                              " &
               " TrxHdr_TotalConYTD,                                 " &
               " TrxHdr_SIIncome,                                    " &
               " TrxHdr_TaxableIncome,                               " &
               " TrxHdr_PaymentMethod,                               " &
               " TrxHdr_PaymentRef,                                  " &
               " TrxHdr_PeriodUnits,                                 " &
               " TrxHdr_AnnualUnits,                                 " &
               " TrxHdr_AnnualLeave,                                  " &
               " TrxHdr_LifeInsurance,                                " &
               " TrxHdr_Discounts,                                    " &
               " TrxHdr_InterfaceStatus,                               " &
               " TrxHdr_Overtime1," &
               " TrxHdr_Overtime2," &
               " TrxHdr_SIUnits," &
               " TrxHdr_MonthlySalary," &
               " TrxHdr_NetSalary," &
               " TrxHdr_PeriodInsurable," &
               " TemGrp_Code," &
               " TrxHdr_ChequeNo," &
               " TrxHdr_TaxableFromOther," &
               " TrxHdr_CurrencySymbol," &
               " TrxHdr_Rate," &
               " TrxHdr_NormalDays," &
               " TrxHdr_Salary1," &
               " TrxHdr_Salary2," &
               " TrxHdr_Overtime3," &
               " TrxHdr_Sectors," &
               " TrxHdr_Dutyhours," &
               " TrxHdr_FlightHours," &
               " TrxHdr_Commission," &
               " TrxHdr_PBAmount," &
               " TrxHdr_PBRate," &
               " TrxHdr_Overlay," &
               " TrxHdr_PeriodSplit, " &
               " TrxHdr_PeriodSplitSI, " &
               " TrxHdr_A1, " &
               " TrxHdr_A2, " &
               " TrxHdr_A3, " &
               " TrxHdr_A4, " &
               " TrxHdr_A5, " &
               " TrxHdr_Union, " &
               " TrxHdr_Position, " &
               " TrxHdr_COLA," &
               " TrxHdr_MyRate, " &
               " TrxHdr_FE, " &
               " TrxHdr_NetYTD, " &
               " TrxHdr_PFOnAgreedSalary, " &
               " TrxHdr_BasisOnSalary, " &
               " TrxHdr_GesiD, " &
               " TrxHdr_GesiC, " &
               " TrxHdr_Medical, " &
               " Com_Code, " &
               " TrxHdr_Year, " &
               " TrxHdr_GESIableAmount, " &
               " TrxHdr_BIK_GesiD, " &
               " TrxHdr_BIK_GesiC, " &
               " TrxHdr_BIK_Gesiable, " &
               " TrxHdr_AnalGen1, " &
               " TrxHdr_Maternity, " &
               " TrxHdr_FEPercent " &
               " )" &
               " VALUES (" &
               " @Emp_Code,                                           " &
               " @PrdGrp_Code,                                        " &
               " @PrdCod_Code,                                        " &
               " @PayCat_Code,                                        " &
               " @TrxHdr_Date,                                        " &
               " @TrxHdr_Status,                                      " &
               " @TrxHdr_TotalErnPeriod,                              " &
               " @TrxHdr_TotalErnYTD,                                 " &
               " @TrxHdr_TotalDedPeriod,                              " &
               " @TrxHdr_TotalDedYTD,                                 " &
               " @TrxHdr_TotalConPeriod,                              " &
               " @TrxHdr_TotalConYTD,                                 " &
               " @TrxHdr_SIIncome,                                    " &
               " @TrxHdr_TaxableIncome,                               " &
               " @TrxHdr_PaymentMethod,                               " &
               " @TrxHdr_PaymentRef,                                  " &
               " @TrxHdr_PeriodUnits,                                 " &
               " @TrxHdr_AnnualUnits,                                 " &
               " @TrxHdr_AnnualLeave,                                 " &
               " @TrxHdr_LifeInsurance,                               " &
               " @TrxHdr_Discounts,                                   " &
               " @TrxHdr_InterfaceStatus,                              " &
               " @TrxHdr_Overtime1," &
               " @TrxHdr_Overtime2," &
               " @TrxHdr_SIUnits," &
               " @TrxHdr_MonthlySalary," &
               " @TrxHdr_NetSalary," &
               " @TrxHdr_PeriodInsurable," &
               " @TemGrp_Code, " &
               " @TrxHdr_ChequeNo," &
               " @TrxHdr_TaxableFromOther," &
               " @TrxHdr_CurrencySymbol," &
               " @TrxHdr_Rate," &
               " @TrxHdr_NormalDays," &
               " @TrxHdr_Salary1," &
               " @TrxHdr_Salary2," &
               " @TrxHdr_Overtime3," &
               " @TrxHdr_Sectors," &
               " @TrxHdr_Dutyhours," &
               " @TrxHdr_FlightHours," &
               " @TrxHdr_Commission," &
               " @TrxHdr_PBAmount," &
               " @TrxHdr_PBRate," &
               " @TrxHdr_Overlay," &
               " @TrxHdr_PeriodSplit, " &
               " @TrxHdr_PeriodSplitSI, " &
               " @TrxHdr_A1, " &
               " @TrxHdr_A2, " &
               " @TrxHdr_A3, " &
               " @TrxHdr_A4, " &
               " @TrxHdr_A5, " &
               " @TrxHdr_Union, " &
               " @TrxHdr_Position, " &
               " @TrxHdr_COLA," &
               " @TrxHdr_MyRate," &
               " @TrxHdr_FE, " &
               " @TrxHdr_NetYTD, " &
               " @TrxHdr_PFOnAgreedSalary, " &
               " @TrxHdr_BasisOnSalary, " &
               " @TrxHdr_GesiD, " &
               " @TrxHdr_GesiC, " &
               " @TrxHdr_Medical, " &
               " @Com_Code, " &
               " @TrxHdr_Year, " &
               " @TrxHdr_GESIableAmount, " &
               " @TrxHdr_BIK_GesiD, " &
               " @TrxHdr_BIK_GesiC, " &
               " @TrxHdr_BIK_Gesiable, " &
               " @TrxHdr_AnalGen1, " &
               " @TrxHdr_Maternity, " &
               " @TrxHdr_FEPercent " &
               " )" &
               " END" &
               " ELSE" &
               "   BEGIN" &
               "     UPDATE PrTxTrxnHeader" &
               "     SET " &
               "     Emp_Code=@Emp_Code,                                   " &
               "     PrdGrp_Code=@PrdGrp_Code," &
               "     PrdCod_Code=@PrdCod_Code,                             " &
               "     PayCat_Code=@PayCat_Code,                             " &
               "     TrxHdr_Date=@TrxHdr_Date,                             " &
               "    TrxHdr_Status=@TrxHdr_Status,                         " &
               "  TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " &
               "     TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " &
               "    TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " &
               "   TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " &
               "  TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " &
               " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " &
               " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " &
               " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " &
               " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " &
               " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " &
               " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " &
               " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " &
               " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,                " &
               " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " &
               " TrxHdr_Discounts=@TrxHdr_Discounts,                    " &
               " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,        " &
               " TrxHdr_Overtime1=@TrxHdr_Overtime1," &
               " TrxHdr_Overtime2=@TrxHdr_Overtime2," &
               " TrxHdr_SIUnits=@TrxHdr_SIUnits," &
               " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary," &
               " TrxHdr_NetSalary=@TrxHdr_NetSalary," &
               " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable," &
               " TemGrp_Code=@TemGrp_Code," &
               " TrxHdr_ChequeNo=@TrxHdr_ChequeNo ," &
               " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther," &
               " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol," &
               " TrxHdr_Rate=@TrxHdr_Rate," &
               " TrxHdr_NormalDays=@TrxHdr_NormalDays ," &
               " TrxHdr_Salary1=@TrxHdr_Salary1," &
               " TrxHdr_Salary2=@TrxHdr_Salary2," &
               " TrxHdr_Overtime3=@TrxHdr_Overtime3," &
               " TrxHdr_Sectors=@TrxHdr_Sectors," &
               " TrxHdr_Dutyhours=@TrxHdr_Dutyhours," &
               " TrxHdr_FlightHours=@TrxHdr_FlightHours," &
               " TrxHdr_Commission=@TrxHdr_Commission," &
               " TrxHdr_PBAmount=@TrxHdr_PBAmount," &
               " TrxHdr_PBRate=@TrxHdr_PBRate," &
               " TrxHdr_Overlay=@TrxHdr_Overlay," &
               " TrxHdr_PeriodSplit=@TrxHdr_PeriodSplit, " &
               " TrxHdr_PeriodSplitSI=@TrxHdr_PeriodSplitSI," &
               " TrxHdr_A1=@TrxHdr_A1, " &
               " TrxHdr_A2=@TrxHdr_A2, " &
               " TrxHdr_A3=@TrxHdr_A3, " &
               " TrxHdr_A4=@TrxHdr_A4, " &
               " TrxHdr_A5=@TrxHdr_A5, " &
               " TrxHdr_Union=@TrxHdr_Union, " &
               " TrxHdr_Position=@TrxHdr_Position, " &
               " TrxHdr_COLA=@TrxHdr_COLA," &
               " TrxHdr_MyRate=@TrxHdr_MyRate, " &
               " TrxHdr_FE=@TrxHdr_FE, " &
               " TrxHdr_NetYTD=@TrxHdr_NetYTD, " &
               " TrxHdr_PFOnAgreedSalary=@TrxHdr_PFOnAgreedSalary, " &
               " TrxHdr_BasisOnSalary=@TrxHdr_BasisOnSalary, " &
               " TrxHdr_GesiD=@TrxHdr_GesiD, " &
               " TrxHdr_GesiC=@TrxHdr_GesiC, " &
               " TrxHdr_Medical=@TrxHdr_Medical, " &
               " Com_Code=@Com_Code, " &
               " TrxHdr_Year=@TrxHdr_Year, " &
               " TrxHdr_GESIableAmount =@TrxHdr_GESIableAmount, " &
               " TrxHdr_BIK_GesiD = @TrxHdr_BIK_GesiD, " &
               " TrxHdr_BIK_GesiC = @TrxHdr_BIK_GesiC, " &
               " TrxHdr_BIK_Gesiable = @TrxHdr_BIK_Gesiable, " &
               " TrxHdr_AnalGen1 = @TrxHdr_AnalGen1, " &
               " TrxHdr_Maternity = @TrxHdr_Maternity, " &
               " TrxHdr_FEPercent = @TrxHdr_FEPercent " &
               " WHERE TrxHdr_Id = @TrxHdr_Id " &
               " END " &
               " set  @NewId=SCOPE_IDENTITY()"

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If




        Return Proceed




        Return True
    End Function
    Protected Function Upgrade_2022_06()


        Dim Str As String
        Dim i As Integer


        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_FEControlAmount] Decimal(18,2) NULL "




        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in PrMsemployees", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrMsEmployees", MsgBoxStyle.Critical)
        End If


        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1), " &
        " @Emp_GESYFromSplit decimal(18,2), " &
        " @Emp_AnalGen1 varchar(20), " &
        " @Emp_Nameday varchar(10), " &
        " @Emp_IsDirector varchar(1), " &
        " @Emp_Rehire varchar(16), " &
        " @Emp_CNP varchar(16), " &
        " @Emp_TACode varchar(16), " &
        " @Emp_HRCode varchar(16), " &
        " @Emp_TermReason varchar(2), " &
        " @Emp_HireReason varchar(2), " &
        " @Emp_Photo image, " &
        " @Emp_Email2 Varchar(70), " &
        " @Emp_Maternity Varchar(1), " &
        " @Emp_FEControlAmount Decimal(18,2)" &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen, " &
        " Emp_GESYFromSplit, " &
        " Emp_AnalGen1, " &
        " Emp_NameDay, " &
        " Emp_IsDirector, " &
        " Emp_Rehire, " &
        " Emp_CNP,  " &
        " Emp_TACode,  " &
        " Emp_HRCode,  " &
        " Emp_TermReason,  " &
        " Emp_HireReason,  " &
        " Emp_Photo,  " &
        " Emp_Email2,  " &
        " Emp_Maternity, " &
        " Emp_FEControlAmount " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen, " &
        " @Emp_GESYFromSplit, " &
        " @Emp_AnalGen1," &
        " @Emp_Nameday, " &
        " @Emp_IsDirector, " &
        " @Emp_Rehire, " &
        " @Emp_CNP,  " &
        " @Emp_TACode,  " &
        " @Emp_HRCode,  " &
        " @Emp_TermReason,  " &
        " @Emp_HireReason,  " &
        " @Emp_Photo,  " &
        " @Emp_Email2,  " &
        " @Emp_Maternity, " &
        " @Emp_FEControlAmount " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen, " &
        " Emp_GESYFromSplit= @Emp_GESYFromSplit, " &
        " Emp_AnalGen1 = @Emp_AnalGen1," &
        " Emp_Nameday = @Emp_NameDay, " &
        " Emp_Isdirector = @Emp_Isdirector, " &
        " Emp_Rehire = @Emp_Rehire, " &
        " Emp_CNP = @Emp_CNP,  " &
        " Emp_TACode = @Emp_TACode,  " &
        " Emp_HRCode = @Emp_HRCode,  " &
        " Emp_TermReason = @Emp_TermReason,  " &
        " Emp_HireReason = @Emp_HireReason,  " &
        " Emp_Photo = @Emp_Photo,  " &
        " Emp_Email2 = @Emp_Email2,  " &
        " Emp_Maternity = @Emp_Maternity, " &
        " Emp_FEControlAmount = @Emp_FEControlAmount " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If

        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

        Str = " ALTER TABLE PrTxtrxnheader " &
        " ADD [TrxHdr_FEControlAmount] Decimal(18,2) NULL "



        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("1 New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If


        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE]" &
               " @TrxHdr_Id int," &
               " @Emp_Code varchar(16)," &
               " @PrdGrp_Code varchar(6)," &
               " @PrdCod_Code varchar(6)," &
               " @PayCat_Code varchar(4)," &
               " @TrxHdr_Date datetime," &
               " @TrxHdr_Status varchar(4)," &
               " @TrxHdr_TotalErnPeriod decimal(18,2)," &
               " @TrxHdr_TotalErnYTD decimal(18,2)," &
               " @TrxHdr_TotalDedPeriod decimal(18,2)," &
               " @TrxHdr_TotalDedYTD decimal(18,2)," &
               " @TrxHdr_TotalConPeriod decimal(18,2)," &
               " @TrxHdr_TotalConYTD decimal(18,2)," &
               " @TrxHdr_SIIncome decimal(18,2)," &
               " @TrxHdr_TaxableIncome decimal(18,2)," &
               " @TrxHdr_PaymentMethod varchar(50)," &
               " @TrxHdr_PaymentRef varchar(50)," &
               " @TrxHdr_PeriodUnits decimal(18,2)," &
               " @TrxHdr_AnnualUnits decimal(18,2)," &
               " @TrxHdr_AnnualLeave decimal(18,2)," &
               " @TrxHdr_LifeInsurance decimal(18,2)," &
               " @TrxHdr_Discounts decimal(18,2)," &
               " @TrxHdr_Interfacestatus varchar(4)," &
               " @TrxHdr_Overtime1 decimal(10,2)," &
               " @TrxHdr_Overtime2 decimal(10,2)," &
               " @TrxHdr_SIUnits decimal(10,2)," &
               " @TrxHdr_MonthlySalary decimal(18,2)," &
               " @TrxHdr_NetSalary decimal(18,2)," &
               " @TrxHdr_PeriodInsurable decimal(18,2)," &
               " @TemGrp_Code varchar(6)," &
               " @TrxHdr_ChequeNo varchar(50)," &
               " @TrxHdr_TaxableFromOther Decimal(18,2)," &
               " @TrxHdr_CurrencySymbol varchar(3)," &
               " @TrxHdr_Rate Decimal(18,10)," &
               " @TrxHdr_NormalDays Decimal(18,2)," &
               " @TrxHdr_Salary1 Decimal(18,2)," &
               " @TrxHdr_Salary2 Decimal(18,2)," &
               " @TrxHdr_Overtime3 decimal(10,2)," &
               " @TrxHdr_Sectors decimal(18,2)," &
               " @TrxHdr_Dutyhours decimal(18,2)," &
               " @TrxHdr_FlightHours decimal(18,2)," &
               " @TrxHdr_Commission decimal(18,2)," &
               " @TrxHdr_PBAmount decimal(18,2)," &
               " @TrxHdr_PBRate decimal(18,2)," &
               " @TrxHdr_Overlay decimal(18,2)," &
               " @TrxHdr_PeriodSplit decimal(18,2)," &
               " @TrxHdr_PeriodSplitSI decimal(18,2)," &
               " @TrxHdr_A1 varchar(12), " &
               " @TrxHdr_A2 varchar(12), " &
               " @TrxHdr_A3 varchar(12), " &
               " @TrxHdr_A4 varchar(12), " &
               " @TrxHdr_A5 varchar(12), " &
               " @TrxHdr_Union varchar(12), " &
               " @TrxHdr_Position varchar(12), " &
               " @TrxHdr_COLA decimal(18, 2)," &
               " @TrxHdr_MyRate decimal(18, 4)," &
               " @TrxHdr_FE decimal(18, 2)," &
               " @TrxHdr_NetYTD decimal(18, 2)," &
               " @TrxHdr_PFOnAgreedSalary decimal(18, 2)," &
               " @TrxHdr_BasisOnSalary decimal(18, 2)," &
               " @TrxHdr_GesiD decimal(18, 2)," &
               " @TrxHdr_GesiC decimal(18, 2)," &
               " @TrxHdr_Medical decimal(18, 2)," &
               " @Com_Code varchar(10)," &
               " @TrxHdr_Year varchar(4), " &
               " @TrxHdr_GESIableAmount decimal(18, 2)," &
               " @TrxHdr_BIK_GesiD decimal(18, 2)," &
               " @TrxHdr_BIK_GesiC decimal(18, 2)," &
               " @TrxHdr_BIK_Gesiable decimal(18, 2)," &
               " @TrxHdr_AnalGen1 varchar(20)," &
               " @TrxHdr_Maternity varchar(1)," &
               " @TrxHdr_FEPercent varchar(4)," &
               " @TrxHdr_FEControlAmount decimal(18,2), " &
               " @NewId Int OUTPUT " &
               " AS" &
               " DECLARE @Result as Int" &
               " Set  @Result = 0" &
               " SELECT @Result = Count(*)" &
               " FROM PrTxTrxnHeader" &
               " WHERE TrxHdr_Id =  @TrxHdr_Id" &
               " IF(@Result IS NULL) OR (@Result=0)" &
               " BEGIN" &
               "   INSERT INTO PrTxTrxnHeader" &
               "   (Emp_Code,                                           " &
               " PrdGrp_Code," &
               " PrdCod_Code,                                        " &
               " PayCat_Code,                                        " &
               " TrxHdr_Date,                                        " &
               " TrxHdr_Status,                                      " &
               " TrxHdr_TotalErnPeriod,                              " &
               " TrxHdr_TotalErnYTD,                                 " &
               " TrxHdr_TotalDedPeriod,                              " &
               " TrxHdr_TotalDedYTD,                                 " &
               " TrxHdr_TotalConPeriod,                              " &
               " TrxHdr_TotalConYTD,                                 " &
               " TrxHdr_SIIncome,                                    " &
               " TrxHdr_TaxableIncome,                               " &
               " TrxHdr_PaymentMethod,                               " &
               " TrxHdr_PaymentRef,                                  " &
               " TrxHdr_PeriodUnits,                                 " &
               " TrxHdr_AnnualUnits,                                 " &
               " TrxHdr_AnnualLeave,                                  " &
               " TrxHdr_LifeInsurance,                                " &
               " TrxHdr_Discounts,                                    " &
               " TrxHdr_InterfaceStatus,                               " &
               " TrxHdr_Overtime1," &
               " TrxHdr_Overtime2," &
               " TrxHdr_SIUnits," &
               " TrxHdr_MonthlySalary," &
               " TrxHdr_NetSalary," &
               " TrxHdr_PeriodInsurable," &
               " TemGrp_Code," &
               " TrxHdr_ChequeNo," &
               " TrxHdr_TaxableFromOther," &
               " TrxHdr_CurrencySymbol," &
               " TrxHdr_Rate," &
               " TrxHdr_NormalDays," &
               " TrxHdr_Salary1," &
               " TrxHdr_Salary2," &
               " TrxHdr_Overtime3," &
               " TrxHdr_Sectors," &
               " TrxHdr_Dutyhours," &
               " TrxHdr_FlightHours," &
               " TrxHdr_Commission," &
               " TrxHdr_PBAmount," &
               " TrxHdr_PBRate," &
               " TrxHdr_Overlay," &
               " TrxHdr_PeriodSplit, " &
               " TrxHdr_PeriodSplitSI, " &
               " TrxHdr_A1, " &
               " TrxHdr_A2, " &
               " TrxHdr_A3, " &
               " TrxHdr_A4, " &
               " TrxHdr_A5, " &
               " TrxHdr_Union, " &
               " TrxHdr_Position, " &
               " TrxHdr_COLA," &
               " TrxHdr_MyRate, " &
               " TrxHdr_FE, " &
               " TrxHdr_NetYTD, " &
               " TrxHdr_PFOnAgreedSalary, " &
               " TrxHdr_BasisOnSalary, " &
               " TrxHdr_GesiD, " &
               " TrxHdr_GesiC, " &
               " TrxHdr_Medical, " &
               " Com_Code, " &
               " TrxHdr_Year, " &
               " TrxHdr_GESIableAmount, " &
               " TrxHdr_BIK_GesiD, " &
               " TrxHdr_BIK_GesiC, " &
               " TrxHdr_BIK_Gesiable, " &
               " TrxHdr_AnalGen1, " &
               " TrxHdr_Maternity, " &
               " TrxHdr_FEPercent, " &
               " TrxHdr_FEControlAmount " &
               " )" &
               " VALUES (" &
               " @Emp_Code,                                           " &
               " @PrdGrp_Code,                                        " &
               " @PrdCod_Code,                                        " &
               " @PayCat_Code,                                        " &
               " @TrxHdr_Date,                                        " &
               " @TrxHdr_Status,                                      " &
               " @TrxHdr_TotalErnPeriod,                              " &
               " @TrxHdr_TotalErnYTD,                                 " &
               " @TrxHdr_TotalDedPeriod,                              " &
               " @TrxHdr_TotalDedYTD,                                 " &
               " @TrxHdr_TotalConPeriod,                              " &
               " @TrxHdr_TotalConYTD,                                 " &
               " @TrxHdr_SIIncome,                                    " &
               " @TrxHdr_TaxableIncome,                               " &
               " @TrxHdr_PaymentMethod,                               " &
               " @TrxHdr_PaymentRef,                                  " &
               " @TrxHdr_PeriodUnits,                                 " &
               " @TrxHdr_AnnualUnits,                                 " &
               " @TrxHdr_AnnualLeave,                                 " &
               " @TrxHdr_LifeInsurance,                               " &
               " @TrxHdr_Discounts,                                   " &
               " @TrxHdr_InterfaceStatus,                              " &
               " @TrxHdr_Overtime1," &
               " @TrxHdr_Overtime2," &
               " @TrxHdr_SIUnits," &
               " @TrxHdr_MonthlySalary," &
               " @TrxHdr_NetSalary," &
               " @TrxHdr_PeriodInsurable," &
               " @TemGrp_Code, " &
               " @TrxHdr_ChequeNo," &
               " @TrxHdr_TaxableFromOther," &
               " @TrxHdr_CurrencySymbol," &
               " @TrxHdr_Rate," &
               " @TrxHdr_NormalDays," &
               " @TrxHdr_Salary1," &
               " @TrxHdr_Salary2," &
               " @TrxHdr_Overtime3," &
               " @TrxHdr_Sectors," &
               " @TrxHdr_Dutyhours," &
               " @TrxHdr_FlightHours," &
               " @TrxHdr_Commission," &
               " @TrxHdr_PBAmount," &
               " @TrxHdr_PBRate," &
               " @TrxHdr_Overlay," &
               " @TrxHdr_PeriodSplit, " &
               " @TrxHdr_PeriodSplitSI, " &
               " @TrxHdr_A1, " &
               " @TrxHdr_A2, " &
               " @TrxHdr_A3, " &
               " @TrxHdr_A4, " &
               " @TrxHdr_A5, " &
               " @TrxHdr_Union, " &
               " @TrxHdr_Position, " &
               " @TrxHdr_COLA," &
               " @TrxHdr_MyRate," &
               " @TrxHdr_FE, " &
               " @TrxHdr_NetYTD, " &
               " @TrxHdr_PFOnAgreedSalary, " &
               " @TrxHdr_BasisOnSalary, " &
               " @TrxHdr_GesiD, " &
               " @TrxHdr_GesiC, " &
               " @TrxHdr_Medical, " &
               " @Com_Code, " &
               " @TrxHdr_Year, " &
               " @TrxHdr_GESIableAmount, " &
               " @TrxHdr_BIK_GesiD, " &
               " @TrxHdr_BIK_GesiC, " &
               " @TrxHdr_BIK_Gesiable, " &
               " @TrxHdr_AnalGen1, " &
               " @TrxHdr_Maternity, " &
               " @TrxHdr_FEPercent, " &
               " @TrxHdr_FEControlAmount " &
               " )" &
               " END" &
               " ELSE" &
               "   BEGIN" &
               "     UPDATE PrTxTrxnHeader" &
               "     SET " &
               "     Emp_Code=@Emp_Code,                                   " &
               "     PrdGrp_Code=@PrdGrp_Code," &
               "     PrdCod_Code=@PrdCod_Code,                             " &
               "     PayCat_Code=@PayCat_Code,                             " &
               "     TrxHdr_Date=@TrxHdr_Date,                             " &
               "    TrxHdr_Status=@TrxHdr_Status,                         " &
               "  TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " &
               "     TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " &
               "    TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " &
               "   TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " &
               "  TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " &
               " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " &
               " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " &
               " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " &
               " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " &
               " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " &
               " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " &
               " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " &
               " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,                " &
               " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " &
               " TrxHdr_Discounts=@TrxHdr_Discounts,                    " &
               " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,        " &
               " TrxHdr_Overtime1=@TrxHdr_Overtime1," &
               " TrxHdr_Overtime2=@TrxHdr_Overtime2," &
               " TrxHdr_SIUnits=@TrxHdr_SIUnits," &
               " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary," &
               " TrxHdr_NetSalary=@TrxHdr_NetSalary," &
               " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable," &
               " TemGrp_Code=@TemGrp_Code," &
               " TrxHdr_ChequeNo=@TrxHdr_ChequeNo ," &
               " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther," &
               " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol," &
               " TrxHdr_Rate=@TrxHdr_Rate," &
               " TrxHdr_NormalDays=@TrxHdr_NormalDays ," &
               " TrxHdr_Salary1=@TrxHdr_Salary1," &
               " TrxHdr_Salary2=@TrxHdr_Salary2," &
               " TrxHdr_Overtime3=@TrxHdr_Overtime3," &
               " TrxHdr_Sectors=@TrxHdr_Sectors," &
               " TrxHdr_Dutyhours=@TrxHdr_Dutyhours," &
               " TrxHdr_FlightHours=@TrxHdr_FlightHours," &
               " TrxHdr_Commission=@TrxHdr_Commission," &
               " TrxHdr_PBAmount=@TrxHdr_PBAmount," &
               " TrxHdr_PBRate=@TrxHdr_PBRate," &
               " TrxHdr_Overlay=@TrxHdr_Overlay," &
               " TrxHdr_PeriodSplit=@TrxHdr_PeriodSplit, " &
               " TrxHdr_PeriodSplitSI=@TrxHdr_PeriodSplitSI," &
               " TrxHdr_A1=@TrxHdr_A1, " &
               " TrxHdr_A2=@TrxHdr_A2, " &
               " TrxHdr_A3=@TrxHdr_A3, " &
               " TrxHdr_A4=@TrxHdr_A4, " &
               " TrxHdr_A5=@TrxHdr_A5, " &
               " TrxHdr_Union=@TrxHdr_Union, " &
               " TrxHdr_Position=@TrxHdr_Position, " &
               " TrxHdr_COLA=@TrxHdr_COLA," &
               " TrxHdr_MyRate=@TrxHdr_MyRate, " &
               " TrxHdr_FE=@TrxHdr_FE, " &
               " TrxHdr_NetYTD=@TrxHdr_NetYTD, " &
               " TrxHdr_PFOnAgreedSalary=@TrxHdr_PFOnAgreedSalary, " &
               " TrxHdr_BasisOnSalary=@TrxHdr_BasisOnSalary, " &
               " TrxHdr_GesiD=@TrxHdr_GesiD, " &
               " TrxHdr_GesiC=@TrxHdr_GesiC, " &
               " TrxHdr_Medical=@TrxHdr_Medical, " &
               " Com_Code=@Com_Code, " &
               " TrxHdr_Year=@TrxHdr_Year, " &
               " TrxHdr_GESIableAmount =@TrxHdr_GESIableAmount, " &
               " TrxHdr_BIK_GesiD = @TrxHdr_BIK_GesiD, " &
               " TrxHdr_BIK_GesiC = @TrxHdr_BIK_GesiC, " &
               " TrxHdr_BIK_Gesiable = @TrxHdr_BIK_Gesiable, " &
               " TrxHdr_AnalGen1 = @TrxHdr_AnalGen1, " &
               " TrxHdr_Maternity = @TrxHdr_Maternity, " &
               " TrxHdr_FEPercent = @TrxHdr_FEPercent, " &
               " TrxHdr_FEControlAmount = @TrxHdr_FEControlAmount " &
               " WHERE TrxHdr_Id = @TrxHdr_Id " &
               " END " &
               " set  @NewId=SCOPE_IDENTITY()"

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If


        Str = "Update PrMsEmployees set Emp_FEControlAmount=55000 where Emp_FirstEmployment='1'"
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("FEControlAmount is Updated for 55000", MsgBoxStyle.Information)
        Else
            MsgBox("No Update for 100000", MsgBoxStyle.Critical)
        End If

        Str = "Update PrMsEmployees set Emp_FEControlAmount=0 where Emp_FirstEmployment='0'"
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("FEControlAmount is Updated for 0.00", MsgBoxStyle.Information)
        Else
            MsgBox("No Update for 0.00", MsgBoxStyle.Critical)
        End If


        Return Proceed




        Return True
    End Function
    Public Function Upgrade_AddPenFundOndiscounts() As Boolean
        Dim Str As String
        Dim i As Integer
        Str = " ALTER TABLE PrTxEmployeeDiscounts  " &
        " ADD [EmpDis_PensionFund] decimal(18,2) "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("1 New columns Added in PrTxEmployeeDiscounts", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxEmployeeDiscounts", MsgBoxStyle.Critical)
        End If

        Str = " Update PrTxEmployeeDiscounts " &
       " set EmpDis_Pensionfund=0 "
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("Values Set To Zero", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Set Values to Zero", MsgBoxStyle.Critical)
        End If

        Str = " ALTER PROCEDURE [dbo].[AG_PrTxEmployeeDiscounts_SAVE_UPDATE] " &
        " @EmpDis_id int, " &
        " @Emp_Code varchar(16), " &
        " @PrdGrp_Code varchar(6), " &
        " @EmpDis_Discount1 decimal(10,2), " &
        " @EmpDis_Discount2 decimal(10,2), " &
        " @EmpDis_Discount3 decimal(10,2), " &
        " @EmpDis_Discount4 decimal(10,2), " &
        " @EmpDis_Discount5 decimal(10,2), " &
        " @EmpDis_Discount6 decimal(10,2), " &
        " @EmpDis_Discount7 decimal(10,2), " &
        " @EmpDis_Discount8 decimal(10,2), " &
        " @EmpDis_Discount9 decimal(10,2), " &
        " @EmpDis_Discount10 decimal(10,2), " &
        " @EmpDis_LifeInsurance decimal(10,2), " &
        " @Usr_Id int, " &
        " @EmpDis_CreationDate smalldatetime, " &
        " @EmpDis_AmendDate smalldatetime, " &
        " @EmpDis_Medical  decimal(18,2), " &
        " @EmpDis_Pensionfund  decimal(18,2), " &
        " @NewId Int OUTPUT " &
        " AS " &
        "  DECLARE @Result as Int " &
        "  Set @Result = 0 " &
        "  SELECT @Result = Count(*) " &
        "  FROM PrTxEmployeeDiscounts " &
        "  WHERE EmpDis_id = @EmpDis_id " &
        "  IF(@Result IS NULL) OR (@Result=0) " &
        "  BEGIN " &
        "  INSERT INTO PrTxEmployeeDiscounts " &
        "  (Emp_Code,       " &
        "  PrdGrp_Code,     " &
        "  EmpDis_Discount1,  " &
        "  EmpDis_Discount2,   " &
        "  EmpDis_Discount3,   " &
        "  EmpDis_Discount4,    " &
        "  EmpDis_Discount5,   " &
        "  EmpDis_Discount6,   " &
        "  EmpDis_Discount7,   " &
        "  EmpDis_Discount8,    " &
        "  EmpDis_Discount9,     " &
        "  EmpDis_Discount10,     " &
        "  EmpDis_LifeInsurance,    " &
        "  Usr_Id,                  " &
        "  EmpDis_CreationDate,      " &
        "  EmpDis_AmendDate,      " &
        "  EmpDis_Medical,      " &
        "  EmpDis_Pensionfund     " &
        "  ) " &
        "  VALUES ( " &
        "  @Emp_Code,     " &
        "  @PrdGrp_Code,        " &
        "  @EmpDis_Discount1,         " &
        "  @EmpDis_Discount2,     " &
        "  @EmpDis_Discount3,      " &
        "  @EmpDis_Discount4,       " &
        "  @EmpDis_Discount5,       " &
        "  @EmpDis_Discount6,        " &
        "  @EmpDis_Discount7,        " &
        "  @EmpDis_Discount8,        " &
        "  @EmpDis_Discount9,         " &
        "  @EmpDis_Discount10,          " &
        "  @EmpDis_LifeInsurance,         " &
        "  @Usr_Id,                        " &
        "  @EmpDis_CreationDate,         " &
        "  @EmpDis_AmendDate,             " &
        "  @EmpDis_Medical,             " &
        "  @EmpDis_Pensionfund             " &
        "  ) " &
        "  END " &
        "  ELSE " &
        "  BEGIN " &
        "  UPDATE PrTxEmployeeDiscounts " &
        "  SET  " &
        "  Emp_Code=@Emp_Code,          " &
        "  PrdGrp_Code=@PrdGrp_Code,      " &
        "  EmpDis_Discount1=@EmpDis_Discount1,  " &
        "  EmpDis_Discount2=@EmpDis_Discount2,    " &
        "  EmpDis_Discount3=@EmpDis_Discount3,     " &
        "  EmpDis_Discount4=@EmpDis_Discount4,     " &
        "  EmpDis_Discount5=@EmpDis_Discount5,      " &
        "  EmpDis_Discount6=@EmpDis_Discount6,      " &
        "  EmpDis_Discount7=@EmpDis_Discount7,       " &
        "  EmpDis_Discount8=@EmpDis_Discount8,       " &
        "  EmpDis_Discount9=@EmpDis_Discount9,       " &
        "  EmpDis_Discount10=@EmpDis_Discount10,       " &
        "  EmpDis_LifeInsurance=@EmpDis_LifeInsurance,     " &
        "  Usr_Id=@Usr_Id,     " &
        "  EmpDis_CreationDate=@EmpDis_CreationDate,  " &
        "  EmpDis_AmendDate=@EmpDis_AmendDate,      " &
        "  EmpDis_Medical=@EmpDis_Medical,      " &
        "  EmpDis_PensionFund=@EmpDis_PensionFund  " &
        "  WHERE EmpDis_id = @EmpDis_id  " &
        "  END " &
        " set @NewId=SCOPE_IDENTITY() "

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployeesDiscount was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable to Update SP PrMsEmployeeDiscount", MsgBoxStyle.Critical)
        End If




        Return Proceed



    End Function
    Protected Function Upgrade_2023_07()


        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True


        Str = "ALTER TABLE AdMsCompany " & _
        " ADD [Com_Stamp] image NULL "




        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("New columns Added in AdMsCompany", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in AdMsCompany", MsgBoxStyle.Critical)
        End If


        ' Alter SPs                                     

        Str = "ALTER PROCEDURE [dbo].[AG_AdMsCompany_SAVE_UPDATE] " & _
             "@Com_Id integer, " & _
             "@Com_Code char(8), " & _
             "@Com_Name varchar(100), " & _
             "@Com_NameS varchar(30), " & _
             "@Com_TIC varchar(12), " & _
             "@Com_TaxCard  varchar(50), " & _
             "@Com_SIRegNo  varchar(50), " & _
             "@Com_CurSymbol  varchar(5), " & _
             "@Com_Address1  varchar(100), " & _
             "@Com_Address2  varchar(100), " & _
             "@Com_Address3  varchar(100), " & _
             "@Com_Address4  varchar(100), " & _
             "@Com_Tel1  varchar(20), " & _
             "@Com_Tel2  varchar(20), " & _
             "@Com_Fax1  varchar(20), " & _
             "@Com_Fax2  varchar(20), " & _
             "@Com_AccountantPostCode  varchar(50), " & _
             "@Com_AccountantPOBox  varchar(50), " & _
             "@Com_AccountantTitle  varchar(50), " & _
             "@Com_AccTIC  varchar(9), " & _
             "@Com_AccIdentity int, " & _
             "@Com_TICCategory int, " & _
             "@Com_TICType  int, " & _
             "@Com_BankCode varchar(3), " & _
             "@Com_GLAnal1 varchar(20), " & _
             "@Com_GLAnal2 varchar(20), " & _
             "@Com_GLAnal3 varchar(20), " & _
             "@Com_GLAnal4 varchar(20), " & _
             "@Com_GLAnal5 varchar(20), " & _
             "@Com_TSAccount varchar(50), " & _
             "@Com_TSAccountType varchar(2), " & _
             "@Com_TSBalAccount varchar(50), " & _
             "@Com_TSBalAccountType varchar(2), " & _
             "@Com_TSDefaultJob varchar(50), " & _
             "@Com_SI2 varchar(50), " & _
             "@Com_SI3 varchar(50), " & _
             "@Com_SI4 varchar(50), " & _
             "@Com_SI5 varchar(50), " & _
             "@Com_BankCode2 varchar(50), " & _
             "@Com_BankCode3 varchar(50), " & _
             "@Com_BankCode4 varchar(50), " & _
             "@Com_Logo image, " & _
             "@Com_Stamp image " & _
             " " & _
             "AS " & _
             "DECLARE @Result as Int " & _
             "  Set @Result = 0 " & _
             "  SELECT @Result = Count(*) " & _
             "  FROM AdMsCompany " & _
             "  WHERE Com_Id = @Com_Id " & _
             "  IF(@Result IS NULL) OR (@Result=0) " & _
             "    BEGIN " & _
             "      INSERT INTO AdMsCompany " & _
             "      (Com_Id,   " & _
             "	    Com_Code, " & _
             "		Com_Name, " & _
             "		Com_NameS, " & _
             "		Com_TIC, " & _
             "		Com_TaxCard, " & _
             "		Com_SIRegNo, " & _
             "		Com_CurSymbol, " & _
             "		Com_Address1, " & _
             "		Com_Address2, " & _
             "		Com_Address3, " & _
             "		Com_Address4, " & _
             "		Com_Tel1, " & _
             "		Com_Tel2, " & _
             "		Com_Fax1, " & _
             "		Com_Fax2, " & _
             "		Com_AccountantPostCode, " & _
             "		Com_AccountantPOBox, " & _
             "		Com_AccountantTitle, " & _
             "       Com_AccTIC, " & _
             "		Com_AccIdentity, " & _
             "		Com_TICCategory, " & _
             "		Com_TICType, " & _
             "		Com_BankCode, " & _
             "        Com_GLAnal1,  " & _
             "		Com_GLAnal2,  " & _
             "		Com_GLAnal3,  " & _
             "		Com_GLAnal4,   " & _
             "		Com_GLAnal5, " & _
             "		Com_TSAccount, " & _
             "		Com_TSAccountType, " & _
             "		Com_TSBalAccount, " & _
             "		Com_TSBalAccountType, " & _
             "		Com_TSDefaultJob, " & _
             "		Com_SI2, " & _
             "		Com_SI3, " & _
             "		Com_SI4, " & _
             "		Com_SI5, " & _
             "		Com_BankCode2, " & _
             " 		Com_BankCode3, " & _
             "      Com_BankCode4, " & _
             "      Com_Logo, " & _
             "      Com_Stamp " & _
             "     ) " & _
             "    VALUES ( " & _
             "		@Com_Id, " & _
             "		@Com_Code, " & _
             "		@Com_Name, " & _
             "		@Com_NameS, " & _
             "		@Com_TIC, " & _
             "		@Com_TaxCard, " & _
             "		@Com_SIRegNo, " & _
             "		@Com_CurSymbol, " & _
             "		@Com_Address1, " & _
             "		@Com_Address2, " & _
             "		@Com_Address3, " & _
             "		@Com_Address4, " & _
             "		@Com_Tel1, " & _
             "		@Com_Tel2, " & _
             "		@Com_Fax1, " & _
             "		@Com_Fax2, " & _
             "		@Com_AccountantPostCode, " & _
             "		@Com_AccountantPOBox, " & _
             "		@Com_AccountantTitle, " & _
             "		@Com_AccTIC, " & _
             "		@Com_AccIdentity, " & _
             "		@Com_TICCategory, " & _
             "		@Com_TICType, " & _
             "		@Com_BankCode, " & _
             "		@Com_GLAnal1,  " & _
             "		@Com_GLAnal2,  " & _
             "		@Com_GLAnal3,  " & _
             "		@Com_GLAnal4,  " & _
             "		@Com_GLAnal5, " & _
             "		@Com_TSAccount, " & _
             "		@Com_TSAccountType, " & _
             "		@Com_TSBalAccount, " & _
             "		@Com_TSBalAccountType, " & _
             "		@Com_TSDefaultJob, " & _
             "		@Com_SI2, " & _
             "		@Com_SI3, " & _
             "		@Com_SI4, " & _
             "		@Com_SI5, " & _
             "		@Com_BankCode2, " & _
             "		@Com_BankCode3, " & _
             "		@Com_BankCode4, " & _
             "		@Com_Logo, " & _
             "      @Com_Stamp " & _
             "     ) " & _
             "      End " & _
             " ELSE " & _
             "       BEGIN " & _
             "       UPDATE AdMsCompany " & _
             "    SET  " & _
             "	    Com_Code=@Com_Code, " & _
             "		Com_Name=@Com_Name, " & _
             "		Com_NameS=@Com_NameS, " & _
             "		Com_TIC=@Com_TIC, " & _
             "		Com_TaxCard=@Com_TaxCard, " & _
             "		Com_SIRegNo=@Com_SIRegNo, " & _
             "		Com_CurSymbol=@Com_CurSymbol, " & _
             "		Com_Address1=@Com_Address1, " & _
             "		Com_Address2=@Com_Address2, " & _
             "		Com_Address3=@Com_Address3, " & _
             "		Com_Address4=@Com_Address4, " & _
             "		Com_Tel1=@Com_Tel1, " & _
             "		Com_Tel2=@Com_Tel2, " & _
             "		Com_Fax1=@Com_Fax1, " & _
             "		Com_Fax2=@Com_Fax2, " & _
             "		Com_AccountantPostCode=@Com_AccountantPostCode, " & _
             "		Com_AccountantPOBox=@Com_AccountantPOBox, " & _
             "		Com_AccountantTitle=@Com_AccountantTitle, " & _
             "       Com_AccTIC=@Com_AccTIC, " & _
             "		Com_AccIdentity=@Com_AccIdentity, " & _
             "		Com_TICCategory=@Com_TICCategory, " & _
             "		Com_TICType=@Com_TICType, " & _
             "		Com_BankCode=@Com_BankCode, " & _
             "		Com_GLAnal1=@Com_GLAnal1,  " & _
             "		Com_GLAnal2=@Com_GLAnal2,  " & _
             "		Com_GLAnal3=@Com_GLAnal3,  " & _
             "		Com_GLAnal4=@Com_GLAnal4,  " & _
             "		Com_GLAnal5=@Com_GLAnal5, " & _
             "		Com_TSAccount=@Com_TSAccount, " & _
             "		Com_TSAccountType=@Com_TSAccountType, " & _
             "		Com_TSBalAccount=@Com_TSBalAccount, " & _
             "		Com_TSBalAccountType=@Com_TSBalAccountType, " & _
             "		Com_TSDefaultJob=@Com_TSDefaultJob, " & _
             "		Com_SI2=@Com_SI2, " & _
             "		Com_SI3=@Com_SI3, " & _
             "		Com_SI4=@Com_SI4, " & _
             "		Com_SI5=@Com_SI5, " & _
             "		Com_BankCode2=@Com_BankCode2, " & _
             "		Com_BankCode3=@Com_BankCode3, " & _
             "		Com_BankCode4=@Com_BankCode4, " & _
             "		Com_Logo=@Com_Logo, " & _
             "		Com_Stamp=@Com_Stamp " & _
             "     WHERE Com_Id = @Com_Id " & _
             "      End "

        i = MyBase.ExecuteNonQuery(Str)
        If i < 0 Then
            F = False
        End If


        Return F




    End Function
    Protected Function Upgrade_2024_01()


        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True


        Str = " update PrSsSocialInsurance " & _
            " set socinc_dedvalue=8.80," & _
            " SocIns_ConValue=8.80," & _
            " SocInc_Desc='SI D 8.80 - C 8.80'" & _
            " where socinc_dedvalue=8.3 and SocIns_ConValue=8.3"


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SI Rates On Table are updated to 8.80%", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to Change Rates", MsgBoxStyle.Critical)
        End If

        Str = " update PrMsEmployeedeductions set EmpDed_Value ='8.80' where DedCod_Code ='D7' and EmpDed_Value ='8.30'"
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SI Deduction Rates On Employee Deductions are updated to 8.80%", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to Change Rates on Deductions ", MsgBoxStyle.Critical)
        End If


       
        Str = " update PrMsEmployeeContributions set  EmpCon_Value ='8.80' where ConCod_Code ='C4' and EmpCon_Value ='8.30'"
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SI Contribution Rates On Employee Contributions are updated to 8.80%", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to Change Rates on Contributions ", MsgBoxStyle.Critical)
        End If



        Return F


    End Function
    Protected Function Upgrade_2024_02()


        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True


        Str = " update PrSsSocialInsurance " & _
            " set socinc_dedvalue=4.45," & _
            " SocIns_ConValue=13.15," & _
            " SocInc_Desc='SI D 4.45 - C 13.15'" & _
            " where socinc_dedvalue=4.20 and SocIns_ConValue=12.40"


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SI Rates On Table are updated to 4.45% and 13.15%", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to Change Rates", MsgBoxStyle.Critical)
        End If

        Str = " update PrMsEmployeedeductions set EmpDed_Value ='4.45' where DedCod_Code ='D7' and EmpDed_Value ='4.20'"
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SI Deduction Rates On Employee Deductions are updated to 4.45%", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to Change Rates on Deductions ", MsgBoxStyle.Critical)
        End If



        Str = " update PrMsEmployeeContributions set  EmpCon_Value ='13.15' where ConCod_Code ='C4' and EmpCon_Value ='12.40'"
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SI Contribution Rates On Employee Contributions are updated to 13.15%", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to Change Rates on Contributions ", MsgBoxStyle.Critical)
        End If



        Return F


    End Function
    Public Function FindNumberOfNormalPeriodsForThisEmployeeForThisPeriodGroup(ByVal glbcurrentperiod As cPrMsPeriodCodes, ByVal EmpCode As String) As Integer
        Dim Str As String
        Dim RetValue As Integer
        Str = "Select count(*) from PrTxTrxnHeader where emp_code=" & enQuoteString(EmpCode) & _
        " AND PrdGrp_Code=" & enQuoteString(glbcurrentperiod.PrdGrpCode) & _
        " AND PayCat_Code='K'"
        Dim Ds As DataSet
        Ds = GetData(Str)
        If CheckDataSet(Ds) Then
            retvalue = DbNullToInt(Ds.Tables(0).Rows(0).Item(0))
            retvalue = retvalue + 1
        Else
            RetValue = 1
        End If
        Return retvalue
    End Function
    Public Function RemoveFirstEmploymentFromActiveEmployees(ByVal TemplateGroup As String) As Boolean
        Dim Str As String
        Dim Flag As Boolean = False
        Str = " update PrMsEmployees " &
        " set Emp_FirstEmployment = '0', " &
        " Emp_50PerOff = '0', " &
        " Emp_Force50Percent = '0', " &
        " Emp_FEControlAmount = 0.00 " &
        " where TemGrp_Code = " & enQuoteString(TemplateGroup) &
        " and Emp_Status = 'A' " &
        " and Emp_FirstEmployment = '1' "
        Dim i As Integer
        i = MyBase.ExecuteNonQuery(Str)
        If i >= 0 Then
            flag = True
        End If
        Return Flag
    End Function
    Protected Function CheckIfThisAnalysisIsUsed(AnalysisCode As String, Analysis As Integer) As DataSet
        Dim Str As String = ""
        Dim str2 As String = ""

        Str = "Select Emp_Code," &
            " Emp_FullName  ," &
            " TemGrp_Code " &
            " from PrMsEmployees "

        Select Case Analysis
            Case 1
                str2 = " where EmpAn1_Code = " & enQuoteString(AnalysisCode)
            Case 2
                str2 = " where EmpAn2_Code = " & enQuoteString(AnalysisCode)
            Case 3
                str2 = " where EmpAn3_Code = " & enQuoteString(AnalysisCode)
            Case 4
                str2 = " where EmpAn4_Code = " & enQuoteString(AnalysisCode)
            Case 5
                str2 = " where EmpAn5_Code = " & enQuoteString(AnalysisCode)
        End Select

        Str = Str & str2
        Return GetData(Str)

    End Function
    Protected Function GetAllPrAnScales1() As DataSet
        Dim Str As String
        Str = " SELECT" &
                " Sc1_Code," &
                " Sc1_Description" &
            "  FROM PrAnScales1" &
            "  Order by Sc1_Code Asc "
        Return MyBase.GetData(Str)
    End Function
    Protected Function GetAllPrAnScales2() As DataSet
        Dim Str As String
        Str = " SELECT" &
                " Sc2_Code," &
                " Sc2_Description" &
            "  FROM PrAnScales2" &
            "  Order by Sc2_Code Asc "
        Return MyBase.GetData(Str)
    End Function
    Protected Function GetAllPrAnScales3() As DataSet
        Dim Str As String
        Str = " SELECT" &
                " Sc3_Code," &
                " Sc3_Description" &
            "  FROM PrAnScales3" &
            "  Order by Sc3_Code Asc "
        Return MyBase.GetData(Str)
    End Function
    Protected Function GetAllPrMsEmployeeExtraDetails() As DataSet

        Dim Str As String
        Str = " SELECT " &
        " PrMsEmployees.Emp_code,  " &
        " PrMsEmployees.Emp_FullName, " &
        " PrMsEmployees.Emp_Status,  " &
        " PrMsEmployees.TemGrp_Code,  " &
        " PrMsEmployees.Emp_SocialInsNumber, " &
        " PrMsEmployees.Emp_IdentificationCard, " &
        " PrMsEmployees.Emp_BirthDate,  " &
        " PrMsEmployees.Emp_Sex,  " &
        " PrMsEmployeeExtraDetails.Emp_StartDateToPrevServ, " &
        " PrMsEmployeeExtraDetails.PosCat_Code, " &
        " PrMsEmployeeExtraDetails.PosRnk_Code, " &
        " PrMsEmployeeExtraDetails.Rnk_Code, " &
        " PrMsEmployeeExtraDetails.Emp_RetirementDate63,  " &
        " PrMsEmployeeExtraDetails.Emp_RetirementDate65, " &
        " PrMsEmployeeExtraDetails.Emp_ComDate400Months,  " &
        " PrMsEmployeeExtraDetails.Emp_ExtraRatePerHour,  " &
        " PrMsEmployeeExtraDetails.Emp_DOfNextRateIncrease,  " &
        " PrMsEmployeeExtraDetails.Emp_IsTop, " &
        " PrMsEmployeeExtraDetails.Emp_ProvidentFund,  " &
        " PrMsEmployeeExtraDetails.Emp_PensionFund, " &
        " PrMsEmployeeExtraDetails.Emp_DOfStartPrFund,  " &
        " PrMsEmployeeExtraDetails.Emp_10PercentDecrease " &
        " FROM     PrMsEmployeeExtraDetails INNER JOIN " &
        " PrMsEmployees ON PrMsEmployeeExtraDetails.Emp_Code = PrMsEmployees.Emp_Code COLLATE SQL_Latin1_General_CP1_CI_AI " &
        " Order by PrMsEmployees.Emp_Status Asc," &
        " PrMsEmployees.Emp_Code Asc," &
        " PrMsEmployees.TemGrp_Code Asc"

        Return MyBase.GetData(Str)

    End Function

    Protected Function Upgrade_2024_03()


        Dim Str As String
        Dim i As Integer
        Dim F As Boolean = True


        Str = "alter table pranemployeeanalysis1 alter column EmpAn1_DescriptionL nvarchar(40)"
        i = ExecuteNonQuery(Str)
        Str = "alter table pranemployeeanalysis1 alter column EmpAn1_Descriptions nvarchar(15)"
        i = ExecuteNonQuery(Str)

        Str = "alter table pranemployeeanalysis2 alter column EmpAn2_DescriptionL nvarchar(40)"
        i = ExecuteNonQuery(Str)
        Str = "alter table pranemployeeanalysis2 alter column EmpAn2_Descriptions nvarchar(15)"
        i = ExecuteNonQuery(Str)

        Str = "alter table pranemployeeanalysis3 alter column EmpAn3_DescriptionL nvarchar(40)"
        i = ExecuteNonQuery(Str)
        Str = "alter table pranemployeeanalysis3 alter column EmpAn3_Descriptions nvarchar(15)"
        i = ExecuteNonQuery(Str)

        Str = "alter table pranemployeeanalysis4 alter column EmpAn4_DescriptionL nvarchar(40)"
        i = ExecuteNonQuery(Str)
        Str = "alter table pranemployeeanalysis4 alter column EmpAn4_Descriptions nvarchar(15)"
        i = ExecuteNonQuery(Str)

        Str = "alter table pranemployeeanalysis5 alter column EmpAn5_DescriptionL nvarchar(40)"
        i = ExecuteNonQuery(Str)
        Str = "alter table pranemployeeanalysis5 alter column EmpAn5_Descriptions nvarchar(15)"
        i = ExecuteNonQuery(Str)

        Str = " ALTER PROCEDURE [dbo].[AG_PrAnEmployeeAnalysis1_SAVE_UPDATE] " &
        " @EmpAn1_Code varchar(12), " &
        " @EmpAn1_DescriptionL nvarchar(40), " &
        " @EmpAn1_DescriptionS nvarchar(15), " &
        " @EmpAn1_IsActive char(1), " &
        " @EmpAn1_GLAnal1 varchar(12), " &
        " @EmpAn1_GLAnal2 varchar(12), " &
        " @EmpAn1_CreationDate smalldatetime, " &
        " @EmpAn1_AmendDate smalldatetime " &
        " AS " &
        "  DECLARE @Result as Int " &
        "  Set @Result = 0 " &
        "  SELECT @Result = Count(*) " &
        "  FROM PrAnEmployeeAnalysis1 " &
        "  WHERE EmpAn1_Code = @EmpAn1_Code " &
        "  IF(@Result IS NULL) OR (@Result=0) " &
        "    BEGIN " &
        "      INSERT INTO PrAnEmployeeAnalysis1 " &
        "     (EmpAn1_Code, " &
        "      EmpAn1_DescriptionL, " &
        "      EmpAn1_DescriptionS, " &
        "      EmpAn1_IsActive, " &
        "      EmpAn1_GLAnal1, " &
        "      EmpAn1_GLAnal2, " &
        "      EmpAn1_CreationDate, " &
        "      EmpAn1_AmendDate " &
        "      ) " &
        "      VALUES ( " &
        "      @EmpAn1_Code, " &
        "      @EmpAn1_DescriptionL, " &
        "      @EmpAn1_DescriptionS, " &
        "      @EmpAn1_IsActive, " &
        "      @EmpAn1_GLAnal1, " &
        "      @EmpAn1_GLAnal2, " &
        "      @EmpAn1_CreationDate, " &
        "      @EmpAn1_AmendDate " &
        "      ) " &
        "    END " &
        "  ELSE " &
        "    BEGIN " &
        "      UPDATE PrAnEmployeeAnalysis1 " &
        "      SET  " &
        "      EmpAn1_Code=@EmpAn1_Code, " &
        "      EmpAn1_DescriptionL=@EmpAn1_DescriptionL, " &
        "      EmpAn1_DescriptionS=@EmpAn1_DescriptionS, " &
        "      EmpAn1_IsActive=@EmpAn1_IsActive, " &
        "      EmpAn1_GLAnal1=@EmpAn1_GLAnal1, " &
        "      EmpAn1_GLAnal2=@EmpAn1_GLAnal2, " &
        "      EmpAn1_CreationDate=@EmpAn1_CreationDate, " &
        "      EmpAn1_AmendDate=@EmpAn1_AmendDate " &
        "      WHERE EmpAn1_Code = @EmpAn1_Code " &
        "  END "

        i = ExecuteNonQuery(Str)

        Str = " ALTER PROCEDURE [dbo].[AG_PrAnEmployeeAnalysis2_SAVE_UPDATE] " &
        " @EmpAn2_Code varchar(12), " &
        " @EmpAn2_DescriptionL nvarchar(40), " &
        " @EmpAn2_DescriptionS nvarchar(15), " &
        " @EmpAn2_IsActive char(1), " &
        " @EmpAn2_GLAnal1 varchar(12), " &
        " @EmpAn2_GLAnal2 varchar(12), " &
        " @EmpAn2_CreationDate smalldatetime, " &
        " @EmpAn2_AmendDate smalldatetime " &
        " AS " &
        "  DECLARE @Result as Int " &
        "  Set @Result = 0 " &
        "  SELECT @Result = Count(*) " &
        "  FROM PrAnEmployeeAnalysis2 " &
        "  WHERE EmpAn2_Code = @EmpAn2_Code " &
        "  IF(@Result IS NULL) OR (@Result=0) " &
        "    BEGIN " &
        "      INSERT INTO PrAnEmployeeAnalysis2 " &
        "     (EmpAn2_Code, " &
        "      EmpAn2_DescriptionL, " &
        "      EmpAn2_DescriptionS, " &
        "      EmpAn2_IsActive, " &
        "      EmpAn2_GLAnal1, " &
        "     EmpAn2_GLAnal2, " &
        "      EmpAn2_CreationDate, " &
        "     EmpAn2_AmendDate " &
        "     ) " &
        "     VALUES ( " &
        "     @EmpAn2_Code, " &
        "     @EmpAn2_DescriptionL, " &
        "     @EmpAn2_DescriptionS, " &
        "     @EmpAn2_IsActive, " &
        "     @EmpAn2_GLAnal1, " &
        "     @EmpAn2_GLAnal2, " &
        "     @EmpAn2_CreationDate, " &
        "     @EmpAn2_AmendDate " &
        "     ) " &
        "   END " &
        " ELSE " &
        "   BEGIN " &
        "     UPDATE PrAnEmployeeAnalysis2 " &
        "     SET  " &
        "     EmpAn2_Code=@EmpAn2_Code, " &
        "     EmpAn2_DescriptionL=@EmpAn2_DescriptionL, " &
        "     EmpAn2_DescriptionS=@EmpAn2_DescriptionS, " &
        "     EmpAn2_IsActive=@EmpAn2_IsActive, " &
        "     EmpAn2_GLAnal1=@EmpAn2_GLAnal1, " &
        "     EmpAn2_GLAnal2=@EmpAn2_GLAnal2, " &
        "     EmpAn2_CreationDate=@EmpAn2_CreationDate, " &
        "     EmpAn2_AmendDate=@EmpAn2_AmendDate " &
        "     WHERE EmpAn2_Code = @EmpAn2_Code " &
        " END "

        i = ExecuteNonQuery(Str)

        Str = " ALTER PROCEDURE [dbo].[AG_PrAnEmployeeAnalysis3_SAVE_UPDATE] " &
        " @EmpAn3_Code varchar(12), " &
        " @EmpAn3_DescriptionL nvarchar(40), " &
        " @EmpAn3_DescriptionS nvarchar(15), " &
        " @EmpAn3_IsActive char(1), " &
        " @EmpAn3_GLAnal1 varchar(12), " &
        " @EmpAn3_GLAnal2 varchar(12), " &
        " @EmpAn3_CreationDate smalldatetime, " &
        " @EmpAn3_AmendDate smalldatetime " &
        " AS " &
        "  DECLARE @Result as Int " &
        "  Set @Result = 0 " &
        "  SELECT @Result = Count(*) " &
        "  FROM PrAnEmployeeAnalysis3 " &
        "  WHERE EmpAn3_Code = @EmpAn3_Code " &
        "  IF(@Result IS NULL) OR (@Result=0) " &
        "    BEGIN " &
        "      INSERT INTO PrAnEmployeeAnalysis3 " &
        "     (EmpAn3_Code, " &
        "      EmpAn3_DescriptionL, " &
        "      EmpAn3_DescriptionS, " &
        "      EmpAn3_IsActive, " &
        "      EmpAn3_GLAnal1, " &
        "      EmpAn3_GLAnal2,  " &
        "      EmpAn3_CreationDate,  " &
        "      EmpAn3_AmendDate  " &
        "     ) " &
        "    VALUES ( " &
        "     @EmpAn3_Code, " &
        "     @EmpAn3_DescriptionL, " &
        "     @EmpAn3_DescriptionS,  " &
        "     @EmpAn3_IsActive,  " &
        "     @EmpAn3_GLAnal1,  " &
        "     @EmpAn3_GLAnal2,  " &
        "     @EmpAn3_CreationDate,   " &
        "     @EmpAn3_AmendDate   " &
        "     ) " &
        "   END " &
        " ELSE " &
        "   BEGIN " &
        "     UPDATE PrAnEmployeeAnalysis3 " &
        "     SET  " &
        "     EmpAn3_Code=@EmpAn3_Code, " &
        "     EmpAn3_DescriptionL=@EmpAn3_DescriptionL, " &
        "     EmpAn3_DescriptionS=@EmpAn3_DescriptionS,  " &
        "     EmpAn3_IsActive=@EmpAn3_IsActive, " &
        "     EmpAn3_GLAnal1=@EmpAn3_GLAnal1,  " &
        "     EmpAn3_GLAnal2=@EmpAn3_GLAnal2,  " &
        "     EmpAn3_CreationDate=@EmpAn3_CreationDate, " &
        "     EmpAn3_AmendDate=@EmpAn3_AmendDate  " &
        "     WHERE EmpAn3_Code = @EmpAn3_Code " &
        " END "

        i = ExecuteNonQuery(Str)






        Str = " ALTER PROCEDURE [dbo].[AG_PrAnEmployeeAnalysis4_SAVE_UPDATE] " &
        " @EmpAn4_Code varchar(12), " &
        " @EmpAn4_DescriptionL nvarchar(40), " &
        " @EmpAn4_DescriptionS nvarchar(15), " &
        " @EmpAn4_IsActive char(1), " &
        " @EmpAn4_GLAnal1 varchar(12), " &
        " @EmpAn4_GLAnal2 varchar(12), " &
        " @EmpAn4_CreationDate smalldatetime, " &
        " @EmpAn4_AmendDate smalldatetime " &
        " AS " &
        "  DECLARE @Result as Int " &
        "  Set @Result = 0 " &
        "  SELECT @Result = Count(*) " &
        "  FROM PrAnEmployeeAnalysis4 " &
        "  WHERE EmpAn4_Code = @EmpAn4_Code " &
        "  IF(@Result IS NULL) OR (@Result=0) " &
        "    BEGIN " &
        "      INSERT INTO PrAnEmployeeAnalysis4 " &
        "     (EmpAn4_Code,    " &
        "      EmpAn4_DescriptionL,  " &
        "      EmpAn4_DescriptionS,   " &
        "      EmpAn4_IsActive,      " &
        "      EmpAn4_GLAnal1,      " &
        "      EmpAn4_GLAnal2,       " &
        "      EmpAn4_CreationDate, " &
        "      EmpAn4_AmendDate " &
        "      ) " &
        "      VALUES ( " &
        "      @EmpAn4_Code,  " &
        "      @EmpAn4_DescriptionL, " &
        "      @EmpAn4_DescriptionS,  " &
        "      @EmpAn4_IsActive,  " &
        "      @EmpAn4_GLAnal1,   " &
        "      @EmpAn4_GLAnal2,   " &
        "      @EmpAn4_CreationDate,   " &
        "      @EmpAn4_AmendDate   " &
        "      ) " &
        "    END " &
        "  ELSE " &
        "    BEGIN " &
        "      UPDATE PrAnEmployeeAnalysis4 " &
        "      SET  " &
        "      EmpAn4_Code=@EmpAn4_Code, " &
        "      EmpAn4_DescriptionL=@EmpAn4_DescriptionL, " &
        "      EmpAn4_DescriptionS=@EmpAn4_DescriptionS, " &
        "      EmpAn4_IsActive=@EmpAn4_IsActive,  " &
        "      EmpAn4_GLAnal1=@EmpAn4_GLAnal1, " &
        "      EmpAn4_GLAnal2=@EmpAn4_GLAnal2,   " &
        "      EmpAn4_CreationDate=@EmpAn4_CreationDate, " &
        "      EmpAn4_AmendDate=@EmpAn4_AmendDate  " &
        "      WHERE EmpAn4_Code = @EmpAn4_Code " &
        "  END "
        i = ExecuteNonQuery(Str)

        Str = " ALTER PROCEDURE [dbo].[AG_PrAnEmployeeAnalysis5_SAVE_UPDATE] " &
        " @EmpAn5_Code varchar(12), " &
        " @EmpAn5_DescriptionL nvarchar(40), " &
        " @EmpAn5_DescriptionS nvarchar(15), " &
        " @EmpAn5_IsActive char(1), " &
        " @EmpAn5_GLAnal1 varchar(200), " &
        " @EmpAn5_GLAnal2 varchar(200), " &
        " @EmpAn5_CreationDate smalldatetime, " &
        " @EmpAn5_AmendDate smalldatetime " &
        " AS " &
        "  DECLARE @Result as Int " &
        "  Set @Result = 0 " &
        "  SELECT @Result = Count(*) " &
        "  FROM PrAnEmployeeAnalysis5 " &
        "  WHERE EmpAn5_Code = @EmpAn5_Code " &
        "  IF(@Result IS NULL) OR (@Result=0) " &
        "    BEGIN " &
        "      INSERT INTO PrAnEmployeeAnalysis5 " &
        "     (EmpAn5_Code,                                        " &
        "      EmpAn5_DescriptionL,                                " &
        "      EmpAn5_DescriptionS,                                " &
        "      EmpAn5_IsActive,                                    " &
        "      EmpAn5_GLAnal1,                                     " &
        "      EmpAn5_GLAnal2,                                     " &
        "      EmpAn5_CreationDate,                                " &
        "      EmpAn5_AmendDate                                    " &
        "      ) " &
        "      VALUES ( " &
        "      @EmpAn5_Code,                                       " &
        "      @EmpAn5_DescriptionL,                               " &
        "      @EmpAn5_DescriptionS,                               " &
        "      @EmpAn5_IsActive,                                   " &
        "      @EmpAn5_GLAnal1,                                    " &
        "      @EmpAn5_GLAnal2,                                    " &
        "      @EmpAn5_CreationDate,                               " &
        "      @EmpAn5_AmendDate                                   " &
        "      ) " &
        "    END " &
        "  ELSE " &
        "    BEGIN " &
        "      UPDATE PrAnEmployeeAnalysis5 " &
        "      SET  " &
        "      EmpAn5_Code=@EmpAn5_Code,                             " &
        "      EmpAn5_DescriptionL=@EmpAn5_DescriptionL,             " &
        "      EmpAn5_DescriptionS=@EmpAn5_DescriptionS,             " &
        "      EmpAn5_IsActive=@EmpAn5_IsActive,                     " &
        "      EmpAn5_GLAnal1=@EmpAn5_GLAnal1,                       " &
        "      EmpAn5_GLAnal2=@EmpAn5_GLAnal2,                       " &
        "      EmpAn5_CreationDate=@EmpAn5_CreationDate,             " &
        "      EmpAn5_AmendDate=@EmpAn5_AmendDate                    " &
        "      WHERE EmpAn5_Code = @EmpAn5_Code " &
        "  END "

        i = ExecuteNonQuery(Str)

        MsgBox("Done")
    End Function

    Protected Function Upgrade_2024_04()
        Dim Par As New cPrSsParameters
        Par.Id = 0
        Par.Section = "System"
        Par.Item = "MFLimit"
        Par.Value1 = "2.00"
        Par.Type1 = "T"
        Par.System1 = "N"
        Par.Description = "Med Fund Limit"
        If Not Par.Save() Then
            MsgBox("Error")
        End If




        Par = New cPrSsParameters
        Par.Id = 0
        Par.Section = "System"
        Par.Item = "PFLimit"
        Par.Value1 = "10.00"
        Par.Type1 = "T"
        Par.System1 = "N"
        Par.Description = "Pro Fund Limit"
        If Not Par.Save() Then
            MsgBox("Error")
        End If



        MsgBox("Done")
    End Function
    Protected Function Upgrade_2024_05()

        Dim Anl1 As New cPrAnEmployeeAnalysis1
        With Anl1
            .Code = "ENEW"
            .DescriptionL = "Exelsys New Value"
            .DescriptionS = "Exelsys New Value"
            .IsActive = "Y"
            .GLAnal1 = 0
            .GLAnal2 = 0
            .CreationDate = Now.Date
            .AmendDate = Now.Date
            If Not .Save() Then
                MsgBox("Error")
            End If
        End With
        Dim Anl2 As New cPrAnEmployeeAnalysis2
        With Anl2
            .Code = "ENEW"
            .DescriptionL = "Exelsys New Value"
            .DescriptionS = "Exelsys New Value"
            .IsActive = "Y"
            .GLAnal1 = 0
            .GLAnal2 = 0
            .CreationDate = Now.Date
            .AmendDate = Now.Date
            If Not .Save() Then
                MsgBox("Error")
            End If
        End With
        Dim Anl3 As New cPrAnEmployeeAnalysis3
        With Anl3
            .Code = "ENEW"
            .DescriptionL = "Exelsys New Value"
            .DescriptionS = "Exelsys New Value"
            .IsActive = "Y"
            .GLAnal1 = 0
            .GLAnal2 = 0
            .CreationDate = Now.Date
            .AmendDate = Now.Date
            If Not .Save() Then
                MsgBox("Error")
            End If
        End With


        Dim Anl4 As New cPrAnEmployeeAnalysis4
        With Anl4
            .Code = "ENEW"
            .DescriptionL = "Exelsys New Value"
            .DescriptionS = "Exelsys New Value"
            .IsActive = "Y"
            .GLAnal1 = 0
            .GLAnal2 = 0
            .CreationDate = Now.Date
            .AmendDate = Now.Date
            If Not .Save() Then
                MsgBox("Error")
            End If
        End With

        Dim Anl5 As New cPrAnEmployeeAnalysis5
        With Anl5
            .EmpAn5_Code = "ENEW"
            .EmpAn5_DescriptionL = "Exelsys New Value"
            .EmpAn5_DescriptionS = "Exelsys New Value"
            .EmpAn5_IsActive = "Y"
            .GLAnal1 = 0
            .GLAnal2 = 0
            .EmpAn5_CreationDate = Now.Date
            .EmpAn5_AmendDate = Now.Date
            If Not .Save() Then
                MsgBox("Error")
            End If
        End With

        Dim Bnk1 As New cPrAnBanks
        With Bnk1
            .Code = "ENEW"
            .DescriptionL = "Exelsys New Value"
            .DescriptionS = "Exelsys New Value"
            .IsActive = "Y"
            .TransferCode = ""
            .SwiftCode = "XXX"
            If Not .Save() Then
                MsgBox("Error")
            End If
        End With
        Dim Unions As New cPrAnUnions
        With Unions
            .Code = "ENEW"
            .DescriptionL = "Exelsys Union"
            .DescriptionS = "Exelsys Union"
            .IsActive = "Y"
            .Uni_SubscriptionType = "S"
            .GLAnal1 = ""
            .GLAnal2 = ""
            .Uni_SubscriptionValue = CDbl(0)
            .CreationDate = Now.Date
            .Uni_Deduction1 = CDbl(0)
            .Uni_Deduction2 = CDbl(0)
            .AmendDate = Now.Date
            .WelfareRate = CDbl(0)
            .WeeklyMF = CDbl(0)
            .MonthlyMF = CDbl(0)
            .WeeklySubLimit = CDbl(0)
            .MonthlySubLimit = CDbl(0)
            If Not .Save() Then
                MsgBox("Error")
            End If

        End With

        MsgBox("Done")
        Return True
    End Function
    Protected Function Upgrade_2024_06()
        Dim Str As String
        Str = " CREATE TABLE [dbo].[PrMsEmployeePhoto]( " &
        "	[Emp_Code] [varchar](16) NOT NULL, " &
        "	[Emp_Image] [image] NULL, " &
        " CONSTRAINT [PK_PrMsEmployeeImage] PRIMARY KEY CLUSTERED  " &
        " ( " &
        "	[Emp_Code] ASC " &
        " )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY] " &
        " ) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY] "

        Dim i As Integer
        i = ExecuteNonQuery(Str)


        Str = " CREATE PROCEDURE [dbo].[PrMsEmployeePhoto_SAVE_UPDATE] " &
        " @Emp_Code varchar(16), " &
        " @Emp_Image Image " &
        " AS DECLARE @Result as Int   Set @Result = 0    " &
        " SELECT @Result = Count(*)   FROM PrMsEmployeePhoto " &
        " WHERE Emp_Code = @Emp_Code  " &
        " IF(@Result IS NULL) OR (@Result=0)  " &
        " BEGIN INSERT INTO PrMsEmployeePhoto  " &
        " (Emp_Code, " &
        " Emp_Image) " &
        " VALUES (@Emp_Code, " &
        " @Emp_Image) " &
        "  END  " &
        "  ELSE BEGIN " &
        "  UPDATE PrMsEmployeePhoto   SET " &
        "  Emp_Image=@Emp_Image  " &
        " WHERE Emp_Code = @Emp_Code " &
        " END  "


        i = ExecuteNonQuery(Str)
        MsgBox("Done")
        Return True
    End Function
    Protected Function Upgrade_2024_07()
        Dim Str As String
        Dim Exx As New System.Exception

        Str = " Select Emp_Code,Emp_Photo from PrMsEmployees"
        Dim Ds As DataSet
        Ds = GetData(Str)
        Dim i As Integer
        If CheckDataSet(Ds) Then
            For i = 0 To Ds.Tables(0).Rows.Count - 1
                Dim S As String
                Dim E As Image
                S = DbNullToString(Ds.Tables(0).Rows(i).Item(0))
                If IsDBNull(Ds.Tables(0).Rows(i).Item(1)) Then
                    E = My.Resources.photo
                Else
                    Dim data As Byte() = DirectCast(Ds.Tables(0).Rows(i).Item(1), Byte())
                    Dim ms As New System.IO.MemoryStream(data)
                    E = Image.FromStream(ms)
                End If
                Dim EmpPho As New cPrMsEmployeePhoto(S)
                EmpPho.Code = S
                EmpPho.MyPhoto = E
                If Not EmpPho.Save Then
                    Throw exx
                End If
            Next
        End If


        MsgBox("Done")
        Return True
    End Function

    Protected Function Upgrade_2024_08()
        Dim Str As String
        Dim Exx As New System.Exception

        Str = "ALTER TABLE PrMsEmployees" &
              " DROP COLUMN Emp_Photo"
        Dim i As Integer
        i = ExecuteNonQuery(Str)


        MsgBox("Field Removed")

        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1), " &
        " @Emp_GESYFromSplit decimal(18,2), " &
        " @Emp_AnalGen1 varchar(20), " &
        " @Emp_Nameday varchar(10), " &
        " @Emp_IsDirector varchar(1), " &
        " @Emp_Rehire varchar(16), " &
        " @Emp_CNP varchar(16), " &
        " @Emp_TACode varchar(16), " &
        " @Emp_HRCode varchar(16), " &
        " @Emp_TermReason varchar(2), " &
        " @Emp_HireReason varchar(2), " &
        " @Emp_Email2 Varchar(70), " &
        " @Emp_Maternity Varchar(1), " &
        " @Emp_FEControlAmount Decimal(18,2)" &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen, " &
        " Emp_GESYFromSplit, " &
        " Emp_AnalGen1, " &
        " Emp_NameDay, " &
        " Emp_IsDirector, " &
        " Emp_Rehire, " &
        " Emp_CNP,  " &
        " Emp_TACode,  " &
        " Emp_HRCode,  " &
        " Emp_TermReason,  " &
        " Emp_HireReason,  " &
        " Emp_Email2,  " &
        " Emp_Maternity, " &
        " Emp_FEControlAmount " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen, " &
        " @Emp_GESYFromSplit, " &
        " @Emp_AnalGen1," &
        " @Emp_Nameday, " &
        " @Emp_IsDirector, " &
        " @Emp_Rehire, " &
        " @Emp_CNP,  " &
        " @Emp_TACode,  " &
        " @Emp_HRCode,  " &
        " @Emp_TermReason,  " &
        " @Emp_HireReason,  " &
        " @Emp_Email2,  " &
        " @Emp_Maternity, " &
        " @Emp_FEControlAmount " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen, " &
        " Emp_GESYFromSplit= @Emp_GESYFromSplit, " &
        " Emp_AnalGen1 = @Emp_AnalGen1," &
        " Emp_Nameday = @Emp_NameDay, " &
        " Emp_Isdirector = @Emp_Isdirector, " &
        " Emp_Rehire = @Emp_Rehire, " &
        " Emp_CNP = @Emp_CNP,  " &
        " Emp_TACode = @Emp_TACode,  " &
        " Emp_HRCode = @Emp_HRCode,  " &
        " Emp_TermReason = @Emp_TermReason,  " &
        " Emp_HireReason = @Emp_HireReason,  " &
        " Emp_Email2 = @Emp_Email2,  " &
        " Emp_Maternity = @Emp_Maternity, " &
        " Emp_FEControlAmount = @Emp_FEControlAmount " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True
    End Function
    Protected Function Upgrade_2024_09()
        Dim Str As String
        Dim Exx As New System.Exception

        Str = " CREATE TABLE [dbo].[AuditGeneral]( " &
        "	[Type] [char](1) NULL, " &
        "	[TableName] [nchar](100) NULL, " &
        "	[ID] [nchar](1000) NULL, " &
        "	[FieldName] [nchar](128) NULL, " &
        "	[OldValue] [nchar](250) NULL, " &
        "	[NewValue] [nchar](250) NULL, " &
        "	[UpdateDate] [datetime] NULL, " &
        "	[UserName] [nchar](128) NULL " &
        " ) ON [PRIMARY] "
        Dim i As Integer
        i = ExecuteNonQuery(Str)



        Str = "create TRIGGER [dbo].[TR_PrMsEmployees_AUDIT] ON [dbo].[PrMsEmployees] " &
        " AFTER UPDATE, " &
        "	DELETE, " &
        "	INSERT " &
        " AS " &
        " DECLARE @bit INT, " &
        "	@field INT, " &
        "	@maxfield INT, " &
        "	@char INT, " &
        "	@fieldname VARCHAR(128), " &
        "	@TableName VARCHAR(128), " &
        "	@PKCols VARCHAR(1000), " &
        "	@sql VARCHAR(2000), " &
        "	@UpdateDate VARCHAR(21), " &
        "	@UserName VARCHAR(128), " &
        "	@Type CHAR(1), " &
        "	@PKValue VARCHAR(1000) " &
        " " &
        " SELECT @TableName = 'PrMsEmployees'  " &
        " SELECT @UserName = SYSTEM_USER,  " &
        "	@UpdateDate = CONVERT(NVARCHAR(30), GETDATE(), 126) " &
        " " &
        " IF EXISTS ( " &
        "		SELECT * " &
        "		FROM inserted " &
        "		) " &
        "	IF EXISTS ( " &
        "			SELECT * " &
        "			FROM deleted " &
        "			) " &
        "		SELECT @Type = 'U' " &
        "	ELSE " &
        "		SELECT @Type = 'I' " &
        " ELSE " &
        "	SELECT @Type = 'D' " &
        " " &
        " SELECT * " &
        " INTO #ins " &
        " FROM inserted " &
        " " &
        " SELECT * " &
        " INTO #del " &
        " FROM deleted " &
         " " &
        " SELECT @PKCols = COALESCE(@PKCols + ' and', ' on') + ' i.' + c.COLUMN_NAME + ' = d.' + c.COLUMN_NAME " &
        " FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS pk, " &
        "	INFORMATION_SCHEMA.KEY_COLUMN_USAGE c " &
        " WHERE pk.TABLE_NAME = @TableName " &
        "	AND CONSTRAINT_TYPE = 'PRIMARY KEY' " &
        "	AND c.TABLE_NAME = pk.TABLE_NAME " &
        "	AND c.CONSTRAINT_NAME = pk.CONSTRAINT_NAME " &
        " " &
        " SELECT @PKValue = COALESCE(@PKValue + '+', '') + '+convert(varchar(100), " &
        " COALESCE(i.' + COLUMN_NAME + ',d.' + COLUMN_NAME + '))' " &
        " FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS pk, " &
        "	INFORMATION_SCHEMA.KEY_COLUMN_USAGE c " &
        " WHERE pk.TABLE_NAME = @TableName " &
        "	AND CONSTRAINT_TYPE = 'PRIMARY KEY' " &
        "	AND c.TABLE_NAME = pk.TABLE_NAME " &
        "	AND c.CONSTRAINT_NAME = pk.CONSTRAINT_NAME " &
        " " &
        " IF @PKCols IS NULL " &
        " BEGIN " &
        "	RAISERROR ( " &
        "			'no PK on table %s', " &
        "			16, " &
        "			- 1, " &
        "			@TableName " &
        "			) " &
        " " &
        "	RETURN " &
        " END " &
        " " &
        " SELECT @field = 0, " &
        "	@maxfield = MAX(ORDINAL_POSITION) " &
        " FROM INFORMATION_SCHEMA.COLUMNS " &
        " WHERE TABLE_NAME = @TableName " &
        " " &
        " WHILE @field < @maxfield " &
        " BEGIN " &
        "	SELECT @field = MIN(ORDINAL_POSITION) " &
        "	FROM INFORMATION_SCHEMA.COLUMNS " &
        "	WHERE TABLE_NAME = @TableName " &
        "		AND ORDINAL_POSITION > @field " &
        "	SELECT @bit = (@field - 1) % 8 + 1 " &
        "	SELECT @bit = POWER(2, @bit - 1) " &
        "	SELECT @char = ((@field - 1) / 8) + 1 " &
        "	IF SUBSTRING(COLUMNS_UPDATED(), @char, 1) & @bit > 0 " &
        "		OR @Type IN ( " &
        "			'I', " &
        "			'D' " &
        "			) " &
        "	BEGIN " &
        "		SELECT @fieldname = COLUMN_NAME " &
        "		FROM INFORMATION_SCHEMA.COLUMNS " &
        "		WHERE TABLE_NAME = @TableName " &
        "			AND ORDINAL_POSITION = @field " &
        " " &
        "		SELECT @sql = ' " &
        "				INSERT [dbo].[AuditGeneral] (    " &
        "						Type,  " &
        "						TableName,  " &
        "						ID,  " &
        "						FieldName,  " &
        "						OldValue,  " &
        "						NewValue,  " &
        "						UpdateDate,  " &
        "						UserName) " &
        "				SELECT ''' + @Type + ''',''' + @TableName + ''',' + @PKValue + ',''' + @fieldname + '''' + ',convert(varchar(1000),d.' + @fieldname + ')' + ',convert(varchar(1000),i.' + @fieldname + ')' + ',''' + @UpdateDate + '''' + ',''' + @UserName + '''' + ' FROM #ins i FULL OUTER JOIN #del d' + @PKCols + ' WHERE i.' + @fieldname + ' <> d.' + @fieldname + ' OR (i.' + @fieldname + ' is null and  d.' + @fieldname + ' is not null)' + ' OR (i.' + @fieldname + ' is not null and  d.' + @fieldname + ' is null)' " &
        " " &
        "		EXEC (@sql) " &
        "	END " &
        "END "



        i = ExecuteNonQuery(Str)
        Str = "ALTER TABLE [dbo].[PrMsEmployees] ENABLE TRIGGER [TR_PrMsEmployees_AUDIT]"
        i = ExecuteNonQuery(Str)

        MsgBox("Done")
        Return True
    End Function
    Protected Function Upgrade_2024_13()
        Dim Str As String
        Dim Exx As New System.Exception
        Dim i As Integer



        Str = "create TRIGGER [dbo].[TR_PrTxEmployeeSalary_AUDIT] ON [dbo].[PrTxEmployeeSalary] " &
        " AFTER UPDATE, " &
        "	DELETE, " &
        "	INSERT " &
        " AS " &
        " DECLARE @bit INT, " &
        "	@field INT, " &
        "	@maxfield INT, " &
        "	@char INT, " &
        "	@fieldname VARCHAR(128), " &
        "	@TableName VARCHAR(128), " &
        "	@PKCols VARCHAR(1000), " &
        "	@sql VARCHAR(2000), " &
        "	@UpdateDate VARCHAR(21), " &
        "	@UserName VARCHAR(128), " &
        "	@Type CHAR(1), " &
        "	@PKValue VARCHAR(1000) " &
        " " &
        " SELECT @TableName = 'PrTxEmployeeSalary'  " &
        " SELECT @UserName = SYSTEM_USER,  " &
        "	@UpdateDate = CONVERT(NVARCHAR(30), GETDATE(), 126) " &
        " " &
        " IF EXISTS ( " &
        "		SELECT * " &
        "		FROM inserted " &
        "		) " &
        "	IF EXISTS ( " &
        "			SELECT * " &
        "			FROM deleted " &
        "			) " &
        "		SELECT @Type = 'U' " &
        "	ELSE " &
        "		SELECT @Type = 'I' " &
        " ELSE " &
        "	SELECT @Type = 'D' " &
        " " &
        " SELECT * " &
        " INTO #ins " &
        " FROM inserted " &
        " " &
        " SELECT * " &
        " INTO #del " &
        " FROM deleted " &
         " " &
        " SELECT @PKCols = COALESCE(@PKCols + ' and', ' on') + ' i.' + c.COLUMN_NAME + ' = d.' + c.COLUMN_NAME " &
        " FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS pk, " &
        "	INFORMATION_SCHEMA.KEY_COLUMN_USAGE c " &
        " WHERE pk.TABLE_NAME = @TableName " &
        "	AND CONSTRAINT_TYPE = 'PRIMARY KEY' " &
        "	AND c.TABLE_NAME = pk.TABLE_NAME " &
        "	AND c.CONSTRAINT_NAME = pk.CONSTRAINT_NAME " &
        " " &
        " SELECT @PKValue = COALESCE(@PKValue + '+', '') + '+convert(varchar(100), " &
        " COALESCE(i.' + COLUMN_NAME + ',d.' + COLUMN_NAME + '))' " &
        " FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS pk, " &
        "	INFORMATION_SCHEMA.KEY_COLUMN_USAGE c " &
        " WHERE pk.TABLE_NAME = @TableName " &
        "	AND CONSTRAINT_TYPE = 'PRIMARY KEY' " &
        "	AND c.TABLE_NAME = pk.TABLE_NAME " &
        "	AND c.CONSTRAINT_NAME = pk.CONSTRAINT_NAME " &
        " " &
        " IF @PKCols IS NULL " &
        " BEGIN " &
        "	RAISERROR ( " &
        "			'no PK on table %s', " &
        "			16, " &
        "			- 1, " &
        "			@TableName " &
        "			) " &
        " " &
        "	RETURN " &
        " END " &
        " " &
        " SELECT @field = 0, " &
        "	@maxfield = MAX(ORDINAL_POSITION) " &
        " FROM INFORMATION_SCHEMA.COLUMNS " &
        " WHERE TABLE_NAME = @TableName " &
        " " &
        " WHILE @field < @maxfield " &
        " BEGIN " &
        "	SELECT @field = MIN(ORDINAL_POSITION) " &
        "	FROM INFORMATION_SCHEMA.COLUMNS " &
        "	WHERE TABLE_NAME = @TableName " &
        "		AND ORDINAL_POSITION > @field " &
        "	SELECT @bit = (@field - 1) % 8 + 1 " &
        "	SELECT @bit = POWER(2, @bit - 1) " &
        "	SELECT @char = ((@field - 1) / 8) + 1 " &
        "	IF SUBSTRING(COLUMNS_UPDATED(), @char, 1) & @bit > 0 " &
        "		OR @Type IN ( " &
        "			'I', " &
        "			'D' " &
        "			) " &
        "	BEGIN " &
        "		SELECT @fieldname = COLUMN_NAME " &
        "		FROM INFORMATION_SCHEMA.COLUMNS " &
        "		WHERE TABLE_NAME = @TableName " &
        "			AND ORDINAL_POSITION = @field " &
        " " &
        "		SELECT @sql = ' " &
        "				INSERT [dbo].[AuditGeneral] (    " &
        "						Type,  " &
        "						TableName,  " &
        "						ID,  " &
        "						FieldName,  " &
        "						OldValue,  " &
        "						NewValue,  " &
        "						UpdateDate,  " &
        "						UserName) " &
        "				SELECT ''' + @Type + ''',''' + @TableName + ''',' + @PKValue + ',''' + @fieldname + '''' + ',convert(varchar(1000),d.' + @fieldname + ')' + ',convert(varchar(1000),i.' + @fieldname + ')' + ',''' + @UpdateDate + '''' + ',''' + @UserName + '''' + ' FROM #ins i FULL OUTER JOIN #del d' + @PKCols + ' WHERE i.' + @fieldname + ' <> d.' + @fieldname + ' OR (i.' + @fieldname + ' is null and  d.' + @fieldname + ' is not null)' + ' OR (i.' + @fieldname + ' is not null and  d.' + @fieldname + ' is null)' " &
        " " &
        "		EXEC (@sql) " &
        "	END " &
        "END "



        i = ExecuteNonQuery(Str)
        Str = "ALTER TABLE [dbo].[PrTxEmployeeSalary] ENABLE TRIGGER [TR_PrTxEmployeeSalary_AUDIT]"
        i = ExecuteNonQuery(Str)

        MsgBox("Done")
        Return True
    End Function
    Protected Function Upgrade_2025_01()
        Dim Str As String
        Dim i As Integer
        Str = " ALTER TABLE PrTxtrxnheader " &
        " ADD [TrxHdr_TaxOnBIK] decimal(18,2) NULL, " &
        " [TrxHdr_SIPension] decimal(18,2) NULL, " &
        " [TrxHdr_GovPension] decimal(18,2) NULL "


        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("3 New columns Added in PrTxTrxnheader", MsgBoxStyle.Information)
        Else
            MsgBox("Fail to add New columns in PrTxTrxnheader", MsgBoxStyle.Critical)
        End If

        Str = " Update PrTxtrxnheader " &
       " set TrxHdr_TaxOnBIK=0, " &
        " TrxHdr_SIPension=0 , " &
        " TrxHdr_GovPension =0 "
        i = ExecuteNonQuery(Str)


        Str = "ALTER PROCEDURE [dbo].[AG_PrTxTrxnHeader_SAVE_UPDATE]" &
               " @TrxHdr_Id int," &
               " @Emp_Code varchar(16)," &
               " @PrdGrp_Code varchar(6)," &
               " @PrdCod_Code varchar(6)," &
               " @PayCat_Code varchar(4)," &
               " @TrxHdr_Date datetime," &
               " @TrxHdr_Status varchar(4)," &
               " @TrxHdr_TotalErnPeriod Decimal(18,2)," &
               " @TrxHdr_TotalErnYTD Decimal(18,2)," &
               " @TrxHdr_TotalDedPeriod Decimal(18,2)," &
               " @TrxHdr_TotalDedYTD Decimal(18,2)," &
               " @TrxHdr_TotalConPeriod Decimal(18,2)," &
               " @TrxHdr_TotalConYTD Decimal(18,2)," &
               " @TrxHdr_SIIncome Decimal(18,2)," &
               " @TrxHdr_TaxableIncome Decimal(18,2)," &
               " @TrxHdr_PaymentMethod varchar(50)," &
               " @TrxHdr_PaymentRef varchar(50)," &
               " @TrxHdr_PeriodUnits Decimal(18,2)," &
               " @TrxHdr_AnnualUnits Decimal(18,2)," &
               " @TrxHdr_AnnualLeave Decimal(18,2)," &
               " @TrxHdr_LifeInsurance Decimal(18,2)," &
               " @TrxHdr_Discounts Decimal(18,2)," &
               " @TrxHdr_Interfacestatus varchar(4)," &
               " @TrxHdr_Overtime1 Decimal(10,2)," &
               " @TrxHdr_Overtime2 Decimal(10,2)," &
               " @TrxHdr_SIUnits Decimal(10,2)," &
               " @TrxHdr_MonthlySalary Decimal(18,2)," &
               " @TrxHdr_NetSalary Decimal(18,2)," &
               " @TrxHdr_PeriodInsurable Decimal(18,2)," &
               " @TemGrp_Code varchar(6)," &
               " @TrxHdr_ChequeNo varchar(50)," &
               " @TrxHdr_TaxableFromOther Decimal(18,2)," &
               " @TrxHdr_CurrencySymbol varchar(3)," &
               " @TrxHdr_Rate Decimal(18,10)," &
               " @TrxHdr_NormalDays Decimal(18,2)," &
               " @TrxHdr_Salary1 Decimal(18,2)," &
               " @TrxHdr_Salary2 Decimal(18,2)," &
               " @TrxHdr_Overtime3 Decimal(10,2)," &
               " @TrxHdr_Sectors Decimal(18,2)," &
               " @TrxHdr_Dutyhours Decimal(18,2)," &
               " @TrxHdr_FlightHours Decimal(18,2)," &
               " @TrxHdr_Commission Decimal(18,2)," &
               " @TrxHdr_PBAmount Decimal(18,2)," &
               " @TrxHdr_PBRate Decimal(18,2)," &
               " @TrxHdr_Overlay Decimal(18,2)," &
               " @TrxHdr_PeriodSplit Decimal(18,2)," &
               " @TrxHdr_PeriodSplitSI Decimal(18,2)," &
               " @TrxHdr_A1 varchar(12), " &
               " @TrxHdr_A2 varchar(12), " &
               " @TrxHdr_A3 varchar(12), " &
               " @TrxHdr_A4 varchar(12), " &
               " @TrxHdr_A5 varchar(12), " &
               " @TrxHdr_Union varchar(12), " &
               " @TrxHdr_Position varchar(12), " &
               " @TrxHdr_COLA Decimal(18, 2)," &
               " @TrxHdr_MyRate Decimal(18, 4)," &
               " @TrxHdr_FE Decimal(18, 2)," &
               " @TrxHdr_NetYTD Decimal(18, 2)," &
               " @TrxHdr_PFOnAgreedSalary Decimal(18, 2)," &
               " @TrxHdr_BasisOnSalary Decimal(18, 2)," &
               " @TrxHdr_GesiD Decimal(18, 2)," &
               " @TrxHdr_GesiC Decimal(18, 2)," &
               " @TrxHdr_Medical Decimal(18, 2)," &
               " @Com_Code varchar(10)," &
               " @TrxHdr_Year varchar(4), " &
               " @TrxHdr_GESIableAmount Decimal(18, 2)," &
               " @TrxHdr_BIK_GesiD Decimal(18, 2)," &
               " @TrxHdr_BIK_GesiC Decimal(18, 2)," &
               " @TrxHdr_BIK_Gesiable Decimal(18, 2)," &
               " @TrxHdr_AnalGen1 varchar(20)," &
               " @TrxHdr_Maternity varchar(1)," &
               " @TrxHdr_FEPercent varchar(4)," &
               " @TrxHdr_FEControlAmount Decimal(18,2), " &
               " @TrxHdr_TaxOnBIK Decimal(18,2), " &
               " @TrxHdr_SIPension Decimal(18,2), " &
               " @TrxHdr_GovPension Decimal(18,2), " &
               " @NewId Int OUTPUT " &
               " As" &
               " Declare @Result As Int" &
               " Set  @Result = 0" &
               " Select @Result = Count(*)" &
               " FROM PrTxTrxnHeader" &
               " WHERE TrxHdr_Id =  @TrxHdr_Id" &
               " If(@Result Is NULL) Or (@Result=0)" &
               " BEGIN" &
               "   INSERT INTO PrTxTrxnHeader" &
               "   (Emp_Code,                                           " &
               " PrdGrp_Code," &
               " PrdCod_Code,                                        " &
               " PayCat_Code,                                        " &
               " TrxHdr_Date,                                        " &
               " TrxHdr_Status,                                      " &
               " TrxHdr_TotalErnPeriod,                              " &
               " TrxHdr_TotalErnYTD,                                 " &
               " TrxHdr_TotalDedPeriod,                              " &
               " TrxHdr_TotalDedYTD,                                 " &
               " TrxHdr_TotalConPeriod,                              " &
               " TrxHdr_TotalConYTD,                                 " &
               " TrxHdr_SIIncome,                                    " &
               " TrxHdr_TaxableIncome,                               " &
               " TrxHdr_PaymentMethod,                               " &
               " TrxHdr_PaymentRef,                                  " &
               " TrxHdr_PeriodUnits,                                 " &
               " TrxHdr_AnnualUnits,                                 " &
               " TrxHdr_AnnualLeave,                                  " &
               " TrxHdr_LifeInsurance,                                " &
               " TrxHdr_Discounts,                                    " &
               " TrxHdr_InterfaceStatus,                               " &
               " TrxHdr_Overtime1," &
               " TrxHdr_Overtime2," &
               " TrxHdr_SIUnits," &
               " TrxHdr_MonthlySalary," &
               " TrxHdr_NetSalary," &
               " TrxHdr_PeriodInsurable," &
               " TemGrp_Code," &
               " TrxHdr_ChequeNo," &
               " TrxHdr_TaxableFromOther," &
               " TrxHdr_CurrencySymbol," &
               " TrxHdr_Rate," &
               " TrxHdr_NormalDays," &
               " TrxHdr_Salary1," &
               " TrxHdr_Salary2," &
               " TrxHdr_Overtime3," &
               " TrxHdr_Sectors," &
               " TrxHdr_Dutyhours," &
               " TrxHdr_FlightHours," &
               " TrxHdr_Commission," &
               " TrxHdr_PBAmount," &
               " TrxHdr_PBRate," &
               " TrxHdr_Overlay," &
               " TrxHdr_PeriodSplit, " &
               " TrxHdr_PeriodSplitSI, " &
               " TrxHdr_A1, " &
               " TrxHdr_A2, " &
               " TrxHdr_A3, " &
               " TrxHdr_A4, " &
               " TrxHdr_A5, " &
               " TrxHdr_Union, " &
               " TrxHdr_Position, " &
               " TrxHdr_COLA," &
               " TrxHdr_MyRate, " &
               " TrxHdr_FE, " &
               " TrxHdr_NetYTD, " &
               " TrxHdr_PFOnAgreedSalary, " &
               " TrxHdr_BasisOnSalary, " &
               " TrxHdr_GesiD, " &
               " TrxHdr_GesiC, " &
               " TrxHdr_Medical, " &
               " Com_Code, " &
               " TrxHdr_Year, " &
               " TrxHdr_GESIableAmount, " &
               " TrxHdr_BIK_GesiD, " &
               " TrxHdr_BIK_GesiC, " &
               " TrxHdr_BIK_Gesiable, " &
               " TrxHdr_AnalGen1, " &
               " TrxHdr_Maternity, " &
               " TrxHdr_FEPercent, " &
               " TrxHdr_FEControlAmount, " &
               " TrxHdr_TaxOnBIK, " &
               " TrxHdr_SIPension, " &
               " TrxHdr_GovPension " &
               " )" &
               " VALUES (" &
               " @Emp_Code,                                           " &
               " @PrdGrp_Code,                                        " &
               " @PrdCod_Code,                                        " &
               " @PayCat_Code,                                        " &
               " @TrxHdr_Date,                                        " &
               " @TrxHdr_Status,                                      " &
               " @TrxHdr_TotalErnPeriod,                              " &
               " @TrxHdr_TotalErnYTD,                                 " &
               " @TrxHdr_TotalDedPeriod,                              " &
               " @TrxHdr_TotalDedYTD,                                 " &
               " @TrxHdr_TotalConPeriod,                              " &
               " @TrxHdr_TotalConYTD,                                 " &
               " @TrxHdr_SIIncome,                                    " &
               " @TrxHdr_TaxableIncome,                               " &
               " @TrxHdr_PaymentMethod,                               " &
               " @TrxHdr_PaymentRef,                                  " &
               " @TrxHdr_PeriodUnits,                                 " &
               " @TrxHdr_AnnualUnits,                                 " &
               " @TrxHdr_AnnualLeave,                                 " &
               " @TrxHdr_LifeInsurance,                               " &
               " @TrxHdr_Discounts,                                   " &
               " @TrxHdr_InterfaceStatus,                              " &
               " @TrxHdr_Overtime1," &
               " @TrxHdr_Overtime2," &
               " @TrxHdr_SIUnits," &
               " @TrxHdr_MonthlySalary," &
               " @TrxHdr_NetSalary," &
               " @TrxHdr_PeriodInsurable," &
               " @TemGrp_Code, " &
               " @TrxHdr_ChequeNo," &
               " @TrxHdr_TaxableFromOther," &
               " @TrxHdr_CurrencySymbol," &
               " @TrxHdr_Rate," &
               " @TrxHdr_NormalDays," &
               " @TrxHdr_Salary1," &
               " @TrxHdr_Salary2," &
               " @TrxHdr_Overtime3," &
               " @TrxHdr_Sectors," &
               " @TrxHdr_Dutyhours," &
               " @TrxHdr_FlightHours," &
               " @TrxHdr_Commission," &
               " @TrxHdr_PBAmount," &
               " @TrxHdr_PBRate," &
               " @TrxHdr_Overlay," &
               " @TrxHdr_PeriodSplit, " &
               " @TrxHdr_PeriodSplitSI, " &
               " @TrxHdr_A1, " &
               " @TrxHdr_A2, " &
               " @TrxHdr_A3, " &
               " @TrxHdr_A4, " &
               " @TrxHdr_A5, " &
               " @TrxHdr_Union, " &
               " @TrxHdr_Position, " &
               " @TrxHdr_COLA," &
               " @TrxHdr_MyRate," &
               " @TrxHdr_FE, " &
               " @TrxHdr_NetYTD, " &
               " @TrxHdr_PFOnAgreedSalary, " &
               " @TrxHdr_BasisOnSalary, " &
               " @TrxHdr_GesiD, " &
               " @TrxHdr_GesiC, " &
               " @TrxHdr_Medical, " &
               " @Com_Code, " &
               " @TrxHdr_Year, " &
               " @TrxHdr_GESIableAmount, " &
               " @TrxHdr_BIK_GesiD, " &
               " @TrxHdr_BIK_GesiC, " &
               " @TrxHdr_BIK_Gesiable, " &
               " @TrxHdr_AnalGen1, " &
               " @TrxHdr_Maternity, " &
               " @TrxHdr_FEPercent, " &
               " @TrxHdr_FEControlAmount, " &
               " @TrxHdr_TaxOnBIK, " &
               " @TrxHdr_SIPension, " &
               " @TrxHdr_GovPension " &
               " )" &
               " End" &
               " Else" &
               "   BEGIN" &
               "     UPDATE PrTxTrxnHeader" &
               "     Set " &
               "     Emp_Code=@Emp_Code,                                   " &
               "     PrdGrp_Code=@PrdGrp_Code," &
               "     PrdCod_Code=@PrdCod_Code,                             " &
               "     PayCat_Code=@PayCat_Code,                             " &
               "     TrxHdr_Date=@TrxHdr_Date,                             " &
               "    TrxHdr_Status=@TrxHdr_Status,                         " &
               "  TrxHdr_TotalErnPeriod=@TrxHdr_TotalErnPeriod,         " &
               "     TrxHdr_TotalErnYTD=@TrxHdr_TotalErnYTD,               " &
               "    TrxHdr_TotalDedPeriod=@TrxHdr_TotalDedPeriod,         " &
               "   TrxHdr_TotalDedYTD=@TrxHdr_TotalDedYTD,               " &
               "  TrxHdr_TotalConPeriod=@TrxHdr_TotalConPeriod,         " &
               " TrxHdr_TotalConYTD=@TrxHdr_TotalConYTD,               " &
               " TrxHdr_SIIncome=@TrxHdr_SIIncome,                     " &
               " TrxHdr_TaxableIncome=@TrxHdr_TaxableIncome,           " &
               " TrxHdr_PaymentMethod=@TrxHdr_PaymentMethod,           " &
               " TrxHdr_PaymentRef=@TrxHdr_PaymentRef,                 " &
               " TrxHdr_PeriodUnits=@TrxHdr_PeriodUnits,               " &
               " TrxHdr_AnnualUnits=@TrxHdr_AnnualUnits,               " &
               " TrxHdr_AnnualLeave=@TrxHdr_AnnualLeave,                " &
               " TrxHdr_LifeInsurance=@TrxHdr_LifeInsurance,           " &
               " TrxHdr_Discounts=@TrxHdr_Discounts,                    " &
               " TrxHdr_InterfaceStatus=@TrxHdr_InterfaceStatus,        " &
               " TrxHdr_Overtime1=@TrxHdr_Overtime1," &
               " TrxHdr_Overtime2=@TrxHdr_Overtime2," &
               " TrxHdr_SIUnits=@TrxHdr_SIUnits," &
               " TrxHdr_MonthlySalary=@TrxHdr_MonthlySalary," &
               " TrxHdr_NetSalary=@TrxHdr_NetSalary," &
               " TrxHdr_PeriodInsurable=@TrxHdr_PeriodInsurable," &
               " TemGrp_Code=@TemGrp_Code," &
               " TrxHdr_ChequeNo=@TrxHdr_ChequeNo ," &
               " TrxHdr_TaxableFromOther=@TrxHdr_TaxableFromOther," &
               " TrxHdr_CurrencySymbol=@TrxHdr_CurrencySymbol," &
               " TrxHdr_Rate=@TrxHdr_Rate," &
               " TrxHdr_NormalDays=@TrxHdr_NormalDays ," &
               " TrxHdr_Salary1=@TrxHdr_Salary1," &
               " TrxHdr_Salary2=@TrxHdr_Salary2," &
               " TrxHdr_Overtime3=@TrxHdr_Overtime3," &
               " TrxHdr_Sectors=@TrxHdr_Sectors," &
               " TrxHdr_Dutyhours=@TrxHdr_Dutyhours," &
               " TrxHdr_FlightHours=@TrxHdr_FlightHours," &
               " TrxHdr_Commission=@TrxHdr_Commission," &
               " TrxHdr_PBAmount=@TrxHdr_PBAmount," &
               " TrxHdr_PBRate=@TrxHdr_PBRate," &
               " TrxHdr_Overlay=@TrxHdr_Overlay," &
               " TrxHdr_PeriodSplit=@TrxHdr_PeriodSplit, " &
               " TrxHdr_PeriodSplitSI=@TrxHdr_PeriodSplitSI," &
               " TrxHdr_A1=@TrxHdr_A1, " &
               " TrxHdr_A2=@TrxHdr_A2, " &
               " TrxHdr_A3=@TrxHdr_A3, " &
               " TrxHdr_A4=@TrxHdr_A4, " &
               " TrxHdr_A5=@TrxHdr_A5, " &
               " TrxHdr_Union=@TrxHdr_Union, " &
               " TrxHdr_Position=@TrxHdr_Position, " &
               " TrxHdr_COLA=@TrxHdr_COLA," &
               " TrxHdr_MyRate=@TrxHdr_MyRate, " &
               " TrxHdr_FE=@TrxHdr_FE, " &
               " TrxHdr_NetYTD=@TrxHdr_NetYTD, " &
               " TrxHdr_PFOnAgreedSalary=@TrxHdr_PFOnAgreedSalary, " &
               " TrxHdr_BasisOnSalary=@TrxHdr_BasisOnSalary, " &
               " TrxHdr_GesiD=@TrxHdr_GesiD, " &
               " TrxHdr_GesiC=@TrxHdr_GesiC, " &
               " TrxHdr_Medical=@TrxHdr_Medical, " &
               " Com_Code=@Com_Code, " &
               " TrxHdr_Year=@TrxHdr_Year, " &
               " TrxHdr_GESIableAmount =@TrxHdr_GESIableAmount, " &
               " TrxHdr_BIK_GesiD = @TrxHdr_BIK_GesiD, " &
               " TrxHdr_BIK_GesiC = @TrxHdr_BIK_GesiC, " &
               " TrxHdr_BIK_Gesiable = @TrxHdr_BIK_Gesiable, " &
               " TrxHdr_AnalGen1 = @TrxHdr_AnalGen1, " &
               " TrxHdr_Maternity = @TrxHdr_Maternity, " &
               " TrxHdr_FEPercent = @TrxHdr_FEPercent, " &
               " TrxHdr_FEControlAmount =@TrxHdr_FEControlAmount, " &
               " TrxHdr_TaxOnBIK= @TrxHdr_TaxOnBIK, " &
               " TrxHdr_SIPension= @TrxHdr_SIPension, " &
               " TrxHdr_GovPension =@TrxHdr_GovPension " &
               " WHERE TrxHdr_Id = @TrxHdr_Id " &
               " End " &
               " Set  @NewId=SCOPE_IDENTITY()"

        Dim Proceed As Boolean = False
        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrTxTrxnHeader was updated", MsgBoxStyle.Information)
            Proceed = True
        Else
            MsgBox("Unable To Update SP PrTxTrxnHeader", MsgBoxStyle.Critical)
        End If




        Return Proceed




        Return True

    End Function

    Protected Function Upgrade_2024_10()
        Dim Str As String
        Dim Exx As New System.Exception

        Str = " CREATE TABLE [dbo].[PrMsEmployeeExtraDetails]( " &
    "	[Emp_Code] [varchar](16) Not NULL, " &
    "	[Emp_StartDateToPrevServ] [smalldatetime] NULL, " &
    "	[PosCat_Code] [varchar](16) NULL, " &
    "	[PosRnk_Code] [varchar](16) NULL, " &
    "	[Emp_RetirementDate63] [smalldatetime] NULL, " &
    "	[Emp_RetirementDate65] [smalldatetime] NULL, " &
    "	[Emp_ComDate400Months] [smalldatetime] NULL, " &
    "	[Emp_ExtraRatePerHour] [decimal](18, 2) NULL, " &
    "	[Emp_DOfNextRateIncrease] [smalldatetime] NULL, " &
    "	[Emp_IsTop] [nchar](10) NULL, " &
    "	[Emp_ProvidentFund] [nchar](10) NULL, " &
    "	[Emp_PensionFund] [nchar](10) NULL, " &
    "	[Emp_DOfStartPrFund] [smalldatetime] NULL, " &
    "	[Emp_10PercentDecrease] [nchar](10) NULL, " &
    " CONSTRAINT [PK_PrMsEmployeeExtraDetails] PRIMARY KEY CLUSTERED  " &
    " ( " &
    "	[Emp_Code] ASC " &
    " )With (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = On, ALLOW_PAGE_LOCKS = On) On [PRIMARY] " &
    " ) On [PRIMARY] "

        Dim i As Integer
        i = ExecuteNonQuery(Str)



        Str = " CREATE TABLE [dbo].[PrAnScales2] ( " &
    "	[Sc2_Code] [nvarchar](20) Not NULL, " &
    "	[Sc2_Description] [nvarchar](100) NULL, " &
    " CONSTRAINT [PK_PrAnScales2] PRIMARY KEY CLUSTERED  " &
    " ( " &
    "	[Sc2_Code] ASC " &
    " )With (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = On, ALLOW_PAGE_LOCKS = On) On [PRIMARY] " &
    " ) On [PRIMARY]"

        i = ExecuteNonQuery(Str)

        Str = " CREATE TABLE [dbo].[PrAnScales1]( " &
    "	[Sc1_Code] [nvarchar](20) Not NULL, " &
    "	[Sc1_Description] [nvarchar](100) NULL, " &
    " CONSTRAINT [PK_PrAnScales1] PRIMARY KEY CLUSTERED  " &
    " ( " &
    "	[Sc1_Code] ASC " &
    " ) With (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = On, ALLOW_PAGE_LOCKS = On) On [PRIMARY] " &
    " ) On [PRIMARY] "

        i = ExecuteNonQuery(Str)


        Str = " CREATE PROCEDURE [dbo].[AG_PrMsEmployeeExtraDetails_SAVE_UPDATE] " &
    " @Emp_Code varchar(16), " &
    " @Emp_StartDateToPrevServ smalldatetime, " &
    " @PosCat_Code varchar(16), " &
    " @PosRnk_Code varchar(16), " &
    " @Emp_RetirementDate63 smalldatetime, " &
    " @Emp_RetirementDate65 smalldatetime, " &
    " @Emp_ComDate400Months smalldatetime,  " &
    " @Emp_ExtraRatePerHour Decimal(18,2), " &
    " @Emp_DOfNextRateIncrease smalldatetime, " &
    " @Emp_IsTop nchar(10), " &
    " @Emp_ProvidentFund nchar(10), " &
    " @Emp_PensionFund nchar(10), " &
    " @Emp_DOfStartPrFund smalldatetime, " &
    " @Emp_10PercentDecrease nchar(10) " &
    " As " &
    "  Declare @Result As Int " &
    "  Set @Result = 0 " &
    "  Select @Result = Count(*) " &
    "  FROM PrMsEmployeeExtraDetails " &
    "  WHERE Emp_Code = @Emp_Code " &
    "  If(@Result Is NULL) Or (@Result=0) " &
    "    BEGIN " &
    "      INSERT INTO PrMsEmployeeExtraDetails " &
    "     (Emp_Code,                                          " &
    "      Emp_StartDateToPrevServ,                            " &
    "      PosCat_Code,                                        " &
    "     PosRnk_Code,                                        " &
    "     Emp_RetirementDate63,                               " &
    "     Emp_RetirementDate65,                               " &
    "     Emp_ComDate400Months,                               " &
    "     Emp_ExtraRatePerHour,                               " &
    "     Emp_DOfNextRateIncrease,                            " &
    "     Emp_IsTop,                                          " &
    "     Emp_ProvidentFund,                                  " &
    "     Emp_PensionFund,                                    " &
    "     Emp_DOfStartPrFund,                                 " &
    "     Emp_10PercentDecrease                               " &
    "     )  " &
    "     VALUES ( " &
    "     @Emp_Code,     " &
    "     @Emp_StartDateToPrevServ,  " &
    "     @PosCat_Code,                    " &
    "     @PosRnk_Code,                          " &
    "     @Emp_RetirementDate63,            " &
    "     @Emp_RetirementDate65,                 " &
    "     @Emp_ComDate400Months,                     " &
    "     @Emp_ExtraRatePerHour,                           " &
    "     @Emp_DOfNextRateIncrease,                            " &
    "     @Emp_IsTop,                                          " &
    "     @Emp_ProvidentFund,                                  " &
    "     @Emp_PensionFund,                                    " &
    "     @Emp_DOfStartPrFund,                                 " &
    "     @Emp_10PercentDecrease                               " &
    "     ) " &
    "   End " &
    " Else " &
    "   BEGIN " &
    "     UPDATE PrMsEmployeeExtraDetails " &
    "     Set  " &
    "     Emp_Code=@Emp_Code,                                   " &
    "     Emp_StartDateToPrevServ=@Emp_StartDateToPrevServ,     " &
    "     PosCat_Code=@PosCat_Code,                             " &
    "     PosRnk_Code=@PosRnk_Code,                             " &
    "     Emp_RetirementDate63=@Emp_RetirementDate63,           " &
    "     Emp_RetirementDate65=@Emp_RetirementDate65,           " &
    "     Emp_ComDate400Months=@Emp_ComDate400Months,           " &
    "     Emp_ExtraRatePerHour=@Emp_ExtraRatePerHour,           " &
    "     Emp_DOfNextRateIncrease=@Emp_DOfNextRateIncrease,     " &
    "     Emp_IsTop=@Emp_IsTop,                                 " &
    "     Emp_ProvidentFund=@Emp_ProvidentFund,                 " &
    "     Emp_PensionFund=@Emp_PensionFund,                     " &
    "     Emp_DOfStartPrFund=@Emp_DOfStartPrFund,               " &
    "     Emp_10PercentDecrease=@Emp_10PercentDecrease          " &
    "     WHERE Emp_Code = @Emp_Code " &
    " End "

        i = ExecuteNonQuery(Str)

        Str = " CREATE PROCEDURE [dbo].[AG_PrAnScales2_SAVE_UPDATE] " &
    " @Sc2_Code nvarchar(20), " &
    " @Sc2_Description nvarchar(100) " &
    " As " &
    "  Declare @Result As Int " &
    "  Set @Result = 0 " &
    "  Select @Result = Count(*) " &
    "  FROM PrAnScales2 " &
    "  WHERE Sc2_Code = @Sc2_Code " &
    "  If(@Result Is NULL) Or (@Result=0) " &
    "    BEGIN " &
    "      INSERT INTO PrAnScales2 " &
    "     (Sc2_Code,                                           " &
    "      Sc2_Description                                     " &
    "      ) " &
    "      VALUES ( " &
    "      @Sc2_Code,     " &
    "      @Sc2_Description     " &
    "      ) " &
    "    End " &
    " Else " &
    "    BEGIN " &
    "      UPDATE PrAnScales2 " &
    "      Set  " &
    "      Sc2_Code=@Sc2_Code,                                   " &
    "      Sc2_Description=@Sc2_Description                      " &
    "      WHERE Sc2_Code = @Sc2_Code " &
    "  End "

        i = ExecuteNonQuery(Str)

        Str = " CREATE PROCEDURE [dbo].[AG_PrAnScales1_SAVE_UPDATE] " &
    " @Sc1_Code nvarchar(20), " &
    " @Sc1_Description nvarchar(100) " &
    " As " &
    "   Declare @Result As Int " &
    "   Set @Result = 0 " &
    "   Select @Result = Count(*) " &
    "   FROM PrAnScales1 " &
    "   WHERE Sc1_Code = @Sc1_Code " &
    "   If(@Result Is NULL) Or (@Result=0) " &
    " BEGIN " &
    "       INSERT INTO PrAnScales1 " &
    "      (Sc1_Code,                     " &
    "       Sc1_Description                 " &
    "       ) " &
    "       VALUES ( " &
    "       @Sc1_Code,     " &
    "       @Sc1_Description     " &
    "       ) " &
    "     End " &
    "  Else " &
    "     BEGIN " &
    "       UPDATE PrAnScales1 " &
    "       Set  " &
    "       Sc1_Code=@Sc1_Code,                                 " &
    "       Sc1_Description=@Sc1_Description                     " &
    "       WHERE Sc1_Code = @Sc1_Code " &
    "   End "

        i = ExecuteNonQuery(Str)

        MsgBox("done")

        Return True
    End Function
    Protected Function GetExelsysAudit_Employee(FromDate As Date, ExceptNew As Boolean, OnlyNew As Boolean, ExceptLastUpdate As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""

        Dim strDate As String = Format(FromDate, "yyyy-MM-dd")
        If ExceptNew Then
            Str2 = " And Emp_NewEmployee ='0'"
        End If
        If OnlyNew Then
            Str2 = " AND Emp_NewEmployee ='1'"
        End If
        If ExceptLastUpdate Then
            Str3 = " AND AuditGeneral.FieldName<>'Emp_AmendDate' AND AuditGeneral.FieldName<>'Emp_Amendby'"
        End If

        Str = " SELECT " &
        " PrMsEmployees.Emp_Code as Code, " &
        " PrMsEmployees.Emp_FullName as Employee," &
        " AuditGeneral.UpdateDate as UpdateDate," &
        " AuditGeneral.UserName as UpdatedBy," &
        " AuditGeneral.FieldName as FieldName, " &
        " AuditGeneral.OldValue as OldValue," &
        " AuditGeneral.NewValue as NewValue" &
        " FROM AuditGeneral INNER JOIN" &
        " PrMsEmployees ON AuditGeneral.ID COLLATE Greek_CI_AS = PrMsEmployees.Emp_Code" &
        " Where AuditGeneral.TableName ='PrMsEmployees'" &
        " And AuditGeneral.UpdateDate >=" & enQuoteString(strDate)

        Str4 = " order by UpdateDate desc," &
        " Emp_Code "

        Str = Str & Str2 & Str3 & Str4

        Return GetData(Str)


    End Function
    Protected Function GetExelsysAudit_Salary(FromDate As Date, ExceptNew As Boolean, OnlyNew As Boolean, ExceptLastUpdate As Boolean) As DataSet
        Dim Str As String
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim Str4 As String = ""

        Dim strDate As String = Format(FromDate, "yyyy-MM-dd")
        If ExceptNew Then
            Str2 = " AND PrMsEmployees.Emp_NewEmployee ='0'"
        End If
        If OnlyNew Then
            Str2 = " AND PrMsEmployees.Emp_NewEmployee ='1'"
        End If
        ' If ExceptLastUpdate Then
        ' Str3 = " AND AuditGeneral.FieldName<>'Emp_AmendDate' AND AuditGeneral.FieldName<>'Emp_Amendby'"
        ' End If

        Str = " SELECT " &
         " PrMsEmployees.Emp_Code as Code,  " &
         " PrMsEmployees.Emp_FullName as Employee, " &
         " AuditGeneral.UpdateDate as UpdateDate, " &
         " AuditGeneral.UserName as UpdatedBy, " &
         " AuditGeneral.FieldName as FieldName, " &
         " AuditGeneral.OldValue as OldValue, " &
         " AuditGeneral.NewValue as NewValue " &
         " FROM PrMsEmployees INNER JOIN " &
         " PrTxEmployeeSalary ON PrMsEmployees.Emp_Code = PrTxEmployeeSalary.Emp_Code INNER JOIN " &
         " AuditGeneral ON PrTxEmployeeSalary.EmpSal_id = AuditGeneral.ID " &
        " WHERE (AuditGeneral.TableName = 'PrTxEmployeeSalary') " &
        " And AuditGeneral.UpdateDate >=" & enQuoteString(strDate) &
        " And (AuditGeneral.FieldName ='EmpSal_Value' or AuditGeneral.FieldName ='EmpSal_date')"


        Str4 = " order by UpdateDate desc," &
        " PrMsEmployees.Emp_Code "

        Str = Str & Str2 & Str3 & Str4

        Return GetData(Str)


    End Function
    Protected Function Upgrade_2024_11()
        Dim Str As String
        Dim Exx As New System.Exception

        Dim i As Integer


        Str = " CREATE TABLE [dbo].[PrAnScales3] ( " &
    "	[Sc3_Code] [nvarchar](20) NOT NULL, " &
    "	[Sc3_Description] [nvarchar](100) NULL, " &
    " CONSTRAINT [PK_PrAnScales3] PRIMARY KEY CLUSTERED  " &
    " ( " &
    "	[Sc3_Code] ASC " &
    " )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY] " &
    " ) ON [PRIMARY]"

        i = ExecuteNonQuery(Str)


        Str = "ALTER TABLE PrMsEmployeeExtraDetails " &
        " ADD [Rnk_Code] varchar(16) NULL "


        i = ExecuteNonQuery(Str)



        Str = " ALTER PROCEDURE [dbo].[AG_PrMsEmployeeExtraDetails_SAVE_UPDATE] " &
    " @Emp_Code varchar(16), " &
    " @Emp_StartDateToPrevServ smalldatetime, " &
    " @PosCat_Code varchar(16), " &
    " @PosRnk_Code varchar(16), " &
    " @Emp_RetirementDate63 smalldatetime, " &
    " @Emp_RetirementDate65 smalldatetime, " &
    " @Emp_ComDate400Months smalldatetime,  " &
    " @Emp_ExtraRatePerHour decimal(18,2), " &
    " @Emp_DOfNextRateIncrease smalldatetime, " &
    " @Emp_IsTop nchar(10), " &
    " @Emp_ProvidentFund nchar(10), " &
    " @Emp_PensionFund nchar(10), " &
    " @Emp_DOfStartPrFund smalldatetime, " &
    " @Emp_10PercentDecrease nchar(10), " &
    " @Rnk_Code varchar(16) " &
    " AS " &
    "  DECLARE @Result as Int " &
    "  Set @Result = 0 " &
    "  SELECT @Result = Count(*) " &
    "  FROM PrMsEmployeeExtraDetails " &
    "  WHERE Emp_Code = @Emp_Code " &
    "  IF(@Result IS NULL) OR (@Result=0) " &
    "    BEGIN " &
    "      INSERT INTO PrMsEmployeeExtraDetails " &
    "     (Emp_Code,                                          " &
    "      Emp_StartDateToPrevServ,                            " &
    "      PosCat_Code,                                        " &
    "     PosRnk_Code,                                        " &
    "     Emp_RetirementDate63,                               " &
    "     Emp_RetirementDate65,                               " &
    "     Emp_ComDate400Months,                               " &
    "     Emp_ExtraRatePerHour,                               " &
    "     Emp_DOfNextRateIncrease,                            " &
    "     Emp_IsTop,                                          " &
    "     Emp_ProvidentFund,                                  " &
    "     Emp_PensionFund,                                    " &
    "     Emp_DOfStartPrFund,                                 " &
    "     Emp_10PercentDecrease,                               " &
    "     Rnk_Code                                            " &
    "     )  " &
    "     VALUES ( " &
    "     @Emp_Code,     " &
    "     @Emp_StartDateToPrevServ,  " &
    "     @PosCat_Code,                    " &
    "     @PosRnk_Code,                          " &
    "     @Emp_RetirementDate63,            " &
    "     @Emp_RetirementDate65,                 " &
    "     @Emp_ComDate400Months,                     " &
    "     @Emp_ExtraRatePerHour,                           " &
    "     @Emp_DOfNextRateIncrease,                            " &
    "     @Emp_IsTop,                                          " &
    "     @Emp_ProvidentFund,                                  " &
    "     @Emp_PensionFund,                                    " &
    "     @Emp_DOfStartPrFund,                                 " &
    "     @Emp_10PercentDecrease,                               " &
    "     @Rnk_Code                          " &
    "     ) " &
    "   END " &
    " ELSE " &
    "   BEGIN " &
    "     UPDATE PrMsEmployeeExtraDetails " &
    "     SET  " &
    "     Emp_Code=@Emp_Code,                                   " &
    "     Emp_StartDateToPrevServ=@Emp_StartDateToPrevServ,     " &
    "     PosCat_Code=@PosCat_Code,                             " &
    "     PosRnk_Code=@PosRnk_Code,                             " &
    "     Emp_RetirementDate63=@Emp_RetirementDate63,           " &
    "     Emp_RetirementDate65=@Emp_RetirementDate65,           " &
    "     Emp_ComDate400Months=@Emp_ComDate400Months,           " &
    "     Emp_ExtraRatePerHour=@Emp_ExtraRatePerHour,           " &
    "     Emp_DOfNextRateIncrease=@Emp_DOfNextRateIncrease,     " &
    "     Emp_IsTop=@Emp_IsTop,                                 " &
    "     Emp_ProvidentFund=@Emp_ProvidentFund,                 " &
    "     Emp_PensionFund=@Emp_PensionFund,                     " &
    "     Emp_DOfStartPrFund=@Emp_DOfStartPrFund,               " &
    "     Emp_10PercentDecrease=@Emp_10PercentDecrease,          " &
    "     Rnk_Code=@Rnk_Code                             " &
    "     WHERE Emp_Code = @Emp_Code " &
    " END "

        i = ExecuteNonQuery(Str)

        Str = " CREATE PROCEDURE [dbo].[AG_PrAnScales3_SAVE_UPDATE] " &
    " @Sc3_Code nvarchar(20), " &
    " @Sc3_Description nvarchar(100) " &
    " AS " &
    "  DECLARE @Result as Int " &
    "  Set @Result = 0 " &
    "  SELECT @Result = Count(*) " &
    "  FROM PrAnScales3 " &
    "  WHERE Sc3_Code = @Sc3_Code " &
    "  IF(@Result IS NULL) OR (@Result=0) " &
    "    BEGIN " &
    "      INSERT INTO PrAnScales3 " &
    "     (Sc3_Code,                                           " &
    "      Sc3_Description                                     " &
    "      ) " &
    "      VALUES ( " &
    "      @Sc3_Code,     " &
    "      @Sc3_Description     " &
    "      ) " &
    "    END " &
    " ELSE " &
    "    BEGIN " &
    "      UPDATE PrAnScales3 " &
    "      SET  " &
    "      Sc3_Code=@Sc3_Code,                                   " &
    "      Sc3_Description=@Sc3_Description                      " &
    "      WHERE Sc3_Code = @Sc3_Code " &
    "  END "

        i = ExecuteNonQuery(Str)




        MsgBox("done")

        Return True
    End Function

    Protected Function Upgrade_2024_12()
        Dim Str As String
        Dim Exx As New System.Exception

        Str = "ALTER TABLE PrMsEmployees " &
        " ADD [Emp_PrevUnion] Decimal(18,2) NULL "
        Dim i As Integer
        i = ExecuteNonQuery(Str)


        MsgBox("Field Added")

        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(30)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1), " &
        " @Emp_GESYFromSplit decimal(18,2), " &
        " @Emp_AnalGen1 varchar(20), " &
        " @Emp_Nameday varchar(10), " &
        " @Emp_IsDirector varchar(1), " &
        " @Emp_Rehire varchar(16), " &
        " @Emp_CNP varchar(16), " &
        " @Emp_TACode varchar(16), " &
        " @Emp_HRCode varchar(16), " &
        " @Emp_TermReason varchar(2), " &
        " @Emp_HireReason varchar(2), " &
        " @Emp_Email2 Varchar(70), " &
        " @Emp_Maternity Varchar(1), " &
        " @Emp_FEControlAmount Decimal(18,2)," &
         "@Emp_PrevUnion Decimal(18,2) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen, " &
        " Emp_GESYFromSplit, " &
        " Emp_AnalGen1, " &
        " Emp_NameDay, " &
        " Emp_IsDirector, " &
        " Emp_Rehire, " &
        " Emp_CNP,  " &
        " Emp_TACode,  " &
        " Emp_HRCode,  " &
        " Emp_TermReason,  " &
        " Emp_HireReason,  " &
        " Emp_Email2,  " &
        " Emp_Maternity, " &
        " Emp_FEControlAmount, " &
        " Emp_PrevUnion " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen, " &
        " @Emp_GESYFromSplit, " &
        " @Emp_AnalGen1," &
        " @Emp_Nameday, " &
        " @Emp_IsDirector, " &
        " @Emp_Rehire, " &
        " @Emp_CNP,  " &
        " @Emp_TACode,  " &
        " @Emp_HRCode,  " &
        " @Emp_TermReason,  " &
        " @Emp_HireReason,  " &
        " @Emp_Email2,  " &
        " @Emp_Maternity, " &
        " @Emp_FEControlAmount, " &
        " @Emp_PrevUnion " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen, " &
        " Emp_GESYFromSplit= @Emp_GESYFromSplit, " &
        " Emp_AnalGen1 = @Emp_AnalGen1," &
        " Emp_Nameday = @Emp_NameDay, " &
        " Emp_Isdirector = @Emp_Isdirector, " &
        " Emp_Rehire = @Emp_Rehire, " &
        " Emp_CNP = @Emp_CNP,  " &
        " Emp_TACode = @Emp_TACode,  " &
        " Emp_HRCode = @Emp_HRCode,  " &
        " Emp_TermReason = @Emp_TermReason,  " &
        " Emp_HireReason = @Emp_HireReason,  " &
        " Emp_Email2 = @Emp_Email2,  " &
        " Emp_Maternity = @Emp_Maternity, " &
        " Emp_FEControlAmount = @Emp_FEControlAmount, " &
        " Emp_PrevUnion =  @Emp_PrevUnion " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True
    End Function

    Protected Function REPORT_IR7_4_ForPERIOD(ByVal PerGrp As cPrMsPeriodGroups, ByVal FromCode As String, ByVal ToCode As String, ByVal YearDate As Date, ForPeriodCode As String, ByVal ShowMessages As Boolean, ByVal ShowinExcel As Boolean, ByVal BIKonSI As Boolean, ByVal DissableRehire As Boolean) As DataSet
        Dim Ds As New DataSet
        Dim Str As String
        Dim str1_1 As String = ""
        Dim Str2 As String = ""
        Dim Str3 As String = ""
        Dim DsEmp As DataSet
        Dim i As Integer
        Dim Error1 As String = "1 Before All"
        Dim MainError As String = ""
        Dim HasErrors As Boolean = False

        Dim R As DataRow
        Dim NoAddition As Boolean = False

        Dim ii As Integer = 0

        Dim C_EmpLastName As Integer = 0
        Dim C_EmpFirstName As Integer = 1
        Dim C_EmpName As Integer = 2
        Dim C_EmpTaxID As Integer = 3
        Dim C_EmpIDType As Integer = 4
        Dim C_EmpIDCard As Integer = 5
        Dim C_Local As Integer = 6
        Dim C_Abroad As Integer = 7
        Dim C_Allowances As Integer = 8
        Dim C_Total456 As Integer = 9
        Dim C_SI As Integer = 10
        Dim C_PF As Integer = 11
        Dim C_MF As Integer = 12
        Dim C_UNION As Integer = 13
        Dim C_OtherDisc As Integer = 14
        Dim C_TotalDisc As Integer = 15
        Dim C_Taxable As Integer = 16
        Dim C_IT As Integer = 17
        Dim C_StartDate As Integer = 18
        Dim C_LeaveDate As Integer = 19
        Dim C_Adr1 As Integer = 20
        Dim C_Adr2 As Integer = 21
        Dim C_Adr3 As Integer = 22
        Dim C_PostCode As Integer = 23
        Dim C_PensionNo As Integer = 24
        Dim C_PensionType As Integer = 25
        Dim C_SINo As Integer = 26
        Dim C_EmpCode As Integer = 27
        Dim C_STDeduction As Integer = 28
        Dim C_STContribution As Integer = 29
        Dim C_salaryPeriods As Integer = 30
        Dim C_LifeInsurance As Integer = 31

        Dim C_AllowancesBenefits As Integer = 32
        Dim C_TaxableFromOther As Integer = 33
        Dim C_NonTaxableIncome As Integer = 34

        Dim C_SyntaksiodotikaOfelimata As Integer = 35
        Dim C_MeiwsiApolavon As Integer = 36
        Dim C_WidowAndOrphans As Integer = 37
        Dim C_Pensionfund As Integer = 38

        '#2019
        Dim C_BIK_withSI As Integer = 39
        Dim C_BIK_withoutSI As Integer = 40

        'Include them in Total epr7m3t0r4c1
        'end of #2019
        Dim C_GESYtoSI As Integer = 41
        Dim C_GESYtoBIKDed As Integer = 42
        Dim C_GESYtoBIKCon As Integer = 43



        Dim C_EmpType As Integer = 44
        Dim C_Rehire As Integer = 45

        Dim C_DirectorFees As Integer = 46





        Dim LocalErn As Integer = 0
        Dim AbroadErn As Integer = 0
        Dim Allowances As Integer = 0
        Dim TotalErn As Integer = 0
        Dim SI As Integer = 0
        Dim MF As Integer = 0
        Dim UnionMF As Integer = 0
        Dim Union As Integer = 0
        Dim PF As Integer = 0
        Dim LifeInsurance As Double = 0
        Dim OtherDisc As Double = 0
        Dim FE As Double = 0
        Dim Life_Other As Integer
        Dim LifeIns As Integer
        Dim TotalDisc As Integer = 0


        Dim MeiwsiApolavon As Double
        Dim WidowAndOrphans As Double
        Dim Pensionfund As Integer

        Dim D2 As Date
        D2 = DateAdd(DateInterval.Year, 1, YearDate)
        Dim SYear As String = Format(D2, "yyyy-MM-dd")
        SYear = Utils.ChangeDateFormatForSearch(SYear)

        ' Define Data Table
        Dim dt As New DataTable

        dt = New DataTable("Employee")
        '0
        dt.Columns.Add(New DataColumn("EmpLastName", System.Type.GetType("System.String")))
        '1
        dt.Columns.Add(New DataColumn("EmpFirstName", System.Type.GetType("System.String")))
        '2
        dt.Columns.Add(New DataColumn("EmpName", System.Type.GetType("System.String")))
        '3
        dt.Columns.Add(New DataColumn("EmpTaxID", System.Type.GetType("System.String")))
        '4
        dt.Columns.Add(New DataColumn("EmpIDType", System.Type.GetType("System.String")))
        '5
        dt.Columns.Add(New DataColumn("EmpIDCard", System.Type.GetType("System.String")))
        '6
        dt.Columns.Add(New DataColumn("Local", System.Type.GetType("System.Int32")))
        '7
        dt.Columns.Add(New DataColumn("Abroad", System.Type.GetType("System.Int32")))
        '8
        dt.Columns.Add(New DataColumn("Allowances", System.Type.GetType("System.Int32")))
        '9
        dt.Columns.Add(New DataColumn("Total456", System.Type.GetType("System.Int32")))
        '10
        dt.Columns.Add(New DataColumn("SI", System.Type.GetType("System.Int32")))
        '11
        dt.Columns.Add(New DataColumn("PF", System.Type.GetType("System.Int32")))
        '12
        dt.Columns.Add(New DataColumn("MF", System.Type.GetType("System.Int32")))
        '13
        dt.Columns.Add(New DataColumn("UNION", System.Type.GetType("System.Int32")))
        '14
        dt.Columns.Add(New DataColumn("OtherDisc", System.Type.GetType("System.Int32")))
        '15
        dt.Columns.Add(New DataColumn("TotalDisc", System.Type.GetType("System.Int32")))
        '16
        dt.Columns.Add(New DataColumn("Taxable", System.Type.GetType("System.Int32")))
        '17
        dt.Columns.Add(New DataColumn("IT", System.Type.GetType("System.Double")))
        '18
        dt.Columns.Add(New DataColumn("StartDate", System.Type.GetType("System.String")))
        '19
        dt.Columns.Add(New DataColumn("LeaveDate", System.Type.GetType("System.String")))
        '20
        dt.Columns.Add(New DataColumn("Adr1", System.Type.GetType("System.String")))
        '21
        dt.Columns.Add(New DataColumn("Adr2", System.Type.GetType("System.String")))
        '22
        dt.Columns.Add(New DataColumn("Adr3", System.Type.GetType("System.String")))
        '23
        dt.Columns.Add(New DataColumn("PostCode", System.Type.GetType("System.String")))
        '24
        dt.Columns.Add(New DataColumn("PensionNo", System.Type.GetType("System.String")))
        '25
        dt.Columns.Add(New DataColumn("PensionType", System.Type.GetType("System.String")))
        '26
        dt.Columns.Add(New DataColumn("SINumber", System.Type.GetType("System.String")))
        '27
        dt.Columns.Add(New DataColumn("EmpCode", System.Type.GetType("System.String")))
        '28
        dt.Columns.Add(New DataColumn("STDeduction", System.Type.GetType("System.Double")))
        '29
        dt.Columns.Add(New DataColumn("STContribution", System.Type.GetType("System.Double")))
        '30
        dt.Columns.Add(New DataColumn("SalaryPeriods", System.Type.GetType("System.Int32")))
        '31
        dt.Columns.Add(New DataColumn("LifeInsurance", System.Type.GetType("System.Int32")))
        '32
        dt.Columns.Add(New DataColumn("AllowancesBenefits", System.Type.GetType("System.Int32")))
        '33
        dt.Columns.Add(New DataColumn("TaxableFromOther", System.Type.GetType("System.Int32")))
        '34
        dt.Columns.Add(New DataColumn("NonTaxable", System.Type.GetType("System.Int32")))
        '35
        dt.Columns.Add(New DataColumn("Syntaksiodotika", System.Type.GetType("System.Int32")))
        '36
        dt.Columns.Add(New DataColumn("MeiwsiApolavon", System.Type.GetType("System.Double")))
        '37
        dt.Columns.Add(New DataColumn("WidowAndOrphans", System.Type.GetType("System.Double")))
        '38
        dt.Columns.Add(New DataColumn("PensionFund", System.Type.GetType("System.Int32")))

        '#2019
        '39
        dt.Columns.Add(New DataColumn("BIKwithGESY", System.Type.GetType("System.Int32")))
        '40
        dt.Columns.Add(New DataColumn("BIKWithoutGESY", System.Type.GetType("System.Int32")))
        '41
        dt.Columns.Add(New DataColumn("GESYToSI", System.Type.GetType("System.Double")))
        '42
        dt.Columns.Add(New DataColumn("GESYtoBIKDed", System.Type.GetType("System.Double")))
        '43
        dt.Columns.Add(New DataColumn("GESYtoBIKCon", System.Type.GetType("System.Double")))
        '44
        dt.Columns.Add(New DataColumn("EmpType", System.Type.GetType("System.String")))
        '45
        dt.Columns.Add(New DataColumn("Rehire", System.Type.GetType("System.String")))
        '46
        dt.Columns.Add(New DataColumn("DirectorFees", System.Type.GetType("System.Double")))



        Ds.Tables.Add(dt)

        '''''''''''''''''
        Dim TempGroup As New cPrMsTemplateGroup(PerGrp.TemGrpCode)

        Str = " SELECT Emp_Code," &
        " Emp_FullName," &
        " Emp_Address1," &
        " Emp_Address2," &
        " Emp_Address3," &
        " Emp_PostCode," &
        " Emp_TaxID," &
        " Emp_TerminateDate, " &
        " Emp_StartDate," &
        " Emp_LastName," &
        " Emp_FirstName," &
        " Emp_PassportNumber," &
        " Emp_IdentificationCard," &
        " Emp_AlienNumber," &
        " Emp_SocialInsNumber," &
        " TicTyp_Code," &
        " Emp_DrivingLicense, " &
        " Emp_PensionNo," &
        " Emp_PensionType, " &
        " Emp_socialinsnumber, " &
        " Emp_OtherIncome1, " &
        " Emp_LWBPen, " &
        " Emp_Rehire, " &
        " Emp_IsDirector " &
        " FROM PrMsEmployees " &
        " WHERE Emp_Code in " &
        " (SELECT Emp_Code FROM PrTxTrxnHeader WHERE " &
        " (PrTxTrxnHeader.Com_Code = " & enQuoteString(TempGroup.CompanyCode) & " ) " &
        " AND (PrTxTrxnHeader.TrxHdr_Year = " & enQuoteString(PerGrp.Year) & "))"

        If Global1.PARAM_HideEmpWithBlanksSIR Then
            str1_1 = " AND (ComSin_EmpSocialInsNo <>'')"
        End If


        If FromCode <> "" Or ToCode <> "" Then
            Str2 = " AND (Emp_Code >= " & enQuoteString(FromCode) &
                 " AND Emp_Code <= " & enQuoteString(ToCode) & ")"
        End If

        Str3 = " Order by Emp_Rehire Asc"
        If DissableRehire Then
            Str3 = " Order by Emp_Code Asc"
        End If
        Str = Str & str1_1 & Str2 & Str3
        Error1 = "2 Before Query"
        DsEmp = GetData(Str)
        Error1 = "3 After Query"
        If CheckDataSet(DsEmp) Then


            For i = 0 To DsEmp.Tables(0).Rows.Count - 1
                Dim k As Integer
                ' sss()
                'For k = 0 To dt.Rows.Count - 1


                'Next

                R = dt.NewRow
                Dim Rehire As String
                Rehire = DbNullToString(DsEmp.Tables(0).Rows(i).Item(22))
                If Rehire <> "" Then
                    NoAddition = True
                End If


                Application.DoEvents()
                Dim EmpCode As String
                EmpCode = DbNullToString(DsEmp.Tables(0).Rows(i).Item(0))


                R(C_EmpName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(1))
                '  Debug.WriteLine(i & " " & DbNullToString(DsEmp.Tables(0).Rows(i).Item(1)))
                Dim Adr1 As String = DbNullToString(DsEmp.Tables(0).Rows(i).Item(2))
                Dim Adr2 As String = DbNullToString(DsEmp.Tables(0).Rows(i).Item(3))
                Dim Adr3 As String = DbNullToString(DsEmp.Tables(0).Rows(i).Item(4))

                Adr1 = Adr1.Replace("!", "")
                Adr1 = Adr1.Replace("&", "")
                Adr1 = Adr1.Replace("$", "")
                Adr1 = Adr1.Replace("@", "")
                Adr1 = Adr1.Replace("/", "")
                Adr1 = Adr1.Replace(",", "")
                Adr1 = Adr1.Replace("-", "")
                Adr1 = Adr1.Replace(".", "")

                Adr2 = Adr2.Replace("!", "")
                Adr2 = Adr2.Replace("&", "")
                Adr2 = Adr2.Replace("$", "")
                Adr2 = Adr2.Replace("@", "")
                Adr2 = Adr2.Replace("/", "")
                Adr2 = Adr2.Replace(",", "")
                Adr2 = Adr2.Replace("-", "")
                Adr2 = Adr2.Replace(".", "")

                Adr3 = Adr3.Replace("!", "")
                Adr3 = Adr3.Replace("&", "")
                Adr3 = Adr3.Replace("$", "")
                Adr3 = Adr3.Replace("@", "")
                Adr3 = Adr3.Replace("/", "")
                Adr3 = Adr3.Replace(",", "")
                Adr3 = Adr3.Replace("-", "")
                Adr3 = Adr3.Replace(".", "")


                R(C_Adr1) = Adr1
                R(C_Adr2) = Adr2
                R(C_Adr3) = Adr3
                R(C_PostCode) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(5))
                R(C_EmpTaxID) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(6))
                R(C_Rehire) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(22))

                If Adr1 = "" Then
                    If ShowMessages Then
                        HasErrors = True
                        'MsgBox("Employee with Code " & EmpCode & " has a Tax Identification Type of " & IDType & " with an empty Value,Please correct", MsgBoxStyle.Critical)
                        MainError = MainError & Chr(10) & "Employee with Code " & EmpCode & " has no Address Line 1"
                        'Ds.Tables.Clear()
                        'Exit Function
                    End If
                End If

                If DbNullToString(DsEmp.Tables(0).Rows(i).Item(3)) = "" Then
                    If ShowMessages Then
                        HasErrors = True
                        'MsgBox("Employee with Code " & EmpCode & " has a Tax Identification Type of " & IDType & " with an empty Value,Please correct", MsgBoxStyle.Critical)
                        MainError = MainError & Chr(10) & "Employee with Code " & EmpCode & " has no CITY"
                        'Ds.Tables.Clear()
                        'Exit Function
                    End If
                End If

                If DbNullToString(DsEmp.Tables(0).Rows(i).Item(5)) = "" Then
                    If ShowMessages Then
                        HasErrors = True
                        'MsgBox("Employee with Code " & EmpCode & " has a Tax Identification Type of " & IDType & " with an empty Value,Please correct", MsgBoxStyle.Critical)
                        MainError = MainError & Chr(10) & "Employee with Code " & EmpCode & " has no POST CODE"
                        'Ds.Tables.Clear()
                        'Exit Function
                    End If
                End If
                If DbNullToString(DsEmp.Tables(0).Rows(i).Item(14)) = "" Then
                    If ShowMessages Then
                        HasErrors = True
                        'MsgBox("Employee with Code " & EmpCode & " has a Tax Identification Type of " & IDType & " with an empty Value,Please correct", MsgBoxStyle.Critical)
                        MainError = MainError & Chr(10) & "Employee with Code " & EmpCode & " has no Social Insurance Number"
                        'Ds.Tables.Clear()
                        'Exit Function
                    End If
                End If





                Dim T As String
                T = DbNullToString(DsEmp.Tables(0).Rows(i).Item(7))
                If T = "" Then
                    R(C_LeaveDate) = ""
                Else
                    Try
                        R(C_LeaveDate) = Format(CDate(T), "dd/MM/yyyy")

                    Catch ex As Exception
                        MsgBox("Error on Employee with Code " & EmpCode & " Leave date is invalid", MsgBoxStyle.Critical)
                        Ds.Tables.Clear()
                        Exit Function

                    End Try
                End If 'DbNullToString(DsEmp.Tables(0).Rows(i).Item(7))
                If DbNullToDate(DsEmp.Tables(0).Rows(i).Item(8)).Year = YearDate.Year() Then
                    R(C_StartDate) = Format(DbNullToDate(DsEmp.Tables(0).Rows(i).Item(8)), "dd/MM/yyyy")
                Else
                    R(C_StartDate) = " "
                End If


                R(C_EmpLastName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(9))
                R(C_EmpFirstName) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(10))

                Dim IDType As String = DbNullToString(DsEmp.Tables(0).Rows(i).Item(15))
                Dim Found As Boolean = False
                Dim IDValue As String = ""
                If IDType = "1" Then
                    Found = True
                    R(C_EmpIDType) = " "
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(6))
                    IDValue = DbNullToString(DsEmp.Tables(0).Rows(i).Item(6))
                    'ElseIf IDType = "2" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(11))
                ElseIf IDType = "3" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    'R(C_EmpIDType) = ""
                    If DbNullToString(DsEmp.Tables(0).Rows(i).Item(12)) <> "" Then
                        Dim S As String
                        S = DsEmp.Tables(0).Rows(i).Item(12)
                        If S.Substring(0, 1) = "0" Then
                            S = S.Substring(1, S.Length - 1)
                            DsEmp.Tables(0).Rows(i).Item(12) = S
                        End If
                    End If
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(12))
                    IDValue = DbNullToString(DsEmp.Tables(0).Rows(i).Item(12))
                ElseIf IDType = "4" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(16))
                    IDValue = DbNullToString(DsEmp.Tables(0).Rows(i).Item(16))
                    'ElseIf IDType = "5" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(14))
                    'ElseIf IDType = "6" Then
                    '    R(C_EmpIDType) = ""
                    '    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(16))
                ElseIf IDType = "7" Then
                    Found = True
                    R(C_EmpIDType) = ""
                    R(C_EmpIDCard) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(13))
                    IDValue = DbNullToString(DsEmp.Tables(0).Rows(i).Item(13))
                End If
                If Found And IDValue = "" Then
                    If ShowMessages Then
                        HasErrors = True
                        'MsgBox("Employee with Code " & EmpCode & " has a Tax Identification Type of " & IDType & " with an empty Value,Please correct", MsgBoxStyle.Critical)
                        MainError = MainError & Chr(10) & "Employee with Code " & EmpCode & " has a Tax Identification Type of " & IDType & " with an empty Value"
                        'Ds.Tables.Clear()
                        'Exit Function
                    End If
                End If
                If Not Found Then
                    If ShowMessages Then
                        HasErrors = True
                        'MsgBox("Employee with Code " & EmpCode & " Does not have a Valid Tax Identification Type, Valid types are 1,3,4 and 7", MsgBoxStyle.Critical)
                        MainError = MainError & Chr(10) & "Employee with Code " & EmpCode & " Does not have a Valid Tax Identification Type, Valid types are 1,3,4 and 7"
                        'Ds.Tables.Clear()
                        'Exit Function
                    End If
                End If

                R(C_PensionNo) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(17))
                R(C_PensionType) = DbNullToInt(DsEmp.Tables(0).Rows(i).Item(18))
                R(C_SINo) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(19))
                R(C_EmpCode) = DbNullToString(DsEmp.Tables(0).Rows(i).Item(0))
                Dim EmpType As String = "1"
                If DbNullToString(DsEmp.Tables(0).Rows(i).Item(21)) = "1" Then
                    EmpType = "2"
                End If
                If DbNullToString(DsEmp.Tables(0).Rows(i).Item(23)) = "1" Then
                    EmpType = "3"
                End If
                R(C_EmpType) = EmpType

                Dim DsPerPerCom As DataSet
                Dim StrX As String
                StrX = "SELECT PrMsPeriodGroups.PrdGrp_Code " &
                " FROM PrMsPeriodGroups INNER JOIN " &
                " PrMsTemplateGroup ON " &
                " PrMsPeriodGroups.TemGrp_Code = PrMsTemplateGroup.TemGrp_Code " &
                " INNER JOIN " &
                " AdMsCompany ON PrMsTemplateGroup.Com_Code = AdMsCompany.Com_Code " &
                " WHERE (PrMsTemplateGroup.Com_Code = " & enQuoteString(TempGroup.CompanyCode) & ")  " &
                " AND (PrMsPeriodGroups.PrdGpr_Year = " & PerGrp.Year & ") "
                DsPerPerCom = GetData(StrX)

                Dim f As Integer
                Dim StrPeriodGroupCodes
                Dim StrPeriodGroupCodes2
                Dim TempPer As String
                Error1 = "3 Before second Query"
                If CheckDataSet(DsPerPerCom) Then
                    For f = 0 To DsPerPerCom.Tables(0).Rows.Count - 1
                        TempPer = DsPerPerCom.Tables(0).Rows(f).Item(0)
                        If f = 0 Then
                            StrPeriodGroupCodes = " AND ((PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                            StrPeriodGroupCodes2 = " AND ((PrTxTrxnHeader.PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                        Else
                            StrPeriodGroupCodes = StrPeriodGroupCodes & " OR (PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                            StrPeriodGroupCodes2 = StrPeriodGroupCodes2 & " OR (PrTxTrxnHeader.PrdGrp_Code =  " & enQuoteString(TempPer) & ")"
                        End If
                    Next
                    StrPeriodGroupCodes = StrPeriodGroupCodes & ")"
                    StrPeriodGroupCodes2 = StrPeriodGroupCodes2 & ")"

                End If
                Error1 = "4 After second Query"
                Dim DsSpecialTaxDed As DataSet
                Dim DsSpecialTaxCon As DataSet
                GetSumsOfEmployeeDeductions("EX", EmpCode, PerGrp.Code)
                Dim StrSP1 As String
                Dim StrSP2 As String

                StrSP1 = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" &
                    " FROM PrTxTrxnHeader INNER JOIN" &
                    " PrTxTrxnLines ON" &
                    " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
                    " PrMsDeductionCodes ON" &
                    " PrTxTrxnLines.DedCod_Code = PrMsDeductionCodes.DedCod_Code INNER JOIN" &
                    " PrSsDeductionTypes ON" &
                    " PrMsDeductionCodes.DedTyp_Code = PrSsDeductionTypes.DedTyp_Code" &
                    " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" &
                    " AND (PrSsDeductionTypes.DedTyp_Code = 'EX')"

                StrSP1 = StrSP1 + StrPeriodGroupCodes2

                StrSP2 = " SELECT SUM(PrTxTrxnLines.TrxLin_PeriodValue)" &
                    " FROM PrTxTrxnHeader INNER JOIN" &
                    " PrTxTrxnLines ON" &
                    " PrTxTrxnHeader.TrxHdr_Id = PrTxTrxnLines.TrxHdr_Id INNER JOIN" &
                    " PrMsContributionCodes ON" &
                    " PrTxTrxnLines.ConCod_Code = PrMsContributionCodes.ConCod_Code INNER JOIN" &
                    " PrSsContributionTypes ON" &
                    " PrMsContributionCodes.ConTyp_Code = PrSsContributionTypes.ConTyp_Code" &
                    " WHERE (PrTxTrxnHeader.Emp_Code = " & enQuoteString(EmpCode) & ")" &
                    " AND (PrSsContributionTypes.ConTyp_Code = 'EX')"

                StrSP2 = StrSP2 + StrPeriodGroupCodes2

                DsSpecialTaxDed = GetData(StrSP1)
                DsSpecialTaxCon = GetData(StrSP2)
                Dim SPTaxDed As Double = 0
                Dim SPTaxCon As Double = 0

                If CheckDataSet(DsSpecialTaxDed) Then
                    SPTaxDed = DbNullToDouble(DsSpecialTaxDed.Tables(0).Rows(0).Item(0))
                End If
                If CheckDataSet(DsSpecialTaxCon) Then
                    SPTaxCon = DbNullToDouble(DsSpecialTaxCon.Tables(0).Rows(0).Item(0))
                End If

                R(C_STDeduction) = SPTaxDed
                R(C_STContribution) = SPTaxCon


                Dim DsGrossEarnings As DataSet
                Dim DsTaxableEarnings As DataSet


                Str = " SELECT SUM(TrxHdr_TotalErnPeriod)" &
                      " FROM  PrTxTrxnHeader" &
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                Str = Str & StrPeriodGroupCodes
                DsGrossEarnings = GetData(Str)

                Str = " SELECT SUM(TrxHdr_TaxableIncome)" &
                      " FROM  PrTxTrxnHeader" &
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                Str = Str & StrPeriodGroupCodes
                DsTaxableEarnings = GetData(Str)

                Dim NonTaxable As Double
                Dim dsTempAndPer As DataSet
                Dim EmpTempGroup As String = TempGroup.Code
                Dim EmpPerGroup As String = PerGrp.Code
                dsTempAndPer = GetTemplateGroupAndPeriodGroupOfEmployee(EmpCode, PerGrp.Year)
                If CheckDataSet(dsTempAndPer) Then
                    EmpTempGroup = DbNullToString(dsTempAndPer.Tables(0).Rows(0).Item(0))
                    EmpPerGroup = DbNullToString(dsTempAndPer.Tables(0).Rows(0).Item(1))
                End If
                NonTaxable = FindNonTaxableTotalForTemplateGroupForEmployee(EmpTempGroup, EmpPerGroup, EmpCode)

                Dim DsSILeave As DataSet
                'DsSILeave = Me.FindSILeaveTotalIR632(PerGrp.TemGrpCode, PerGrp.Code, EmpCode)
                DsSILeave = Me.FindSILeaveTotalIR63_2Groups(PerGrp.TemGrpCode, StrPeriodGroupCodes, EmpCode)
                Dim SILeaveValue As Double = 0
                If CheckDataSet(DsSILeave) Then
                    SILeaveValue = DbNullToDouble(DsSILeave.Tables(0).Rows(0).Item(0))
                    If SILeaveValue <> 0 Then
                        '   MsgBox(1)
                    End If
                End If

                Dim DsBenefitsInKind As DataSet
                DsBenefitsInKind = Me.FindBenefitsInKindTotalIR63_2Groups(PerGrp.TemGrpCode, StrPeriodGroupCodes, EmpCode)
                Dim BenefitsInKind As Double = 0
                If CheckDataSet(DsBenefitsInKind) Then
                    BenefitsInKind = DbNullToDouble(DsBenefitsInKind.Tables(0).Rows(0).Item(0))
                End If

                Dim DsDirFees As DataSet
                DsDirFees = Me.FindDirFeesTotalIR63_2Groups(PerGrp.TemGrpCode, StrPeriodGroupCodes, EmpCode)
                Dim DirFees As Double = 0
                If CheckDataSet(DsDirFees) Then
                    DirFees = DbNullToDouble(DsDirFees.Tables(0).Rows(0).Item(0))
                End If

                Dim DsOtherCon As DataSet
                Dim OtherContributions As Double = 0
                If Global1.PARAM_AddOtherContributionsOnIR7Gross Then
                    DsOtherCon = Global1.Business.REPORT_IR7_OtherContributions_CONTRIBUTION(EmpCode, StrPeriodGroupCodes)
                    If CheckDataSet(DsOtherCon) Then
                        OtherContributions = DbNullToDouble(DsOtherCon.Tables(0).Rows(0).Item(0))
                    End If
                End If



                LocalErn = DbNullToDouble(DsGrossEarnings.Tables(0).Rows(0).Item(0)) - NonTaxable + SILeaveValue + BenefitsInKind
                LocalErn = LocalErn + OtherContributions






                'LocalErn = RoundMe3(LocalErn, 0)

                R(C_Local) = LocalErn




                AbroadErn = "0.00"
                R(C_Abroad) = AbroadErn
                Allowances = RoundMe3(DbNullToDouble(DsEmp.Tables(0).Rows(i).Item(20)), 2)

                R(C_Allowances) = Allowances

                TotalErn = LocalErn + AbroadErn + Allowances
                R(C_Total456) = TotalErn



                Dim DsSI As DataSet = GetSumsOfEmployeeDeductions_IR7("SI", EmpCode, StrPeriodGroupCodes)
                SI = RoundMe3(DbNullToDouble(DsSI.Tables(0).Rows(0).Item(0)), 0)
                R(C_SI) = SI


                Dim DsPensionFund As DataSet = GetSumsOfEmployeeDeductions_IR7("PN", EmpCode, StrPeriodGroupCodes)
                Pensionfund = RoundMe3(DbNullToDouble(DsPensionFund.Tables(0).Rows(0).Item(0)), 0)
                R(C_Pensionfund) = Pensionfund

                Dim DSWidowAndOrphans As DataSet = GetSumsOfEmployeeDeductions_IR7("WO", EmpCode, StrPeriodGroupCodes)
                WidowAndOrphans = RoundMe3(DbNullToDouble(DSWidowAndOrphans.Tables(0).Rows(0).Item(0)), 0)
                R(C_WidowAndOrphans) = WidowAndOrphans


                Dim DsPF As DataSet = GetSumsOfEmployeeDeductions_IR7("PF", EmpCode, StrPeriodGroupCodes)
                PF = RoundMe3(DbNullToDouble(DsPF.Tables(0).Rows(0).Item(0)), 0)
                PF = PF + Pensionfund + WidowAndOrphans
                R(C_PF) = PF

                R(C_SyntaksiodotikaOfelimata) = Pensionfund + WidowAndOrphans


                Dim DsMF As DataSet = GetSumsOfEmployeeDeductions_IR7("MF", EmpCode, StrPeriodGroupCodes)
                MF = RoundMe3(DbNullToDouble(DsMF.Tables(0).Rows(0).Item(0)), 0)

                Dim DsUnionMF As DataSet = GetSumsOfEmployeeDeductions_IR7("UM", EmpCode, StrPeriodGroupCodes)
                UnionMF = RoundMe3(DbNullToDouble(DsUnionMF.Tables(0).Rows(0).Item(0)), 0)
                MF = MF + unionmf

                Dim MF2 As Double = 0
                Dim MFLimit As Double = 0
                Dim DsMF2 As DataSet = GetEmployeeMF_For_IR7(EmpCode, StrPeriodGroupCodes)
                If CheckDataSet(DsMF2) Then
                    MF2 = DbNullToDouble(DsMF2.Tables(0).Rows(0).Item(0))
                    MFLimit = DbNullToDouble(DsMF2.Tables(0).Rows(0).Item(1))
                End If
                MF = MF + MF2
                If MFLimit <> 0 Then
                    If MF > MFLimit Then
                        MF = MFLimit
                    End If
                End If

                R(C_MF) = MF

                '2022 MEIWSI round to 2 Decimals
                Dim DSMeiosiApolavon As DataSet = GetSumsOfEmployeeDeductions_IR7("DN", EmpCode, StrPeriodGroupCodes)
                MeiwsiApolavon = RoundMe3(DbNullToDouble(DSMeiosiApolavon.Tables(0).Rows(0).Item(0)), 2)
                R(C_MeiwsiApolavon) = MeiwsiApolavon



                Dim DsU2 As DataSet = GetSumsOfEmployeeDeductions_IR7("U2", EmpCode, StrPeriodGroupCodes)
                Dim DsU3 As DataSet = GetSumsOfEmployeeDeductions_IR7("U3", EmpCode, StrPeriodGroupCodes)
                Dim DsUS As DataSet = GetSumsOfEmployeeDeductions_IR7("US", EmpCode, StrPeriodGroupCodes)
                Dim U As Double = 0
                U = U + DbNullToDouble(DsU2.Tables(0).Rows(0).Item(0))
                U = U + DbNullToDouble(DsU3.Tables(0).Rows(0).Item(0))
                U = U + DbNullToDouble(DsUS.Tables(0).Rows(0).Item(0))
                Union = 0
                Union = RoundMe3(U, 2)

                R(C_UNION) = Union

                'FindEmployeeSalaryPeriods
                Dim NoOfSalary As Integer
                NoOfSalary = Global1.Business.GetNumberOfTotalPeriodsFOREmployee(EmpCode, PerGrp.Year)
                R(C_salaryPeriods) = NoOfSalary

                '
                Life_Other = 0
                OtherDisc = 0
                FE = 0

                If Global1.GLB_IR7Discounts = 0 Then
                    '------------------------------------
                    ''''''Discounts from Header''''''''''
                    '------------------------------------
                    Dim DsDiscounts As DataSet
                    Str = " Select SUM(TrxHdr_LifeInsurance), " &
                          " SUM(TrxHdr_Discounts), " &
                          " SUM(TrxHdr_FE) " &
                          " FROM  PrTxTrxnHeader" &
                          " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                    Str = Str & StrPeriodGroupCodes

                    DsDiscounts = GetData(Str)
                    LifeInsurance = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(0))
                    OtherDisc = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(1))
                    FE = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(2))
                    OtherDisc = OtherDisc + FE
                    'Life_Other = RoundMe3(LifeInsurance + OtherDisc, 2)
                    Life_Other = RoundMe3(OtherDisc, 2)
                Else
                    '------------------------------------
                    ''''''Discounts from Header''''''''''
                    '------------------------------------
                    Dim DsDiscounts
                    DsDiscounts = GetSumsOfEmployeeDiscounts_IR7(EmpCode, StrPeriodGroupCodes)
                    If CheckDataSet(DsDiscounts) Then
                        OtherDisc = DbNullToDouble(DsDiscounts.Tables(0).Rows(0).Item(0))
                    End If

                    Life_Other = RoundMe3(OtherDisc, 2)

                End If
                LifeIns = RoundMe3(LifeInsurance, 2)

                '''''''''''''''''''''''''''''''''''''
                '------------------------------------
                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                'GESY and GESY on BIK
                Dim GesyToSIValue As Double = 0
                Dim GesyToBIKDed As Double = 0
                Dim GesyToBIKCon As Double = 0



                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                '''''''' COPY OF IR61 Code for 701 - 711
                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                Dim DsG71 As DataSet
                Dim D71 As Double = 0
                '711
                DsG71 = Global1.Business.REPORT_IR7_Gesy_DEDUCTION(EmpCode, StrPeriodGroupCodes)
                If CheckDataSet(DsG71) Then
                    D71 = DbNullToDouble(DsG71.Tables(0).Rows(0).Item(0))
                End If

                Dim DsG72 As DataSet
                Dim C72 As Double = 0

                DsG72 = Global1.Business.REPORT_IR7_Gesy_CONTRIBUTION(EmpCode, StrPeriodGroupCodes)
                If CheckDataSet(DsG72) Then
                    C72 = DbNullToDouble(DsG72.Tables(0).Rows(0).Item(0))
                End If

                Dim DsG73 As DataSet

                DsG73 = Global1.Business.REPORT_IR7_Gesy_CONTRIBUTION_LWBPen(EmpCode, StrPeriodGroupCodes)
                If CheckDataSet(DsG73) Then
                    C72 = C72 + DbNullToDouble(DsG73.Tables(0).Rows(0).Item(0))
                    'D71 = D71 + DbNullToDouble(DsG73.Tables(0).Rows(0).Item(0))
                End If

                Dim DsG74 As DataSet
                DsG74 = Global1.Business.REPORT_IR7_Gesy_CONTRIBUTION_Directors(EmpCode, StrPeriodGroupCodes)
                If CheckDataSet(DsG74) Then
                    D71 = D71 + DbNullToDouble(DsG74.Tables(0).Rows(0).Item(0))
                End If

                Dim DsG75 As DataSet
                DsG75 = Global1.Business.REPORT_IR7_Gesy_DEDUCTION_Directors(EmpCode, StrPeriodGroupCodes)
                If CheckDataSet(DsG75) Then
                    C72 = C72 + DbNullToDouble(DsG75.Tables(0).Rows(0).Item(0))
                End If



                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''






                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                '                          IR7 GESY HANDLING
                ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''



                Dim DsGESY As DataSet = GetSumsOfEmployeeDeductionsPerString("GD", EmpCode, StrPeriodGroupCodes)
                If CheckDataSet(DsGESY) Then
                    If EmpType <> "2" Then
                        GesyToSIValue = DbNullToDouble(DsGESY.Tables(0).Rows(0).Item(0))
                    End If
                End If
                ' *******************************************************************************************************************************
                ' Commented out and replaced with above see COPY OF IR61 Code for 701 - 711
                ' *******************************************************************************************************************************
                'Dim DsBIKGESY As DataSet = GetSumsOfEmployeeDeductionsPerString("GT", EmpCode, StrPeriodGroupCodes)
                'If CheckDataSet(DsBIKGESY) Then
                '    GesyToBIKDed = DbNullToDouble(DsBIKGESY.Tables(0).Rows(0).Item(0))
                'End If

                'Dim DsBIKGESYC As DataSet = GetSumsOfEmployeeContributionsPerString("BC", EmpCode, StrPeriodGroupCodes)
                'If CheckDataSet(DsBIKGESYC) Then
                '    GesyToBIKCon = DbNullToDouble(DsBIKGESYC.Tables(0).Rows(0).Item(0))
                'End If
                ' *******************************************************************************************************************************
                '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
                GesyToBIKDed = D71
                GesyToBIKCon = C72





                If BIKonSI Then
                    If GesyToBIKDed <> 0 Then
                        If IDType <> "1" Then
                            GesyToSIValue = GesyToSIValue + GesyToBIKDed + GesyToBIKCon
                            GesyToBIKCon = 0
                            GesyToBIKDed = 0
                            'Change Termination date 31/12/of year when BIK
                            ' If R(C_LeaveDate) = "" Then
                            'R(C_LeaveDate) = "31/12/" & PerGrp.Year
                            'End If
                        End If
                    End If
                End If


                R(C_GESYtoSI) = GesyToSIValue
                R(C_GESYtoBIKDed) = GesyToBIKDed
                R(C_GESYtoBIKCon) = GesyToBIKCon
                ''''''''''''''''''''''''''''''''''''''''''''''
                Life_Other = Life_Other + SPTaxDed
                '*Change 15/12/2020 for Lamber
                'Life_Other = Life_Other + GesyToSIValue + GesyToBIKCon
                Life_Other = Life_Other + GesyToSIValue + GesyToBIKDed

                R(C_OtherDisc) = Life_Other


                'TotalDisc = SI + PF + MF + Union + Life_Other 
                'addition round me up

                TotalDisc = SI + PF + MF + Union + Life_Other + LifeIns + RoundMe3(MeiwsiApolavon, 0)

                R(C_TotalDisc) = TotalDisc
                R(C_LifeInsurance) = LifeIns

                Dim Taxable As Double
                Taxable = RoundMe3(DbNullToDouble(DsTaxableEarnings.Tables(0).Rows(0).Item(0)), 0)
                'R(C_Taxable) = TotalErn - TotalDisc
                If Taxable > 0 Then
                    Taxable = Taxable - TotalDisc + Allowances
                End If
                ''''''''''''''''''''''''''''''''''''''''''
                'Change Action Pension
                ''''''''''''''''''''''''''''''''''''''''''
                ' If Taxable > 0 Then
                If Taxable <> TotalErn - TotalDisc Then
                    Taxable = TotalErn - TotalDisc
                End If
                'End If
                ''''''''''''''''''''''''''''''''''''''''''

                R(C_Taxable) = Taxable


                Dim DsIT As DataSet = GetSumsOfEmployeeDeductions_IR7("IT", EmpCode, StrPeriodGroupCodes)
                R(C_IT) = DbNullToDouble(DsIT.Tables(0).Rows(0).Item(0))



                R(C_BIK_withSI) = 0
                R(C_BIK_withoutSI) = BenefitsInKind
                R(C_DirectorFees) = DirFees





                Str = " SELECT count(*)" &
                      " FROM  PrTxTrxnHeader" &
                      " WHERE (Emp_Code = " & enQuoteString(EmpCode) & ")"
                Str = Str & StrPeriodGroupCodes
                Dim DsCount As DataSet
                DsCount = GetData(Str)
                If CheckDataSet(DsCount) Then
                    If DbNullToInt(DsCount.Tables(0).Rows(0).Item(0)) <> 0 Then
                        If Not NoAddition Then
                            dt.Rows.Add(R)
                        Else
                            If DissableRehire Then
                                dt.Rows.Add(R)
                            Else
                                AddPreviousHireOnRow(Ds, R, Rehire)
                            End If
                        End If
                    End If
                Else
                    MsgBox("Employee with Code " & EmpCode & " will not be added in IR7, zero values for this year")
                End If


            Next

            Dim DsComp As DataSet
            Str = " SELECT AdMsCompany.Com_Name," &
                " AdMsCompany.Com_TIC," &
                " AdMsCompany.Com_Address1," &
                " AdMsCompany.Com_Address2, " &
                " AdMsCompany.Com_Address3," &
                " AdMsCompany.Com_Address4," &
                " AdMsCompany.Com_AccountantTitle," &
                " PrMsTemplateGroup.TemGrp_Code" &
                " FROM AdMsCompany INNER JOIN" &
                " PrMsTemplateGroup ON " &
                " AdMsCompany.Com_Code = PrMsTemplateGroup.Com_Code" &
                " WHERE (PrMsTemplateGroup.TemGrp_Code = " & enQuoteString(PerGrp.TemGrpCode) & ")"

            DsComp = GetData(Str)
            Ds.Tables.Add(DsComp.Tables(0).Copy)
            Ds.Tables(1).TableName = "CompanyDetails"

            Dim DsYear As DataSet
            Str = " SELECT PrdGpr_Year" &
                  " FROM PrMsPeriodGroups" &
                  " where PrdGrp_Code=" & enQuoteString(PerGrp.Code)

            DsYear = GetData(Str)
            Ds.Tables.Add(DsYear.Tables(0).Copy)
            Ds.Tables(2).TableName = "Year"

        End If


        If HasErrors Then
            Ds.Tables.Clear()
            My.Computer.Clipboard.SetText(MainError)
            MainError = "Errors Found ! " & Chr(10) & MainError
            MsgBox(MainError, MsgBoxStyle.Critical)
            MsgBox("Errors are copied to clipboard", MsgBoxStyle.Critical)

        End If


        'If ShowinExcel Then
        ' LoadDataSetToExcel(Ds, "ir7")
        ' End If

        Return Ds
    End Function

#End Region

    Protected Function Upgrade_2025_02()

        Dim Par As New cPrSsParameters
        Par.Id = 0
        Par.Section = "YearPayslip"
        Par.Item = "SIEDCCodes"
        Par.Value1 = "|D7|D20|C4|C1|C5|C6|C12|"
        Par.Type1 = "T"
        Par.System1 = "N"
        Par.Description = "SIEDCCodes"
        If Not Par.Save() Then
            MsgBox("Error")
        End If

        Par = New cPrSsParameters
        Par.Id = 0
        Par.Section = "YearPayslip"
        Par.Item = "TAXEDCCodes"
        Par.Value1 = "|D3|D21|C13|"
        Par.Type1 = "T"
        Par.System1 = "N"
        Par.Description = "TAXEDCCodes"
        If Not Par.Save() Then
            MsgBox("Error")
        End If

        Par = New cPrSsParameters
        Par.Id = 0
        Par.Section = "YearPayslip"
        Par.Item = "TAXCode"
        Par.Value1 = "D3"
        Par.Type1 = "T"
        Par.System1 = "N"
        Par.Description = "TAXCode"
        If Not Par.Save() Then
            MsgBox("Error")
        End If


        MsgBox("Done")
    End Function
    Protected Function Upgrade_2025_03()
        Dim Str As String
        Dim Exx As New System.Exception

        Str = "ALTER TABLE PrMsEmployees " &
        " ALTER COLUMN Emp_Address1 VARCHAR (70) NOT NULL"
        Dim i As Integer
        i = ExecuteNonQuery(Str)


        MsgBox("Field changed")

        ' Alter SPs                                     

        Str = " ALTER PROCEDURE [dbo].[PrMsEmployees_SAVE_UPDATE]" &
        " @Emp_Code varchar(16)," &
        " @Emp_Status char(1)," &
        " @PayTyp_Code varchar(4)," &
        " @TemGrp_Code varchar(6)," &
        " @EmpSta_Code char(1)," &
        " @Emp_Title char(4)," &
        " @Emp_LastName nvarchar(30)," &
        " @Emp_FirstName nvarchar(30)," &
        " @Emp_FullName nvarchar(60)," &
        " @Emp_Sex char(1)," &
        " @Emp_BirthDate smalldatetime," &
        " @MarSta_Code char(1)," &
        " @Emp_Address1 nvarchar(70)," &
        " @Emp_Address2 nvarchar(30)," &
        " @Emp_Address3 nvarchar(30)," &
        " @Emp_PostCode varchar(30)," &
        " @Emp_Telephone1 varchar(20)," &
        " @Emp_Telephone2 varchar(20)," &
        " @Emp_Email varchar(50)," &
        " @Emp_SocialInsNumber varchar(20)," &
        " @ComSin_EmpSocialInsNo varchar(20)," &
        " @Emp_IdentificationCard varchar(10)," &
        " @Emp_TaxID varchar(10)," &
        " @Emp_PassportNumber varchar(10)," &
        " @Emp_AlienNumber varchar(10)," &
        " @TicTyp_Code char(1)," &
        " @EmpAn1_Code varchar(12)," &
        " @EmpAn2_Code varchar(12)," &
        " @EmpAn3_Code varchar(12)," &
        " @EmpAn4_Code varchar(12)," &
        " @EmpAn5_Code varchar(12)," &
        " @Uni_Code varchar(12)," &
        " @Cou_Code char(2)," &
        " @EmpPos_Code varchar(12)," &
        " @Sic_Code varchar(4)," &
        " @EmpCmm_Code varchar(4)," &
        " @PayUni_Code varchar(4)," &
        " @Emp_PeriodUnits Decimal(18,2)," &
        " @Emp_AnnualUnits Decimal(18,2)," &
        " @Cur_Code char(3)," &
        " @PmtMth_Code varchar(4)," &
        " @Bnk_Code varchar(12)," &
        " @Emp_BankAccount varchar(30)," &
        " @Bnk_CodeCo varchar(12)," &
        " @Emp_BankAccountCo varchar(30)," &
        " @Emp_StartDate smalldatetime," &
        " @Emp_TerminateDate varchar(10)," &
        " @Emp_OtherIncome1 decimal(8,2)," &
        " @Emp_OtherIncome2 decimal(8,2)," &
        " @Emp_OtherIncome3 decimal(8,2)," &
        " @Emp_PreviousEarnings decimal(8,2)," &
        " @Emp_PrevSIDeduct decimal(8,2)," &
        " @Emp_PrevSIContribute decimal(8,2)," &
        " @Emp_PrevITDeduct decimal(8,2)," &
        " @Emp_PrevPFDeduct decimal(8,2)," &
        " @ProFnd_Code varchar(4)," &
        " @MedFnd_Code varchar(4)," &
        " @SocInc_Code varchar(4)," &
        " @Ind_Code varchar(4)," &
        " @Une_Code varchar(4)," &
        " @SocCoh_Code varchar(4)," &
        " @Emp_CreationDate smalldatetime," &
        " @Emp_CreatedBy int," &
        " @Emp_AmendDate smalldatetime," &
        " @Emp_AmendBy int," &
        " @IntTem_Code varchar(6)," &
        " @Emp_GLAnal1 varchar(12)," &
        " @Emp_GLAnal2 varchar(12)," &
        " @Emp_GLAnal3 varchar(12)," &
        " @Emp_GLAnal4 varchar(12)," &
        " @IntTem_PFCode varchar(6)," &
        " @IntTem_MFCode varchar(6)," &
        " @Emp_PensionNo varchar(7)," &
        " @Emp_DrivingLicense varchar(20)," &
        " @Emp_HasSI int," &
        " @Emp_Pensiontype int," &
        " @Emp_MyPayslipReport varchar(50)," &
        " @Emp_IBAN varchar(40)," &
        " @Emp_PreviousLifeIns decimal(18,2)," &
        " @Emp_PreviousDis decimal(18,2)," &
        " @Emp_PreviousST decimal(18,2)," &
        " @Emp_OtherIncome4 decimal(18,2)," &
        " @SecPay_Code varchar(4)," &
        " @ComRat_Code varchar(4)," &
        " @PerBon_Code varchar(4)," &
        " @DutHou_Code varchar(4)," &
        " @FliHou_Code varchar(4)," &
        " @Emp_PassFullName varchar(100)," &
        " @Emp_TravelDocs varchar(100)," &
        " @Emp_FirstEmployment varchar(1)," &
        " @OveLay_Code varchar(4)," &
        " @Emp_Password varchar(20)," &
        " @Emp_Splitemployement char(1), " &
        " @Emp_NewEmployee char(1), " &
        " @Emp_Force50Percent char(1), " &
        " @Emp_Notes nvarchar(200), " &
        " @Emp_BankBenName nvarchar(80), " &
        " @Emp_AgreedSalary decimal(18,2), " &
        " @Emp_BonusOnSalary decimal(18,2), " &
        " @Emp_TaxForSplit decimal(18,2), " &
        " @Emp_PrevMF decimal(18,2), " &
        " @Emp_PrevPenF decimal(18,2), " &
        " @Emp_50PerOff char(1), " &
        " @Ges_Code varchar(4), " &
        " @Emp_PrevGesiD decimal(18,2)," &
        " @Emp_PrevGesiC decimal(18,2), " &
        " @Emp_LWBPen varchar(1), " &
        " @Emp_GESYFromSplit decimal(18,2), " &
        " @Emp_AnalGen1 varchar(20), " &
        " @Emp_Nameday varchar(10), " &
        " @Emp_IsDirector varchar(1), " &
        " @Emp_Rehire varchar(16), " &
        " @Emp_CNP varchar(16), " &
        " @Emp_TACode varchar(16), " &
        " @Emp_HRCode varchar(16), " &
        " @Emp_TermReason varchar(2), " &
        " @Emp_HireReason varchar(2), " &
        " @Emp_Email2 Varchar(70), " &
        " @Emp_Maternity Varchar(1), " &
        " @Emp_FEControlAmount Decimal(18,2)," &
         "@Emp_PrevUnion Decimal(18,2) " &
        " " &
        " AS" &
        " DECLARE @Result as Int" &
        "   Set @Result = 0" &
        "   SELECT @Result = Count(*)" &
        "   FROM PrMsEmployees" &
        "   WHERE Emp_Code = @Emp_Code" &
        "   IF(@Result IS NULL) OR (@Result=0)" &
        " BEGIN" &
        " INSERT INTO PrMsEmployees" &
        " (Emp_Code,                                           " &
        " Emp_Status,                                         " &
        " PayTyp_Code,                                        " &
        " TemGrp_Code,                                        " &
        " EmpSta_Code,                                        " &
        " Emp_Title,                                          " &
        " Emp_LastName,                                       " &
        " Emp_FirstName,                                      " &
        " Emp_FullName,                                       " &
        " Emp_Sex,                                            " &
        " Emp_BirthDate,                                      " &
        " MarSta_Code,                                        " &
        " Emp_Address1,                                       " &
        " Emp_Address2,                                       " &
        " Emp_Address3,                                       " &
        " Emp_PostCode,                                       " &
        " Emp_Telephone1,                                     " &
        " Emp_Telephone2,                                     " &
        " Emp_Email,                                          " &
        " Emp_SocialInsNumber,                                " &
        " ComSin_EmpSocialInsNo,                              " &
        " Emp_IdentificationCard,                             " &
        " Emp_TaxID,                                          " &
        " Emp_PassportNumber,                                 " &
        " Emp_AlienNumber,                                    " &
        " TicTyp_Code,                                        " &
        " EmpAn1_Code,                                        " &
        " EmpAn2_Code,                                        " &
        " EmpAn3_Code,                                        " &
        " EmpAn4_Code,                                        " &
        " EmpAn5_Code,                                        " &
        " Uni_Code,                                           " &
        " Cou_Code,                                           " &
        " EmpPos_Code,                                        " &
        " Sic_Code,                                           " &
        " EmpCmm_Code,                                        " &
        " PayUni_Code,                                        " &
        " Emp_PeriodUnits,                                    " &
        " Emp_AnnualUnits,                                    " &
        " Cur_Code,                                           " &
        " PmtMth_Code,                                        " &
        " Bnk_Code,                                           " &
        " Emp_BankAccount,                                    " &
        " Bnk_CodeCo,                                         " &
        " Emp_BankAccountCo,                                  " &
        " Emp_StartDate,                                      " &
        " Emp_TerminateDate,                                  " &
        " Emp_OtherIncome1,                                   " &
        " Emp_OtherIncome2,                                   " &
        " Emp_OtherIncome3,                                   " &
        " Emp_PreviousEarnings,                               " &
        " Emp_PrevSIDeduct,                                   " &
        " Emp_PrevSIContribute,                               " &
        " Emp_PrevITDeduct,                                   " &
        " Emp_PrevPFDeduct, " &
        " ProFnd_Code," &
        " MedFnd_Code," &
        " SocInc_Code," &
        " Ind_Code," &
        " Une_Code," &
        " SocCoh_Code," &
        " Emp_CreationDate,                                   " &
        " Emp_CreatedBy,                                      " &
        " Emp_AmendDate,                                      " &
        " Emp_AmendBy ,                                        " &
        " IntTem_Code," &
        " Emp_GLAnal1," &
        " Emp_GLAnal2," &
        " Emp_GLAnal3," &
        " Emp_GLAnal4," &
        " IntTem_PFCode," &
        " IntTem_MFCode," &
        " Emp_PensionNo," &
        " Emp_DrivingLicense," &
        " Emp_HasSI," &
        " Emp_Pensiontype," &
        " Emp_MyPayslipReport," &
        " Emp_IBAN," &
        " Emp_PreviousLifeIns," &
        " Emp_PreviousDis," &
        " Emp_PreviousST," &
        " Emp_OtherIncome4," &
        " SecPay_Code," &
        " ComRat_Code," &
        " PerBon_Code," &
        " DutHou_Code," &
        " FliHou_Code," &
        " Emp_PassFullName," &
        " Emp_TravelDocs," &
        " Emp_FirstEmployment," &
        " OveLay_Code, " &
        " Emp_Password, " &
        " Emp_Splitemployement, " &
        " Emp_NewEmployee, " &
        " Emp_Force50Percent, " &
        " Emp_Notes, " &
        " Emp_BankBenName, " &
        " Emp_AgreedSalary, " &
        " Emp_BonusOnsalary, " &
        " Emp_TaxForSplit, " &
        " Emp_PrevMF, " &
        " Emp_PrevPenF, " &
        " Emp_50PerOff, " &
        " Ges_Code, " &
        " Emp_PrevGesiD, " &
        " Emp_PrevGesiC, " &
        " Emp_LWBPen, " &
        " Emp_GESYFromSplit, " &
        " Emp_AnalGen1, " &
        " Emp_NameDay, " &
        " Emp_IsDirector, " &
        " Emp_Rehire, " &
        " Emp_CNP,  " &
        " Emp_TACode,  " &
        " Emp_HRCode,  " &
        " Emp_TermReason,  " &
        " Emp_HireReason,  " &
        " Emp_Email2,  " &
        " Emp_Maternity, " &
        " Emp_FEControlAmount, " &
        " Emp_PrevUnion " &
        " " &
        " )" &
        " VALUES (" &
        " @Emp_Code,                                           " &
        " @Emp_Status,                                         " &
        " @PayTyp_Code,                                        " &
        " @TemGrp_Code,                                        " &
        " @EmpSta_Code,                                        " &
        " @Emp_Title,                                          " &
        " @Emp_LastName,                                       " &
        " @Emp_FirstName,                                      " &
        " @Emp_FullName,                                       " &
        " @Emp_Sex,                                            " &
        " @Emp_BirthDate,                                      " &
        " @MarSta_Code,                                        " &
        " @Emp_Address1,                                       " &
        " @Emp_Address2,                                       " &
        " @Emp_Address3,                                       " &
        " @Emp_PostCode,                                       " &
        " @Emp_Telephone1,                                     " &
        " @Emp_Telephone2,                                     " &
        " @Emp_Email,                                          " &
        " @Emp_SocialInsNumber,                                " &
        " @ComSin_EmpSocialInsNo,                              " &
        " @Emp_IdentificationCard,                             " &
        " @Emp_TaxID,                                          " &
        " @Emp_PassportNumber,                                 " &
        " @Emp_AlienNumber,                                    " &
        " @TicTyp_Code,                                        " &
        " @EmpAn1_Code,                                        " &
        " @EmpAn2_Code,                                        " &
        " @EmpAn3_Code,                                        " &
        " @EmpAn4_Code,                                        " &
        " @EmpAn5_Code,                                        " &
        " @Uni_Code,                                           " &
        " @Cou_Code,                                           " &
        " @EmpPos_Code,                                        " &
        " @Sic_Code,                                           " &
        " @EmpCmm_Code,                                        " &
        " @PayUni_Code,                                        " &
        " @Emp_PeriodUnits,                                    " &
        " @Emp_AnnualUnits,                                    " &
        " @Cur_Code,                                           " &
        " @PmtMth_Code,                                        " &
        " @Bnk_Code,                                           " &
        " @Emp_BankAccount,                                    " &
        " @Bnk_CodeCo,                                         " &
        " @Emp_BankAccountCo,                                  " &
        " @Emp_StartDate,                                      " &
        " @Emp_TerminateDate,                                  " &
        " @Emp_OtherIncome1,                                   " &
        " @Emp_OtherIncome2,                                   " &
        " @Emp_OtherIncome3,                                   " &
        " @Emp_PreviousEarnings,                               " &
        " @Emp_PrevSIDeduct,                                   " &
        " @Emp_PrevSIContribute,                               " &
        " @Emp_PrevITDeduct,                                   " &
        " @Emp_PrevPFDeduct,                                   " &
        " @ProFnd_Code," &
        " @MedFnd_Code," &
        " @SocInc_Code," &
        " @Ind_Code," &
        " @Une_Code," &
        " @SocCoh_Code," &
        " @Emp_CreationDate,                                   " &
        " @Emp_CreatedBy,                                      " &
        " @Emp_AmendDate,                                      " &
        " @Emp_AmendBy,                                         " &
        " @IntTem_Code," &
        " @Emp_GLAnal1," &
        " @Emp_GLAnal2," &
        " @Emp_GLAnal3," &
        " @Emp_GLAnal4," &
        " @IntTem_PFCode," &
        " @IntTem_MFCode," &
        " @Emp_PensionNo," &
        " @Emp_DrivingLicense," &
        " @Emp_HasSI," &
        " @Emp_Pensiontype," &
        " @Emp_MyPayslipReport," &
        " @Emp_IBAN," &
        " @Emp_PreviousLifeIns," &
        " @Emp_PreviousDis," &
        " @Emp_PreviousST," &
        " @Emp_OtherIncome4," &
        " @SecPay_Code," &
        " @ComRat_Code," &
        " @PerBon_Code," &
        " @DutHou_Code," &
        " @FliHou_Code," &
        " @Emp_PassFullName," &
        " @Emp_TravelDocs," &
        " @Emp_FirstEmployment," &
        " @OveLay_Code, " &
        " @Emp_Password, " &
        " @Emp_Splitemployement, " &
        " @Emp_NewEmployee, " &
        " @Emp_Force50Percent, " &
        " @Emp_Notes, " &
        " @Emp_BankBenName, " &
        " @Emp_AgreedSalary, " &
        " @Emp_BonusOnSalary, " &
        " @Emp_TaxForSplit, " &
        " @Emp_PrevMF, " &
        " @Emp_PrevPenF, " &
        " @Emp_50PerOff, " &
        " @Ges_Code, " &
        " @Emp_PrevGesiD, " &
        " @Emp_PrevGesiC," &
        " @Emp_LWBPen, " &
        " @Emp_GESYFromSplit, " &
        " @Emp_AnalGen1," &
        " @Emp_Nameday, " &
        " @Emp_IsDirector, " &
        " @Emp_Rehire, " &
        " @Emp_CNP,  " &
        " @Emp_TACode,  " &
        " @Emp_HRCode,  " &
        " @Emp_TermReason,  " &
        " @Emp_HireReason,  " &
        " @Emp_Email2,  " &
        " @Emp_Maternity, " &
        " @Emp_FEControlAmount, " &
        " @Emp_PrevUnion " &
        " )" &
        " END" &
        " ELSE" &
        "   BEGIN" &
        "     UPDATE PrMsEmployees" &
        "     SET " &
        "     Emp_Code=@Emp_Code,                                   " &
        "     Emp_Status=@Emp_Status,                               " &
        "    PayTyp_Code=@PayTyp_Code,                             " &
        "    TemGrp_Code=@TemGrp_Code,                             " &
        "    EmpSta_Code=@EmpSta_Code,                             " &
        "    Emp_Title=@Emp_Title,                                 " &
        "    Emp_LastName=@Emp_LastName,                           " &
        "    Emp_FirstName=@Emp_FirstName,                         " &
        "    Emp_FullName=@Emp_FullName,                           " &
        "    Emp_Sex=@Emp_Sex,                                     " &
        "    Emp_BirthDate=@Emp_BirthDate,                         " &
        "    MarSta_Code=@MarSta_Code,                             " &
        "    Emp_Address1=@Emp_Address1,                           " &
        "    Emp_Address2=@Emp_Address2,                           " &
        "    Emp_Address3=@Emp_Address3,                           " &
        "    Emp_PostCode=@Emp_PostCode,                           " &
        "    Emp_Telephone1=@Emp_Telephone1,                       " &
        "    Emp_Telephone2=@Emp_Telephone2,                       " &
        "    Emp_Email=@Emp_Email,                                 " &
        "    Emp_SocialInsNumber=@Emp_SocialInsNumber,             " &
        "    ComSin_EmpSocialInsNo=@ComSin_EmpSocialInsNo,         " &
        "    Emp_IdentificationCard=@Emp_IdentificationCard,       " &
        "   Emp_TaxID=@Emp_TaxID,                                 " &
        "   Emp_PassportNumber=@Emp_PassportNumber,               " &
        "   Emp_AlienNumber=@Emp_AlienNumber,                     " &
        "  TicTyp_Code=@TicTyp_Code,                             " &
        "  EmpAn1_Code=@EmpAn1_Code,                             " &
        "  EmpAn2_Code=@EmpAn2_Code,                             " &
        "  EmpAn3_Code=@EmpAn3_Code,                             " &
        " EmpAn4_Code=@EmpAn4_Code,                             " &
        " EmpAn5_Code=@EmpAn5_Code,                             " &
        " Uni_Code=@Uni_Code,                                   " &
        " Cou_Code=@Cou_Code,                                   " &
        " EmpPos_Code=@EmpPos_Code,                             " &
        " Sic_Code=@Sic_Code,                                   " &
        " EmpCmm_Code=@EmpCmm_Code,                             " &
        " PayUni_Code=@PayUni_Code,                             " &
        " Emp_PeriodUnits=@Emp_PeriodUnits,                     " &
        " Emp_AnnualUnits=@Emp_AnnualUnits,                     " &
        " Cur_Code=@Cur_Code,                                   " &
        " PmtMth_Code=@PmtMth_Code,                             " &
        " Bnk_Code=@Bnk_Code,                                   " &
        " Emp_BankAccount=@Emp_BankAccount,                     " &
        " Bnk_CodeCo=@Bnk_CodeCo,                               " &
        " Emp_BankAccountCo=@Emp_BankAccountCo,                 " &
        " Emp_StartDate=@Emp_StartDate,                         " &
        " Emp_TerminateDate=@Emp_TerminateDate,                 " &
        " Emp_OtherIncome1=@Emp_OtherIncome1,                   " &
        " Emp_OtherIncome2=@Emp_OtherIncome2,                   " &
        " Emp_OtherIncome3=@Emp_OtherIncome3,                   " &
        " Emp_PreviousEarnings=@Emp_PreviousEarnings,           " &
        " Emp_PrevSIDeduct=@Emp_PrevSIDeduct,                   " &
        " Emp_PrevSIContribute=@Emp_PrevSIContribute,           " &
        " Emp_PrevITDeduct=@Emp_PrevITDeduct,                   " &
        " Emp_PrevPFDeduct=@Emp_PrevPFDeduct,                   " &
        " ProFnd_Code=@ProFnd_Code," &
        " MedFnd_Code=@MedFnd_Code," &
        " SocInc_Code=@SocInc_Code," &
        " Ind_Code=@Ind_Code," &
        " Une_Code=@Une_Code," &
        " SocCoh_Code=@SocCoh_Code," &
        " Emp_CreationDate=@Emp_CreationDate,                   " &
        " Emp_CreatedBy=@Emp_CreatedBy,                         " &
        " Emp_AmendDate=@Emp_AmendDate,                         " &
        " Emp_AmendBy=@Emp_AmendBy,                              " &
        " IntTem_Code=@IntTem_Code," &
        " Emp_GLAnal1=@Emp_GLAnal1," &
        " Emp_GLAnal2=@Emp_GLAnal2," &
        " Emp_GLAnal3=@Emp_GLAnal3," &
        " Emp_GLAnal4=@Emp_GLAnal4," &
        " IntTem_PFCode=@IntTem_PFCode," &
        " IntTem_MFCode=@IntTem_MFCode," &
        " Emp_PensionNo=@Emp_PensionNo," &
        " Emp_DrivingLicense=@Emp_DrivingLicense," &
        " Emp_HasSI=@Emp_HasSI," &
        " Emp_Pensiontype=@Emp_Pensiontype," &
        " Emp_MyPayslipReport=@Emp_MyPayslipReport," &
        " Emp_IBAN=@Emp_IBAN," &
        " Emp_PreviousLifeIns=@Emp_PreviousLifeIns," &
        " Emp_PreviousDis=@Emp_PreviousDis," &
        " Emp_PreviousST=@Emp_PreviousST," &
        " Emp_OtherIncome4=@Emp_OtherIncome4," &
        " SecPay_Code=@SecPay_Code," &
        " ComRat_Code=@ComRat_Code," &
        " PerBon_Code=@PerBon_Code," &
        " DutHou_Code=@DutHou_Code," &
        " FliHou_Code=@FliHou_Code," &
        " Emp_PassFullName=@Emp_PassFullName," &
        " Emp_TravelDocs=@Emp_TravelDocs," &
        " Emp_FirstEmployment =@Emp_FirstEmployment," &
        " OveLay_Code = @OveLay_Code, " &
        " Emp_Password = @Emp_Password, " &
        " Emp_Splitemployement = @Emp_Splitemployement, " &
        " Emp_NewEmployee = @Emp_NewEmployee, " &
        " Emp_Force50Percent = @Emp_Force50Percent, " &
        " Emp_Notes = @Emp_Notes, " &
        " Emp_BankBenName = @Emp_BankBenName, " &
        " Emp_AgreedSalary = @Emp_AgreedSalary, " &
        " Emp_BonusOnSalary = @Emp_BonusOnSalary, " &
        " Emp_TaxForSplit = @Emp_TaxForSplit, " &
        " Emp_PrevMF = @Emp_PrevMF, " &
        " Emp_PrevPenF = @Emp_PrevPenF, " &
        " Emp_50PerOff = @Emp_50PerOff, " &
        " Ges_Code = @Ges_Code, " &
        " Emp_PrevGesiD = @Emp_PrevGesiD, " &
        " Emp_PrevGesiC = @Emp_PrevGesiC, " &
        " Emp_LWBPen = @Emp_LWBPen, " &
        " Emp_GESYFromSplit= @Emp_GESYFromSplit, " &
        " Emp_AnalGen1 = @Emp_AnalGen1," &
        " Emp_Nameday = @Emp_NameDay, " &
        " Emp_Isdirector = @Emp_Isdirector, " &
        " Emp_Rehire = @Emp_Rehire, " &
        " Emp_CNP = @Emp_CNP,  " &
        " Emp_TACode = @Emp_TACode,  " &
        " Emp_HRCode = @Emp_HRCode,  " &
        " Emp_TermReason = @Emp_TermReason,  " &
        " Emp_HireReason = @Emp_HireReason,  " &
        " Emp_Email2 = @Emp_Email2,  " &
        " Emp_Maternity = @Emp_Maternity, " &
        " Emp_FEControlAmount = @Emp_FEControlAmount, " &
        " Emp_PrevUnion =  @Emp_PrevUnion " &
        " WHERE Emp_Code = @Emp_Code" &
        " END "

        i = ExecuteNonQuery(Str)
        If i >= 0 Then
            MsgBox("SP PrMsEmployees was updated", MsgBoxStyle.Information)
        Else
            MsgBox("Unable to Update SP PrMsEmployees", MsgBoxStyle.Critical)
        End If


        Return True
    End Function
End Class

